---
title: 移动端新科技
tags:
  - 移动端
categories: 移动端
top: false
keywords:
  - 移动端
date: 2019-07-04 23:12:36
description: OCR 文字识别、人脸识别
---


# 一、OCR

  <div style="text-indent: 2em; margin-bottom: 20px;">OCR 是实时高效的定位与识别图片中的所有文字信息并返回文字框位置与文字内容，就是将图片上的文字内容智能识别为可编辑的文本。目前支持的场景有：`身份证识别、银行卡识别、名片识别、营业执照识别、行驶证驾驶证识别、车牌号识别、通用印刷体识别、手写体识别`。</div>

  <div style="text-indent: 2em">OCR 的本质是图像识别，其原理和其他的图像识别问题基本相同。主要包含两大关键技术：`文本检测和文字识别`，首先将图像中的特征的提取并检测目标区域，然后对目标区域的字符进行分割和分类。相关阅读：[OCR 知识资料全集](https://cloud.tencent.com/developer/article/1092091?fromSource=waitui)、[OCR 文字识别快速体验版](https://cloud.tencent.com/developer/article/1190739?fromSource=waitui)</div> 
    

## 实现流程
> 以百度 OCR 接入流程为例，[技术文档](https://cloud.baidu.com/doc/OCR/index.html)

### 接入 API
> API：应用程序编程接口，是一些基于服务端层并可以直接的预定义函数，不需要关注实现的底层语言

  1. 创建 API 调用的应用：控制台左侧 -- 文字识别
  2. 获取 access_token：通过 POST 请求（测试可用 GET 获取）
    * 地址：https://aip.baidubce.com/oauth/2.0/token
    * 参数
      * grant_type：固定值 client_credentials
      * client_secret：应用的 Secret Key
      * client_id：应用的 API Key
  3. 读取图片并调用 API 进行识别：通过 POST 请求，以身份证为例
      * 地址：https://aip.baidubce.com/rest/2.0/ocr/v1/idcard
      * 参数
        * access_token：验证合法性的签名
        * id_card_side：身份证正反面
        * image：图像数据


### 导入 SDK
> SDK：软件开发工具包，是一个完全封装好并提供指定语言调用接口的二进制包，包括辅助开发某类软件的相关文档、范例和工具等


## JS 实现

  ```js
  // input type="file" id="img" onchange="getImg(event)"

  // 通过调试接口直接获取
  var access_token = "24.d134649a8722ab143d04136d4931baf8.2592000.1564040178.282335-16632046"

  // 监听图片选择事件
  function getImg (event) {
      var imageBase = "";
      var reader = new FileReader();
      reader.readAsDataURL(event.target.files[0]);
      reader.onload = function (e) {
          console.log(e.target.result)
          imageBase = e.target.result.replace("data:image/jpeg;base64,","");
          $("#showImg").prop("src", "data:image/jpeg;base64," + imageBase);
          
          $.ajax({
              header: {
                  "Content-Type": "application/x-www-form-urlencoded"
              },
              type: "post",
              url: "https://aip.baidubce.com/rest/2.0/ocr/v1/idcard",
              async: true,
              data: {
                  access_token: access_token,
                  id_card_side: "front",
                  image: imageBase
              },
              dataType: "json",
              timeout: 30000,
              success: function (data) {
                  console.log(data);
              },
              error: function (xhr) {
                  console.log("请求解析失败");
              }
          });
      }
  }
  ```


# 二、人脸识别

## 实现原理

  1. 通过 HOG 找出图片中所有人脸的位置
  2. 计算出人脸的 68 个特征点并适当的调整人脸位置，对齐人脸
  3. 将得到的面部图像放入神经网络，得到 128 个特征测量值，并保存它们
  4. 和以前保存过的测量值一并计算欧氏距离并得到欧氏距离值，通过对比数值大小确定是否同一个人


## 应用场景
> 人脸识别分为两大步骤：人脸检测和人脸识别，它们的应用场景也各不相同

  * 人脸检测：美颜、换肤、抠图、换脸。目的是找出人脸的位置
  * 人脸识别：会员、支付。目的是识别用户


## 前端代码
> 前端发送人脸照片、后台对比人脸库

  ```js
  &lt;template&gt;
      &lt;div class="videos" ref="videos"&gt;
          &lt;video id="video" width="400" height="300" muted autoplay&gt;&lt;/video&gt;
          // 隐藏掉，为了发送照片
          &lt;canvas id="canvas" width="400" height="300" v-show="false"&gt;&lt;/canvas&gt;
      &lt;/div&gt;
  &lt;/template&gt;

  export default {
    name: "Videos",
    data() {
      return { }
    },
    methods: {
      camera_options() {
        // 打开网络摄像头
        let that = this;
        var constraints = {
              video: true,  // 使用摄像头对象
              audio: false     // 不适用音频
        };
        var video = document.getElementById('video');
        var promise = navigator.mediaDevices.getUserMedia(constraints);
        promise.then((MediaStream) => {
            /**
            * @desc MediaStream 返回参数
            * active：true
            * id："ykCZTVor0KNVypRFZW8dFSwrFd9QuihhWmqA"
            * onactive：null
            * onaddtrack：null
            * oninactive：null
            * onremovetrack：null
            */
            if ('srcObject' in video) {
            video.srcObject = MediaStream;
            } else {
            // 旧版浏览器可能没有 srcObject
            video.src = URL.createObjectURL(MediaStream);
            }
            video.play();
        }).catch((error) => {
            console.info(error);
        });
        /**
        * @desc 倒计时以后进行拍照的操作
        */
        setTimeout(function () {
            let canvas = document.getElementById("canvas");
            canvas.getContext('2d').drawImage(video, 0, 0, 200, 100);
            canvas = canvas.toDataURL("image/png");
            if (!canvas) return 
            
            //上传人脸图片：base64 文件
            that.$axios({ })

            //上传人脸图片：file 文件
            let blob = that.dataURLtoBlob(canvas);
            let file = that.blobToFile(blob, "imgName");
            if (blob) that.$axios({ })
            
        }, 1000);
      },
      /**
      * 将图片转为file格式
      * @param {Object} dataurl 将拿到的base64的数据当做参数传递
      */
      dataURLtoBlob: function (dataurl) {
        let arr = dataurl.split(','),
            mime = arr[0].match(/:(.*?);/)[1],
            bstr = atob(arr[1]),
            n = bstr.length,
            u8arr = new Uint8Array(n);
        while (n--) {
            u8arr[n] = bstr.charCodeAt(n);
        }
        return new Blob([u8arr], {
            type: mime
        });
      },
      /**
      * @param {Object} theBlob  文件
      * @param {Object} fileName 文件名字
      */
      blobToFile: function (theBlob, fileName) {
        theBlob.lastModifiedDate = new Date();
        theBlob.name = fileName;
        return theBlob;
      }
    },
    created(){
      this.camera_options()
    }
  }
  ```























