---
title: 微信小程序入门
tags:
  - 微信小程序
categories: 微信小程序
top: false
keywords:
  - 微信小程序
date: 2019-07-07 00:22:18
description: 基础入门、项目开发
---

# 一、入门简介
  <div style="text-indent: 2em;">小程序的思想是：小程序开发框架的目标是通过尽可能简单、高效的方式让开发者可以在微信中开发具有原生 APP 体验的服务。框架提供了自己的视图层描述语言 WXML、WXSS，以及基于 JavaScript 的逻辑层框架，并在视图层与逻辑层间提供了数据传输和事件系统，可以让开发者可以方便的聚焦于数据与逻辑上。</div>


## 主要特点

  * 使用轻便。它不需要安装而是通过扫描二维码等打开后直接执行，用完后也不需要卸载
  * 微信不会提供类似小程序商店的地方，需要小程序提供者自己通过二维码，群分享的手段来传播，这就是去中心化的形态
  * 微信朋友圈提供了好友之间沟通信息的手段，订阅号提供了面向粉丝推送信息的手段，而小程序则是提供了用户通过自己的操作而与服务实现互动的手段。
  * 小程序就是将微信官方提供的 20+ 个基础组件（目前有26个）进行排列组合，然后加上一些css样式，对用户的操作进行反馈（调微信官方提供的60+个api）


## 语法特点

  * __标签__
    * 小程序不支持 div、span 等标签，全部使用视图容器、基础内容等组件
  * __样式__
    * 新增单位 rpx，可以根据屏幕宽度进行自适应
    * 不支持 less、sass 等写法
    * 不支持 p:last-child 等级联选择器 
    * 支持 ::before、::after
  * __交互__：采用 js 语法，但是不能获取和操作 dom
    * 绑定：`bind、catch`，区别是 bind 不阻止冒泡而 catch 阻止
    * 事件：`touchstart、touchmove、touchend、touchcancel、longtap、tap`
      * 事件对象：event 包含 currentTarget、target 等事件触发的相关信息
      * 传参方式：`data-hi、dataset`，类似 html 的自定义属性 data-xxx
    * 样式
      * 不能直接获取 dom 控制样式
      * 只能通过 data 里的属性控制样式的变化
    * 请求
      * 小程序里称为 `wx.request`，用法类似于 ajax
      * 注意请求必须是 https 请求，并且需要到小程序的后台里设置合法域名


## 开发准备

  1. 注册账号：微信公众平台、小程序
  3. 安装工具：[下载微信 web 开发者工具](https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1455784140)
  3. 创建项目：初始化项目后，在工具中调试
  


# 二、基础语法

## 代码组成
> 注意 json 文件不能添加任何注释

  * 通过 `JSON` 表现应用的配置信息
    * `app.json`：全局配置
    * `page.json`：页面配置
    * `project.config.json`：开发工具读取
  * 通过 `CSS + XML` 实现视图层的描述
  * 通过 `JavaScript` 语言实现逻辑层结构
  * 架构在视图层和逻辑层之间提供 `数据和事件传输功能`

  ```js
  testapp
    ├─ pages  // 页面目录：可以删除或自定义配置，新建文件需要在 app.json 中声明
          ├─ index            // 首页
              ├─ index.js
              ├─ index.json          
              ├─ index.wxml
              └─ index.wxss
          └─ logs            // 日志页面

    ├─ utils                // 用于定义一些公共的工具函数，目前只包含 util.js
          └─ util.js

    ├─ app.js    // 入口文件，包括声明全局变量、监听处理生命周期函数、全局登录操作等 
    ├─ app.json  // 全局配置文件，包括页面路径、窗口表现、标签导航、网络超时、debug模式
    ├─ app.wxss  // 公共样式代码，用于全局定义小程序页面和标签的样式，类似 CSS 
    └─ project.config.json     // 目录结构配置文件，类似 package.json
  ```


## WXML 视图层
> 属于微信视图层的一套标签语言，类似于 Vue 的模板语法

  <div align="center"> 
    ![WXML 语法](/images/webchat/wxml.png)
  </div>


## WXS 模块
> Weixin Script 脚本的简称，可看作 WXML 调用 js 方法的独立模块

### 语法
  <div align="center"> 
    ![wxs 语法](/images/webchat/wxs.png)
  </div>


### 特点
  * wxs 不依赖于运行时的基础库版本，可以在所有版本的小程序中运行。
  * wxs 与 js 是不同的语言，有自己的语法。wxs 函数并不能作为组件的事件回调。
  * wxs 的运行环境和其他 js 代码是隔离的，wxs 中不能调用其他 js 文件中定义的函数，也不能调用小程序提供的API。
  * 由于运行环境的差异，iOS 设备上小程序内的 wxs 会比 js 代码快 2 ~ 20 倍。在 android 设备上二者运行效率无差异。


### 使用
> 两种方式：wxml 直接使用的 wxs 标签、wxml 引入的 wxs 文件

  <div align="center"> 
    ![wxs 语法](/images/webchat/wxs_view.png)
  </div>


## 生命周期

  * App() 应用生命周期
    * `onLaunch`：小程序初始化结束调用(一次)
    * `onShow`：启动, 后者从后台进入前台
    * `onHide`：当小程序从前台进入后台时
    * `onError`：当小程序发生脚本错误或api调用失败时
  * 局部：用于 Page() 注册页面时
    * `onLoad`：页面加载
    * `onReady`：初次渲染完成
    * `onShow`：页面显示
    * `onHide`：页面隐藏
    * `onUnload`：页面卸载
    * `onPullDownRefresh`：下拉动作
    * `onReachBottom`：上拉触底(加载更多)


## 数据请求
> 通过ajax获取图片数据不能正常显示，需要给图片添加属性 `lazy - onLoad`

  ```js
  wx.request({
      url: 'http://127.0.0.1:3000/list',   //请求地址
      data: {id: 1}, // 请求参数
      method: "GET", // 请求方式
      dataType: "json", // 返回数据类型
      success: function (res) { // 成功后执行
        this.datas = res.data
      },
      fail: function (err) { //失败后执行
      },
      complete: function (res) { // 成功失败都执行
      }
  })
  ```




## 路由

  * 页面跳转
    * wx.navigateTo(obj)：保留当前页面，跳转到应用内的某个页面
    * wx.redirectTo(obj)：关闭当前页面，跳转到应用内的某个页面
    * wx.navigateBack()：关闭当前页面，回退前一页面


# 三、组件化开发
> 开发者可以将页面内的功能模块抽象成自定义组件，具有高内聚、可复用的特点。可以在不同的页面中重复使用，也可以将复杂的页面拆分成多个低耦合的模块有助于代码维护。


## 组件定义
> 一个组件包括 json、wxml、wxss、js 四个文件，如下 item 组件

  1. 根目录新建文件夹 components 
  2. 新建自定义组件目录 item
  3. 编辑组件的组成文件
    ```js
    /**
     *  默认只能有一个 slot 插槽，需要使用多个时需要声明启用
     *  除继承样式外，全局样式、组件所在页面的的样式对自定义组件无效
    **/
    
    // item.json：配置文件
    {
      "component": true,      // 声明这个是组件
      "usingComponents": {}   // 表示在该组件中可使用其它组件
    }

    // item.js：逻辑交互文件，定义组件的属性、数据及方法
    Component({
      behaviors: [], // 类似 vue 的 mixins、traits 的组件间代码复用机制
      relations: {}, // 定义关联
      options: {
        multipleSlots: true    // 启用多 slot 支持
        addGlobalClass: true,  // 使组件接受全局样式，尽量避免
      },
      properties: {    // 对外定义的接收属性
        innerText: {
          type: String,  // String、Number、Boolean、Object、Array、null
          value: 'hello world',    // 默认值
          observer(newVal, oldVal, changedPath){ }  // 属性被改变时执行的函数
        }
        message: String    // 简写方式
      },
      data: {},
      methods: {},
      externalClasses: ['tag-class'],  // 使用外部类名样式，尽量避免
      lifetimes: {        // 生命周期函数
        created(){},
        attached(){},     // vue beforeMount
        ready(){},        // vue mounted
        moved(){},        // 组件位置更新
        detached(){}      // 组件卸载
      },
      pageLifetimes: {   // 组件所在页面的生命周期函数
        show() { },
        hide() { },
        resize() { },
      },
      definitionFilter: {}     // 组件扩展
    })
    
    // item.wxss：样式文件，注意只能通过类名指定
    @import "../../app.wxss";  // 引入公共样式
    .inner{
      color: red;
    }
    ```
  4. 组件使用
    ```js
    // 引用组件的页面文件

    // index.json
    {
      "navigationBarTitleText": "index 页面",
      "usingComponents": {
        "myItem": "/components/item/item"
      }
    }
    ```
  
  <div align="center"> 
    ![自定义组件](/images/webchat/com_panel.png)
  </div>


## 组件通信

### 父传子：数据绑定
  * 父组件 wxss 子组件标签添加属性：`	&lt;submit-bar id="&#123;&#123;id&#125;&#125;"&gt;`
  * 子组件 js 通过 properties 接收：`properties: { id: Number }`


### 子传父：事件触发
  * 子组件触发事件
    * `this.triggerEvent('myevent', { id: 1 }, myEventOption)`
    * 自定义事件名、传递数据的 detail 对象、事件选项（是否冒泡等）
  *  父组件捕获事件
    * 子组件标签绑定自定义事件：`	&lt;submit-bar bind:submit="submit"&gt;`
    * 监听事件执行并接收数据：`submit(event){ event.detail.id }`



### 其它通信方式
  * 父组件获取子组件实例
    * `&lt;compontent id="modal"&gt;`
    * `var modal = this.setlectComponet('#modal')`

 
## 组件共享
> behaviors 用于组件间代码共享一组属性、数据、生命周期函数和方法，类似 mixins

  ```js
  // 新建 my-behavior.js
  module.exports = Behavior({
    behaviors: [],
    properties: {
      carModel: String,
      price: Number,
      sale: Boolean
    },
    data: {
      myBehaviorData1: "eyes on me"
    },
    attached: function() { },
    methods: {
      myBehaviorMethod: function() { }
    }
  })

  // 组件中使用
  
  // com.js
  Component({
    behaviors: [myBehavior],  // 挂载 Behavior
    properties: {},
    data: {
      me: '组件自身数据'
    },
    methods: {}
  })
  ```

  <div align="center"> 
    ![behaviors](/images/webchat/behaviors.png)
  </div>





















