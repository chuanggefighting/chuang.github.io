---
title: 微信小程序入门
tags:
  - 微信小程序
categories: 微信小程序
top: false
keywords:
  - 微信小程序
date: 2019-07-07 00:22:18
description: 基础入门、项目开发
---

# 一、入门简介
  <div style="text-indent: 2em;">小程序的思想是：小程序开发框架的目标是通过尽可能简单、高效的方式让开发者可以在微信中开发具有原生 APP 体验的服务。框架提供了自己的视图层描述语言 WXML、WXSS，以及基于 JavaScript 的逻辑层框架，并在视图层与逻辑层间提供了数据传输和事件系统，可以让开发者可以方便的聚焦于数据与逻辑上。</div>


## 主要特点

  * 使用轻便。它不需要安装而是通过扫描二维码等打开后直接执行，用完后也不需要卸载
  * 微信不会提供类似小程序商店的地方，需要小程序提供者自己通过二维码，群分享的手段来传播，这就是去中心化的形态
  * 微信朋友圈提供了好友之间沟通信息的手段，订阅号提供了面向粉丝推送信息的手段，而小程序则是提供了用户通过自己的操作而与服务实现互动的手段。
  * 小程序就是将微信官方提供的 20+ 个基础组件（目前有26个）进行排列组合，然后加上一些css样式，对用户的操作进行反馈（调微信官方提供的60+个api）


## 相关技术

  * 通过 `JSON` 表现应用的配置信息
  * 通过 `CSS + XML` 实现视图层的描述
  * 通过 `JavaScript` 语言实现逻辑层结构
  * 架构在视图层和逻辑层之间提供`数据和事件传输功能`


## 代码差异

  * __标签__：小程序里完全取消了 div、span 等标签而全部使用视图容器、基础内容等组件
  * __样式__
    * 小程序引入了新单位 rpx，可以根据屏幕宽度进行自适应
    * 不支持 less、sass 等写法 
    * 不支持 p:last-child 等级联选择器 
    * 支持 ::before、::after
  * __交互__：采用 js 语法，但是不能获取和操作 dom
    * 绑定：`bind、catch`，区别是 bind 不阻止冒泡而 catch 阻止
    * 事件：`touchstart、touchmove、touchend、touchcancel、longtap、tap`
      * 事件对象：event 包含 currentTarget、target 等事件触发的相关信息
      * 传参方式：`data-hi、dataset`，类似 html 的自定义属性 data-xxx
    * 样式
      * 不能直接获取 dom 控制样式
      * 只能通过 data 里的属性控制样式的变化
    * 请求
      * 小程序里称为 `wx.request`，用法类似于 ajax
      * 注意请求必须是 https 请求，并且需要到小程序的后台里设置合法域名
  


# 二、基础语法

## WXML 语法
> 属于微信视图层的一套标签语言，类似于 Vue 的模板语法

  <div align="center"> 
    ![WXML 语法](/images/webchat/wxml.png)
  </div>


## WXS 模块化
> 小程序的一套脚本语言，结合 WXML 可以构建出页面结构。其代码编写在 wxml 文件中的 wxs 标签或以 .wxs 为后缀名的文件

  <div align="center"> 
    ![wxs 语法](/images/webchat/wxs.png)
  </div>


### 特点
  * wxs 不依赖于运行时的基础库版本，可以在所有版本的小程序中运行。
  * wxs 与 js 是不同的语言，有自己的语法。wxs 函数并不能作为组件的事件回调。
  * wxs 的运行环境和其他 j是、 代码是隔离的，wxs 中不能调用其他 js 文件中定义的函数，也不能调用小程序提供的API。
  * 由于运行环境的差异，iOS 设备上小程序内的 wxs 会比 js 代码快 2 ~ 20 倍。在 android 设备上二者运行效率无差异。


### 优点
  * wxs 算是专供 WXML 调用的有独立作用域的 JS 模块
  * wxs 可以实现 WXML 调用 js 方法的能力，而不只限于通过 `&#123;&#123;&#125;&#125;` 渲染现成的数据


### 引用
  * 特点
    * 只能引用 .wxs 文件模块，且必须使用相对路径
    * 如果一个 wxs 模块在定义之后，一直没有被引用，则该模块不会被解析与运行
    * wxs 模块均为单例，第一次被引用时会自动初始化为单例对象。多个页面、多个地方、多次引用时使用的都是同一个 wxs 模块对象
  * 方式
    * 通过模块名字：wxml 文件中使用定义了名称的 wxs 标签 
    * 通过 require：`var tools = require("./tools.wxs")`
    * 以上结合：`wxs src="./../logic.wxs" module="logic"`

  <div align="center"> 
    ![wxs 语法](/images/webchat/wxs_view.png)
  </div>


## 函数
  <div align="center"> 
    ![App() 注册小程序](/images/webchat/app_fn.png)
  </div>
    <div align="center"> 
    ![Page() 注册页面](/images/webchat/page_fn.png)
  </div>


## 路由

  * 页面跳转
    * wx.navigateTo(obj)：保留当前页面，跳转到应用内的某个页面
    * wx.redirectTo(obj)：关闭当前页面，跳转到应用内的某个页面
    * wx.navigateBack()：关闭当前页面，回退前一页面


# 三、组件化开发
> 开发者可以将页面内的功能模块抽象成自定义组件，以便在不同的页面中重复使用，也可以将复杂的页面拆分成多个低耦合的模块，有助于代码维护。组件具有高内聚、可复用的特点


## 自定义组件
> 一个组件包括 json、wxml、wxss、js 四个文件，如下 item 组件

  1. 根目录新建 components 文件夹
  2. 新建自定义组件目录 loading
  3. 编辑组件的组成文件
    ```js
    /**
     *  默认只能有一个 slot 插槽，需要使用多个时需要声明启用
     *  除继承样式外，全局样式、组件所在页面的的样式对自定义组件无效
    **/
    
    // item.json：配置文件
    {
      "component": true,      // 声明这一组文件是自定义组件
      "usingComponents": {}   // 可选项，表示在该组件中可使用其它组件
    }

    // item.js：逻辑交互文件，定义组件的属性、数据及方法
    Component({
      options: {
        multipleSlots: true    // 启用多 slot 支持
        addGlobalClass: true,  // 让组件外样式影响组件内部
      },
      properties: {
        innerText: {
            type: String,
            value: 'hello world'
        }
      },
      data: {},
      methods: {}
    })
    
    // item.wxss：样式文件，注意只能通过类名指定
    @import "../../app.wxss";  // 引入公共样式
    .inner{
      color: red;
    }
    ```
  4. 页面引用
    ```js
    // index.json
    {
      "navigationBarTitleText": "index页面",
      "usingComponents": {
        "myItem": "/components/item/item"
      }
    }
    ```
  
  <div align="center"> 
    ![自定义组件](/images/webchat/com_panel.png)
  </div>


## 组件通信

### 父子组件通信

  * __WXML 数据绑定__：用于父组件向子组件的指定属性设置数据
    ```js
    // ============= 父组件 ==============
    // index.json
    {
      "usingComponents": {
        "v-child": "/components/child/index"
      }
    }
    // index.js
    const app = getApp()
    Page({
      data: {
        dataA: "来自父组件 index 的数据",
        dataB: true,
        dataC: 2300
      }
    })

    // ============= 子组件 child ==============
    // index.js
    Component({
      properties: {
        propA: String,
        propB: Boolean,
        propC: Number
      },
      data: {},
      methods: {}
    })
    ```
  * __事件__：用于子组件向父组件传递数据，可以传递任意数据
    ```js
    // ============= 子组件 child ==============
    // index.js
    Component({
      methods: {
        tapclick: function(event) {
          let user = { id: 1, name: 'Natasha' }
          // 触发自定义事件并传参
          this.triggerEvent('customevent', user, {})
        }
      }
    })

    // ============= 父组件 ==============
    // index.js  
    const app = getApp()
    Page({
      onCustomEvent: function(e) {
        this.setData({ id: e.detail.id, name: e.detail.name })
      },
    })
    ```
    <div align="center"> 
      ![父子组件通信](/images/webchat/father_son.png)
    </div>
  * 父组件获取子组件实例对象
    * `&lt;compontent id="modal"&gt;&lt;/compontent&gt;`
    * `var modal = this.setlectComponet('#modal')`

 
### 全局通信
> 组件间代码共享 Behavior

  ```js
  // 新建 my-behavior.js
  module.exports = Behavior({
    behaviors: [],
    properties: {
      carModel: String,
      price: Number,
      sale: Boolean
    },
    data: {
      myBehaviorData1: "eyes on me"
    },
    attached: function() { },
    methods: {
      myBehaviorMethod: function() { }
    }
  })

  // 组件 com.js
  Component({
    behaviors: [myBehavior],  // 挂载上 Behavior 即可使用其里面的方法与数据
    properties: {},
    data: {
      me: '组件自身数据'
    },
    methods: {}
  })

  // com.json
  {
    "component": true,
    "usingComponents": {}
  }

  // 然后可以在多个组件中共同该自定义组件的代码
  ```

  <div align="center"> 
    ![全局通信](/images/webchat/global_communite.png)
  </div>



# 三、开发指南

## 开发准备

  1. 注册账号：微信公众平台、小程序
  3. 安装工具：[下载微信 web 开发者工具](https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1455784140)
  3. 创建项目：初始化项目后，在工具中调试


## 目录结构
> 注意：app.json 不能添加任何注释，小程序标签不支持 HTML、CSS

  * __WXML、HTML__：标签名称不一样，多了些 wx:if 等属性和 `&#123;&#123;&#125;&#125;` 表达式
  * __WXSS、CSS__：新增尺寸单位，样式导入，仅支持部分 css 选择器
  * __JSON 配置__：开发工具读取 project.config.json，全局配置 app.json，页面配置 page.json

  ```js
  testapp
    ├─ pages  // 页面目录：可以删除或自定义配置，新建文件需要在 app.json 中声明
          ├─ index            // 首页
              ├─ index.js
              ├─ index.json          
              ├─ index.wxml
              └─ index.wxss
          └─ logs            // 日志页面

    ├─ utils                // 用于定义一些公共的工具函数，目前只包含 util.js
          └─ util.js

    ├─ app.js    // 入口文件，包括声明全局变量、监听处理生命周期函数、全局登录操作等 
    ├─ app.json  // 全局配置文件，包括页面路径、窗口表现、标签导航、网络超时、debug模式
    ├─ app.wxss  // 公共样式代码，用于全局定义小程序页面和标签的样式，类似 CSS 
    └─ project.config.json     // 目录结构配置文件，类似 package.json
  ```


## 
 
















