---
title: 移动端基础
tags:
  - 移动端
categories: 移动端
top: false
keywords:
  - 移动端
date: 2019-04-19 02:03:23
description: 开发模式、Viewport 视口、布局方案、适配方案
---

# 一、开发模式

  <div align="center">
    <!-- mobile-type.png -->
    ![Mobile Type](https://ws2.sinaimg.cn/large/006tNc79gy1g29njm7l9oj30go08r0ta.jpg)
  </div> 

## Native App
> 移动端的原生应用

  * 实现：基于手机操作系统 API 并使用原生语言编写
  * 优点
    * 支持离线运行
    * 能够访问智能设备提供的所有功能
    * 更好的运行速度，性能和总体用户体验
    * 支持丰富的图形，动画和更好的渲染效果
  * 缺点
    * 开发成本较高：同一个项目至少需要 Android、iOS、Web 三个开发团队
    * 维护、更新成本高：需要所有用户重新下载安装


## Web App
> 移动端的 Web 浏览器，注意 PC Web 运行在 Windows、Linux 

  * 实现：基于 Html5 实现并运行在 iOS/Android
  * 优点
    * 开发成本较低
    * 适用范围广，跨平台
    * 可以方便、快速地部署
    * 维护成本低：用户可以随时访问最新版本而不需要下载更新
  * 缺点
    * 图形和动画渲染效果差
    * 用户体验差：加载慢、费流量
    * 不能调用系统相关功能：相机、GPS等


## Hybrid App
> 混合 App，兼具 Native App 良好用户交互体验、Web App 跨平台开发的优势

  * 实现：使用原生语言编写应用的外壳，然后在其中内嵌网页语言编写的内容信息
  * 优点
    * 部分支持离线功能
    * 维护、更新较为方便
    * 可调用智能设备相关功能
  * 缺点
    * 用户体验较差
    * 图形和动画渲染效果较差


# 二、基础知识

## 像素
  * 物理像素
    * 单位：dp，获取方法为 window.screen.width/height
    * 特点
      * 屏幕分辨率表示设备屏幕上的物理像素个数
      * 同一个设备上，1dp 代表的物理长度是固定不变的
      * 不同设备之间，1dp 代表的物理长度是可以不同的
  * 逻辑像素
    * 单位：px
    * 特点
      * 改变大小的场景：缩放屏幕、更换设备
      * 它与物理像素之间的比例关系取决于 屏幕特性（是否高清屏）和用户设置的缩放比例，由浏览器自行换算
  * 换算关系
    * dpr：物理像素与CSS像素的比例
    * 关系：1px = (dpr)^2 * dp


## Viewport
  <div style="text-indent: 2em">PC 端网站都是以浏览器窗口(设备屏幕) 作为视口进行布局。但是在移动端，网站的布局视口默认比移动端屏幕宽很多，浏览器为了将页面完整显示出来而会将页面缩小至浏览器窗口中，页面内容看起来被压扁，因此引入了 viewport 视口的概念来解决移动端的页面展示问题。</div>


### layout viewport  
> 布局视口，获取方法为 document.documentElement.clientWidth/clientHeight

  * 默认比移动端屏幕宽很多，而 CSS 页面布局是根据布局视口来计算的
  * 浏览器为了将页面在浏览器窗口中完整地显示出来，会将页面压扁
  * 通过 meta 标签设置 `布局视口宽度 = 浏览器窗口宽度` 之后，页面就会正常显示


### visual viewport
> 视觉视口

  * 用户当前看到的区域，用户可以通过缩放操作视觉视口，同时不会影响布局视口
  * 当放大页面时，用户能看到的页面内容在减少，CSS 像素将跨越更多的物理像素


### ideal viewport
> 理想视口

  * 它的宽度等于移动设备的屏幕宽度，和设备的物理宽度无关
  * 这个理想的宽度是指以 CSS 像素单位计算的，即屏幕的 CSS 像素宽度
  * 布局视口并不是理想视口，所以需要设置：`布局视口 = 理想视口 = 移动设备屏幕`


## meta
> 移动设备默认的是 布局视口，但是移动端开发时需要的是 理想视口，meta 标签就用于控制视口

  * viewport 标签只对移动端浏览器有效，对 PC 端浏览器是无效的
  * 当缩放比例为 100% 时，dip 宽度 = CSS 像素宽度 = 理想视口的宽度 = 布局视口的宽度
  * 即使设置了 user-scalable = no，在 Android Chrome 浏览器中也可以强制启用手动缩放
  * 单独设置 initial-scale 或 width 都会有兼容性问题（横竖屏不分），所以设置布局视口为理想视口的最佳方法是同时设置这两个属性


  ```js
  // 启用360浏览器的极速模式 (webkit)  
  &lt;meta name="renderer" content="webkit" /&gt;

  // 优先使用 IE 最新版本和 Chrome  
  &lt;meta http-equiv="X-UA-Compatible" content="IE=EDGE, chrome=1" /&gt;

  // 页面窗口自动调整到设备宽度，并禁止用户缩放页面 (scale) 
  &lt;meta name="viewport" content="width=device-width, height=device-height, 
  initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" /&gt;

  // 使用全屏模式运行，仅针对 ios safari  
  &lt;meta name="apple-mobile-web-app-capable" content="yes" /&gt;
  
  // 设置顶端状态栏背景为灰色半透明，仅针对 ios safari  
  &lt;meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" /&gt;

  // windows phone 点击无高光 
  &lt;meta name="msapplication-tap-highlight" content="no" /&gt;

  // 关闭电话号码和邮箱的自动识别  
  &lt;meta name="format-detection" content="telephone=no, email=no" /&gt;
  ```


## 常用样式

### reset.css
  ```css
  html{
    -webkit-text-size-adjust: none;
    -webkit-user-select: none;
    -webkit-touch-callout: none;
    /* font-family: Helvetica; */
  }
  body{
    font-size: 12px;
    font-family: -apple-system, BlinkMacSystemFont, "PingFang SC","Helvetica Neue",STHeiti,"Microsoft Yahei",Tahoma,Simsun,sans-serif;
  }
  body,h1,h2,h3,h4,h5,h6,p,dl,dd,ul,ol,pre,form,input,textarea,th,td,select{
    margin: 0; 
    padding: 0; 
    text-indent: 0;
    font-weight: normal;
  }
  a,button,input,textarea,select{ 
    background: none; 
    outline: none;
    -webkit-appearance: none;
    -webkit-tap-highlight-color: rgba(255,0,0,0); 
  }
  em{
    font-style: normal
  }
  li{
    list-style: none
  }
  a{
    text-decoration: none;
  }
  img{
    border:none; 
    vertical-align: top;
  }
  table{
    border-collapse: collapse;
  }
  textarea{ 
    resize: none; 
    overflow: auto;
  }
  ```


### 媒体查询
  ```css
  /* rem 配置 */
  html{
    font-size: 10px
  }
  @media screen and (min-width:321px) and (max-width:375px){
    html{ font-size: 11px }
  }
  @media screen and (min-width:376px) and (max-width:414px){
    html{ font-size: 12px }
  }
  @media screen and (min-width:415px) and (max-width:639px){
    html{ font-size: 15px }
  }
  @media screen and (min-width:640px) and (max-width:719px){
    html{ font-size: 20px }
  }
  @media screen and (min-width:720px) and (max-width:749px){
    html{ font-size: 22.5px }
  }
  @media screen and (min-width:750px) and (max-width:799px){
    html{ font-size: 23.5px }
  }
  @media screen and (min-width:800px){
    html{ font-size: 25px } 
  }

  /* 竖屏时的样式 */
  @media all and (orientation:portrait){   }

  /* 横屏时的样式 */
  @media all and (orientation:landscape){   }

  ```



 
# 三、优化方案

  * 不滥用 Float：渲染页面时计算量比较大
  * 不滥用 Web 字体：需要下载、解析、重绘当前页面
  * 不声明过多的 Font-size：会影响 CSS 树的效率
  * 减少重绘和回流
    * 减少 drawImage
    * 避免不必要的 DOM 操作
    * 避免使用 document.write
    * 尽量改变 class 而不是 Style
  * 动画优化
    * 尽量使用 CSS3 动画：5 个以内的元素时
    * 适当使用 Canvas 动画：5 个以上元素时
    * 合理使用 requestAnimationFrame 动画代替 setTimeout
  * GPU 加速
    * 注意过渡使用会引发手机过耗电增加
    * 触发 GPU 渲染：transitions、3D transforms、Opacity、Canvas、WebGL、Video
    

  <div align="center">
    <!-- mobile-optimization.png -->
    ![移动端优化](https://ws3.sinaimg.cn/large/006tNc79gy1g29njnsj91j30ow0syta3.jpg) 
  </div>


 





