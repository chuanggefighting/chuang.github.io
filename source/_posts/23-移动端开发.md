---
title: 移动端开发
tags:
  - 移动端
categories: 移动端
top: false
keywords:
  - 移动端
date: 2019-04-19 02:03:23
description: 开发模式、适配方案、常用样式、优化方案
---

# 一、开发模式
> 移动端开发模式分三种，前端只能开发 Web App

  <div align="center">
    ![Mobile Mode](/images/mobile/mode.png)
  </div> 

## Native App
> 移动端的原生应用

  * 实现：基于手机操作系统 API 并使用原生语言编写
  * 优点
    * 支持离线运行
    * 能够访问智能设备提供的所有功能
    * 更好的运行速度，性能和总体用户体验
    * 支持丰富的图形，动画和更好的渲染效果
  * 缺点
    * 开发成本较高：同一个项目至少需要 Android、iOS、Web 三个开发团队
    * 维护、更新成本高：需要所有用户重新下载安装


## Web App
> 移动端的 Web 浏览器，注意 PC Web 运行在 Windows、Linux 

  * 实现：基于 Html5 实现并运行在 iOS、Android
  * 优点
    * 开发成本较低
    * 适用范围广，跨平台
    * 可以方便、快速地部署
    * 维护成本低：用户可以随时访问最新版本而不需要下载更新
  * 缺点
    * 图形和动画渲染效果差
    * 用户体验差：加载慢、费流量
    * 不能调用系统相关功能：相机、GPS等


## Hybrid App
> 混合 App，兼具 Native App 良好用户交互体验、Web App 跨平台开发的优势

  * 实现：使用原生语言编写应用的外壳，然后在其中内嵌网页语言编写的内容信息
  * 优点
    * 部分支持离线功能
    * 维护、更新较为方便
    * 可调用智能设备相关功能
  * 缺点
    * 用户体验较差
    * 图形和动画渲染效果较差


# 二、适配方案
> 让页面能在不同尺寸、不同分辨率的移动设备上，尽可能的实现合理展示

  <div style="text-indent: 2em">设计图都是 2 倍的，是因为页面中除了字体是矢量图而大部分都是位图。如果 1px 宽高的盒子里放入 1px 宽高的图片则图片会失真，因为在移动端渲染时是用 4px 渲染，但是如果我们给 1px 宽高的盒子放入 2px 宽高的图片则不失真。</div>


## 两种像素
> 使用 css 像素单位时，同样样式的代码在不同屏幕分辨率的移动设备中显示的情况基本一致，是因为移动设备通过像素比转换了 css 像素实际大小

  1. 设备像素
    * 概念
      * 物理像素，通常指设备的分辨率
      * 单位 dp，是设备能控制显示的最小单位
    * 特点
      * 同一个设备上，1dp 代表的物理长度是固定不变的
      * 像素比例取决于 屏幕特性（是否高清屏）和用户缩放比例
  2. CSS 像素
    * 概念
      * 逻辑像素，主要用于精确度量浏览器的 Web 页面
      * 单位 px，是独立于设备而用于 web 开发的抽象单位
    * 特点
      * 改变大小的场景：缩放屏幕、更换设备
      * 页面放大时，1px 等于更多的物理像素，页面能看到的内容减少


## Viewport
> 浏览器上用来显示网页的部分区域，是手机浏览器的实际宽度

  <div style="text-indent: 2em">PC 端网站都是以浏览器窗口(设备屏幕) 作为视口进行布局。但是在移动端，手机浏览器的实际宽度默认比手机屏幕宽很多，无论手机宽度是 320px、640px，在手机浏览器内部的宽度始终会是浏览器本身的 viewport （主流为 980px）。手机浏览器为了浏览桌面端网页时显示正常，设计页面时一般基于 960px，然而这样会使手机浏览器出现横向滚动条。为了避免这种情况，移动设备的浏览器会自动将视口缩放到移动端窗口的大小，网页内容看起来被压扁而不容易观看。可简单理解为：`当浏览器宽度小于 980 时，Viewport 宽度就是980，当浏览器尺寸宽度大于 980 时 Viewport 宽度和浏览器宽度一致`。</div>


### 分类
> 移动设备默认的是 布局视口，但是移动端开发时需要的是 理想视口

  * `布局视口`：手机浏览器的实际区域，用于计算 CSS 页面布局
  * `视觉视口`：用户当前看到的区域，放大页面时内容减少但并不会受影响
  * `理想视口`：移动设备的屏幕区域，它以 CSS 像素单位计算并与设备的物理宽高无关


### 设置
> 视口控制通过 meta 实现：`设备宽度 = 页面宽度 = 浏览器视口宽度`，但只对移动端有效

  ```js
  // 启用360浏览器的极速模式 (webkit)  
  &lt;meta name="renderer" content="webkit" /&gt;

  // 优先使用 IE 最新版本和 Chrome  
  &lt;meta http-equiv="X-UA-Compatible" content="IE=EDGE, chrome=1" /&gt;

  // 页面窗口自动调整到设备宽度，并禁止用户缩放页面 (scale) 
  &lt;meta name="viewport" content="width=device-width, height=device-height, 
  initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" /&gt;

  // 使用全屏模式运行，仅针对 ios safari  
  &lt;meta name="apple-mobile-web-app-capable" content="yes" /&gt;
  
  // 设置顶端状态栏背景为灰色半透明，仅针对 ios safari  
  &lt;meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" /&gt;

  // windows phone 点击无高光 
  &lt;meta name="msapplication-tap-highlight" content="no" /&gt;

  // 关闭电话号码和邮箱的自动识别  
  &lt;meta name="format-detection" content="telephone=no, email=no" /&gt;
  ```


## 实现方式

### viewport 缩放
> 针对不同屏幕分辨率的手机设置等比例缩放。简单方便，但是 PC 端可能会界面变形、像素失真

  ```js
  &lt;meta name="viewport" content="width=device-width, height=device-height, 
    initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" /&gt;
  ```


### 响应式布局
  <div style="text-indent: 2em">设计理念通过媒体查询根据不同的屏幕分辨率来进行适配，从而在不同设备不同分辨率下都有良好的用户体验，一般通过媒体查询设置移动端宽度。缺点是 无法覆盖全部分辨率、代码量大且维护性难、安卓机型问题较多，一般只适合简单的资讯类页面。</div>

  ```css
  /* 法一 */ 
  link media="(max-width:480px)" href="mobile.css"
	
  /* 法二 */ 
  @media all and (orientation :landscape) {  /* 横屏 */  } 
  @media all and (orientation :portrait) {  /* 竖屏 */  }
  @media screen and (max-width: 500px) {  
     body { background: black }
  }
  ```


### 弹性布局
> 使容器子元素的宽高能够最合理的方式填充空间

1. __百分比布局__：宽高自适应
    * 特点：宽度自适应而在不同的分辨率下都能达到适配
    * 缺点：需要确定父级元素的大小、一般需要固定高度但不好设置
    * 特点
      * width、height 等大部分相对于直接父元素
      * border-radius、translate、background-size 等相对于自身
  2.  __vw、vh 布局__：宽高自适应
    * 优点：指定相对视口的宽高，单位转换比较方便
    * 缺点：单位换算时可能出现小数、IE11 和一些低版本手机不支持
    * 特点：只相对于视口宽度和高度
  3. __rem 布局__：字体自适应
    * rem 布局
      * 优点：一种简单粗暴解决移动端适配屏幕尺寸问题的布局方式，但只适用于固定尺寸
      * 缺点：不能兼容所有终端，而且使字号在不同屏幕上的绝对尺寸不一致，不符合用户习惯
      * 实现原理
        * 直接通过媒体查询设置根元素的 font-size
        * 通过 js 读取屏幕宽度，然后根据宽度计算出对应的尺寸并设置根元素的 font-size


  ```css
  /* 通过媒体查询实现移动端字体的自适应 */
  @media screen and (min-width: 375px){
      html { font-size: 14.0625px; }
  }
  @media screen and (min-width: 360px){
      html { font-size: 13.5px;  }
  }
  @media screen and (min-width: 320px){
      html { font-size: 12px; }
  }
  html {
      font-size: 16px;
  }
  ```

  ```js
  //  Js 动态设置 rem：以设计图 640 分辨率为标准封装 rem.js，网上有优化版 flexible.js 等
  (function (doc, win) {
      var docEl = doc.documentElement,
          resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
          recalc = function () {
              // 获取屏幕宽度
              var clientWidth = docEl.clientWidth;
              if (!clientWidth) return;
              if (clientWidth >= 640) {
                  docEl.style.fontSize = '100px';
              } else {
                  // 设置 html 的字体大小：clientWidth/(640/100)
                  docEl.style.fontSize = 100 * (clientWidth / 640) + 'px';
              }
          };
      if (!doc.addEventListener) return;
      win.addEventListener(resizeEvt, recalc, false);
      doc.addEventListener('DOMContentLoaded', recalc, false);
  })(document, window);
  ```
  

### vue 方案
> vue-cli3 项目通过 vw 实现移动端适配，需要安装插件 `npm i postcss-px-to-viewport -D`

  ```js
  // postcss.config.js
  module.exports = {
    plugins: {
      'autoprefixer': {},
      'postcss-px-to-viewport': { 
        viewportWidth: 750,    // 视窗宽度，对应设计稿的宽度，一般是 750 
        viewportHeight: 1334,  // 视窗高度，根据 750 设备的宽度来指定，一般指定 1334
        unitPrecision: 3,      // 指定`px`转换为视窗单位值的小数位数（很多时候无法整除） 
        viewportUnit: 'vw',    // 指定需要转换成的视窗单位，建议使用 vw 
        selectorBlackList: ['.ignore', '.hairlines'], // 指定不转换为视窗单位的类
        minPixelValue: 1,      // 小于或等于`1px`不转换为视窗单位
        mediaQuery: false      // 允许在媒体查询中转换`px` 
      }
    }
  }
  ```


# 四、常用样式

## reset.css
  ```css
  html{
    -webkit-text-size-adjust: none;
    -webkit-user-select: none;
    -webkit-touch-callout: none;
    /* font-family: Helvetica; */
  }
  body{
    font-size: 12px;
    font-family: -apple-system, BlinkMacSystemFont, "PingFang SC","Helvetica Neue",STHeiti,"Microsoft Yahei",Tahoma,Simsun,sans-serif;
  }
  body,h1,h2,h3,h4,h5,h6,p,dl,dd,ul,ol,pre,form,input,textarea,th,td,select{
    margin: 0; 
    padding: 0; 
    text-indent: 0;
    font-weight: normal;
  }
  a,button,input,textarea,select{ 
    background: none; 
    outline: none;
    -webkit-appearance: none;
    -webkit-tap-highlight-color: rgba(255,0,0,0); 
  }
  em{
    font-style: normal
  }
  li{
    list-style: none
  }
  a{
    text-decoration: none;
  }
  img{
    border:none; 
    vertical-align: top;
  }
  table{
    border-collapse: collapse;
  }
  textarea{ 
    resize: none; 
    overflow: auto;
  }
  ```


## 媒体查询
  ```css
  /* rem 配置 */
  html{
    font-size: 10px
  }
  @media screen and (min-width:321px) and (max-width:375px){
    html{ font-size: 11px }
  }
  @media screen and (min-width:376px) and (max-width:414px){
    html{ font-size: 12px }
  }
  @media screen and (min-width:415px) and (max-width:639px){
    html{ font-size: 15px }
  }
  @media screen and (min-width:640px) and (max-width:719px){
    html{ font-size: 20px }
  }
  @media screen and (min-width:720px) and (max-width:749px){
    html{ font-size: 22.5px }
  }
  @media screen and (min-width:750px) and (max-width:799px){
    html{ font-size: 23.5px }
  }
  @media screen and (min-width:800px){
    html{ font-size: 25px } 
  }

  /* 竖屏时的样式 */
  @media all and (orientation:portrait){   }

  /* 横屏时的样式 */
  @media all and (orientation:landscape){   }
  ```



## 表单标签
  ```css
  /* input placeholder 出现文本位置偏上 */
  input{
      line-height: normal;  /* PC 端设置 line-height = height */
  }


  /* 输入框 placeholder 的颜色值改变 */
  ::-webkit-input-placeholder {  
      color: #999; 
  }
  :-moz-placeholder {  
      color: #999; 
  }
  ::-moz-placeholder {  
      color: #999; 
  }
  :-ms-input-placeholder {  
      color: #999; 
  }
  input:focus::-webkit-input-placeholder{ 
      color: #999; 
  }


  /* 改变选中内容的背景颜色：字体颜色换成 color 即可 */
  ::selection { 
      background: #FFF; 
      color: #333; 
  } 
  ::-moz-selection { 
      background: #FFF; 
      color: #333; 
  } 
  ::-webkit-selection { 
      background: #FFF; 
      color: #333; 
  } 


  /* 禁用 select 默认下拉箭头 */
  select::-ms-expand {
      display: none;
  }


  /* 禁用 radio 和 checkbox 默认样式 */
  input[type=radio]::-ms-check, 
  input[type=checkbox]::-ms-check
  {
      display: none;
  }


  /* 禁用表单输入框默认清除按钮 */

  input[type=text]::-ms-clear,
  input[type=tel]::-ms-clear,
  input[type=number]::-ms-clear
  {
      display: none;
  }


  /* 重置默认外观 */
  input, select { 
      /* 清除默认内阴影 */
      -webkit-appearance:none; 
      appearance: none; 
  }


  /* 禁止winphone默认触摸事件 (e.preventDefault无效) */
  html{
      -ms-touch-action: none;
  }


  /* 解决 -webkit-user-select:none 导致 input/textarea 无法输入 */
  * {
      -webkit-box-sizing: border-box;
      -moz-box-sizing: border-box;
      box-sizing: border-box;
      /* 当用户点击 iOS Safari 的链接或 Js 的可点击元素时，覆盖显示的高亮颜色 */
      -webkit-tap-highlight-color: transparent; 
      outline: none;
  }
  *:not(input,textarea) { 
      -webkit-touch-callout: none; 
      /* 触摸并按住触摸目标时，禁止或显示系统默认菜单 */
      -webkit-user-select: none; 
  }
  ```


## 1px border
  ```css
  .box {
      width: 100px;
      height: 100px;
      margin: 10px;
      position: relative;
      /* border: 1px solid red; */
  }
  .box:before {
      content: '';
      position: absolute;
      transform-origin: 0 0;
      top: 0;
      left: 0;
      width: 200%;
      height: 200%;
      border: 1px solid red;
      transform: scale(.5);
  }
  ```


## 其它样式
  ```css
  /* 开启硬件加速，解决页面闪白，保证动画流畅 */
  div{ 
      transform: translate3d(0, 0, 0);
  }


  /* 禁用长按选中、复制文本功能 */
  * {
      /* 触摸时禁用显示系统默认菜单 */
      -webkit-touch-callout: none;   
      /* 文本不能被选择 */
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
  }


  /* 取消 a 标签在移动端点击时的蓝色 */
  a{
      -webkit-tap-highlight-color: rgba(255, 255, 255, 0);
      -webkit-user-select: none;
      -moz-user-focus: none;
      -moz-user-select: none;
  }


  /* 使用图片作为 a 的点击按钮时，触发 touchstart 时总有一个灰色背景 */
  a,a:hover,a:active,a:visited,a:link,a:focus{
      -webkit-tap-highlight-color:rgba(0,0,0,0);
      -webkit-tap-highlight-color: transparent;
      outline:none;
      background: none;
      text-decoration: none;
  }


  /* 
   * 模拟按钮 hover 效果
   *
   * :active 伪类样式在移动端失效，兼容处理方案如下 
   *     body ontouchstart = "fn"`
   *     document.addEventListener("touchstart", fn, false)`
   * */
  .btn-blue {
      display: block;
      height: 42px;
      line-height: 42px;
      text-align: center;
      border-radius: 4px;
      font-size: 18px;
      color: #FFF;
      background-color: #4185F3;
  }
  .btn-blue:active{
      background-color: #357AE8;
  }


  /*
      同等比例的图片在 PC 端很清楚，但在手机上有些设备会模糊。这是因为手机分辨率太小，
      解决方案是使用元素宽高两倍的背景图而非 img 标签
  */
  div{
      background: url(..//images/icon.png) no-repeat center center;
      -webkit-background-size: 50px 50px;
      background-size: 50px 50px;
      display: inline-block; 

      background-size: contain;
      /* 或  width: 100%;  height: 50px; */
  }


  /* overflow: scroll 时上下拉动滚动条时卡顿、慢 */
  body {
    /* 法一： CSS3新属性 */
    -webkit-overflow-scrolling: touch;

    /* 法二 */
    overflow-x: hidden;  
    
    /* 法三：去掉 body/html 的 height: 100%  */
  }


  /* IOS 滚动不平滑的问题 */
  div{
      /* 手指移开触摸屏滚动一段时间 */
      -webkit-overflow-scrolling: touch;  

      /* 手指移开触摸屏立即停止滚动 */
      -webkit-overflow-scrolling: auto;   
  }
  ```


# 五、优化方案

  * 不滥用 Float：渲染页面时计算量比较大
  * 不滥用 Web 字体：需要下载、解析、重绘当前页面
  * 不声明过多的 Font-size：会影响 CSS 树的效率
  * 减少重绘和回流
    * 减少 drawImage
    * 避免不必要的 DOM 操作
    * 避免使用 document.write
    * 尽量改变 class 而不是 Style
  * 动画优化
    * 尽量使用 CSS3 动画：5 个以内的元素时
    * 适当使用 Canvas 动画：5 个以上元素时
    * 合理使用 requestAnimationFrame 动画代替 setTimeout
  * GPU 加速
    * 注意过渡使用会引发手机过耗电增加
    * 触发 GPU 渲染：transitions、3D transforms、Opacity、Canvas、WebGL、Video
    

  <div align="center"> 
    ![移动端优化](/images/mobile/optimization.png) 
  </div>


 





