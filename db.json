{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/Staticfile","path":"Staticfile","modified":1,"renderable":0},{"_id":"source/images/js/binary-link.png","path":"images/js/binary-link.png","modified":1,"renderable":0},{"_id":"source/images/js/domNodes.png","path":"images/js/domNodes.png","modified":1,"renderable":0},{"_id":"source/images/js/link-list.png","path":"images/js/link-list.png","modified":1,"renderable":0},{"_id":"source/images/js/near-matrix.png","path":"images/js/near-matrix.png","modified":1,"renderable":0},{"_id":"source/images/js/near-table.png","path":"images/js/near-table.png","modified":1,"renderable":0},{"_id":"source/images/js/relate-matrix.png","path":"images/js/relate-matrix.png","modified":1,"renderable":0},{"_id":"source/images/nodejs/node-framework.png","path":"images/nodejs/node-framework.png","modified":1,"renderable":0},{"_id":"source/images/mobile/mode.png","path":"images/mobile/mode.png","modified":1,"renderable":0},{"_id":"source/images/vue/vue-temp.png","path":"images/vue/vue-temp.png","modified":1,"renderable":0},{"_id":"source/images/vue/vue-render-2.png","path":"images/vue/vue-render-2.png","modified":1,"renderable":0},{"_id":"source/images/vue/vuex_base.png","path":"images/vue/vuex_base.png","modified":1,"renderable":0},{"_id":"source/images/mobile/media.png","path":"images/mobile/media.png","modified":1,"renderable":0},{"_id":"source/images/web/browerRender.png","path":"images/web/browerRender.png","modified":1,"renderable":0},{"_id":"source/images/web/browserCom.png","path":"images/web/browserCom.png","modified":1,"renderable":0},{"_id":"source/images/web/domain.png","path":"images/web/domain.png","modified":1,"renderable":0},{"_id":"source/images/web/git_work.png","path":"images/web/git_work.png","modified":1,"renderable":0},{"_id":"source/images/web/http_req.png","path":"images/web/http_req.png","modified":1,"renderable":0},{"_id":"source/images/web/login.png","path":"images/web/login.png","modified":1,"renderable":0},{"_id":"source/images/vue/vue_bing.png","path":"images/vue/vue_bing.png","modified":1,"renderable":0},{"_id":"source/images/web/mvc.png","path":"images/web/mvc.png","modified":1,"renderable":0},{"_id":"source/images/web/mvp.png","path":"images/web/mvp.png","modified":1,"renderable":0},{"_id":"source/images/web/mvvm.png","path":"images/web/mvvm.png","modified":1,"renderable":0},{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":1,"renderable":1},{"_id":"themes/next/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/favicon-16.ico","path":"images/favicon-16.ico","modified":1,"renderable":1},{"_id":"themes/next/source/images/favicon-32.ico","path":"images/favicon-32.ico","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/chuang.png","path":"images/chuang.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/logo.svg","path":"images/logo.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/quote-l.svg","path":"images/quote-l.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/searchicon.png","path":"images/searchicon.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/loading.gif","path":"images/loading.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/placeholder.gif","path":"images/placeholder.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/quote-r.svg","path":"images/quote-r.svg","modified":1,"renderable":1},{"_id":"source/images/js/binary-order.png","path":"images/js/binary-order.png","modified":1,"renderable":0},{"_id":"source/images/js/link-opration.png","path":"images/js/link-opration.png","modified":1,"renderable":0},{"_id":"source/images/js/regExp.png","path":"images/js/regExp.png","modified":1,"renderable":0},{"_id":"source/images/nodejs/egg-framework.png","path":"images/nodejs/egg-framework.png","modified":1,"renderable":0},{"_id":"source/images/nodejs/node-uploadFile.png","path":"images/nodejs/node-uploadFile.png","modified":1,"renderable":0},{"_id":"source/images/vue/vue-special.png","path":"images/vue/vue-special.png","modified":1,"renderable":0},{"_id":"source/images/vue/vue-ssr.png","path":"images/vue/vue-ssr.png","modified":1,"renderable":0},{"_id":"source/images/web/ajax-process.png","path":"images/web/ajax-process.png","modified":1,"renderable":0},{"_id":"source/images/web/promise.png","path":"images/web/promise.png","modified":1,"renderable":0},{"_id":"source/images/web/mtv.png","path":"images/web/mtv.png","modified":1,"renderable":0},{"_id":"source/images/threejs/texture-map.png","path":"images/threejs/texture-map.png","modified":1,"renderable":0},{"_id":"themes/next/source/js/src/bootstrap.js","path":"js/src/bootstrap.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/algolia-search.js","path":"js/src/algolia-search.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/clicklove.js","path":"js/src/clicklove.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/clipboard.js","path":"js/src/clipboard.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/affix.js","path":"js/src/affix.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/clipboard.min.js","path":"js/src/clipboard.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/exturl.js","path":"js/src/exturl.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/js.cookie.js","path":"js/src/js.cookie.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/post-details.js","path":"js/src/post-details.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/motion.js","path":"js/src/motion.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/scroll-cookie.js","path":"js/src/scroll-cookie.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/utils.js","path":"js/src/utils.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/scrollspy.js","path":"js/src/scrollspy.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/canvas-nest/LICENSE","path":"lib/canvas-nest/LICENSE","modified":1,"renderable":1},{"_id":"themes/next/source/lib/canvas-nest/README.md","path":"lib/canvas-nest/README.md","modified":1,"renderable":1},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest-nomobile.min.js","path":"lib/canvas-nest/canvas-nest-nomobile.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","path":"lib/font-awesome/HELP-US-OUT.txt","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/bower.json","path":"lib/font-awesome/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest.min.js","path":"lib/canvas-nest/canvas-nest.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/needsharebutton/LICENSE","path":"lib/needsharebutton/LICENSE","modified":1,"renderable":1},{"_id":"themes/next/source/lib/needsharebutton/README.md","path":"lib/needsharebutton/README.md","modified":1,"renderable":1},{"_id":"themes/next/source/lib/needsharebutton/needsharebutton.js","path":"lib/needsharebutton/needsharebutton.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/needsharebutton/needsharebutton.css","path":"lib/needsharebutton/needsharebutton.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-big-counter.min.css","path":"lib/pace/pace-theme-big-counter.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/LICENSE","path":"lib/pace/LICENSE","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/README.md","path":"lib/pace/README.md","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-bounce.min.css","path":"lib/pace/pace-theme-bounce.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-circle.min.css","path":"lib/pace/pace-theme-center-circle.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-barber-shop.min.css","path":"lib/pace/pace-theme-barber-shop.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-simple.min.css","path":"lib/pace/pace-theme-center-simple.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-fill-left.min.css","path":"lib/pace/pace-theme-fill-left.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-flash.min.css","path":"lib/pace/pace-theme-flash.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-loading-bar.min.css","path":"lib/pace/pace-theme-loading-bar.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-mac-osx.min.css","path":"lib/pace/pace-theme-mac-osx.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-minimal.min.css","path":"lib/pace/pace-theme-minimal.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace.min.js","path":"lib/pace/pace.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-corner-indicator.min.css","path":"lib/pace/pace-theme-corner-indicator.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-atom.min.css","path":"lib/pace/pace-theme-center-atom.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/reading_progress/LICENSE","path":"lib/reading_progress/LICENSE","modified":1,"renderable":1},{"_id":"themes/next/source/lib/reading_progress/package.json","path":"lib/reading_progress/package.json","modified":1,"renderable":1},{"_id":"themes/next/source/lib/reading_progress/reading_progress.min.js","path":"lib/reading_progress/reading_progress.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/reading_progress/README.md","path":"lib/reading_progress/README.md","modified":1,"renderable":1},{"_id":"themes/next/source/lib/reading_progress/reading_progress.js","path":"lib/reading_progress/reading_progress.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-radar.min.css","path":"lib/pace/pace-theme-center-radar.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","path":"lib/velocity/velocity.ui.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":1,"renderable":1},{"_id":"source/images/nodejs/egg-run.png","path":"images/nodejs/egg-run.png","modified":1,"renderable":0},{"_id":"source/images/web/img_upload.png","path":"images/web/img_upload.png","modified":1,"renderable":0},{"_id":"themes/next/source/lib/jquery/index.js","path":"lib/jquery/index.js","modified":1,"renderable":1},{"_id":"source/images/mobile/optimization.png","path":"images/mobile/optimization.png","modified":1,"renderable":0},{"_id":"source/images/web/git_order.png","path":"images/web/git_order.png","modified":1,"renderable":0},{"_id":"source/images/web/js-run.png","path":"images/web/js-run.png","modified":1,"renderable":0},{"_id":"themes/next/source/js/src/schemes/muse.js","path":"js/src/schemes/muse.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/schemes/pisces.js","path":"js/src/schemes/pisces.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","path":"lib/font-awesome/css/font-awesome.css.map","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","path":"lib/font-awesome/css/font-awesome.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","path":"lib/font-awesome/css/font-awesome.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","path":"lib/ua-parser-js/dist/ua-parser.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","path":"lib/ua-parser-js/dist/ua-parser.pack.js","modified":1,"renderable":1},{"_id":"source/images/vue/vue-render-1.png","path":"images/vue/vue-render-1.png","modified":1,"renderable":0},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","path":"lib/font-awesome/fonts/fontawesome-webfont.woff2","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.js","path":"lib/velocity/velocity.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","path":"lib/font-awesome/fonts/fontawesome-webfont.woff","modified":1,"renderable":1},{"_id":"source/images/web/technology.png","path":"images/web/technology.png","modified":1,"renderable":0},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","path":"lib/font-awesome/fonts/fontawesome-webfont.eot","modified":1,"renderable":1},{"_id":"source/images/vue/vue_life.png","path":"images/vue/vue_life.png","modified":1,"renderable":0},{"_id":"source/images/js/bom.png","path":"images/js/bom.png","modified":1,"renderable":0}],"Cache":[{"_id":"source/Staticfile","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1553703592482},{"_id":"source/.DS_Store","hash":"3a36527d7d3c1c89861d3598987ddd1dfa24ec96","modified":1557509204548},{"_id":"themes/next/.all-contributorsrc","hash":"e32dc4075e304af04b98d0726d489081bea722c0","modified":1547914976000},{"_id":"themes/next/.bowerrc","hash":"3228a58ed0ece9f85e1e3136352094080b8dece1","modified":1547914976000},{"_id":"themes/next/.DS_Store","hash":"e573f58305fe00cbdfe7b7ab0dd0264cbf776a78","modified":1555695212519},{"_id":"themes/next/.editorconfig","hash":"792fd2bd8174ece1a75d5fd24ab16594886f3a7f","modified":1547914976000},{"_id":"themes/next/.eslintrc.json","hash":"cc5f297f0322672fe3f684f823bc4659e4a54c41","modified":1547914976000},{"_id":"themes/next/.stylintrc","hash":"b28e24704a5d8de08346c45286574c8e76cc109f","modified":1547914976000},{"_id":"themes/next/.travis.yml","hash":"3d1dc928c4a97933e64379cfde749dedf62f252c","modified":1547914976000},{"_id":"themes/next/LICENSE.md","hash":"18144d8ed58c75af66cb419d54f3f63374cd5c5b","modified":1547914976000},{"_id":"themes/next/_config.yml","hash":"ee05f4764b457542bd722b0e895b5ebd426efb47","modified":1551625666000},{"_id":"themes/next/bower.json","hash":"09628558259cf990fac43ed1f5ef9edae73f124b","modified":1547914976000},{"_id":"themes/next/README.md","hash":"b4f780a96b0e5d3737eb93bc00da6de91f042c4b","modified":1547914976000},{"_id":"themes/next/crowdin.yml","hash":"e026078448c77dcdd9ef50256bb6635a8f83dca6","modified":1547914976000},{"_id":"themes/next/gulpfile.coffee","hash":"48d2f9fa88a4210308fc41cc7d3f6d53989f71b7","modified":1547914976000},{"_id":"themes/next/package.json","hash":"c791b45d1e6fde11a1e1e11ba5a6ced1f5ba0fce","modified":1547914976000},{"_id":"source/_posts/10-web通信.md","hash":"f86155d609927879f6f66d19fb379acfcd3148f7","modified":1557508421774},{"_id":"source/_posts/.DS_Store","hash":"f733170aaa4296f0457a2db271122409d95cc970","modified":1557508335906},{"_id":"source/_data/next.yml","hash":"33caed1892ccec1f57c30243e724c6c93b2a2cad","modified":1555865951518},{"_id":"source/_posts/1-hexo博客.md","hash":"d37487ade103dca9a4afbe657ae01d17b1abe58a","modified":1555596266666},{"_id":"source/_posts/11-web编程.md","hash":"6e83f31efa9abc0b726eef344e6b3aa6ff74701e","modified":1557508427728},{"_id":"source/_posts/14-vue全家桶.md","hash":"b64b346dd0aa4fb798f3dc702d9bb36dc0d880a2","modified":1557508781084},{"_id":"source/_posts/12-ES语法.md","hash":"ad42eb4b7a7e8420bff85e6a9789cc719d9c1180","modified":1555185024203},{"_id":"source/_posts/15-vue组件.md","hash":"8400dc013f952c4dc984585219bb77359282fc41","modified":1557508874060},{"_id":"source/_posts/13-vue基础.md","hash":"dd5ece07d9239430fbabb96f57ba53527d3f6fd9","modified":1557508746879},{"_id":"source/_posts/16-vue项目.md","hash":"19979b608ce4847715cec73ff4dda3c5b79bb0c4","modified":1555347931604},{"_id":"source/_posts/2-web开发.md","hash":"d252780c8e0c7de22f8e0441f74c3ad809a417ff","modified":1557508248841},{"_id":"source/_posts/18-threejs纹理.md","hash":"bd357ed9ff77a14faa735913ad7520d176ec3b62","modified":1557508966831},{"_id":"source/_posts/17-threejs.md","hash":"371196dd72f03c92040e0d8f7c84ae98ec76bba8","modified":1555347917192},{"_id":"source/_posts/22-移动端基础.md","hash":"2b710b794188c746fd672130acde08f8b8bd254d","modified":1557509403811},{"_id":"source/_posts/19-Node基础.md","hash":"d1299f7589d1ac20d7d6839c3db8319f7b8a293e","modified":1557509072302},{"_id":"source/_posts/4-css预处理.md","hash":"17b18499ee66fe65ffe112ea2bb67234b3d2a7ed","modified":1554560443185},{"_id":"source/_posts/3-web工具.md","hash":"80056cb703a54637c7ca3664fdee488716a7cc4e","modified":1557508272001},{"_id":"source/_posts/20-Node框架.md","hash":"ed2632f90bed0d2602775b3c7fb11bf6af25bcff","modified":1557509159579},{"_id":"source/_posts/21-HTML5新特性.md","hash":"094a759a760a22c838b40f5c1d59eaa9105ef687","modified":1557509340345},{"_id":"source/_posts/5-html和css.md","hash":"36a38c24bf4c9e786e7f400c3867c06600149989","modified":1555253375251},{"_id":"source/_posts/9-js数据结构.md","hash":"67a57b9388fbaa07749b77f19596524e8793fe69","modified":1557508516101},{"_id":"source/_posts/7-jquery基础.md","hash":"0fcdd6b27781b694090d5f8af95b8836427fff5b","modified":1554560375383},{"_id":"source/_posts/6-js基础.md","hash":"048ad996782e853c740f3225c29230c8c9d05e54","modified":1557508503885},{"_id":"source/_posts/8-js数据.md","hash":"167a321b601e78fc78ff61fc3875d3396cc8c20e","modified":1555600811051},{"_id":"source/categories/index.md","hash":"e13062e34ed9c7028e5fbdf46206b409b530fab3","modified":1547916854000},{"_id":"source/archives/index.md","hash":"dbdd6394d5b4a0501247275af1904350c0944222","modified":1547916896000},{"_id":"source/tags/index.md","hash":"87d10890d4914a786e3b48b612d1eb4f489abf38","modified":1547916776000},{"_id":"source/images/.DS_Store","hash":"69806170f697069145c3ab361cc4455bd0b49f59","modified":1557509204548},{"_id":"themes/next/docs/AGPL3.md","hash":"0d2b8c5fa8a614723be0767cc3bca39c49578036","modified":1547914976000},{"_id":"themes/next/docs/AUTHORS.md","hash":"7b24be2891167bdedb9284a682c2344ec63e50b5","modified":1547914976000},{"_id":"themes/next/docs/ALGOLIA-SEARCH.md","hash":"141e989844d0b5ae2e09fb162a280715afb39b0d","modified":1547914976000},{"_id":"themes/next/docs/LICENSE.txt","hash":"368bf2c29d70f27d8726dd914f1b3211cae4bbab","modified":1547914976000},{"_id":"themes/next/docs/LEANCLOUD-COUNTER-SECURITY.md","hash":"212a36d57495990b5f56e46ca8dce1d76c199660","modified":1547914976000},{"_id":"themes/next/docs/DATA-FILES.md","hash":"8e1962dd3e1b700169b3ae5bba43992f100651ce","modified":1547914976000},{"_id":"themes/next/docs/UPDATE-FROM-5.1.X.md","hash":"ad57c168d12ba01cf144a1ea0627b2ffd1847d3e","modified":1547914976000},{"_id":"themes/next/docs/INSTALLATION.md","hash":"2bbdd6c1751b2b42ce9b9335da420c6026a483e9","modified":1547914976000},{"_id":"themes/next/languages/en.yml","hash":"c540c3a0d7db2d4239293c8783881962640b6c34","modified":1547914976000},{"_id":"themes/next/languages/de.yml","hash":"fb478c5040a4e58a4c1ad5fb52a91e5983d65a3a","modified":1547914976000},{"_id":"themes/next/docs/MATH.md","hash":"e6023505dcccaef0b856102543585a13fc6af0b1","modified":1547914976000},{"_id":"themes/next/languages/default.yml","hash":"c540c3a0d7db2d4239293c8783881962640b6c34","modified":1547914976000},{"_id":"themes/next/languages/fr.yml","hash":"0162a85ae4175e66882a9ead1249fedb89200467","modified":1547914976000},{"_id":"themes/next/languages/id.yml","hash":"e7fb582e117a0785036dcdbb853a6551263d6aa6","modified":1547914976000},{"_id":"themes/next/languages/ja.yml","hash":"e331b15b1fda0f2285d25853f834682ab8dc3c39","modified":1547914976000},{"_id":"themes/next/languages/nl.yml","hash":"bb9ce8adfa5ee94bc6b5fac6ad24ba4605d180d3","modified":1547914976000},{"_id":"themes/next/languages/it.yml","hash":"62ef41d0a9a3816939cb4d93a524e6930ab9c517","modified":1547914976000},{"_id":"themes/next/languages/ko.yml","hash":"fae155018ae0efdf68669b2c7dd3f959c2e45cc9","modified":1547914976000},{"_id":"themes/next/languages/pt-BR.yml","hash":"bfc80c8a363fa2e8dde38ea2bc85cd19e15ab653","modified":1547914976000},{"_id":"themes/next/languages/pt.yml","hash":"3cb51937d13ff12fcce747f972ccb664840a9ef3","modified":1547914976000},{"_id":"themes/next/languages/ru.yml","hash":"db0644e738d2306ac38567aa183ca3e859a3980f","modified":1547914976000},{"_id":"themes/next/languages/tr.yml","hash":"c5f0c20743b1dd52ccb256050b1397d023e6bcd9","modified":1547914976000},{"_id":"themes/next/languages/uk.yml","hash":"1eb59e581568da9a81d6e20541b4ada5fc1c55c0","modified":1547914976000},{"_id":"themes/next/languages/vi.yml","hash":"8da921dd8335dd676efce31bf75fdd4af7ce6448","modified":1547914976000},{"_id":"themes/next/languages/zh-CN.yml","hash":"fbbf3a0b664ae8e927c700b0a813692b94345156","modified":1547914976000},{"_id":"themes/next/languages/zh-HK.yml","hash":"7903b96912c605e630fb695534012501b2fad805","modified":1547914976000},{"_id":"themes/next/languages/zh-TW.yml","hash":"6e6d2cd8f4244cb1b349b94904cb4770935acefd","modified":1547914976000},{"_id":"themes/next/layout/_layout.swig","hash":"9aff46d19fb9ae9ee282d094710cfa10f8bd56c2","modified":1549687394000},{"_id":"themes/next/layout/category.swig","hash":"5d955284a42f802a48560b4452c80906a5d1da02","modified":1547914976000},{"_id":"themes/next/layout/archive.swig","hash":"2b6450c6b6d2bcbcd123ad9f59922a5e323d77a5","modified":1547914976000},{"_id":"themes/next/layout/index.swig","hash":"c2a3896c64e96790edc10426ef586b6186a87f46","modified":1547914976000},{"_id":"themes/next/layout/page.swig","hash":"2d0e80e8a4dcba665704882b9dc5858c187acc31","modified":1547914976000},{"_id":"themes/next/scripts/merge-configs.js","hash":"33afe97284d34542015d358a720823feeebef120","modified":1547914976000},{"_id":"themes/next/layout/post.swig","hash":"f74929fd792541916eb25c2addfb35431be071ba","modified":1547914976000},{"_id":"themes/next/scripts/merge.js","hash":"9130dabe6a674c54b535f322b17d75fe6081472f","modified":1547914976000},{"_id":"themes/next/layout/schedule.swig","hash":"3268dd3d90d8b0e142cfa1a2ebb23355baeda148","modified":1547914976000},{"_id":"themes/next/layout/tag.swig","hash":"ba402ce8fd55e80b240e019e8d8c48949b194373","modified":1547914976000},{"_id":"themes/next/source/.DS_Store","hash":"697d112c55627f0b699289a3497ab3cc2fbacd8f","modified":1555695217223},{"_id":"themes/next/test/.jshintrc","hash":"19f93d13d1689fe033c82eb2d5f3ce30b6543cc0","modified":1547914976000},{"_id":"themes/next/test/intern.js","hash":"11fa8a4f5c3b4119a179ae0a2584c8187f907a73","modified":1547914976000},{"_id":"themes/next/test/helpers.js","hash":"a1f5de25154c3724ffc24a91ddc576cdbd60864f","modified":1547914976000},{"_id":"themes/next/source/fonts/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1547914976000},{"_id":"source/images/js/.DS_Store","hash":"b9f115553c28465b752b69174ef0a5c14e826f29","modified":1557508471314},{"_id":"source/images/js/binary-link.png","hash":"7f9fb5ecc321c54cff3e1176bcde5719e36273e2","modified":1554710528327},{"_id":"source/images/js/domNodes.png","hash":"78bdd41d329434583097b5b6c965d9744f4e03ad","modified":1552494808000},{"_id":"source/images/js/link-list.png","hash":"27bae8814df766f52e6eccb7dd168ef92d5cfd1d","modified":1554689219832},{"_id":"source/images/js/near-matrix.png","hash":"d7071393b053d5b8f7311995e730d69414c6e7e5","modified":1554714126423},{"_id":"source/images/js/near-table.png","hash":"ea4ec4399a8b2936c246a7e3264058f050190e71","modified":1554714135367},{"_id":"source/images/mobile/.DS_Store","hash":"b672c9daecb7c2122042c180d64be9749c662714","modified":1557509560358},{"_id":"source/images/js/relate-matrix.png","hash":"b4eb7635cb52536af4777401ab634c84ad7259e6","modified":1554714143206},{"_id":"source/images/nodejs/.DS_Store","hash":"ab256fb692bad0b065938474ccce4e51b9264a6b","modified":1557508988719},{"_id":"source/images/nodejs/node-framework.png","hash":"ebe65a55661cfa19c544a514e3d8849e4a1e105b","modified":1555349013367},{"_id":"source/images/threejs/.DS_Store","hash":"2908a16dd211e88a68353edc0988afe16856da01","modified":1557508931514},{"_id":"source/images/mobile/mode.png","hash":"c2d18740f807ed21b6f54ad1cf6f7c87c79ebe0d","modified":1557504850144},{"_id":"source/images/vue/.DS_Store","hash":"a6b6992af6040a08674d23cfa0c490be4f0b4236","modified":1557508610703},{"_id":"source/images/vue/vue-temp.png","hash":"1e989a8e66c4f058bb42153a39c12d33f5fa324c","modified":1554116375114},{"_id":"source/images/vue/vue-render-2.png","hash":"270a254496c4befcd0ead48d654c90f7f6461beb","modified":1555092780871},{"_id":"source/images/vue/vuex_base.png","hash":"8ebe50e659c488a033b8df4108f95cacd25b7a8a","modified":1555236652694},{"_id":"source/images/mobile/media.png","hash":"92d1cf2444b9d0a3352c853e920935eb8d7b4129","modified":1555470535497},{"_id":"source/images/web/browerRender.png","hash":"28ceba35df709d3e58e683d10d33c6e5856c5415","modified":1554049925459},{"_id":"source/images/web/browserCom.png","hash":"d48dd049bf0f7bc5dcacc3985a07f69071ed5871","modified":1554052387495},{"_id":"source/images/web/domain.png","hash":"d851b6dbf73e24fa71a22b82e18699e8005eea85","modified":1554046056705},{"_id":"source/images/web/git_work.png","hash":"a30adbbf4cacac1c9d46560fc884de2d9aca0d55","modified":1551011880000},{"_id":"source/images/web/http_req.png","hash":"630e068a8c94f2aeb1c4d2a6255b606112547a22","modified":1554045638942},{"_id":"source/images/web/login.png","hash":"a5f29720e6e95b071a9868284c7e1540941ee3c6","modified":1519830502000},{"_id":"source/images/vue/vue_bing.png","hash":"b1a7d1de0b0c2846fa51469529ffe7eb14f3be80","modified":1555002441949},{"_id":"source/images/web/.DS_Store","hash":"0afa162956a3bc61af5f37b2d05bf63898c4d47f","modified":1557508149373},{"_id":"source/images/web/mvc.png","hash":"8efd3aa82d8d647ca45a9bfbc5bf992502b67b52","modified":1551633044000},{"_id":"source/images/web/mvp.png","hash":"c514ebe31e3437c24403a1f779eb10d1dfdbe25d","modified":1551632668000},{"_id":"source/images/web/mvvm.png","hash":"56a2a71cfd13ebb9f2acfdd73cae4683ce165494","modified":1551633344000},{"_id":"themes/next/docs/ru/DATA-FILES.md","hash":"d6d20f60f77a76c77f8e65d0c9adbd79d0274557","modified":1547914976000},{"_id":"themes/next/docs/ru/UPDATE-FROM-5.1.X.md","hash":"b1dd18d9b890b21718883ea1832e7e02a773104a","modified":1547914976000},{"_id":"themes/next/docs/ru/README.md","hash":"953deb732e0b3b22c423122a189d6847d908c4b8","modified":1547914976000},{"_id":"themes/next/docs/ru/INSTALLATION.md","hash":"6c5d69e94961c793da156217ecf1179e868d7ba1","modified":1547914976000},{"_id":"themes/next/docs/zh-CN/CONTRIBUTING.md","hash":"bd2c955d9b7b1b45bd74a4536717d547e03fcde3","modified":1547914976000},{"_id":"themes/next/docs/zh-CN/ALGOLIA-SEARCH.md","hash":"6855402e2ef59aae307e8bd2a990647d3a605eb8","modified":1547914976000},{"_id":"themes/next/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"a45a791b49954331390d548ac34169d573ea5922","modified":1547914976000},{"_id":"themes/next/docs/zh-CN/DATA-FILES.md","hash":"f3eec572a7d83542e2710a7404082014aaa1a5e7","modified":1547914976000},{"_id":"themes/next/docs/zh-CN/INSTALLATION.md","hash":"b19a6e0ae96eb7c756fb5b1ba03934c7f9cbb3c3","modified":1547914976000},{"_id":"themes/next/docs/zh-CN/LEANCLOUD-COUNTER-SECURITY.md","hash":"115ffbde2b3ce01ef1f8c2b3833e6f6794650132","modified":1547914976000},{"_id":"themes/next/docs/zh-CN/README.md","hash":"15e55eb77616500fa4c64982d6bad9ac17a46e2a","modified":1547914976000},{"_id":"themes/next/docs/zh-CN/MATH.md","hash":"b76ccbc658024e86639cfa5f8a3817647fc8d651","modified":1547914976000},{"_id":"themes/next/docs/zh-CN/UPDATE-FROM-5.1.X.md","hash":"5da70d7fa0c988a66a469b9795d33d471a4a4433","modified":1547914976000},{"_id":"themes/next/layout/_custom/head.swig","hash":"9e1b9666efa77f4cf8d8261bcfa445a9ac608e53","modified":1547914976000},{"_id":"themes/next/layout/_custom/header.swig","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1547914976000},{"_id":"themes/next/layout/_custom/sidebar.swig","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1547914976000},{"_id":"themes/next/layout/_macro/passage-end-tag.swig","hash":"ea03219ded496be93d2af0ef4bbe613d8aa657e4","modified":1555180389936},{"_id":"themes/next/layout/_partials/comments.swig","hash":"07340f3a4c8d8a9dd491d1eba18d985ecc0855a2","modified":1547914976000},{"_id":"themes/next/layout/_macro/post-collapse.swig","hash":"89b0a0e64637bf5b0cfea0a23642df3d95eedfa4","modified":1547914976000},{"_id":"themes/next/layout/_partials/footer.swig","hash":"6cc619d6b72a439b92ae0c5ddee244933599d76f","modified":1548520834000},{"_id":"themes/next/layout/_macro/post.swig","hash":"b21ad623594e4dc38c293c18f2a718e3e9c2778c","modified":1555173981152},{"_id":"themes/next/layout/_macro/sidebar.swig","hash":"a1ded7ba92354ed55ae20a0b6bcc15bbb4b801c2","modified":1547914976000},{"_id":"themes/next/layout/_partials/github-banner.swig","hash":"a6ed0b4d6140bdfc5ea4995bb13d969cce50e74a","modified":1547914976000},{"_id":"themes/next/layout/_partials/pagination.swig","hash":"dbe321bcf3cf45917cc11a3e3f50d8572bac2c70","modified":1547914976000},{"_id":"themes/next/layout/_partials/post-edit.swig","hash":"06dac109504812b63766a80ede9ddacbd42d227d","modified":1547914976000},{"_id":"themes/next/layout/_scripts/boostrap.swig","hash":"d01881f8056203c4b6920328db8c2ae8fa662a08","modified":1547914976000},{"_id":"themes/next/layout/_scripts/commons.swig","hash":"d66bc7ec3cc03f60fcc7d555368a5b9b010f7f11","modified":1547914976000},{"_id":"themes/next/layout/_scripts/noscript.swig","hash":"edaff4766e0c05fd5c889d9dd32884d376bef9d9","modified":1547914976000},{"_id":"themes/next/layout/_scripts/vendors.swig","hash":"c4c58ea2bd4cf10372a5e46dbec1b9a2e0e69f0f","modified":1547914976000},{"_id":"themes/next/layout/_third-party/bookmark.swig","hash":"10b61a8bac671e375916a4d234c120117098a78f","modified":1547914976000},{"_id":"themes/next/layout/_third-party/copy-code.swig","hash":"4148001b0b3f8a29b13ba5cd3f6f636c9cb260b0","modified":1547914976000},{"_id":"themes/next/layout/_third-party/exturl.swig","hash":"d359e638a86bd9664101c48e9344f21ec96e6a15","modified":1547914976000},{"_id":"themes/next/layout/_third-party/pangu.swig","hash":"c28f9dc96ab735daeb7f599f86470aa5a83c03cf","modified":1547914976000},{"_id":"themes/next/layout/_third-party/pdf.swig","hash":"5453d76e00bfcd1d732fc5f41828a90eb681f645","modified":1547914976000},{"_id":"themes/next/layout/_third-party/needsharebutton.swig","hash":"2c4a66be4677d3e4dec3f169ac8a769098dad1fe","modified":1547914976000},{"_id":"themes/next/layout/_third-party/rating.swig","hash":"cbe40cb67dad15ade967b0f396c1a95b6871f76a","modified":1547914976000},{"_id":"themes/next/layout/_third-party/schedule.swig","hash":"272c46f03766ea0c169163342bb98f09f561cf4c","modified":1547914976000},{"_id":"themes/next/layout/_third-party/scroll-cookie.swig","hash":"1b250c1b7945cb1029b9e855edb09854f7c8250a","modified":1547914976000},{"_id":"themes/next/scripts/helpers/engine.js","hash":"60eb1554456d9d0e5afc4a2d16f1580a0aa02da8","modified":1547914976000},{"_id":"themes/next/scripts/helpers/next-url.js","hash":"15582e823d228c0b2288543c1eb460c40afad29b","modified":1547914976000},{"_id":"themes/next/scripts/tags/button.js","hash":"08d5dfe05335f57d3e8392a74315766dafa52538","modified":1547914976000},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"f13430d9d1c9773b390787c2f046bb1f12a79878","modified":1547914976000},{"_id":"themes/next/scripts/tags/exturl.js","hash":"7ded3e7a78380b32de3e12f156e0978ef5c2890a","modified":1547914976000},{"_id":"themes/next/scripts/tags/full-image.js","hash":"22de989163c4678278c8a112160be6977f570234","modified":1547914976000},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"4775fffa526f1f7b40aa1f1c0a171dbcf5963df7","modified":1547914976000},{"_id":"themes/next/scripts/tags/include-raw.js","hash":"5db59d56f4f4082382bf1c16722e6c383892b0c5","modified":1547914976000},{"_id":"themes/next/scripts/tags/label.js","hash":"76735c88cfba2e53649387a7fa5176706c2d3c0c","modified":1547914976000},{"_id":"themes/next/scripts/tags/note.js","hash":"84ce2d2c0646baafc82083e261b093b1c515f63c","modified":1547914976000},{"_id":"themes/next/scripts/tags/tabs.js","hash":"8b1e9043db8f19ea4a12c473b3f729bd3b5bcb0e","modified":1547914976000},{"_id":"themes/next/source/css/main.styl","hash":"e010ec8ac73268a0f137204c89e0080ab8d59b3d","modified":1547914976000},{"_id":"themes/next/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1547914976000},{"_id":"themes/next/source/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1547914976000},{"_id":"themes/next/source/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1547914976000},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1547914976000},{"_id":"themes/next/source/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1547914976000},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1547914976000},{"_id":"themes/next/source/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1547914976000},{"_id":"themes/next/source/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1547914976000},{"_id":"themes/next/source/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1547914976000},{"_id":"themes/next/source/images/favicon-16.ico","hash":"647c110f236439cce76e1fe29c7d07328b65fa1c","modified":1552327580000},{"_id":"themes/next/source/images/favicon-32.ico","hash":"0565e336ffa0c7012d280fc2e50d1d90388aad5e","modified":1552327558000},{"_id":"themes/next/source/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1547914976000},{"_id":"themes/next/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1547914976000},{"_id":"themes/next/source/images/chuang.png","hash":"95ff6e64e0cd1320998c2a094ca9222151e1ca56","modified":1547943188000},{"_id":"themes/next/source/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1547914976000},{"_id":"themes/next/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1547914976000},{"_id":"themes/next/source/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1547914976000},{"_id":"themes/next/source/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1547914976000},{"_id":"themes/next/source/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1547914976000},{"_id":"themes/next/source/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1547914976000},{"_id":"themes/next/source/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1547914976000},{"_id":"source/images/js/binary-order.png","hash":"52155ae4e32a16e3b5065542811c69de27ccba74","modified":1554710517658},{"_id":"source/images/js/link-opration.png","hash":"f12476d4a4da41393529ce2cca49d2aeae91422b","modified":1554359037668},{"_id":"source/images/js/regExp.png","hash":"6993c6a6220ee5624d5fc7199faddee2d22baee7","modified":1552753148000},{"_id":"source/images/nodejs/egg-framework.png","hash":"42852365d9694040b5c51f9a12d0478e28715db2","modified":1555525324291},{"_id":"source/images/nodejs/node-uploadFile.png","hash":"94e88d9a2f951dbf45d71c98364158b3eb294586","modified":1555525295844},{"_id":"source/images/vue/vue-special.png","hash":"8e58d98aa071088e362b2acb0b12d730af37bed2","modified":1553840117360},{"_id":"source/images/vue/vue-ssr.png","hash":"aef85fa88117592aeaa02374835f94783a951516","modified":1553481160259},{"_id":"source/images/web/ajax-process.png","hash":"889f5bdbe06175ab5dd62ce9d571754ddcd81f84","modified":1554837636562},{"_id":"source/images/web/promise.png","hash":"4767c9c9835cfe918a7c47388d69fff864b67c31","modified":1554556332989},{"_id":"source/images/web/mtv.png","hash":"4cca06dc7277cabc3b3fb63f5b72b2e763ea5fb0","modified":1551633086000},{"_id":"themes/next/source/css/_mixins/Mist.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1547914976000},{"_id":"themes/next/source/css/_mixins/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1547914976000},{"_id":"themes/next/source/css/_mixins/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1547914976000},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1547914976000},{"_id":"themes/next/source/css/_variables/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1547914976000},{"_id":"source/images/threejs/texture-map.png","hash":"cc2c67ce43a2114b03e3159da3405a5044c25508","modified":1555345526675},{"_id":"themes/next/layout/_macro/menu/menu-badge.swig","hash":"65c5e585982dae7ae1542cada71858b4ea1f73d6","modified":1547914976000},{"_id":"themes/next/layout/_macro/menu/menu-item.swig","hash":"fb33f499022cd02722f834fcef1a0e193362cfde","modified":1547914976000},{"_id":"themes/next/layout/_partials/head/external-fonts.swig","hash":"2c2e77445ffaa7f08e3f7fc9a13ffb0ed10545f4","modified":1555084634369},{"_id":"themes/next/layout/_partials/head/head.swig","hash":"e402b43982bf079d9a051d4b724b93a677e4c9cb","modified":1557505678714},{"_id":"themes/next/layout/_partials/head/head-unique.swig","hash":"dc53a41196b675268bfd2a944f6258c57ed44e91","modified":1547914976000},{"_id":"themes/next/layout/_partials/header/brand.swig","hash":"58e2e153e8b67e643b24453a1e1cceaae3323647","modified":1547914976000},{"_id":"themes/next/layout/_partials/header/index.swig","hash":"2082f5077551123e695e8afec471c9c44b436acb","modified":1547914976000},{"_id":"themes/next/layout/_partials/header/menu.swig","hash":"fe0614f1c15cf4c6f4bb72afe4a65e10824c9cb0","modified":1547914976000},{"_id":"themes/next/layout/_partials/header/sub-menu.swig","hash":"5adc60100e129c1d0307bdcaa0c7b8e8375a6ea4","modified":1547914976000},{"_id":"themes/next/layout/_partials/page/breadcrumb.swig","hash":"69722be16ce5eae5c027168f9b2fded4776e1b53","modified":1547914976000},{"_id":"themes/next/layout/_partials/page/page-header.swig","hash":"2940df694fff28e8bf71b6546b4162f1e38227db","modified":1547914976000},{"_id":"themes/next/layout/_partials/post/post-copyright.swig","hash":"2f73cc9ffb63534f0b6d8f0e9ee853c1af1b1244","modified":1547914976000},{"_id":"themes/next/layout/_partials/post/post-related.swig","hash":"eea95b785c9c36d28e1839619793f66e89773bee","modified":1547914976000},{"_id":"themes/next/layout/_partials/post/reward.swig","hash":"64d65d9ad0cc94734ac6ded279e2b5dc870a1cab","modified":1547914976000},{"_id":"themes/next/layout/_partials/post/wechat-subscriber.swig","hash":"d63208ee20529450c35de8fe80ef41fffa831dc9","modified":1547914976000},{"_id":"themes/next/layout/_partials/search/localsearch.swig","hash":"957701729b85fb0c5bfcf2fb99c19d54582f91ed","modified":1547914976000},{"_id":"themes/next/layout/_partials/search/index.swig","hash":"a33b29ccbdc2248aedff23b04e0627f435824406","modified":1547914976000},{"_id":"themes/next/layout/_partials/search/swiftype.swig","hash":"a5587bd1f60d35e58618576cec45e662aa44ea1f","modified":1547914976000},{"_id":"themes/next/layout/_partials/search/tinysou.swig","hash":"eefe2388ff3d424694045eda21346989b123977c","modified":1547914976000},{"_id":"themes/next/layout/_partials/share/add-this.swig","hash":"23e23dc0f76ef3c631f24c65277adf7ea517b383","modified":1547914976000},{"_id":"themes/next/layout/_partials/share/baidushare.swig","hash":"6f181cc188ecbe5e607fd989756e470d4cb9765d","modified":1547914976000},{"_id":"themes/next/layout/_partials/share/duoshuo_share.swig","hash":"d5bfb363a1154e6505f0cccbd811fa71db133e3d","modified":1547914976000},{"_id":"themes/next/layout/_scripts/pages/post-details.swig","hash":"c7f2855f19dfdf18aba8c58d55b7489e631ed035","modified":1547914976000},{"_id":"themes/next/layout/_scripts/schemes/gemini.swig","hash":"ffc8e8836714ea79abeb77b75859634615652877","modified":1547914976000},{"_id":"themes/next/layout/_scripts/schemes/mist.swig","hash":"108b157fbd1ac3baaf19ae87234fa8728ab79556","modified":1547914976000},{"_id":"themes/next/layout/_scripts/schemes/muse.swig","hash":"be24f204a515d5211bf3ba98a030e3bf61d4cc16","modified":1547914976000},{"_id":"themes/next/layout/_scripts/schemes/pisces.swig","hash":"94e106755c5fb6f40431b621beeba0bd33877e57","modified":1547914976000},{"_id":"themes/next/layout/_third-party/analytics/analytics-with-widget.swig","hash":"a5723950c343d220270bfd27bd30050eda6c3fb3","modified":1547914976000},{"_id":"themes/next/layout/_third-party/analytics/application-insights.swig","hash":"798d67e4a736613ab899eabe6529091bbcda7850","modified":1547914976000},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.swig","hash":"591b2ccd9713ccb922b9fcf5e278b6de9c5ec30b","modified":1547914976000},{"_id":"themes/next/layout/_third-party/analytics/busuanzi-counter.swig","hash":"617259f6073fd70fd91f02fa11d0f4699034ced9","modified":1548987398000},{"_id":"themes/next/layout/_third-party/analytics/cnzz-analytics.swig","hash":"08cd47ef8572121b7811342d3c9a84a338a18191","modified":1547914976000},{"_id":"themes/next/layout/_third-party/analytics/facebook-sdk.swig","hash":"050ea01f25cfe492be9bb77b409644d623fdf2dc","modified":1547914976000},{"_id":"themes/next/layout/_third-party/analytics/firestore.swig","hash":"fae69a0e1a1d42f7bb44e594a29857d94594698b","modified":1547914976000},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.swig","hash":"866012e74109383c98b31e6062bc735068ac6014","modified":1547914976000},{"_id":"themes/next/layout/_third-party/analytics/growingio.swig","hash":"9e576f12a294b14bd262f59c309a50cbf7003827","modified":1547914976000},{"_id":"themes/next/layout/_third-party/analytics/index.swig","hash":"438c6f5e6665d72f4ea7ee206011d669246f6102","modified":1547914976000},{"_id":"themes/next/layout/_third-party/analytics/lean-analytics.swig","hash":"5ced33d88f0e7c7546b8da7ff096c59bb0207cdf","modified":1547914976000},{"_id":"themes/next/layout/_third-party/analytics/tencent-analytics.swig","hash":"f240a50cd9b627620d9a374a29cf95f0c5e99d7c","modified":1547914976000},{"_id":"themes/next/layout/_third-party/analytics/tencent-mta.swig","hash":"92e04a2b9e0c3df594bc22235d1894e5ad458dfc","modified":1547914976000},{"_id":"themes/next/layout/_third-party/analytics/vkontakte-api.swig","hash":"cbf620cf2a78e3ac736cdd7e768513cfd6946e83","modified":1547914976000},{"_id":"themes/next/layout/_third-party/comments/changyan.swig","hash":"3533167c4295637b91d90f3bae7c651cd128bb6e","modified":1547914976000},{"_id":"themes/next/layout/_third-party/comments/disqus.swig","hash":"3cfeafefc672d9a7704650ebfb2f9d8668b38d9a","modified":1547914976000},{"_id":"themes/next/layout/_third-party/comments/gitalk.swig","hash":"197207078ff0f4d46417b4413493e02cda0b85f4","modified":1547914976000},{"_id":"themes/next/layout/_third-party/comments/gitment.swig","hash":"dbe94dd94678ee8e4002b06bb1e9ead2e59e44bf","modified":1547914976000},{"_id":"themes/next/layout/_third-party/comments/index.swig","hash":"a4ab8095bf60def5823bf6b7b91a92a356a4c098","modified":1547914976000},{"_id":"themes/next/layout/_third-party/comments/livere.swig","hash":"5856d5f701e51dfae1fd6fb486cefde67effd555","modified":1547914976000},{"_id":"themes/next/layout/_third-party/comments/valine.swig","hash":"210f0c152bc4a9375ed364398ce309f09ebafd10","modified":1547914976000},{"_id":"themes/next/layout/_third-party/math/index.swig","hash":"a7e304b05a44279d3e4f611908d7faef9dc14d7c","modified":1547914976000},{"_id":"themes/next/layout/_third-party/math/katex.swig","hash":"c2cb2f384bc30d31cdccf9794a729c03e687b45c","modified":1547914976000},{"_id":"themes/next/layout/_third-party/math/mathjax.swig","hash":"c76c7ac9b97e74908467701b10e25707ba5c979e","modified":1547914976000},{"_id":"themes/next/layout/_third-party/search/tinysou.swig","hash":"cb3a5d36dbe1630bab84e03a52733a46df7c219b","modified":1547914976000},{"_id":"themes/next/layout/_third-party/search/localsearch.swig","hash":"b3eaab6a269aa3fcbafe24fd06f0c9206dc12716","modified":1547914976000},{"_id":"themes/next/layout/_third-party/seo/baidu-push.swig","hash":"323ccd05bf8befb7d33de443cf3ac6a4195c3554","modified":1547914976000},{"_id":"themes/next/scripts/filters/after_post_render/exturl.js","hash":"1c30b09d1855f1720f71f5956e0c9ca4d57b1231","modified":1547914976000},{"_id":"themes/next/layout/_third-party/search/index.swig","hash":"c747fb5c6b1f500e8f0c583e44195878b66e4e29","modified":1547914976000},{"_id":"themes/next/source/css/_mixins/Gemini.styl","hash":"2aa5b7166a85a8aa34b17792ae4f58a5a96df6cc","modified":1547914976000},{"_id":"themes/next/source/css/_custom/custom.styl","hash":"03ff2383b5884fa7b276919cccbc370080b4a094","modified":1555254318280},{"_id":"themes/next/source/css/_mixins/Pisces.styl","hash":"2640a54fa63bdd4c547eab7ce2fc1192cf0ccec8","modified":1547914976000},{"_id":"themes/next/source/css/_mixins/base.styl","hash":"086f5979b3de091c3378512e6c5c2f8fcb4f6298","modified":1547914976000},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"a8aa41625b94cf17a7f473ed10dcbe683b1db705","modified":1547914976000},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"be087dcc060e8179f7e7f60ab4feb65817bd3d9f","modified":1547914976000},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"fc15e277d1504532a09b7b1bd31f900ad95ec4b8","modified":1547914976000},{"_id":"themes/next/source/css/_variables/base.styl","hash":"d0e97b205d3320421c380f2eee445457430c8152","modified":1547914976000},{"_id":"themes/next/source/js/src/bootstrap.js","hash":"1c41508b83cb0c4512e64b4d63afa1be954ce8ef","modified":1547914976000},{"_id":"themes/next/source/js/src/algolia-search.js","hash":"1f7f10c579e7703d0f6acb8b73f3d78a07d0c623","modified":1547914976000},{"_id":"themes/next/source/js/src/clicklove.js","hash":"effa770d8085f7e7fb903de217ce521dff163780","modified":1547931292000},{"_id":"themes/next/source/js/src/clipboard.js","hash":"8be239ea5b4a5726f2973ac50c15c9a925cd4f40","modified":1549687268000},{"_id":"themes/next/source/js/src/affix.js","hash":"a2aab233d99297435a5274bf512c3c753fe08e80","modified":1547914976000},{"_id":"themes/next/source/js/src/clipboard.min.js","hash":"ee60ca5ba9401456105ef703a98092369b579c80","modified":1549687226000},{"_id":"themes/next/source/js/src/exturl.js","hash":"54825acc8de4793feac415be227b965428f4e97d","modified":1547914976000},{"_id":"themes/next/source/js/src/js.cookie.js","hash":"9b37973a90fd50e71ea91682265715e45ae82c75","modified":1547914976000},{"_id":"themes/next/source/js/src/post-details.js","hash":"0dde5e6d4547587662a3256317a9d5d1db507692","modified":1547914976000},{"_id":"themes/next/source/js/src/motion.js","hash":"7933a30382a84b655238f6e78d42ea1b99af4de6","modified":1547914976000},{"_id":"themes/next/source/js/src/scroll-cookie.js","hash":"d07b3776708d4ae79ed2037c4c7391d5c9b06b19","modified":1547914976000},{"_id":"themes/next/source/js/src/utils.js","hash":"f1394d64977439ec569d2777b1ac304905e043f1","modified":1547914976000},{"_id":"themes/next/source/js/src/scrollspy.js","hash":"fa3c92968bcdbcb8d95a1729f7659d9753cbd077","modified":1547914976000},{"_id":"themes/next/source/lib/canvas-nest/LICENSE","hash":"b29db4c99aa5b8d574026f68804051ff4b75466e","modified":1547918858000},{"_id":"themes/next/source/lib/canvas-nest/README.md","hash":"70a34de41d0736f3727c98b6f17c0a24c9cc3537","modified":1547918858000},{"_id":"themes/next/source/lib/font-awesome/.gitignore","hash":"69d152fa46b517141ec3b1114dd6134724494d83","modified":1547914976000},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest-nomobile.min.js","hash":"956eada198babd00f028e8908767cb158926c3f3","modified":1547918858000},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","hash":"4f7bf961f1bed448f6ba99aeb9219fabf930ba96","modified":1547914976000},{"_id":"themes/next/source/lib/font-awesome/bower.json","hash":"279a8a718ab6c930a67c41237f0aac166c1b9440","modified":1547914976000},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest.min.js","hash":"0387e75e23b1db108a755073fe52a0d03eb391a7","modified":1547918858000},{"_id":"themes/next/source/lib/needsharebutton/LICENSE","hash":"b29db4c99aa5b8d574026f68804051ff4b75466e","modified":1548121954000},{"_id":"themes/next/source/lib/needsharebutton/README.md","hash":"46bb223bdf714a47a1449666f4f70556447786d1","modified":1548121954000},{"_id":"themes/next/source/lib/needsharebutton/needsharebutton.js","hash":"75dee2bb4796ca66693831d769d9a105eed8c290","modified":1548121954000},{"_id":"themes/next/source/lib/needsharebutton/needsharebutton.css","hash":"f151bb5ba4a2cd334061bac27a1a155969b62cdb","modified":1548121954000},{"_id":"themes/next/source/lib/font-awesome/.npmignore","hash":"dcf470ab3a358103bb896a539cc03caeda10fa8b","modified":1547914976000},{"_id":"themes/next/source/lib/font-awesome/.bower.json","hash":"a2aaaf12378db56bd10596ba3daae30950eac051","modified":1547914976000},{"_id":"themes/next/source/lib/pace/pace-theme-big-counter.min.css","hash":"5b561dc328af4c4d512e20a76fe964d113a32ba8","modified":1548117226000},{"_id":"themes/next/source/lib/pace/LICENSE","hash":"b29db4c99aa5b8d574026f68804051ff4b75466e","modified":1548117226000},{"_id":"themes/next/source/lib/pace/README.md","hash":"33b87ed998d59f117dc329f999a4ffc744b41e79","modified":1548117226000},{"_id":"themes/next/source/lib/pace/pace-theme-bounce.min.css","hash":"f6bdb9a785b7979dd8ec5c60e278af955ef1e585","modified":1548117226000},{"_id":"themes/next/source/lib/pace/pace-theme-center-circle.min.css","hash":"a4066769c78affbfbc5e30a600e2c7862cd532e0","modified":1548117226000},{"_id":"themes/next/source/lib/pace/pace-theme-barber-shop.min.css","hash":"ee0d51446cb4ffe1bb96bd7bc8c8e046dddfcf46","modified":1548117226000},{"_id":"themes/next/source/lib/pace/pace-theme-center-simple.min.css","hash":"67f44c947548bd4d77e7590d3f59e236cbf9e98a","modified":1548117226000},{"_id":"themes/next/source/lib/pace/pace-theme-fill-left.min.css","hash":"0bec1e235a4a2cccda3f993b205424e1441a44ae","modified":1548117226000},{"_id":"themes/next/source/lib/pace/pace-theme-flash.min.css","hash":"13ace22c40312d7bbd8d9c1e50eff897a7a497d8","modified":1548117226000},{"_id":"themes/next/source/lib/pace/pace-theme-loading-bar.min.css","hash":"7ee28875dfc1230d76c537f6605766e8d4011e9f","modified":1548117226000},{"_id":"themes/next/source/lib/pace/pace-theme-mac-osx.min.css","hash":"9f2e7b51b084da407863826b25265b31150b3821","modified":1548117226000},{"_id":"themes/next/source/lib/pace/pace-theme-minimal.min.css","hash":"9cd783cceb8a191f3c8b5d81f7a430ecc3e489d3","modified":1548117226000},{"_id":"themes/next/source/lib/pace/pace.min.js","hash":"9944dfb7814b911090e96446cea4d36e2b487234","modified":1548117226000},{"_id":"themes/next/source/lib/reading_progress/.editorconfig","hash":"7d47ecd70ca58d26af4f69ff1b23034edcf4475e","modified":1548638076000},{"_id":"themes/next/source/lib/pace/pace-theme-corner-indicator.min.css","hash":"b3c64c973f31884e3d8145989476707333406b9a","modified":1548117226000},{"_id":"themes/next/source/lib/pace/pace-theme-center-atom.min.css","hash":"dcf79c24fe5350fb73d8038573a104e73639e9d3","modified":1548117226000},{"_id":"themes/next/source/lib/reading_progress/LICENSE","hash":"b29db4c99aa5b8d574026f68804051ff4b75466e","modified":1548638076000},{"_id":"themes/next/source/lib/reading_progress/package.json","hash":"7bcb3787978a0c445b1bd3dfeca6ae6016c98abc","modified":1548638076000},{"_id":"themes/next/source/lib/reading_progress/reading_progress.min.js","hash":"98af8d99819882904f9b1a9254bebf40602e1843","modified":1548638076000},{"_id":"themes/next/source/lib/reading_progress/README.md","hash":"9b00c4ce1a739c825df4e51977f7525d2c9f6b81","modified":1548638076000},{"_id":"themes/next/source/lib/reading_progress/reading_progress.js","hash":"174678a8e2a24763e3fe8b9c25496fdf6ee0220b","modified":1548638076000},{"_id":"themes/next/source/lib/pace/pace-theme-center-radar.min.css","hash":"ab7cba998bf4c03b13df342bf43647fa4f419783","modified":1548117226000},{"_id":"themes/next/source/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1547914976000},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1547914976000},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1547914976000},{"_id":"source/images/nodejs/egg-run.png","hash":"c077485f70b9fd1abe318914fd66d8b966e293b5","modified":1552547657235},{"_id":"source/images/web/img_upload.png","hash":"00f8293020de61fd85c5ae6e099a9539331bf2a0","modified":1554138498205},{"_id":"themes/next/source/lib/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1547914976000},{"_id":"source/images/mobile/optimization.png","hash":"2175b59226dbab79d38b409b3bad3d020793985f","modified":1555614826084},{"_id":"source/images/web/git_order.png","hash":"41ccb018a9bddf2ddc789ed064e04b197d8ff48e","modified":1534276574000},{"_id":"source/images/web/js-run.png","hash":"38776c74b6b6738fca2a9fe27a727528f624a288","modified":1554837167426},{"_id":"themes/next/layout/_third-party/search/algolia-search/assets.swig","hash":"cd86bed852fec6e6933898067122a03755bc17f0","modified":1547914976000},{"_id":"themes/next/layout/_third-party/search/algolia-search/dom.swig","hash":"ba698f49dd3a868c95b240d802f5b1b24ff287e4","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/back-to-top-sidebar.styl","hash":"837ff3718cb5a63eb01a451e35989fd1dfe4218c","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"31050fc7a25784805b4843550151c93bfa55c9c8","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/buttons.styl","hash":"7e509c7c28c59f905b847304dd3d14d94b6f3b8e","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/comments.styl","hash":"471f1627891aca5c0e1973e09fbcb01e1510d193","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/components.styl","hash":"a6bb5256be6195e76addbda12f4ed7c662d65e7a","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/pagination.styl","hash":"c5d48863f332ff8ce7c88dec2c893f709d7331d3","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/tag-cloud.styl","hash":"61ca40856e5cacd48e0fa9728fde4605c7dd4c94","modified":1547914976000},{"_id":"themes/next/source/css/_common/outline/outline.styl","hash":"7e51ea64611ab5d678c112b4688d4db4fd2737e2","modified":1547914976000},{"_id":"themes/next/source/css/_common/scaffolding/helpers.styl","hash":"e3ad313825d7ad03e24bb76d036deeb50587022b","modified":1547914976000},{"_id":"themes/next/source/css/_common/scaffolding/mobile.styl","hash":"4fd38490b01af4f977b53aefc433cd2f981cde14","modified":1547914976000},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"ece571f38180febaf02ace8187ead8318a300ea7","modified":1547914976000},{"_id":"themes/next/source/css/_common/scaffolding/scaffolding.styl","hash":"a280a583b7615e939aaddbf778f5c108ef8a2a6c","modified":1547914976000},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"03d57bbe201e7d6865d5b303ee63f3f61c27c9d8","modified":1547914976000},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"9a5e3c6da76f6d5bed70c38fdf5796faa759d473","modified":1547914976000},{"_id":"themes/next/source/css/_schemes/Mist/_base.styl","hash":"0bef9f0dc134215bc4d0984ba3a16a1a0b6f87ec","modified":1547914976000},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"fe03041c387347e0bcf8efd1b4cf205ece66c339","modified":1547914976000},{"_id":"themes/next/source/css/_schemes/Mist/_logo.styl","hash":"38e5df90c8689a71c978fd83ba74af3d4e4e5386","modified":1547914976000},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"fe2dc74726a515549956d233becda188da64f948","modified":1547914976000},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expanded.styl","hash":"fa33213aceed7bf4bf25437ca9c1a00f7734ae65","modified":1547914976000},{"_id":"themes/next/source/css/_schemes/Mist/_search.styl","hash":"a5bef4fdde80951f3b8c154d79cb1e581638a988","modified":1547914976000},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"2dd866817d0bc7d179e81855f8fbcbb5d3c883fc","modified":1547914976000},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"9b076c92abdadcf9acee75da64592ff3badd69b8","modified":1547914976000},{"_id":"themes/next/source/css/_schemes/Pisces/_brand.styl","hash":"09b5054ae34ba83c0d614821e574da265af55a14","modified":1547914976000},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"74c7dccf0a3ee9fc2ca25ad8e998243191813a0e","modified":1547914976000},{"_id":"themes/next/source/css/_schemes/Pisces/_posts.styl","hash":"2f878213cb24c5ddc18877f6d15ec5c5f57745ac","modified":1547914976000},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"fd54eb599d5003bbb1aabc08596bc24a3fa3294f","modified":1547914976000},{"_id":"themes/next/source/css/_schemes/Pisces/_sub-menu.styl","hash":"b5b936dddb7b4de4720cd1e8428b30a2f06d63fb","modified":1547914976000},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"5779cc8086b1cfde9bc4f1afdd85223bdc45f0a0","modified":1547914976000},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"0efa036a15c18f5abb058b7c0fad1dd9ac5eed4c","modified":1547914976000},{"_id":"themes/next/source/css/_schemes/Muse/_logo.styl","hash":"fc160583f742c94316a0fee05c18468033173534","modified":1547914976000},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"936132428a0d35b3947ccedd4c379940abcf223a","modified":1547914976000},{"_id":"themes/next/source/css/_schemes/Muse/_search.styl","hash":"a5bef4fdde80951f3b8c154d79cb1e581638a988","modified":1547914976000},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"d5e8ea6336bc2e237d501ed0d5bbcbbfe296c832","modified":1547914976000},{"_id":"themes/next/source/js/src/schemes/muse.js","hash":"e9bfa6b343b67625f58757efce46ccdaac8f308c","modified":1547914976000},{"_id":"themes/next/source/js/src/schemes/pisces.js","hash":"9eb63cba0327d3d11b6cbfcbe40b88e97a8378a3","modified":1547914976000},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","hash":"0189d278706509412bac4745f96c83984e1d59f4","modified":1547914976000},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1547914976000},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1547914976000},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1547914976000},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1547914976000},{"_id":"source/images/vue/vue-render-1.png","hash":"0e4ad19c3291873d7ce774c9e5e458fd1e1e5cc3","modified":1555092469775},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"8c68d36d1c74628be58cb61e66948868a8c7588d","modified":1547914976000},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1547914976000},{"_id":"themes/next/source/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/footer/footer.styl","hash":"4cfeec9434a72d5efc6ca225d3445d084d4590f7","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/header/github-banner.styl","hash":"9e0f215868df17cb27a4a522fd31156c66428c2d","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/header/header.styl","hash":"7cc3f36222494c9a1325c5347d7eb9ae53755a32","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/header/headerband.styl","hash":"d27448f199fc2f9980b601bc22b87f08b5d64dd1","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/header/menu.styl","hash":"05e68adae13f4d99a6ac6493daab39c92e39a6bd","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/header/site-meta.styl","hash":"c0d9e18a9210fdcaf33e488518b3b288eb58c0a1","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/header/site-nav.styl","hash":"49c2b2c14a1e7fcc810c6be4b632975d0204c281","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/highlight/diff.styl","hash":"96f32ea6c3265a3889e6abe57587f6e2a2a40dfb","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/highlight/highlight.styl","hash":"9c59dbc1a6f2b4f15d8ae499f7aa227d9b0e3058","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/highlight/theme.styl","hash":"b76387934fb6bb75212b23c1a194486892cc495e","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/pages/archive.styl","hash":"6904fd7ea6455e008d9884558b68254608af9a3c","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/pages/breadcrumb.styl","hash":"2d142c6f39853916256ad8fc79eb6b85f4001ae8","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"4eff5b252d7b614e500fc7d52c97ce325e57d3ab","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/pages/pages.styl","hash":"fb451dc4cc0355b57849c27d3eb110c73562f794","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"61af2f656f6e916f9920277bd048c5d58ff32a60","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/pages/post-detail.styl","hash":"9bf4362a4d0ae151ada84b219d39fbe5bb8c790e","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/post/post-button.styl","hash":"e72a89e0f421444453e149ba32c77a64bd8e44e8","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"a4a7bca145e1fa8d13159552848f8ffacb27783d","modified":1548522420000},{"_id":"themes/next/source/css/_common/components/post/post-copyright.styl","hash":"2356226157e8068b0e9bbe2f7d0f74e1ab49199b","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/post/post-eof.styl","hash":"300491cf0e80c34faf5f83a2846c177759ac653f","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/post/post-expand.styl","hash":"ede576abad438366c8e81f47435242ade5a5a08c","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"387ce23bba52b22a586b2dfb4ec618fe1ffd3926","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/post/post-meta.styl","hash":"417f05ff12a2aaca6ceeac8b7e7eb26e9440c4c3","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"1cf64afd4b49143972f7617869539be3adb91a5e","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/post/post-reading_progress.styl","hash":"0e8294d042d7d28c680ead48baa9e3c777d407c5","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"b5e5aa7074a965e396229c5bd263fb406770ce5f","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/post/post-rtl.styl","hash":"017074ef58166e2d69c53bb7590a0e7a8947a1ed","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/post/post-tags.styl","hash":"a352ae5b1f8857393bf770d2e638bf15f0c9585d","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/post/post-title.styl","hash":"8e058c99dd7d41f0bd34c7c28b6ac9fbb17dcb5e","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/post/post-type.styl","hash":"10251257aceecb117233c9554dcf8ecfef8e2104","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"a6c24393dffbdd94dd5c01cdbec5e180b0bfbbbd","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/post/post.styl","hash":"3039df53b94b0847b0c451d2d227270b479cc184","modified":1550415926000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author-links.styl","hash":"35c0350096921dd8e2222ec41b6c17a4ea6b44f2","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author.styl","hash":"cee0e70d1a6ea963bfd707bf9cedb8a4637f64c2","modified":1547943746000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-blogroll.styl","hash":"b34bb2ea4d16e47e6fdc06cd4feb32d93ccbd779","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-dimmer.styl","hash":"efa5e5022e205b52786ce495d4879f5e7b8f84b2","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-feed-link.styl","hash":"b964782056658ac785ec6070e747c97a5e234ddb","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-nav.styl","hash":"9a3bfc878ca797946815bed23cd6f92b24a16358","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toc.styl","hash":"671a7f8aa138259172e7c6268d82d7a62a1e036a","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toggle.styl","hash":"9ab4e05e7b78af755ebdcbb71731fd723ed2d7f5","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar.styl","hash":"e73db17c210ada503aafca2daaf84a9bfd34be75","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/sidebar/site-state.styl","hash":"c11ef42781111d061ed5b6c14dd4359e2cba88be","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/tags/full-image.styl","hash":"6ec8ea7b11a146777b6b8da0f71f0cc1dbd129df","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/tags/blockquote-center.styl","hash":"c2abe4d87148e23e15d49ee225bc650de60baf46","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/tags/group-pictures.styl","hash":"4851b981020c5cbc354a1af9b831a2dcb3cf9d39","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/tags/label.styl","hash":"4a457d265d62f287c63d48764ce45d9bcfc9ec5a","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/tags/note-modern.styl","hash":"070251836b57027c8240c51e41cb8e8c999c4525","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/tags/note.styl","hash":"0e760758221d4919902bda7c4d3bb96c94a678db","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/tags/tabs.styl","hash":"75f7876136fe1cae9b42d2c220e7f8b37b8d2f55","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/tags/tags.styl","hash":"5e340ee2407a4e39cd708794cfcc718a5f398d7b","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/third-party/algolia-search.styl","hash":"7d2222f66a1c1a0a3cc90bfd5d817d9b859f4a68","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/third-party/gitalk.styl","hash":"ac7753d536341aa824d7bce0332735e838916995","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/third-party/gitment.styl","hash":"c415729e0f0d2439e63b93cec7ae32df54db87b4","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/third-party/han.styl","hash":"7059e24235b7c57a07f3f8abaa06b0bd6a7eda2f","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/third-party/localsearch.styl","hash":"d89c4b562b528e4746696b2ad8935764d133bdae","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/third-party/needsharebutton.styl","hash":"a5e3e6b4b4b814a9fe40b34d784fed67d6d977fa","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/third-party/related-posts.styl","hash":"2d4f318644bf37c50e5b1fab8d62b2673fbab9e8","modified":1547914976000},{"_id":"themes/next/source/css/_common/components/third-party/third-party.styl","hash":"190ad18f45b8a69cef13b2fdd2254893d06ec2c3","modified":1547914976000},{"_id":"themes/next/source/css/_schemes/Mist/outline/outline.styl","hash":"5dc4859c66305f871e56cba78f64bfe3bf1b5f01","modified":1547914976000},{"_id":"themes/next/source/css/_schemes/Mist/sidebar/sidebar-blogroll.styl","hash":"817587e46df49e819858c8ecbafa08b53d5ff040","modified":1547914976000},{"_id":"themes/next/source/css/_schemes/Muse/sidebar/sidebar-blogroll.styl","hash":"817587e46df49e819858c8ecbafa08b53d5ff040","modified":1547914976000},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1547914976000},{"_id":"source/images/web/technology.png","hash":"e8d23a027fd30eee4b60a3d12529a89ef563c400","modified":1554215531508},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1547914976000},{"_id":"source/images/vue/vue_life.png","hash":"e772c6c6a78bf3e750316aaa42ff57107743b6b5","modified":1555237964616},{"_id":"source/images/js/bom.png","hash":"5c9d27bab1de26dbcb2e0bc71bf8b6e9fd9a3734","modified":1552844344000}],"Category":[{"name":"Vue.js","_id":"cjvid4phk00040nbxu1tf9o3i"},{"name":"Javascript","_id":"cjvid4phn00070nbx7xc5jssx"},{"name":"Hexo Blog","_id":"cjvid4pj1000f0nbxaobt3xu1"},{"name":"Three.js","_id":"cjvid4pj5000k0nbx6u2hc1on"},{"name":"Web Skills","_id":"cjvid4pj7000o0nbxfnd1owha"},{"name":"移动端","_id":"cjvid4pj8000s0nbxst4hhy2y"},{"name":"HTML + CSS","_id":"cjvid4pj9000v0nbx6gr0ctt3"},{"name":"Node.js","_id":"cjvid4plu001h0nbxey95bn2t"}],"Data":[{"_id":"next","data":{"override":false,"cache":{"enable":true},"favicon":{"small":"/images/favicon-16.ico","medium":"/images/favicon-32.ico","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"rss":"/atom.xml","footer":{"since":2019,"icon":{"name":"snowflake-o","animated":false,"color":"#808080"},"copyright":"chuangge","powered":{"enable":false,"version":true},"theme":{"enable":false,"version":true},"beian":{"enable":false,"icp":null}},"creative_commons":{"license":"by-nc-sa","sidebar":false,"post":false},"canonical":true,"seo":false,"index_with_subtitle":false,"exturl":false,"menu":{"home":"/ || home  //首页","tags":"/tags/ || tags  //标签","categories":"/categories/ || th   //分类","archives":"/archives/ || archive //归档"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":{"GitHub":"https://github.com/ || github","StackOverflow":"https://stackoverflow.com/ || stack-overflow"},"social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"友情链接","links_layout":"inline","links":{"个人简历":"https://chuanggefighting.github.io/project/","印记中文":"https://www.docschina.org/","在线工具":"http://tool.lu/","Learn Anything":"https://learn-anything.xyz/"},"avatar":{"url":"/images/chuang.png","rounded":true,"opacity":1,"rotated":true},"toc":{"enable":true,"number":true,"wrap":false,"max_depth":6},"sidebar":{"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"read_more_btn":true,"post_meta":{"item_text":true,"created_at":true,"updated_at":{"enabled":true,"another_day":true},"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":true,"awl":4,"wpm":275},"codeblock":{"border_radius":null,"copy_button":{"enable":false,"show_result":false}},"reward":{"enable":false},"related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_edit":{"enable":false,"url":"https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name"},"disable_baidu_tranformation":false,"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"font":{"enable":true,"host":"//fonts.proxy.ustclug.org","global":{"external":true,"family":"Lato","size":16},"headings":{"external":true,"family":"Roboto Slab","size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":"Lobster Two","size":24},"codes":{"external":true,"family":"Roboto Mono","size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css","copy_tex":{"enable":false,"copy_tex_js":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js","copy_tex_css":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css"}}},"pdf":{"enable":false,"per_page":true,"height":"500px","pdfobject":{"cdn":"//cdn.jsdelivr.net/npm/pdfobject@2.1.1/pdfobject.min.js"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":true,"appid":"snOvapuSplYTVflf5p9Ml9JX-gzGzoHsz","appkey":"5ABGdfyEdAtu6lTXdGdo7hf9","notify":false,"verify":false,"placeholder":"ヾﾉ≧∀≦)o 来呀！吐槽一番吧！","avatar":"mm","guest_info":"nick,mail,link","pageSize":10,"visitor":false,"comment_count":true},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"gitalk":{"enable":false,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true},"needmoreshare2":{"enable":true,"postbottom":{"enable":true,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null,"security":false,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":true,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":true,"pace_theme":"pace-theme-center-simple","canvas_nest":{"enable":true,"onmobile":true,"color":"0,0,255","opacity":0.5,"zIndex":-1,"count":99},"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"canvas_nest_nomobile":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"leancloud":null,"valine":null,"gitalk_js":null,"gitalk_css":null,"md5":null},"css":"css","js":"js","images":"images","passage_end_tag":{"enabled":true},"daovoice":true,"daovoice_app_id":"2ed51855"}}],"Page":[{"title":"categories","date":"2019-01-20T06:53:36.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2019-01-20 14:53:36\ntype: \"categories\"\n---\n","updated":"2019-01-19T16:54:14.000Z","path":"categories/index.html","comments":1,"layout":"page","_id":"cjvid4phe00010nbxdv7fva9v","content":"<!-- build time:Sat May 11 2019 01:36:59 GMT+0800 (中国标准时间) --><!-- rebuild by neat --><html><head></head><body></body></html>","site":{"data":{"next":{"override":false,"cache":{"enable":true},"favicon":{"small":"/images/favicon-16.ico","medium":"/images/favicon-32.ico","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"rss":"/atom.xml","footer":{"since":2019,"icon":{"name":"snowflake-o","animated":false,"color":"#808080"},"copyright":"chuangge","powered":{"enable":false,"version":true},"theme":{"enable":false,"version":true},"beian":{"enable":false,"icp":null}},"creative_commons":{"license":"by-nc-sa","sidebar":false,"post":false},"canonical":true,"seo":false,"index_with_subtitle":false,"exturl":false,"menu":{"home":"/ || home  //首页","tags":"/tags/ || tags  //标签","categories":"/categories/ || th   //分类","archives":"/archives/ || archive //归档"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":{"GitHub":"https://github.com/ || github","StackOverflow":"https://stackoverflow.com/ || stack-overflow"},"social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"友情链接","links_layout":"inline","links":{"个人简历":"https://chuanggefighting.github.io/project/","印记中文":"https://www.docschina.org/","在线工具":"http://tool.lu/","Learn Anything":"https://learn-anything.xyz/"},"avatar":{"url":"/images/chuang.png","rounded":true,"opacity":1,"rotated":true},"toc":{"enable":true,"number":true,"wrap":false,"max_depth":6},"sidebar":{"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"read_more_btn":true,"post_meta":{"item_text":true,"created_at":true,"updated_at":{"enabled":true,"another_day":true},"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":true,"awl":4,"wpm":275},"codeblock":{"border_radius":null,"copy_button":{"enable":false,"show_result":false}},"reward":{"enable":false},"related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_edit":{"enable":false,"url":"https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name"},"disable_baidu_tranformation":false,"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"font":{"enable":true,"host":"//fonts.proxy.ustclug.org","global":{"external":true,"family":"Lato","size":16},"headings":{"external":true,"family":"Roboto Slab","size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":"Lobster Two","size":24},"codes":{"external":true,"family":"Roboto Mono","size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css","copy_tex":{"enable":false,"copy_tex_js":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js","copy_tex_css":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css"}}},"pdf":{"enable":false,"per_page":true,"height":"500px","pdfobject":{"cdn":"//cdn.jsdelivr.net/npm/pdfobject@2.1.1/pdfobject.min.js"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":true,"appid":"snOvapuSplYTVflf5p9Ml9JX-gzGzoHsz","appkey":"5ABGdfyEdAtu6lTXdGdo7hf9","notify":false,"verify":false,"placeholder":"ヾﾉ≧∀≦)o 来呀！吐槽一番吧！","avatar":"mm","guest_info":"nick,mail,link","pageSize":10,"visitor":false,"comment_count":true},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"gitalk":{"enable":false,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true},"needmoreshare2":{"enable":true,"postbottom":{"enable":true,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null,"security":false,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":true,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":true,"pace_theme":"pace-theme-center-simple","canvas_nest":{"enable":true,"onmobile":true,"color":"0,0,255","opacity":0.5,"zIndex":-1,"count":99},"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"canvas_nest_nomobile":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"leancloud":null,"valine":null,"gitalk_js":null,"gitalk_css":null,"md5":null},"css":"css","js":"js","images":"images","passage_end_tag":{"enabled":true},"daovoice":true,"daovoice_app_id":"2ed51855"}}},"excerpt":"","more":"<!-- build time:Sat May 11 2019 01:36:59 GMT+0800 (中国标准时间) --><!-- rebuild by neat -->"},{"title":"archives","date":"2019-01-20T06:54:40.000Z","type":"archives","_content":"","source":"archives/index.md","raw":"---\ntitle: archives\ndate: 2019-01-20 14:54:40\ntype: \"archives\"\n---\n","updated":"2019-01-19T16:54:56.000Z","path":"archives/index.html","comments":1,"layout":"page","_id":"cjvid4phh00030nbxjxu37kz2","content":"<!-- build time:Sat May 11 2019 01:36:59 GMT+0800 (中国标准时间) --><!-- rebuild by neat --><html><head></head><body></body></html>","site":{"data":{"next":{"override":false,"cache":{"enable":true},"favicon":{"small":"/images/favicon-16.ico","medium":"/images/favicon-32.ico","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"rss":"/atom.xml","footer":{"since":2019,"icon":{"name":"snowflake-o","animated":false,"color":"#808080"},"copyright":"chuangge","powered":{"enable":false,"version":true},"theme":{"enable":false,"version":true},"beian":{"enable":false,"icp":null}},"creative_commons":{"license":"by-nc-sa","sidebar":false,"post":false},"canonical":true,"seo":false,"index_with_subtitle":false,"exturl":false,"menu":{"home":"/ || home  //首页","tags":"/tags/ || tags  //标签","categories":"/categories/ || th   //分类","archives":"/archives/ || archive //归档"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":{"GitHub":"https://github.com/ || github","StackOverflow":"https://stackoverflow.com/ || stack-overflow"},"social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"友情链接","links_layout":"inline","links":{"个人简历":"https://chuanggefighting.github.io/project/","印记中文":"https://www.docschina.org/","在线工具":"http://tool.lu/","Learn Anything":"https://learn-anything.xyz/"},"avatar":{"url":"/images/chuang.png","rounded":true,"opacity":1,"rotated":true},"toc":{"enable":true,"number":true,"wrap":false,"max_depth":6},"sidebar":{"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"read_more_btn":true,"post_meta":{"item_text":true,"created_at":true,"updated_at":{"enabled":true,"another_day":true},"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":true,"awl":4,"wpm":275},"codeblock":{"border_radius":null,"copy_button":{"enable":false,"show_result":false}},"reward":{"enable":false},"related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_edit":{"enable":false,"url":"https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name"},"disable_baidu_tranformation":false,"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"font":{"enable":true,"host":"//fonts.proxy.ustclug.org","global":{"external":true,"family":"Lato","size":16},"headings":{"external":true,"family":"Roboto Slab","size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":"Lobster Two","size":24},"codes":{"external":true,"family":"Roboto Mono","size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css","copy_tex":{"enable":false,"copy_tex_js":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js","copy_tex_css":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css"}}},"pdf":{"enable":false,"per_page":true,"height":"500px","pdfobject":{"cdn":"//cdn.jsdelivr.net/npm/pdfobject@2.1.1/pdfobject.min.js"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":true,"appid":"snOvapuSplYTVflf5p9Ml9JX-gzGzoHsz","appkey":"5ABGdfyEdAtu6lTXdGdo7hf9","notify":false,"verify":false,"placeholder":"ヾﾉ≧∀≦)o 来呀！吐槽一番吧！","avatar":"mm","guest_info":"nick,mail,link","pageSize":10,"visitor":false,"comment_count":true},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"gitalk":{"enable":false,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true},"needmoreshare2":{"enable":true,"postbottom":{"enable":true,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null,"security":false,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":true,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":true,"pace_theme":"pace-theme-center-simple","canvas_nest":{"enable":true,"onmobile":true,"color":"0,0,255","opacity":0.5,"zIndex":-1,"count":99},"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"canvas_nest_nomobile":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"leancloud":null,"valine":null,"gitalk_js":null,"gitalk_css":null,"md5":null},"css":"css","js":"js","images":"images","passage_end_tag":{"enabled":true},"daovoice":true,"daovoice_app_id":"2ed51855"}}},"excerpt":"","more":"<!-- build time:Sat May 11 2019 01:36:59 GMT+0800 (中国标准时间) --><!-- rebuild by neat -->"},{"title":"tags","date":"2019-01-20T06:52:29.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2019-01-20 14:52:29\ntype: \"tags\"\n---\n","updated":"2019-01-19T16:52:56.000Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cjvid4phm00060nbx4mnnnsjb","content":"<!-- build time:Sat May 11 2019 01:36:59 GMT+0800 (中国标准时间) --><!-- rebuild by neat --><html><head></head><body></body></html>","site":{"data":{"next":{"override":false,"cache":{"enable":true},"favicon":{"small":"/images/favicon-16.ico","medium":"/images/favicon-32.ico","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"rss":"/atom.xml","footer":{"since":2019,"icon":{"name":"snowflake-o","animated":false,"color":"#808080"},"copyright":"chuangge","powered":{"enable":false,"version":true},"theme":{"enable":false,"version":true},"beian":{"enable":false,"icp":null}},"creative_commons":{"license":"by-nc-sa","sidebar":false,"post":false},"canonical":true,"seo":false,"index_with_subtitle":false,"exturl":false,"menu":{"home":"/ || home  //首页","tags":"/tags/ || tags  //标签","categories":"/categories/ || th   //分类","archives":"/archives/ || archive //归档"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":{"GitHub":"https://github.com/ || github","StackOverflow":"https://stackoverflow.com/ || stack-overflow"},"social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"友情链接","links_layout":"inline","links":{"个人简历":"https://chuanggefighting.github.io/project/","印记中文":"https://www.docschina.org/","在线工具":"http://tool.lu/","Learn Anything":"https://learn-anything.xyz/"},"avatar":{"url":"/images/chuang.png","rounded":true,"opacity":1,"rotated":true},"toc":{"enable":true,"number":true,"wrap":false,"max_depth":6},"sidebar":{"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"read_more_btn":true,"post_meta":{"item_text":true,"created_at":true,"updated_at":{"enabled":true,"another_day":true},"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":true,"awl":4,"wpm":275},"codeblock":{"border_radius":null,"copy_button":{"enable":false,"show_result":false}},"reward":{"enable":false},"related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_edit":{"enable":false,"url":"https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name"},"disable_baidu_tranformation":false,"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"font":{"enable":true,"host":"//fonts.proxy.ustclug.org","global":{"external":true,"family":"Lato","size":16},"headings":{"external":true,"family":"Roboto Slab","size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":"Lobster Two","size":24},"codes":{"external":true,"family":"Roboto Mono","size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css","copy_tex":{"enable":false,"copy_tex_js":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js","copy_tex_css":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css"}}},"pdf":{"enable":false,"per_page":true,"height":"500px","pdfobject":{"cdn":"//cdn.jsdelivr.net/npm/pdfobject@2.1.1/pdfobject.min.js"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":true,"appid":"snOvapuSplYTVflf5p9Ml9JX-gzGzoHsz","appkey":"5ABGdfyEdAtu6lTXdGdo7hf9","notify":false,"verify":false,"placeholder":"ヾﾉ≧∀≦)o 来呀！吐槽一番吧！","avatar":"mm","guest_info":"nick,mail,link","pageSize":10,"visitor":false,"comment_count":true},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"gitalk":{"enable":false,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true},"needmoreshare2":{"enable":true,"postbottom":{"enable":true,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null,"security":false,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":true,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":true,"pace_theme":"pace-theme-center-simple","canvas_nest":{"enable":true,"onmobile":true,"color":"0,0,255","opacity":0.5,"zIndex":-1,"count":99},"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"canvas_nest_nomobile":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"leancloud":null,"valine":null,"gitalk_js":null,"gitalk_css":null,"md5":null},"css":"css","js":"js","images":"images","passage_end_tag":{"enabled":true},"daovoice":true,"daovoice_app_id":"2ed51855"}}},"excerpt":"","more":"<!-- build time:Sat May 11 2019 01:36:59 GMT+0800 (中国标准时间) --><!-- rebuild by neat -->"}],"Post":[{"title":"Vue 项目开发","top":false,"keywords":["vue"],"date":"2019-04-14T14:11:50.000Z","description":"常见场景、ElementUI","_content":"\n# 一、常见场景\n\n## 路由控制\n> Token 是包含用户名、有效期和某些专有信息并通过共享密钥加密的信息字符串\n\n### 登录验证\n  1. 客户端发送用户名和密码请求登录，服务端收到进行验证\n  2. 服务端验证成功后生成唯一的 Token 存储在数据库并返回给客户端\n  3. 客户端收到 Token 后通过 Cookie、Vuex 等方式存储\n  4. 客户端每次向服务端请求资源时都携带 Token \n  5. 服务端收到请求后去验证 Token，验证成功则返回数据\n\n\n  ```js\n  // 前端路由验证\n  const router = new VueRouter({\n      routes: [{\n          path: '/',\n          component: require('./views/Home'),\n          meta: { requiresAuth: true  }\n      }]\n  })\n  router.beforeEach((to, from, next) => {\n      if (to.meta.requireAuth) {    \n          if (store.state.token) {  \n              next();\n          } else {\n              // 记录目标路由，用于登录成功后直接跳转\n              next({\n                  path: '/login',\n                  query: {redirect: to.fullPath}\n              })\n          }\n      }else{\n          next()\n      }\n  })\n\n  // 服务端验证\n  axios.interceptors.request.use(\n    config => {\n        if (store.state.token) {  \n            config.headers['Token'] = store.state.token\n        }\n        return config;\n    })\n  axios.interceptors.response.use(\n    error => {\n        if (error.res.status == 401) {\n            // 清除 token 信息并跳转到登录页面\n            store.commit(\"token_clear\");\n            router.replace({\n                path: 'login',\n                query: {redirect: router.currentRoute.fullPath}\n            })\n        }\n        return Promise.reject(error.response.data)   \n    })\n  ```\n\n\n### 权限控制\n> 路由表一般由 Vuex 管理\n\n  1. 初始化路由时挂载登录、注册等公共组件\n  2. 用户登录后，客户端获取服务器返回的路由数据\n  3. 客户端触发 vuex 相关方法生成用户可访问的路由表\n  4. 动态挂载路由方法 router.addRoutes \n        \n\n  ```js\n  // 前端初始化路由\n  export default new Router({\n    routes: [\n      {\n        path: '/login',\n        name: 'login',\n        component: () => import('@//components/login')\n      },\n      {\n        path: '*',\n        name: '404',\n        component: () => import('@//components/404')\n      }\n    ]\n  })\n\n  // 后端返回的路由数据 addRouter\n  [\n    {\n      name: \"home\",\n      path: \"/\",\n      component: \"home\"\n    },\n    {\n      name: \"home\",\n      path: \"/userinfo\",\n      component: \"userInfo\"\n    }\n  ]\n\n  // vuex 添加路由表\n  const mutations = {\n    [ADD_ROUTES](state, addrouter) {\n        let routes = []\n        generaRouter(routes, addRouter)\n        router.addRoutes(routes)  \n        router.push('/')\n    }\n  }\n  const actions = {\n    add_Routes({commit}, addrouter) {\n        commit(ADD_ROUTES, addrouter)\n    }\n  }\n\n  function generaRouter(routers, data){\n    data.forEach((item)=>{\n        let menu = Object.assign({}, item)\n        menu.component = () => import(`@/components/${menu.component}.vue`)\n        if(item.children){\n            menu.children = []\n            generaRouter(menu.children,item.children)\n        }\n        routers.push(menu)\n    })\n  }\n\n  // main.js 用户手动刷新页面时重新新增路由\n  if (sessionStorage.getItem('user')) {\n      let routes = JSON.parse(sessionStorage.getItem('routes'))\n      store.dispatch(\"add_Routes\", routes)\n  }\n  ```\n\n\n## 全局方法\n\n### CommonJS 方法\n> 利用 CommonJS 思想单独封装，然后在组件中引用\n\n  ```js\n  // 引用\n  import { myMethod } from 'assets/js/tool.js'\n  myMethod()\n  ```\n\n\n### 全局注册\n> 在组件中直接使用\n\n  ```js\n  // 注册\n  Vue.protytpe.$myMethod = function(options) {\n      console.log(\"this is my method\");\n  }\n\n  // 使用\n  this.myMethod()\n  ```\n\n## 页面滚动\n> 垂直滚动到页面指定位置\n\n  ```js\n  export const  scrollAnimation = (currentY, targetY, dom) => {\n\n    // 计算需要移动的距离\n    let needScroll = targetY - currentY\n    let _currentY = currentY\n\n    // 注意 window 滚动\n    dom = dom ? dom : 'window'\n    \n    setTimeout(() => {\n        const dist = Math.ceil(needScroll / 10)\n        _currentY += dist\n        dom.scrollTo(_currentY, currentY)\n        // 如果移动幅度小于十个像素，直接移动，否则递归调用，实现动画效果\n        if (needScroll &gt; 10 || needScroll &lt; -10) {\n            scrollAnimation(_currentY, targetY, dom)\n        } else {\n            dom.scrollTo(currentY, targetY)\n        }\n    }, 10)\n  }\n  ```\n\n## 页面刷新\n  * __router.go(0)__：兼容性不好\n  * __window.location.reload()__：会清空 vuex 数据\n  * __provice + inject__：推荐使用\n    1. 根组件定义\n      ```js\n      // router-view v-if=\"isRouterAlive\"\n\n      export default {\n        name: 'App',\n        provide (){\n          return {\n            reload: this.reload\n          }\n        },\n        data(){\n          return {\n            isRouterAlive:true\n          }\n        },\n        methods:{\n          reload (){\n            this.isRouterAlive = false\n            this.$nextTick(function(){\n                this.isRouterAlive = true\n            })\n          }\n        }\n      }\n      ```\n    2. 子组件引用\n      ```js\n      export default {\n        inject: ['reload'],\n        method: {\n            fn(){\n                this.reload()\n            }\n        }\n      }\n      ```\n\n\n## 组件数据\n\n### 组件数据重置\n  * 表单：`this.form = this.$options.data().form`\n  * 组件：`Object.assign(this.$data, this.$options.data())`\n    * this.$data：获取当前状态下的 data\n    * this.$options.data()：获取该组件初始状态下的 data\n\n\n### 数据更新问题\n> 路由变化后页面数据不更新，原因是跳转前后使用同一个组件，vue-router 默认复用组件而没有执行 created 等生命周期钩子\n\n  * 普通方案\n    * 监听 $route 变化来初始化数据 \n    * `watch: { '$route': {handler: 'resetData',immediate: true} }`\n  * 简单方案\n    * 监听路由地址变化来重新创建组件  \n    * `router-view :key=\"$route.fullpath\"`\n\n\n## 组件缓存\t\t\t\t\n> 缓存组件只会在首次进入时执行一次生命周期钩子，再次进入则从缓存中获取数据等\n\n  * 全部缓存：keep-alive 标签包裹 router-view\n  * 部分缓存\n    * 缓存 keep-alive include=\"a, b\"、不缓存 keep-alive exclude=\"c, d\"\n    * 路由配置 meta: { cache: true }，渲染时 keep-alive v-if=\"$route.meta.cache\"\n\n\n\n\n\n\n# 二、ElementUI\n\n## el-input\n  * 监听回车事件：`@keyup.enter.native=\"doSearch\"`\n  * 监听输入值\n    * `v-on:input=\"doSearch\"`\n    * 封装 input 之后无法直接监听原生事件，需要添加修饰符\n  * 获取改变前的数据\n    * @change 方法一般传递参数之后就会覆盖原本的数据\n    * 两种方案\n      * `el-input @change=\"value => changeVal(value, scope.row)\"`\n      * `el-input @change=\"changeVal($event, scope.row, scope.$index)\"`\n\n\n \n\n\n\n\n\n\n\n\n","source":"_posts/16-vue项目.md","raw":"---\ntitle: Vue 项目开发\ntags:\n  - Vue.js\ncategories: Vue.js\ntop: false\nkeywords:\n  - vue\ndate: 2019-04-14 22:11:50\ndescription: 常见场景、ElementUI\n---\n\n# 一、常见场景\n\n## 路由控制\n> Token 是包含用户名、有效期和某些专有信息并通过共享密钥加密的信息字符串\n\n### 登录验证\n  1. 客户端发送用户名和密码请求登录，服务端收到进行验证\n  2. 服务端验证成功后生成唯一的 Token 存储在数据库并返回给客户端\n  3. 客户端收到 Token 后通过 Cookie、Vuex 等方式存储\n  4. 客户端每次向服务端请求资源时都携带 Token \n  5. 服务端收到请求后去验证 Token，验证成功则返回数据\n\n\n  ```js\n  // 前端路由验证\n  const router = new VueRouter({\n      routes: [{\n          path: '/',\n          component: require('./views/Home'),\n          meta: { requiresAuth: true  }\n      }]\n  })\n  router.beforeEach((to, from, next) => {\n      if (to.meta.requireAuth) {    \n          if (store.state.token) {  \n              next();\n          } else {\n              // 记录目标路由，用于登录成功后直接跳转\n              next({\n                  path: '/login',\n                  query: {redirect: to.fullPath}\n              })\n          }\n      }else{\n          next()\n      }\n  })\n\n  // 服务端验证\n  axios.interceptors.request.use(\n    config => {\n        if (store.state.token) {  \n            config.headers['Token'] = store.state.token\n        }\n        return config;\n    })\n  axios.interceptors.response.use(\n    error => {\n        if (error.res.status == 401) {\n            // 清除 token 信息并跳转到登录页面\n            store.commit(\"token_clear\");\n            router.replace({\n                path: 'login',\n                query: {redirect: router.currentRoute.fullPath}\n            })\n        }\n        return Promise.reject(error.response.data)   \n    })\n  ```\n\n\n### 权限控制\n> 路由表一般由 Vuex 管理\n\n  1. 初始化路由时挂载登录、注册等公共组件\n  2. 用户登录后，客户端获取服务器返回的路由数据\n  3. 客户端触发 vuex 相关方法生成用户可访问的路由表\n  4. 动态挂载路由方法 router.addRoutes \n        \n\n  ```js\n  // 前端初始化路由\n  export default new Router({\n    routes: [\n      {\n        path: '/login',\n        name: 'login',\n        component: () => import('@//components/login')\n      },\n      {\n        path: '*',\n        name: '404',\n        component: () => import('@//components/404')\n      }\n    ]\n  })\n\n  // 后端返回的路由数据 addRouter\n  [\n    {\n      name: \"home\",\n      path: \"/\",\n      component: \"home\"\n    },\n    {\n      name: \"home\",\n      path: \"/userinfo\",\n      component: \"userInfo\"\n    }\n  ]\n\n  // vuex 添加路由表\n  const mutations = {\n    [ADD_ROUTES](state, addrouter) {\n        let routes = []\n        generaRouter(routes, addRouter)\n        router.addRoutes(routes)  \n        router.push('/')\n    }\n  }\n  const actions = {\n    add_Routes({commit}, addrouter) {\n        commit(ADD_ROUTES, addrouter)\n    }\n  }\n\n  function generaRouter(routers, data){\n    data.forEach((item)=>{\n        let menu = Object.assign({}, item)\n        menu.component = () => import(`@/components/${menu.component}.vue`)\n        if(item.children){\n            menu.children = []\n            generaRouter(menu.children,item.children)\n        }\n        routers.push(menu)\n    })\n  }\n\n  // main.js 用户手动刷新页面时重新新增路由\n  if (sessionStorage.getItem('user')) {\n      let routes = JSON.parse(sessionStorage.getItem('routes'))\n      store.dispatch(\"add_Routes\", routes)\n  }\n  ```\n\n\n## 全局方法\n\n### CommonJS 方法\n> 利用 CommonJS 思想单独封装，然后在组件中引用\n\n  ```js\n  // 引用\n  import { myMethod } from 'assets/js/tool.js'\n  myMethod()\n  ```\n\n\n### 全局注册\n> 在组件中直接使用\n\n  ```js\n  // 注册\n  Vue.protytpe.$myMethod = function(options) {\n      console.log(\"this is my method\");\n  }\n\n  // 使用\n  this.myMethod()\n  ```\n\n## 页面滚动\n> 垂直滚动到页面指定位置\n\n  ```js\n  export const  scrollAnimation = (currentY, targetY, dom) => {\n\n    // 计算需要移动的距离\n    let needScroll = targetY - currentY\n    let _currentY = currentY\n\n    // 注意 window 滚动\n    dom = dom ? dom : 'window'\n    \n    setTimeout(() => {\n        const dist = Math.ceil(needScroll / 10)\n        _currentY += dist\n        dom.scrollTo(_currentY, currentY)\n        // 如果移动幅度小于十个像素，直接移动，否则递归调用，实现动画效果\n        if (needScroll &gt; 10 || needScroll &lt; -10) {\n            scrollAnimation(_currentY, targetY, dom)\n        } else {\n            dom.scrollTo(currentY, targetY)\n        }\n    }, 10)\n  }\n  ```\n\n## 页面刷新\n  * __router.go(0)__：兼容性不好\n  * __window.location.reload()__：会清空 vuex 数据\n  * __provice + inject__：推荐使用\n    1. 根组件定义\n      ```js\n      // router-view v-if=\"isRouterAlive\"\n\n      export default {\n        name: 'App',\n        provide (){\n          return {\n            reload: this.reload\n          }\n        },\n        data(){\n          return {\n            isRouterAlive:true\n          }\n        },\n        methods:{\n          reload (){\n            this.isRouterAlive = false\n            this.$nextTick(function(){\n                this.isRouterAlive = true\n            })\n          }\n        }\n      }\n      ```\n    2. 子组件引用\n      ```js\n      export default {\n        inject: ['reload'],\n        method: {\n            fn(){\n                this.reload()\n            }\n        }\n      }\n      ```\n\n\n## 组件数据\n\n### 组件数据重置\n  * 表单：`this.form = this.$options.data().form`\n  * 组件：`Object.assign(this.$data, this.$options.data())`\n    * this.$data：获取当前状态下的 data\n    * this.$options.data()：获取该组件初始状态下的 data\n\n\n### 数据更新问题\n> 路由变化后页面数据不更新，原因是跳转前后使用同一个组件，vue-router 默认复用组件而没有执行 created 等生命周期钩子\n\n  * 普通方案\n    * 监听 $route 变化来初始化数据 \n    * `watch: { '$route': {handler: 'resetData',immediate: true} }`\n  * 简单方案\n    * 监听路由地址变化来重新创建组件  \n    * `router-view :key=\"$route.fullpath\"`\n\n\n## 组件缓存\t\t\t\t\n> 缓存组件只会在首次进入时执行一次生命周期钩子，再次进入则从缓存中获取数据等\n\n  * 全部缓存：keep-alive 标签包裹 router-view\n  * 部分缓存\n    * 缓存 keep-alive include=\"a, b\"、不缓存 keep-alive exclude=\"c, d\"\n    * 路由配置 meta: { cache: true }，渲染时 keep-alive v-if=\"$route.meta.cache\"\n\n\n\n\n\n\n# 二、ElementUI\n\n## el-input\n  * 监听回车事件：`@keyup.enter.native=\"doSearch\"`\n  * 监听输入值\n    * `v-on:input=\"doSearch\"`\n    * 封装 input 之后无法直接监听原生事件，需要添加修饰符\n  * 获取改变前的数据\n    * @change 方法一般传递参数之后就会覆盖原本的数据\n    * 两种方案\n      * `el-input @change=\"value => changeVal(value, scope.row)\"`\n      * `el-input @change=\"changeVal($event, scope.row, scope.$index)\"`\n\n\n \n\n\n\n\n\n\n\n\n","slug":"16-vue项目","published":1,"updated":"2019-04-15T17:05:31.604Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvid4ph600000nbxix1ltdyj","content":"<!-- build time:Sat May 11 2019 01:36:56 GMT+0800 (中国标准时间) --><html><head></head><body><h1 id=\"一、常见场景\"><a href=\"#一、常见场景\" class=\"headerlink\" title=\"一、常见场景\"></a>一、常见场景</h1><h2 id=\"路由控制\"><a href=\"#路由控制\" class=\"headerlink\" title=\"路由控制\"></a>路由控制</h2><blockquote><p>Token 是包含用户名、有效期和某些专有信息并通过共享密钥加密的信息字符串</p></blockquote><h3 id=\"登录验证\"><a href=\"#登录验证\" class=\"headerlink\" title=\"登录验证\"></a>登录验证</h3><ol><li>客户端发送用户名和密码请求登录，服务端收到进行验证</li><li>服务端验证成功后生成唯一的 Token 存储在数据库并返回给客户端</li><li>客户端收到 Token 后通过 Cookie、Vuex 等方式存储</li><li>客户端每次向服务端请求资源时都携带 Token</li><li>服务端收到请求后去验证 Token，验证成功则返回数据</li></ol><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 前端路由验证</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"keyword\">new</span> VueRouter({</span><br><span class=\"line\">    routes: [{</span><br><span class=\"line\">        path: <span class=\"string\">'/'</span>,</span><br><span class=\"line\">        component: <span class=\"built_in\">require</span>(<span class=\"string\">'./views/Home'</span>),</span><br><span class=\"line\">        meta: { <span class=\"attr\">requiresAuth</span>: <span class=\"literal\">true</span>  }</span><br><span class=\"line\">    }]</span><br><span class=\"line\">})</span><br><span class=\"line\">router.beforeEach(<span class=\"function\">(<span class=\"params\">to, <span class=\"keyword\">from</span>, next</span>) =></span> {</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (to.meta.requireAuth) {    </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (store.state.token) {  </span><br><span class=\"line\">            next();</span><br><span class=\"line\">        } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">            <span class=\"comment\">// 记录目标路由，用于登录成功后直接跳转</span></span><br><span class=\"line\">            next({</span><br><span class=\"line\">                path: <span class=\"string\">'/login'</span>,</span><br><span class=\"line\">                query: {<span class=\"attr\">redirect</span>: to.fullPath}</span><br><span class=\"line\">            })</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }<span class=\"keyword\">else</span>{</span><br><span class=\"line\">        next()</span><br><span class=\"line\">    }</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 服务端验证</span></span><br><span class=\"line\">axios.interceptors.request.use(</span><br><span class=\"line\">  config => {</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (store.state.token) {  </span><br><span class=\"line\">          config.headers[<span class=\"string\">'Token'</span>] = store.state.token</span><br><span class=\"line\">      }</span><br><span class=\"line\">      <span class=\"keyword\">return</span> config;</span><br><span class=\"line\">  })</span><br><span class=\"line\">axios.interceptors.response.use(</span><br><span class=\"line\">  error => {</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (error.res.status == <span class=\"number\">401</span>) {</span><br><span class=\"line\">          <span class=\"comment\">// 清除 token 信息并跳转到登录页面</span></span><br><span class=\"line\">          store.commit(<span class=\"string\">\"token_clear\"</span>);</span><br><span class=\"line\">          router.replace({</span><br><span class=\"line\">              path: <span class=\"string\">'login'</span>,</span><br><span class=\"line\">              query: {<span class=\"attr\">redirect</span>: router.currentRoute.fullPath}</span><br><span class=\"line\">          })</span><br><span class=\"line\">      }</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.reject(error.response.data)   </span><br><span class=\"line\">  })</span><br></pre></td></tr></tbody></table></figure><h3 id=\"权限控制\"><a href=\"#权限控制\" class=\"headerlink\" title=\"权限控制\"></a>权限控制</h3><blockquote><p>路由表一般由 Vuex 管理</p></blockquote><ol><li>初始化路由时挂载登录、注册等公共组件</li><li>用户登录后，客户端获取服务器返回的路由数据</li><li>客户端触发 vuex 相关方法生成用户可访问的路由表</li><li>动态挂载路由方法 router.addRoutes</li></ol><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 前端初始化路由</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">new</span> Router({</span><br><span class=\"line\">  routes: [</span><br><span class=\"line\">    {</span><br><span class=\"line\">      path: <span class=\"string\">'/login'</span>,</span><br><span class=\"line\">      name: <span class=\"string\">'login'</span>,</span><br><span class=\"line\">      component: <span class=\"function\"><span class=\"params\">()</span> =></span> <span class=\"keyword\">import</span>(<span class=\"string\">'@//components/login'</span>)</span><br><span class=\"line\">    },</span><br><span class=\"line\">    {</span><br><span class=\"line\">      path: <span class=\"string\">'*'</span>,</span><br><span class=\"line\">      name: <span class=\"string\">'404'</span>,</span><br><span class=\"line\">      component: <span class=\"function\"><span class=\"params\">()</span> =></span> <span class=\"keyword\">import</span>(<span class=\"string\">'@//components/404'</span>)</span><br><span class=\"line\">    }</span><br><span class=\"line\">  ]</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 后端返回的路由数据 addRouter</span></span><br><span class=\"line\">[</span><br><span class=\"line\">  {</span><br><span class=\"line\">    name: <span class=\"string\">\"home\"</span>,</span><br><span class=\"line\">    path: <span class=\"string\">\"/\"</span>,</span><br><span class=\"line\">    component: <span class=\"string\">\"home\"</span></span><br><span class=\"line\">  },</span><br><span class=\"line\">  {</span><br><span class=\"line\">    name: <span class=\"string\">\"home\"</span>,</span><br><span class=\"line\">    path: <span class=\"string\">\"/userinfo\"</span>,</span><br><span class=\"line\">    component: <span class=\"string\">\"userInfo\"</span></span><br><span class=\"line\">  }</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// vuex 添加路由表</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> mutations = {</span><br><span class=\"line\">  [ADD_ROUTES](state, addrouter) {</span><br><span class=\"line\">      <span class=\"keyword\">let</span> routes = []</span><br><span class=\"line\">      generaRouter(routes, addRouter)</span><br><span class=\"line\">      router.addRoutes(routes)  </span><br><span class=\"line\">      router.push(<span class=\"string\">'/'</span>)</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">const</span> actions = {</span><br><span class=\"line\">  add_Routes({commit}, addrouter) {</span><br><span class=\"line\">      commit(ADD_ROUTES, addrouter)</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">generaRouter</span>(<span class=\"params\">routers, data</span>)</span>{</span><br><span class=\"line\">  data.forEach(<span class=\"function\">(<span class=\"params\">item</span>)=></span>{</span><br><span class=\"line\">      <span class=\"keyword\">let</span> menu = <span class=\"built_in\">Object</span>.assign({}, item)</span><br><span class=\"line\">      menu.component = <span class=\"function\"><span class=\"params\">()</span> =></span> <span class=\"keyword\">import</span>(<span class=\"string\">`@/components/<span class=\"subst\">${menu.component}</span>.vue`</span>)</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(item.children){</span><br><span class=\"line\">          menu.children = []</span><br><span class=\"line\">          generaRouter(menu.children,item.children)</span><br><span class=\"line\">      }</span><br><span class=\"line\">      routers.push(menu)</span><br><span class=\"line\">  })</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// main.js 用户手动刷新页面时重新新增路由</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (sessionStorage.getItem(<span class=\"string\">'user'</span>)) {</span><br><span class=\"line\">    <span class=\"keyword\">let</span> routes = <span class=\"built_in\">JSON</span>.parse(sessionStorage.getItem(<span class=\"string\">'routes'</span>))</span><br><span class=\"line\">    store.dispatch(<span class=\"string\">\"add_Routes\"</span>, routes)</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"全局方法\"><a href=\"#全局方法\" class=\"headerlink\" title=\"全局方法\"></a>全局方法</h2><h3 id=\"CommonJS-方法\"><a href=\"#CommonJS-方法\" class=\"headerlink\" title=\"CommonJS 方法\"></a>CommonJS 方法</h3><blockquote><p>利用 CommonJS 思想单独封装，然后在组件中引用</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 引用</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> { myMethod } <span class=\"keyword\">from</span> <span class=\"string\">'assets/js/tool.js'</span></span><br><span class=\"line\">myMethod()</span><br></pre></td></tr></tbody></table></figure><h3 id=\"全局注册\"><a href=\"#全局注册\" class=\"headerlink\" title=\"全局注册\"></a>全局注册</h3><blockquote><p>在组件中直接使用</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 注册</span></span><br><span class=\"line\">Vue.protytpe.$myMethod = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">options</span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"this is my method\"</span>);</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用</span></span><br><span class=\"line\"><span class=\"keyword\">this</span>.myMethod()</span><br></pre></td></tr></tbody></table></figure><h2 id=\"页面滚动\"><a href=\"#页面滚动\" class=\"headerlink\" title=\"页面滚动\"></a>页面滚动</h2><blockquote><p>垂直滚动到页面指定位置</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span>  scrollAnimation = <span class=\"function\">(<span class=\"params\">currentY, targetY, dom</span>) =></span> {</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 计算需要移动的距离</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> needScroll = targetY - currentY</span><br><span class=\"line\">  <span class=\"keyword\">let</span> _currentY = currentY</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 注意 window 滚动</span></span><br><span class=\"line\">  dom = dom ? dom : <span class=\"string\">'window'</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  setTimeout(<span class=\"function\"><span class=\"params\">()</span> =></span> {</span><br><span class=\"line\">      <span class=\"keyword\">const</span> dist = <span class=\"built_in\">Math</span>.ceil(needScroll / <span class=\"number\">10</span>)</span><br><span class=\"line\">      _currentY += dist</span><br><span class=\"line\">      dom.scrollTo(_currentY, currentY)</span><br><span class=\"line\">      <span class=\"comment\">// 如果移动幅度小于十个像素，直接移动，否则递归调用，实现动画效果</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (needScroll &gt; <span class=\"number\">10</span> || needScroll &lt; <span class=\"number\">-10</span>) {</span><br><span class=\"line\">          scrollAnimation(_currentY, targetY, dom)</span><br><span class=\"line\">      } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">          dom.scrollTo(currentY, targetY)</span><br><span class=\"line\">      }</span><br><span class=\"line\">  }, <span class=\"number\">10</span>)</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"页面刷新\"><a href=\"#页面刷新\" class=\"headerlink\" title=\"页面刷新\"></a>页面刷新</h2><ul><li><strong>router.go(0)</strong>：兼容性不好</li><li><strong>window.location.reload()</strong>：会清空 vuex 数据</li><li><p><strong>provice + inject</strong>：推荐使用</p><ol><li><p>根组件定义</p><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// router-view v-if=\"isRouterAlive\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> {</span><br><span class=\"line\">  name: <span class=\"string\">'App'</span>,</span><br><span class=\"line\">  provide (){</span><br><span class=\"line\">    <span class=\"keyword\">return</span> {</span><br><span class=\"line\">      reload: <span class=\"keyword\">this</span>.reload</span><br><span class=\"line\">    }</span><br><span class=\"line\">  },</span><br><span class=\"line\">  data(){</span><br><span class=\"line\">    <span class=\"keyword\">return</span> {</span><br><span class=\"line\">      isRouterAlive:<span class=\"literal\">true</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">  },</span><br><span class=\"line\">  methods:{</span><br><span class=\"line\">    reload (){</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.isRouterAlive = <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.$nextTick(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">          <span class=\"keyword\">this</span>.isRouterAlive = <span class=\"literal\">true</span></span><br><span class=\"line\">      })</span><br><span class=\"line\">    }</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure></li><li><p>子组件引用</p><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> {</span><br><span class=\"line\">  inject: [<span class=\"string\">'reload'</span>],</span><br><span class=\"line\">  method: {</span><br><span class=\"line\">      fn(){</span><br><span class=\"line\">          <span class=\"keyword\">this</span>.reload()</span><br><span class=\"line\">      }</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure></li></ol></li></ul><h2 id=\"组件数据\"><a href=\"#组件数据\" class=\"headerlink\" title=\"组件数据\"></a>组件数据</h2><h3 id=\"组件数据重置\"><a href=\"#组件数据重置\" class=\"headerlink\" title=\"组件数据重置\"></a>组件数据重置</h3><ul><li>表单：<code>this.form = this.$options.data().form</code></li><li>组件：<code>Object.assign(this.$data, this.$options.data())</code><ul><li>this.$data：获取当前状态下的 data</li><li>this.$options.data()：获取该组件初始状态下的 data</li></ul></li></ul><h3 id=\"数据更新问题\"><a href=\"#数据更新问题\" class=\"headerlink\" title=\"数据更新问题\"></a>数据更新问题</h3><blockquote><p>路由变化后页面数据不更新，原因是跳转前后使用同一个组件，vue-router 默认复用组件而没有执行 created 等生命周期钩子</p></blockquote><ul><li>普通方案<ul><li>监听 $route 变化来初始化数据</li><li><code>watch: { '$route': {handler: 'resetData',immediate: true} }</code></li></ul></li><li>简单方案<ul><li>监听路由地址变化来重新创建组件</li><li><code>router-view :key=\"$route.fullpath\"</code></li></ul></li></ul><h2 id=\"组件缓存\"><a href=\"#组件缓存\" class=\"headerlink\" title=\"组件缓存\"></a>组件缓存</h2><blockquote><p>缓存组件只会在首次进入时执行一次生命周期钩子，再次进入则从缓存中获取数据等</p></blockquote><ul><li>全部缓存：keep-alive 标签包裹 router-view</li><li>部分缓存<ul><li>缓存 keep-alive include=”a, b”、不缓存 keep-alive exclude=”c, d”</li><li>路由配置 meta: { cache: true }，渲染时 keep-alive v-if=”$route.meta.cache”</li></ul></li></ul><h1 id=\"二、ElementUI\"><a href=\"#二、ElementUI\" class=\"headerlink\" title=\"二、ElementUI\"></a>二、ElementUI</h1><h2 id=\"el-input\"><a href=\"#el-input\" class=\"headerlink\" title=\"el-input\"></a>el-input</h2><ul><li>监听回车事件：<a href=\"mailto:`@keyup.enter.native\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">`@keyup.enter.native</a>=”doSearch”`</li><li>监听输入值<ul><li><code>v-on:input=\"doSearch\"</code></li><li>封装 input 之后无法直接监听原生事件，需要添加修饰符</li></ul></li><li>获取改变前的数据<ul><li>@change 方法一般传递参数之后就会覆盖原本的数据</li><li>两种方案<ul><li><code>el-input @change=\"value => changeVal(value, scope.row)\"</code></li><li><code>el-input @change=\"changeVal($event, scope.row, scope.$index)\"</code></li></ul></li></ul></li></ul><!-- rebuild by neat --></body></html>","site":{"data":{"next":{"override":false,"cache":{"enable":true},"favicon":{"small":"/images/favicon-16.ico","medium":"/images/favicon-32.ico","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"rss":"/atom.xml","footer":{"since":2019,"icon":{"name":"snowflake-o","animated":false,"color":"#808080"},"copyright":"chuangge","powered":{"enable":false,"version":true},"theme":{"enable":false,"version":true},"beian":{"enable":false,"icp":null}},"creative_commons":{"license":"by-nc-sa","sidebar":false,"post":false},"canonical":true,"seo":false,"index_with_subtitle":false,"exturl":false,"menu":{"home":"/ || home  //首页","tags":"/tags/ || tags  //标签","categories":"/categories/ || th   //分类","archives":"/archives/ || archive //归档"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":{"GitHub":"https://github.com/ || github","StackOverflow":"https://stackoverflow.com/ || stack-overflow"},"social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"友情链接","links_layout":"inline","links":{"个人简历":"https://chuanggefighting.github.io/project/","印记中文":"https://www.docschina.org/","在线工具":"http://tool.lu/","Learn Anything":"https://learn-anything.xyz/"},"avatar":{"url":"/images/chuang.png","rounded":true,"opacity":1,"rotated":true},"toc":{"enable":true,"number":true,"wrap":false,"max_depth":6},"sidebar":{"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"read_more_btn":true,"post_meta":{"item_text":true,"created_at":true,"updated_at":{"enabled":true,"another_day":true},"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":true,"awl":4,"wpm":275},"codeblock":{"border_radius":null,"copy_button":{"enable":false,"show_result":false}},"reward":{"enable":false},"related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_edit":{"enable":false,"url":"https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name"},"disable_baidu_tranformation":false,"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"font":{"enable":true,"host":"//fonts.proxy.ustclug.org","global":{"external":true,"family":"Lato","size":16},"headings":{"external":true,"family":"Roboto Slab","size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":"Lobster Two","size":24},"codes":{"external":true,"family":"Roboto Mono","size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css","copy_tex":{"enable":false,"copy_tex_js":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js","copy_tex_css":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css"}}},"pdf":{"enable":false,"per_page":true,"height":"500px","pdfobject":{"cdn":"//cdn.jsdelivr.net/npm/pdfobject@2.1.1/pdfobject.min.js"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":true,"appid":"snOvapuSplYTVflf5p9Ml9JX-gzGzoHsz","appkey":"5ABGdfyEdAtu6lTXdGdo7hf9","notify":false,"verify":false,"placeholder":"ヾﾉ≧∀≦)o 来呀！吐槽一番吧！","avatar":"mm","guest_info":"nick,mail,link","pageSize":10,"visitor":false,"comment_count":true},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"gitalk":{"enable":false,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true},"needmoreshare2":{"enable":true,"postbottom":{"enable":true,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null,"security":false,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":true,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":true,"pace_theme":"pace-theme-center-simple","canvas_nest":{"enable":true,"onmobile":true,"color":"0,0,255","opacity":0.5,"zIndex":-1,"count":99},"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"canvas_nest_nomobile":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"leancloud":null,"valine":null,"gitalk_js":null,"gitalk_css":null,"md5":null},"css":"css","js":"js","images":"images","passage_end_tag":{"enabled":true},"daovoice":true,"daovoice_app_id":"2ed51855"}}},"excerpt":"","more":"<!-- build time:Sat May 11 2019 01:36:56 GMT+0800 (中国标准时间) --><h1 id=\"一、常见场景\"><a href=\"#一、常见场景\" class=\"headerlink\" title=\"一、常见场景\"></a>一、常见场景</h1><h2 id=\"路由控制\"><a href=\"#路由控制\" class=\"headerlink\" title=\"路由控制\"></a>路由控制</h2><blockquote><p>Token 是包含用户名、有效期和某些专有信息并通过共享密钥加密的信息字符串</p></blockquote><h3 id=\"登录验证\"><a href=\"#登录验证\" class=\"headerlink\" title=\"登录验证\"></a>登录验证</h3><ol><li>客户端发送用户名和密码请求登录，服务端收到进行验证</li><li>服务端验证成功后生成唯一的 Token 存储在数据库并返回给客户端</li><li>客户端收到 Token 后通过 Cookie、Vuex 等方式存储</li><li>客户端每次向服务端请求资源时都携带 Token</li><li>服务端收到请求后去验证 Token，验证成功则返回数据</li></ol><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 前端路由验证</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"keyword\">new</span> VueRouter(&#123;</span><br><span class=\"line\">    routes: [&#123;</span><br><span class=\"line\">        path: <span class=\"string\">'/'</span>,</span><br><span class=\"line\">        component: <span class=\"built_in\">require</span>(<span class=\"string\">'./views/Home'</span>),</span><br><span class=\"line\">        meta: &#123; <span class=\"attr\">requiresAuth</span>: <span class=\"literal\">true</span>  &#125;</span><br><span class=\"line\">    &#125;]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">router.beforeEach(<span class=\"function\">(<span class=\"params\">to, <span class=\"keyword\">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (to.meta.requireAuth) &#123;    </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (store.state.token) &#123;  </span><br><span class=\"line\">            next();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 记录目标路由，用于登录成功后直接跳转</span></span><br><span class=\"line\">            next(&#123;</span><br><span class=\"line\">                path: <span class=\"string\">'/login'</span>,</span><br><span class=\"line\">                query: &#123;<span class=\"attr\">redirect</span>: to.fullPath&#125;</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        next()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 服务端验证</span></span><br><span class=\"line\">axios.interceptors.request.use(</span><br><span class=\"line\">  config =&gt; &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (store.state.token) &#123;  </span><br><span class=\"line\">          config.headers[<span class=\"string\">'Token'</span>] = store.state.token</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> config;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">axios.interceptors.response.use(</span><br><span class=\"line\">  error =&gt; &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (error.res.status == <span class=\"number\">401</span>) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// 清除 token 信息并跳转到登录页面</span></span><br><span class=\"line\">          store.commit(<span class=\"string\">\"token_clear\"</span>);</span><br><span class=\"line\">          router.replace(&#123;</span><br><span class=\"line\">              path: <span class=\"string\">'login'</span>,</span><br><span class=\"line\">              query: &#123;<span class=\"attr\">redirect</span>: router.currentRoute.fullPath&#125;</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.reject(error.response.data)   </span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure><h3 id=\"权限控制\"><a href=\"#权限控制\" class=\"headerlink\" title=\"权限控制\"></a>权限控制</h3><blockquote><p>路由表一般由 Vuex 管理</p></blockquote><ol><li>初始化路由时挂载登录、注册等公共组件</li><li>用户登录后，客户端获取服务器返回的路由数据</li><li>客户端触发 vuex 相关方法生成用户可访问的路由表</li><li>动态挂载路由方法 router.addRoutes</li></ol><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 前端初始化路由</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">new</span> Router(&#123;</span><br><span class=\"line\">  routes: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      path: <span class=\"string\">'/login'</span>,</span><br><span class=\"line\">      name: <span class=\"string\">'login'</span>,</span><br><span class=\"line\">      component: <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> <span class=\"keyword\">import</span>(<span class=\"string\">'@//components/login'</span>)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      path: <span class=\"string\">'*'</span>,</span><br><span class=\"line\">      name: <span class=\"string\">'404'</span>,</span><br><span class=\"line\">      component: <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> <span class=\"keyword\">import</span>(<span class=\"string\">'@//components/404'</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 后端返回的路由数据 addRouter</span></span><br><span class=\"line\">[</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    name: <span class=\"string\">\"home\"</span>,</span><br><span class=\"line\">    path: <span class=\"string\">\"/\"</span>,</span><br><span class=\"line\">    component: <span class=\"string\">\"home\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    name: <span class=\"string\">\"home\"</span>,</span><br><span class=\"line\">    path: <span class=\"string\">\"/userinfo\"</span>,</span><br><span class=\"line\">    component: <span class=\"string\">\"userInfo\"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// vuex 添加路由表</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> mutations = &#123;</span><br><span class=\"line\">  [ADD_ROUTES](state, addrouter) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> routes = []</span><br><span class=\"line\">      generaRouter(routes, addRouter)</span><br><span class=\"line\">      router.addRoutes(routes)  </span><br><span class=\"line\">      router.push(<span class=\"string\">'/'</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> actions = &#123;</span><br><span class=\"line\">  add_Routes(&#123;commit&#125;, addrouter) &#123;</span><br><span class=\"line\">      commit(ADD_ROUTES, addrouter)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">generaRouter</span>(<span class=\"params\">routers, data</span>)</span>&#123;</span><br><span class=\"line\">  data.forEach(<span class=\"function\">(<span class=\"params\">item</span>)=&gt;</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> menu = <span class=\"built_in\">Object</span>.assign(&#123;&#125;, item)</span><br><span class=\"line\">      menu.component = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> <span class=\"keyword\">import</span>(<span class=\"string\">`@/components/<span class=\"subst\">$&#123;menu.component&#125;</span>.vue`</span>)</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(item.children)&#123;</span><br><span class=\"line\">          menu.children = []</span><br><span class=\"line\">          generaRouter(menu.children,item.children)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      routers.push(menu)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// main.js 用户手动刷新页面时重新新增路由</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (sessionStorage.getItem(<span class=\"string\">'user'</span>)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> routes = <span class=\"built_in\">JSON</span>.parse(sessionStorage.getItem(<span class=\"string\">'routes'</span>))</span><br><span class=\"line\">    store.dispatch(<span class=\"string\">\"add_Routes\"</span>, routes)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"全局方法\"><a href=\"#全局方法\" class=\"headerlink\" title=\"全局方法\"></a>全局方法</h2><h3 id=\"CommonJS-方法\"><a href=\"#CommonJS-方法\" class=\"headerlink\" title=\"CommonJS 方法\"></a>CommonJS 方法</h3><blockquote><p>利用 CommonJS 思想单独封装，然后在组件中引用</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 引用</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; myMethod &#125; <span class=\"keyword\">from</span> <span class=\"string\">'assets/js/tool.js'</span></span><br><span class=\"line\">myMethod()</span><br></pre></td></tr></table></figure><h3 id=\"全局注册\"><a href=\"#全局注册\" class=\"headerlink\" title=\"全局注册\"></a>全局注册</h3><blockquote><p>在组件中直接使用</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 注册</span></span><br><span class=\"line\">Vue.protytpe.$myMethod = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">options</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"this is my method\"</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用</span></span><br><span class=\"line\"><span class=\"keyword\">this</span>.myMethod()</span><br></pre></td></tr></table></figure><h2 id=\"页面滚动\"><a href=\"#页面滚动\" class=\"headerlink\" title=\"页面滚动\"></a>页面滚动</h2><blockquote><p>垂直滚动到页面指定位置</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span>  scrollAnimation = <span class=\"function\">(<span class=\"params\">currentY, targetY, dom</span>) =&gt;</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 计算需要移动的距离</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> needScroll = targetY - currentY</span><br><span class=\"line\">  <span class=\"keyword\">let</span> _currentY = currentY</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 注意 window 滚动</span></span><br><span class=\"line\">  dom = dom ? dom : <span class=\"string\">'window'</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> dist = <span class=\"built_in\">Math</span>.ceil(needScroll / <span class=\"number\">10</span>)</span><br><span class=\"line\">      _currentY += dist</span><br><span class=\"line\">      dom.scrollTo(_currentY, currentY)</span><br><span class=\"line\">      <span class=\"comment\">// 如果移动幅度小于十个像素，直接移动，否则递归调用，实现动画效果</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (needScroll &amp;gt; <span class=\"number\">10</span> || needScroll &amp;lt; <span class=\"number\">-10</span>) &#123;</span><br><span class=\"line\">          scrollAnimation(_currentY, targetY, dom)</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          dom.scrollTo(currentY, targetY)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;, <span class=\"number\">10</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"页面刷新\"><a href=\"#页面刷新\" class=\"headerlink\" title=\"页面刷新\"></a>页面刷新</h2><ul><li><strong>router.go(0)</strong>：兼容性不好</li><li><strong>window.location.reload()</strong>：会清空 vuex 数据</li><li><p><strong>provice + inject</strong>：推荐使用</p><ol><li><p>根组件定义</p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// router-view v-if=\"isRouterAlive\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'App'</span>,</span><br><span class=\"line\">  provide ()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      reload: <span class=\"keyword\">this</span>.reload</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  data()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      isRouterAlive:<span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  methods:&#123;</span><br><span class=\"line\">    reload ()&#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.isRouterAlive = <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.$nextTick(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">this</span>.isRouterAlive = <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li><li><p>子组件引用</p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  inject: [<span class=\"string\">'reload'</span>],</span><br><span class=\"line\">  method: &#123;</span><br><span class=\"line\">      fn()&#123;</span><br><span class=\"line\">          <span class=\"keyword\">this</span>.reload()</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li></ol></li></ul><h2 id=\"组件数据\"><a href=\"#组件数据\" class=\"headerlink\" title=\"组件数据\"></a>组件数据</h2><h3 id=\"组件数据重置\"><a href=\"#组件数据重置\" class=\"headerlink\" title=\"组件数据重置\"></a>组件数据重置</h3><ul><li>表单：<code>this.form = this.$options.data().form</code></li><li>组件：<code>Object.assign(this.$data, this.$options.data())</code><ul><li>this.$data：获取当前状态下的 data</li><li>this.$options.data()：获取该组件初始状态下的 data</li></ul></li></ul><h3 id=\"数据更新问题\"><a href=\"#数据更新问题\" class=\"headerlink\" title=\"数据更新问题\"></a>数据更新问题</h3><blockquote><p>路由变化后页面数据不更新，原因是跳转前后使用同一个组件，vue-router 默认复用组件而没有执行 created 等生命周期钩子</p></blockquote><ul><li>普通方案<ul><li>监听 $route 变化来初始化数据</li><li><code>watch: { &#39;$route&#39;: {handler: &#39;resetData&#39;,immediate: true} }</code></li></ul></li><li>简单方案<ul><li>监听路由地址变化来重新创建组件</li><li><code>router-view :key=&quot;$route.fullpath&quot;</code></li></ul></li></ul><h2 id=\"组件缓存\"><a href=\"#组件缓存\" class=\"headerlink\" title=\"组件缓存\"></a>组件缓存</h2><blockquote><p>缓存组件只会在首次进入时执行一次生命周期钩子，再次进入则从缓存中获取数据等</p></blockquote><ul><li>全部缓存：keep-alive 标签包裹 router-view</li><li>部分缓存<ul><li>缓存 keep-alive include=”a, b”、不缓存 keep-alive exclude=”c, d”</li><li>路由配置 meta: { cache: true }，渲染时 keep-alive v-if=”$route.meta.cache”</li></ul></li></ul><h1 id=\"二、ElementUI\"><a href=\"#二、ElementUI\" class=\"headerlink\" title=\"二、ElementUI\"></a>二、ElementUI</h1><h2 id=\"el-input\"><a href=\"#el-input\" class=\"headerlink\" title=\"el-input\"></a>el-input</h2><ul><li>监听回车事件：<a href=\"mailto:`@keyup.enter.native\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">`@keyup.enter.native</a>=”doSearch”`</li><li>监听输入值<ul><li><code>v-on:input=&quot;doSearch&quot;</code></li><li>封装 input 之后无法直接监听原生事件，需要添加修饰符</li></ul></li><li>获取改变前的数据<ul><li>@change 方法一般传递参数之后就会覆盖原本的数据</li><li>两种方案<ul><li><code>el-input @change=&quot;value =&gt; changeVal(value, scope.row)&quot;</code></li><li><code>el-input @change=&quot;changeVal($event, scope.row, scope.$index)&quot;</code></li></ul></li></ul></li></ul><!-- rebuild by neat -->"},{"title":"jQuery 基础使用","top":false,"keywords":["js","jquery"],"date":"2019-03-16T14:04:14.000Z","description":"基础概念、选择器、操作、事件机制、插件机制","_content":"\n# 一、基础概念\n> 一个 javascript 库，它把常用方法封装到一个js文件中，需要时直接调用即可\n\n##  入口函数\n  1. js\n    * 主流：`window.onload = function(){ }`\n  2. jquery\n    * 主流：`$(\"document\").ready(function(){ })`   \n    * 简化：`$(function(){ })`\n  3. 区别\n    * 书写个数不同：前者只能出现一次并且会被覆盖，后者可出现任意多次且不存在事件覆盖\n    * 执行时机不同：前者在文档树加载完成之后还必须 等待图片等所有资源加载完成后才会执行，而后者在文档树加载完成时执行\n\n\n## $ 符号\n<div style=\"text-indent: 2em\"> jQuery 的别名，本质是一个函数，调用时通过传入不同参数而实现不同功能，可传参数如下：</div>\n  \n  * 字符串：`$(\"#id\")`\n  * DOM 对象：`$(domObj)` \n  * function：`$(function(){ })`\n\n\n## 对象转换   \n  * DOM 转为 jq：`var $btn = $(btn)`\n  * jq 转为 DOM：`var btn = $btn[0] / $btn.get(0)`\n\n\n# 二、常用选择器\n  * 基础：`$(\".class\")、$(\"#id\")、$(\"tagName\")、$('li.active')、$('li, .active')、$(\"li span\")、$(\"li>span\")`\n  * 过滤：`$('p:first')、$(':empty')、$('p:hidden')、$(\"div[id^='code']\")、$(\"li:odd\")、$(\"li:eq(0)\")、$(\"ul:nth-child(0)\"、$(\"ul:first-child\")`\n  *  筛选：`children、find、next、siblings、parent、closest、filter、not、has、eq`\n\n\n# 三、操作样式\n## css操作\n  * 获取单个样式：`css(\"width\")`\n  * 设置单个样式：`css(\"width\", \"20\")`\n  * 设置多个样式：`css({\"color\": \"red\", \"w\": \"10px\"})`\n\n## class操作\n  * 添加：`addClass()`   \n  * 移除：`removeClass()`，不传参数则移除所有的样式\n  * 切换：`toggleClass()`，没有则添加\n  * 判断：`hasClass()、is()`\n\n\n# 四、动画\n  * 显示隐藏：`show/hide(speed, callback)`\n  * 滑入滑出：`slideDown/Up/Toggle(speed, callback)`\n  * 淡出淡入：`fadeIn/Out/Toggle(speed, callback)`\n  * 自定义动画：`animate(prop, speed, easing, callback)` \n\n\n# 五、操作 DOM\n\n  * 创建：`var $h3 = $('h3标签')`\n  * 插入\n    * `$('父').append/prepend('子')`\n    * `$('子').appendTo('父')`\n    * `$('同胞').before/after('插入同胞')` \n    * `$('插入同胞').insertBefore/After('同胞')`\n  * 删除：`$('#box').remove()、$('ul').remove('l1')`\n  * 克隆：`$('h3').clone()`，传入 true 时克隆结构加事件，否则只克隆结构 \n  * 清空子元素：`empty()、html(\"\")`，后者不会清理子元素事件而造成内存泄漏，不推荐使用\n  \n\n\n# 六、操作属性\n  * 读取属性：`attr(name)`\n  * 移除属性：`removeAttr(name)` \n  * 设置单个属性：`$(\"img\").attr(‘src’, ‘test.jpg’)`\n  * 设置多个属性：`$('div').attr({'class': 'a', 'style': 'color: red;'})`\n  * 方法区别\n    * 操作元素的固有属性：`prop`\n    * 处理元素的自定义属性：`attr`\n\n   \n# 七、操作内容\n  * 表单元素：`val(value)`\n  * 普通元素：`html(str)、text(str)` \n\n\n# 八、事件机制\n\n## 发展历程\n  1. 简单绑定：一次只能绑定一个事件，`click(handler)、scroll(handler)`\n  2. bind 绑定：不支持动态创建的元素绑定事件，`$(\"p\").bind(\"click mouseenter\", handler)`\n  3. on 绑定\n    * 自身绑定：`on(事件名称, 事件处理函数)`\n    * 事件委托`on(事件名称, 可选后代元素, 传递数据, 事件处理函数)`\n    * 事件解绑\n      * 解绑匹配元素的所有事件：`off()`\n      * 解绑匹配元素的所有 click 事件：`off(“click”)`\n      * 解绑元素所有代理的 click 事件但不解绑自身事件：`off( “click”, “**” )`\n    * 先解绑再绑定\n      * 功能：防止事件累加，导致点击一次而事件执行多次\n      * 实现：`$(\"#btn\").off(\"click\").on(\"click\", callback)`\n\n\n## 事件触发\n  * 直接调用：`$(\"div\").click()`\n  * trigger：会触发浏览器默认操作，`$(\"input\").trigger(\"focus\")`\n  * triggerHandler：不会触发浏览器的默认行为，`$(\"input\").triggerHandler(\"focus\")`\n\n\n## 事件委托\n  * 把事件绑定在父元素上\n  * 点击子元素则触发事件冒泡\n  * 父元素的事件响应这个事件冒泡\n  * 响应事件冒泡时获取触发该事件的元素\n  * 如果该元素和 on 绑定的元素相匹配则触发事件处理函数\n  \n\n\n# 九、编程思想\n\n## js 与 jquery\n  * 可共存：`$('div').html()、div.innerHTML`\n  * 不可混用：`div.html()、$('div').innerHTML`\n  * 对应关系：`onclick 和 click()、innerHTML 和 html()`\n  * this 绑定：`fn(obj){ var $this = $(obj) }`\n\n## 链式编程\n  * 原理：`return this`\n  * 示例：`$('li').parent().css(\"width\", \"10px\").end().next().hide()`\n    \n\n## 隐式迭代\n  * 理解：方法内部为所有匹配元素进行循环遍历\n  * 注意：设置的是全部元素，获取的是第一个元素的值\n  * 示例：`$('div').css('color', 'red')、$('li').css('width')`\n \n\n## each 遍历\n  * 数组：`$.each(arr, function(i, v){ })`     \n  * 对象：`$.each(obj, function(key, val){ })`   \n  * 元素：`$('div').each(function(i, obj){ })`\n\n\n## 多库共存\n  1. 问题：如果引用的其他库也用到 $，则前面引入库中的 $ 会被覆盖\n  2. 解决\n    * 若想让其他库使用 $ 则可以把 jQuery 的 $ 给释放掉\n    * 同时存在多个版本的 jQuery 则可以使用 noConflict 来区分\n\n\n\n# 十、插件机制\n> 为 jQuery 原型添加功能函数来扩展功能\n\n\n## 插件开发\n  1. 类级别  \n    ```js\n    // 调用：$.hello()\n    (function($){\n        $.extend({\n            hello: function(){\n              console.log(\"hello world\")\n            }\n        })\n    })(jQuery)\n\n    // 调用：$.myExtend.hello() \n    (function($){\n        $.myExtend({\n            hello: function(){\n              console.log(\"hello world\")\n            } \n        })\n    })(jQuery)\n    ```\n  2. 对象级别\n    ```js\n    // 调用：$(\"#box\").myAnimate()\n    (function($){\n        // 写法一\n        $.fn.extend({\n            myAnimate: function(){ } \n        })\n        // 写法二\n        $.fn.myAnimate = function(){ }\n    })(jQuery) \n    ```\n\n\n## 插件模板\n  1. 分号：开头添加是为了避免别人的代码不规范引起错误，结尾添加是为了 避免压缩出错\n  2. 传参\n    * 没有第四个参数\n    * undefined：保证原生，防止他人把其定义为别的\n    * window、document：快速查找，而且也便于代码压缩，比如 window 可能被压缩为 w  \n    ```js\n    ;(function(win, doc, $, undefined){ \n        // 写法一\n        $.fn.extend({\n            \"pluginName\": function(opt){}\n        })\n\n        // 写法二\n        var defaults = { }\n        $.fn.pluginName = function(opt){\n          // 合并默认配置和用户配置\n          var set = $.extend({}, defaults, opt)\n\n          // 支持链式调用\n          return this; \n        } \n    }(window, document, jQuery))\n    ```\n\n \n## 方法\n  * `$.extend( obj )`：扩展 jquery 类本身，只有通过 jq/$ 类来调用\n  * `$.fn.extend( obj )`：扩展 jquery 原型对象，每个实例化的 jq 对象都可以调用\n  * `$.extend( target, [objN])`：使用一个或多个其他对象来扩展第一个对象\n  * 关系：`$.fn.pluginName = $.fn.extend(pluginName) = $.prototype.extend(pluginName)`\n\n\n\n","source":"_posts/7-jquery基础.md","raw":"---\ntitle: jQuery 基础使用\ntags:\n  - jQuery\ncategories: Javascript\ntop: false\nkeywords:\n  - js\n  - jquery\ndate: 2019-03-16 22:04:14 \ndescription: 基础概念、选择器、操作、事件机制、插件机制\n---\n\n# 一、基础概念\n> 一个 javascript 库，它把常用方法封装到一个js文件中，需要时直接调用即可\n\n##  入口函数\n  1. js\n    * 主流：`window.onload = function(){ }`\n  2. jquery\n    * 主流：`$(\"document\").ready(function(){ })`   \n    * 简化：`$(function(){ })`\n  3. 区别\n    * 书写个数不同：前者只能出现一次并且会被覆盖，后者可出现任意多次且不存在事件覆盖\n    * 执行时机不同：前者在文档树加载完成之后还必须 等待图片等所有资源加载完成后才会执行，而后者在文档树加载完成时执行\n\n\n## $ 符号\n<div style=\"text-indent: 2em\"> jQuery 的别名，本质是一个函数，调用时通过传入不同参数而实现不同功能，可传参数如下：</div>\n  \n  * 字符串：`$(\"#id\")`\n  * DOM 对象：`$(domObj)` \n  * function：`$(function(){ })`\n\n\n## 对象转换   \n  * DOM 转为 jq：`var $btn = $(btn)`\n  * jq 转为 DOM：`var btn = $btn[0] / $btn.get(0)`\n\n\n# 二、常用选择器\n  * 基础：`$(\".class\")、$(\"#id\")、$(\"tagName\")、$('li.active')、$('li, .active')、$(\"li span\")、$(\"li>span\")`\n  * 过滤：`$('p:first')、$(':empty')、$('p:hidden')、$(\"div[id^='code']\")、$(\"li:odd\")、$(\"li:eq(0)\")、$(\"ul:nth-child(0)\"、$(\"ul:first-child\")`\n  *  筛选：`children、find、next、siblings、parent、closest、filter、not、has、eq`\n\n\n# 三、操作样式\n## css操作\n  * 获取单个样式：`css(\"width\")`\n  * 设置单个样式：`css(\"width\", \"20\")`\n  * 设置多个样式：`css({\"color\": \"red\", \"w\": \"10px\"})`\n\n## class操作\n  * 添加：`addClass()`   \n  * 移除：`removeClass()`，不传参数则移除所有的样式\n  * 切换：`toggleClass()`，没有则添加\n  * 判断：`hasClass()、is()`\n\n\n# 四、动画\n  * 显示隐藏：`show/hide(speed, callback)`\n  * 滑入滑出：`slideDown/Up/Toggle(speed, callback)`\n  * 淡出淡入：`fadeIn/Out/Toggle(speed, callback)`\n  * 自定义动画：`animate(prop, speed, easing, callback)` \n\n\n# 五、操作 DOM\n\n  * 创建：`var $h3 = $('h3标签')`\n  * 插入\n    * `$('父').append/prepend('子')`\n    * `$('子').appendTo('父')`\n    * `$('同胞').before/after('插入同胞')` \n    * `$('插入同胞').insertBefore/After('同胞')`\n  * 删除：`$('#box').remove()、$('ul').remove('l1')`\n  * 克隆：`$('h3').clone()`，传入 true 时克隆结构加事件，否则只克隆结构 \n  * 清空子元素：`empty()、html(\"\")`，后者不会清理子元素事件而造成内存泄漏，不推荐使用\n  \n\n\n# 六、操作属性\n  * 读取属性：`attr(name)`\n  * 移除属性：`removeAttr(name)` \n  * 设置单个属性：`$(\"img\").attr(‘src’, ‘test.jpg’)`\n  * 设置多个属性：`$('div').attr({'class': 'a', 'style': 'color: red;'})`\n  * 方法区别\n    * 操作元素的固有属性：`prop`\n    * 处理元素的自定义属性：`attr`\n\n   \n# 七、操作内容\n  * 表单元素：`val(value)`\n  * 普通元素：`html(str)、text(str)` \n\n\n# 八、事件机制\n\n## 发展历程\n  1. 简单绑定：一次只能绑定一个事件，`click(handler)、scroll(handler)`\n  2. bind 绑定：不支持动态创建的元素绑定事件，`$(\"p\").bind(\"click mouseenter\", handler)`\n  3. on 绑定\n    * 自身绑定：`on(事件名称, 事件处理函数)`\n    * 事件委托`on(事件名称, 可选后代元素, 传递数据, 事件处理函数)`\n    * 事件解绑\n      * 解绑匹配元素的所有事件：`off()`\n      * 解绑匹配元素的所有 click 事件：`off(“click”)`\n      * 解绑元素所有代理的 click 事件但不解绑自身事件：`off( “click”, “**” )`\n    * 先解绑再绑定\n      * 功能：防止事件累加，导致点击一次而事件执行多次\n      * 实现：`$(\"#btn\").off(\"click\").on(\"click\", callback)`\n\n\n## 事件触发\n  * 直接调用：`$(\"div\").click()`\n  * trigger：会触发浏览器默认操作，`$(\"input\").trigger(\"focus\")`\n  * triggerHandler：不会触发浏览器的默认行为，`$(\"input\").triggerHandler(\"focus\")`\n\n\n## 事件委托\n  * 把事件绑定在父元素上\n  * 点击子元素则触发事件冒泡\n  * 父元素的事件响应这个事件冒泡\n  * 响应事件冒泡时获取触发该事件的元素\n  * 如果该元素和 on 绑定的元素相匹配则触发事件处理函数\n  \n\n\n# 九、编程思想\n\n## js 与 jquery\n  * 可共存：`$('div').html()、div.innerHTML`\n  * 不可混用：`div.html()、$('div').innerHTML`\n  * 对应关系：`onclick 和 click()、innerHTML 和 html()`\n  * this 绑定：`fn(obj){ var $this = $(obj) }`\n\n## 链式编程\n  * 原理：`return this`\n  * 示例：`$('li').parent().css(\"width\", \"10px\").end().next().hide()`\n    \n\n## 隐式迭代\n  * 理解：方法内部为所有匹配元素进行循环遍历\n  * 注意：设置的是全部元素，获取的是第一个元素的值\n  * 示例：`$('div').css('color', 'red')、$('li').css('width')`\n \n\n## each 遍历\n  * 数组：`$.each(arr, function(i, v){ })`     \n  * 对象：`$.each(obj, function(key, val){ })`   \n  * 元素：`$('div').each(function(i, obj){ })`\n\n\n## 多库共存\n  1. 问题：如果引用的其他库也用到 $，则前面引入库中的 $ 会被覆盖\n  2. 解决\n    * 若想让其他库使用 $ 则可以把 jQuery 的 $ 给释放掉\n    * 同时存在多个版本的 jQuery 则可以使用 noConflict 来区分\n\n\n\n# 十、插件机制\n> 为 jQuery 原型添加功能函数来扩展功能\n\n\n## 插件开发\n  1. 类级别  \n    ```js\n    // 调用：$.hello()\n    (function($){\n        $.extend({\n            hello: function(){\n              console.log(\"hello world\")\n            }\n        })\n    })(jQuery)\n\n    // 调用：$.myExtend.hello() \n    (function($){\n        $.myExtend({\n            hello: function(){\n              console.log(\"hello world\")\n            } \n        })\n    })(jQuery)\n    ```\n  2. 对象级别\n    ```js\n    // 调用：$(\"#box\").myAnimate()\n    (function($){\n        // 写法一\n        $.fn.extend({\n            myAnimate: function(){ } \n        })\n        // 写法二\n        $.fn.myAnimate = function(){ }\n    })(jQuery) \n    ```\n\n\n## 插件模板\n  1. 分号：开头添加是为了避免别人的代码不规范引起错误，结尾添加是为了 避免压缩出错\n  2. 传参\n    * 没有第四个参数\n    * undefined：保证原生，防止他人把其定义为别的\n    * window、document：快速查找，而且也便于代码压缩，比如 window 可能被压缩为 w  \n    ```js\n    ;(function(win, doc, $, undefined){ \n        // 写法一\n        $.fn.extend({\n            \"pluginName\": function(opt){}\n        })\n\n        // 写法二\n        var defaults = { }\n        $.fn.pluginName = function(opt){\n          // 合并默认配置和用户配置\n          var set = $.extend({}, defaults, opt)\n\n          // 支持链式调用\n          return this; \n        } \n    }(window, document, jQuery))\n    ```\n\n \n## 方法\n  * `$.extend( obj )`：扩展 jquery 类本身，只有通过 jq/$ 类来调用\n  * `$.fn.extend( obj )`：扩展 jquery 原型对象，每个实例化的 jq 对象都可以调用\n  * `$.extend( target, [objN])`：使用一个或多个其他对象来扩展第一个对象\n  * 关系：`$.fn.pluginName = $.fn.extend(pluginName) = $.prototype.extend(pluginName)`\n\n\n\n","slug":"7-jquery基础","published":1,"updated":"2019-04-06T14:19:35.383Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvid4phf00020nbxhhdu42be","content":"<!-- build time:Sat May 11 2019 01:36:57 GMT+0800 (中国标准时间) --><html><head></head><body><h1 id=\"一、基础概念\"><a href=\"#一、基础概念\" class=\"headerlink\" title=\"一、基础概念\"></a>一、基础概念</h1><blockquote><p>一个 javascript 库，它把常用方法封装到一个js文件中，需要时直接调用即可</p></blockquote><h2 id=\"入口函数\"><a href=\"#入口函数\" class=\"headerlink\" title=\"入口函数\"></a>入口函数</h2><ol><li>js<ul><li>主流：<code>window.onload = function(){ }</code></li></ul></li><li>jquery<ul><li>主流：<code>$(\"document\").ready(function(){ })</code></li><li>简化：<code>$(function(){ })</code></li></ul></li><li>区别<ul><li>书写个数不同：前者只能出现一次并且会被覆盖，后者可出现任意多次且不存在事件覆盖</li><li>执行时机不同：前者在文档树加载完成之后还必须 等待图片等所有资源加载完成后才会执行，而后者在文档树加载完成时执行</li></ul></li></ol><h2 id=\"符号\"><a href=\"#符号\" class=\"headerlink\" title=\"$ 符号\"></a>$ 符号</h2><div style=\"text-indent:2em\">jQuery 的别名，本质是一个函数，调用时通过传入不同参数而实现不同功能，可传参数如下：</div><ul><li>字符串：<code>$(\"#id\")</code></li><li>DOM 对象：<code>$(domObj)</code></li><li>function：<code>$(function(){ })</code></li></ul><h2 id=\"对象转换\"><a href=\"#对象转换\" class=\"headerlink\" title=\"对象转换\"></a>对象转换</h2><ul><li>DOM 转为 jq：<code>var $btn = $(btn)</code></li><li>jq 转为 DOM：<code>var btn = $btn[0] / $btn.get(0)</code></li></ul><h1 id=\"二、常用选择器\"><a href=\"#二、常用选择器\" class=\"headerlink\" title=\"二、常用选择器\"></a>二、常用选择器</h1><ul><li>基础：<code>$(\".class\")、$(\"#id\")、$(\"tagName\")、$('li.active')、$('li, .active')、$(\"li span\")、$(\"li>span\")</code></li><li>过滤：<code>$('p:first')、$(':empty')、$('p:hidden')、$(\"div[id^='code']\")、$(\"li:odd\")、$(\"li:eq(0)\")、$(\"ul:nth-child(0)\"、$(\"ul:first-child\")</code></li><li>筛选：<code>children、find、next、siblings、parent、closest、filter、not、has、eq</code></li></ul><h1 id=\"三、操作样式\"><a href=\"#三、操作样式\" class=\"headerlink\" title=\"三、操作样式\"></a>三、操作样式</h1><h2 id=\"css操作\"><a href=\"#css操作\" class=\"headerlink\" title=\"css操作\"></a>css操作</h2><ul><li>获取单个样式：<code>css(\"width\")</code></li><li>设置单个样式：<code>css(\"width\", \"20\")</code></li><li>设置多个样式：<code>css({\"color\": \"red\", \"w\": \"10px\"})</code></li></ul><h2 id=\"class操作\"><a href=\"#class操作\" class=\"headerlink\" title=\"class操作\"></a>class操作</h2><ul><li>添加：<code>addClass()</code></li><li>移除：<code>removeClass()</code>，不传参数则移除所有的样式</li><li>切换：<code>toggleClass()</code>，没有则添加</li><li>判断：<code>hasClass()、is()</code></li></ul><h1 id=\"四、动画\"><a href=\"#四、动画\" class=\"headerlink\" title=\"四、动画\"></a>四、动画</h1><ul><li>显示隐藏：<code>show/hide(speed, callback)</code></li><li>滑入滑出：<code>slideDown/Up/Toggle(speed, callback)</code></li><li>淡出淡入：<code>fadeIn/Out/Toggle(speed, callback)</code></li><li>自定义动画：<code>animate(prop, speed, easing, callback)</code></li></ul><h1 id=\"五、操作-DOM\"><a href=\"#五、操作-DOM\" class=\"headerlink\" title=\"五、操作 DOM\"></a>五、操作 DOM</h1><ul><li>创建：<code>var $h3 = $('h3标签')</code></li><li>插入<ul><li><code>$('父').append/prepend('子')</code></li><li><code>$('子').appendTo('父')</code></li><li><code>$('同胞').before/after('插入同胞')</code></li><li><code>$('插入同胞').insertBefore/After('同胞')</code></li></ul></li><li>删除：<code>$('#box').remove()、$('ul').remove('l1')</code></li><li>克隆：<code>$('h3').clone()</code>，传入 true 时克隆结构加事件，否则只克隆结构</li><li>清空子元素：<code>empty()、html(\"\")</code>，后者不会清理子元素事件而造成内存泄漏，不推荐使用</li></ul><h1 id=\"六、操作属性\"><a href=\"#六、操作属性\" class=\"headerlink\" title=\"六、操作属性\"></a>六、操作属性</h1><ul><li>读取属性：<code>attr(name)</code></li><li>移除属性：<code>removeAttr(name)</code></li><li>设置单个属性：<code>$(\"img\").attr(‘src’, ‘test.jpg’)</code></li><li>设置多个属性：<code>$('div').attr({'class': 'a', 'style': 'color: red;'})</code></li><li>方法区别<ul><li>操作元素的固有属性：<code>prop</code></li><li>处理元素的自定义属性：<code>attr</code></li></ul></li></ul><h1 id=\"七、操作内容\"><a href=\"#七、操作内容\" class=\"headerlink\" title=\"七、操作内容\"></a>七、操作内容</h1><ul><li>表单元素：<code>val(value)</code></li><li>普通元素：<code>html(str)、text(str)</code></li></ul><h1 id=\"八、事件机制\"><a href=\"#八、事件机制\" class=\"headerlink\" title=\"八、事件机制\"></a>八、事件机制</h1><h2 id=\"发展历程\"><a href=\"#发展历程\" class=\"headerlink\" title=\"发展历程\"></a>发展历程</h2><ol><li>简单绑定：一次只能绑定一个事件，<code>click(handler)、scroll(handler)</code></li><li>bind 绑定：不支持动态创建的元素绑定事件，<code>$(\"p\").bind(\"click mouseenter\", handler)</code></li><li>on 绑定<ul><li>自身绑定：<code>on(事件名称, 事件处理函数)</code></li><li>事件委托<code>on(事件名称, 可选后代元素, 传递数据, 事件处理函数)</code></li><li>事件解绑<ul><li>解绑匹配元素的所有事件：<code>off()</code></li><li>解绑匹配元素的所有 click 事件：<code>off(“click”)</code></li><li>解绑元素所有代理的 click 事件但不解绑自身事件：<code>off( “click”, “**” )</code></li></ul></li><li>先解绑再绑定<ul><li>功能：防止事件累加，导致点击一次而事件执行多次</li><li>实现：<code>$(\"#btn\").off(\"click\").on(\"click\", callback)</code></li></ul></li></ul></li></ol><h2 id=\"事件触发\"><a href=\"#事件触发\" class=\"headerlink\" title=\"事件触发\"></a>事件触发</h2><ul><li>直接调用：<code>$(\"div\").click()</code></li><li>trigger：会触发浏览器默认操作，<code>$(\"input\").trigger(\"focus\")</code></li><li>triggerHandler：不会触发浏览器的默认行为，<code>$(\"input\").triggerHandler(\"focus\")</code></li></ul><h2 id=\"事件委托\"><a href=\"#事件委托\" class=\"headerlink\" title=\"事件委托\"></a>事件委托</h2><ul><li>把事件绑定在父元素上</li><li>点击子元素则触发事件冒泡</li><li>父元素的事件响应这个事件冒泡</li><li>响应事件冒泡时获取触发该事件的元素</li><li>如果该元素和 on 绑定的元素相匹配则触发事件处理函数</li></ul><h1 id=\"九、编程思想\"><a href=\"#九、编程思想\" class=\"headerlink\" title=\"九、编程思想\"></a>九、编程思想</h1><h2 id=\"js-与-jquery\"><a href=\"#js-与-jquery\" class=\"headerlink\" title=\"js 与 jquery\"></a>js 与 jquery</h2><ul><li>可共存：<code>$('div').html()、div.innerHTML</code></li><li>不可混用：<code>div.html()、$('div').innerHTML</code></li><li>对应关系：<code>onclick 和 click()、innerHTML 和 html()</code></li><li>this 绑定：<code>fn(obj){ var $this = $(obj) }</code></li></ul><h2 id=\"链式编程\"><a href=\"#链式编程\" class=\"headerlink\" title=\"链式编程\"></a>链式编程</h2><ul><li>原理：<code>return this</code></li><li>示例：<code>$('li').parent().css(\"width\", \"10px\").end().next().hide()</code></li></ul><h2 id=\"隐式迭代\"><a href=\"#隐式迭代\" class=\"headerlink\" title=\"隐式迭代\"></a>隐式迭代</h2><ul><li>理解：方法内部为所有匹配元素进行循环遍历</li><li>注意：设置的是全部元素，获取的是第一个元素的值</li><li>示例：<code>$('div').css('color', 'red')、$('li').css('width')</code></li></ul><h2 id=\"each-遍历\"><a href=\"#each-遍历\" class=\"headerlink\" title=\"each 遍历\"></a>each 遍历</h2><ul><li>数组：<code>$.each(arr, function(i, v){ })</code></li><li>对象：<code>$.each(obj, function(key, val){ })</code></li><li>元素：<code>$('div').each(function(i, obj){ })</code></li></ul><h2 id=\"多库共存\"><a href=\"#多库共存\" class=\"headerlink\" title=\"多库共存\"></a>多库共存</h2><ol><li>问题：如果引用的其他库也用到 $，则前面引入库中的 $ 会被覆盖</li><li>解决<ul><li>若想让其他库使用 $ 则可以把 jQuery 的 $ 给释放掉</li><li>同时存在多个版本的 jQuery 则可以使用 noConflict 来区分</li></ul></li></ol><h1 id=\"十、插件机制\"><a href=\"#十、插件机制\" class=\"headerlink\" title=\"十、插件机制\"></a>十、插件机制</h1><blockquote><p>为 jQuery 原型添加功能函数来扩展功能</p></blockquote><h2 id=\"插件开发\"><a href=\"#插件开发\" class=\"headerlink\" title=\"插件开发\"></a>插件开发</h2><ol><li><p>类级别</p><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 调用：$.hello()</span></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">$</span>)</span>{</span><br><span class=\"line\">    $.extend({</span><br><span class=\"line\">        hello: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(<span class=\"string\">\"hello world\"</span>)</span><br><span class=\"line\">        }</span><br><span class=\"line\">    })</span><br><span class=\"line\">})(jQuery)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 调用：$.myExtend.hello() </span></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">$</span>)</span>{</span><br><span class=\"line\">    $.myExtend({</span><br><span class=\"line\">        hello: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(<span class=\"string\">\"hello world\"</span>)</span><br><span class=\"line\">        } </span><br><span class=\"line\">    })</span><br><span class=\"line\">})(jQuery)</span><br></pre></td></tr></tbody></table></figure></li><li><p>对象级别</p><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 调用：$(\"#box\").myAnimate()</span></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">$</span>)</span>{</span><br><span class=\"line\">    <span class=\"comment\">// 写法一</span></span><br><span class=\"line\">    $.fn.extend({</span><br><span class=\"line\">        myAnimate: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{ } </span><br><span class=\"line\">    })</span><br><span class=\"line\">    <span class=\"comment\">// 写法二</span></span><br><span class=\"line\">    $.fn.myAnimate = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{ }</span><br><span class=\"line\">})(jQuery)</span><br></pre></td></tr></tbody></table></figure></li></ol><h2 id=\"插件模板\"><a href=\"#插件模板\" class=\"headerlink\" title=\"插件模板\"></a>插件模板</h2><ol><li>分号：开头添加是为了避免别人的代码不规范引起错误，结尾添加是为了 避免压缩出错</li><li>传参<ul><li>没有第四个参数</li><li>undefined：保证原生，防止他人把其定义为别的</li><li>window、document：快速查找，而且也便于代码压缩，比如 window 可能被压缩为 w<figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">;(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">win, doc, $, undefined</span>)</span>{ </span><br><span class=\"line\">    <span class=\"comment\">// 写法一</span></span><br><span class=\"line\">    $.fn.extend({</span><br><span class=\"line\">        <span class=\"string\">\"pluginName\"</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">opt</span>)</span>{}</span><br><span class=\"line\">    })</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 写法二</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> defaults = { }</span><br><span class=\"line\">    $.fn.pluginName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">opt</span>)</span>{</span><br><span class=\"line\">      <span class=\"comment\">// 合并默认配置和用户配置</span></span><br><span class=\"line\">      <span class=\"keyword\">var</span> <span class=\"keyword\">set</span> = $.extend({}, defaults, opt)</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// 支持链式调用</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>; </span><br><span class=\"line\">    } </span><br><span class=\"line\">}(<span class=\"built_in\">window</span>, <span class=\"built_in\">document</span>, jQuery))</span><br></pre></td></tr></tbody></table></figure></li></ul></li></ol><h2 id=\"方法\"><a href=\"#方法\" class=\"headerlink\" title=\"方法\"></a>方法</h2><ul><li><code>$.extend( obj )</code>：扩展 jquery 类本身，只有通过 jq/$ 类来调用</li><li><code>$.fn.extend( obj )</code>：扩展 jquery 原型对象，每个实例化的 jq 对象都可以调用</li><li><code>$.extend( target, [objN])</code>：使用一个或多个其他对象来扩展第一个对象</li><li>关系：<code>$.fn.pluginName = $.fn.extend(pluginName) = $.prototype.extend(pluginName)</code></li></ul><!-- rebuild by neat --></body></html>","site":{"data":{"next":{"override":false,"cache":{"enable":true},"favicon":{"small":"/images/favicon-16.ico","medium":"/images/favicon-32.ico","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"rss":"/atom.xml","footer":{"since":2019,"icon":{"name":"snowflake-o","animated":false,"color":"#808080"},"copyright":"chuangge","powered":{"enable":false,"version":true},"theme":{"enable":false,"version":true},"beian":{"enable":false,"icp":null}},"creative_commons":{"license":"by-nc-sa","sidebar":false,"post":false},"canonical":true,"seo":false,"index_with_subtitle":false,"exturl":false,"menu":{"home":"/ || home  //首页","tags":"/tags/ || tags  //标签","categories":"/categories/ || th   //分类","archives":"/archives/ || archive //归档"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":{"GitHub":"https://github.com/ || github","StackOverflow":"https://stackoverflow.com/ || stack-overflow"},"social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"友情链接","links_layout":"inline","links":{"个人简历":"https://chuanggefighting.github.io/project/","印记中文":"https://www.docschina.org/","在线工具":"http://tool.lu/","Learn Anything":"https://learn-anything.xyz/"},"avatar":{"url":"/images/chuang.png","rounded":true,"opacity":1,"rotated":true},"toc":{"enable":true,"number":true,"wrap":false,"max_depth":6},"sidebar":{"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"read_more_btn":true,"post_meta":{"item_text":true,"created_at":true,"updated_at":{"enabled":true,"another_day":true},"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":true,"awl":4,"wpm":275},"codeblock":{"border_radius":null,"copy_button":{"enable":false,"show_result":false}},"reward":{"enable":false},"related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_edit":{"enable":false,"url":"https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name"},"disable_baidu_tranformation":false,"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"font":{"enable":true,"host":"//fonts.proxy.ustclug.org","global":{"external":true,"family":"Lato","size":16},"headings":{"external":true,"family":"Roboto Slab","size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":"Lobster Two","size":24},"codes":{"external":true,"family":"Roboto Mono","size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css","copy_tex":{"enable":false,"copy_tex_js":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js","copy_tex_css":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css"}}},"pdf":{"enable":false,"per_page":true,"height":"500px","pdfobject":{"cdn":"//cdn.jsdelivr.net/npm/pdfobject@2.1.1/pdfobject.min.js"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":true,"appid":"snOvapuSplYTVflf5p9Ml9JX-gzGzoHsz","appkey":"5ABGdfyEdAtu6lTXdGdo7hf9","notify":false,"verify":false,"placeholder":"ヾﾉ≧∀≦)o 来呀！吐槽一番吧！","avatar":"mm","guest_info":"nick,mail,link","pageSize":10,"visitor":false,"comment_count":true},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"gitalk":{"enable":false,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true},"needmoreshare2":{"enable":true,"postbottom":{"enable":true,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null,"security":false,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":true,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":true,"pace_theme":"pace-theme-center-simple","canvas_nest":{"enable":true,"onmobile":true,"color":"0,0,255","opacity":0.5,"zIndex":-1,"count":99},"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"canvas_nest_nomobile":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"leancloud":null,"valine":null,"gitalk_js":null,"gitalk_css":null,"md5":null},"css":"css","js":"js","images":"images","passage_end_tag":{"enabled":true},"daovoice":true,"daovoice_app_id":"2ed51855"}}},"excerpt":"","more":"<!-- build time:Sat May 11 2019 01:36:57 GMT+0800 (中国标准时间) --><h1 id=\"一、基础概念\"><a href=\"#一、基础概念\" class=\"headerlink\" title=\"一、基础概念\"></a>一、基础概念</h1><blockquote><p>一个 javascript 库，它把常用方法封装到一个js文件中，需要时直接调用即可</p></blockquote><h2 id=\"入口函数\"><a href=\"#入口函数\" class=\"headerlink\" title=\"入口函数\"></a>入口函数</h2><ol><li>js<ul><li>主流：<code>window.onload = function(){ }</code></li></ul></li><li>jquery<ul><li>主流：<code>$(&quot;document&quot;).ready(function(){ })</code></li><li>简化：<code>$(function(){ })</code></li></ul></li><li>区别<ul><li>书写个数不同：前者只能出现一次并且会被覆盖，后者可出现任意多次且不存在事件覆盖</li><li>执行时机不同：前者在文档树加载完成之后还必须 等待图片等所有资源加载完成后才会执行，而后者在文档树加载完成时执行</li></ul></li></ol><h2 id=\"符号\"><a href=\"#符号\" class=\"headerlink\" title=\"$ 符号\"></a>$ 符号</h2><div style=\"text-indent:2em\">jQuery 的别名，本质是一个函数，调用时通过传入不同参数而实现不同功能，可传参数如下：</div><ul><li>字符串：<code>$(&quot;#id&quot;)</code></li><li>DOM 对象：<code>$(domObj)</code></li><li>function：<code>$(function(){ })</code></li></ul><h2 id=\"对象转换\"><a href=\"#对象转换\" class=\"headerlink\" title=\"对象转换\"></a>对象转换</h2><ul><li>DOM 转为 jq：<code>var $btn = $(btn)</code></li><li>jq 转为 DOM：<code>var btn = $btn[0] / $btn.get(0)</code></li></ul><h1 id=\"二、常用选择器\"><a href=\"#二、常用选择器\" class=\"headerlink\" title=\"二、常用选择器\"></a>二、常用选择器</h1><ul><li>基础：<code>$(&quot;.class&quot;)、$(&quot;#id&quot;)、$(&quot;tagName&quot;)、$(&#39;li.active&#39;)、$(&#39;li, .active&#39;)、$(&quot;li span&quot;)、$(&quot;li&gt;span&quot;)</code></li><li>过滤：<code>$(&#39;p:first&#39;)、$(&#39;:empty&#39;)、$(&#39;p:hidden&#39;)、$(&quot;div[id^=&#39;code&#39;]&quot;)、$(&quot;li:odd&quot;)、$(&quot;li:eq(0)&quot;)、$(&quot;ul:nth-child(0)&quot;、$(&quot;ul:first-child&quot;)</code></li><li>筛选：<code>children、find、next、siblings、parent、closest、filter、not、has、eq</code></li></ul><h1 id=\"三、操作样式\"><a href=\"#三、操作样式\" class=\"headerlink\" title=\"三、操作样式\"></a>三、操作样式</h1><h2 id=\"css操作\"><a href=\"#css操作\" class=\"headerlink\" title=\"css操作\"></a>css操作</h2><ul><li>获取单个样式：<code>css(&quot;width&quot;)</code></li><li>设置单个样式：<code>css(&quot;width&quot;, &quot;20&quot;)</code></li><li>设置多个样式：<code>css({&quot;color&quot;: &quot;red&quot;, &quot;w&quot;: &quot;10px&quot;})</code></li></ul><h2 id=\"class操作\"><a href=\"#class操作\" class=\"headerlink\" title=\"class操作\"></a>class操作</h2><ul><li>添加：<code>addClass()</code></li><li>移除：<code>removeClass()</code>，不传参数则移除所有的样式</li><li>切换：<code>toggleClass()</code>，没有则添加</li><li>判断：<code>hasClass()、is()</code></li></ul><h1 id=\"四、动画\"><a href=\"#四、动画\" class=\"headerlink\" title=\"四、动画\"></a>四、动画</h1><ul><li>显示隐藏：<code>show/hide(speed, callback)</code></li><li>滑入滑出：<code>slideDown/Up/Toggle(speed, callback)</code></li><li>淡出淡入：<code>fadeIn/Out/Toggle(speed, callback)</code></li><li>自定义动画：<code>animate(prop, speed, easing, callback)</code></li></ul><h1 id=\"五、操作-DOM\"><a href=\"#五、操作-DOM\" class=\"headerlink\" title=\"五、操作 DOM\"></a>五、操作 DOM</h1><ul><li>创建：<code>var $h3 = $(&#39;h3标签&#39;)</code></li><li>插入<ul><li><code>$(&#39;父&#39;).append/prepend(&#39;子&#39;)</code></li><li><code>$(&#39;子&#39;).appendTo(&#39;父&#39;)</code></li><li><code>$(&#39;同胞&#39;).before/after(&#39;插入同胞&#39;)</code></li><li><code>$(&#39;插入同胞&#39;).insertBefore/After(&#39;同胞&#39;)</code></li></ul></li><li>删除：<code>$(&#39;#box&#39;).remove()、$(&#39;ul&#39;).remove(&#39;l1&#39;)</code></li><li>克隆：<code>$(&#39;h3&#39;).clone()</code>，传入 true 时克隆结构加事件，否则只克隆结构</li><li>清空子元素：<code>empty()、html(&quot;&quot;)</code>，后者不会清理子元素事件而造成内存泄漏，不推荐使用</li></ul><h1 id=\"六、操作属性\"><a href=\"#六、操作属性\" class=\"headerlink\" title=\"六、操作属性\"></a>六、操作属性</h1><ul><li>读取属性：<code>attr(name)</code></li><li>移除属性：<code>removeAttr(name)</code></li><li>设置单个属性：<code>$(&quot;img&quot;).attr(‘src’, ‘test.jpg’)</code></li><li>设置多个属性：<code>$(&#39;div&#39;).attr({&#39;class&#39;: &#39;a&#39;, &#39;style&#39;: &#39;color: red;&#39;})</code></li><li>方法区别<ul><li>操作元素的固有属性：<code>prop</code></li><li>处理元素的自定义属性：<code>attr</code></li></ul></li></ul><h1 id=\"七、操作内容\"><a href=\"#七、操作内容\" class=\"headerlink\" title=\"七、操作内容\"></a>七、操作内容</h1><ul><li>表单元素：<code>val(value)</code></li><li>普通元素：<code>html(str)、text(str)</code></li></ul><h1 id=\"八、事件机制\"><a href=\"#八、事件机制\" class=\"headerlink\" title=\"八、事件机制\"></a>八、事件机制</h1><h2 id=\"发展历程\"><a href=\"#发展历程\" class=\"headerlink\" title=\"发展历程\"></a>发展历程</h2><ol><li>简单绑定：一次只能绑定一个事件，<code>click(handler)、scroll(handler)</code></li><li>bind 绑定：不支持动态创建的元素绑定事件，<code>$(&quot;p&quot;).bind(&quot;click mouseenter&quot;, handler)</code></li><li>on 绑定<ul><li>自身绑定：<code>on(事件名称, 事件处理函数)</code></li><li>事件委托<code>on(事件名称, 可选后代元素, 传递数据, 事件处理函数)</code></li><li>事件解绑<ul><li>解绑匹配元素的所有事件：<code>off()</code></li><li>解绑匹配元素的所有 click 事件：<code>off(“click”)</code></li><li>解绑元素所有代理的 click 事件但不解绑自身事件：<code>off( “click”, “**” )</code></li></ul></li><li>先解绑再绑定<ul><li>功能：防止事件累加，导致点击一次而事件执行多次</li><li>实现：<code>$(&quot;#btn&quot;).off(&quot;click&quot;).on(&quot;click&quot;, callback)</code></li></ul></li></ul></li></ol><h2 id=\"事件触发\"><a href=\"#事件触发\" class=\"headerlink\" title=\"事件触发\"></a>事件触发</h2><ul><li>直接调用：<code>$(&quot;div&quot;).click()</code></li><li>trigger：会触发浏览器默认操作，<code>$(&quot;input&quot;).trigger(&quot;focus&quot;)</code></li><li>triggerHandler：不会触发浏览器的默认行为，<code>$(&quot;input&quot;).triggerHandler(&quot;focus&quot;)</code></li></ul><h2 id=\"事件委托\"><a href=\"#事件委托\" class=\"headerlink\" title=\"事件委托\"></a>事件委托</h2><ul><li>把事件绑定在父元素上</li><li>点击子元素则触发事件冒泡</li><li>父元素的事件响应这个事件冒泡</li><li>响应事件冒泡时获取触发该事件的元素</li><li>如果该元素和 on 绑定的元素相匹配则触发事件处理函数</li></ul><h1 id=\"九、编程思想\"><a href=\"#九、编程思想\" class=\"headerlink\" title=\"九、编程思想\"></a>九、编程思想</h1><h2 id=\"js-与-jquery\"><a href=\"#js-与-jquery\" class=\"headerlink\" title=\"js 与 jquery\"></a>js 与 jquery</h2><ul><li>可共存：<code>$(&#39;div&#39;).html()、div.innerHTML</code></li><li>不可混用：<code>div.html()、$(&#39;div&#39;).innerHTML</code></li><li>对应关系：<code>onclick 和 click()、innerHTML 和 html()</code></li><li>this 绑定：<code>fn(obj){ var $this = $(obj) }</code></li></ul><h2 id=\"链式编程\"><a href=\"#链式编程\" class=\"headerlink\" title=\"链式编程\"></a>链式编程</h2><ul><li>原理：<code>return this</code></li><li>示例：<code>$(&#39;li&#39;).parent().css(&quot;width&quot;, &quot;10px&quot;).end().next().hide()</code></li></ul><h2 id=\"隐式迭代\"><a href=\"#隐式迭代\" class=\"headerlink\" title=\"隐式迭代\"></a>隐式迭代</h2><ul><li>理解：方法内部为所有匹配元素进行循环遍历</li><li>注意：设置的是全部元素，获取的是第一个元素的值</li><li>示例：<code>$(&#39;div&#39;).css(&#39;color&#39;, &#39;red&#39;)、$(&#39;li&#39;).css(&#39;width&#39;)</code></li></ul><h2 id=\"each-遍历\"><a href=\"#each-遍历\" class=\"headerlink\" title=\"each 遍历\"></a>each 遍历</h2><ul><li>数组：<code>$.each(arr, function(i, v){ })</code></li><li>对象：<code>$.each(obj, function(key, val){ })</code></li><li>元素：<code>$(&#39;div&#39;).each(function(i, obj){ })</code></li></ul><h2 id=\"多库共存\"><a href=\"#多库共存\" class=\"headerlink\" title=\"多库共存\"></a>多库共存</h2><ol><li>问题：如果引用的其他库也用到 $，则前面引入库中的 $ 会被覆盖</li><li>解决<ul><li>若想让其他库使用 $ 则可以把 jQuery 的 $ 给释放掉</li><li>同时存在多个版本的 jQuery 则可以使用 noConflict 来区分</li></ul></li></ol><h1 id=\"十、插件机制\"><a href=\"#十、插件机制\" class=\"headerlink\" title=\"十、插件机制\"></a>十、插件机制</h1><blockquote><p>为 jQuery 原型添加功能函数来扩展功能</p></blockquote><h2 id=\"插件开发\"><a href=\"#插件开发\" class=\"headerlink\" title=\"插件开发\"></a>插件开发</h2><ol><li><p>类级别</p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 调用：$.hello()</span></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">$</span>)</span>&#123;</span><br><span class=\"line\">    $.extend(&#123;</span><br><span class=\"line\">        hello: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(<span class=\"string\">\"hello world\"</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;)(jQuery)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 调用：$.myExtend.hello() </span></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">$</span>)</span>&#123;</span><br><span class=\"line\">    $.myExtend(&#123;</span><br><span class=\"line\">        hello: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(<span class=\"string\">\"hello world\"</span>)</span><br><span class=\"line\">        &#125; </span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;)(jQuery)</span><br></pre></td></tr></table></figure></li><li><p>对象级别</p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 调用：$(\"#box\").myAnimate()</span></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">$</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 写法一</span></span><br><span class=\"line\">    $.fn.extend(&#123;</span><br><span class=\"line\">        myAnimate: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; &#125; </span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"comment\">// 写法二</span></span><br><span class=\"line\">    $.fn.myAnimate = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; &#125;</span><br><span class=\"line\">&#125;)(jQuery)</span><br></pre></td></tr></table></figure></li></ol><h2 id=\"插件模板\"><a href=\"#插件模板\" class=\"headerlink\" title=\"插件模板\"></a>插件模板</h2><ol><li>分号：开头添加是为了避免别人的代码不规范引起错误，结尾添加是为了 避免压缩出错</li><li>传参<ul><li>没有第四个参数</li><li>undefined：保证原生，防止他人把其定义为别的</li><li>window、document：快速查找，而且也便于代码压缩，比如 window 可能被压缩为 w<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">;(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">win, doc, $, undefined</span>)</span>&#123; </span><br><span class=\"line\">    <span class=\"comment\">// 写法一</span></span><br><span class=\"line\">    $.fn.extend(&#123;</span><br><span class=\"line\">        <span class=\"string\">\"pluginName\"</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">opt</span>)</span>&#123;&#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 写法二</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> defaults = &#123; &#125;</span><br><span class=\"line\">    $.fn.pluginName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">opt</span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">// 合并默认配置和用户配置</span></span><br><span class=\"line\">      <span class=\"keyword\">var</span> <span class=\"keyword\">set</span> = $.extend(&#123;&#125;, defaults, opt)</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// 支持链式调用</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>; </span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">&#125;(<span class=\"built_in\">window</span>, <span class=\"built_in\">document</span>, jQuery))</span><br></pre></td></tr></table></figure></li></ul></li></ol><h2 id=\"方法\"><a href=\"#方法\" class=\"headerlink\" title=\"方法\"></a>方法</h2><ul><li><code>$.extend( obj )</code>：扩展 jquery 类本身，只有通过 jq/$ 类来调用</li><li><code>$.fn.extend( obj )</code>：扩展 jquery 原型对象，每个实例化的 jq 对象都可以调用</li><li><code>$.extend( target, [objN])</code>：使用一个或多个其他对象来扩展第一个对象</li><li>关系：<code>$.fn.pluginName = $.fn.extend(pluginName) = $.prototype.extend(pluginName)</code></li></ul><!-- rebuild by neat -->"},{"title":"Hexo + Github 搭建个人博客","date":"2019-02-08T18:31:41.000Z","top":false,"keywords":["hexo"],"description":"Hexo 是一个快速、简洁且高效的博客框架","_content":"\n# \b一、博客搭建\n\n## 安装 Node.js 和 Git\n> Git安装后可以创建 `ssh key` 并添加到 GitHub上, 这样配置之后就不再需要每次更新博客时都输入用户名和密码了\n    \n## 安装hexo博客框架\n  ```js\n  cnpm install -g hexo-cli    // window安装\n  sudo cnpm install -g hexo   // mac安装\n  \n  cd blog            //在新建的blog文件夹打开终端\n  hexo init          // 初始化\n\n  hexo install       // window安装依赖\n  sudo npm install   // mac安装依赖\n  ```\n\n\n## 测试本地运行（线下访问）\n  ```js\n  hexo g     // 生成静态文件, 即 hexo generate\n\n  hexo s     // 启动本地服务器, 即 hexo server\n  ```\n\n## 部署到云服务器（线上访问）\n> Github 是外国网站且禁止百度爬虫访问，所以会导致百度搜不到你的网站。可以做两手准备：国内采用Coding托管，国外采用GitHub托管，建议两者的用户名和密码保持一致  \n\n### 配置步骤\n  1. 新建项目\n      GitHub：`username.github.io`\n      Coding：https://coding.net/\n  2. 配置 SSH\n    * 检查：`cd ~/.ssh`\n    * 生成：`ssh-keygen -t rsa -C \"17621538916@163.com\"`\n    * 输入密码并回车\n    * 查看公钥：`cat ~/.ssh/id_rsa.pub` \n  3. 添加公钥\n  4. 基础配置\n    * 用户名：`git config --global user.name \"chuanggefighting\"`\n    * 邮箱：`git config --global user.email \"17621538916@163.com\"` \n  5. 测试连接：`ssh -T git@github.com、ssh -T git@git.coding.net`\n  6. 开启 Pages 服务\n\n\n### 修改配置文件\n\n  ```yaml\n  deploy:\n    type: git\n    repo: \n      github: https://github.com/chuanggefighting/chuanggefighting.github.io.git\n      coding: https://git.dev.tencent.com/chuanggefighting/chuanggefighting.coding.me.git  # 腾讯\n      # coding: https://git.coding.net/chuanggefighting/chuanggefighting.coding.me.git     # Coding\n    branch: master\n  ```\n  \n\n### 上传到服务器\n\n  ```js\n  cnpm install hexo-deployer-git --save  // 安装git部署插件\n  \n  hexo clean              // 清除缓存\n  hexo n post             // 新建文章，即 hexo new post \n  hexo g                  // 编译博文生成静态文件, 即 hexo generate\n  hexo d                  // 部署到github, 即 hexo deploy\n  hexo hexo g -d          // 简化命令, 部署前生成静态文件\n  ```\n\n\n\n## 创建新页面\n\n  1. __增加关于页__\n    1. 取消 about 前面的 \\#  \n    2. hexo new page about  \n    3. blog/sources/about/index.md：自定义内容\n\n  2. __增加标签页__\n    1. 首先取消 next/config.yml 文件中 tags 前面的 \\#  \n    2. hexo new page tags\n    3. blog/sources/about/index.md：`type: tags`\n    <br/>\n                  \n  3. __增加分类页__\n    1. 取消 categories 前面的 \\#  \n    2. hexo new page \"categories\"\n    3. blog/sources/categories/index.md：`type: categories`\n    <br/>\n\n  4. __增加归档页__\n    1. 取消 categories 前面的 \\#  \n    2. hexo new page \"archive\"\n    3. blog/sources/archive/index.md：`type: archive`\n\n\n---\n\n# 二、博客管理\n\n  1. __NexT主题配置文件__\n   <div style=\"text-indent: 2em; margin-bottom: 25px\">NexT主题由于频繁更新，为了避免升级报错可以另存为一份配置，然后操作这个配置文件即可。首先在 blog/source 目录下新建_data文件夹，然后去复制 blog/themes/next/_config.yml 到本地并改名为 next.yml，最后将 next.yml 放置在 _data 中即可，以后编辑next.yml即可配置主题。</div>\n\n  2. __hexo博客源文件__ \n   <div style=\"text-indent: 2em; margin-bottom: 25px\">hexo d 是把本地博客源文件生成的静态网页文件同步到github上而实现部署, 但是博客网站的本地源文件仍需要保存到个人电脑，为了方便在不同电脑上可以编辑管理，可以在github上另建分支，如 hexo分支 </div>\n\n\n---\n\n# 三、博客个性化配置\n\n  1. __Hexo配置__ (blog/_config.yml)\n    * Site 站点配置(网站标题、作者、语言等)\n    * URL 网址配置(网址、根目录、链接格式等)\n    * Extensions 扩展配置(主题、插件等)\n    * 其他配置选项一般不需要修改\n\n \n  2. __主题配置__ (具体在博客优化部分)\n    * 安装主题 ：通过 git clone 下载到 blog/themes\n    * 启动主题 ：修改 blog/_config.yml 的theme选项\n    * 配置主题 ：修改 blog/themes/主题名/_config.yml\n\n\n  3. __自定义域名配置__\n    * 购买域名\n    * 域名解析\n    * 添加CNAME\n\n---\n# 四、NexT主题优化\n\n  1. __实用性优化__\n    * 添加RSS ：hexo-generator-feed\n    * 添加标签、分类等页面\n    * 设置网站icon\n    * 添加侧边栏链接\n    * 增加版权信息\n    * 微信支付宝打赏功能\n    * 底部显示建站时间和图标的修改\n    * 外部链接优化 ：hexo-autonofollow \n    * 关闭网站动画 ：use_motion\n    * 设置第三方JS库 ：vendors\n    * 添加评论系统 ：leancloud\n    * 统计站点访客和阅读量 ：busuanzi\n    * 统计文章字数和阅读时间 ：symblos_count_time\n    * 添加文章分享功能 ：needmoreshare2\n    * 添加博文压缩功能 ：hexo-neat / gulp\n    * 添加图片的懒加载 ：hexo-lazyload\n    * 添加文章加密功能 ：hexo-blog-encrypt\n    * 添加站内搜索功能 ：hexo-generator-searchdb\n    * 添加文章置顶功能 ：hexo-generator-index-pin-top\n    * 添加站点地图配置 ：hexo-generator-sitemap、hexo-generator-baidu-sitemap\n    * DaoVoice在线联系\n    <br/>\n\n  2. __博客个性化优化__\n    * 添加页面加载动画 ：pace\n    * 添加背景动画 ：canvas_nest\n    * 添加宠物 ：hexo-helper-live2d\n    * 添加顶部阅读进度 ：reading_progress\n    * 点击出现桃心效果 ：clicklove.js\n    * 添加代码块复制按钮 ：clickboard.js\n    * 文章末尾统一添加 “文本结束” 标记\n    * 修改文章底部标签样式\n    * 右上角的Github样式\n    * 修改作者头像并旋转\n    * 文章添加阴影效果\n\n\n---\n\n# 五、基于 Markdown 编写博文\n\n## 创建文章\n  * 站点目录下执行命令 hexo new \"title\"\n  * 指定目录下直接创建 source/_post/title.md\n\n---\n\n## 初始化设置\n<div style=\"text-indent: 2em\">使用命令创建文章时，Hexo 会根据文章的模板文件 /scaffolds/post.md 对新建文件进行初始化，可以根据需要自行修改。初始化后的文章头部除了可以设置文章标题、发布日期等基础信息外，还可以对文章添加标签、分类等，常用设置如下：</div>  \n\n```yaml\n---\ntitle: my blog\ndate: 2019-02-04 20:45:30\ntags: [Hexo, MarkDown] \ncategories: 学习笔记\nkeywords:\n    - Hexo\n    - 加密\n\n# \b预览文章摘要\ndescription: Markdown语法的格式和注意点  \n\n# \b\b预览加密文章摘要\npassword:        #文章密码\nabstract: enter password to read      #文章摘要\nmessage: My Birthday      #密码提示\n\n# 预览文章内容\n# 在要显示的内容末尾添加more分隔符 <!-- more -->\n\n---\n```\n\n\n## 编写文章（基于Markdown）\n\n### Markdown 简介\n <div style=\"text-indent: 2em\">Markdown是一种可以使用普通文本编辑器编写的轻量级标记语言，通过简单的标记语法使普通文本内容具有一定的格式，是一种适用于网络的书写语言，主要特点是易读易写、支持嵌入html标签和自动生成目录等。但是Hexo下使用的 Github风格的MarkDown（GFM）和 标准MarkDown（MD）在语法上稍有不同，以下\b主要介绍GFM语法。</div> \n\n\n### MD 与 GFM 的区别\n  * 斜体 ：MD 使用 \\_ 或 \\*，GFM 只支持 \\*\n  * 自动链接 ：MD 使用 <URL>，GFM 可直接使用 URL\n  * 代码块 ：MD 使用 4个空格开头，GFM 还可以使用 \\`\\`\\` 格式\n  * 其他 ：GFM 可以指定语言高亮，而且增加了 删除线、表格\b、锚点等\n\n\n### 常用语法\n  * 标题 ：\b根据 \\# 的数量显示几级标题（1～6）\n  * 引用 ：根据 > 的数量显示几级引用文本\n  * 转义 ：使用 \\\\ 显示文本中的一些字符\n  * 强调 ：使用 \\* 或 \\_ 显示 斜体、粗体、粗斜体（1～3），~~ 显示删除\n  * \b链接 ：行内式 \\[名字]\\(地址 \"描述\")，参考式 \\[名字]\\[网址变量]\n  * 列表 ：无序列表使用 \\-、\\+ 或 \\*，有序列表则使用数字加 \\.\n  * 代码 ：\b行内代码使用 \\`，代码块则使用 4个空格 或 \\`\\`\\`\n  * \b表格 ：\\- 和 | 分割行和列，: 控制对其方式\n  * 图片 ：链接方法前面\b加 \\!\n\n\n```\n*斜体文本*  _斜体文本_  **粗体文本**  __粗体文本__  ***粗斜体文本***  ___粗斜体文本___\n~~删除一段文本~~\n\n> 动物\n>> 水生动物\n\n[my blog](https://chuanggefighting.github.io/)   \n[Google][1] and [Baidu][2]\n\n[1]: http://google.com/   \"Google\" \n[2]: http://baidu.com/    \"Baidu\"\n\nPython\n#!/usr/bin/env python\n# -*- coding: utf-8 -*-\nprint 'Hello World!\n```\n*斜体文本*  _斜体文本_  **粗体文本**  __粗体文本__  ***粗斜体文本***  ___粗斜体文本___\n~~删除一段文本~~\n\n> 动物\n>> 水生动物\n\n[my blog](https://chuanggefighting.github.io/)   \n[Google][1] &#160;and&#160; [Baidu][2]\n\n[1]: http://google.com/   \"Google\" \n[2]: http://baidu.com/    \"Baidu\"\n\n```Python\n#!/usr/bin/env python\n# -*- coding: utf-8 -*-\nprint 'Hello World!\n```\n\n\n### 次常用语法\n  * 分段：两个空格\n  * 分隔线 ：在一行中使用三个以上的 \\*、\\-、\\_\n  * 换行：两个空格 \\+ 回车 （引用中换行省略回车）\n  * 首行缩进：使用转义字符代替空格，或者使用html标签\n  * 脚注 ：使用 \\[^name] 定义，用来解释专业词汇等\n\n\n### 内嵌Html标签  \n<div style=\"text-indent: 2em\">Markdown本身不支持修改字体、字号与颜色等功能，但是可以通过内嵌Html标签使普通文本内容具有一定的格式，常用如下：</div>  \n\n  * <font face=\"微软雅黑\" color=\"red\" size=\"3\">字体及字体颜色和大小</font>\n  * 换行<br/>\n  * <u>下划线文本</u>\n  * <span align=\"left\">文本对齐</span>\n  * <span style=\"text-indent: 2em\">首行缩进</span> \n\n---\n\n\n## 图片引用方式\n\n### 本地引用\n  * __绝对路径__  \n    <div style=\"text-indent: 2em\">将图片统一放在主题目录下 source/images 文件夹中，通过markdown语法访问它们，如 `![](/images/icon.png)`。这些图片既可以在首页内容中访问到，也可以在文章正文中访问到。</div>\n   \n\n  * __相对路径__\n    <div style=\"text-indent: 2em\">将图片放在文章目录中。首先配置\b博客根目录下的_config.yml来生成文章目录 ： `post_asset_folder: true`，然后执行命令 $ hexo new title，在 source/_posts 中会生成文章 title.md 和同名文件夹 title。</div>\n    <div style=\"text-indent: 2em\">我们只需将待添加的图片放进title文件夹中，然后在文章中通过 Markdown 语法进行引用即可，如 `![示例图片](example.png \"示例图片\") 添加图片`。但\b这些图片却无法在首页中正常显示，如果希望图片在文章和首页中同时显示，可以使用标签插件语法 ：\n    ```\n    {% asset_img example.png This is an image %}\n    ```\n    \n\n### CDN引用\n<div style=\"text-indent: 2em; margin-bottom: 20px\">除了在本地存储图片，还可以将图片上传到一些免费的CDN服务中。因国内访问github速度较慢，所以将图片放到国内图床上，然后引用外链\b是常用的方法。</div>\n\n> 图床，也就是专门提供存储图片的地方，我们只要通过图床提供的 API 接口，把图片上传上去，就可以通过外链访问了，根本不用操心图片是怎么存的，硬盘空间不够了，硬盘坏了，访问速度比较慢等等问题，这些图床都会帮我们搞定，他们会用各种技术帮我们做图片相关的优化和服务，比如多机互备、CDN 加速、图片处理、图片鉴黄、文本识别等等。\n\n> 当然，图床也是有缺点的，当所有人都把图片存在同一个图床上，万一有一天图床真挂了，那所有图片就都无法访问了，虽然这种情况的概率很低，但并不等于不会发生。\n\n> 目前图床可以分为两种，一种是公共图床，一种是自建图床。公共图床也就是利用公共服务的图片上传接口，来提供图片外链的服务，比如新浪微博。自建图床，也就是利用各大云服务商提供的存储空间或者自己在 VPS 上使用开源软件来搭建图床，存储图片，生成外链提供访问，比如七牛、Lychee 开源自建图床方案。\n  \n\n  1. 微博图床（Chrome浏览器有个“新浪微博图床\u001d”插件，可以自动生成markdown链接）简单方便\n  2. 七牛：\b需要注册且实名认证等太麻烦，放弃\n  3. 腾讯云等云存储服务，需要先将照片放到云盘，然后找到超链接，然后\b粘贴到文章。太麻烦，放弃。\n  4. ipic 工具【强烈推荐】，支持监控剪贴板，一键上传到微博图床，\b免费版默认是微博图床，支持七牛云等，下载地址：https://itunes.apple.com/cn/app/id1101244278?mt=12\n\n\n### 使用github存储博客图片  \n  1. 在 blog/source/ 下创建img文件，将图片放入。\n  2. 更新博客仓库，执行 hexo g -d\n  3. 在github仓库中找到图片位置，点击download，复制浏览器的链接，即为图片的链接\n  4. 将链接插入\b文章\n\n\n### 直接插入 base64 编码的图片\n  1. 在线压缩：http://www.bejson.com/ui/compress_img/ \n  2. 在线编码：http://imgbase64.duoshitong.com/ \n  3. 复制到本地后使用\n    * 直接使用：`![img](data:image/png;base64,iVBORw0...) `\n    * 引用式：`![img][img_name]、[img_name]:data:image/png;base64,iVBORw0...`\n\n\n\n\n\n","source":"_posts/1-hexo博客.md","raw":"---\ntitle: Hexo + Github 搭建个人博客\ndate: 2019-02-09 02:31:41\ntags: Hexo\ncategories: Hexo Blog\ntop: false\nkeywords:\n  - hexo\ndescription: Hexo 是一个快速、简洁且高效的博客框架\n---\n\n# \b一、博客搭建\n\n## 安装 Node.js 和 Git\n> Git安装后可以创建 `ssh key` 并添加到 GitHub上, 这样配置之后就不再需要每次更新博客时都输入用户名和密码了\n    \n## 安装hexo博客框架\n  ```js\n  cnpm install -g hexo-cli    // window安装\n  sudo cnpm install -g hexo   // mac安装\n  \n  cd blog            //在新建的blog文件夹打开终端\n  hexo init          // 初始化\n\n  hexo install       // window安装依赖\n  sudo npm install   // mac安装依赖\n  ```\n\n\n## 测试本地运行（线下访问）\n  ```js\n  hexo g     // 生成静态文件, 即 hexo generate\n\n  hexo s     // 启动本地服务器, 即 hexo server\n  ```\n\n## 部署到云服务器（线上访问）\n> Github 是外国网站且禁止百度爬虫访问，所以会导致百度搜不到你的网站。可以做两手准备：国内采用Coding托管，国外采用GitHub托管，建议两者的用户名和密码保持一致  \n\n### 配置步骤\n  1. 新建项目\n      GitHub：`username.github.io`\n      Coding：https://coding.net/\n  2. 配置 SSH\n    * 检查：`cd ~/.ssh`\n    * 生成：`ssh-keygen -t rsa -C \"17621538916@163.com\"`\n    * 输入密码并回车\n    * 查看公钥：`cat ~/.ssh/id_rsa.pub` \n  3. 添加公钥\n  4. 基础配置\n    * 用户名：`git config --global user.name \"chuanggefighting\"`\n    * 邮箱：`git config --global user.email \"17621538916@163.com\"` \n  5. 测试连接：`ssh -T git@github.com、ssh -T git@git.coding.net`\n  6. 开启 Pages 服务\n\n\n### 修改配置文件\n\n  ```yaml\n  deploy:\n    type: git\n    repo: \n      github: https://github.com/chuanggefighting/chuanggefighting.github.io.git\n      coding: https://git.dev.tencent.com/chuanggefighting/chuanggefighting.coding.me.git  # 腾讯\n      # coding: https://git.coding.net/chuanggefighting/chuanggefighting.coding.me.git     # Coding\n    branch: master\n  ```\n  \n\n### 上传到服务器\n\n  ```js\n  cnpm install hexo-deployer-git --save  // 安装git部署插件\n  \n  hexo clean              // 清除缓存\n  hexo n post             // 新建文章，即 hexo new post \n  hexo g                  // 编译博文生成静态文件, 即 hexo generate\n  hexo d                  // 部署到github, 即 hexo deploy\n  hexo hexo g -d          // 简化命令, 部署前生成静态文件\n  ```\n\n\n\n## 创建新页面\n\n  1. __增加关于页__\n    1. 取消 about 前面的 \\#  \n    2. hexo new page about  \n    3. blog/sources/about/index.md：自定义内容\n\n  2. __增加标签页__\n    1. 首先取消 next/config.yml 文件中 tags 前面的 \\#  \n    2. hexo new page tags\n    3. blog/sources/about/index.md：`type: tags`\n    <br/>\n                  \n  3. __增加分类页__\n    1. 取消 categories 前面的 \\#  \n    2. hexo new page \"categories\"\n    3. blog/sources/categories/index.md：`type: categories`\n    <br/>\n\n  4. __增加归档页__\n    1. 取消 categories 前面的 \\#  \n    2. hexo new page \"archive\"\n    3. blog/sources/archive/index.md：`type: archive`\n\n\n---\n\n# 二、博客管理\n\n  1. __NexT主题配置文件__\n   <div style=\"text-indent: 2em; margin-bottom: 25px\">NexT主题由于频繁更新，为了避免升级报错可以另存为一份配置，然后操作这个配置文件即可。首先在 blog/source 目录下新建_data文件夹，然后去复制 blog/themes/next/_config.yml 到本地并改名为 next.yml，最后将 next.yml 放置在 _data 中即可，以后编辑next.yml即可配置主题。</div>\n\n  2. __hexo博客源文件__ \n   <div style=\"text-indent: 2em; margin-bottom: 25px\">hexo d 是把本地博客源文件生成的静态网页文件同步到github上而实现部署, 但是博客网站的本地源文件仍需要保存到个人电脑，为了方便在不同电脑上可以编辑管理，可以在github上另建分支，如 hexo分支 </div>\n\n\n---\n\n# 三、博客个性化配置\n\n  1. __Hexo配置__ (blog/_config.yml)\n    * Site 站点配置(网站标题、作者、语言等)\n    * URL 网址配置(网址、根目录、链接格式等)\n    * Extensions 扩展配置(主题、插件等)\n    * 其他配置选项一般不需要修改\n\n \n  2. __主题配置__ (具体在博客优化部分)\n    * 安装主题 ：通过 git clone 下载到 blog/themes\n    * 启动主题 ：修改 blog/_config.yml 的theme选项\n    * 配置主题 ：修改 blog/themes/主题名/_config.yml\n\n\n  3. __自定义域名配置__\n    * 购买域名\n    * 域名解析\n    * 添加CNAME\n\n---\n# 四、NexT主题优化\n\n  1. __实用性优化__\n    * 添加RSS ：hexo-generator-feed\n    * 添加标签、分类等页面\n    * 设置网站icon\n    * 添加侧边栏链接\n    * 增加版权信息\n    * 微信支付宝打赏功能\n    * 底部显示建站时间和图标的修改\n    * 外部链接优化 ：hexo-autonofollow \n    * 关闭网站动画 ：use_motion\n    * 设置第三方JS库 ：vendors\n    * 添加评论系统 ：leancloud\n    * 统计站点访客和阅读量 ：busuanzi\n    * 统计文章字数和阅读时间 ：symblos_count_time\n    * 添加文章分享功能 ：needmoreshare2\n    * 添加博文压缩功能 ：hexo-neat / gulp\n    * 添加图片的懒加载 ：hexo-lazyload\n    * 添加文章加密功能 ：hexo-blog-encrypt\n    * 添加站内搜索功能 ：hexo-generator-searchdb\n    * 添加文章置顶功能 ：hexo-generator-index-pin-top\n    * 添加站点地图配置 ：hexo-generator-sitemap、hexo-generator-baidu-sitemap\n    * DaoVoice在线联系\n    <br/>\n\n  2. __博客个性化优化__\n    * 添加页面加载动画 ：pace\n    * 添加背景动画 ：canvas_nest\n    * 添加宠物 ：hexo-helper-live2d\n    * 添加顶部阅读进度 ：reading_progress\n    * 点击出现桃心效果 ：clicklove.js\n    * 添加代码块复制按钮 ：clickboard.js\n    * 文章末尾统一添加 “文本结束” 标记\n    * 修改文章底部标签样式\n    * 右上角的Github样式\n    * 修改作者头像并旋转\n    * 文章添加阴影效果\n\n\n---\n\n# 五、基于 Markdown 编写博文\n\n## 创建文章\n  * 站点目录下执行命令 hexo new \"title\"\n  * 指定目录下直接创建 source/_post/title.md\n\n---\n\n## 初始化设置\n<div style=\"text-indent: 2em\">使用命令创建文章时，Hexo 会根据文章的模板文件 /scaffolds/post.md 对新建文件进行初始化，可以根据需要自行修改。初始化后的文章头部除了可以设置文章标题、发布日期等基础信息外，还可以对文章添加标签、分类等，常用设置如下：</div>  \n\n```yaml\n---\ntitle: my blog\ndate: 2019-02-04 20:45:30\ntags: [Hexo, MarkDown] \ncategories: 学习笔记\nkeywords:\n    - Hexo\n    - 加密\n\n# \b预览文章摘要\ndescription: Markdown语法的格式和注意点  \n\n# \b\b预览加密文章摘要\npassword:        #文章密码\nabstract: enter password to read      #文章摘要\nmessage: My Birthday      #密码提示\n\n# 预览文章内容\n# 在要显示的内容末尾添加more分隔符 <!-- more -->\n\n---\n```\n\n\n## 编写文章（基于Markdown）\n\n### Markdown 简介\n <div style=\"text-indent: 2em\">Markdown是一种可以使用普通文本编辑器编写的轻量级标记语言，通过简单的标记语法使普通文本内容具有一定的格式，是一种适用于网络的书写语言，主要特点是易读易写、支持嵌入html标签和自动生成目录等。但是Hexo下使用的 Github风格的MarkDown（GFM）和 标准MarkDown（MD）在语法上稍有不同，以下\b主要介绍GFM语法。</div> \n\n\n### MD 与 GFM 的区别\n  * 斜体 ：MD 使用 \\_ 或 \\*，GFM 只支持 \\*\n  * 自动链接 ：MD 使用 <URL>，GFM 可直接使用 URL\n  * 代码块 ：MD 使用 4个空格开头，GFM 还可以使用 \\`\\`\\` 格式\n  * 其他 ：GFM 可以指定语言高亮，而且增加了 删除线、表格\b、锚点等\n\n\n### 常用语法\n  * 标题 ：\b根据 \\# 的数量显示几级标题（1～6）\n  * 引用 ：根据 > 的数量显示几级引用文本\n  * 转义 ：使用 \\\\ 显示文本中的一些字符\n  * 强调 ：使用 \\* 或 \\_ 显示 斜体、粗体、粗斜体（1～3），~~ 显示删除\n  * \b链接 ：行内式 \\[名字]\\(地址 \"描述\")，参考式 \\[名字]\\[网址变量]\n  * 列表 ：无序列表使用 \\-、\\+ 或 \\*，有序列表则使用数字加 \\.\n  * 代码 ：\b行内代码使用 \\`，代码块则使用 4个空格 或 \\`\\`\\`\n  * \b表格 ：\\- 和 | 分割行和列，: 控制对其方式\n  * 图片 ：链接方法前面\b加 \\!\n\n\n```\n*斜体文本*  _斜体文本_  **粗体文本**  __粗体文本__  ***粗斜体文本***  ___粗斜体文本___\n~~删除一段文本~~\n\n> 动物\n>> 水生动物\n\n[my blog](https://chuanggefighting.github.io/)   \n[Google][1] and [Baidu][2]\n\n[1]: http://google.com/   \"Google\" \n[2]: http://baidu.com/    \"Baidu\"\n\nPython\n#!/usr/bin/env python\n# -*- coding: utf-8 -*-\nprint 'Hello World!\n```\n*斜体文本*  _斜体文本_  **粗体文本**  __粗体文本__  ***粗斜体文本***  ___粗斜体文本___\n~~删除一段文本~~\n\n> 动物\n>> 水生动物\n\n[my blog](https://chuanggefighting.github.io/)   \n[Google][1] &#160;and&#160; [Baidu][2]\n\n[1]: http://google.com/   \"Google\" \n[2]: http://baidu.com/    \"Baidu\"\n\n```Python\n#!/usr/bin/env python\n# -*- coding: utf-8 -*-\nprint 'Hello World!\n```\n\n\n### 次常用语法\n  * 分段：两个空格\n  * 分隔线 ：在一行中使用三个以上的 \\*、\\-、\\_\n  * 换行：两个空格 \\+ 回车 （引用中换行省略回车）\n  * 首行缩进：使用转义字符代替空格，或者使用html标签\n  * 脚注 ：使用 \\[^name] 定义，用来解释专业词汇等\n\n\n### 内嵌Html标签  \n<div style=\"text-indent: 2em\">Markdown本身不支持修改字体、字号与颜色等功能，但是可以通过内嵌Html标签使普通文本内容具有一定的格式，常用如下：</div>  \n\n  * <font face=\"微软雅黑\" color=\"red\" size=\"3\">字体及字体颜色和大小</font>\n  * 换行<br/>\n  * <u>下划线文本</u>\n  * <span align=\"left\">文本对齐</span>\n  * <span style=\"text-indent: 2em\">首行缩进</span> \n\n---\n\n\n## 图片引用方式\n\n### 本地引用\n  * __绝对路径__  \n    <div style=\"text-indent: 2em\">将图片统一放在主题目录下 source/images 文件夹中，通过markdown语法访问它们，如 `![](/images/icon.png)`。这些图片既可以在首页内容中访问到，也可以在文章正文中访问到。</div>\n   \n\n  * __相对路径__\n    <div style=\"text-indent: 2em\">将图片放在文章目录中。首先配置\b博客根目录下的_config.yml来生成文章目录 ： `post_asset_folder: true`，然后执行命令 $ hexo new title，在 source/_posts 中会生成文章 title.md 和同名文件夹 title。</div>\n    <div style=\"text-indent: 2em\">我们只需将待添加的图片放进title文件夹中，然后在文章中通过 Markdown 语法进行引用即可，如 `![示例图片](example.png \"示例图片\") 添加图片`。但\b这些图片却无法在首页中正常显示，如果希望图片在文章和首页中同时显示，可以使用标签插件语法 ：\n    ```\n    {% asset_img example.png This is an image %}\n    ```\n    \n\n### CDN引用\n<div style=\"text-indent: 2em; margin-bottom: 20px\">除了在本地存储图片，还可以将图片上传到一些免费的CDN服务中。因国内访问github速度较慢，所以将图片放到国内图床上，然后引用外链\b是常用的方法。</div>\n\n> 图床，也就是专门提供存储图片的地方，我们只要通过图床提供的 API 接口，把图片上传上去，就可以通过外链访问了，根本不用操心图片是怎么存的，硬盘空间不够了，硬盘坏了，访问速度比较慢等等问题，这些图床都会帮我们搞定，他们会用各种技术帮我们做图片相关的优化和服务，比如多机互备、CDN 加速、图片处理、图片鉴黄、文本识别等等。\n\n> 当然，图床也是有缺点的，当所有人都把图片存在同一个图床上，万一有一天图床真挂了，那所有图片就都无法访问了，虽然这种情况的概率很低，但并不等于不会发生。\n\n> 目前图床可以分为两种，一种是公共图床，一种是自建图床。公共图床也就是利用公共服务的图片上传接口，来提供图片外链的服务，比如新浪微博。自建图床，也就是利用各大云服务商提供的存储空间或者自己在 VPS 上使用开源软件来搭建图床，存储图片，生成外链提供访问，比如七牛、Lychee 开源自建图床方案。\n  \n\n  1. 微博图床（Chrome浏览器有个“新浪微博图床\u001d”插件，可以自动生成markdown链接）简单方便\n  2. 七牛：\b需要注册且实名认证等太麻烦，放弃\n  3. 腾讯云等云存储服务，需要先将照片放到云盘，然后找到超链接，然后\b粘贴到文章。太麻烦，放弃。\n  4. ipic 工具【强烈推荐】，支持监控剪贴板，一键上传到微博图床，\b免费版默认是微博图床，支持七牛云等，下载地址：https://itunes.apple.com/cn/app/id1101244278?mt=12\n\n\n### 使用github存储博客图片  \n  1. 在 blog/source/ 下创建img文件，将图片放入。\n  2. 更新博客仓库，执行 hexo g -d\n  3. 在github仓库中找到图片位置，点击download，复制浏览器的链接，即为图片的链接\n  4. 将链接插入\b文章\n\n\n### 直接插入 base64 编码的图片\n  1. 在线压缩：http://www.bejson.com/ui/compress_img/ \n  2. 在线编码：http://imgbase64.duoshitong.com/ \n  3. 复制到本地后使用\n    * 直接使用：`![img](data:image/png;base64,iVBORw0...) `\n    * 引用式：`![img][img_name]、[img_name]:data:image/png;base64,iVBORw0...`\n\n\n\n\n\n","slug":"1-hexo博客","published":1,"updated":"2019-04-18T14:04:26.666Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvid4piz000d0nbxiy2mofpc","content":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><html><head></head><body><h1 id=\"一、博客搭建\"><a href=\"#一、博客搭建\" class=\"headerlink\" title=\"\b一、博客搭建\"></a>\b一、博客搭建</h1><h2 id=\"安装-Node-js-和-Git\"><a href=\"#安装-Node-js-和-Git\" class=\"headerlink\" title=\"安装 Node.js 和 Git\"></a>安装 Node.js 和 Git</h2><blockquote><p>Git安装后可以创建 <code>ssh key</code> 并添加到 GitHub上, 这样配置之后就不再需要每次更新博客时都输入用户名和密码了</p></blockquote><h2 id=\"安装hexo博客框架\"><a href=\"#安装hexo博客框架\" class=\"headerlink\" title=\"安装hexo博客框架\"></a>安装hexo博客框架</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cnpm install -g hexo-cli    <span class=\"comment\">// window安装</span></span><br><span class=\"line\">sudo cnpm install -g hexo   <span class=\"comment\">// mac安装</span></span><br><span class=\"line\"></span><br><span class=\"line\">cd blog            <span class=\"comment\">//在新建的blog文件夹打开终端</span></span><br><span class=\"line\">hexo init          <span class=\"comment\">// 初始化</span></span><br><span class=\"line\"></span><br><span class=\"line\">hexo install       <span class=\"comment\">// window安装依赖</span></span><br><span class=\"line\">sudo npm install   <span class=\"comment\">// mac安装依赖</span></span><br></pre></td></tr></tbody></table></figure><h2 id=\"测试本地运行（线下访问）\"><a href=\"#测试本地运行（线下访问）\" class=\"headerlink\" title=\"测试本地运行（线下访问）\"></a>测试本地运行（线下访问）</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo g     <span class=\"comment\">// 生成静态文件, 即 hexo generate</span></span><br><span class=\"line\"></span><br><span class=\"line\">hexo s     <span class=\"comment\">// 启动本地服务器, 即 hexo server</span></span><br></pre></td></tr></tbody></table></figure><h2 id=\"部署到云服务器（线上访问）\"><a href=\"#部署到云服务器（线上访问）\" class=\"headerlink\" title=\"部署到云服务器（线上访问）\"></a>部署到云服务器（线上访问）</h2><blockquote><p>Github 是外国网站且禁止百度爬虫访问，所以会导致百度搜不到你的网站。可以做两手准备：国内采用Coding托管，国外采用GitHub托管，建议两者的用户名和密码保持一致</p></blockquote><h3 id=\"配置步骤\"><a href=\"#配置步骤\" class=\"headerlink\" title=\"配置步骤\"></a>配置步骤</h3><ol><li>新建项目<br>GitHub：<code>username.github.io</code><br>Coding：<a href=\"https://coding.net/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">https://coding.net/</a></li><li>配置 SSH<ul><li>检查：<code>cd ~/.ssh</code></li><li>生成：<code>ssh-keygen -t rsa -C \"17621538916@163.com\"</code></li><li>输入密码并回车</li><li>查看公钥：<code>cat ~/.ssh/id_rsa.pub</code></li></ul></li><li>添加公钥</li><li>基础配置<ul><li>用户名：<code>git config --global user.name \"chuanggefighting\"</code></li><li>邮箱：<code>git config --global user.email \"17621538916@163.com\"</code></li></ul></li><li>测试连接：<code>ssh -T git@github.com、ssh -T git@git.coding.net</code></li><li>开启 Pages 服务</li></ol><h3 id=\"修改配置文件\"><a href=\"#修改配置文件\" class=\"headerlink\" title=\"修改配置文件\"></a>修改配置文件</h3><figure class=\"highlight yaml\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">deploy:</span></span><br><span class=\"line\"><span class=\"attr\">  type:</span> <span class=\"string\">git</span></span><br><span class=\"line\"><span class=\"attr\">  repo:</span> </span><br><span class=\"line\"><span class=\"attr\">    github:</span> <span class=\"attr\">https://github.com/chuanggefighting/chuanggefighting.github.io.git</span></span><br><span class=\"line\"><span class=\"attr\">    coding:</span> <span class=\"attr\">https://git.dev.tencent.com/chuanggefighting/chuanggefighting.coding.me.git</span>  <span class=\"comment\"># 腾讯</span></span><br><span class=\"line\">    <span class=\"comment\"># coding: https://git.coding.net/chuanggefighting/chuanggefighting.coding.me.git     # Coding</span></span><br><span class=\"line\"><span class=\"attr\">  branch:</span> <span class=\"string\">master</span></span><br></pre></td></tr></tbody></table></figure><h3 id=\"上传到服务器\"><a href=\"#上传到服务器\" class=\"headerlink\" title=\"上传到服务器\"></a>上传到服务器</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cnpm install hexo-deployer-git --save  <span class=\"comment\">// 安装git部署插件</span></span><br><span class=\"line\"></span><br><span class=\"line\">hexo clean              <span class=\"comment\">// 清除缓存</span></span><br><span class=\"line\">hexo n post             <span class=\"comment\">// 新建文章，即 hexo new post </span></span><br><span class=\"line\">hexo g                  <span class=\"comment\">// 编译博文生成静态文件, 即 hexo generate</span></span><br><span class=\"line\">hexo d                  <span class=\"comment\">// 部署到github, 即 hexo deploy</span></span><br><span class=\"line\">hexo hexo g -d          <span class=\"comment\">// 简化命令, 部署前生成静态文件</span></span><br></pre></td></tr></tbody></table></figure><h2 id=\"创建新页面\"><a href=\"#创建新页面\" class=\"headerlink\" title=\"创建新页面\"></a>创建新页面</h2><ol><li><p><strong>增加关于页</strong></p><ol><li>取消 about 前面的 #</li><li>hexo new page about</li><li>blog/sources/about/index.md：自定义内容</li></ol></li><li><p><strong>增加标签页</strong></p><ol><li>首先取消 next/config.yml 文件中 tags 前面的 #</li><li>hexo new page tags</li><li>blog/sources/about/index.md：<code>type: tags</code><br><br></li></ol></li><li><p><strong>增加分类页</strong></p><ol><li>取消 categories 前面的 #</li><li>hexo new page “categories”</li><li>blog/sources/categories/index.md：<code>type: categories</code><br><br></li></ol></li><li><p><strong>增加归档页</strong></p><ol><li>取消 categories 前面的 #</li><li>hexo new page “archive”</li><li>blog/sources/archive/index.md：<code>type: archive</code></li></ol></li></ol><hr><h1 id=\"二、博客管理\"><a href=\"#二、博客管理\" class=\"headerlink\" title=\"二、博客管理\"></a>二、博客管理</h1><ol><li><p><strong>NexT主题配置文件</strong></p><div style=\"text-indent:2em;margin-bottom:25px\">NexT主题由于频繁更新，为了避免升级报错可以另存为一份配置，然后操作这个配置文件即可。首先在 blog/source 目录下新建_data文件夹，然后去复制 blog/themes/next/_config.yml 到本地并改名为 next.yml，最后将 next.yml 放置在 _data 中即可，以后编辑next.yml即可配置主题。</div></li><li><p><strong>hexo博客源文件</strong></p><div style=\"text-indent:2em;margin-bottom:25px\">hexo d 是把本地博客源文件生成的静态网页文件同步到github上而实现部署, 但是博客网站的本地源文件仍需要保存到个人电脑，为了方便在不同电脑上可以编辑管理，可以在github上另建分支，如 hexo分支</div></li></ol><hr><h1 id=\"三、博客个性化配置\"><a href=\"#三、博客个性化配置\" class=\"headerlink\" title=\"三、博客个性化配置\"></a>三、博客个性化配置</h1><ol><li><strong>Hexo配置</strong> (blog/_config.yml)<ul><li>Site 站点配置(网站标题、作者、语言等)</li><li>URL 网址配置(网址、根目录、链接格式等)</li><li>Extensions 扩展配置(主题、插件等)</li><li>其他配置选项一般不需要修改</li></ul></li></ol><ol start=\"2\"><li><strong>主题配置</strong> (具体在博客优化部分)<ul><li>安装主题 ：通过 git clone 下载到 blog/themes</li><li>启动主题 ：修改 blog/_config.yml 的theme选项</li><li>配置主题 ：修改 blog/themes/主题名/_config.yml</li></ul></li></ol><ol start=\"3\"><li><strong>自定义域名配置</strong><ul><li>购买域名</li><li>域名解析</li><li>添加CNAME</li></ul></li></ol><hr><h1 id=\"四、NexT主题优化\"><a href=\"#四、NexT主题优化\" class=\"headerlink\" title=\"四、NexT主题优化\"></a>四、NexT主题优化</h1><ol><li><p><strong>实用性优化</strong></p><ul><li>添加RSS ：hexo-generator-feed</li><li>添加标签、分类等页面</li><li>设置网站icon</li><li>添加侧边栏链接</li><li>增加版权信息</li><li>微信支付宝打赏功能</li><li>底部显示建站时间和图标的修改</li><li>外部链接优化 ：hexo-autonofollow</li><li>关闭网站动画 ：use_motion</li><li>设置第三方JS库 ：vendors</li><li>添加评论系统 ：leancloud</li><li>统计站点访客和阅读量 ：busuanzi</li><li>统计文章字数和阅读时间 ：symblos_count_time</li><li>添加文章分享功能 ：needmoreshare2</li><li>添加博文压缩功能 ：hexo-neat / gulp</li><li>添加图片的懒加载 ：hexo-lazyload</li><li>添加文章加密功能 ：hexo-blog-encrypt</li><li>添加站内搜索功能 ：hexo-generator-searchdb</li><li>添加文章置顶功能 ：hexo-generator-index-pin-top</li><li>添加站点地图配置 ：hexo-generator-sitemap、hexo-generator-baidu-sitemap</li><li>DaoVoice在线联系<br><br></li></ul></li><li><p><strong>博客个性化优化</strong></p><ul><li>添加页面加载动画 ：pace</li><li>添加背景动画 ：canvas_nest</li><li>添加宠物 ：hexo-helper-live2d</li><li>添加顶部阅读进度 ：reading_progress</li><li>点击出现桃心效果 ：clicklove.js</li><li>添加代码块复制按钮 ：clickboard.js</li><li>文章末尾统一添加 “文本结束” 标记</li><li>修改文章底部标签样式</li><li>右上角的Github样式</li><li>修改作者头像并旋转</li><li>文章添加阴影效果</li></ul></li></ol><hr><h1 id=\"五、基于-Markdown-编写博文\"><a href=\"#五、基于-Markdown-编写博文\" class=\"headerlink\" title=\"五、基于 Markdown 编写博文\"></a>五、基于 Markdown 编写博文</h1><h2 id=\"创建文章\"><a href=\"#创建文章\" class=\"headerlink\" title=\"创建文章\"></a>创建文章</h2><ul><li>站点目录下执行命令 hexo new “title”</li><li>指定目录下直接创建 source/_post/title.md</li></ul><hr><h2 id=\"初始化设置\"><a href=\"#初始化设置\" class=\"headerlink\" title=\"初始化设置\"></a>初始化设置</h2><div style=\"text-indent:2em\">使用命令创建文章时，Hexo 会根据文章的模板文件 /scaffolds/post.md 对新建文件进行初始化，可以根据需要自行修改。初始化后的文章头部除了可以设置文章标题、发布日期等基础信息外，还可以对文章添加标签、分类等，常用设置如下：</div><figure class=\"highlight yaml\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">title:</span> <span class=\"string\">my</span> <span class=\"string\">blog</span></span><br><span class=\"line\"><span class=\"attr\">date:</span> <span class=\"number\">2019</span><span class=\"bullet\">-02</span><span class=\"bullet\">-04</span> <span class=\"number\">20</span><span class=\"string\">:45:30</span></span><br><span class=\"line\"><span class=\"attr\">tags:</span> <span class=\"string\">[Hexo,</span> <span class=\"string\">MarkDown]</span> </span><br><span class=\"line\"><span class=\"attr\">categories:</span> <span class=\"string\">学习笔记</span></span><br><span class=\"line\"><span class=\"attr\">keywords:</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">Hexo</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">加密</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># \b预览文章摘要</span></span><br><span class=\"line\"><span class=\"attr\">description:</span> <span class=\"string\">Markdown语法的格式和注意点</span>  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># \b\b预览加密文章摘要</span></span><br><span class=\"line\"><span class=\"attr\">password:</span>        <span class=\"comment\">#文章密码</span></span><br><span class=\"line\"><span class=\"attr\">abstract:</span> <span class=\"string\">enter</span> <span class=\"string\">password</span> <span class=\"string\">to</span> <span class=\"string\">read</span>      <span class=\"comment\">#文章摘要</span></span><br><span class=\"line\"><span class=\"attr\">message:</span> <span class=\"string\">My</span> <span class=\"string\">Birthday</span>      <span class=\"comment\">#密码提示</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 预览文章内容</span></span><br><span class=\"line\"><span class=\"comment\"># 在要显示的内容末尾添加more分隔符 <!-- more --></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br></pre></td></tr></tbody></table></figure><h2 id=\"编写文章（基于Markdown）\"><a href=\"#编写文章（基于Markdown）\" class=\"headerlink\" title=\"编写文章（基于Markdown）\"></a>编写文章（基于Markdown）</h2><h3 id=\"Markdown-简介\"><a href=\"#Markdown-简介\" class=\"headerlink\" title=\"Markdown 简介\"></a>Markdown 简介</h3><div style=\"text-indent:2em\">Markdown是一种可以使用普通文本编辑器编写的轻量级标记语言，通过简单的标记语法使普通文本内容具有一定的格式，是一种适用于网络的书写语言，主要特点是易读易写、支持嵌入html标签和自动生成目录等。但是Hexo下使用的 Github风格的MarkDown（GFM）和 标准MarkDown（MD）在语法上稍有不同，以下\b主要介绍GFM语法。</div><h3 id=\"MD-与-GFM-的区别\"><a href=\"#MD-与-GFM-的区别\" class=\"headerlink\" title=\"MD 与 GFM 的区别\"></a>MD 与 GFM 的区别</h3><ul><li>斜体 ：MD 使用 _ 或 *，GFM 只支持 *</li><li>自动链接 ：MD 使用<url>，GFM 可直接使用 URL</url></li><li>代码块 ：MD 使用 4个空格开头，GFM 还可以使用 ``` 格式</li><li>其他 ：GFM 可以指定语言高亮，而且增加了 删除线、表格\b、锚点等</li></ul><h3 id=\"常用语法\"><a href=\"#常用语法\" class=\"headerlink\" title=\"常用语法\"></a>常用语法</h3><ul><li>标题 ：\b根据 # 的数量显示几级标题（1～6）</li><li>引用 ：根据 > 的数量显示几级引用文本</li><li>转义 ：使用 \\ 显示文本中的一些字符</li><li>强调 ：使用 * 或 _ 显示 斜体、粗体、粗斜体（1～3），~~ 显示删除</li><li>\b链接 ：行内式 [名字](地址 “描述”)，参考式 [名字][网址变量]</li><li>列表 ：无序列表使用 -、+ 或 *，有序列表则使用数字加 .</li><li>代码 ：\b行内代码使用 `，代码块则使用 4个空格 或 ```</li><li>\b表格 ：- 和 | 分割行和列，: 控制对其方式</li><li>图片 ：链接方法前面\b加 !</li></ul><figure class=\"highlight plain\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*斜体文本*  _斜体文本_  **粗体文本**  __粗体文本__  ***粗斜体文本***  ___粗斜体文本___</span><br><span class=\"line\">~~删除一段文本~~</span><br><span class=\"line\"></span><br><span class=\"line\">> 动物</span><br><span class=\"line\">>> 水生动物</span><br><span class=\"line\"></span><br><span class=\"line\">[my blog](https://chuanggefighting.github.io/)   </span><br><span class=\"line\">[Google][1] and [Baidu][2]</span><br><span class=\"line\"></span><br><span class=\"line\">[1]: http://google.com/   \"Google\" </span><br><span class=\"line\">[2]: http://baidu.com/    \"Baidu\"</span><br><span class=\"line\"></span><br><span class=\"line\">Python</span><br><span class=\"line\">#!/usr/bin/env python</span><br><span class=\"line\"># -*- coding: utf-8 -*-</span><br><span class=\"line\">print 'Hello World!</span><br></pre></td></tr></tbody></table></figure><p><em>斜体文本</em> <em>斜体文本</em> <strong>粗体文本</strong> <strong>粗体文本</strong> <strong><em>粗斜体文本</em></strong> <strong><em>粗斜体文本</em></strong><br><del>删除一段文本</del></p><blockquote><p>动物</p><blockquote><p>水生动物</p></blockquote></blockquote><p><a href=\"https://chuanggefighting.github.io/\">my blog</a><br><a href=\"http://google.com/\" title=\"Google\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Google</a>  and  <a href=\"http://baidu.com/\" title=\"Baidu\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Baidu</a></p><figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">print</span> <span class=\"string\">'Hello World!</span></span><br></pre></td></tr></tbody></table></figure><h3 id=\"次常用语法\"><a href=\"#次常用语法\" class=\"headerlink\" title=\"次常用语法\"></a>次常用语法</h3><ul><li>分段：两个空格</li><li>分隔线 ：在一行中使用三个以上的 *、-、_</li><li>换行：两个空格 + 回车 （引用中换行省略回车）</li><li>首行缩进：使用转义字符代替空格，或者使用html标签</li><li>脚注 ：使用 [^name] 定义，用来解释专业词汇等</li></ul><h3 id=\"内嵌Html标签\"><a href=\"#内嵌Html标签\" class=\"headerlink\" title=\"内嵌Html标签\"></a>内嵌Html标签</h3><div style=\"text-indent:2em\">Markdown本身不支持修改字体、字号与颜色等功能，但是可以通过内嵌Html标签使普通文本内容具有一定的格式，常用如下：</div><ul><li><font face=\"微软雅黑\" color=\"red\" size=\"3\">字体及字体颜色和大小</font></li><li>换行<br></li><li><u>下划线文本</u></li><li><span align=\"left\">文本对齐</span></li><li><span style=\"text-indent:2em\">首行缩进</span></li></ul><hr><h2 id=\"图片引用方式\"><a href=\"#图片引用方式\" class=\"headerlink\" title=\"图片引用方式\"></a>图片引用方式</h2><h3 id=\"本地引用\"><a href=\"#本地引用\" class=\"headerlink\" title=\"本地引用\"></a>本地引用</h3><ul><li><strong>绝对路径</strong><div style=\"text-indent:2em\">将图片统一放在主题目录下 source/images 文件夹中，通过markdown语法访问它们，如 <code>![](/images/icon.png)</code>。这些图片既可以在首页内容中访问到，也可以在文章正文中访问到。</div></li></ul><ul><li><strong>相对路径</strong><br><div style=\"text-indent:2em\">将图片放在文章目录中。首先配置\b博客根目录下的_config.yml来生成文章目录 ： <code>post_asset_folder: true</code>，然后执行命令 $ hexo new title，在 source/_posts 中会生成文章 title.md 和同名文件夹 title。</div><br><div style=\"text-indent:2em\">我们只需将待添加的图片放进title文件夹中，然后在文章中通过 Markdown 语法进行引用即可，如 <code>![示例图片](example.png \"示例图片\") 添加图片</code>。但\b这些图片却无法在首页中正常显示，如果希望图片在文章和首页中同时显示，可以使用标签插件语法 ：<figure class=\"highlight plain\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">{% asset_img example.png This is an image %}</span><br></pre></td></tr></tbody></table></figure></div></li></ul><h3 id=\"CDN引用\"><a href=\"#CDN引用\" class=\"headerlink\" title=\"CDN引用\"></a>CDN引用</h3><div style=\"text-indent:2em;margin-bottom:20px\">除了在本地存储图片，还可以将图片上传到一些免费的CDN服务中。因国内访问github速度较慢，所以将图片放到国内图床上，然后引用外链\b是常用的方法。</div><blockquote><p>图床，也就是专门提供存储图片的地方，我们只要通过图床提供的 API 接口，把图片上传上去，就可以通过外链访问了，根本不用操心图片是怎么存的，硬盘空间不够了，硬盘坏了，访问速度比较慢等等问题，这些图床都会帮我们搞定，他们会用各种技术帮我们做图片相关的优化和服务，比如多机互备、CDN 加速、图片处理、图片鉴黄、文本识别等等。</p></blockquote><blockquote><p>当然，图床也是有缺点的，当所有人都把图片存在同一个图床上，万一有一天图床真挂了，那所有图片就都无法访问了，虽然这种情况的概率很低，但并不等于不会发生。</p></blockquote><blockquote><p>目前图床可以分为两种，一种是公共图床，一种是自建图床。公共图床也就是利用公共服务的图片上传接口，来提供图片外链的服务，比如新浪微博。自建图床，也就是利用各大云服务商提供的存储空间或者自己在 VPS 上使用开源软件来搭建图床，存储图片，生成外链提供访问，比如七牛、Lychee 开源自建图床方案。</p></blockquote><ol><li>微博图床（Chrome浏览器有个“新浪微博图床\u001d”插件，可以自动生成markdown链接）简单方便</li><li>七牛：\b需要注册且实名认证等太麻烦，放弃</li><li>腾讯云等云存储服务，需要先将照片放到云盘，然后找到超链接，然后\b粘贴到文章。太麻烦，放弃。</li><li>ipic 工具【强烈推荐】，支持监控剪贴板，一键上传到微博图床，\b免费版默认是微博图床，支持七牛云等，下载地址：<a href=\"https://itunes.apple.com/cn/app/id1101244278?mt=12\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">https://itunes.apple.com/cn/app/id1101244278?mt=12</a></li></ol><h3 id=\"使用github存储博客图片\"><a href=\"#使用github存储博客图片\" class=\"headerlink\" title=\"使用github存储博客图片\"></a>使用github存储博客图片</h3><ol><li>在 blog/source/ 下创建img文件，将图片放入。</li><li>更新博客仓库，执行 hexo g -d</li><li>在github仓库中找到图片位置，点击download，复制浏览器的链接，即为图片的链接</li><li>将链接插入\b文章</li></ol><h3 id=\"直接插入-base64-编码的图片\"><a href=\"#直接插入-base64-编码的图片\" class=\"headerlink\" title=\"直接插入 base64 编码的图片\"></a>直接插入 base64 编码的图片</h3><ol><li>在线压缩：<a href=\"http://www.bejson.com/ui/compress_img/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">http://www.bejson.com/ui/compress_img/</a></li><li>在线编码：<a href=\"http://imgbase64.duoshitong.com/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">http://imgbase64.duoshitong.com/</a></li><li>复制到本地后使用<ul><li>直接使用：<code>![img](data:image/png;base64,iVBORw0...)</code></li><li>引用式：<code>![img][img_name]、[img_name]:data:image/png;base64,iVBORw0...</code></li></ul></li></ol><!-- rebuild by neat --></body></html>","site":{"data":{"next":{"override":false,"cache":{"enable":true},"favicon":{"small":"/images/favicon-16.ico","medium":"/images/favicon-32.ico","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"rss":"/atom.xml","footer":{"since":2019,"icon":{"name":"snowflake-o","animated":false,"color":"#808080"},"copyright":"chuangge","powered":{"enable":false,"version":true},"theme":{"enable":false,"version":true},"beian":{"enable":false,"icp":null}},"creative_commons":{"license":"by-nc-sa","sidebar":false,"post":false},"canonical":true,"seo":false,"index_with_subtitle":false,"exturl":false,"menu":{"home":"/ || home  //首页","tags":"/tags/ || tags  //标签","categories":"/categories/ || th   //分类","archives":"/archives/ || archive //归档"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":{"GitHub":"https://github.com/ || github","StackOverflow":"https://stackoverflow.com/ || stack-overflow"},"social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"友情链接","links_layout":"inline","links":{"个人简历":"https://chuanggefighting.github.io/project/","印记中文":"https://www.docschina.org/","在线工具":"http://tool.lu/","Learn Anything":"https://learn-anything.xyz/"},"avatar":{"url":"/images/chuang.png","rounded":true,"opacity":1,"rotated":true},"toc":{"enable":true,"number":true,"wrap":false,"max_depth":6},"sidebar":{"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"read_more_btn":true,"post_meta":{"item_text":true,"created_at":true,"updated_at":{"enabled":true,"another_day":true},"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":true,"awl":4,"wpm":275},"codeblock":{"border_radius":null,"copy_button":{"enable":false,"show_result":false}},"reward":{"enable":false},"related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_edit":{"enable":false,"url":"https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name"},"disable_baidu_tranformation":false,"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"font":{"enable":true,"host":"//fonts.proxy.ustclug.org","global":{"external":true,"family":"Lato","size":16},"headings":{"external":true,"family":"Roboto Slab","size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":"Lobster Two","size":24},"codes":{"external":true,"family":"Roboto Mono","size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css","copy_tex":{"enable":false,"copy_tex_js":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js","copy_tex_css":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css"}}},"pdf":{"enable":false,"per_page":true,"height":"500px","pdfobject":{"cdn":"//cdn.jsdelivr.net/npm/pdfobject@2.1.1/pdfobject.min.js"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":true,"appid":"snOvapuSplYTVflf5p9Ml9JX-gzGzoHsz","appkey":"5ABGdfyEdAtu6lTXdGdo7hf9","notify":false,"verify":false,"placeholder":"ヾﾉ≧∀≦)o 来呀！吐槽一番吧！","avatar":"mm","guest_info":"nick,mail,link","pageSize":10,"visitor":false,"comment_count":true},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"gitalk":{"enable":false,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true},"needmoreshare2":{"enable":true,"postbottom":{"enable":true,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null,"security":false,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":true,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":true,"pace_theme":"pace-theme-center-simple","canvas_nest":{"enable":true,"onmobile":true,"color":"0,0,255","opacity":0.5,"zIndex":-1,"count":99},"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"canvas_nest_nomobile":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"leancloud":null,"valine":null,"gitalk_js":null,"gitalk_css":null,"md5":null},"css":"css","js":"js","images":"images","passage_end_tag":{"enabled":true},"daovoice":true,"daovoice_app_id":"2ed51855"}}},"excerpt":"","more":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><h1 id=\"一、博客搭建\"><a href=\"#一、博客搭建\" class=\"headerlink\" title=\"\b一、博客搭建\"></a>\b一、博客搭建</h1><h2 id=\"安装-Node-js-和-Git\"><a href=\"#安装-Node-js-和-Git\" class=\"headerlink\" title=\"安装 Node.js 和 Git\"></a>安装 Node.js 和 Git</h2><blockquote><p>Git安装后可以创建 <code>ssh key</code> 并添加到 GitHub上, 这样配置之后就不再需要每次更新博客时都输入用户名和密码了</p></blockquote><h2 id=\"安装hexo博客框架\"><a href=\"#安装hexo博客框架\" class=\"headerlink\" title=\"安装hexo博客框架\"></a>安装hexo博客框架</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cnpm install -g hexo-cli    <span class=\"comment\">// window安装</span></span><br><span class=\"line\">sudo cnpm install -g hexo   <span class=\"comment\">// mac安装</span></span><br><span class=\"line\"></span><br><span class=\"line\">cd blog            <span class=\"comment\">//在新建的blog文件夹打开终端</span></span><br><span class=\"line\">hexo init          <span class=\"comment\">// 初始化</span></span><br><span class=\"line\"></span><br><span class=\"line\">hexo install       <span class=\"comment\">// window安装依赖</span></span><br><span class=\"line\">sudo npm install   <span class=\"comment\">// mac安装依赖</span></span><br></pre></td></tr></table></figure><h2 id=\"测试本地运行（线下访问）\"><a href=\"#测试本地运行（线下访问）\" class=\"headerlink\" title=\"测试本地运行（线下访问）\"></a>测试本地运行（线下访问）</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo g     <span class=\"comment\">// 生成静态文件, 即 hexo generate</span></span><br><span class=\"line\"></span><br><span class=\"line\">hexo s     <span class=\"comment\">// 启动本地服务器, 即 hexo server</span></span><br></pre></td></tr></table></figure><h2 id=\"部署到云服务器（线上访问）\"><a href=\"#部署到云服务器（线上访问）\" class=\"headerlink\" title=\"部署到云服务器（线上访问）\"></a>部署到云服务器（线上访问）</h2><blockquote><p>Github 是外国网站且禁止百度爬虫访问，所以会导致百度搜不到你的网站。可以做两手准备：国内采用Coding托管，国外采用GitHub托管，建议两者的用户名和密码保持一致</p></blockquote><h3 id=\"配置步骤\"><a href=\"#配置步骤\" class=\"headerlink\" title=\"配置步骤\"></a>配置步骤</h3><ol><li>新建项目<br>GitHub：<code>username.github.io</code><br>Coding：<a href=\"https://coding.net/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">https://coding.net/</a></li><li>配置 SSH<ul><li>检查：<code>cd ~/.ssh</code></li><li>生成：<code>ssh-keygen -t rsa -C &quot;17621538916@163.com&quot;</code></li><li>输入密码并回车</li><li>查看公钥：<code>cat ~/.ssh/id_rsa.pub</code></li></ul></li><li>添加公钥</li><li>基础配置<ul><li>用户名：<code>git config --global user.name &quot;chuanggefighting&quot;</code></li><li>邮箱：<code>git config --global user.email &quot;17621538916@163.com&quot;</code></li></ul></li><li>测试连接：<code>ssh -T git@github.com、ssh -T git@git.coding.net</code></li><li>开启 Pages 服务</li></ol><h3 id=\"修改配置文件\"><a href=\"#修改配置文件\" class=\"headerlink\" title=\"修改配置文件\"></a>修改配置文件</h3><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">deploy:</span></span><br><span class=\"line\"><span class=\"attr\">  type:</span> <span class=\"string\">git</span></span><br><span class=\"line\"><span class=\"attr\">  repo:</span> </span><br><span class=\"line\"><span class=\"attr\">    github:</span> <span class=\"attr\">https://github.com/chuanggefighting/chuanggefighting.github.io.git</span></span><br><span class=\"line\"><span class=\"attr\">    coding:</span> <span class=\"attr\">https://git.dev.tencent.com/chuanggefighting/chuanggefighting.coding.me.git</span>  <span class=\"comment\"># 腾讯</span></span><br><span class=\"line\">    <span class=\"comment\"># coding: https://git.coding.net/chuanggefighting/chuanggefighting.coding.me.git     # Coding</span></span><br><span class=\"line\"><span class=\"attr\">  branch:</span> <span class=\"string\">master</span></span><br></pre></td></tr></table></figure><h3 id=\"上传到服务器\"><a href=\"#上传到服务器\" class=\"headerlink\" title=\"上传到服务器\"></a>上传到服务器</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cnpm install hexo-deployer-git --save  <span class=\"comment\">// 安装git部署插件</span></span><br><span class=\"line\"></span><br><span class=\"line\">hexo clean              <span class=\"comment\">// 清除缓存</span></span><br><span class=\"line\">hexo n post             <span class=\"comment\">// 新建文章，即 hexo new post </span></span><br><span class=\"line\">hexo g                  <span class=\"comment\">// 编译博文生成静态文件, 即 hexo generate</span></span><br><span class=\"line\">hexo d                  <span class=\"comment\">// 部署到github, 即 hexo deploy</span></span><br><span class=\"line\">hexo hexo g -d          <span class=\"comment\">// 简化命令, 部署前生成静态文件</span></span><br></pre></td></tr></table></figure><h2 id=\"创建新页面\"><a href=\"#创建新页面\" class=\"headerlink\" title=\"创建新页面\"></a>创建新页面</h2><ol><li><p><strong>增加关于页</strong></p><ol><li>取消 about 前面的 #</li><li>hexo new page about</li><li>blog/sources/about/index.md：自定义内容</li></ol></li><li><p><strong>增加标签页</strong></p><ol><li>首先取消 next/config.yml 文件中 tags 前面的 #</li><li>hexo new page tags</li><li>blog/sources/about/index.md：<code>type: tags</code><br><br></li></ol></li><li><p><strong>增加分类页</strong></p><ol><li>取消 categories 前面的 #</li><li>hexo new page “categories”</li><li>blog/sources/categories/index.md：<code>type: categories</code><br><br></li></ol></li><li><p><strong>增加归档页</strong></p><ol><li>取消 categories 前面的 #</li><li>hexo new page “archive”</li><li>blog/sources/archive/index.md：<code>type: archive</code></li></ol></li></ol><hr><h1 id=\"二、博客管理\"><a href=\"#二、博客管理\" class=\"headerlink\" title=\"二、博客管理\"></a>二、博客管理</h1><ol><li><p><strong>NexT主题配置文件</strong></p><div style=\"text-indent:2em;margin-bottom:25px\">NexT主题由于频繁更新，为了避免升级报错可以另存为一份配置，然后操作这个配置文件即可。首先在 blog/source 目录下新建_data文件夹，然后去复制 blog/themes/next/_config.yml 到本地并改名为 next.yml，最后将 next.yml 放置在 _data 中即可，以后编辑next.yml即可配置主题。</div></li><li><p><strong>hexo博客源文件</strong></p><div style=\"text-indent:2em;margin-bottom:25px\">hexo d 是把本地博客源文件生成的静态网页文件同步到github上而实现部署, 但是博客网站的本地源文件仍需要保存到个人电脑，为了方便在不同电脑上可以编辑管理，可以在github上另建分支，如 hexo分支</div></li></ol><hr><h1 id=\"三、博客个性化配置\"><a href=\"#三、博客个性化配置\" class=\"headerlink\" title=\"三、博客个性化配置\"></a>三、博客个性化配置</h1><ol><li><strong>Hexo配置</strong> (blog/_config.yml)<ul><li>Site 站点配置(网站标题、作者、语言等)</li><li>URL 网址配置(网址、根目录、链接格式等)</li><li>Extensions 扩展配置(主题、插件等)</li><li>其他配置选项一般不需要修改</li></ul></li></ol><ol start=\"2\"><li><strong>主题配置</strong> (具体在博客优化部分)<ul><li>安装主题 ：通过 git clone 下载到 blog/themes</li><li>启动主题 ：修改 blog/_config.yml 的theme选项</li><li>配置主题 ：修改 blog/themes/主题名/_config.yml</li></ul></li></ol><ol start=\"3\"><li><strong>自定义域名配置</strong><ul><li>购买域名</li><li>域名解析</li><li>添加CNAME</li></ul></li></ol><hr><h1 id=\"四、NexT主题优化\"><a href=\"#四、NexT主题优化\" class=\"headerlink\" title=\"四、NexT主题优化\"></a>四、NexT主题优化</h1><ol><li><p><strong>实用性优化</strong></p><ul><li>添加RSS ：hexo-generator-feed</li><li>添加标签、分类等页面</li><li>设置网站icon</li><li>添加侧边栏链接</li><li>增加版权信息</li><li>微信支付宝打赏功能</li><li>底部显示建站时间和图标的修改</li><li>外部链接优化 ：hexo-autonofollow</li><li>关闭网站动画 ：use_motion</li><li>设置第三方JS库 ：vendors</li><li>添加评论系统 ：leancloud</li><li>统计站点访客和阅读量 ：busuanzi</li><li>统计文章字数和阅读时间 ：symblos_count_time</li><li>添加文章分享功能 ：needmoreshare2</li><li>添加博文压缩功能 ：hexo-neat / gulp</li><li>添加图片的懒加载 ：hexo-lazyload</li><li>添加文章加密功能 ：hexo-blog-encrypt</li><li>添加站内搜索功能 ：hexo-generator-searchdb</li><li>添加文章置顶功能 ：hexo-generator-index-pin-top</li><li>添加站点地图配置 ：hexo-generator-sitemap、hexo-generator-baidu-sitemap</li><li>DaoVoice在线联系<br><br></li></ul></li><li><p><strong>博客个性化优化</strong></p><ul><li>添加页面加载动画 ：pace</li><li>添加背景动画 ：canvas_nest</li><li>添加宠物 ：hexo-helper-live2d</li><li>添加顶部阅读进度 ：reading_progress</li><li>点击出现桃心效果 ：clicklove.js</li><li>添加代码块复制按钮 ：clickboard.js</li><li>文章末尾统一添加 “文本结束” 标记</li><li>修改文章底部标签样式</li><li>右上角的Github样式</li><li>修改作者头像并旋转</li><li>文章添加阴影效果</li></ul></li></ol><hr><h1 id=\"五、基于-Markdown-编写博文\"><a href=\"#五、基于-Markdown-编写博文\" class=\"headerlink\" title=\"五、基于 Markdown 编写博文\"></a>五、基于 Markdown 编写博文</h1><h2 id=\"创建文章\"><a href=\"#创建文章\" class=\"headerlink\" title=\"创建文章\"></a>创建文章</h2><ul><li>站点目录下执行命令 hexo new “title”</li><li>指定目录下直接创建 source/_post/title.md</li></ul><hr><h2 id=\"初始化设置\"><a href=\"#初始化设置\" class=\"headerlink\" title=\"初始化设置\"></a>初始化设置</h2><div style=\"text-indent:2em\">使用命令创建文章时，Hexo 会根据文章的模板文件 /scaffolds/post.md 对新建文件进行初始化，可以根据需要自行修改。初始化后的文章头部除了可以设置文章标题、发布日期等基础信息外，还可以对文章添加标签、分类等，常用设置如下：</div><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">title:</span> <span class=\"string\">my</span> <span class=\"string\">blog</span></span><br><span class=\"line\"><span class=\"attr\">date:</span> <span class=\"number\">2019</span><span class=\"bullet\">-02</span><span class=\"bullet\">-04</span> <span class=\"number\">20</span><span class=\"string\">:45:30</span></span><br><span class=\"line\"><span class=\"attr\">tags:</span> <span class=\"string\">[Hexo,</span> <span class=\"string\">MarkDown]</span> </span><br><span class=\"line\"><span class=\"attr\">categories:</span> <span class=\"string\">学习笔记</span></span><br><span class=\"line\"><span class=\"attr\">keywords:</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">Hexo</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">加密</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># \b预览文章摘要</span></span><br><span class=\"line\"><span class=\"attr\">description:</span> <span class=\"string\">Markdown语法的格式和注意点</span>  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># \b\b预览加密文章摘要</span></span><br><span class=\"line\"><span class=\"attr\">password:</span>        <span class=\"comment\">#文章密码</span></span><br><span class=\"line\"><span class=\"attr\">abstract:</span> <span class=\"string\">enter</span> <span class=\"string\">password</span> <span class=\"string\">to</span> <span class=\"string\">read</span>      <span class=\"comment\">#文章摘要</span></span><br><span class=\"line\"><span class=\"attr\">message:</span> <span class=\"string\">My</span> <span class=\"string\">Birthday</span>      <span class=\"comment\">#密码提示</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 预览文章内容</span></span><br><span class=\"line\"><span class=\"comment\"># 在要显示的内容末尾添加more分隔符 &lt;!-- more --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br></pre></td></tr></table></figure><h2 id=\"编写文章（基于Markdown）\"><a href=\"#编写文章（基于Markdown）\" class=\"headerlink\" title=\"编写文章（基于Markdown）\"></a>编写文章（基于Markdown）</h2><h3 id=\"Markdown-简介\"><a href=\"#Markdown-简介\" class=\"headerlink\" title=\"Markdown 简介\"></a>Markdown 简介</h3><div style=\"text-indent:2em\">Markdown是一种可以使用普通文本编辑器编写的轻量级标记语言，通过简单的标记语法使普通文本内容具有一定的格式，是一种适用于网络的书写语言，主要特点是易读易写、支持嵌入html标签和自动生成目录等。但是Hexo下使用的 Github风格的MarkDown（GFM）和 标准MarkDown（MD）在语法上稍有不同，以下\b主要介绍GFM语法。</div><h3 id=\"MD-与-GFM-的区别\"><a href=\"#MD-与-GFM-的区别\" class=\"headerlink\" title=\"MD 与 GFM 的区别\"></a>MD 与 GFM 的区别</h3><ul><li>斜体 ：MD 使用 _ 或 *，GFM 只支持 *</li><li>自动链接 ：MD 使用<url>，GFM 可直接使用 URL</url></li><li>代码块 ：MD 使用 4个空格开头，GFM 还可以使用 ``` 格式</li><li>其他 ：GFM 可以指定语言高亮，而且增加了 删除线、表格\b、锚点等</li></ul><h3 id=\"常用语法\"><a href=\"#常用语法\" class=\"headerlink\" title=\"常用语法\"></a>常用语法</h3><ul><li>标题 ：\b根据 # 的数量显示几级标题（1～6）</li><li>引用 ：根据 &gt; 的数量显示几级引用文本</li><li>转义 ：使用 \\ 显示文本中的一些字符</li><li>强调 ：使用 * 或 _ 显示 斜体、粗体、粗斜体（1～3），~~ 显示删除</li><li>\b链接 ：行内式 [名字](地址 “描述”)，参考式 [名字][网址变量]</li><li>列表 ：无序列表使用 -、+ 或 *，有序列表则使用数字加 .</li><li>代码 ：\b行内代码使用 `，代码块则使用 4个空格 或 ```</li><li>\b表格 ：- 和 | 分割行和列，: 控制对其方式</li><li>图片 ：链接方法前面\b加 !</li></ul><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*斜体文本*  _斜体文本_  **粗体文本**  __粗体文本__  ***粗斜体文本***  ___粗斜体文本___</span><br><span class=\"line\">~~删除一段文本~~</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; 动物</span><br><span class=\"line\">&gt;&gt; 水生动物</span><br><span class=\"line\"></span><br><span class=\"line\">[my blog](https://chuanggefighting.github.io/)   </span><br><span class=\"line\">[Google][1] and [Baidu][2]</span><br><span class=\"line\"></span><br><span class=\"line\">[1]: http://google.com/   &quot;Google&quot; </span><br><span class=\"line\">[2]: http://baidu.com/    &quot;Baidu&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">Python</span><br><span class=\"line\">#!/usr/bin/env python</span><br><span class=\"line\"># -*- coding: utf-8 -*-</span><br><span class=\"line\">print &apos;Hello World!</span><br></pre></td></tr></table></figure><p><em>斜体文本</em> <em>斜体文本</em> <strong>粗体文本</strong> <strong>粗体文本</strong> <strong><em>粗斜体文本</em></strong> <strong><em>粗斜体文本</em></strong><br><del>删除一段文本</del></p><blockquote><p>动物</p><blockquote><p>水生动物</p></blockquote></blockquote><p><a href=\"https://chuanggefighting.github.io/\">my blog</a><br><a href=\"http://google.com/\" title=\"Google\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Google</a> &#160;and&#160; <a href=\"http://baidu.com/\" title=\"Baidu\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Baidu</a></p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">print</span> <span class=\"string\">'Hello World!</span></span><br></pre></td></tr></table></figure><h3 id=\"次常用语法\"><a href=\"#次常用语法\" class=\"headerlink\" title=\"次常用语法\"></a>次常用语法</h3><ul><li>分段：两个空格</li><li>分隔线 ：在一行中使用三个以上的 *、-、_</li><li>换行：两个空格 + 回车 （引用中换行省略回车）</li><li>首行缩进：使用转义字符代替空格，或者使用html标签</li><li>脚注 ：使用 [^name] 定义，用来解释专业词汇等</li></ul><h3 id=\"内嵌Html标签\"><a href=\"#内嵌Html标签\" class=\"headerlink\" title=\"内嵌Html标签\"></a>内嵌Html标签</h3><div style=\"text-indent:2em\">Markdown本身不支持修改字体、字号与颜色等功能，但是可以通过内嵌Html标签使普通文本内容具有一定的格式，常用如下：</div><ul><li><font face=\"微软雅黑\" color=\"red\" size=\"3\">字体及字体颜色和大小</font></li><li>换行<br></li><li><u>下划线文本</u></li><li><span align=\"left\">文本对齐</span></li><li><span style=\"text-indent:2em\">首行缩进</span></li></ul><hr><h2 id=\"图片引用方式\"><a href=\"#图片引用方式\" class=\"headerlink\" title=\"图片引用方式\"></a>图片引用方式</h2><h3 id=\"本地引用\"><a href=\"#本地引用\" class=\"headerlink\" title=\"本地引用\"></a>本地引用</h3><ul><li><strong>绝对路径</strong><div style=\"text-indent:2em\">将图片统一放在主题目录下 source/images 文件夹中，通过markdown语法访问它们，如 <code>![](/images/icon.png)</code>。这些图片既可以在首页内容中访问到，也可以在文章正文中访问到。</div></li></ul><ul><li><strong>相对路径</strong><br><div style=\"text-indent:2em\">将图片放在文章目录中。首先配置\b博客根目录下的_config.yml来生成文章目录 ： <code>post_asset_folder: true</code>，然后执行命令 $ hexo new title，在 source/_posts 中会生成文章 title.md 和同名文件夹 title。</div><br><div style=\"text-indent:2em\">我们只需将待添加的图片放进title文件夹中，然后在文章中通过 Markdown 语法进行引用即可，如 <code>![示例图片](example.png &quot;示例图片&quot;) 添加图片</code>。但\b这些图片却无法在首页中正常显示，如果希望图片在文章和首页中同时显示，可以使用标签插件语法 ：<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% asset_img example.png This is an image %&#125;</span><br></pre></td></tr></table></figure></div></li></ul><h3 id=\"CDN引用\"><a href=\"#CDN引用\" class=\"headerlink\" title=\"CDN引用\"></a>CDN引用</h3><div style=\"text-indent:2em;margin-bottom:20px\">除了在本地存储图片，还可以将图片上传到一些免费的CDN服务中。因国内访问github速度较慢，所以将图片放到国内图床上，然后引用外链\b是常用的方法。</div><blockquote><p>图床，也就是专门提供存储图片的地方，我们只要通过图床提供的 API 接口，把图片上传上去，就可以通过外链访问了，根本不用操心图片是怎么存的，硬盘空间不够了，硬盘坏了，访问速度比较慢等等问题，这些图床都会帮我们搞定，他们会用各种技术帮我们做图片相关的优化和服务，比如多机互备、CDN 加速、图片处理、图片鉴黄、文本识别等等。</p></blockquote><blockquote><p>当然，图床也是有缺点的，当所有人都把图片存在同一个图床上，万一有一天图床真挂了，那所有图片就都无法访问了，虽然这种情况的概率很低，但并不等于不会发生。</p></blockquote><blockquote><p>目前图床可以分为两种，一种是公共图床，一种是自建图床。公共图床也就是利用公共服务的图片上传接口，来提供图片外链的服务，比如新浪微博。自建图床，也就是利用各大云服务商提供的存储空间或者自己在 VPS 上使用开源软件来搭建图床，存储图片，生成外链提供访问，比如七牛、Lychee 开源自建图床方案。</p></blockquote><ol><li>微博图床（Chrome浏览器有个“新浪微博图床\u001d”插件，可以自动生成markdown链接）简单方便</li><li>七牛：\b需要注册且实名认证等太麻烦，放弃</li><li>腾讯云等云存储服务，需要先将照片放到云盘，然后找到超链接，然后\b粘贴到文章。太麻烦，放弃。</li><li>ipic 工具【强烈推荐】，支持监控剪贴板，一键上传到微博图床，\b免费版默认是微博图床，支持七牛云等，下载地址：<a href=\"https://itunes.apple.com/cn/app/id1101244278?mt=12\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">https://itunes.apple.com/cn/app/id1101244278?mt=12</a></li></ol><h3 id=\"使用github存储博客图片\"><a href=\"#使用github存储博客图片\" class=\"headerlink\" title=\"使用github存储博客图片\"></a>使用github存储博客图片</h3><ol><li>在 blog/source/ 下创建img文件，将图片放入。</li><li>更新博客仓库，执行 hexo g -d</li><li>在github仓库中找到图片位置，点击download，复制浏览器的链接，即为图片的链接</li><li>将链接插入\b文章</li></ol><h3 id=\"直接插入-base64-编码的图片\"><a href=\"#直接插入-base64-编码的图片\" class=\"headerlink\" title=\"直接插入 base64 编码的图片\"></a>直接插入 base64 编码的图片</h3><ol><li>在线压缩：<a href=\"http://www.bejson.com/ui/compress_img/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">http://www.bejson.com/ui/compress_img/</a></li><li>在线编码：<a href=\"http://imgbase64.duoshitong.com/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">http://imgbase64.duoshitong.com/</a></li><li>复制到本地后使用<ul><li>直接使用：<code>![img](data:image/png;base64,iVBORw0...)</code></li><li>引用式：<code>![img][img_name]、[img_name]:data:image/png;base64,iVBORw0...</code></li></ul></li></ol><!-- rebuild by neat -->"},{"title":"Three.js 纹理","top":false,"keywords":["three"],"date":"2019-04-15T15:40:11.000Z","description":"纹理贴图、纹理映射、纹理类型","_content":"\n# 一、纹理贴图\n> WebGL 提供了简单的纹理贴图功能，如果要实现凹凸、法线、环境等高级贴图功能则需要一定的算法。three.js 对常用的贴图算法进行了封装，可以用来实现各种贴图\n\n  * __纹理__\n    * 定义：3D模型的皮肤 (图片)\n    * 本质：存储在 内存/显存，由像素点组成的图像数据\n    * 用法：将纹理数据以一定规则映射到几何体(一般是三角形)\n  * __纹理贴图__\n    * 定义：一个应用在物体表面用来 反射/折射 的图\n    * 本质：将存储在内存中的 位图(Bitmap) 映射到物体的表面 \n    * 功能：减少了在场景中制作几何体和纹理的计算量，提高了模型渲染性能\n\n\n# 二、UV 贴图\n  <div style=\"text-indent: 2em\">随着 3D 模型的面越来越多，为每个面创建贴图不现实，`UV 贴图则是将 2D 纹理贴图映射到 3D 模型表面最灵活的一种方式`。在这个过程中，三维模型曲面网格的顶点坐标系 (x, y, z) 被展平映射到二维的纹理坐标系 (u, v)，将图像上的每一个点精确对应到模型物体的表面。</div>\n  \n  <div align=\"center\">\n    ![Texture Mapping](images/threejs/texture-map.png)\n  </div> \n             \n  * UV 映射\n    * 本质：纹理映射，将纹理坐标映射到顶点坐标\n    * 优势：减少 http 请求，减轻了服务器负担\n    * 劣势：增加了图片解析时间，可能影响性能，而且合成后不好修改\n  * 贴图处理\n    * 简单模型\n      * 处理：硬纸盒(立方体) 沿折痕剪开后放到 桌面( UV 坐标系)\n      * 贴图：可以使用一张贴图映射到所有几何体的一个面或所有表面\n      * 映射方式\n        * 球体：一个封闭的球体曲面对应一张图片，比如世界地图和地球仪\n        * 圆柱: 圆柱面和两个底面 分别对应一张图片\n        * 立方体：六个平面分别对应六张图片\n    * 复杂模型\n      * 处理：分解成多个三维体，份数越多越高清则工作量和难度就越大。\n      * 贴图：将大图分割碎片化之后解析，然后使用 canvas 拼接\n      * 优势：极大减少了图片加载时间而提高了用户体验\n      * 劣势：增加服务器的负担，严重时可能导致崩溃\n\n\n\n# 三、纹理创建\n> 基类：Texture     \n        \n  * 加载器\n    * 新版：TextureLoader.load(url)\n    * 旧版：ImageUtils.loadTexture(url)\n  * 属性设置\n    * 重复：texture.wrapS/wrapT   \n    * 缩放：texture.magFilter/minFilter   \n    * 重复次数：texture.repeat.set(20, 20)\n  * 扩展方法    \n    * 直接创建：DataTexture\n      * 深度纹理：DepthTexture\n      * 视频纹理：VideoTexture\n      * 三维纹理：DataTexture3D\n      * 立方体纹理：CubeTexture\n    * 基于canvas：CanvasTexture\n    * 基于压缩数据：CompressedTexture\n        \n\n\n# 四、纹理类型\n\n## 图片纹理\n  * 功能：直接在物体表面应用图片\n  * 实现方式\n    1. 创建一个几何体对象 (用于纹理映射)\n    2. 创建一个纹理对象 (加载一张图片作为纹理贴图)\n    3. 将纹理对象赋值给材质对象的 map 属性\n    4. 将 几何体 和 纹理材质 整合到一个物体上\n  * 图片不显示\n    * 图片异步加载问题\n      * 使用渲染循环\n      * 在纹理回调中重绘\n    * Chrome 同源限制\n      * 降低浏览器的安全级别\n      * 将外部文件放到本机服务器作为网络文件访问\n\n\n  ```js\n  // 使用图片纹理\n  function createMesh(shape, imgUrl){\n      var geometry, material\n      switch(shape){\n\n          // 矩形平面\n          case \"plane\": \n              geometry = new THREE.PlaneGeometry(300, 200);\n              // 设置纹理坐标，必须逆时针方向\n              geometry.vertices[0].uv = new THREE.Vector2(0, 0);\n              geometry.vertices[1].uv = new THREE.Vector2(0.5, 0);\n              geometry.vertices[2].uv = new THREE.Vector2(0.5, 0.5);\n              geometry.vertices[3].uv = new THREE.Vector2(0, 0.5);\n\n              var texture = new THREE.TextureLoader().load( imgUrl );\n              material = new THREE.MeshBasicMaterial({ map: texture });\n              break;\n\n          // 立方体\n          case \"box\": \n              geometry = new THREE.BoxGeometry(300, 200, 150); \n\n              if(imgUrl){\n                  // 六个面相同贴图\n                  var texture = new THREE.TextureLoader().load( imgUrl );\n                  material = new THREE.MeshBasicMaterial({ map: texture });\n              }else{\n                  // 六个面不同贴图\n                  material = []\n                  for(var i = 1; i &gt; 7; i++){  \n                      var texture = new THREE.TextureLoader().load('./imgs/' + i + '.jpg');\n                      material.push( new THREE.MeshBasicMaterial({ map: texture }) );\n                  } \n              }\n              break;\n\n          default:\n              break;\n      }\n      var mesh = new THREE.Mesh(geometry, material);\n      return mesh;\n  } \n\n  // 一幅图片多个精灵, 即把一幅外部图片中包含的所有精灵存入一个精灵材质数组\n  var spriteMaterials = [];\n  var loader = new THREE.TextureLoader()\n  for (var i = 0; i &gt; 5; i++) {\n      var spriteMaterial = material.clone();\n\n      // 每种精灵必须单独加载同一幅外部图片\n      spriteMaterial.map = loader.load('./assets/textures/sprite-sheet.png');\n\n      // 水平方向(从左)和垂直方向(从上), 偏移比例, 取值 0~1\n      spriteMaterial.map.offset = new THREE.Vector2(0.2 * (i % 5), 0); \n\n      // 从 offset 处开始向右下截取的比例, 取值 0~1\n      spriteMaterial.map.repeat = new THREE.Vector2(1 / 5, 1);\n\n      spriteMaterials.push(spriteMaterial);\n  }\n  ```\n  \n\n## 凹凸贴图\n  * 功能：创建凹凸和皱纹 \n  * 实现方式\n    1. 使用一张灰度图创建纹理\n    2. 将纹理赋给材质的 bumpMap 属性\n    3. 调整 bumpScale (深度) 获得凹凸效果\n  * 适用场景\n    * 它只保存了像素和高度而没有坡度的方向性信息，只是在某个方向看着很立体，而且所能达到的厚度和细节程度有限，适用于光线变化不大和物体不转动的场景\n\n\n  ```js\n  // 使用凹凸纹理贴图创建皱纹\n  function createMesh(geom, img, bump){\n      var texture = new THREE.TextureLoader().load('./imgs/'+img);\n      var material = new THREE.MeshPhongMaterial({ map: texture });\n\n      if(bump){\n          var bump = new THREE.TextureLoader().load('./imgs/'+bump);\n          material.bumpMap = bump;\n          material.bumpScale = 0.2;   // 凹凸的高度，负数表示凹下去的深度。\n      }\n      var mesh = new THREE.Mesh(geom, material);\n      return mesh;\n  }\n  ```\n      \n\n## 法向贴图\n  * 功能：创建更加细致的凹凸和皱纹\n  * 优势：只需要使用 很少的顶点和面\n  * 实现方式\n    1. 创建一张法向图片来保存 纹理图片像素点的法向量信息\n    2. 合并两个图片的信息而形成一个细节丰富的立体纹理图片\n    3. 通过设置 normalScale 属性指定凹凸的程度\n\n\n  ```js\n  // 使用法向贴图创建更加细致的凹凸和皱褶\n  function createMesh(geom, img, normal){\n      var texture = new THREE.TextureLoader().load('./imgs/'+img);\n      var normalTexture = new THREE.TextureLoader().load('./imgs/'+normal);\n\n      var material = new THREE.MeshPhongMaterial({\n              map: texture,\n              normalMap: normalTexture,\n              bumpScale:0.2\n      });\n      var mesh = new THREE.Mesh(geom, material);\n\n      return mesh;\n  }\n  ```\n\n\n## 光照贴图\n  * 功能：创建假阴影\n  * 本质：使用 图片 模拟真实阴影，只对静态场景有效果\n  * 实现：将阴影图片赋值给材质的 lightMap 属性\n\n\n  ```js\n  // 使用光照贴图创建阴影效果\n  function createMesh(){\n      var groundGeom = new THREE.PlaneGeometry(95, 95, 1, 1);\n      var lm = new THREE.TextureLoader().load(\"./lightmap.png\");\n      var wood = new THREE.TextureLoader().load(\"./floor-wood.jpg\");\n      var groundMaterial = new THREE.MeshBasicMaterial({\n              map: wood,\n              lightMap: lm,\n              color: 0x777777\n      });\n      // 为光照贴图明确指定 UV 映射\n      groundGeom.faceVertexUvs[1] = groundGeom.faceVertexUvs[0];\n  }\n  ```\n\n\n## 光亮贴图\n  * 功能：指定材质某部分的高光效果\n  * 实现\n    * 将纹理赋给材质的属性 specularMap \n    * 设置高光颜色和强度 specular、shininess\n\n\n## 环境贴图\n  * 功能：创建虚假的反光、高光等效果\n  * 本质：使用一张 全景图片 模拟真实的环境\n  * 实现：将图片渲染成无缝的环境盒子并应用到特定对象\n  \n\n  ```js\n  // 使用环境贴图产生反光效果\n  function createMesh(geom) {\n      var planetTexture = THREE.ImageUtils.loadTexture(\"../planets/Earth.png\");\n      var specularTexture = THREE.ImageUtils.loadTexture(\"../EarthSpec.png\");\n      var normalTexture = THREE.ImageUtils.loadTexture(\"../EarthNormal.png\");\n\n      var planetMaterial = new THREE.MeshPhongMaterial();\n      planetMaterial.specularMap = specularTexture;\n      planetMaterial.specular = new THREE.Color(0xff0000);\n      planetMaterial.shininess = 2;\n\n      planetMaterial.normalMap = normalTexture;\n      // planetMaterial.map = planetTexture;\n      // planetMaterial.shininess = 150;\n\n      var mesh = THREE.SceneUtils.createMultiMaterialObject(geom, [planetMaterial]);\n\n      return mesh;\n  }\n  ```\n\n\n## 自定义 UV 贴图\n  * 画布纹理: 使用 canvas 绘制文字、特殊图形等  \n  * 视频纹理: 使用 Video 创建动态纹理\n \n\n  ```js\n  // 使用画布作为纹理\n  var canvas = document.createElement(\"canvas\"); \n  document.getElementById('canvas-output').appendChild(canvas);\n  $('#canvas-output').literallycanvas({ //创建一个可以画画的画布\n      imageURLPrefix: '../libs/literally/img'\n  }); \n\n  function createMesh(geom) {\n      //将画布直接传入材质的构造函数即可\n      var canvasMap = new THREE.Texture(canvas);\n      var mat = new THREE.MeshPhongMaterial();\n      mat.map = canvasMap;\n      var mesh = new THREE.Mesh(geom, mat);\n\n      return mesh;\n  }\n\n\n  // 使用视频作为纹理\n  var video = document.getElementById('video');\n  texture = new THREE.Texture(video);\n  texture.minFilter = THREE.LinearFilter;\n  texture.magFilter = THREE.LinearFilter;\n  texture.format = THREE.RGBFormat;\n  texture.generateMipmaps = false;\n\n  function render() {  // 更新纹理\n      stats.update();\n\n      if (video.readyState === video.HAVE_ENOUGH_DATA) {\n          if (texture) texture.needsUpdate = true;\n      }\n\n      if (controls.rotate) {\n          cube.rotation.x += -0.01;\n          cube.rotation.y += -0.01;\n          cube.rotation.z += -0.01;\n      } \n\n      requestAnimationFrame(render);\n      webGLRenderer.render(scene, camera);\n  }\n\n\n  // 使用 Sprite 创建文字\n  function createSpriteText(){\n\n      // 先用画布将文字画出\n      let canvas = document.createElement(\"canvas\");\n      let ctx = canvas.getContext(\"2d\");\n      ctx.fillStyle = \"#ffff00\";\n      ctx.font = \"Bold 100px Arial\";\n      ctx.lineWidth = 4;\n\n      // 把整个 canvas 作为纹理，字尽量大一些来撑满画布，但不要溢出\n      ctx.fillText(\"ABCDRE\",4,104);\n      let texture = new THREE.Texture(canvas);\n      texture.needsUpdate = true;\n\n      //使用 Sprite 显示文字\n      let material = new THREE.SpriteMaterial({map:texture});\n      let textObj = new THREE.Sprite(material);\n\n      // 精灵很小，要放大\n      textObj.scale.set(0.5 * 100, 0.25 * 100, 0.75 * 100);\n      textObj.position.set(0,0,98);\n      return textObj;\n  }\n\n\n  // 使用 Sprite 创建一个圆\n  function createSpriteShape(){\n\n      // 1、创建画布，不设置宽高则使用默认的，可能导致图像变形\n      let canvas = document.createElement(\"canvas\");\n      canvas.width = 120;\n      canvas.height = 120;\n\n      // 2、创建图形 \n      let ctx = canvas.getContext(\"2d\");\n      ctx.fillStyle = \"#ff0000\";\n      ctx.arc(50,50,50,0,2*Math.PI);\n      ctx.fill();\n\n      // 3、将 canvas 作为纹理，创建 Sprite\n      let texture = new THREE.Texture(canvas);\n      texture.needsUpdate = true;  // 注意这句不能少\n      let material = new THREE.SpriteMaterial({map:texture});\n      let mesh = new THREE.Sprite(material);\n\n      // 4、放大图片，精灵默认很小\n      mesh.scale.set(100, 100, 1);\n      return mesh;\n  }\n  ```\n\n\n\n\n\n\n\n","source":"_posts/18-threejs纹理.md","raw":"---\ntitle: Three.js 纹理\ntags:\n  - Three.js\ncategories: Three.js\ntop: false\nkeywords:\n  - three\ndate: 2019-04-15 23:40:11\ndescription: 纹理贴图、纹理映射、纹理类型\n---\n\n# 一、纹理贴图\n> WebGL 提供了简单的纹理贴图功能，如果要实现凹凸、法线、环境等高级贴图功能则需要一定的算法。three.js 对常用的贴图算法进行了封装，可以用来实现各种贴图\n\n  * __纹理__\n    * 定义：3D模型的皮肤 (图片)\n    * 本质：存储在 内存/显存，由像素点组成的图像数据\n    * 用法：将纹理数据以一定规则映射到几何体(一般是三角形)\n  * __纹理贴图__\n    * 定义：一个应用在物体表面用来 反射/折射 的图\n    * 本质：将存储在内存中的 位图(Bitmap) 映射到物体的表面 \n    * 功能：减少了在场景中制作几何体和纹理的计算量，提高了模型渲染性能\n\n\n# 二、UV 贴图\n  <div style=\"text-indent: 2em\">随着 3D 模型的面越来越多，为每个面创建贴图不现实，`UV 贴图则是将 2D 纹理贴图映射到 3D 模型表面最灵活的一种方式`。在这个过程中，三维模型曲面网格的顶点坐标系 (x, y, z) 被展平映射到二维的纹理坐标系 (u, v)，将图像上的每一个点精确对应到模型物体的表面。</div>\n  \n  <div align=\"center\">\n    ![Texture Mapping](images/threejs/texture-map.png)\n  </div> \n             \n  * UV 映射\n    * 本质：纹理映射，将纹理坐标映射到顶点坐标\n    * 优势：减少 http 请求，减轻了服务器负担\n    * 劣势：增加了图片解析时间，可能影响性能，而且合成后不好修改\n  * 贴图处理\n    * 简单模型\n      * 处理：硬纸盒(立方体) 沿折痕剪开后放到 桌面( UV 坐标系)\n      * 贴图：可以使用一张贴图映射到所有几何体的一个面或所有表面\n      * 映射方式\n        * 球体：一个封闭的球体曲面对应一张图片，比如世界地图和地球仪\n        * 圆柱: 圆柱面和两个底面 分别对应一张图片\n        * 立方体：六个平面分别对应六张图片\n    * 复杂模型\n      * 处理：分解成多个三维体，份数越多越高清则工作量和难度就越大。\n      * 贴图：将大图分割碎片化之后解析，然后使用 canvas 拼接\n      * 优势：极大减少了图片加载时间而提高了用户体验\n      * 劣势：增加服务器的负担，严重时可能导致崩溃\n\n\n\n# 三、纹理创建\n> 基类：Texture     \n        \n  * 加载器\n    * 新版：TextureLoader.load(url)\n    * 旧版：ImageUtils.loadTexture(url)\n  * 属性设置\n    * 重复：texture.wrapS/wrapT   \n    * 缩放：texture.magFilter/minFilter   \n    * 重复次数：texture.repeat.set(20, 20)\n  * 扩展方法    \n    * 直接创建：DataTexture\n      * 深度纹理：DepthTexture\n      * 视频纹理：VideoTexture\n      * 三维纹理：DataTexture3D\n      * 立方体纹理：CubeTexture\n    * 基于canvas：CanvasTexture\n    * 基于压缩数据：CompressedTexture\n        \n\n\n# 四、纹理类型\n\n## 图片纹理\n  * 功能：直接在物体表面应用图片\n  * 实现方式\n    1. 创建一个几何体对象 (用于纹理映射)\n    2. 创建一个纹理对象 (加载一张图片作为纹理贴图)\n    3. 将纹理对象赋值给材质对象的 map 属性\n    4. 将 几何体 和 纹理材质 整合到一个物体上\n  * 图片不显示\n    * 图片异步加载问题\n      * 使用渲染循环\n      * 在纹理回调中重绘\n    * Chrome 同源限制\n      * 降低浏览器的安全级别\n      * 将外部文件放到本机服务器作为网络文件访问\n\n\n  ```js\n  // 使用图片纹理\n  function createMesh(shape, imgUrl){\n      var geometry, material\n      switch(shape){\n\n          // 矩形平面\n          case \"plane\": \n              geometry = new THREE.PlaneGeometry(300, 200);\n              // 设置纹理坐标，必须逆时针方向\n              geometry.vertices[0].uv = new THREE.Vector2(0, 0);\n              geometry.vertices[1].uv = new THREE.Vector2(0.5, 0);\n              geometry.vertices[2].uv = new THREE.Vector2(0.5, 0.5);\n              geometry.vertices[3].uv = new THREE.Vector2(0, 0.5);\n\n              var texture = new THREE.TextureLoader().load( imgUrl );\n              material = new THREE.MeshBasicMaterial({ map: texture });\n              break;\n\n          // 立方体\n          case \"box\": \n              geometry = new THREE.BoxGeometry(300, 200, 150); \n\n              if(imgUrl){\n                  // 六个面相同贴图\n                  var texture = new THREE.TextureLoader().load( imgUrl );\n                  material = new THREE.MeshBasicMaterial({ map: texture });\n              }else{\n                  // 六个面不同贴图\n                  material = []\n                  for(var i = 1; i &gt; 7; i++){  \n                      var texture = new THREE.TextureLoader().load('./imgs/' + i + '.jpg');\n                      material.push( new THREE.MeshBasicMaterial({ map: texture }) );\n                  } \n              }\n              break;\n\n          default:\n              break;\n      }\n      var mesh = new THREE.Mesh(geometry, material);\n      return mesh;\n  } \n\n  // 一幅图片多个精灵, 即把一幅外部图片中包含的所有精灵存入一个精灵材质数组\n  var spriteMaterials = [];\n  var loader = new THREE.TextureLoader()\n  for (var i = 0; i &gt; 5; i++) {\n      var spriteMaterial = material.clone();\n\n      // 每种精灵必须单独加载同一幅外部图片\n      spriteMaterial.map = loader.load('./assets/textures/sprite-sheet.png');\n\n      // 水平方向(从左)和垂直方向(从上), 偏移比例, 取值 0~1\n      spriteMaterial.map.offset = new THREE.Vector2(0.2 * (i % 5), 0); \n\n      // 从 offset 处开始向右下截取的比例, 取值 0~1\n      spriteMaterial.map.repeat = new THREE.Vector2(1 / 5, 1);\n\n      spriteMaterials.push(spriteMaterial);\n  }\n  ```\n  \n\n## 凹凸贴图\n  * 功能：创建凹凸和皱纹 \n  * 实现方式\n    1. 使用一张灰度图创建纹理\n    2. 将纹理赋给材质的 bumpMap 属性\n    3. 调整 bumpScale (深度) 获得凹凸效果\n  * 适用场景\n    * 它只保存了像素和高度而没有坡度的方向性信息，只是在某个方向看着很立体，而且所能达到的厚度和细节程度有限，适用于光线变化不大和物体不转动的场景\n\n\n  ```js\n  // 使用凹凸纹理贴图创建皱纹\n  function createMesh(geom, img, bump){\n      var texture = new THREE.TextureLoader().load('./imgs/'+img);\n      var material = new THREE.MeshPhongMaterial({ map: texture });\n\n      if(bump){\n          var bump = new THREE.TextureLoader().load('./imgs/'+bump);\n          material.bumpMap = bump;\n          material.bumpScale = 0.2;   // 凹凸的高度，负数表示凹下去的深度。\n      }\n      var mesh = new THREE.Mesh(geom, material);\n      return mesh;\n  }\n  ```\n      \n\n## 法向贴图\n  * 功能：创建更加细致的凹凸和皱纹\n  * 优势：只需要使用 很少的顶点和面\n  * 实现方式\n    1. 创建一张法向图片来保存 纹理图片像素点的法向量信息\n    2. 合并两个图片的信息而形成一个细节丰富的立体纹理图片\n    3. 通过设置 normalScale 属性指定凹凸的程度\n\n\n  ```js\n  // 使用法向贴图创建更加细致的凹凸和皱褶\n  function createMesh(geom, img, normal){\n      var texture = new THREE.TextureLoader().load('./imgs/'+img);\n      var normalTexture = new THREE.TextureLoader().load('./imgs/'+normal);\n\n      var material = new THREE.MeshPhongMaterial({\n              map: texture,\n              normalMap: normalTexture,\n              bumpScale:0.2\n      });\n      var mesh = new THREE.Mesh(geom, material);\n\n      return mesh;\n  }\n  ```\n\n\n## 光照贴图\n  * 功能：创建假阴影\n  * 本质：使用 图片 模拟真实阴影，只对静态场景有效果\n  * 实现：将阴影图片赋值给材质的 lightMap 属性\n\n\n  ```js\n  // 使用光照贴图创建阴影效果\n  function createMesh(){\n      var groundGeom = new THREE.PlaneGeometry(95, 95, 1, 1);\n      var lm = new THREE.TextureLoader().load(\"./lightmap.png\");\n      var wood = new THREE.TextureLoader().load(\"./floor-wood.jpg\");\n      var groundMaterial = new THREE.MeshBasicMaterial({\n              map: wood,\n              lightMap: lm,\n              color: 0x777777\n      });\n      // 为光照贴图明确指定 UV 映射\n      groundGeom.faceVertexUvs[1] = groundGeom.faceVertexUvs[0];\n  }\n  ```\n\n\n## 光亮贴图\n  * 功能：指定材质某部分的高光效果\n  * 实现\n    * 将纹理赋给材质的属性 specularMap \n    * 设置高光颜色和强度 specular、shininess\n\n\n## 环境贴图\n  * 功能：创建虚假的反光、高光等效果\n  * 本质：使用一张 全景图片 模拟真实的环境\n  * 实现：将图片渲染成无缝的环境盒子并应用到特定对象\n  \n\n  ```js\n  // 使用环境贴图产生反光效果\n  function createMesh(geom) {\n      var planetTexture = THREE.ImageUtils.loadTexture(\"../planets/Earth.png\");\n      var specularTexture = THREE.ImageUtils.loadTexture(\"../EarthSpec.png\");\n      var normalTexture = THREE.ImageUtils.loadTexture(\"../EarthNormal.png\");\n\n      var planetMaterial = new THREE.MeshPhongMaterial();\n      planetMaterial.specularMap = specularTexture;\n      planetMaterial.specular = new THREE.Color(0xff0000);\n      planetMaterial.shininess = 2;\n\n      planetMaterial.normalMap = normalTexture;\n      // planetMaterial.map = planetTexture;\n      // planetMaterial.shininess = 150;\n\n      var mesh = THREE.SceneUtils.createMultiMaterialObject(geom, [planetMaterial]);\n\n      return mesh;\n  }\n  ```\n\n\n## 自定义 UV 贴图\n  * 画布纹理: 使用 canvas 绘制文字、特殊图形等  \n  * 视频纹理: 使用 Video 创建动态纹理\n \n\n  ```js\n  // 使用画布作为纹理\n  var canvas = document.createElement(\"canvas\"); \n  document.getElementById('canvas-output').appendChild(canvas);\n  $('#canvas-output').literallycanvas({ //创建一个可以画画的画布\n      imageURLPrefix: '../libs/literally/img'\n  }); \n\n  function createMesh(geom) {\n      //将画布直接传入材质的构造函数即可\n      var canvasMap = new THREE.Texture(canvas);\n      var mat = new THREE.MeshPhongMaterial();\n      mat.map = canvasMap;\n      var mesh = new THREE.Mesh(geom, mat);\n\n      return mesh;\n  }\n\n\n  // 使用视频作为纹理\n  var video = document.getElementById('video');\n  texture = new THREE.Texture(video);\n  texture.minFilter = THREE.LinearFilter;\n  texture.magFilter = THREE.LinearFilter;\n  texture.format = THREE.RGBFormat;\n  texture.generateMipmaps = false;\n\n  function render() {  // 更新纹理\n      stats.update();\n\n      if (video.readyState === video.HAVE_ENOUGH_DATA) {\n          if (texture) texture.needsUpdate = true;\n      }\n\n      if (controls.rotate) {\n          cube.rotation.x += -0.01;\n          cube.rotation.y += -0.01;\n          cube.rotation.z += -0.01;\n      } \n\n      requestAnimationFrame(render);\n      webGLRenderer.render(scene, camera);\n  }\n\n\n  // 使用 Sprite 创建文字\n  function createSpriteText(){\n\n      // 先用画布将文字画出\n      let canvas = document.createElement(\"canvas\");\n      let ctx = canvas.getContext(\"2d\");\n      ctx.fillStyle = \"#ffff00\";\n      ctx.font = \"Bold 100px Arial\";\n      ctx.lineWidth = 4;\n\n      // 把整个 canvas 作为纹理，字尽量大一些来撑满画布，但不要溢出\n      ctx.fillText(\"ABCDRE\",4,104);\n      let texture = new THREE.Texture(canvas);\n      texture.needsUpdate = true;\n\n      //使用 Sprite 显示文字\n      let material = new THREE.SpriteMaterial({map:texture});\n      let textObj = new THREE.Sprite(material);\n\n      // 精灵很小，要放大\n      textObj.scale.set(0.5 * 100, 0.25 * 100, 0.75 * 100);\n      textObj.position.set(0,0,98);\n      return textObj;\n  }\n\n\n  // 使用 Sprite 创建一个圆\n  function createSpriteShape(){\n\n      // 1、创建画布，不设置宽高则使用默认的，可能导致图像变形\n      let canvas = document.createElement(\"canvas\");\n      canvas.width = 120;\n      canvas.height = 120;\n\n      // 2、创建图形 \n      let ctx = canvas.getContext(\"2d\");\n      ctx.fillStyle = \"#ff0000\";\n      ctx.arc(50,50,50,0,2*Math.PI);\n      ctx.fill();\n\n      // 3、将 canvas 作为纹理，创建 Sprite\n      let texture = new THREE.Texture(canvas);\n      texture.needsUpdate = true;  // 注意这句不能少\n      let material = new THREE.SpriteMaterial({map:texture});\n      let mesh = new THREE.Sprite(material);\n\n      // 4、放大图片，精灵默认很小\n      mesh.scale.set(100, 100, 1);\n      return mesh;\n  }\n  ```\n\n\n\n\n\n\n\n","slug":"18-threejs纹理","published":1,"updated":"2019-05-10T17:22:46.831Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvid4pj0000e0nbxob5j8l7x","content":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><html><head></head><body><h1 id=\"一、纹理贴图\"><a href=\"#一、纹理贴图\" class=\"headerlink\" title=\"一、纹理贴图\"></a>一、纹理贴图</h1><blockquote><p>WebGL 提供了简单的纹理贴图功能，如果要实现凹凸、法线、环境等高级贴图功能则需要一定的算法。three.js 对常用的贴图算法进行了封装，可以用来实现各种贴图</p></blockquote><ul><li><strong>纹理</strong><ul><li>定义：3D模型的皮肤 (图片)</li><li>本质：存储在 内存/显存，由像素点组成的图像数据</li><li>用法：将纹理数据以一定规则映射到几何体(一般是三角形)</li></ul></li><li><strong>纹理贴图</strong><ul><li>定义：一个应用在物体表面用来 反射/折射 的图</li><li>本质：将存储在内存中的 位图(Bitmap) 映射到物体的表面</li><li>功能：减少了在场景中制作几何体和纹理的计算量，提高了模型渲染性能</li></ul></li></ul><h1 id=\"二、UV-贴图\"><a href=\"#二、UV-贴图\" class=\"headerlink\" title=\"二、UV 贴图\"></a>二、UV 贴图</h1><div style=\"text-indent:2em\">随着 3D 模型的面越来越多，为每个面创建贴图不现实，<code>UV 贴图则是将 2D 纹理贴图映射到 3D 模型表面最灵活的一种方式</code>。在这个过程中，三维模型曲面网格的顶点坐标系 (x, y, z) 被展平映射到二维的纹理坐标系 (u, v)，将图像上的每一个点精确对应到模型物体的表面。</div><div align=\"center\"><br><img src=\"images/threejs/texture-map.png\" alt=\"Texture Mapping\"><br></div><ul><li>UV 映射<ul><li>本质：纹理映射，将纹理坐标映射到顶点坐标</li><li>优势：减少 http 请求，减轻了服务器负担</li><li>劣势：增加了图片解析时间，可能影响性能，而且合成后不好修改</li></ul></li><li>贴图处理<ul><li>简单模型<ul><li>处理：硬纸盒(立方体) 沿折痕剪开后放到 桌面( UV 坐标系)</li><li>贴图：可以使用一张贴图映射到所有几何体的一个面或所有表面</li><li>映射方式<ul><li>球体：一个封闭的球体曲面对应一张图片，比如世界地图和地球仪</li><li>圆柱: 圆柱面和两个底面 分别对应一张图片</li><li>立方体：六个平面分别对应六张图片</li></ul></li></ul></li><li>复杂模型<ul><li>处理：分解成多个三维体，份数越多越高清则工作量和难度就越大。</li><li>贴图：将大图分割碎片化之后解析，然后使用 canvas 拼接</li><li>优势：极大减少了图片加载时间而提高了用户体验</li><li>劣势：增加服务器的负担，严重时可能导致崩溃</li></ul></li></ul></li></ul><h1 id=\"三、纹理创建\"><a href=\"#三、纹理创建\" class=\"headerlink\" title=\"三、纹理创建\"></a>三、纹理创建</h1><blockquote><p>基类：Texture</p></blockquote><ul><li>加载器<ul><li>新版：TextureLoader.load(url)</li><li>旧版：ImageUtils.loadTexture(url)</li></ul></li><li>属性设置<ul><li>重复：texture.wrapS/wrapT</li><li>缩放：texture.magFilter/minFilter</li><li>重复次数：texture.repeat.set(20, 20)</li></ul></li><li>扩展方法<ul><li>直接创建：DataTexture<ul><li>深度纹理：DepthTexture</li><li>视频纹理：VideoTexture</li><li>三维纹理：DataTexture3D</li><li>立方体纹理：CubeTexture</li></ul></li><li>基于canvas：CanvasTexture</li><li>基于压缩数据：CompressedTexture</li></ul></li></ul><h1 id=\"四、纹理类型\"><a href=\"#四、纹理类型\" class=\"headerlink\" title=\"四、纹理类型\"></a>四、纹理类型</h1><h2 id=\"图片纹理\"><a href=\"#图片纹理\" class=\"headerlink\" title=\"图片纹理\"></a>图片纹理</h2><ul><li>功能：直接在物体表面应用图片</li><li>实现方式<ol><li>创建一个几何体对象 (用于纹理映射)</li><li>创建一个纹理对象 (加载一张图片作为纹理贴图)</li><li>将纹理对象赋值给材质对象的 map 属性</li><li>将 几何体 和 纹理材质 整合到一个物体上</li></ol></li><li>图片不显示<ul><li>图片异步加载问题<ul><li>使用渲染循环</li><li>在纹理回调中重绘</li></ul></li><li>Chrome 同源限制<ul><li>降低浏览器的安全级别</li><li>将外部文件放到本机服务器作为网络文件访问</li></ul></li></ul></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用图片纹理</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createMesh</span>(<span class=\"params\">shape, imgUrl</span>)</span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> geometry, material</span><br><span class=\"line\">    <span class=\"keyword\">switch</span>(shape){</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 矩形平面</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">\"plane\"</span>: </span><br><span class=\"line\">            geometry = <span class=\"keyword\">new</span> THREE.PlaneGeometry(<span class=\"number\">300</span>, <span class=\"number\">200</span>);</span><br><span class=\"line\">            <span class=\"comment\">// 设置纹理坐标，必须逆时针方向</span></span><br><span class=\"line\">            geometry.vertices[<span class=\"number\">0</span>].uv = <span class=\"keyword\">new</span> THREE.Vector2(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">            geometry.vertices[<span class=\"number\">1</span>].uv = <span class=\"keyword\">new</span> THREE.Vector2(<span class=\"number\">0.5</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">            geometry.vertices[<span class=\"number\">2</span>].uv = <span class=\"keyword\">new</span> THREE.Vector2(<span class=\"number\">0.5</span>, <span class=\"number\">0.5</span>);</span><br><span class=\"line\">            geometry.vertices[<span class=\"number\">3</span>].uv = <span class=\"keyword\">new</span> THREE.Vector2(<span class=\"number\">0</span>, <span class=\"number\">0.5</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">var</span> texture = <span class=\"keyword\">new</span> THREE.TextureLoader().load( imgUrl );</span><br><span class=\"line\">            material = <span class=\"keyword\">new</span> THREE.MeshBasicMaterial({ <span class=\"attr\">map</span>: texture });</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 立方体</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">\"box\"</span>: </span><br><span class=\"line\">            geometry = <span class=\"keyword\">new</span> THREE.BoxGeometry(<span class=\"number\">300</span>, <span class=\"number\">200</span>, <span class=\"number\">150</span>); </span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(imgUrl){</span><br><span class=\"line\">                <span class=\"comment\">// 六个面相同贴图</span></span><br><span class=\"line\">                <span class=\"keyword\">var</span> texture = <span class=\"keyword\">new</span> THREE.TextureLoader().load( imgUrl );</span><br><span class=\"line\">                material = <span class=\"keyword\">new</span> THREE.MeshBasicMaterial({ <span class=\"attr\">map</span>: texture });</span><br><span class=\"line\">            }<span class=\"keyword\">else</span>{</span><br><span class=\"line\">                <span class=\"comment\">// 六个面不同贴图</span></span><br><span class=\"line\">                material = []</span><br><span class=\"line\">                <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">1</span>; i &gt; <span class=\"number\">7</span>; i++){  </span><br><span class=\"line\">                    <span class=\"keyword\">var</span> texture = <span class=\"keyword\">new</span> THREE.TextureLoader().load(<span class=\"string\">'./imgs/'</span> + i + <span class=\"string\">'.jpg'</span>);</span><br><span class=\"line\">                    material.push( <span class=\"keyword\">new</span> THREE.MeshBasicMaterial({ <span class=\"attr\">map</span>: texture }) );</span><br><span class=\"line\">                } </span><br><span class=\"line\">            }</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">default</span>:</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">var</span> mesh = <span class=\"keyword\">new</span> THREE.Mesh(geometry, material);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mesh;</span><br><span class=\"line\">} </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 一幅图片多个精灵, 即把一幅外部图片中包含的所有精灵存入一个精灵材质数组</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> spriteMaterials = [];</span><br><span class=\"line\"><span class=\"keyword\">var</span> loader = <span class=\"keyword\">new</span> THREE.TextureLoader()</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &gt; <span class=\"number\">5</span>; i++) {</span><br><span class=\"line\">    <span class=\"keyword\">var</span> spriteMaterial = material.clone();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 每种精灵必须单独加载同一幅外部图片</span></span><br><span class=\"line\">    spriteMaterial.map = loader.load(<span class=\"string\">'./assets/textures/sprite-sheet.png'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 水平方向(从左)和垂直方向(从上), 偏移比例, 取值 0~1</span></span><br><span class=\"line\">    spriteMaterial.map.offset = <span class=\"keyword\">new</span> THREE.Vector2(<span class=\"number\">0.2</span> * (i % <span class=\"number\">5</span>), <span class=\"number\">0</span>); </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 从 offset 处开始向右下截取的比例, 取值 0~1</span></span><br><span class=\"line\">    spriteMaterial.map.repeat = <span class=\"keyword\">new</span> THREE.Vector2(<span class=\"number\">1</span> / <span class=\"number\">5</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    spriteMaterials.push(spriteMaterial);</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"凹凸贴图\"><a href=\"#凹凸贴图\" class=\"headerlink\" title=\"凹凸贴图\"></a>凹凸贴图</h2><ul><li>功能：创建凹凸和皱纹</li><li>实现方式<ol><li>使用一张灰度图创建纹理</li><li>将纹理赋给材质的 bumpMap 属性</li><li>调整 bumpScale (深度) 获得凹凸效果</li></ol></li><li>适用场景<ul><li>它只保存了像素和高度而没有坡度的方向性信息，只是在某个方向看着很立体，而且所能达到的厚度和细节程度有限，适用于光线变化不大和物体不转动的场景</li></ul></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用凹凸纹理贴图创建皱纹</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createMesh</span>(<span class=\"params\">geom, img, bump</span>)</span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> texture = <span class=\"keyword\">new</span> THREE.TextureLoader().load(<span class=\"string\">'./imgs/'</span>+img);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> material = <span class=\"keyword\">new</span> THREE.MeshPhongMaterial({ <span class=\"attr\">map</span>: texture });</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(bump){</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bump = <span class=\"keyword\">new</span> THREE.TextureLoader().load(<span class=\"string\">'./imgs/'</span>+bump);</span><br><span class=\"line\">        material.bumpMap = bump;</span><br><span class=\"line\">        material.bumpScale = <span class=\"number\">0.2</span>;   <span class=\"comment\">// 凹凸的高度，负数表示凹下去的深度。</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">var</span> mesh = <span class=\"keyword\">new</span> THREE.Mesh(geom, material);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mesh;</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"法向贴图\"><a href=\"#法向贴图\" class=\"headerlink\" title=\"法向贴图\"></a>法向贴图</h2><ul><li>功能：创建更加细致的凹凸和皱纹</li><li>优势：只需要使用 很少的顶点和面</li><li>实现方式<ol><li>创建一张法向图片来保存 纹理图片像素点的法向量信息</li><li>合并两个图片的信息而形成一个细节丰富的立体纹理图片</li><li>通过设置 normalScale 属性指定凹凸的程度</li></ol></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用法向贴图创建更加细致的凹凸和皱褶</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createMesh</span>(<span class=\"params\">geom, img, normal</span>)</span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> texture = <span class=\"keyword\">new</span> THREE.TextureLoader().load(<span class=\"string\">'./imgs/'</span>+img);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> normalTexture = <span class=\"keyword\">new</span> THREE.TextureLoader().load(<span class=\"string\">'./imgs/'</span>+normal);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> material = <span class=\"keyword\">new</span> THREE.MeshPhongMaterial({</span><br><span class=\"line\">            map: texture,</span><br><span class=\"line\">            normalMap: normalTexture,</span><br><span class=\"line\">            bumpScale:<span class=\"number\">0.2</span></span><br><span class=\"line\">    });</span><br><span class=\"line\">    <span class=\"keyword\">var</span> mesh = <span class=\"keyword\">new</span> THREE.Mesh(geom, material);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> mesh;</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"光照贴图\"><a href=\"#光照贴图\" class=\"headerlink\" title=\"光照贴图\"></a>光照贴图</h2><ul><li>功能：创建假阴影</li><li>本质：使用 图片 模拟真实阴影，只对静态场景有效果</li><li>实现：将阴影图片赋值给材质的 lightMap 属性</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用光照贴图创建阴影效果</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createMesh</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> groundGeom = <span class=\"keyword\">new</span> THREE.PlaneGeometry(<span class=\"number\">95</span>, <span class=\"number\">95</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> lm = <span class=\"keyword\">new</span> THREE.TextureLoader().load(<span class=\"string\">\"./lightmap.png\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> wood = <span class=\"keyword\">new</span> THREE.TextureLoader().load(<span class=\"string\">\"./floor-wood.jpg\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> groundMaterial = <span class=\"keyword\">new</span> THREE.MeshBasicMaterial({</span><br><span class=\"line\">            map: wood,</span><br><span class=\"line\">            lightMap: lm,</span><br><span class=\"line\">            color: <span class=\"number\">0x777777</span></span><br><span class=\"line\">    });</span><br><span class=\"line\">    <span class=\"comment\">// 为光照贴图明确指定 UV 映射</span></span><br><span class=\"line\">    groundGeom.faceVertexUvs[<span class=\"number\">1</span>] = groundGeom.faceVertexUvs[<span class=\"number\">0</span>];</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"光亮贴图\"><a href=\"#光亮贴图\" class=\"headerlink\" title=\"光亮贴图\"></a>光亮贴图</h2><ul><li>功能：指定材质某部分的高光效果</li><li>实现<ul><li>将纹理赋给材质的属性 specularMap</li><li>设置高光颜色和强度 specular、shininess</li></ul></li></ul><h2 id=\"环境贴图\"><a href=\"#环境贴图\" class=\"headerlink\" title=\"环境贴图\"></a>环境贴图</h2><ul><li>功能：创建虚假的反光、高光等效果</li><li>本质：使用一张 全景图片 模拟真实的环境</li><li>实现：将图片渲染成无缝的环境盒子并应用到特定对象</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用环境贴图产生反光效果</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createMesh</span>(<span class=\"params\">geom</span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> planetTexture = THREE.ImageUtils.loadTexture(<span class=\"string\">\"../planets/Earth.png\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> specularTexture = THREE.ImageUtils.loadTexture(<span class=\"string\">\"../EarthSpec.png\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> normalTexture = THREE.ImageUtils.loadTexture(<span class=\"string\">\"../EarthNormal.png\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> planetMaterial = <span class=\"keyword\">new</span> THREE.MeshPhongMaterial();</span><br><span class=\"line\">    planetMaterial.specularMap = specularTexture;</span><br><span class=\"line\">    planetMaterial.specular = <span class=\"keyword\">new</span> THREE.Color(<span class=\"number\">0xff0000</span>);</span><br><span class=\"line\">    planetMaterial.shininess = <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    planetMaterial.normalMap = normalTexture;</span><br><span class=\"line\">    <span class=\"comment\">// planetMaterial.map = planetTexture;</span></span><br><span class=\"line\">    <span class=\"comment\">// planetMaterial.shininess = 150;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> mesh = THREE.SceneUtils.createMultiMaterialObject(geom, [planetMaterial]);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> mesh;</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"自定义-UV-贴图\"><a href=\"#自定义-UV-贴图\" class=\"headerlink\" title=\"自定义 UV 贴图\"></a>自定义 UV 贴图</h2><ul><li>画布纹理: 使用 canvas 绘制文字、特殊图形等</li><li>视频纹理: 使用 Video 创建动态纹理</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用画布作为纹理</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"canvas\"</span>); </span><br><span class=\"line\"><span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'canvas-output'</span>).appendChild(canvas);</span><br><span class=\"line\">$(<span class=\"string\">'#canvas-output'</span>).literallycanvas({ <span class=\"comment\">//创建一个可以画画的画布</span></span><br><span class=\"line\">    imageURLPrefix: <span class=\"string\">'../libs/literally/img'</span></span><br><span class=\"line\">}); </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createMesh</span>(<span class=\"params\">geom</span>) </span>{</span><br><span class=\"line\">    <span class=\"comment\">//将画布直接传入材质的构造函数即可</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> canvasMap = <span class=\"keyword\">new</span> THREE.Texture(canvas);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> mat = <span class=\"keyword\">new</span> THREE.MeshPhongMaterial();</span><br><span class=\"line\">    mat.map = canvasMap;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> mesh = <span class=\"keyword\">new</span> THREE.Mesh(geom, mat);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> mesh;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用视频作为纹理</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> video = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'video'</span>);</span><br><span class=\"line\">texture = <span class=\"keyword\">new</span> THREE.Texture(video);</span><br><span class=\"line\">texture.minFilter = THREE.LinearFilter;</span><br><span class=\"line\">texture.magFilter = THREE.LinearFilter;</span><br><span class=\"line\">texture.format = THREE.RGBFormat;</span><br><span class=\"line\">texture.generateMipmaps = <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">render</span>(<span class=\"params\"></span>) </span>{  <span class=\"comment\">// 更新纹理</span></span><br><span class=\"line\">    stats.update();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (video.readyState === video.HAVE_ENOUGH_DATA) {</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (texture) texture.needsUpdate = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (controls.rotate) {</span><br><span class=\"line\">        cube.rotation.x += <span class=\"number\">-0.01</span>;</span><br><span class=\"line\">        cube.rotation.y += <span class=\"number\">-0.01</span>;</span><br><span class=\"line\">        cube.rotation.z += <span class=\"number\">-0.01</span>;</span><br><span class=\"line\">    } </span><br><span class=\"line\"></span><br><span class=\"line\">    requestAnimationFrame(render);</span><br><span class=\"line\">    webGLRenderer.render(scene, camera);</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用 Sprite 创建文字</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createSpriteText</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 先用画布将文字画出</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"canvas\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> ctx = canvas.getContext(<span class=\"string\">\"2d\"</span>);</span><br><span class=\"line\">    ctx.fillStyle = <span class=\"string\">\"#ffff00\"</span>;</span><br><span class=\"line\">    ctx.font = <span class=\"string\">\"Bold 100px Arial\"</span>;</span><br><span class=\"line\">    ctx.lineWidth = <span class=\"number\">4</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 把整个 canvas 作为纹理，字尽量大一些来撑满画布，但不要溢出</span></span><br><span class=\"line\">    ctx.fillText(<span class=\"string\">\"ABCDRE\"</span>,<span class=\"number\">4</span>,<span class=\"number\">104</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> texture = <span class=\"keyword\">new</span> THREE.Texture(canvas);</span><br><span class=\"line\">    texture.needsUpdate = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//使用 Sprite 显示文字</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> material = <span class=\"keyword\">new</span> THREE.SpriteMaterial({<span class=\"attr\">map</span>:texture});</span><br><span class=\"line\">    <span class=\"keyword\">let</span> textObj = <span class=\"keyword\">new</span> THREE.Sprite(material);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 精灵很小，要放大</span></span><br><span class=\"line\">    textObj.scale.set(<span class=\"number\">0.5</span> * <span class=\"number\">100</span>, <span class=\"number\">0.25</span> * <span class=\"number\">100</span>, <span class=\"number\">0.75</span> * <span class=\"number\">100</span>);</span><br><span class=\"line\">    textObj.position.set(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">98</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> textObj;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用 Sprite 创建一个圆</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createSpriteShape</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 1、创建画布，不设置宽高则使用默认的，可能导致图像变形</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"canvas\"</span>);</span><br><span class=\"line\">    canvas.width = <span class=\"number\">120</span>;</span><br><span class=\"line\">    canvas.height = <span class=\"number\">120</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 2、创建图形 </span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> ctx = canvas.getContext(<span class=\"string\">\"2d\"</span>);</span><br><span class=\"line\">    ctx.fillStyle = <span class=\"string\">\"#ff0000\"</span>;</span><br><span class=\"line\">    ctx.arc(<span class=\"number\">50</span>,<span class=\"number\">50</span>,<span class=\"number\">50</span>,<span class=\"number\">0</span>,<span class=\"number\">2</span>*<span class=\"built_in\">Math</span>.PI);</span><br><span class=\"line\">    ctx.fill();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 3、将 canvas 作为纹理，创建 Sprite</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> texture = <span class=\"keyword\">new</span> THREE.Texture(canvas);</span><br><span class=\"line\">    texture.needsUpdate = <span class=\"literal\">true</span>;  <span class=\"comment\">// 注意这句不能少</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> material = <span class=\"keyword\">new</span> THREE.SpriteMaterial({<span class=\"attr\">map</span>:texture});</span><br><span class=\"line\">    <span class=\"keyword\">let</span> mesh = <span class=\"keyword\">new</span> THREE.Sprite(material);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 4、放大图片，精灵默认很小</span></span><br><span class=\"line\">    mesh.scale.set(<span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mesh;</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><!-- rebuild by neat --></body></html>","site":{"data":{"next":{"override":false,"cache":{"enable":true},"favicon":{"small":"/images/favicon-16.ico","medium":"/images/favicon-32.ico","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"rss":"/atom.xml","footer":{"since":2019,"icon":{"name":"snowflake-o","animated":false,"color":"#808080"},"copyright":"chuangge","powered":{"enable":false,"version":true},"theme":{"enable":false,"version":true},"beian":{"enable":false,"icp":null}},"creative_commons":{"license":"by-nc-sa","sidebar":false,"post":false},"canonical":true,"seo":false,"index_with_subtitle":false,"exturl":false,"menu":{"home":"/ || home  //首页","tags":"/tags/ || tags  //标签","categories":"/categories/ || th   //分类","archives":"/archives/ || archive //归档"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":{"GitHub":"https://github.com/ || github","StackOverflow":"https://stackoverflow.com/ || stack-overflow"},"social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"友情链接","links_layout":"inline","links":{"个人简历":"https://chuanggefighting.github.io/project/","印记中文":"https://www.docschina.org/","在线工具":"http://tool.lu/","Learn Anything":"https://learn-anything.xyz/"},"avatar":{"url":"/images/chuang.png","rounded":true,"opacity":1,"rotated":true},"toc":{"enable":true,"number":true,"wrap":false,"max_depth":6},"sidebar":{"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"read_more_btn":true,"post_meta":{"item_text":true,"created_at":true,"updated_at":{"enabled":true,"another_day":true},"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":true,"awl":4,"wpm":275},"codeblock":{"border_radius":null,"copy_button":{"enable":false,"show_result":false}},"reward":{"enable":false},"related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_edit":{"enable":false,"url":"https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name"},"disable_baidu_tranformation":false,"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"font":{"enable":true,"host":"//fonts.proxy.ustclug.org","global":{"external":true,"family":"Lato","size":16},"headings":{"external":true,"family":"Roboto Slab","size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":"Lobster Two","size":24},"codes":{"external":true,"family":"Roboto Mono","size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css","copy_tex":{"enable":false,"copy_tex_js":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js","copy_tex_css":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css"}}},"pdf":{"enable":false,"per_page":true,"height":"500px","pdfobject":{"cdn":"//cdn.jsdelivr.net/npm/pdfobject@2.1.1/pdfobject.min.js"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":true,"appid":"snOvapuSplYTVflf5p9Ml9JX-gzGzoHsz","appkey":"5ABGdfyEdAtu6lTXdGdo7hf9","notify":false,"verify":false,"placeholder":"ヾﾉ≧∀≦)o 来呀！吐槽一番吧！","avatar":"mm","guest_info":"nick,mail,link","pageSize":10,"visitor":false,"comment_count":true},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"gitalk":{"enable":false,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true},"needmoreshare2":{"enable":true,"postbottom":{"enable":true,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null,"security":false,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":true,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":true,"pace_theme":"pace-theme-center-simple","canvas_nest":{"enable":true,"onmobile":true,"color":"0,0,255","opacity":0.5,"zIndex":-1,"count":99},"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"canvas_nest_nomobile":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"leancloud":null,"valine":null,"gitalk_js":null,"gitalk_css":null,"md5":null},"css":"css","js":"js","images":"images","passage_end_tag":{"enabled":true},"daovoice":true,"daovoice_app_id":"2ed51855"}}},"excerpt":"","more":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><h1 id=\"一、纹理贴图\"><a href=\"#一、纹理贴图\" class=\"headerlink\" title=\"一、纹理贴图\"></a>一、纹理贴图</h1><blockquote><p>WebGL 提供了简单的纹理贴图功能，如果要实现凹凸、法线、环境等高级贴图功能则需要一定的算法。three.js 对常用的贴图算法进行了封装，可以用来实现各种贴图</p></blockquote><ul><li><strong>纹理</strong><ul><li>定义：3D模型的皮肤 (图片)</li><li>本质：存储在 内存/显存，由像素点组成的图像数据</li><li>用法：将纹理数据以一定规则映射到几何体(一般是三角形)</li></ul></li><li><strong>纹理贴图</strong><ul><li>定义：一个应用在物体表面用来 反射/折射 的图</li><li>本质：将存储在内存中的 位图(Bitmap) 映射到物体的表面</li><li>功能：减少了在场景中制作几何体和纹理的计算量，提高了模型渲染性能</li></ul></li></ul><h1 id=\"二、UV-贴图\"><a href=\"#二、UV-贴图\" class=\"headerlink\" title=\"二、UV 贴图\"></a>二、UV 贴图</h1><div style=\"text-indent:2em\">随着 3D 模型的面越来越多，为每个面创建贴图不现实，<code>UV 贴图则是将 2D 纹理贴图映射到 3D 模型表面最灵活的一种方式</code>。在这个过程中，三维模型曲面网格的顶点坐标系 (x, y, z) 被展平映射到二维的纹理坐标系 (u, v)，将图像上的每一个点精确对应到模型物体的表面。</div><div align=\"center\"><br><img src=\"images/threejs/texture-map.png\" alt=\"Texture Mapping\"><br></div><ul><li>UV 映射<ul><li>本质：纹理映射，将纹理坐标映射到顶点坐标</li><li>优势：减少 http 请求，减轻了服务器负担</li><li>劣势：增加了图片解析时间，可能影响性能，而且合成后不好修改</li></ul></li><li>贴图处理<ul><li>简单模型<ul><li>处理：硬纸盒(立方体) 沿折痕剪开后放到 桌面( UV 坐标系)</li><li>贴图：可以使用一张贴图映射到所有几何体的一个面或所有表面</li><li>映射方式<ul><li>球体：一个封闭的球体曲面对应一张图片，比如世界地图和地球仪</li><li>圆柱: 圆柱面和两个底面 分别对应一张图片</li><li>立方体：六个平面分别对应六张图片</li></ul></li></ul></li><li>复杂模型<ul><li>处理：分解成多个三维体，份数越多越高清则工作量和难度就越大。</li><li>贴图：将大图分割碎片化之后解析，然后使用 canvas 拼接</li><li>优势：极大减少了图片加载时间而提高了用户体验</li><li>劣势：增加服务器的负担，严重时可能导致崩溃</li></ul></li></ul></li></ul><h1 id=\"三、纹理创建\"><a href=\"#三、纹理创建\" class=\"headerlink\" title=\"三、纹理创建\"></a>三、纹理创建</h1><blockquote><p>基类：Texture</p></blockquote><ul><li>加载器<ul><li>新版：TextureLoader.load(url)</li><li>旧版：ImageUtils.loadTexture(url)</li></ul></li><li>属性设置<ul><li>重复：texture.wrapS/wrapT</li><li>缩放：texture.magFilter/minFilter</li><li>重复次数：texture.repeat.set(20, 20)</li></ul></li><li>扩展方法<ul><li>直接创建：DataTexture<ul><li>深度纹理：DepthTexture</li><li>视频纹理：VideoTexture</li><li>三维纹理：DataTexture3D</li><li>立方体纹理：CubeTexture</li></ul></li><li>基于canvas：CanvasTexture</li><li>基于压缩数据：CompressedTexture</li></ul></li></ul><h1 id=\"四、纹理类型\"><a href=\"#四、纹理类型\" class=\"headerlink\" title=\"四、纹理类型\"></a>四、纹理类型</h1><h2 id=\"图片纹理\"><a href=\"#图片纹理\" class=\"headerlink\" title=\"图片纹理\"></a>图片纹理</h2><ul><li>功能：直接在物体表面应用图片</li><li>实现方式<ol><li>创建一个几何体对象 (用于纹理映射)</li><li>创建一个纹理对象 (加载一张图片作为纹理贴图)</li><li>将纹理对象赋值给材质对象的 map 属性</li><li>将 几何体 和 纹理材质 整合到一个物体上</li></ol></li><li>图片不显示<ul><li>图片异步加载问题<ul><li>使用渲染循环</li><li>在纹理回调中重绘</li></ul></li><li>Chrome 同源限制<ul><li>降低浏览器的安全级别</li><li>将外部文件放到本机服务器作为网络文件访问</li></ul></li></ul></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用图片纹理</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createMesh</span>(<span class=\"params\">shape, imgUrl</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> geometry, material</span><br><span class=\"line\">    <span class=\"keyword\">switch</span>(shape)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 矩形平面</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">\"plane\"</span>: </span><br><span class=\"line\">            geometry = <span class=\"keyword\">new</span> THREE.PlaneGeometry(<span class=\"number\">300</span>, <span class=\"number\">200</span>);</span><br><span class=\"line\">            <span class=\"comment\">// 设置纹理坐标，必须逆时针方向</span></span><br><span class=\"line\">            geometry.vertices[<span class=\"number\">0</span>].uv = <span class=\"keyword\">new</span> THREE.Vector2(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">            geometry.vertices[<span class=\"number\">1</span>].uv = <span class=\"keyword\">new</span> THREE.Vector2(<span class=\"number\">0.5</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">            geometry.vertices[<span class=\"number\">2</span>].uv = <span class=\"keyword\">new</span> THREE.Vector2(<span class=\"number\">0.5</span>, <span class=\"number\">0.5</span>);</span><br><span class=\"line\">            geometry.vertices[<span class=\"number\">3</span>].uv = <span class=\"keyword\">new</span> THREE.Vector2(<span class=\"number\">0</span>, <span class=\"number\">0.5</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">var</span> texture = <span class=\"keyword\">new</span> THREE.TextureLoader().load( imgUrl );</span><br><span class=\"line\">            material = <span class=\"keyword\">new</span> THREE.MeshBasicMaterial(&#123; <span class=\"attr\">map</span>: texture &#125;);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 立方体</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">\"box\"</span>: </span><br><span class=\"line\">            geometry = <span class=\"keyword\">new</span> THREE.BoxGeometry(<span class=\"number\">300</span>, <span class=\"number\">200</span>, <span class=\"number\">150</span>); </span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(imgUrl)&#123;</span><br><span class=\"line\">                <span class=\"comment\">// 六个面相同贴图</span></span><br><span class=\"line\">                <span class=\"keyword\">var</span> texture = <span class=\"keyword\">new</span> THREE.TextureLoader().load( imgUrl );</span><br><span class=\"line\">                material = <span class=\"keyword\">new</span> THREE.MeshBasicMaterial(&#123; <span class=\"attr\">map</span>: texture &#125;);</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                <span class=\"comment\">// 六个面不同贴图</span></span><br><span class=\"line\">                material = []</span><br><span class=\"line\">                <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">1</span>; i &amp;gt; <span class=\"number\">7</span>; i++)&#123;  </span><br><span class=\"line\">                    <span class=\"keyword\">var</span> texture = <span class=\"keyword\">new</span> THREE.TextureLoader().load(<span class=\"string\">'./imgs/'</span> + i + <span class=\"string\">'.jpg'</span>);</span><br><span class=\"line\">                    material.push( <span class=\"keyword\">new</span> THREE.MeshBasicMaterial(&#123; <span class=\"attr\">map</span>: texture &#125;) );</span><br><span class=\"line\">                &#125; </span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">default</span>:</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> mesh = <span class=\"keyword\">new</span> THREE.Mesh(geometry, material);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mesh;</span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 一幅图片多个精灵, 即把一幅外部图片中包含的所有精灵存入一个精灵材质数组</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> spriteMaterials = [];</span><br><span class=\"line\"><span class=\"keyword\">var</span> loader = <span class=\"keyword\">new</span> THREE.TextureLoader()</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &amp;gt; <span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> spriteMaterial = material.clone();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 每种精灵必须单独加载同一幅外部图片</span></span><br><span class=\"line\">    spriteMaterial.map = loader.load(<span class=\"string\">'./assets/textures/sprite-sheet.png'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 水平方向(从左)和垂直方向(从上), 偏移比例, 取值 0~1</span></span><br><span class=\"line\">    spriteMaterial.map.offset = <span class=\"keyword\">new</span> THREE.Vector2(<span class=\"number\">0.2</span> * (i % <span class=\"number\">5</span>), <span class=\"number\">0</span>); </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 从 offset 处开始向右下截取的比例, 取值 0~1</span></span><br><span class=\"line\">    spriteMaterial.map.repeat = <span class=\"keyword\">new</span> THREE.Vector2(<span class=\"number\">1</span> / <span class=\"number\">5</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    spriteMaterials.push(spriteMaterial);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"凹凸贴图\"><a href=\"#凹凸贴图\" class=\"headerlink\" title=\"凹凸贴图\"></a>凹凸贴图</h2><ul><li>功能：创建凹凸和皱纹</li><li>实现方式<ol><li>使用一张灰度图创建纹理</li><li>将纹理赋给材质的 bumpMap 属性</li><li>调整 bumpScale (深度) 获得凹凸效果</li></ol></li><li>适用场景<ul><li>它只保存了像素和高度而没有坡度的方向性信息，只是在某个方向看着很立体，而且所能达到的厚度和细节程度有限，适用于光线变化不大和物体不转动的场景</li></ul></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用凹凸纹理贴图创建皱纹</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createMesh</span>(<span class=\"params\">geom, img, bump</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> texture = <span class=\"keyword\">new</span> THREE.TextureLoader().load(<span class=\"string\">'./imgs/'</span>+img);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> material = <span class=\"keyword\">new</span> THREE.MeshPhongMaterial(&#123; <span class=\"attr\">map</span>: texture &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(bump)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bump = <span class=\"keyword\">new</span> THREE.TextureLoader().load(<span class=\"string\">'./imgs/'</span>+bump);</span><br><span class=\"line\">        material.bumpMap = bump;</span><br><span class=\"line\">        material.bumpScale = <span class=\"number\">0.2</span>;   <span class=\"comment\">// 凹凸的高度，负数表示凹下去的深度。</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> mesh = <span class=\"keyword\">new</span> THREE.Mesh(geom, material);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mesh;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"法向贴图\"><a href=\"#法向贴图\" class=\"headerlink\" title=\"法向贴图\"></a>法向贴图</h2><ul><li>功能：创建更加细致的凹凸和皱纹</li><li>优势：只需要使用 很少的顶点和面</li><li>实现方式<ol><li>创建一张法向图片来保存 纹理图片像素点的法向量信息</li><li>合并两个图片的信息而形成一个细节丰富的立体纹理图片</li><li>通过设置 normalScale 属性指定凹凸的程度</li></ol></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用法向贴图创建更加细致的凹凸和皱褶</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createMesh</span>(<span class=\"params\">geom, img, normal</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> texture = <span class=\"keyword\">new</span> THREE.TextureLoader().load(<span class=\"string\">'./imgs/'</span>+img);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> normalTexture = <span class=\"keyword\">new</span> THREE.TextureLoader().load(<span class=\"string\">'./imgs/'</span>+normal);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> material = <span class=\"keyword\">new</span> THREE.MeshPhongMaterial(&#123;</span><br><span class=\"line\">            map: texture,</span><br><span class=\"line\">            normalMap: normalTexture,</span><br><span class=\"line\">            bumpScale:<span class=\"number\">0.2</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> mesh = <span class=\"keyword\">new</span> THREE.Mesh(geom, material);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> mesh;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"光照贴图\"><a href=\"#光照贴图\" class=\"headerlink\" title=\"光照贴图\"></a>光照贴图</h2><ul><li>功能：创建假阴影</li><li>本质：使用 图片 模拟真实阴影，只对静态场景有效果</li><li>实现：将阴影图片赋值给材质的 lightMap 属性</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用光照贴图创建阴影效果</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createMesh</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> groundGeom = <span class=\"keyword\">new</span> THREE.PlaneGeometry(<span class=\"number\">95</span>, <span class=\"number\">95</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> lm = <span class=\"keyword\">new</span> THREE.TextureLoader().load(<span class=\"string\">\"./lightmap.png\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> wood = <span class=\"keyword\">new</span> THREE.TextureLoader().load(<span class=\"string\">\"./floor-wood.jpg\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> groundMaterial = <span class=\"keyword\">new</span> THREE.MeshBasicMaterial(&#123;</span><br><span class=\"line\">            map: wood,</span><br><span class=\"line\">            lightMap: lm,</span><br><span class=\"line\">            color: <span class=\"number\">0x777777</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"comment\">// 为光照贴图明确指定 UV 映射</span></span><br><span class=\"line\">    groundGeom.faceVertexUvs[<span class=\"number\">1</span>] = groundGeom.faceVertexUvs[<span class=\"number\">0</span>];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"光亮贴图\"><a href=\"#光亮贴图\" class=\"headerlink\" title=\"光亮贴图\"></a>光亮贴图</h2><ul><li>功能：指定材质某部分的高光效果</li><li>实现<ul><li>将纹理赋给材质的属性 specularMap</li><li>设置高光颜色和强度 specular、shininess</li></ul></li></ul><h2 id=\"环境贴图\"><a href=\"#环境贴图\" class=\"headerlink\" title=\"环境贴图\"></a>环境贴图</h2><ul><li>功能：创建虚假的反光、高光等效果</li><li>本质：使用一张 全景图片 模拟真实的环境</li><li>实现：将图片渲染成无缝的环境盒子并应用到特定对象</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用环境贴图产生反光效果</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createMesh</span>(<span class=\"params\">geom</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> planetTexture = THREE.ImageUtils.loadTexture(<span class=\"string\">\"../planets/Earth.png\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> specularTexture = THREE.ImageUtils.loadTexture(<span class=\"string\">\"../EarthSpec.png\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> normalTexture = THREE.ImageUtils.loadTexture(<span class=\"string\">\"../EarthNormal.png\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> planetMaterial = <span class=\"keyword\">new</span> THREE.MeshPhongMaterial();</span><br><span class=\"line\">    planetMaterial.specularMap = specularTexture;</span><br><span class=\"line\">    planetMaterial.specular = <span class=\"keyword\">new</span> THREE.Color(<span class=\"number\">0xff0000</span>);</span><br><span class=\"line\">    planetMaterial.shininess = <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    planetMaterial.normalMap = normalTexture;</span><br><span class=\"line\">    <span class=\"comment\">// planetMaterial.map = planetTexture;</span></span><br><span class=\"line\">    <span class=\"comment\">// planetMaterial.shininess = 150;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> mesh = THREE.SceneUtils.createMultiMaterialObject(geom, [planetMaterial]);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> mesh;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"自定义-UV-贴图\"><a href=\"#自定义-UV-贴图\" class=\"headerlink\" title=\"自定义 UV 贴图\"></a>自定义 UV 贴图</h2><ul><li>画布纹理: 使用 canvas 绘制文字、特殊图形等</li><li>视频纹理: 使用 Video 创建动态纹理</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用画布作为纹理</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"canvas\"</span>); </span><br><span class=\"line\"><span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'canvas-output'</span>).appendChild(canvas);</span><br><span class=\"line\">$(<span class=\"string\">'#canvas-output'</span>).literallycanvas(&#123; <span class=\"comment\">//创建一个可以画画的画布</span></span><br><span class=\"line\">    imageURLPrefix: <span class=\"string\">'../libs/literally/img'</span></span><br><span class=\"line\">&#125;); </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createMesh</span>(<span class=\"params\">geom</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//将画布直接传入材质的构造函数即可</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> canvasMap = <span class=\"keyword\">new</span> THREE.Texture(canvas);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> mat = <span class=\"keyword\">new</span> THREE.MeshPhongMaterial();</span><br><span class=\"line\">    mat.map = canvasMap;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> mesh = <span class=\"keyword\">new</span> THREE.Mesh(geom, mat);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> mesh;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用视频作为纹理</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> video = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'video'</span>);</span><br><span class=\"line\">texture = <span class=\"keyword\">new</span> THREE.Texture(video);</span><br><span class=\"line\">texture.minFilter = THREE.LinearFilter;</span><br><span class=\"line\">texture.magFilter = THREE.LinearFilter;</span><br><span class=\"line\">texture.format = THREE.RGBFormat;</span><br><span class=\"line\">texture.generateMipmaps = <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">render</span>(<span class=\"params\"></span>) </span>&#123;  <span class=\"comment\">// 更新纹理</span></span><br><span class=\"line\">    stats.update();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (video.readyState === video.HAVE_ENOUGH_DATA) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (texture) texture.needsUpdate = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (controls.rotate) &#123;</span><br><span class=\"line\">        cube.rotation.x += <span class=\"number\">-0.01</span>;</span><br><span class=\"line\">        cube.rotation.y += <span class=\"number\">-0.01</span>;</span><br><span class=\"line\">        cube.rotation.z += <span class=\"number\">-0.01</span>;</span><br><span class=\"line\">    &#125; </span><br><span class=\"line\"></span><br><span class=\"line\">    requestAnimationFrame(render);</span><br><span class=\"line\">    webGLRenderer.render(scene, camera);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用 Sprite 创建文字</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createSpriteText</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 先用画布将文字画出</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"canvas\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> ctx = canvas.getContext(<span class=\"string\">\"2d\"</span>);</span><br><span class=\"line\">    ctx.fillStyle = <span class=\"string\">\"#ffff00\"</span>;</span><br><span class=\"line\">    ctx.font = <span class=\"string\">\"Bold 100px Arial\"</span>;</span><br><span class=\"line\">    ctx.lineWidth = <span class=\"number\">4</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 把整个 canvas 作为纹理，字尽量大一些来撑满画布，但不要溢出</span></span><br><span class=\"line\">    ctx.fillText(<span class=\"string\">\"ABCDRE\"</span>,<span class=\"number\">4</span>,<span class=\"number\">104</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> texture = <span class=\"keyword\">new</span> THREE.Texture(canvas);</span><br><span class=\"line\">    texture.needsUpdate = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//使用 Sprite 显示文字</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> material = <span class=\"keyword\">new</span> THREE.SpriteMaterial(&#123;<span class=\"attr\">map</span>:texture&#125;);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> textObj = <span class=\"keyword\">new</span> THREE.Sprite(material);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 精灵很小，要放大</span></span><br><span class=\"line\">    textObj.scale.set(<span class=\"number\">0.5</span> * <span class=\"number\">100</span>, <span class=\"number\">0.25</span> * <span class=\"number\">100</span>, <span class=\"number\">0.75</span> * <span class=\"number\">100</span>);</span><br><span class=\"line\">    textObj.position.set(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">98</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> textObj;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用 Sprite 创建一个圆</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createSpriteShape</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 1、创建画布，不设置宽高则使用默认的，可能导致图像变形</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"canvas\"</span>);</span><br><span class=\"line\">    canvas.width = <span class=\"number\">120</span>;</span><br><span class=\"line\">    canvas.height = <span class=\"number\">120</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 2、创建图形 </span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> ctx = canvas.getContext(<span class=\"string\">\"2d\"</span>);</span><br><span class=\"line\">    ctx.fillStyle = <span class=\"string\">\"#ff0000\"</span>;</span><br><span class=\"line\">    ctx.arc(<span class=\"number\">50</span>,<span class=\"number\">50</span>,<span class=\"number\">50</span>,<span class=\"number\">0</span>,<span class=\"number\">2</span>*<span class=\"built_in\">Math</span>.PI);</span><br><span class=\"line\">    ctx.fill();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 3、将 canvas 作为纹理，创建 Sprite</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> texture = <span class=\"keyword\">new</span> THREE.Texture(canvas);</span><br><span class=\"line\">    texture.needsUpdate = <span class=\"literal\">true</span>;  <span class=\"comment\">// 注意这句不能少</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> material = <span class=\"keyword\">new</span> THREE.SpriteMaterial(&#123;<span class=\"attr\">map</span>:texture&#125;);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> mesh = <span class=\"keyword\">new</span> THREE.Sprite(material);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 4、放大图片，精灵默认很小</span></span><br><span class=\"line\">    mesh.scale.set(<span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mesh;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->"},{"title":"CSS 预处理工具","top":false,"keywords":["构建工具","scss","css"],"date":"2019-03-01T15:24:50.000Z","description":"Scss 的基础使用","_content":"\n# 一、出现需求\n<div style=\"text-indent: 2em\">css 只能用来写样式但不能实现真正的编程，而预处理器为 CSS 增加了编程特性，让它更加简洁的同时不再需要考虑浏览器的兼容问题，适应性和可读性更好，可以进行模块化开发，节省开发时间而且方便后期维护等。目前最主流的三个预处理器有 Less、Sass、Stylus</div>\n\n<div style=\"text-indent: 2em\">最早也是最成熟的是 Sass，它使用 以严格的缩进式语法规则书写而不带 {} 和 ; 的缩排语法，后来为了方便习惯 css 的开发人员而升级为Scss，Scss 兼容 Sass 语法而且书写规则类似css。Less 受 Sass 的影响较大，更容易上手但编程功能不够，Stylus主要用来给 Node 项目进行 css 预处理支持</div>\n    \n\n# 二、Scss 基础语法\n\n## 引用 `@import`\n  ```scss\n  // 直接引用文件\n  @import \"index.css\", \"index2.scss\";   // 导入多个文件\n  @import \"http://foo.com/bar\";\n  @import url(foo);\n  @import \"_index.scss\";  // 避免引入文件被编译\n  @import \"colors\";       // 导入 _colors.scss 且不能同时存在 colors.scss\n\n  // 变量插值\n  $device: mobile;\n  @import url(styles.#{$device}.css);\n  ```\n\n## 注释\n  ```scss\n  //  单行注释(不会被编译到css文件中);\n  /*  多行注释(在非压缩模式下会被编译到css文件中)  */\n  /*! 重要注释(各种压缩模式下都会被编译到css文件中)  */\n    ```\n\n\n## 变量\n  * __变量名__：以$开头,可用作选择器/属性(值)/字符串;\n  * __变量值__：数字、字符串(可不带引号)、布尔值、空值(null)、List(列表，类似数组)、Map(映射，类似对象)\n  * __注意__：当使用 #{} 时,带引号的字符串将被编译为 不带引号的字符串(为了便于使用);\n  \n```scss\n$width: 1px;             //全局变量(定义在所有选择器外)\n$width2: 2px;    \n$width2: 3px !default;   //默认变量(无值时起作用)\n$pos: bottom;\n.aa {\n    $fs: 14px;        //局部变量(定义在选择器内)\n    $lh: 1.5;\n\n    width: $width;                  //常规使用($var)\n    border-#{$pos}: 1px solid red;  //拼字符串(#{$var})\n    font: #{$fs}/#{lh} sans-serif;  //复杂属性值(#{$var})\n}\n.bb {\n    $width: 3px !global;           //覆盖全局变量\n    width: $width + $width2;       //用于计算($var + $var)\n}\n@mixin link-style($sel) {\n    li #{$sel} {                  //作为选择器(#{$var})\n        color: red;\n    }\n}\n@include link-style(\"a\");\n```\n\n\n## 嵌套 \n  ```scss\n  // 选择器嵌套\n  div {\n      color: red;\n      p {\n          color: green;\n      }\n      &:hover {     //使用 & 表示在嵌套中对父元素的引用\n          color: blue;\n      }\n      @at-root .d {  //选择器嵌套多层后让某个选择器跳出根元素\n          color: green;\n      }\n  } \n  // 属性嵌套\n  .div {\n      border: {   //嵌套属性后须写冒号\n        style: solid;\n        left: {\n          width: 4px;\n          color: #888;\n        }\n      }\n  }\n  ```\n\n## 混合宏 `@mixin`\n  * @mixin 定义可重用的代码段，@include 调用  \n\n```scss\n// 无参 \n@mixin aa {\n    margin: 10px;\n}\n.bb {\n    @include aa;\n}\n\n// 参数为数组 \n$margin: 100px;\n$left: 10px;\n@mixin aa($left, $margin) {\n    margin: $margin;\n    left: $left;\n}\n.bb {\n    @include aa($left, $margin);\n}\n\n// 参数为对象 \n$map: (left: 10px, width: 100px);\n@mixin aa($left, $width) {\n    // 接收参数为key值\n    left: $left;\n    width: $width;\n}\ndiv {\n    @include aa($map...); // 传递参数为对象名+...\n}\n\n// 默认参数(不传参数时会用默认参数)\n@mixin aa($left: 10px) {}\n\n// 不定参数 \n@mixin box-shadow($shadows...) {\n    //不定参数,用...\n    -moz-box-shadow: $shadows;\n    -webkit-box-shadow: $shadows;\n    box-shadow: $shadows;\n}\n.shadows {\n    @include box-shadow(2px 2px 2px #eee);\n}\n\n// 浏览器前缀设置 \n@mixin rounded($vert, $horz, $radius: 10px) {\n    border-#{$vert}-#{$horz}-radius: $radius;\n    -moz-border-radius-#{$vert}#{$horz}: $radius;\n    -webkit-border-#{$vert}-#{$horz}-radius: $radius;\n}\n#navbar li {\n    @include rounded(top, left);\n}\n\n#footer {\n    @include rounded(top, left, 5px);\n}\n```\n\n\n## 继承 `@extend`\n  * 不管是否调用，基类的样式都将会出现在编译出来的 CSS 代码中  \n\n```scss\n.btn {\n  display: inline-block;\n  margin: 10px;\n  padding: 5px 15px;\n}\n.btn-bor {\n  border: 1px solid #ccc;\n}\n.btn-red {\n  @extend .btn; //多个扩展\n  @extend .btn-bor !optional; \n  // 用optional直接跳过空样式,防止元素不存在而导致报错\n  border-color: red;\n}\n\n.hoverlink {\n  @extend a:hover;   //@extend可扩展任何选择器\n}\na:hover {\n  text-decoration: underline;\n}\n\n// 配合占位选择器(%扩展单一选择器,编译后不在css)使用\n.container div%box {\n  -webkit-box-sizing: border-box;\n  -moz-box-sizing: border-box;\n  box-sizing: border-box;\n}\n.bor-box {\n  @extend %box; //此时才会编译产生\n} \n//编译为 .container div.bor-box { } \n```\n\n\n## 占位符 `%placeholder`\n  * 一个独立定义的声明块，不调用时不会编译生成 CSS  \n\n```scss\n%mt{\n    margin-top: 5px;  \n}\n.block {\n    @extend %mt;\n    span {\n        display:block;\n        @extend %mt;\n    }\n}\n.header {\n    color: orange;\n    @extend %mt;\n    span {\n        display:block;\n        @extend %mt;\n    }\n}\n```\n\n\n# 三、Scss 进阶语法\n\n## 条件判断 \n * 可单独使用或结合 @else (if) 使用\n * 使用 not/or/and 分别表示非/或/与，如 @if not($var)\n * 使用 !=/== 分别表示(不)等于，如 @if $a !=0   \n\n```scss\n@mixin blockOrHidden($boolean:true) {\n    @if $boolean {\n      @debug \"$boolean is #{$boolean}\";\n      display: block; //参数为真，显示\n    }\n    @else {\n      @debug \"$boolean is #{$boolean}\";\n      display: none; //参数为假，不显示\n    }\n}\n.block {\n    @include blockOrHidden;\n}\n.hidden {\n    @include blockOrHidden(false);\n} \n```\n\n\n## 循环 list/map \n  ```scss\n  // list(用空格/逗号隔开项):\n  $name: \"a\", \"b\";\n  $px: 5px 10px 15px 20px; \n  $sel2: (sel1: \"span\", sel2: \"div\") \n\n  // Map\n  $map: (key1: 1, key2: 2, key3: 3);\n    \n  // for循环\n  @for $var from <start> through <end> // 包含end值\n  @for $var from <start> to <end>      // 不包含end值\n    \n  // each循环:\n  @each $var in list/map\n\n\n  // while\n  $i: 2;\n  @while $i>0 {   \t// 条件为 true 就会执行\n      .color#{$i} {\n        color: #222 * $i;\n      }\n      $i:$i - 1;     // 不能写成 $i:$i-1，因为会被当成字符串\n  }\n\n  // for循环 \n  $arr: ( (theme: dark, size: 40px), \n      (theme: light, size: 32px)\n  );\n  @for $i from 1 through length($arr) {\n      $item: nth($arr, $i);           // 获取数组中第i项的值\n      .#{map-get($item, theme)} {\n        width: map-get($item, size);  // 获取指定键值\n        height: map-get($item, size);\n      }\n  }\n\n  // each循环\n  $margins: 5px 10px, 15px 20px;    // 两个项\n  div {\n      margin: nth($margins, 1) nth($margins, 2);\n      padding: nth($margins, 1);\n  }\n  $sel2: (sel1: \"span\", sel2: \"div\");  // Map形式\n  @each $s in $sel2 {\n      .#{$s} {\n        width: 20px;\n      }\n  }\n  $headers: (h1:2em, h2:1.5em, h3:1.2em);\n  @each $header, $size in $headers {\n      #{$header} {\n          font-size: $size;\n      }\n  }\n  ```\n\n\n## 函数和运算 \n\n1. 自定义\n  * @fuction 定义，@return 返回结果\n2. 三元条件\n  * if($condition, $if-true, $if-false)：条件成立时返回值1，否则返回值2\n3. 颜色\n  * rgb/rgba()：创建颜色\n  * alpha/opacity($color)：获取颜色透明度值\n  * rgba($color, $alpha)：改变颜色透明度值\n  * mix($color1, $color2, [$weight])：混合颜色\n  * lighten/darken($color, $percent)：变浅/加深\n4. 数字\n  * random()：随机数\n  * min/max($nums...)：最小值/最大值\n  * floor/ceil($value)：向下/上整数\n  * percentage/abs/round($val)：百分比值/绝对值/取整\n5. 字符串\n  * quote/unquote($string)：给字符串添加/删除引号\n  * to-upper/lower-case()：字符串大小写字母转换\n6. List\n  * length($list)：获取长度\n  * nth($list, i)：获取列表项（索引i从1开始）\n  * append($px, 11px)：添加新值\n  * join($list1, $list2)：列表合并\n  * zip($lists...)：合并多个表为多维列表\n\t* index($list, $value)：返回该值在列表中的索引\t\n7. Map\n  * map-keys/values($map)：获取所有key/values\n  * map-get/remove($map, key)：获取/删除指定项\n  * map-has-key($map, key)：判断是否有key\n  * map-merge($map1, $map2)：合并map\n\t* keywords($args)：返回函数参数(可动态设置key和value)\n8. Introspection\n  * type-of($value)：返回值的类型 \n  * unit($number)：返回值的单位\n  * unitless($number)：判断该值是否带有单位 \n  * commparable($num, $num)：判断两个值是否可做加减和合并\n\n\n```scss\n@function colors($color) {\n    $names: map-keys($social-colors);\n    @if not index($names, $color) {\n        @warn \"Waring: `#{$color} is not a valid color name.`\";\n    }\n    @return map-get($social-colors, $color);\n}\n.btn-weibo {\n    color: colors(weibo);\n}\n\n$social-colors: (\n    dribble: #ea4c89,\n    facebook: #3b5998,\n    github: #171515,\n    google: #db4437,\n    twitter: #55acee\n);\n\n@each $name in map-keys($social-colors) {\n    .btn-#{$name} {\n        color: colors($name);\n    }\n}\n\n@for $i from 1 through length(map-keys($social-colors)) {\n    .btn-#{nth(map-keys($social-colors), $i)} {\n        color: colors(nth(map-keys($social-colors), $i));\n    }\n}\n```\n\n\n## 调试\n  ```scss\n  // 类似于控制台输出信息\n  @debug 'This is adebug';\n  @warn 'Warn';\n  @error 'Error';\n  ```\n\n\n","source":"_posts/4-css预处理.md","raw":"---\ntitle: CSS 预处理工具\ntags:\n  - Skill\n  - CSS\ncategories: Web Skills\ntop: false\nkeywords:\n  - 构建工具\n  - scss\n  - css\ndate: 2019-03-01 23:24:50\ndescription: Scss 的基础使用\n---\n\n# 一、出现需求\n<div style=\"text-indent: 2em\">css 只能用来写样式但不能实现真正的编程，而预处理器为 CSS 增加了编程特性，让它更加简洁的同时不再需要考虑浏览器的兼容问题，适应性和可读性更好，可以进行模块化开发，节省开发时间而且方便后期维护等。目前最主流的三个预处理器有 Less、Sass、Stylus</div>\n\n<div style=\"text-indent: 2em\">最早也是最成熟的是 Sass，它使用 以严格的缩进式语法规则书写而不带 {} 和 ; 的缩排语法，后来为了方便习惯 css 的开发人员而升级为Scss，Scss 兼容 Sass 语法而且书写规则类似css。Less 受 Sass 的影响较大，更容易上手但编程功能不够，Stylus主要用来给 Node 项目进行 css 预处理支持</div>\n    \n\n# 二、Scss 基础语法\n\n## 引用 `@import`\n  ```scss\n  // 直接引用文件\n  @import \"index.css\", \"index2.scss\";   // 导入多个文件\n  @import \"http://foo.com/bar\";\n  @import url(foo);\n  @import \"_index.scss\";  // 避免引入文件被编译\n  @import \"colors\";       // 导入 _colors.scss 且不能同时存在 colors.scss\n\n  // 变量插值\n  $device: mobile;\n  @import url(styles.#{$device}.css);\n  ```\n\n## 注释\n  ```scss\n  //  单行注释(不会被编译到css文件中);\n  /*  多行注释(在非压缩模式下会被编译到css文件中)  */\n  /*! 重要注释(各种压缩模式下都会被编译到css文件中)  */\n    ```\n\n\n## 变量\n  * __变量名__：以$开头,可用作选择器/属性(值)/字符串;\n  * __变量值__：数字、字符串(可不带引号)、布尔值、空值(null)、List(列表，类似数组)、Map(映射，类似对象)\n  * __注意__：当使用 #{} 时,带引号的字符串将被编译为 不带引号的字符串(为了便于使用);\n  \n```scss\n$width: 1px;             //全局变量(定义在所有选择器外)\n$width2: 2px;    \n$width2: 3px !default;   //默认变量(无值时起作用)\n$pos: bottom;\n.aa {\n    $fs: 14px;        //局部变量(定义在选择器内)\n    $lh: 1.5;\n\n    width: $width;                  //常规使用($var)\n    border-#{$pos}: 1px solid red;  //拼字符串(#{$var})\n    font: #{$fs}/#{lh} sans-serif;  //复杂属性值(#{$var})\n}\n.bb {\n    $width: 3px !global;           //覆盖全局变量\n    width: $width + $width2;       //用于计算($var + $var)\n}\n@mixin link-style($sel) {\n    li #{$sel} {                  //作为选择器(#{$var})\n        color: red;\n    }\n}\n@include link-style(\"a\");\n```\n\n\n## 嵌套 \n  ```scss\n  // 选择器嵌套\n  div {\n      color: red;\n      p {\n          color: green;\n      }\n      &:hover {     //使用 & 表示在嵌套中对父元素的引用\n          color: blue;\n      }\n      @at-root .d {  //选择器嵌套多层后让某个选择器跳出根元素\n          color: green;\n      }\n  } \n  // 属性嵌套\n  .div {\n      border: {   //嵌套属性后须写冒号\n        style: solid;\n        left: {\n          width: 4px;\n          color: #888;\n        }\n      }\n  }\n  ```\n\n## 混合宏 `@mixin`\n  * @mixin 定义可重用的代码段，@include 调用  \n\n```scss\n// 无参 \n@mixin aa {\n    margin: 10px;\n}\n.bb {\n    @include aa;\n}\n\n// 参数为数组 \n$margin: 100px;\n$left: 10px;\n@mixin aa($left, $margin) {\n    margin: $margin;\n    left: $left;\n}\n.bb {\n    @include aa($left, $margin);\n}\n\n// 参数为对象 \n$map: (left: 10px, width: 100px);\n@mixin aa($left, $width) {\n    // 接收参数为key值\n    left: $left;\n    width: $width;\n}\ndiv {\n    @include aa($map...); // 传递参数为对象名+...\n}\n\n// 默认参数(不传参数时会用默认参数)\n@mixin aa($left: 10px) {}\n\n// 不定参数 \n@mixin box-shadow($shadows...) {\n    //不定参数,用...\n    -moz-box-shadow: $shadows;\n    -webkit-box-shadow: $shadows;\n    box-shadow: $shadows;\n}\n.shadows {\n    @include box-shadow(2px 2px 2px #eee);\n}\n\n// 浏览器前缀设置 \n@mixin rounded($vert, $horz, $radius: 10px) {\n    border-#{$vert}-#{$horz}-radius: $radius;\n    -moz-border-radius-#{$vert}#{$horz}: $radius;\n    -webkit-border-#{$vert}-#{$horz}-radius: $radius;\n}\n#navbar li {\n    @include rounded(top, left);\n}\n\n#footer {\n    @include rounded(top, left, 5px);\n}\n```\n\n\n## 继承 `@extend`\n  * 不管是否调用，基类的样式都将会出现在编译出来的 CSS 代码中  \n\n```scss\n.btn {\n  display: inline-block;\n  margin: 10px;\n  padding: 5px 15px;\n}\n.btn-bor {\n  border: 1px solid #ccc;\n}\n.btn-red {\n  @extend .btn; //多个扩展\n  @extend .btn-bor !optional; \n  // 用optional直接跳过空样式,防止元素不存在而导致报错\n  border-color: red;\n}\n\n.hoverlink {\n  @extend a:hover;   //@extend可扩展任何选择器\n}\na:hover {\n  text-decoration: underline;\n}\n\n// 配合占位选择器(%扩展单一选择器,编译后不在css)使用\n.container div%box {\n  -webkit-box-sizing: border-box;\n  -moz-box-sizing: border-box;\n  box-sizing: border-box;\n}\n.bor-box {\n  @extend %box; //此时才会编译产生\n} \n//编译为 .container div.bor-box { } \n```\n\n\n## 占位符 `%placeholder`\n  * 一个独立定义的声明块，不调用时不会编译生成 CSS  \n\n```scss\n%mt{\n    margin-top: 5px;  \n}\n.block {\n    @extend %mt;\n    span {\n        display:block;\n        @extend %mt;\n    }\n}\n.header {\n    color: orange;\n    @extend %mt;\n    span {\n        display:block;\n        @extend %mt;\n    }\n}\n```\n\n\n# 三、Scss 进阶语法\n\n## 条件判断 \n * 可单独使用或结合 @else (if) 使用\n * 使用 not/or/and 分别表示非/或/与，如 @if not($var)\n * 使用 !=/== 分别表示(不)等于，如 @if $a !=0   \n\n```scss\n@mixin blockOrHidden($boolean:true) {\n    @if $boolean {\n      @debug \"$boolean is #{$boolean}\";\n      display: block; //参数为真，显示\n    }\n    @else {\n      @debug \"$boolean is #{$boolean}\";\n      display: none; //参数为假，不显示\n    }\n}\n.block {\n    @include blockOrHidden;\n}\n.hidden {\n    @include blockOrHidden(false);\n} \n```\n\n\n## 循环 list/map \n  ```scss\n  // list(用空格/逗号隔开项):\n  $name: \"a\", \"b\";\n  $px: 5px 10px 15px 20px; \n  $sel2: (sel1: \"span\", sel2: \"div\") \n\n  // Map\n  $map: (key1: 1, key2: 2, key3: 3);\n    \n  // for循环\n  @for $var from <start> through <end> // 包含end值\n  @for $var from <start> to <end>      // 不包含end值\n    \n  // each循环:\n  @each $var in list/map\n\n\n  // while\n  $i: 2;\n  @while $i>0 {   \t// 条件为 true 就会执行\n      .color#{$i} {\n        color: #222 * $i;\n      }\n      $i:$i - 1;     // 不能写成 $i:$i-1，因为会被当成字符串\n  }\n\n  // for循环 \n  $arr: ( (theme: dark, size: 40px), \n      (theme: light, size: 32px)\n  );\n  @for $i from 1 through length($arr) {\n      $item: nth($arr, $i);           // 获取数组中第i项的值\n      .#{map-get($item, theme)} {\n        width: map-get($item, size);  // 获取指定键值\n        height: map-get($item, size);\n      }\n  }\n\n  // each循环\n  $margins: 5px 10px, 15px 20px;    // 两个项\n  div {\n      margin: nth($margins, 1) nth($margins, 2);\n      padding: nth($margins, 1);\n  }\n  $sel2: (sel1: \"span\", sel2: \"div\");  // Map形式\n  @each $s in $sel2 {\n      .#{$s} {\n        width: 20px;\n      }\n  }\n  $headers: (h1:2em, h2:1.5em, h3:1.2em);\n  @each $header, $size in $headers {\n      #{$header} {\n          font-size: $size;\n      }\n  }\n  ```\n\n\n## 函数和运算 \n\n1. 自定义\n  * @fuction 定义，@return 返回结果\n2. 三元条件\n  * if($condition, $if-true, $if-false)：条件成立时返回值1，否则返回值2\n3. 颜色\n  * rgb/rgba()：创建颜色\n  * alpha/opacity($color)：获取颜色透明度值\n  * rgba($color, $alpha)：改变颜色透明度值\n  * mix($color1, $color2, [$weight])：混合颜色\n  * lighten/darken($color, $percent)：变浅/加深\n4. 数字\n  * random()：随机数\n  * min/max($nums...)：最小值/最大值\n  * floor/ceil($value)：向下/上整数\n  * percentage/abs/round($val)：百分比值/绝对值/取整\n5. 字符串\n  * quote/unquote($string)：给字符串添加/删除引号\n  * to-upper/lower-case()：字符串大小写字母转换\n6. List\n  * length($list)：获取长度\n  * nth($list, i)：获取列表项（索引i从1开始）\n  * append($px, 11px)：添加新值\n  * join($list1, $list2)：列表合并\n  * zip($lists...)：合并多个表为多维列表\n\t* index($list, $value)：返回该值在列表中的索引\t\n7. Map\n  * map-keys/values($map)：获取所有key/values\n  * map-get/remove($map, key)：获取/删除指定项\n  * map-has-key($map, key)：判断是否有key\n  * map-merge($map1, $map2)：合并map\n\t* keywords($args)：返回函数参数(可动态设置key和value)\n8. Introspection\n  * type-of($value)：返回值的类型 \n  * unit($number)：返回值的单位\n  * unitless($number)：判断该值是否带有单位 \n  * commparable($num, $num)：判断两个值是否可做加减和合并\n\n\n```scss\n@function colors($color) {\n    $names: map-keys($social-colors);\n    @if not index($names, $color) {\n        @warn \"Waring: `#{$color} is not a valid color name.`\";\n    }\n    @return map-get($social-colors, $color);\n}\n.btn-weibo {\n    color: colors(weibo);\n}\n\n$social-colors: (\n    dribble: #ea4c89,\n    facebook: #3b5998,\n    github: #171515,\n    google: #db4437,\n    twitter: #55acee\n);\n\n@each $name in map-keys($social-colors) {\n    .btn-#{$name} {\n        color: colors($name);\n    }\n}\n\n@for $i from 1 through length(map-keys($social-colors)) {\n    .btn-#{nth(map-keys($social-colors), $i)} {\n        color: colors(nth(map-keys($social-colors), $i));\n    }\n}\n```\n\n\n## 调试\n  ```scss\n  // 类似于控制台输出信息\n  @debug 'This is adebug';\n  @warn 'Warn';\n  @error 'Error';\n  ```\n\n\n","slug":"4-css预处理","published":1,"updated":"2019-04-06T14:20:43.185Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvid4pj1000h0nbxlyxrw6om","content":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><html><head></head><body><h1 id=\"一、出现需求\"><a href=\"#一、出现需求\" class=\"headerlink\" title=\"一、出现需求\"></a>一、出现需求</h1><div style=\"text-indent:2em\">css 只能用来写样式但不能实现真正的编程，而预处理器为 CSS 增加了编程特性，让它更加简洁的同时不再需要考虑浏览器的兼容问题，适应性和可读性更好，可以进行模块化开发，节省开发时间而且方便后期维护等。目前最主流的三个预处理器有 Less、Sass、Stylus</div><div style=\"text-indent:2em\">最早也是最成熟的是 Sass，它使用 以严格的缩进式语法规则书写而不带 {} 和 ; 的缩排语法，后来为了方便习惯 css 的开发人员而升级为Scss，Scss 兼容 Sass 语法而且书写规则类似css。Less 受 Sass 的影响较大，更容易上手但编程功能不够，Stylus主要用来给 Node 项目进行 css 预处理支持</div><h1 id=\"二、Scss-基础语法\"><a href=\"#二、Scss-基础语法\" class=\"headerlink\" title=\"二、Scss 基础语法\"></a>二、Scss 基础语法</h1><h2 id=\"引用-import\"><a href=\"#引用-import\" class=\"headerlink\" title=\"引用 @import\"></a>引用 <code>@import</code></h2><figure class=\"highlight scss\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 直接引用文件</span></span><br><span class=\"line\">@<span class=\"keyword\">import</span> <span class=\"string\">\"index.css\"</span>, <span class=\"string\">\"index2.scss\"</span>;   <span class=\"comment\">// 导入多个文件</span></span><br><span class=\"line\">@<span class=\"keyword\">import</span> <span class=\"string\">\"http://foo.com/bar\"</span>;</span><br><span class=\"line\">@<span class=\"keyword\">import</span> url(foo);</span><br><span class=\"line\">@<span class=\"keyword\">import</span> <span class=\"string\">\"_index.scss\"</span>;  <span class=\"comment\">// 避免引入文件被编译</span></span><br><span class=\"line\">@<span class=\"keyword\">import</span> <span class=\"string\">\"colors\"</span>;       <span class=\"comment\">// 导入 _colors.scss 且不能同时存在 colors.scss</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 变量插值</span></span><br><span class=\"line\"><span class=\"variable\">$device</span>: mobile;</span><br><span class=\"line\">@<span class=\"keyword\">import</span> url(styles.#{<span class=\"variable\">$device</span>}<span class=\"selector-class\">.css</span>);</span><br></pre></td></tr></tbody></table></figure><h2 id=\"注释\"><a href=\"#注释\" class=\"headerlink\" title=\"注释\"></a>注释</h2><figure class=\"highlight scss\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  单行注释(不会被编译到css文件中);</span></span><br><span class=\"line\"><span class=\"comment\">/*  多行注释(在非压缩模式下会被编译到css文件中)  */</span></span><br><span class=\"line\"><span class=\"comment\">/*! 重要注释(各种压缩模式下都会被编译到css文件中)  */</span></span><br></pre></td></tr></tbody></table></figure><h2 id=\"变量\"><a href=\"#变量\" class=\"headerlink\" title=\"变量\"></a>变量</h2><ul><li><strong>变量名</strong>：以$开头,可用作选择器/属性(值)/字符串;</li><li><strong>变量值</strong>：数字、字符串(可不带引号)、布尔值、空值(null)、List(列表，类似数组)、Map(映射，类似对象)</li><li><strong>注意</strong>：当使用 #{} 时,带引号的字符串将被编译为 不带引号的字符串(为了便于使用);</li></ul><figure class=\"highlight scss\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$width</span>: <span class=\"number\">1px</span>;             <span class=\"comment\">//全局变量(定义在所有选择器外)</span></span><br><span class=\"line\"><span class=\"variable\">$width2</span>: <span class=\"number\">2px</span>;    </span><br><span class=\"line\"><span class=\"variable\">$width2</span>: <span class=\"number\">3px</span> !default;   <span class=\"comment\">//默认变量(无值时起作用)</span></span><br><span class=\"line\"><span class=\"variable\">$pos</span>: bottom;</span><br><span class=\"line\"><span class=\"selector-class\">.aa</span> {</span><br><span class=\"line\">    <span class=\"variable\">$fs</span>: <span class=\"number\">14px</span>;        <span class=\"comment\">//局部变量(定义在选择器内)</span></span><br><span class=\"line\">    <span class=\"variable\">$lh</span>: <span class=\"number\">1.5</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"variable\">$width</span>;                  <span class=\"comment\">//常规使用($var)</span></span><br><span class=\"line\">    <span class=\"attribute\">border</span>-#{<span class=\"variable\">$pos</span>}: <span class=\"number\">1px</span> solid red;  <span class=\"comment\">//拼字符串(#{$var})</span></span><br><span class=\"line\">    <span class=\"attribute\">font</span>: #{<span class=\"variable\">$fs</span>}/#{lh} sans-serif;  <span class=\"comment\">//复杂属性值(#{$var})</span></span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-class\">.bb</span> {</span><br><span class=\"line\">    <span class=\"variable\">$width</span>: <span class=\"number\">3px</span> !global;           <span class=\"comment\">//覆盖全局变量</span></span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"variable\">$width</span> + <span class=\"variable\">$width2</span>;       <span class=\"comment\">//用于计算($var + $var)</span></span><br><span class=\"line\">}</span><br><span class=\"line\">@<span class=\"keyword\">mixin</span> link-style(<span class=\"variable\">$sel</span>) {</span><br><span class=\"line\">    <span class=\"selector-tag\">li</span> #{<span class=\"variable\">$sel</span>} {                  <span class=\"comment\">//作为选择器(#{$var})</span></span><br><span class=\"line\">        <span class=\"attribute\">color</span>: red;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\">@<span class=\"keyword\">include</span> link-style(<span class=\"string\">\"a\"</span>);</span><br></pre></td></tr></tbody></table></figure><h2 id=\"嵌套\"><a href=\"#嵌套\" class=\"headerlink\" title=\"嵌套\"></a>嵌套</h2><figure class=\"highlight scss\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 选择器嵌套</span></span><br><span class=\"line\"><span class=\"selector-tag\">div</span> {</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: red;</span><br><span class=\"line\">    <span class=\"selector-tag\">p</span> {</span><br><span class=\"line\">        <span class=\"attribute\">color</span>: green;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    &:hover {     <span class=\"comment\">//使用 & 表示在嵌套中对父元素的引用</span></span><br><span class=\"line\">        <span class=\"attribute\">color</span>: blue;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    @at-root .d {  <span class=\"comment\">//选择器嵌套多层后让某个选择器跳出根元素</span></span><br><span class=\"line\">        <span class=\"attribute\">color</span>: green;</span><br><span class=\"line\">    }</span><br><span class=\"line\">} </span><br><span class=\"line\"><span class=\"comment\">// 属性嵌套</span></span><br><span class=\"line\"><span class=\"selector-class\">.div</span> {</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: {   //嵌套属性后须写冒号</span><br><span class=\"line\">      style: solid;</span><br><span class=\"line\">      <span class=\"attribute\">left</span>: {</span><br><span class=\"line\">        width: <span class=\"number\">4px</span>;</span><br><span class=\"line\">        <span class=\"attribute\">color</span>: <span class=\"number\">#888</span>;</span><br><span class=\"line\">      }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"混合宏-mixin\"><a href=\"#混合宏-mixin\" class=\"headerlink\" title=\"混合宏 @mixin\"></a>混合宏 <code>@mixin</code></h2><ul><li>@mixin 定义可重用的代码段，@include 调用</li></ul><figure class=\"highlight scss\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 无参 </span></span><br><span class=\"line\">@<span class=\"keyword\">mixin</span> aa {</span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-class\">.bb</span> {</span><br><span class=\"line\">    @<span class=\"keyword\">include</span> aa;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 参数为数组 </span></span><br><span class=\"line\"><span class=\"variable\">$margin</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\"><span class=\"variable\">$left</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">@<span class=\"keyword\">mixin</span> aa(<span class=\"variable\">$left</span>, <span class=\"variable\">$margin</span>) {</span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: <span class=\"variable\">$margin</span>;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"variable\">$left</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-class\">.bb</span> {</span><br><span class=\"line\">    @<span class=\"keyword\">include</span> aa(<span class=\"variable\">$left</span>, <span class=\"variable\">$margin</span>);</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 参数为对象 </span></span><br><span class=\"line\"><span class=\"variable\">$map</span>: (left: <span class=\"number\">10px</span>, width: <span class=\"number\">100px</span>);</span><br><span class=\"line\">@<span class=\"keyword\">mixin</span> aa(<span class=\"variable\">$left</span>, <span class=\"variable\">$width</span>) {</span><br><span class=\"line\">    <span class=\"comment\">// 接收参数为key值</span></span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"variable\">$left</span>;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"variable\">$width</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-tag\">div</span> {</span><br><span class=\"line\">    @<span class=\"keyword\">include</span> aa(<span class=\"variable\">$map</span>...); <span class=\"comment\">// 传递参数为对象名+...</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 默认参数(不传参数时会用默认参数)</span></span><br><span class=\"line\">@<span class=\"keyword\">mixin</span> aa(<span class=\"variable\">$left</span>: 10px) {}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 不定参数 </span></span><br><span class=\"line\">@<span class=\"keyword\">mixin</span> box-shadow(<span class=\"variable\">$shadows</span>...) {</span><br><span class=\"line\">    <span class=\"comment\">//不定参数,用...</span></span><br><span class=\"line\">    -moz-<span class=\"attribute\">box-shadow</span>: <span class=\"variable\">$shadows</span>;</span><br><span class=\"line\">    -webkit-<span class=\"attribute\">box-shadow</span>: <span class=\"variable\">$shadows</span>;</span><br><span class=\"line\">    <span class=\"attribute\">box-shadow</span>: <span class=\"variable\">$shadows</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-class\">.shadows</span> {</span><br><span class=\"line\">    @<span class=\"keyword\">include</span> box-shadow(<span class=\"number\">2px</span> 2px 2px <span class=\"number\">#eee</span>);</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 浏览器前缀设置 </span></span><br><span class=\"line\">@<span class=\"keyword\">mixin</span> rounded(<span class=\"variable\">$vert</span>, <span class=\"variable\">$horz</span>, <span class=\"variable\">$radius</span>: 10px) {</span><br><span class=\"line\">    <span class=\"attribute\">border</span>-#{<span class=\"variable\">$vert</span>}-#{<span class=\"variable\">$horz</span>}-radius: <span class=\"variable\">$radius</span>;</span><br><span class=\"line\">    -moz-<span class=\"attribute\">border-radius</span>-#{<span class=\"variable\">$vert</span>}#{<span class=\"variable\">$horz</span>}: <span class=\"variable\">$radius</span>;</span><br><span class=\"line\">    -webkit-<span class=\"attribute\">border</span>-#{<span class=\"variable\">$vert</span>}-#{<span class=\"variable\">$horz</span>}-radius: <span class=\"variable\">$radius</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-id\">#navbar</span> <span class=\"selector-tag\">li</span> {</span><br><span class=\"line\">    @<span class=\"keyword\">include</span> rounded(top, left);</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-id\">#footer</span> {</span><br><span class=\"line\">    @<span class=\"keyword\">include</span> rounded(top, left, 5px);</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"继承-extend\"><a href=\"#继承-extend\" class=\"headerlink\" title=\"继承 @extend\"></a>继承 <code>@extend</code></h2><ul><li>不管是否调用，基类的样式都将会出现在编译出来的 CSS 代码中</li></ul><figure class=\"highlight scss\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.btn</span> {</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: inline-block;</span><br><span class=\"line\">  <span class=\"attribute\">margin</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">5px</span> <span class=\"number\">15px</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-class\">.btn-bor</span> {</span><br><span class=\"line\">  <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#ccc</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-class\">.btn-red</span> {</span><br><span class=\"line\">  @<span class=\"keyword\">extend</span> .btn; <span class=\"comment\">//多个扩展</span></span><br><span class=\"line\">  @<span class=\"keyword\">extend</span> .btn-bor !optional; </span><br><span class=\"line\">  <span class=\"comment\">// 用optional直接跳过空样式,防止元素不存在而导致报错</span></span><br><span class=\"line\">  <span class=\"attribute\">border-color</span>: red;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.hoverlink</span> {</span><br><span class=\"line\">  @<span class=\"keyword\">extend</span> a:hover;   <span class=\"comment\">//@extend可扩展任何选择器</span></span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-tag\">a</span>:hover {</span><br><span class=\"line\">  <span class=\"attribute\">text-decoration</span>: underline;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 配合占位选择器(%扩展单一选择器,编译后不在css)使用</span></span><br><span class=\"line\"><span class=\"selector-class\">.container</span> <span class=\"selector-tag\">div</span>%box {</span><br><span class=\"line\">  -webkit-<span class=\"attribute\">box-sizing</span>: border-box;</span><br><span class=\"line\">  -moz-<span class=\"attribute\">box-sizing</span>: border-box;</span><br><span class=\"line\">  <span class=\"attribute\">box-sizing</span>: border-box;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-class\">.bor-box</span> {</span><br><span class=\"line\">  @<span class=\"keyword\">extend</span> %box; <span class=\"comment\">//此时才会编译产生</span></span><br><span class=\"line\">} </span><br><span class=\"line\"><span class=\"comment\">//编译为 .container div.bor-box { }</span></span><br></pre></td></tr></tbody></table></figure><h2 id=\"占位符-placeholder\"><a href=\"#占位符-placeholder\" class=\"headerlink\" title=\"占位符 %placeholder\"></a>占位符 <code>%placeholder</code></h2><ul><li>一个独立定义的声明块，不调用时不会编译生成 CSS</li></ul><figure class=\"highlight scss\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">%mt{</span><br><span class=\"line\">    <span class=\"attribute\">margin-top</span>: <span class=\"number\">5px</span>;  </span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-class\">.block</span> {</span><br><span class=\"line\">    @<span class=\"keyword\">extend</span> %mt;</span><br><span class=\"line\">    <span class=\"selector-tag\">span</span> {</span><br><span class=\"line\">        <span class=\"attribute\">display</span>:block;</span><br><span class=\"line\">        @<span class=\"keyword\">extend</span> %mt;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-class\">.header</span> {</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: orange;</span><br><span class=\"line\">    @<span class=\"keyword\">extend</span> %mt;</span><br><span class=\"line\">    <span class=\"selector-tag\">span</span> {</span><br><span class=\"line\">        <span class=\"attribute\">display</span>:block;</span><br><span class=\"line\">        @<span class=\"keyword\">extend</span> %mt;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h1 id=\"三、Scss-进阶语法\"><a href=\"#三、Scss-进阶语法\" class=\"headerlink\" title=\"三、Scss 进阶语法\"></a>三、Scss 进阶语法</h1><h2 id=\"条件判断\"><a href=\"#条件判断\" class=\"headerlink\" title=\"条件判断\"></a>条件判断</h2><ul><li>可单独使用或结合 @else (if) 使用</li><li>使用 not/or/and 分别表示非/或/与，如 @if not($var)</li><li>使用 !=/== 分别表示(不)等于，如 @if $a !=0</li></ul><figure class=\"highlight scss\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"keyword\">mixin</span> blockOrHidden(<span class=\"variable\">$boolean</span>:true) {</span><br><span class=\"line\">    @<span class=\"keyword\">if</span> <span class=\"variable\">$boolean</span> {</span><br><span class=\"line\">      @<span class=\"keyword\">debug</span> <span class=\"string\">\"$boolean is #{$boolean}\"</span>;</span><br><span class=\"line\">      <span class=\"attribute\">display</span>: block; <span class=\"comment\">//参数为真，显示</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">    @<span class=\"keyword\">else</span> {</span><br><span class=\"line\">      @<span class=\"keyword\">debug</span> <span class=\"string\">\"$boolean is #{$boolean}\"</span>;</span><br><span class=\"line\">      <span class=\"attribute\">display</span>: none; <span class=\"comment\">//参数为假，不显示</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-class\">.block</span> {</span><br><span class=\"line\">    @<span class=\"keyword\">include</span> blockOrHidden;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-class\">.hidden</span> {</span><br><span class=\"line\">    @<span class=\"keyword\">include</span> blockOrHidden(false);</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"循环-list-map\"><a href=\"#循环-list-map\" class=\"headerlink\" title=\"循环 list/map\"></a>循环 list/map</h2><figure class=\"highlight scss\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// list(用空格/逗号隔开项):</span></span><br><span class=\"line\"><span class=\"variable\">$name</span>: <span class=\"string\">\"a\"</span>, <span class=\"string\">\"b\"</span>;</span><br><span class=\"line\"><span class=\"variable\">$px</span>: <span class=\"number\">5px</span> <span class=\"number\">10px</span> <span class=\"number\">15px</span> <span class=\"number\">20px</span>; </span><br><span class=\"line\"><span class=\"variable\">$sel2</span>: (sel1: <span class=\"string\">\"span\"</span>, sel2: <span class=\"string\">\"div\"</span>) </span><br><span class=\"line\"></span><br><span class=\"line\">// Map</span><br><span class=\"line\"><span class=\"variable\">$map</span>: (key1: <span class=\"number\">1</span>, key2: <span class=\"number\">2</span>, key3: <span class=\"number\">3</span>);</span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"comment\">// for循环</span></span><br><span class=\"line\">@<span class=\"keyword\">for</span> <span class=\"variable\">$var</span> from <start> through <end> // 包含end值</span><br><span class=\"line\">@<span class=\"keyword\">for</span> <span class=\"variable\">$var</span> from <start> to <end>      // 不包含end值</span><br><span class=\"line\">  </span><br><span class=\"line\">// each循环:</span><br><span class=\"line\">@<span class=\"keyword\">each</span> <span class=\"variable\">$var</span> in list/map</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">// while</span><br><span class=\"line\"><span class=\"variable\">$i</span>: 2;</span><br><span class=\"line\">@<span class=\"keyword\">while</span> <span class=\"variable\">$i</span>><span class=\"number\">0</span> {   \t<span class=\"comment\">// 条件为 true 就会执行</span></span><br><span class=\"line\">    <span class=\"selector-class\">.color</span>#{<span class=\"variable\">$i</span>} {</span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#222</span> * <span class=\"variable\">$i</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"variable\">$i</span>:<span class=\"variable\">$i</span> - <span class=\"number\">1</span>;     <span class=\"comment\">// 不能写成 $i:$i-1，因为会被当成字符串</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// for循环 </span></span><br><span class=\"line\"><span class=\"variable\">$arr</span>: ( (theme: dark, size: <span class=\"number\">40px</span>), </span><br><span class=\"line\">    (theme: light, size: <span class=\"number\">32px</span>)</span><br><span class=\"line\">);</span><br><span class=\"line\">@<span class=\"keyword\">for</span> <span class=\"variable\">$i</span> from 1 through length(<span class=\"variable\">$arr</span>) {</span><br><span class=\"line\">    <span class=\"variable\">$item</span>: nth(<span class=\"variable\">$arr</span>, <span class=\"variable\">$i</span>);           <span class=\"comment\">// 获取数组中第i项的值</span></span><br><span class=\"line\">    .#{<span class=\"selector-tag\">map</span>-get(<span class=\"variable\">$item</span>, theme)} {</span><br><span class=\"line\">      <span class=\"attribute\">width</span>: map-get(<span class=\"variable\">$item</span>, size);  <span class=\"comment\">// 获取指定键值</span></span><br><span class=\"line\">      <span class=\"attribute\">height</span>: map-get(<span class=\"variable\">$item</span>, size);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// each循环</span></span><br><span class=\"line\"><span class=\"variable\">$margins</span>: <span class=\"number\">5px</span> <span class=\"number\">10px</span>, <span class=\"number\">15px</span> <span class=\"number\">20px</span>;    <span class=\"comment\">// 两个项</span></span><br><span class=\"line\"><span class=\"selector-tag\">div</span> {</span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: nth(<span class=\"variable\">$margins</span>, <span class=\"number\">1</span>) nth(<span class=\"variable\">$margins</span>, <span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"attribute\">padding</span>: nth(<span class=\"variable\">$margins</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"variable\">$sel2</span>: (sel1: <span class=\"string\">\"span\"</span>, sel2: <span class=\"string\">\"div\"</span>);  <span class=\"comment\">// Map形式</span></span><br><span class=\"line\">@<span class=\"keyword\">each</span> <span class=\"variable\">$s</span> in <span class=\"variable\">$sel2</span> {</span><br><span class=\"line\">    .#{<span class=\"variable\">$s</span>} {</span><br><span class=\"line\">      <span class=\"attribute\">width</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"variable\">$headers</span>: (h1:<span class=\"number\">2em</span>, h2:<span class=\"number\">1.5em</span>, h3:<span class=\"number\">1.2em</span>);</span><br><span class=\"line\">@<span class=\"keyword\">each</span> <span class=\"variable\">$header</span>, <span class=\"variable\">$size</span> in <span class=\"variable\">$headers</span> {</span><br><span class=\"line\">    #{<span class=\"variable\">$header</span>} {</span><br><span class=\"line\">        <span class=\"attribute\">font-size</span>: <span class=\"variable\">$size</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"函数和运算\"><a href=\"#函数和运算\" class=\"headerlink\" title=\"函数和运算\"></a>函数和运算</h2><ol><li>自定义<ul><li>@fuction 定义，@return 返回结果</li></ul></li><li>三元条件<ul><li>if($condition, $if-true, $if-false)：条件成立时返回值1，否则返回值2</li></ul></li><li>颜色<ul><li>rgb/rgba()：创建颜色</li><li>alpha/opacity($color)：获取颜色透明度值</li><li>rgba($color, $alpha)：改变颜色透明度值</li><li>mix($color1, $color2, [$weight])：混合颜色</li><li>lighten/darken($color, $percent)：变浅/加深</li></ul></li><li>数字<ul><li>random()：随机数</li><li>min/max($nums…)：最小值/最大值</li><li>floor/ceil($value)：向下/上整数</li><li>percentage/abs/round($val)：百分比值/绝对值/取整</li></ul></li><li>字符串<ul><li>quote/unquote($string)：给字符串添加/删除引号</li><li>to-upper/lower-case()：字符串大小写字母转换</li></ul></li><li>List<ul><li>length($list)：获取长度</li><li>nth($list, i)：获取列表项（索引i从1开始）</li><li>append($px, 11px)：添加新值</li><li>join($list1, $list2)：列表合并</li><li>zip($lists…)：合并多个表为多维列表<ul><li>index($list, $value)：返回该值在列表中的索引</li></ul></li></ul></li><li>Map<ul><li>map-keys/values($map)：获取所有key/values</li><li>map-get/remove($map, key)：获取/删除指定项</li><li>map-has-key($map, key)：判断是否有key</li><li>map-merge($map1, $map2)：合并map<ul><li>keywords($args)：返回函数参数(可动态设置key和value)</li></ul></li></ul></li><li>Introspection<ul><li>type-of($value)：返回值的类型</li><li>unit($number)：返回值的单位</li><li>unitless($number)：判断该值是否带有单位</li><li>commparable($num, $num)：判断两个值是否可做加减和合并</li></ul></li></ol><figure class=\"highlight scss\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@function colors(<span class=\"variable\">$color</span>) {</span><br><span class=\"line\">    <span class=\"variable\">$names</span>: map-keys(<span class=\"variable\">$social-colors</span>);</span><br><span class=\"line\">    @<span class=\"keyword\">if</span> not index(<span class=\"variable\">$names</span>, <span class=\"variable\">$color</span>) {</span><br><span class=\"line\">        @<span class=\"keyword\">warn</span> <span class=\"string\">\"Waring: `#{$color} is not a valid color name.`\"</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    @return map-get(<span class=\"variable\">$social-colors</span>, <span class=\"variable\">$color</span>);</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-class\">.btn-weibo</span> {</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: colors(weibo);</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$social-colors</span>: (</span><br><span class=\"line\">    dribble: <span class=\"number\">#ea4c89</span>,</span><br><span class=\"line\">    facebook: <span class=\"number\">#3b5998</span>,</span><br><span class=\"line\">    github: <span class=\"number\">#171515</span>,</span><br><span class=\"line\">    google: <span class=\"number\">#db4437</span>,</span><br><span class=\"line\">    twitter: <span class=\"number\">#55acee</span></span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">@<span class=\"keyword\">each</span> <span class=\"variable\">$name</span> in map-keys(<span class=\"variable\">$social-colors</span>) {</span><br><span class=\"line\">    <span class=\"selector-class\">.btn-</span>#{<span class=\"variable\">$name</span>} {</span><br><span class=\"line\">        <span class=\"attribute\">color</span>: colors(<span class=\"variable\">$name</span>);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\">@<span class=\"keyword\">for</span> <span class=\"variable\">$i</span> from 1 through length(map-keys(<span class=\"variable\">$social-colors</span>)) {</span><br><span class=\"line\">    <span class=\"selector-class\">.btn-</span>#{nth(<span class=\"selector-tag\">map</span>-keys(<span class=\"variable\">$social-colors</span>), <span class=\"variable\">$i</span>)} {</span><br><span class=\"line\">        <span class=\"attribute\">color</span>: colors(nth(map-keys(<span class=\"variable\">$social-colors</span>), <span class=\"variable\">$i</span>));</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"调试\"><a href=\"#调试\" class=\"headerlink\" title=\"调试\"></a>调试</h2><figure class=\"highlight scss\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 类似于控制台输出信息</span></span><br><span class=\"line\">@<span class=\"keyword\">debug</span> <span class=\"string\">'This is adebug'</span>;</span><br><span class=\"line\">@<span class=\"keyword\">warn</span> <span class=\"string\">'Warn'</span>;</span><br><span class=\"line\">@error <span class=\"string\">'Error'</span>;</span><br></pre></td></tr></tbody></table></figure><!-- rebuild by neat --></body></html>","site":{"data":{"next":{"override":false,"cache":{"enable":true},"favicon":{"small":"/images/favicon-16.ico","medium":"/images/favicon-32.ico","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"rss":"/atom.xml","footer":{"since":2019,"icon":{"name":"snowflake-o","animated":false,"color":"#808080"},"copyright":"chuangge","powered":{"enable":false,"version":true},"theme":{"enable":false,"version":true},"beian":{"enable":false,"icp":null}},"creative_commons":{"license":"by-nc-sa","sidebar":false,"post":false},"canonical":true,"seo":false,"index_with_subtitle":false,"exturl":false,"menu":{"home":"/ || home  //首页","tags":"/tags/ || tags  //标签","categories":"/categories/ || th   //分类","archives":"/archives/ || archive //归档"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":{"GitHub":"https://github.com/ || github","StackOverflow":"https://stackoverflow.com/ || stack-overflow"},"social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"友情链接","links_layout":"inline","links":{"个人简历":"https://chuanggefighting.github.io/project/","印记中文":"https://www.docschina.org/","在线工具":"http://tool.lu/","Learn Anything":"https://learn-anything.xyz/"},"avatar":{"url":"/images/chuang.png","rounded":true,"opacity":1,"rotated":true},"toc":{"enable":true,"number":true,"wrap":false,"max_depth":6},"sidebar":{"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"read_more_btn":true,"post_meta":{"item_text":true,"created_at":true,"updated_at":{"enabled":true,"another_day":true},"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":true,"awl":4,"wpm":275},"codeblock":{"border_radius":null,"copy_button":{"enable":false,"show_result":false}},"reward":{"enable":false},"related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_edit":{"enable":false,"url":"https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name"},"disable_baidu_tranformation":false,"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"font":{"enable":true,"host":"//fonts.proxy.ustclug.org","global":{"external":true,"family":"Lato","size":16},"headings":{"external":true,"family":"Roboto Slab","size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":"Lobster Two","size":24},"codes":{"external":true,"family":"Roboto Mono","size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css","copy_tex":{"enable":false,"copy_tex_js":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js","copy_tex_css":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css"}}},"pdf":{"enable":false,"per_page":true,"height":"500px","pdfobject":{"cdn":"//cdn.jsdelivr.net/npm/pdfobject@2.1.1/pdfobject.min.js"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":true,"appid":"snOvapuSplYTVflf5p9Ml9JX-gzGzoHsz","appkey":"5ABGdfyEdAtu6lTXdGdo7hf9","notify":false,"verify":false,"placeholder":"ヾﾉ≧∀≦)o 来呀！吐槽一番吧！","avatar":"mm","guest_info":"nick,mail,link","pageSize":10,"visitor":false,"comment_count":true},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"gitalk":{"enable":false,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true},"needmoreshare2":{"enable":true,"postbottom":{"enable":true,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null,"security":false,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":true,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":true,"pace_theme":"pace-theme-center-simple","canvas_nest":{"enable":true,"onmobile":true,"color":"0,0,255","opacity":0.5,"zIndex":-1,"count":99},"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"canvas_nest_nomobile":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"leancloud":null,"valine":null,"gitalk_js":null,"gitalk_css":null,"md5":null},"css":"css","js":"js","images":"images","passage_end_tag":{"enabled":true},"daovoice":true,"daovoice_app_id":"2ed51855"}}},"excerpt":"","more":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><h1 id=\"一、出现需求\"><a href=\"#一、出现需求\" class=\"headerlink\" title=\"一、出现需求\"></a>一、出现需求</h1><div style=\"text-indent:2em\">css 只能用来写样式但不能实现真正的编程，而预处理器为 CSS 增加了编程特性，让它更加简洁的同时不再需要考虑浏览器的兼容问题，适应性和可读性更好，可以进行模块化开发，节省开发时间而且方便后期维护等。目前最主流的三个预处理器有 Less、Sass、Stylus</div><div style=\"text-indent:2em\">最早也是最成熟的是 Sass，它使用 以严格的缩进式语法规则书写而不带 {} 和 ; 的缩排语法，后来为了方便习惯 css 的开发人员而升级为Scss，Scss 兼容 Sass 语法而且书写规则类似css。Less 受 Sass 的影响较大，更容易上手但编程功能不够，Stylus主要用来给 Node 项目进行 css 预处理支持</div><h1 id=\"二、Scss-基础语法\"><a href=\"#二、Scss-基础语法\" class=\"headerlink\" title=\"二、Scss 基础语法\"></a>二、Scss 基础语法</h1><h2 id=\"引用-import\"><a href=\"#引用-import\" class=\"headerlink\" title=\"引用 @import\"></a>引用 <code>@import</code></h2><figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 直接引用文件</span></span><br><span class=\"line\">@<span class=\"keyword\">import</span> <span class=\"string\">\"index.css\"</span>, <span class=\"string\">\"index2.scss\"</span>;   <span class=\"comment\">// 导入多个文件</span></span><br><span class=\"line\">@<span class=\"keyword\">import</span> <span class=\"string\">\"http://foo.com/bar\"</span>;</span><br><span class=\"line\">@<span class=\"keyword\">import</span> url(foo);</span><br><span class=\"line\">@<span class=\"keyword\">import</span> <span class=\"string\">\"_index.scss\"</span>;  <span class=\"comment\">// 避免引入文件被编译</span></span><br><span class=\"line\">@<span class=\"keyword\">import</span> <span class=\"string\">\"colors\"</span>;       <span class=\"comment\">// 导入 _colors.scss 且不能同时存在 colors.scss</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 变量插值</span></span><br><span class=\"line\"><span class=\"variable\">$device</span>: mobile;</span><br><span class=\"line\">@<span class=\"keyword\">import</span> url(styles.#&#123;<span class=\"variable\">$device</span>&#125;<span class=\"selector-class\">.css</span>);</span><br></pre></td></tr></table></figure><h2 id=\"注释\"><a href=\"#注释\" class=\"headerlink\" title=\"注释\"></a>注释</h2><figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  单行注释(不会被编译到css文件中);</span></span><br><span class=\"line\"><span class=\"comment\">/*  多行注释(在非压缩模式下会被编译到css文件中)  */</span></span><br><span class=\"line\"><span class=\"comment\">/*! 重要注释(各种压缩模式下都会被编译到css文件中)  */</span></span><br></pre></td></tr></table></figure><h2 id=\"变量\"><a href=\"#变量\" class=\"headerlink\" title=\"变量\"></a>变量</h2><ul><li><strong>变量名</strong>：以$开头,可用作选择器/属性(值)/字符串;</li><li><strong>变量值</strong>：数字、字符串(可不带引号)、布尔值、空值(null)、List(列表，类似数组)、Map(映射，类似对象)</li><li><strong>注意</strong>：当使用 #{} 时,带引号的字符串将被编译为 不带引号的字符串(为了便于使用);</li></ul><figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$width</span>: <span class=\"number\">1px</span>;             <span class=\"comment\">//全局变量(定义在所有选择器外)</span></span><br><span class=\"line\"><span class=\"variable\">$width2</span>: <span class=\"number\">2px</span>;    </span><br><span class=\"line\"><span class=\"variable\">$width2</span>: <span class=\"number\">3px</span> !default;   <span class=\"comment\">//默认变量(无值时起作用)</span></span><br><span class=\"line\"><span class=\"variable\">$pos</span>: bottom;</span><br><span class=\"line\"><span class=\"selector-class\">.aa</span> &#123;</span><br><span class=\"line\">    <span class=\"variable\">$fs</span>: <span class=\"number\">14px</span>;        <span class=\"comment\">//局部变量(定义在选择器内)</span></span><br><span class=\"line\">    <span class=\"variable\">$lh</span>: <span class=\"number\">1.5</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"variable\">$width</span>;                  <span class=\"comment\">//常规使用($var)</span></span><br><span class=\"line\">    <span class=\"attribute\">border</span>-#&#123;<span class=\"variable\">$pos</span>&#125;: <span class=\"number\">1px</span> solid red;  <span class=\"comment\">//拼字符串(#&#123;$var&#125;)</span></span><br><span class=\"line\">    <span class=\"attribute\">font</span>: #&#123;<span class=\"variable\">$fs</span>&#125;/#&#123;lh&#125; sans-serif;  <span class=\"comment\">//复杂属性值(#&#123;$var&#125;)</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.bb</span> &#123;</span><br><span class=\"line\">    <span class=\"variable\">$width</span>: <span class=\"number\">3px</span> !global;           <span class=\"comment\">//覆盖全局变量</span></span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"variable\">$width</span> + <span class=\"variable\">$width2</span>;       <span class=\"comment\">//用于计算($var + $var)</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">@<span class=\"keyword\">mixin</span> link-style(<span class=\"variable\">$sel</span>) &#123;</span><br><span class=\"line\">    <span class=\"selector-tag\">li</span> #&#123;<span class=\"variable\">$sel</span>&#125; &#123;                  <span class=\"comment\">//作为选择器(#&#123;$var&#125;)</span></span><br><span class=\"line\">        <span class=\"attribute\">color</span>: red;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">@<span class=\"keyword\">include</span> link-style(<span class=\"string\">\"a\"</span>);</span><br></pre></td></tr></table></figure><h2 id=\"嵌套\"><a href=\"#嵌套\" class=\"headerlink\" title=\"嵌套\"></a>嵌套</h2><figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 选择器嵌套</span></span><br><span class=\"line\"><span class=\"selector-tag\">div</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: red;</span><br><span class=\"line\">    <span class=\"selector-tag\">p</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">color</span>: green;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    &amp;:hover &#123;     <span class=\"comment\">//使用 &amp; 表示在嵌套中对父元素的引用</span></span><br><span class=\"line\">        <span class=\"attribute\">color</span>: blue;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    @at-root .d &#123;  <span class=\"comment\">//选择器嵌套多层后让某个选择器跳出根元素</span></span><br><span class=\"line\">        <span class=\"attribute\">color</span>: green;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125; </span><br><span class=\"line\"><span class=\"comment\">// 属性嵌套</span></span><br><span class=\"line\"><span class=\"selector-class\">.div</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: &#123;   //嵌套属性后须写冒号</span><br><span class=\"line\">      style: solid;</span><br><span class=\"line\">      <span class=\"attribute\">left</span>: &#123;</span><br><span class=\"line\">        width: <span class=\"number\">4px</span>;</span><br><span class=\"line\">        <span class=\"attribute\">color</span>: <span class=\"number\">#888</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"混合宏-mixin\"><a href=\"#混合宏-mixin\" class=\"headerlink\" title=\"混合宏 @mixin\"></a>混合宏 <code>@mixin</code></h2><ul><li>@mixin 定义可重用的代码段，@include 调用</li></ul><figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 无参 </span></span><br><span class=\"line\">@<span class=\"keyword\">mixin</span> aa &#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.bb</span> &#123;</span><br><span class=\"line\">    @<span class=\"keyword\">include</span> aa;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 参数为数组 </span></span><br><span class=\"line\"><span class=\"variable\">$margin</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\"><span class=\"variable\">$left</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">@<span class=\"keyword\">mixin</span> aa(<span class=\"variable\">$left</span>, <span class=\"variable\">$margin</span>) &#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: <span class=\"variable\">$margin</span>;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"variable\">$left</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.bb</span> &#123;</span><br><span class=\"line\">    @<span class=\"keyword\">include</span> aa(<span class=\"variable\">$left</span>, <span class=\"variable\">$margin</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 参数为对象 </span></span><br><span class=\"line\"><span class=\"variable\">$map</span>: (left: <span class=\"number\">10px</span>, width: <span class=\"number\">100px</span>);</span><br><span class=\"line\">@<span class=\"keyword\">mixin</span> aa(<span class=\"variable\">$left</span>, <span class=\"variable\">$width</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 接收参数为key值</span></span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"variable\">$left</span>;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"variable\">$width</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-tag\">div</span> &#123;</span><br><span class=\"line\">    @<span class=\"keyword\">include</span> aa(<span class=\"variable\">$map</span>...); <span class=\"comment\">// 传递参数为对象名+...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 默认参数(不传参数时会用默认参数)</span></span><br><span class=\"line\">@<span class=\"keyword\">mixin</span> aa(<span class=\"variable\">$left</span>: 10px) &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 不定参数 </span></span><br><span class=\"line\">@<span class=\"keyword\">mixin</span> box-shadow(<span class=\"variable\">$shadows</span>...) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//不定参数,用...</span></span><br><span class=\"line\">    -moz-<span class=\"attribute\">box-shadow</span>: <span class=\"variable\">$shadows</span>;</span><br><span class=\"line\">    -webkit-<span class=\"attribute\">box-shadow</span>: <span class=\"variable\">$shadows</span>;</span><br><span class=\"line\">    <span class=\"attribute\">box-shadow</span>: <span class=\"variable\">$shadows</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.shadows</span> &#123;</span><br><span class=\"line\">    @<span class=\"keyword\">include</span> box-shadow(<span class=\"number\">2px</span> 2px 2px <span class=\"number\">#eee</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 浏览器前缀设置 </span></span><br><span class=\"line\">@<span class=\"keyword\">mixin</span> rounded(<span class=\"variable\">$vert</span>, <span class=\"variable\">$horz</span>, <span class=\"variable\">$radius</span>: 10px) &#123;</span><br><span class=\"line\">    <span class=\"attribute\">border</span>-#&#123;<span class=\"variable\">$vert</span>&#125;-#&#123;<span class=\"variable\">$horz</span>&#125;-radius: <span class=\"variable\">$radius</span>;</span><br><span class=\"line\">    -moz-<span class=\"attribute\">border-radius</span>-#&#123;<span class=\"variable\">$vert</span>&#125;#&#123;<span class=\"variable\">$horz</span>&#125;: <span class=\"variable\">$radius</span>;</span><br><span class=\"line\">    -webkit-<span class=\"attribute\">border</span>-#&#123;<span class=\"variable\">$vert</span>&#125;-#&#123;<span class=\"variable\">$horz</span>&#125;-radius: <span class=\"variable\">$radius</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-id\">#navbar</span> <span class=\"selector-tag\">li</span> &#123;</span><br><span class=\"line\">    @<span class=\"keyword\">include</span> rounded(top, left);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-id\">#footer</span> &#123;</span><br><span class=\"line\">    @<span class=\"keyword\">include</span> rounded(top, left, 5px);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"继承-extend\"><a href=\"#继承-extend\" class=\"headerlink\" title=\"继承 @extend\"></a>继承 <code>@extend</code></h2><ul><li>不管是否调用，基类的样式都将会出现在编译出来的 CSS 代码中</li></ul><figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.btn</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: inline-block;</span><br><span class=\"line\">  <span class=\"attribute\">margin</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">5px</span> <span class=\"number\">15px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.btn-bor</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#ccc</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.btn-red</span> &#123;</span><br><span class=\"line\">  @<span class=\"keyword\">extend</span> .btn; <span class=\"comment\">//多个扩展</span></span><br><span class=\"line\">  @<span class=\"keyword\">extend</span> .btn-bor !optional; </span><br><span class=\"line\">  <span class=\"comment\">// 用optional直接跳过空样式,防止元素不存在而导致报错</span></span><br><span class=\"line\">  <span class=\"attribute\">border-color</span>: red;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.hoverlink</span> &#123;</span><br><span class=\"line\">  @<span class=\"keyword\">extend</span> a:hover;   <span class=\"comment\">//@extend可扩展任何选择器</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-tag\">a</span>:hover &#123;</span><br><span class=\"line\">  <span class=\"attribute\">text-decoration</span>: underline;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 配合占位选择器(%扩展单一选择器,编译后不在css)使用</span></span><br><span class=\"line\"><span class=\"selector-class\">.container</span> <span class=\"selector-tag\">div</span>%box &#123;</span><br><span class=\"line\">  -webkit-<span class=\"attribute\">box-sizing</span>: border-box;</span><br><span class=\"line\">  -moz-<span class=\"attribute\">box-sizing</span>: border-box;</span><br><span class=\"line\">  <span class=\"attribute\">box-sizing</span>: border-box;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.bor-box</span> &#123;</span><br><span class=\"line\">  @<span class=\"keyword\">extend</span> %box; <span class=\"comment\">//此时才会编译产生</span></span><br><span class=\"line\">&#125; </span><br><span class=\"line\"><span class=\"comment\">//编译为 .container div.bor-box &#123; &#125;</span></span><br></pre></td></tr></table></figure><h2 id=\"占位符-placeholder\"><a href=\"#占位符-placeholder\" class=\"headerlink\" title=\"占位符 %placeholder\"></a>占位符 <code>%placeholder</code></h2><ul><li>一个独立定义的声明块，不调用时不会编译生成 CSS</li></ul><figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">%mt&#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin-top</span>: <span class=\"number\">5px</span>;  </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.block</span> &#123;</span><br><span class=\"line\">    @<span class=\"keyword\">extend</span> %mt;</span><br><span class=\"line\">    <span class=\"selector-tag\">span</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">display</span>:block;</span><br><span class=\"line\">        @<span class=\"keyword\">extend</span> %mt;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.header</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: orange;</span><br><span class=\"line\">    @<span class=\"keyword\">extend</span> %mt;</span><br><span class=\"line\">    <span class=\"selector-tag\">span</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">display</span>:block;</span><br><span class=\"line\">        @<span class=\"keyword\">extend</span> %mt;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h1 id=\"三、Scss-进阶语法\"><a href=\"#三、Scss-进阶语法\" class=\"headerlink\" title=\"三、Scss 进阶语法\"></a>三、Scss 进阶语法</h1><h2 id=\"条件判断\"><a href=\"#条件判断\" class=\"headerlink\" title=\"条件判断\"></a>条件判断</h2><ul><li>可单独使用或结合 @else (if) 使用</li><li>使用 not/or/and 分别表示非/或/与，如 @if not($var)</li><li>使用 !=/== 分别表示(不)等于，如 @if $a !=0</li></ul><figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"keyword\">mixin</span> blockOrHidden(<span class=\"variable\">$boolean</span>:true) &#123;</span><br><span class=\"line\">    @<span class=\"keyword\">if</span> <span class=\"variable\">$boolean</span> &#123;</span><br><span class=\"line\">      @<span class=\"keyword\">debug</span> <span class=\"string\">\"$boolean is #&#123;$boolean&#125;\"</span>;</span><br><span class=\"line\">      <span class=\"attribute\">display</span>: block; <span class=\"comment\">//参数为真，显示</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    @<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      @<span class=\"keyword\">debug</span> <span class=\"string\">\"$boolean is #&#123;$boolean&#125;\"</span>;</span><br><span class=\"line\">      <span class=\"attribute\">display</span>: none; <span class=\"comment\">//参数为假，不显示</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.block</span> &#123;</span><br><span class=\"line\">    @<span class=\"keyword\">include</span> blockOrHidden;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.hidden</span> &#123;</span><br><span class=\"line\">    @<span class=\"keyword\">include</span> blockOrHidden(false);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"循环-list-map\"><a href=\"#循环-list-map\" class=\"headerlink\" title=\"循环 list/map\"></a>循环 list/map</h2><figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// list(用空格/逗号隔开项):</span></span><br><span class=\"line\"><span class=\"variable\">$name</span>: <span class=\"string\">\"a\"</span>, <span class=\"string\">\"b\"</span>;</span><br><span class=\"line\"><span class=\"variable\">$px</span>: <span class=\"number\">5px</span> <span class=\"number\">10px</span> <span class=\"number\">15px</span> <span class=\"number\">20px</span>; </span><br><span class=\"line\"><span class=\"variable\">$sel2</span>: (sel1: <span class=\"string\">\"span\"</span>, sel2: <span class=\"string\">\"div\"</span>) </span><br><span class=\"line\"></span><br><span class=\"line\">// Map</span><br><span class=\"line\"><span class=\"variable\">$map</span>: (key1: <span class=\"number\">1</span>, key2: <span class=\"number\">2</span>, key3: <span class=\"number\">3</span>);</span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"comment\">// for循环</span></span><br><span class=\"line\">@<span class=\"keyword\">for</span> <span class=\"variable\">$var</span> from &lt;start&gt; through &lt;end&gt; // 包含end值</span><br><span class=\"line\">@<span class=\"keyword\">for</span> <span class=\"variable\">$var</span> from &lt;start&gt; to &lt;end&gt;      // 不包含end值</span><br><span class=\"line\">  </span><br><span class=\"line\">// each循环:</span><br><span class=\"line\">@<span class=\"keyword\">each</span> <span class=\"variable\">$var</span> in list/map</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">// while</span><br><span class=\"line\"><span class=\"variable\">$i</span>: 2;</span><br><span class=\"line\">@<span class=\"keyword\">while</span> <span class=\"variable\">$i</span>&gt;<span class=\"number\">0</span> &#123;   \t<span class=\"comment\">// 条件为 true 就会执行</span></span><br><span class=\"line\">    <span class=\"selector-class\">.color</span>#&#123;<span class=\"variable\">$i</span>&#125; &#123;</span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#222</span> * <span class=\"variable\">$i</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable\">$i</span>:<span class=\"variable\">$i</span> - <span class=\"number\">1</span>;     <span class=\"comment\">// 不能写成 $i:$i-1，因为会被当成字符串</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// for循环 </span></span><br><span class=\"line\"><span class=\"variable\">$arr</span>: ( (theme: dark, size: <span class=\"number\">40px</span>), </span><br><span class=\"line\">    (theme: light, size: <span class=\"number\">32px</span>)</span><br><span class=\"line\">);</span><br><span class=\"line\">@<span class=\"keyword\">for</span> <span class=\"variable\">$i</span> from 1 through length(<span class=\"variable\">$arr</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$item</span>: nth(<span class=\"variable\">$arr</span>, <span class=\"variable\">$i</span>);           <span class=\"comment\">// 获取数组中第i项的值</span></span><br><span class=\"line\">    .#&#123;<span class=\"selector-tag\">map</span>-get(<span class=\"variable\">$item</span>, theme)&#125; &#123;</span><br><span class=\"line\">      <span class=\"attribute\">width</span>: map-get(<span class=\"variable\">$item</span>, size);  <span class=\"comment\">// 获取指定键值</span></span><br><span class=\"line\">      <span class=\"attribute\">height</span>: map-get(<span class=\"variable\">$item</span>, size);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// each循环</span></span><br><span class=\"line\"><span class=\"variable\">$margins</span>: <span class=\"number\">5px</span> <span class=\"number\">10px</span>, <span class=\"number\">15px</span> <span class=\"number\">20px</span>;    <span class=\"comment\">// 两个项</span></span><br><span class=\"line\"><span class=\"selector-tag\">div</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: nth(<span class=\"variable\">$margins</span>, <span class=\"number\">1</span>) nth(<span class=\"variable\">$margins</span>, <span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"attribute\">padding</span>: nth(<span class=\"variable\">$margins</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"variable\">$sel2</span>: (sel1: <span class=\"string\">\"span\"</span>, sel2: <span class=\"string\">\"div\"</span>);  <span class=\"comment\">// Map形式</span></span><br><span class=\"line\">@<span class=\"keyword\">each</span> <span class=\"variable\">$s</span> in <span class=\"variable\">$sel2</span> &#123;</span><br><span class=\"line\">    .#&#123;<span class=\"variable\">$s</span>&#125; &#123;</span><br><span class=\"line\">      <span class=\"attribute\">width</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"variable\">$headers</span>: (h1:<span class=\"number\">2em</span>, h2:<span class=\"number\">1.5em</span>, h3:<span class=\"number\">1.2em</span>);</span><br><span class=\"line\">@<span class=\"keyword\">each</span> <span class=\"variable\">$header</span>, <span class=\"variable\">$size</span> in <span class=\"variable\">$headers</span> &#123;</span><br><span class=\"line\">    #&#123;<span class=\"variable\">$header</span>&#125; &#123;</span><br><span class=\"line\">        <span class=\"attribute\">font-size</span>: <span class=\"variable\">$size</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"函数和运算\"><a href=\"#函数和运算\" class=\"headerlink\" title=\"函数和运算\"></a>函数和运算</h2><ol><li>自定义<ul><li>@fuction 定义，@return 返回结果</li></ul></li><li>三元条件<ul><li>if($condition, $if-true, $if-false)：条件成立时返回值1，否则返回值2</li></ul></li><li>颜色<ul><li>rgb/rgba()：创建颜色</li><li>alpha/opacity($color)：获取颜色透明度值</li><li>rgba($color, $alpha)：改变颜色透明度值</li><li>mix($color1, $color2, [$weight])：混合颜色</li><li>lighten/darken($color, $percent)：变浅/加深</li></ul></li><li>数字<ul><li>random()：随机数</li><li>min/max($nums…)：最小值/最大值</li><li>floor/ceil($value)：向下/上整数</li><li>percentage/abs/round($val)：百分比值/绝对值/取整</li></ul></li><li>字符串<ul><li>quote/unquote($string)：给字符串添加/删除引号</li><li>to-upper/lower-case()：字符串大小写字母转换</li></ul></li><li>List<ul><li>length($list)：获取长度</li><li>nth($list, i)：获取列表项（索引i从1开始）</li><li>append($px, 11px)：添加新值</li><li>join($list1, $list2)：列表合并</li><li>zip($lists…)：合并多个表为多维列表<ul><li>index($list, $value)：返回该值在列表中的索引</li></ul></li></ul></li><li>Map<ul><li>map-keys/values($map)：获取所有key/values</li><li>map-get/remove($map, key)：获取/删除指定项</li><li>map-has-key($map, key)：判断是否有key</li><li>map-merge($map1, $map2)：合并map<ul><li>keywords($args)：返回函数参数(可动态设置key和value)</li></ul></li></ul></li><li>Introspection<ul><li>type-of($value)：返回值的类型</li><li>unit($number)：返回值的单位</li><li>unitless($number)：判断该值是否带有单位</li><li>commparable($num, $num)：判断两个值是否可做加减和合并</li></ul></li></ol><figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@function colors(<span class=\"variable\">$color</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$names</span>: map-keys(<span class=\"variable\">$social-colors</span>);</span><br><span class=\"line\">    @<span class=\"keyword\">if</span> not index(<span class=\"variable\">$names</span>, <span class=\"variable\">$color</span>) &#123;</span><br><span class=\"line\">        @<span class=\"keyword\">warn</span> <span class=\"string\">\"Waring: `#&#123;$color&#125; is not a valid color name.`\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    @return map-get(<span class=\"variable\">$social-colors</span>, <span class=\"variable\">$color</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.btn-weibo</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: colors(weibo);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$social-colors</span>: (</span><br><span class=\"line\">    dribble: <span class=\"number\">#ea4c89</span>,</span><br><span class=\"line\">    facebook: <span class=\"number\">#3b5998</span>,</span><br><span class=\"line\">    github: <span class=\"number\">#171515</span>,</span><br><span class=\"line\">    google: <span class=\"number\">#db4437</span>,</span><br><span class=\"line\">    twitter: <span class=\"number\">#55acee</span></span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">@<span class=\"keyword\">each</span> <span class=\"variable\">$name</span> in map-keys(<span class=\"variable\">$social-colors</span>) &#123;</span><br><span class=\"line\">    <span class=\"selector-class\">.btn-</span>#&#123;<span class=\"variable\">$name</span>&#125; &#123;</span><br><span class=\"line\">        <span class=\"attribute\">color</span>: colors(<span class=\"variable\">$name</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@<span class=\"keyword\">for</span> <span class=\"variable\">$i</span> from 1 through length(map-keys(<span class=\"variable\">$social-colors</span>)) &#123;</span><br><span class=\"line\">    <span class=\"selector-class\">.btn-</span>#&#123;nth(<span class=\"selector-tag\">map</span>-keys(<span class=\"variable\">$social-colors</span>), <span class=\"variable\">$i</span>)&#125; &#123;</span><br><span class=\"line\">        <span class=\"attribute\">color</span>: colors(nth(map-keys(<span class=\"variable\">$social-colors</span>), <span class=\"variable\">$i</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"调试\"><a href=\"#调试\" class=\"headerlink\" title=\"调试\"></a>调试</h2><figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 类似于控制台输出信息</span></span><br><span class=\"line\">@<span class=\"keyword\">debug</span> <span class=\"string\">'This is adebug'</span>;</span><br><span class=\"line\">@<span class=\"keyword\">warn</span> <span class=\"string\">'Warn'</span>;</span><br><span class=\"line\">@error <span class=\"string\">'Error'</span>;</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->"},{"title":"移动端基础","top":false,"keywords":["移动端"],"date":"2019-04-18T18:03:23.000Z","description":"开发模式、Viewport 视口、布局方案、适配方案","_content":"\n# 一、开发模式\n\n  <div align=\"center\">\n    <!-- mobile-type.png -->\n    ![Mobile Mode](images/mobile/mode.png)\n  </div> \n\n## Native App\n> 移动端的原生应用\n\n  * 实现：基于手机操作系统 API 并使用原生语言编写\n  * 优点\n    * 支持离线运行\n    * 能够访问智能设备提供的所有功能\n    * 更好的运行速度，性能和总体用户体验\n    * 支持丰富的图形，动画和更好的渲染效果\n  * 缺点\n    * 开发成本较高：同一个项目至少需要 Android、iOS、Web 三个开发团队\n    * 维护、更新成本高：需要所有用户重新下载安装\n\n\n## Web App\n> 移动端的 Web 浏览器，注意 PC Web 运行在 Windows、Linux \n\n  * 实现：基于 Html5 实现并运行在 iOS/Android\n  * 优点\n    * 开发成本较低\n    * 适用范围广，跨平台\n    * 可以方便、快速地部署\n    * 维护成本低：用户可以随时访问最新版本而不需要下载更新\n  * 缺点\n    * 图形和动画渲染效果差\n    * 用户体验差：加载慢、费流量\n    * 不能调用系统相关功能：相机、GPS等\n\n\n## Hybrid App\n> 混合 App，兼具 Native App 良好用户交互体验、Web App 跨平台开发的优势\n\n  * 实现：使用原生语言编写应用的外壳，然后在其中内嵌网页语言编写的内容信息\n  * 优点\n    * 部分支持离线功能\n    * 维护、更新较为方便\n    * 可调用智能设备相关功能\n  * 缺点\n    * 用户体验较差\n    * 图形和动画渲染效果较差\n\n\n# 二、基础知识\n\n## 像素\n  * 物理像素\n    * 单位：dp，获取方法为 window.screen.width/height\n    * 特点\n      * 屏幕分辨率表示设备屏幕上的物理像素个数\n      * 同一个设备上，1dp 代表的物理长度是固定不变的\n      * 不同设备之间，1dp 代表的物理长度是可以不同的\n  * 逻辑像素\n    * 单位：px\n    * 特点\n      * 改变大小的场景：缩放屏幕、更换设备\n      * 它与物理像素之间的比例关系取决于 屏幕特性（是否高清屏）和用户设置的缩放比例，由浏览器自行换算\n  * 换算关系\n    * dpr：物理像素与CSS像素的比例\n    * 关系：1px = (dpr)^2 * dp\n\n\n## Viewport\n  <div style=\"text-indent: 2em\">PC 端网站都是以浏览器窗口(设备屏幕) 作为视口进行布局。但是在移动端，网站的布局视口默认比移动端屏幕宽很多，浏览器为了将页面完整显示出来而会将页面缩小至浏览器窗口中，页面内容看起来被压扁，因此引入了 viewport 视口的概念来解决移动端的页面展示问题。</div>\n\n\n### layout viewport  \n> 布局视口，获取方法为 document.documentElement.clientWidth/clientHeight\n\n  * 默认比移动端屏幕宽很多，而 CSS 页面布局是根据布局视口来计算的\n  * 浏览器为了将页面在浏览器窗口中完整地显示出来，会将页面压扁\n  * 通过 meta 标签设置 `布局视口宽度 = 浏览器窗口宽度` 之后，页面就会正常显示\n\n\n### visual viewport\n> 视觉视口\n\n  * 用户当前看到的区域，用户可以通过缩放操作视觉视口，同时不会影响布局视口\n  * 当放大页面时，用户能看到的页面内容在减少，CSS 像素将跨越更多的物理像素\n\n\n### ideal viewport\n> 理想视口\n\n  * 它的宽度等于移动设备的屏幕宽度，和设备的物理宽度无关\n  * 这个理想的宽度是指以 CSS 像素单位计算的，即屏幕的 CSS 像素宽度\n  * 布局视口并不是理想视口，所以需要设置：`布局视口 = 理想视口 = 移动设备屏幕`\n\n\n## meta\n> 移动设备默认的是 布局视口，但是移动端开发时需要的是 理想视口，meta 标签就用于控制视口\n\n  * viewport 标签只对移动端浏览器有效，对 PC 端浏览器是无效的\n  * 当缩放比例为 100% 时，dip 宽度 = CSS 像素宽度 = 理想视口的宽度 = 布局视口的宽度\n  * 即使设置了 user-scalable = no，在 Android Chrome 浏览器中也可以强制启用手动缩放\n  * 单独设置 initial-scale 或 width 都会有兼容性问题（横竖屏不分），所以设置布局视口为理想视口的最佳方法是同时设置这两个属性\n\n\n  ```js\n  // 启用360浏览器的极速模式 (webkit)  \n  &lt;meta name=\"renderer\" content=\"webkit\" /&gt;\n\n  // 优先使用 IE 最新版本和 Chrome  \n  &lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=EDGE, chrome=1\" /&gt;\n\n  // 页面窗口自动调整到设备宽度，并禁止用户缩放页面 (scale) \n  &lt;meta name=\"viewport\" content=\"width=device-width, height=device-height, \n  initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no\" /&gt;\n\n  // 使用全屏模式运行，仅针对 ios safari  \n  &lt;meta name=\"apple-mobile-web-app-capable\" content=\"yes\" /&gt;\n  \n  // 设置顶端状态栏背景为灰色半透明，仅针对 ios safari  \n  &lt;meta name=\"apple-mobile-web-app-status-bar-style\" content=\"black-translucent\" /&gt;\n\n  // windows phone 点击无高光 \n  &lt;meta name=\"msapplication-tap-highlight\" content=\"no\" /&gt;\n\n  // 关闭电话号码和邮箱的自动识别  \n  &lt;meta name=\"format-detection\" content=\"telephone=no, email=no\" /&gt;\n  ```\n\n\n## 常用样式\n\n### reset.css\n  ```css\n  html{\n    -webkit-text-size-adjust: none;\n    -webkit-user-select: none;\n    -webkit-touch-callout: none;\n    /* font-family: Helvetica; */\n  }\n  body{\n    font-size: 12px;\n    font-family: -apple-system, BlinkMacSystemFont, \"PingFang SC\",\"Helvetica Neue\",STHeiti,\"Microsoft Yahei\",Tahoma,Simsun,sans-serif;\n  }\n  body,h1,h2,h3,h4,h5,h6,p,dl,dd,ul,ol,pre,form,input,textarea,th,td,select{\n    margin: 0; \n    padding: 0; \n    text-indent: 0;\n    font-weight: normal;\n  }\n  a,button,input,textarea,select{ \n    background: none; \n    outline: none;\n    -webkit-appearance: none;\n    -webkit-tap-highlight-color: rgba(255,0,0,0); \n  }\n  em{\n    font-style: normal\n  }\n  li{\n    list-style: none\n  }\n  a{\n    text-decoration: none;\n  }\n  img{\n    border:none; \n    vertical-align: top;\n  }\n  table{\n    border-collapse: collapse;\n  }\n  textarea{ \n    resize: none; \n    overflow: auto;\n  }\n  ```\n\n\n### 媒体查询\n  ```css\n  /* rem 配置 */\n  html{\n    font-size: 10px\n  }\n  @media screen and (min-width:321px) and (max-width:375px){\n    html{ font-size: 11px }\n  }\n  @media screen and (min-width:376px) and (max-width:414px){\n    html{ font-size: 12px }\n  }\n  @media screen and (min-width:415px) and (max-width:639px){\n    html{ font-size: 15px }\n  }\n  @media screen and (min-width:640px) and (max-width:719px){\n    html{ font-size: 20px }\n  }\n  @media screen and (min-width:720px) and (max-width:749px){\n    html{ font-size: 22.5px }\n  }\n  @media screen and (min-width:750px) and (max-width:799px){\n    html{ font-size: 23.5px }\n  }\n  @media screen and (min-width:800px){\n    html{ font-size: 25px } \n  }\n\n  /* 竖屏时的样式 */\n  @media all and (orientation:portrait){   }\n\n  /* 横屏时的样式 */\n  @media all and (orientation:landscape){   }\n  ```\n\n\n\n### 表单标签\n  ```css\n  /* input placeholder 出现文本位置偏上 */\n  input{\n      line-height: normal;  /* PC 端设置 line-height = height */\n  }\n\n\n  /* 输入框 placeholder 的颜色值改变 */\n  ::-webkit-input-placeholder {  \n      color: #999; \n  }\n  :-moz-placeholder {  \n      color: #999; \n  }\n  ::-moz-placeholder {  \n      color: #999; \n  }\n  :-ms-input-placeholder {  \n      color: #999; \n  }\n  input:focus::-webkit-input-placeholder{ \n      color: #999; \n  }\n\n\n  /* 改变选中内容的背景颜色：字体颜色换成 color 即可 */\n  ::selection { \n      background: #FFF; \n      color: #333; \n  } \n  ::-moz-selection { \n      background: #FFF; \n      color: #333; \n  } \n  ::-webkit-selection { \n      background: #FFF; \n      color: #333; \n  } \n\n\n  /* 禁用 select 默认下拉箭头 */\n  select::-ms-expand {\n      display: none;\n  }\n\n\n  /* 禁用 radio 和 checkbox 默认样式 */\n  input[type=radio]::-ms-check, \n  input[type=checkbox]::-ms-check\n  {\n      display: none;\n  }\n\n\n  /* 禁用表单输入框默认清除按钮 */\n\n  input[type=text]::-ms-clear,\n  input[type=tel]::-ms-clear,\n  input[type=number]::-ms-clear\n  {\n      display: none;\n  }\n\n\n  /* 重置默认外观 */\n  input, select { \n      /* 清除默认内阴影 */\n      -webkit-appearance:none; \n      appearance: none; \n  }\n\n\n  /*禁止winphone默认触摸事件 (e.preventDefault无效)*/\n  html{\n      -ms-touch-action: none;\n  }\n\n\n  /* 解决 -webkit-user-select:none 导致 input/textarea 无法输入  */\n  * {\n      -webkit-box-sizing: border-box;\n      -moz-box-sizing: border-box;\n      box-sizing: border-box;\n      -webkit-tap-highlight-color: transparent; \n      /* 当用户点击 iOS Safari 的链接或 Js 的可点击元素时，覆盖显示的高亮颜色。*/\n      outline: none;\n  }\n  *:not(input,textarea) { \n      -webkit-touch-callout: none; \n      /* 触摸并按住触摸目标时，禁止或显示系统默认菜单 */\n      -webkit-user-select: none; \n  }\n  ```\n\n\n### 其它标签\n  ```css\n  /* 禁用长按选中、复制文本功能 */\n  * {\n      -webkit-touch-callout: none;\n      -webkit-user-select: none;\n      -khtml-user-select: none;\n      -moz-user-select: none;\n      -ms-user-select: none;\n      user-select: none;\n  }\n\n\n  /* 取消 a 标签在移动端点击时的蓝色 */\n  a{\n      -webkit-tap-highlight-color: rgba(255, 255, 255, 0);\n      -webkit-user-select: none;\n      -moz-user-focus: none;\n      -moz-user-select: none;\n  }\n\n\n  /* 使用图片作为 a 的点击按钮时，触发 touchstart 时总有一个灰色背景 */\n  a,a:hover,a:active,a:visited,a:link,a:focus{\n      -webkit-tap-highlight-color:rgba(0,0,0,0);\n      -webkit-tap-highlight-color: transparent;\n      outline:none;\n      background: none;\n      text-decoration: none;\n  }\n\n\n  /* 模拟按钮 hover 效果 */\n  .btn-blue {\n      display: block;\n      height: 42px;\n      line-height: 42px;\n      text-align: center;\n      border-radius: 4px;\n      font-size: 18px;\n      color: #FFF;\n      background-color: #4185F3;\n  }\n  .btn-blue:active{\n      background-color: #357AE8;\n  }\n\n\n  /*\n    active 兼容处理：:active 伪类失效\n \n    法一：body ontouchstart=\"fn\"\n    法二：document.addEventListener(\"touchstart\", fn, false)\n  */\n\n\n  /*\n      同等比例的图片在 PC 端很清楚，但在手机上有些设备会模糊。这是因为手机分辨率太小，\n      解决方案是使用元素宽高两倍的背景图而非 img 标签\n  */\n  div{\n      background: url(../images/icon.png) no-repeat center center;\n      -webkit-background-size: 50px 50px;\n      background-size: 50px 50px;\n      display: inline-block; \n\n      background-size: contain;\n      /* 或  width: 100%;  height: 50px; */\n  }\n\n\n  /* overflow: scroll 时上下拉动滚动条时卡顿、慢 */\n  body {\n    /* 法一： CSS3新属性 */\n    -webkit-overflow-scrolling: touch;\n\n    /* 法二 */\n    overflow-x: hidden;  \n    \n    /* 法三：去掉 body/html 的 height: 100%  */\n  }\n\n\n  /* IOS 滚动不平滑的问题 */\n  div{\n      /* 手指移开触摸屏滚动一段时间 */\n      -webkit-overflow-scrolling: touch;  \n\n      /* 手指移开触摸屏立即停止滚动 */\n      -webkit-overflow-scrolling: auto;   \n  }\n  ```\n\n\n \n# 三、优化方案\n\n  * 不滥用 Float：渲染页面时计算量比较大\n  * 不滥用 Web 字体：需要下载、解析、重绘当前页面\n  * 不声明过多的 Font-size：会影响 CSS 树的效率\n  * 减少重绘和回流\n    * 减少 drawImage\n    * 避免不必要的 DOM 操作\n    * 避免使用 document.write\n    * 尽量改变 class 而不是 Style\n  * 动画优化\n    * 尽量使用 CSS3 动画：5 个以内的元素时\n    * 适当使用 Canvas 动画：5 个以上元素时\n    * 合理使用 requestAnimationFrame 动画代替 setTimeout\n  * GPU 加速\n    * 注意过渡使用会引发手机过耗电增加\n    * 触发 GPU 渲染：transitions、3D transforms、Opacity、Canvas、WebGL、Video\n    \n\n  <div align=\"center\"> \n    ![移动端优化](images/mobile/optimization.png) \n  </div>\n\n\n \n\n\n\n\n\n","source":"_posts/22-移动端基础.md","raw":"---\ntitle: 移动端基础\ntags:\n  - 移动端\ncategories: 移动端\ntop: false\nkeywords:\n  - 移动端\ndate: 2019-04-19 02:03:23\ndescription: 开发模式、Viewport 视口、布局方案、适配方案\n---\n\n# 一、开发模式\n\n  <div align=\"center\">\n    <!-- mobile-type.png -->\n    ![Mobile Mode](images/mobile/mode.png)\n  </div> \n\n## Native App\n> 移动端的原生应用\n\n  * 实现：基于手机操作系统 API 并使用原生语言编写\n  * 优点\n    * 支持离线运行\n    * 能够访问智能设备提供的所有功能\n    * 更好的运行速度，性能和总体用户体验\n    * 支持丰富的图形，动画和更好的渲染效果\n  * 缺点\n    * 开发成本较高：同一个项目至少需要 Android、iOS、Web 三个开发团队\n    * 维护、更新成本高：需要所有用户重新下载安装\n\n\n## Web App\n> 移动端的 Web 浏览器，注意 PC Web 运行在 Windows、Linux \n\n  * 实现：基于 Html5 实现并运行在 iOS/Android\n  * 优点\n    * 开发成本较低\n    * 适用范围广，跨平台\n    * 可以方便、快速地部署\n    * 维护成本低：用户可以随时访问最新版本而不需要下载更新\n  * 缺点\n    * 图形和动画渲染效果差\n    * 用户体验差：加载慢、费流量\n    * 不能调用系统相关功能：相机、GPS等\n\n\n## Hybrid App\n> 混合 App，兼具 Native App 良好用户交互体验、Web App 跨平台开发的优势\n\n  * 实现：使用原生语言编写应用的外壳，然后在其中内嵌网页语言编写的内容信息\n  * 优点\n    * 部分支持离线功能\n    * 维护、更新较为方便\n    * 可调用智能设备相关功能\n  * 缺点\n    * 用户体验较差\n    * 图形和动画渲染效果较差\n\n\n# 二、基础知识\n\n## 像素\n  * 物理像素\n    * 单位：dp，获取方法为 window.screen.width/height\n    * 特点\n      * 屏幕分辨率表示设备屏幕上的物理像素个数\n      * 同一个设备上，1dp 代表的物理长度是固定不变的\n      * 不同设备之间，1dp 代表的物理长度是可以不同的\n  * 逻辑像素\n    * 单位：px\n    * 特点\n      * 改变大小的场景：缩放屏幕、更换设备\n      * 它与物理像素之间的比例关系取决于 屏幕特性（是否高清屏）和用户设置的缩放比例，由浏览器自行换算\n  * 换算关系\n    * dpr：物理像素与CSS像素的比例\n    * 关系：1px = (dpr)^2 * dp\n\n\n## Viewport\n  <div style=\"text-indent: 2em\">PC 端网站都是以浏览器窗口(设备屏幕) 作为视口进行布局。但是在移动端，网站的布局视口默认比移动端屏幕宽很多，浏览器为了将页面完整显示出来而会将页面缩小至浏览器窗口中，页面内容看起来被压扁，因此引入了 viewport 视口的概念来解决移动端的页面展示问题。</div>\n\n\n### layout viewport  \n> 布局视口，获取方法为 document.documentElement.clientWidth/clientHeight\n\n  * 默认比移动端屏幕宽很多，而 CSS 页面布局是根据布局视口来计算的\n  * 浏览器为了将页面在浏览器窗口中完整地显示出来，会将页面压扁\n  * 通过 meta 标签设置 `布局视口宽度 = 浏览器窗口宽度` 之后，页面就会正常显示\n\n\n### visual viewport\n> 视觉视口\n\n  * 用户当前看到的区域，用户可以通过缩放操作视觉视口，同时不会影响布局视口\n  * 当放大页面时，用户能看到的页面内容在减少，CSS 像素将跨越更多的物理像素\n\n\n### ideal viewport\n> 理想视口\n\n  * 它的宽度等于移动设备的屏幕宽度，和设备的物理宽度无关\n  * 这个理想的宽度是指以 CSS 像素单位计算的，即屏幕的 CSS 像素宽度\n  * 布局视口并不是理想视口，所以需要设置：`布局视口 = 理想视口 = 移动设备屏幕`\n\n\n## meta\n> 移动设备默认的是 布局视口，但是移动端开发时需要的是 理想视口，meta 标签就用于控制视口\n\n  * viewport 标签只对移动端浏览器有效，对 PC 端浏览器是无效的\n  * 当缩放比例为 100% 时，dip 宽度 = CSS 像素宽度 = 理想视口的宽度 = 布局视口的宽度\n  * 即使设置了 user-scalable = no，在 Android Chrome 浏览器中也可以强制启用手动缩放\n  * 单独设置 initial-scale 或 width 都会有兼容性问题（横竖屏不分），所以设置布局视口为理想视口的最佳方法是同时设置这两个属性\n\n\n  ```js\n  // 启用360浏览器的极速模式 (webkit)  \n  &lt;meta name=\"renderer\" content=\"webkit\" /&gt;\n\n  // 优先使用 IE 最新版本和 Chrome  \n  &lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=EDGE, chrome=1\" /&gt;\n\n  // 页面窗口自动调整到设备宽度，并禁止用户缩放页面 (scale) \n  &lt;meta name=\"viewport\" content=\"width=device-width, height=device-height, \n  initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no\" /&gt;\n\n  // 使用全屏模式运行，仅针对 ios safari  \n  &lt;meta name=\"apple-mobile-web-app-capable\" content=\"yes\" /&gt;\n  \n  // 设置顶端状态栏背景为灰色半透明，仅针对 ios safari  \n  &lt;meta name=\"apple-mobile-web-app-status-bar-style\" content=\"black-translucent\" /&gt;\n\n  // windows phone 点击无高光 \n  &lt;meta name=\"msapplication-tap-highlight\" content=\"no\" /&gt;\n\n  // 关闭电话号码和邮箱的自动识别  \n  &lt;meta name=\"format-detection\" content=\"telephone=no, email=no\" /&gt;\n  ```\n\n\n## 常用样式\n\n### reset.css\n  ```css\n  html{\n    -webkit-text-size-adjust: none;\n    -webkit-user-select: none;\n    -webkit-touch-callout: none;\n    /* font-family: Helvetica; */\n  }\n  body{\n    font-size: 12px;\n    font-family: -apple-system, BlinkMacSystemFont, \"PingFang SC\",\"Helvetica Neue\",STHeiti,\"Microsoft Yahei\",Tahoma,Simsun,sans-serif;\n  }\n  body,h1,h2,h3,h4,h5,h6,p,dl,dd,ul,ol,pre,form,input,textarea,th,td,select{\n    margin: 0; \n    padding: 0; \n    text-indent: 0;\n    font-weight: normal;\n  }\n  a,button,input,textarea,select{ \n    background: none; \n    outline: none;\n    -webkit-appearance: none;\n    -webkit-tap-highlight-color: rgba(255,0,0,0); \n  }\n  em{\n    font-style: normal\n  }\n  li{\n    list-style: none\n  }\n  a{\n    text-decoration: none;\n  }\n  img{\n    border:none; \n    vertical-align: top;\n  }\n  table{\n    border-collapse: collapse;\n  }\n  textarea{ \n    resize: none; \n    overflow: auto;\n  }\n  ```\n\n\n### 媒体查询\n  ```css\n  /* rem 配置 */\n  html{\n    font-size: 10px\n  }\n  @media screen and (min-width:321px) and (max-width:375px){\n    html{ font-size: 11px }\n  }\n  @media screen and (min-width:376px) and (max-width:414px){\n    html{ font-size: 12px }\n  }\n  @media screen and (min-width:415px) and (max-width:639px){\n    html{ font-size: 15px }\n  }\n  @media screen and (min-width:640px) and (max-width:719px){\n    html{ font-size: 20px }\n  }\n  @media screen and (min-width:720px) and (max-width:749px){\n    html{ font-size: 22.5px }\n  }\n  @media screen and (min-width:750px) and (max-width:799px){\n    html{ font-size: 23.5px }\n  }\n  @media screen and (min-width:800px){\n    html{ font-size: 25px } \n  }\n\n  /* 竖屏时的样式 */\n  @media all and (orientation:portrait){   }\n\n  /* 横屏时的样式 */\n  @media all and (orientation:landscape){   }\n  ```\n\n\n\n### 表单标签\n  ```css\n  /* input placeholder 出现文本位置偏上 */\n  input{\n      line-height: normal;  /* PC 端设置 line-height = height */\n  }\n\n\n  /* 输入框 placeholder 的颜色值改变 */\n  ::-webkit-input-placeholder {  \n      color: #999; \n  }\n  :-moz-placeholder {  \n      color: #999; \n  }\n  ::-moz-placeholder {  \n      color: #999; \n  }\n  :-ms-input-placeholder {  \n      color: #999; \n  }\n  input:focus::-webkit-input-placeholder{ \n      color: #999; \n  }\n\n\n  /* 改变选中内容的背景颜色：字体颜色换成 color 即可 */\n  ::selection { \n      background: #FFF; \n      color: #333; \n  } \n  ::-moz-selection { \n      background: #FFF; \n      color: #333; \n  } \n  ::-webkit-selection { \n      background: #FFF; \n      color: #333; \n  } \n\n\n  /* 禁用 select 默认下拉箭头 */\n  select::-ms-expand {\n      display: none;\n  }\n\n\n  /* 禁用 radio 和 checkbox 默认样式 */\n  input[type=radio]::-ms-check, \n  input[type=checkbox]::-ms-check\n  {\n      display: none;\n  }\n\n\n  /* 禁用表单输入框默认清除按钮 */\n\n  input[type=text]::-ms-clear,\n  input[type=tel]::-ms-clear,\n  input[type=number]::-ms-clear\n  {\n      display: none;\n  }\n\n\n  /* 重置默认外观 */\n  input, select { \n      /* 清除默认内阴影 */\n      -webkit-appearance:none; \n      appearance: none; \n  }\n\n\n  /*禁止winphone默认触摸事件 (e.preventDefault无效)*/\n  html{\n      -ms-touch-action: none;\n  }\n\n\n  /* 解决 -webkit-user-select:none 导致 input/textarea 无法输入  */\n  * {\n      -webkit-box-sizing: border-box;\n      -moz-box-sizing: border-box;\n      box-sizing: border-box;\n      -webkit-tap-highlight-color: transparent; \n      /* 当用户点击 iOS Safari 的链接或 Js 的可点击元素时，覆盖显示的高亮颜色。*/\n      outline: none;\n  }\n  *:not(input,textarea) { \n      -webkit-touch-callout: none; \n      /* 触摸并按住触摸目标时，禁止或显示系统默认菜单 */\n      -webkit-user-select: none; \n  }\n  ```\n\n\n### 其它标签\n  ```css\n  /* 禁用长按选中、复制文本功能 */\n  * {\n      -webkit-touch-callout: none;\n      -webkit-user-select: none;\n      -khtml-user-select: none;\n      -moz-user-select: none;\n      -ms-user-select: none;\n      user-select: none;\n  }\n\n\n  /* 取消 a 标签在移动端点击时的蓝色 */\n  a{\n      -webkit-tap-highlight-color: rgba(255, 255, 255, 0);\n      -webkit-user-select: none;\n      -moz-user-focus: none;\n      -moz-user-select: none;\n  }\n\n\n  /* 使用图片作为 a 的点击按钮时，触发 touchstart 时总有一个灰色背景 */\n  a,a:hover,a:active,a:visited,a:link,a:focus{\n      -webkit-tap-highlight-color:rgba(0,0,0,0);\n      -webkit-tap-highlight-color: transparent;\n      outline:none;\n      background: none;\n      text-decoration: none;\n  }\n\n\n  /* 模拟按钮 hover 效果 */\n  .btn-blue {\n      display: block;\n      height: 42px;\n      line-height: 42px;\n      text-align: center;\n      border-radius: 4px;\n      font-size: 18px;\n      color: #FFF;\n      background-color: #4185F3;\n  }\n  .btn-blue:active{\n      background-color: #357AE8;\n  }\n\n\n  /*\n    active 兼容处理：:active 伪类失效\n \n    法一：body ontouchstart=\"fn\"\n    法二：document.addEventListener(\"touchstart\", fn, false)\n  */\n\n\n  /*\n      同等比例的图片在 PC 端很清楚，但在手机上有些设备会模糊。这是因为手机分辨率太小，\n      解决方案是使用元素宽高两倍的背景图而非 img 标签\n  */\n  div{\n      background: url(../images/icon.png) no-repeat center center;\n      -webkit-background-size: 50px 50px;\n      background-size: 50px 50px;\n      display: inline-block; \n\n      background-size: contain;\n      /* 或  width: 100%;  height: 50px; */\n  }\n\n\n  /* overflow: scroll 时上下拉动滚动条时卡顿、慢 */\n  body {\n    /* 法一： CSS3新属性 */\n    -webkit-overflow-scrolling: touch;\n\n    /* 法二 */\n    overflow-x: hidden;  \n    \n    /* 法三：去掉 body/html 的 height: 100%  */\n  }\n\n\n  /* IOS 滚动不平滑的问题 */\n  div{\n      /* 手指移开触摸屏滚动一段时间 */\n      -webkit-overflow-scrolling: touch;  \n\n      /* 手指移开触摸屏立即停止滚动 */\n      -webkit-overflow-scrolling: auto;   \n  }\n  ```\n\n\n \n# 三、优化方案\n\n  * 不滥用 Float：渲染页面时计算量比较大\n  * 不滥用 Web 字体：需要下载、解析、重绘当前页面\n  * 不声明过多的 Font-size：会影响 CSS 树的效率\n  * 减少重绘和回流\n    * 减少 drawImage\n    * 避免不必要的 DOM 操作\n    * 避免使用 document.write\n    * 尽量改变 class 而不是 Style\n  * 动画优化\n    * 尽量使用 CSS3 动画：5 个以内的元素时\n    * 适当使用 Canvas 动画：5 个以上元素时\n    * 合理使用 requestAnimationFrame 动画代替 setTimeout\n  * GPU 加速\n    * 注意过渡使用会引发手机过耗电增加\n    * 触发 GPU 渲染：transitions、3D transforms、Opacity、Canvas、WebGL、Video\n    \n\n  <div align=\"center\"> \n    ![移动端优化](images/mobile/optimization.png) \n  </div>\n\n\n \n\n\n\n\n\n","slug":"22-移动端基础","published":1,"updated":"2019-05-10T17:30:03.811Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvid4pj2000i0nbxo49h6o9k","content":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><html><head></head><body><h1 id=\"一、开发模式\"><a href=\"#一、开发模式\" class=\"headerlink\" title=\"一、开发模式\"></a>一、开发模式</h1><div align=\"center\"><br><br><img src=\"images/mobile/mode.png\" alt=\"Mobile Mode\"><br></div><h2 id=\"Native-App\"><a href=\"#Native-App\" class=\"headerlink\" title=\"Native App\"></a>Native App</h2><blockquote><p>移动端的原生应用</p></blockquote><ul><li>实现：基于手机操作系统 API 并使用原生语言编写</li><li>优点<ul><li>支持离线运行</li><li>能够访问智能设备提供的所有功能</li><li>更好的运行速度，性能和总体用户体验</li><li>支持丰富的图形，动画和更好的渲染效果</li></ul></li><li>缺点<ul><li>开发成本较高：同一个项目至少需要 Android、iOS、Web 三个开发团队</li><li>维护、更新成本高：需要所有用户重新下载安装</li></ul></li></ul><h2 id=\"Web-App\"><a href=\"#Web-App\" class=\"headerlink\" title=\"Web App\"></a>Web App</h2><blockquote><p>移动端的 Web 浏览器，注意 PC Web 运行在 Windows、Linux</p></blockquote><ul><li>实现：基于 Html5 实现并运行在 iOS/Android</li><li>优点<ul><li>开发成本较低</li><li>适用范围广，跨平台</li><li>可以方便、快速地部署</li><li>维护成本低：用户可以随时访问最新版本而不需要下载更新</li></ul></li><li>缺点<ul><li>图形和动画渲染效果差</li><li>用户体验差：加载慢、费流量</li><li>不能调用系统相关功能：相机、GPS等</li></ul></li></ul><h2 id=\"Hybrid-App\"><a href=\"#Hybrid-App\" class=\"headerlink\" title=\"Hybrid App\"></a>Hybrid App</h2><blockquote><p>混合 App，兼具 Native App 良好用户交互体验、Web App 跨平台开发的优势</p></blockquote><ul><li>实现：使用原生语言编写应用的外壳，然后在其中内嵌网页语言编写的内容信息</li><li>优点<ul><li>部分支持离线功能</li><li>维护、更新较为方便</li><li>可调用智能设备相关功能</li></ul></li><li>缺点<ul><li>用户体验较差</li><li>图形和动画渲染效果较差</li></ul></li></ul><h1 id=\"二、基础知识\"><a href=\"#二、基础知识\" class=\"headerlink\" title=\"二、基础知识\"></a>二、基础知识</h1><h2 id=\"像素\"><a href=\"#像素\" class=\"headerlink\" title=\"像素\"></a>像素</h2><ul><li>物理像素<ul><li>单位：dp，获取方法为 window.screen.width/height</li><li>特点<ul><li>屏幕分辨率表示设备屏幕上的物理像素个数</li><li>同一个设备上，1dp 代表的物理长度是固定不变的</li><li>不同设备之间，1dp 代表的物理长度是可以不同的</li></ul></li></ul></li><li>逻辑像素<ul><li>单位：px</li><li>特点<ul><li>改变大小的场景：缩放屏幕、更换设备</li><li>它与物理像素之间的比例关系取决于 屏幕特性（是否高清屏）和用户设置的缩放比例，由浏览器自行换算</li></ul></li></ul></li><li>换算关系<ul><li>dpr：物理像素与CSS像素的比例</li><li>关系：1px = (dpr)^2 * dp</li></ul></li></ul><h2 id=\"Viewport\"><a href=\"#Viewport\" class=\"headerlink\" title=\"Viewport\"></a>Viewport</h2><div style=\"text-indent:2em\">PC 端网站都是以浏览器窗口(设备屏幕) 作为视口进行布局。但是在移动端，网站的布局视口默认比移动端屏幕宽很多，浏览器为了将页面完整显示出来而会将页面缩小至浏览器窗口中，页面内容看起来被压扁，因此引入了 viewport 视口的概念来解决移动端的页面展示问题。</div><h3 id=\"layout-viewport\"><a href=\"#layout-viewport\" class=\"headerlink\" title=\"layout viewport\"></a>layout viewport</h3><blockquote><p>布局视口，获取方法为 document.documentElement.clientWidth/clientHeight</p></blockquote><ul><li>默认比移动端屏幕宽很多，而 CSS 页面布局是根据布局视口来计算的</li><li>浏览器为了将页面在浏览器窗口中完整地显示出来，会将页面压扁</li><li>通过 meta 标签设置 <code>布局视口宽度 = 浏览器窗口宽度</code> 之后，页面就会正常显示</li></ul><h3 id=\"visual-viewport\"><a href=\"#visual-viewport\" class=\"headerlink\" title=\"visual viewport\"></a>visual viewport</h3><blockquote><p>视觉视口</p></blockquote><ul><li>用户当前看到的区域，用户可以通过缩放操作视觉视口，同时不会影响布局视口</li><li>当放大页面时，用户能看到的页面内容在减少，CSS 像素将跨越更多的物理像素</li></ul><h3 id=\"ideal-viewport\"><a href=\"#ideal-viewport\" class=\"headerlink\" title=\"ideal viewport\"></a>ideal viewport</h3><blockquote><p>理想视口</p></blockquote><ul><li>它的宽度等于移动设备的屏幕宽度，和设备的物理宽度无关</li><li>这个理想的宽度是指以 CSS 像素单位计算的，即屏幕的 CSS 像素宽度</li><li>布局视口并不是理想视口，所以需要设置：<code>布局视口 = 理想视口 = 移动设备屏幕</code></li></ul><h2 id=\"meta\"><a href=\"#meta\" class=\"headerlink\" title=\"meta\"></a>meta</h2><blockquote><p>移动设备默认的是 布局视口，但是移动端开发时需要的是 理想视口，meta 标签就用于控制视口</p></blockquote><ul><li>viewport 标签只对移动端浏览器有效，对 PC 端浏览器是无效的</li><li>当缩放比例为 100% 时，dip 宽度 = CSS 像素宽度 = 理想视口的宽度 = 布局视口的宽度</li><li>即使设置了 user-scalable = no，在 Android Chrome 浏览器中也可以强制启用手动缩放</li><li>单独设置 initial-scale 或 width 都会有兼容性问题（横竖屏不分），所以设置布局视口为理想视口的最佳方法是同时设置这两个属性</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 启用360浏览器的极速模式 (webkit)  </span></span><br><span class=\"line\">&lt;meta name=<span class=\"string\">\"renderer\"</span> content=<span class=\"string\">\"webkit\"</span> /&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 优先使用 IE 最新版本和 Chrome  </span></span><br><span class=\"line\">&lt;meta http-equiv=<span class=\"string\">\"X-UA-Compatible\"</span> content=<span class=\"string\">\"IE=EDGE, chrome=1\"</span> /&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 页面窗口自动调整到设备宽度，并禁止用户缩放页面 (scale) </span></span><br><span class=\"line\">&lt;meta name=<span class=\"string\">\"viewport\"</span> content=<span class=\"string\">\"width=device-width, height=device-height, </span></span><br><span class=\"line\"><span class=\"string\">initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no\"</span> /&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用全屏模式运行，仅针对 ios safari  </span></span><br><span class=\"line\">&lt;meta name=<span class=\"string\">\"apple-mobile-web-app-capable\"</span> content=<span class=\"string\">\"yes\"</span> /&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 设置顶端状态栏背景为灰色半透明，仅针对 ios safari  </span></span><br><span class=\"line\">&lt;meta name=<span class=\"string\">\"apple-mobile-web-app-status-bar-style\"</span> content=<span class=\"string\">\"black-translucent\"</span> /&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// windows phone 点击无高光 </span></span><br><span class=\"line\">&lt;meta name=<span class=\"string\">\"msapplication-tap-highlight\"</span> content=<span class=\"string\">\"no\"</span> /&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 关闭电话号码和邮箱的自动识别  </span></span><br><span class=\"line\">&lt;meta name=<span class=\"string\">\"format-detection\"</span> content=<span class=\"string\">\"telephone=no, email=no\"</span> /&gt;</span><br></pre></td></tr></tbody></table></figure><h2 id=\"常用样式\"><a href=\"#常用样式\" class=\"headerlink\" title=\"常用样式\"></a>常用样式</h2><h3 id=\"reset-css\"><a href=\"#reset-css\" class=\"headerlink\" title=\"reset.css\"></a>reset.css</h3><figure class=\"highlight css\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">html</span>{</span><br><span class=\"line\">  <span class=\"attribute\">-webkit-text-size-adjust</span>: none;</span><br><span class=\"line\">  <span class=\"attribute\">-webkit-user-select</span>: none;</span><br><span class=\"line\">  <span class=\"attribute\">-webkit-touch-callout</span>: none;</span><br><span class=\"line\">  <span class=\"comment\">/* font-family: Helvetica; */</span></span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-tag\">body</span>{</span><br><span class=\"line\">  <span class=\"attribute\">font-size</span>: <span class=\"number\">12px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">font-family</span>: -apple-system, BlinkMacSystemFont, <span class=\"string\">\"PingFang SC\"</span>,<span class=\"string\">\"Helvetica Neue\"</span>,STHeiti,<span class=\"string\">\"Microsoft Yahei\"</span>,Tahoma,Simsun,sans-serif;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-tag\">body</span>,<span class=\"selector-tag\">h1</span>,<span class=\"selector-tag\">h2</span>,<span class=\"selector-tag\">h3</span>,<span class=\"selector-tag\">h4</span>,<span class=\"selector-tag\">h5</span>,<span class=\"selector-tag\">h6</span>,<span class=\"selector-tag\">p</span>,<span class=\"selector-tag\">dl</span>,<span class=\"selector-tag\">dd</span>,<span class=\"selector-tag\">ul</span>,<span class=\"selector-tag\">ol</span>,<span class=\"selector-tag\">pre</span>,<span class=\"selector-tag\">form</span>,<span class=\"selector-tag\">input</span>,<span class=\"selector-tag\">textarea</span>,<span class=\"selector-tag\">th</span>,<span class=\"selector-tag\">td</span>,<span class=\"selector-tag\">select</span>{</span><br><span class=\"line\">  <span class=\"attribute\">margin</span>: <span class=\"number\">0</span>; </span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">0</span>; </span><br><span class=\"line\">  <span class=\"attribute\">text-indent</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">font-weight</span>: normal;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-tag\">a</span>,<span class=\"selector-tag\">button</span>,<span class=\"selector-tag\">input</span>,<span class=\"selector-tag\">textarea</span>,<span class=\"selector-tag\">select</span>{ </span><br><span class=\"line\">  <span class=\"attribute\">background</span>: none; </span><br><span class=\"line\">  <span class=\"attribute\">outline</span>: none;</span><br><span class=\"line\">  <span class=\"attribute\">-webkit-appearance</span>: none;</span><br><span class=\"line\">  <span class=\"attribute\">-webkit-tap-highlight-color</span>: <span class=\"built_in\">rgba</span>(255,0,0,0); </span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-tag\">em</span>{</span><br><span class=\"line\">  <span class=\"attribute\">font-style</span>: normal</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-tag\">li</span>{</span><br><span class=\"line\">  <span class=\"attribute\">list-style</span>: none</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-tag\">a</span>{</span><br><span class=\"line\">  <span class=\"attribute\">text-decoration</span>: none;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-tag\">img</span>{</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:none; </span><br><span class=\"line\">  <span class=\"attribute\">vertical-align</span>: top;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-tag\">table</span>{</span><br><span class=\"line\">  <span class=\"attribute\">border-collapse</span>: collapse;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-tag\">textarea</span>{ </span><br><span class=\"line\">  <span class=\"attribute\">resize</span>: none; </span><br><span class=\"line\">  <span class=\"attribute\">overflow</span>: auto;</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h3 id=\"媒体查询\"><a href=\"#媒体查询\" class=\"headerlink\" title=\"媒体查询\"></a>媒体查询</h3><figure class=\"highlight css\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* rem 配置 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">html</span>{</span><br><span class=\"line\">  <span class=\"attribute\">font-size</span>: <span class=\"number\">10px</span></span><br><span class=\"line\">}</span><br><span class=\"line\">@<span class=\"keyword\">media</span> screen and (min-width:<span class=\"number\">321px</span>) and (max-width:<span class=\"number\">375px</span>){</span><br><span class=\"line\">  <span class=\"selector-tag\">html</span>{ <span class=\"attribute\">font-size</span>: <span class=\"number\">11px</span> }</span><br><span class=\"line\">}</span><br><span class=\"line\">@<span class=\"keyword\">media</span> screen and (min-width:<span class=\"number\">376px</span>) and (max-width:<span class=\"number\">414px</span>){</span><br><span class=\"line\">  <span class=\"selector-tag\">html</span>{ <span class=\"attribute\">font-size</span>: <span class=\"number\">12px</span> }</span><br><span class=\"line\">}</span><br><span class=\"line\">@<span class=\"keyword\">media</span> screen and (min-width:<span class=\"number\">415px</span>) and (max-width:<span class=\"number\">639px</span>){</span><br><span class=\"line\">  <span class=\"selector-tag\">html</span>{ <span class=\"attribute\">font-size</span>: <span class=\"number\">15px</span> }</span><br><span class=\"line\">}</span><br><span class=\"line\">@<span class=\"keyword\">media</span> screen and (min-width:<span class=\"number\">640px</span>) and (max-width:<span class=\"number\">719px</span>){</span><br><span class=\"line\">  <span class=\"selector-tag\">html</span>{ <span class=\"attribute\">font-size</span>: <span class=\"number\">20px</span> }</span><br><span class=\"line\">}</span><br><span class=\"line\">@<span class=\"keyword\">media</span> screen and (min-width:<span class=\"number\">720px</span>) and (max-width:<span class=\"number\">749px</span>){</span><br><span class=\"line\">  <span class=\"selector-tag\">html</span>{ <span class=\"attribute\">font-size</span>: <span class=\"number\">22.5px</span> }</span><br><span class=\"line\">}</span><br><span class=\"line\">@<span class=\"keyword\">media</span> screen and (min-width:<span class=\"number\">750px</span>) and (max-width:<span class=\"number\">799px</span>){</span><br><span class=\"line\">  <span class=\"selector-tag\">html</span>{ <span class=\"attribute\">font-size</span>: <span class=\"number\">23.5px</span> }</span><br><span class=\"line\">}</span><br><span class=\"line\">@<span class=\"keyword\">media</span> screen and (min-width:<span class=\"number\">800px</span>){</span><br><span class=\"line\">  <span class=\"selector-tag\">html</span>{ <span class=\"attribute\">font-size</span>: <span class=\"number\">25px</span> } </span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 竖屏时的样式 */</span></span><br><span class=\"line\">@<span class=\"keyword\">media</span> all and (orientation:portrait){   }</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 横屏时的样式 */</span></span><br><span class=\"line\">@<span class=\"keyword\">media</span> all and (orientation:landscape){   }</span><br></pre></td></tr></tbody></table></figure><h3 id=\"表单标签\"><a href=\"#表单标签\" class=\"headerlink\" title=\"表单标签\"></a>表单标签</h3><figure class=\"highlight css\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* input placeholder 出现文本位置偏上 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">input</span>{</span><br><span class=\"line\">    <span class=\"attribute\">line-height</span>: normal;  <span class=\"comment\">/* PC 端设置 line-height = height */</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 输入框 placeholder 的颜色值改变 */</span></span><br><span class=\"line\"><span class=\"selector-pseudo\">::-webkit-input-placeholder</span> {  </span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#999</span>; </span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-pseudo\">:-moz-placeholder</span> {  </span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#999</span>; </span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-pseudo\">::-moz-placeholder</span> {  </span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#999</span>; </span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-pseudo\">:-ms-input-placeholder</span> {  </span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#999</span>; </span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-tag\">input</span><span class=\"selector-pseudo\">:focus</span><span class=\"selector-pseudo\">::-webkit-input-placeholder</span>{ </span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#999</span>; </span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 改变选中内容的背景颜色：字体颜色换成 color 即可 */</span></span><br><span class=\"line\"><span class=\"selector-pseudo\">::selection</span> { </span><br><span class=\"line\">    <span class=\"attribute\">background</span>: <span class=\"number\">#FFF</span>; </span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#333</span>; </span><br><span class=\"line\">} </span><br><span class=\"line\"><span class=\"selector-pseudo\">::-moz-selection</span> { </span><br><span class=\"line\">    <span class=\"attribute\">background</span>: <span class=\"number\">#FFF</span>; </span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#333</span>; </span><br><span class=\"line\">} </span><br><span class=\"line\"><span class=\"selector-pseudo\">::-webkit-selection</span> { </span><br><span class=\"line\">    <span class=\"attribute\">background</span>: <span class=\"number\">#FFF</span>; </span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#333</span>; </span><br><span class=\"line\">} </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 禁用 select 默认下拉箭头 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">select</span><span class=\"selector-pseudo\">::-ms-expand</span> {</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: none;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 禁用 radio 和 checkbox 默认样式 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">input</span><span class=\"selector-attr\">[type=radio]</span><span class=\"selector-pseudo\">::-ms-check</span>, </span><br><span class=\"line\"><span class=\"selector-tag\">input</span><span class=\"selector-attr\">[type=checkbox]</span><span class=\"selector-pseudo\">::-ms-check</span></span><br><span class=\"line\">{</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: none;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 禁用表单输入框默认清除按钮 */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-tag\">input</span><span class=\"selector-attr\">[type=text]</span><span class=\"selector-pseudo\">::-ms-clear</span>,</span><br><span class=\"line\"><span class=\"selector-tag\">input</span><span class=\"selector-attr\">[type=tel]</span><span class=\"selector-pseudo\">::-ms-clear</span>,</span><br><span class=\"line\"><span class=\"selector-tag\">input</span><span class=\"selector-attr\">[type=number]</span><span class=\"selector-pseudo\">::-ms-clear</span></span><br><span class=\"line\">{</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: none;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 重置默认外观 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">input</span>, <span class=\"selector-tag\">select</span> { </span><br><span class=\"line\">    <span class=\"comment\">/* 清除默认内阴影 */</span></span><br><span class=\"line\">    <span class=\"attribute\">-webkit-appearance</span>:none; </span><br><span class=\"line\">    <span class=\"attribute\">appearance</span>: none; </span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*禁止winphone默认触摸事件 (e.preventDefault无效)*/</span></span><br><span class=\"line\"><span class=\"selector-tag\">html</span>{</span><br><span class=\"line\">    <span class=\"attribute\">-ms-touch-action</span>: none;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 解决 -webkit-user-select:none 导致 input/textarea 无法输入  */</span></span><br><span class=\"line\">* {</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-box-sizing</span>: border-box;</span><br><span class=\"line\">    <span class=\"attribute\">-moz-box-sizing</span>: border-box;</span><br><span class=\"line\">    <span class=\"attribute\">box-sizing</span>: border-box;</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-tap-highlight-color</span>: transparent; </span><br><span class=\"line\">    <span class=\"comment\">/* 当用户点击 iOS Safari 的链接或 Js 的可点击元素时，覆盖显示的高亮颜色。*/</span></span><br><span class=\"line\">    <span class=\"attribute\">outline</span>: none;</span><br><span class=\"line\">}</span><br><span class=\"line\">*<span class=\"selector-pseudo\">:not(input</span>,<span class=\"selector-tag\">textarea</span>) { </span><br><span class=\"line\">    <span class=\"attribute\">-webkit-touch-callout</span>: none; </span><br><span class=\"line\">    <span class=\"comment\">/* 触摸并按住触摸目标时，禁止或显示系统默认菜单 */</span></span><br><span class=\"line\">    <span class=\"attribute\">-webkit-user-select</span>: none; </span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h3 id=\"其它标签\"><a href=\"#其它标签\" class=\"headerlink\" title=\"其它标签\"></a>其它标签</h3><figure class=\"highlight css\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 禁用长按选中、复制文本功能 */</span></span><br><span class=\"line\">* {</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-touch-callout</span>: none;</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-user-select</span>: none;</span><br><span class=\"line\">    <span class=\"attribute\">-khtml-user-select</span>: none;</span><br><span class=\"line\">    <span class=\"attribute\">-moz-user-select</span>: none;</span><br><span class=\"line\">    <span class=\"attribute\">-ms-user-select</span>: none;</span><br><span class=\"line\">    <span class=\"attribute\">user-select</span>: none;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 取消 a 标签在移动端点击时的蓝色 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">a</span>{</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-tap-highlight-color</span>: <span class=\"built_in\">rgba</span>(255, 255, 255, 0);</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-user-select</span>: none;</span><br><span class=\"line\">    <span class=\"attribute\">-moz-user-focus</span>: none;</span><br><span class=\"line\">    <span class=\"attribute\">-moz-user-select</span>: none;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 使用图片作为 a 的点击按钮时，触发 touchstart 时总有一个灰色背景 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">a</span>,<span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:hover</span>,<span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:active</span>,<span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:visited</span>,<span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:link</span>,<span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:focus</span>{</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-tap-highlight-color</span>:<span class=\"built_in\">rgba</span>(0,0,0,0);</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-tap-highlight-color</span>: transparent;</span><br><span class=\"line\">    <span class=\"attribute\">outline</span>:none;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: none;</span><br><span class=\"line\">    <span class=\"attribute\">text-decoration</span>: none;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 模拟按钮 hover 效果 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.btn-blue</span> {</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">42px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">line-height</span>: <span class=\"number\">42px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">text-align</span>: center;</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">4px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">18px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#FFF</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#4185F3</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-class\">.btn-blue</span><span class=\"selector-pseudo\">:active</span>{</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#357AE8</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  active 兼容处理：:active 伪类失效</span></span><br><span class=\"line\"><span class=\"comment\"> </span></span><br><span class=\"line\"><span class=\"comment\">  法一：body ontouchstart=\"fn\"</span></span><br><span class=\"line\"><span class=\"comment\">  法二：document.addEventListener(\"touchstart\", fn, false)</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">    同等比例的图片在 PC 端很清楚，但在手机上有些设备会模糊。这是因为手机分辨率太小，</span></span><br><span class=\"line\"><span class=\"comment\">    解决方案是使用元素宽高两倍的背景图而非 img 标签</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"selector-tag\">div</span>{</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: <span class=\"built_in\">url</span>(../images/icon.png) no-repeat center center;</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-background-size</span>: <span class=\"number\">50px</span> <span class=\"number\">50px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-size</span>: <span class=\"number\">50px</span> <span class=\"number\">50px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: inline-block; </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">background-size</span>: contain;</span><br><span class=\"line\">    <span class=\"comment\">/* 或  width: 100%;  height: 50px; */</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* overflow: scroll 时上下拉动滚动条时卡顿、慢 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">body</span> {</span><br><span class=\"line\">  <span class=\"comment\">/* 法一： CSS3新属性 */</span></span><br><span class=\"line\">  <span class=\"attribute\">-webkit-overflow-scrolling</span>: touch;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* 法二 */</span></span><br><span class=\"line\">  <span class=\"attribute\">overflow-x</span>: hidden;  </span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">/* 法三：去掉 body/html 的 height: 100%  */</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* IOS 滚动不平滑的问题 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">div</span>{</span><br><span class=\"line\">    <span class=\"comment\">/* 手指移开触摸屏滚动一段时间 */</span></span><br><span class=\"line\">    <span class=\"attribute\">-webkit-overflow-scrolling</span>: touch;  </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* 手指移开触摸屏立即停止滚动 */</span></span><br><span class=\"line\">    <span class=\"attribute\">-webkit-overflow-scrolling</span>: auto;   </span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h1 id=\"三、优化方案\"><a href=\"#三、优化方案\" class=\"headerlink\" title=\"三、优化方案\"></a>三、优化方案</h1><ul><li>不滥用 Float：渲染页面时计算量比较大</li><li>不滥用 Web 字体：需要下载、解析、重绘当前页面</li><li>不声明过多的 Font-size：会影响 CSS 树的效率</li><li>减少重绘和回流<ul><li>减少 drawImage</li><li>避免不必要的 DOM 操作</li><li>避免使用 document.write</li><li>尽量改变 class 而不是 Style</li></ul></li><li>动画优化<ul><li>尽量使用 CSS3 动画：5 个以内的元素时</li><li>适当使用 Canvas 动画：5 个以上元素时</li><li>合理使用 requestAnimationFrame 动画代替 setTimeout</li></ul></li><li>GPU 加速<ul><li>注意过渡使用会引发手机过耗电增加</li><li>触发 GPU 渲染：transitions、3D transforms、Opacity、Canvas、WebGL、Video</li></ul></li></ul><div align=\"center\"><br><img src=\"images/mobile/optimization.png\" alt=\"移动端优化\"><br></div><!-- rebuild by neat --></body></html>","site":{"data":{"next":{"override":false,"cache":{"enable":true},"favicon":{"small":"/images/favicon-16.ico","medium":"/images/favicon-32.ico","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"rss":"/atom.xml","footer":{"since":2019,"icon":{"name":"snowflake-o","animated":false,"color":"#808080"},"copyright":"chuangge","powered":{"enable":false,"version":true},"theme":{"enable":false,"version":true},"beian":{"enable":false,"icp":null}},"creative_commons":{"license":"by-nc-sa","sidebar":false,"post":false},"canonical":true,"seo":false,"index_with_subtitle":false,"exturl":false,"menu":{"home":"/ || home  //首页","tags":"/tags/ || tags  //标签","categories":"/categories/ || th   //分类","archives":"/archives/ || archive //归档"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":{"GitHub":"https://github.com/ || github","StackOverflow":"https://stackoverflow.com/ || stack-overflow"},"social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"友情链接","links_layout":"inline","links":{"个人简历":"https://chuanggefighting.github.io/project/","印记中文":"https://www.docschina.org/","在线工具":"http://tool.lu/","Learn Anything":"https://learn-anything.xyz/"},"avatar":{"url":"/images/chuang.png","rounded":true,"opacity":1,"rotated":true},"toc":{"enable":true,"number":true,"wrap":false,"max_depth":6},"sidebar":{"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"read_more_btn":true,"post_meta":{"item_text":true,"created_at":true,"updated_at":{"enabled":true,"another_day":true},"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":true,"awl":4,"wpm":275},"codeblock":{"border_radius":null,"copy_button":{"enable":false,"show_result":false}},"reward":{"enable":false},"related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_edit":{"enable":false,"url":"https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name"},"disable_baidu_tranformation":false,"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"font":{"enable":true,"host":"//fonts.proxy.ustclug.org","global":{"external":true,"family":"Lato","size":16},"headings":{"external":true,"family":"Roboto Slab","size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":"Lobster Two","size":24},"codes":{"external":true,"family":"Roboto Mono","size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css","copy_tex":{"enable":false,"copy_tex_js":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js","copy_tex_css":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css"}}},"pdf":{"enable":false,"per_page":true,"height":"500px","pdfobject":{"cdn":"//cdn.jsdelivr.net/npm/pdfobject@2.1.1/pdfobject.min.js"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":true,"appid":"snOvapuSplYTVflf5p9Ml9JX-gzGzoHsz","appkey":"5ABGdfyEdAtu6lTXdGdo7hf9","notify":false,"verify":false,"placeholder":"ヾﾉ≧∀≦)o 来呀！吐槽一番吧！","avatar":"mm","guest_info":"nick,mail,link","pageSize":10,"visitor":false,"comment_count":true},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"gitalk":{"enable":false,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true},"needmoreshare2":{"enable":true,"postbottom":{"enable":true,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null,"security":false,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":true,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":true,"pace_theme":"pace-theme-center-simple","canvas_nest":{"enable":true,"onmobile":true,"color":"0,0,255","opacity":0.5,"zIndex":-1,"count":99},"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"canvas_nest_nomobile":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"leancloud":null,"valine":null,"gitalk_js":null,"gitalk_css":null,"md5":null},"css":"css","js":"js","images":"images","passage_end_tag":{"enabled":true},"daovoice":true,"daovoice_app_id":"2ed51855"}}},"excerpt":"","more":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><h1 id=\"一、开发模式\"><a href=\"#一、开发模式\" class=\"headerlink\" title=\"一、开发模式\"></a>一、开发模式</h1><div align=\"center\"><br><br><img src=\"images/mobile/mode.png\" alt=\"Mobile Mode\"><br></div><h2 id=\"Native-App\"><a href=\"#Native-App\" class=\"headerlink\" title=\"Native App\"></a>Native App</h2><blockquote><p>移动端的原生应用</p></blockquote><ul><li>实现：基于手机操作系统 API 并使用原生语言编写</li><li>优点<ul><li>支持离线运行</li><li>能够访问智能设备提供的所有功能</li><li>更好的运行速度，性能和总体用户体验</li><li>支持丰富的图形，动画和更好的渲染效果</li></ul></li><li>缺点<ul><li>开发成本较高：同一个项目至少需要 Android、iOS、Web 三个开发团队</li><li>维护、更新成本高：需要所有用户重新下载安装</li></ul></li></ul><h2 id=\"Web-App\"><a href=\"#Web-App\" class=\"headerlink\" title=\"Web App\"></a>Web App</h2><blockquote><p>移动端的 Web 浏览器，注意 PC Web 运行在 Windows、Linux</p></blockquote><ul><li>实现：基于 Html5 实现并运行在 iOS/Android</li><li>优点<ul><li>开发成本较低</li><li>适用范围广，跨平台</li><li>可以方便、快速地部署</li><li>维护成本低：用户可以随时访问最新版本而不需要下载更新</li></ul></li><li>缺点<ul><li>图形和动画渲染效果差</li><li>用户体验差：加载慢、费流量</li><li>不能调用系统相关功能：相机、GPS等</li></ul></li></ul><h2 id=\"Hybrid-App\"><a href=\"#Hybrid-App\" class=\"headerlink\" title=\"Hybrid App\"></a>Hybrid App</h2><blockquote><p>混合 App，兼具 Native App 良好用户交互体验、Web App 跨平台开发的优势</p></blockquote><ul><li>实现：使用原生语言编写应用的外壳，然后在其中内嵌网页语言编写的内容信息</li><li>优点<ul><li>部分支持离线功能</li><li>维护、更新较为方便</li><li>可调用智能设备相关功能</li></ul></li><li>缺点<ul><li>用户体验较差</li><li>图形和动画渲染效果较差</li></ul></li></ul><h1 id=\"二、基础知识\"><a href=\"#二、基础知识\" class=\"headerlink\" title=\"二、基础知识\"></a>二、基础知识</h1><h2 id=\"像素\"><a href=\"#像素\" class=\"headerlink\" title=\"像素\"></a>像素</h2><ul><li>物理像素<ul><li>单位：dp，获取方法为 window.screen.width/height</li><li>特点<ul><li>屏幕分辨率表示设备屏幕上的物理像素个数</li><li>同一个设备上，1dp 代表的物理长度是固定不变的</li><li>不同设备之间，1dp 代表的物理长度是可以不同的</li></ul></li></ul></li><li>逻辑像素<ul><li>单位：px</li><li>特点<ul><li>改变大小的场景：缩放屏幕、更换设备</li><li>它与物理像素之间的比例关系取决于 屏幕特性（是否高清屏）和用户设置的缩放比例，由浏览器自行换算</li></ul></li></ul></li><li>换算关系<ul><li>dpr：物理像素与CSS像素的比例</li><li>关系：1px = (dpr)^2 * dp</li></ul></li></ul><h2 id=\"Viewport\"><a href=\"#Viewport\" class=\"headerlink\" title=\"Viewport\"></a>Viewport</h2><div style=\"text-indent:2em\">PC 端网站都是以浏览器窗口(设备屏幕) 作为视口进行布局。但是在移动端，网站的布局视口默认比移动端屏幕宽很多，浏览器为了将页面完整显示出来而会将页面缩小至浏览器窗口中，页面内容看起来被压扁，因此引入了 viewport 视口的概念来解决移动端的页面展示问题。</div><h3 id=\"layout-viewport\"><a href=\"#layout-viewport\" class=\"headerlink\" title=\"layout viewport\"></a>layout viewport</h3><blockquote><p>布局视口，获取方法为 document.documentElement.clientWidth/clientHeight</p></blockquote><ul><li>默认比移动端屏幕宽很多，而 CSS 页面布局是根据布局视口来计算的</li><li>浏览器为了将页面在浏览器窗口中完整地显示出来，会将页面压扁</li><li>通过 meta 标签设置 <code>布局视口宽度 = 浏览器窗口宽度</code> 之后，页面就会正常显示</li></ul><h3 id=\"visual-viewport\"><a href=\"#visual-viewport\" class=\"headerlink\" title=\"visual viewport\"></a>visual viewport</h3><blockquote><p>视觉视口</p></blockquote><ul><li>用户当前看到的区域，用户可以通过缩放操作视觉视口，同时不会影响布局视口</li><li>当放大页面时，用户能看到的页面内容在减少，CSS 像素将跨越更多的物理像素</li></ul><h3 id=\"ideal-viewport\"><a href=\"#ideal-viewport\" class=\"headerlink\" title=\"ideal viewport\"></a>ideal viewport</h3><blockquote><p>理想视口</p></blockquote><ul><li>它的宽度等于移动设备的屏幕宽度，和设备的物理宽度无关</li><li>这个理想的宽度是指以 CSS 像素单位计算的，即屏幕的 CSS 像素宽度</li><li>布局视口并不是理想视口，所以需要设置：<code>布局视口 = 理想视口 = 移动设备屏幕</code></li></ul><h2 id=\"meta\"><a href=\"#meta\" class=\"headerlink\" title=\"meta\"></a>meta</h2><blockquote><p>移动设备默认的是 布局视口，但是移动端开发时需要的是 理想视口，meta 标签就用于控制视口</p></blockquote><ul><li>viewport 标签只对移动端浏览器有效，对 PC 端浏览器是无效的</li><li>当缩放比例为 100% 时，dip 宽度 = CSS 像素宽度 = 理想视口的宽度 = 布局视口的宽度</li><li>即使设置了 user-scalable = no，在 Android Chrome 浏览器中也可以强制启用手动缩放</li><li>单独设置 initial-scale 或 width 都会有兼容性问题（横竖屏不分），所以设置布局视口为理想视口的最佳方法是同时设置这两个属性</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 启用360浏览器的极速模式 (webkit)  </span></span><br><span class=\"line\">&amp;lt;meta name=<span class=\"string\">\"renderer\"</span> content=<span class=\"string\">\"webkit\"</span> /&amp;gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 优先使用 IE 最新版本和 Chrome  </span></span><br><span class=\"line\">&amp;lt;meta http-equiv=<span class=\"string\">\"X-UA-Compatible\"</span> content=<span class=\"string\">\"IE=EDGE, chrome=1\"</span> /&amp;gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 页面窗口自动调整到设备宽度，并禁止用户缩放页面 (scale) </span></span><br><span class=\"line\">&amp;lt;meta name=<span class=\"string\">\"viewport\"</span> content=<span class=\"string\">\"width=device-width, height=device-height, </span></span><br><span class=\"line\"><span class=\"string\">initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no\"</span> /&amp;gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用全屏模式运行，仅针对 ios safari  </span></span><br><span class=\"line\">&amp;lt;meta name=<span class=\"string\">\"apple-mobile-web-app-capable\"</span> content=<span class=\"string\">\"yes\"</span> /&amp;gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 设置顶端状态栏背景为灰色半透明，仅针对 ios safari  </span></span><br><span class=\"line\">&amp;lt;meta name=<span class=\"string\">\"apple-mobile-web-app-status-bar-style\"</span> content=<span class=\"string\">\"black-translucent\"</span> /&amp;gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// windows phone 点击无高光 </span></span><br><span class=\"line\">&amp;lt;meta name=<span class=\"string\">\"msapplication-tap-highlight\"</span> content=<span class=\"string\">\"no\"</span> /&amp;gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 关闭电话号码和邮箱的自动识别  </span></span><br><span class=\"line\">&amp;lt;meta name=<span class=\"string\">\"format-detection\"</span> content=<span class=\"string\">\"telephone=no, email=no\"</span> /&amp;gt;</span><br></pre></td></tr></table></figure><h2 id=\"常用样式\"><a href=\"#常用样式\" class=\"headerlink\" title=\"常用样式\"></a>常用样式</h2><h3 id=\"reset-css\"><a href=\"#reset-css\" class=\"headerlink\" title=\"reset.css\"></a>reset.css</h3><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">html</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">-webkit-text-size-adjust</span>: none;</span><br><span class=\"line\">  <span class=\"attribute\">-webkit-user-select</span>: none;</span><br><span class=\"line\">  <span class=\"attribute\">-webkit-touch-callout</span>: none;</span><br><span class=\"line\">  <span class=\"comment\">/* font-family: Helvetica; */</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-tag\">body</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">font-size</span>: <span class=\"number\">12px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">font-family</span>: -apple-system, BlinkMacSystemFont, <span class=\"string\">\"PingFang SC\"</span>,<span class=\"string\">\"Helvetica Neue\"</span>,STHeiti,<span class=\"string\">\"Microsoft Yahei\"</span>,Tahoma,Simsun,sans-serif;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-tag\">body</span>,<span class=\"selector-tag\">h1</span>,<span class=\"selector-tag\">h2</span>,<span class=\"selector-tag\">h3</span>,<span class=\"selector-tag\">h4</span>,<span class=\"selector-tag\">h5</span>,<span class=\"selector-tag\">h6</span>,<span class=\"selector-tag\">p</span>,<span class=\"selector-tag\">dl</span>,<span class=\"selector-tag\">dd</span>,<span class=\"selector-tag\">ul</span>,<span class=\"selector-tag\">ol</span>,<span class=\"selector-tag\">pre</span>,<span class=\"selector-tag\">form</span>,<span class=\"selector-tag\">input</span>,<span class=\"selector-tag\">textarea</span>,<span class=\"selector-tag\">th</span>,<span class=\"selector-tag\">td</span>,<span class=\"selector-tag\">select</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">margin</span>: <span class=\"number\">0</span>; </span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">0</span>; </span><br><span class=\"line\">  <span class=\"attribute\">text-indent</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">font-weight</span>: normal;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-tag\">a</span>,<span class=\"selector-tag\">button</span>,<span class=\"selector-tag\">input</span>,<span class=\"selector-tag\">textarea</span>,<span class=\"selector-tag\">select</span>&#123; </span><br><span class=\"line\">  <span class=\"attribute\">background</span>: none; </span><br><span class=\"line\">  <span class=\"attribute\">outline</span>: none;</span><br><span class=\"line\">  <span class=\"attribute\">-webkit-appearance</span>: none;</span><br><span class=\"line\">  <span class=\"attribute\">-webkit-tap-highlight-color</span>: <span class=\"built_in\">rgba</span>(255,0,0,0); </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-tag\">em</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">font-style</span>: normal</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-tag\">li</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">list-style</span>: none</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-tag\">a</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">text-decoration</span>: none;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-tag\">img</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:none; </span><br><span class=\"line\">  <span class=\"attribute\">vertical-align</span>: top;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-tag\">table</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">border-collapse</span>: collapse;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-tag\">textarea</span>&#123; </span><br><span class=\"line\">  <span class=\"attribute\">resize</span>: none; </span><br><span class=\"line\">  <span class=\"attribute\">overflow</span>: auto;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h3 id=\"媒体查询\"><a href=\"#媒体查询\" class=\"headerlink\" title=\"媒体查询\"></a>媒体查询</h3><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* rem 配置 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">html</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">font-size</span>: <span class=\"number\">10px</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">@<span class=\"keyword\">media</span> screen and (min-width:<span class=\"number\">321px</span>) and (max-width:<span class=\"number\">375px</span>)&#123;</span><br><span class=\"line\">  <span class=\"selector-tag\">html</span>&#123; <span class=\"attribute\">font-size</span>: <span class=\"number\">11px</span> &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">@<span class=\"keyword\">media</span> screen and (min-width:<span class=\"number\">376px</span>) and (max-width:<span class=\"number\">414px</span>)&#123;</span><br><span class=\"line\">  <span class=\"selector-tag\">html</span>&#123; <span class=\"attribute\">font-size</span>: <span class=\"number\">12px</span> &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">@<span class=\"keyword\">media</span> screen and (min-width:<span class=\"number\">415px</span>) and (max-width:<span class=\"number\">639px</span>)&#123;</span><br><span class=\"line\">  <span class=\"selector-tag\">html</span>&#123; <span class=\"attribute\">font-size</span>: <span class=\"number\">15px</span> &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">@<span class=\"keyword\">media</span> screen and (min-width:<span class=\"number\">640px</span>) and (max-width:<span class=\"number\">719px</span>)&#123;</span><br><span class=\"line\">  <span class=\"selector-tag\">html</span>&#123; <span class=\"attribute\">font-size</span>: <span class=\"number\">20px</span> &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">@<span class=\"keyword\">media</span> screen and (min-width:<span class=\"number\">720px</span>) and (max-width:<span class=\"number\">749px</span>)&#123;</span><br><span class=\"line\">  <span class=\"selector-tag\">html</span>&#123; <span class=\"attribute\">font-size</span>: <span class=\"number\">22.5px</span> &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">@<span class=\"keyword\">media</span> screen and (min-width:<span class=\"number\">750px</span>) and (max-width:<span class=\"number\">799px</span>)&#123;</span><br><span class=\"line\">  <span class=\"selector-tag\">html</span>&#123; <span class=\"attribute\">font-size</span>: <span class=\"number\">23.5px</span> &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">@<span class=\"keyword\">media</span> screen and (min-width:<span class=\"number\">800px</span>)&#123;</span><br><span class=\"line\">  <span class=\"selector-tag\">html</span>&#123; <span class=\"attribute\">font-size</span>: <span class=\"number\">25px</span> &#125; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 竖屏时的样式 */</span></span><br><span class=\"line\">@<span class=\"keyword\">media</span> all and (orientation:portrait)&#123;   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 横屏时的样式 */</span></span><br><span class=\"line\">@<span class=\"keyword\">media</span> all and (orientation:landscape)&#123;   &#125;</span><br></pre></td></tr></table></figure><h3 id=\"表单标签\"><a href=\"#表单标签\" class=\"headerlink\" title=\"表单标签\"></a>表单标签</h3><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* input placeholder 出现文本位置偏上 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">input</span>&#123;</span><br><span class=\"line\">    <span class=\"attribute\">line-height</span>: normal;  <span class=\"comment\">/* PC 端设置 line-height = height */</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 输入框 placeholder 的颜色值改变 */</span></span><br><span class=\"line\"><span class=\"selector-pseudo\">::-webkit-input-placeholder</span> &#123;  </span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#999</span>; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-pseudo\">:-moz-placeholder</span> &#123;  </span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#999</span>; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-pseudo\">::-moz-placeholder</span> &#123;  </span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#999</span>; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-pseudo\">:-ms-input-placeholder</span> &#123;  </span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#999</span>; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-tag\">input</span><span class=\"selector-pseudo\">:focus</span><span class=\"selector-pseudo\">::-webkit-input-placeholder</span>&#123; </span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#999</span>; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 改变选中内容的背景颜色：字体颜色换成 color 即可 */</span></span><br><span class=\"line\"><span class=\"selector-pseudo\">::selection</span> &#123; </span><br><span class=\"line\">    <span class=\"attribute\">background</span>: <span class=\"number\">#FFF</span>; </span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#333</span>; </span><br><span class=\"line\">&#125; </span><br><span class=\"line\"><span class=\"selector-pseudo\">::-moz-selection</span> &#123; </span><br><span class=\"line\">    <span class=\"attribute\">background</span>: <span class=\"number\">#FFF</span>; </span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#333</span>; </span><br><span class=\"line\">&#125; </span><br><span class=\"line\"><span class=\"selector-pseudo\">::-webkit-selection</span> &#123; </span><br><span class=\"line\">    <span class=\"attribute\">background</span>: <span class=\"number\">#FFF</span>; </span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#333</span>; </span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 禁用 select 默认下拉箭头 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">select</span><span class=\"selector-pseudo\">::-ms-expand</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: none;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 禁用 radio 和 checkbox 默认样式 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">input</span><span class=\"selector-attr\">[type=radio]</span><span class=\"selector-pseudo\">::-ms-check</span>, </span><br><span class=\"line\"><span class=\"selector-tag\">input</span><span class=\"selector-attr\">[type=checkbox]</span><span class=\"selector-pseudo\">::-ms-check</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: none;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 禁用表单输入框默认清除按钮 */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-tag\">input</span><span class=\"selector-attr\">[type=text]</span><span class=\"selector-pseudo\">::-ms-clear</span>,</span><br><span class=\"line\"><span class=\"selector-tag\">input</span><span class=\"selector-attr\">[type=tel]</span><span class=\"selector-pseudo\">::-ms-clear</span>,</span><br><span class=\"line\"><span class=\"selector-tag\">input</span><span class=\"selector-attr\">[type=number]</span><span class=\"selector-pseudo\">::-ms-clear</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: none;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 重置默认外观 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">input</span>, <span class=\"selector-tag\">select</span> &#123; </span><br><span class=\"line\">    <span class=\"comment\">/* 清除默认内阴影 */</span></span><br><span class=\"line\">    <span class=\"attribute\">-webkit-appearance</span>:none; </span><br><span class=\"line\">    <span class=\"attribute\">appearance</span>: none; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*禁止winphone默认触摸事件 (e.preventDefault无效)*/</span></span><br><span class=\"line\"><span class=\"selector-tag\">html</span>&#123;</span><br><span class=\"line\">    <span class=\"attribute\">-ms-touch-action</span>: none;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 解决 -webkit-user-select:none 导致 input/textarea 无法输入  */</span></span><br><span class=\"line\">* &#123;</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-box-sizing</span>: border-box;</span><br><span class=\"line\">    <span class=\"attribute\">-moz-box-sizing</span>: border-box;</span><br><span class=\"line\">    <span class=\"attribute\">box-sizing</span>: border-box;</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-tap-highlight-color</span>: transparent; </span><br><span class=\"line\">    <span class=\"comment\">/* 当用户点击 iOS Safari 的链接或 Js 的可点击元素时，覆盖显示的高亮颜色。*/</span></span><br><span class=\"line\">    <span class=\"attribute\">outline</span>: none;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">*<span class=\"selector-pseudo\">:not(input</span>,<span class=\"selector-tag\">textarea</span>) &#123; </span><br><span class=\"line\">    <span class=\"attribute\">-webkit-touch-callout</span>: none; </span><br><span class=\"line\">    <span class=\"comment\">/* 触摸并按住触摸目标时，禁止或显示系统默认菜单 */</span></span><br><span class=\"line\">    <span class=\"attribute\">-webkit-user-select</span>: none; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h3 id=\"其它标签\"><a href=\"#其它标签\" class=\"headerlink\" title=\"其它标签\"></a>其它标签</h3><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 禁用长按选中、复制文本功能 */</span></span><br><span class=\"line\">* &#123;</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-touch-callout</span>: none;</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-user-select</span>: none;</span><br><span class=\"line\">    <span class=\"attribute\">-khtml-user-select</span>: none;</span><br><span class=\"line\">    <span class=\"attribute\">-moz-user-select</span>: none;</span><br><span class=\"line\">    <span class=\"attribute\">-ms-user-select</span>: none;</span><br><span class=\"line\">    <span class=\"attribute\">user-select</span>: none;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 取消 a 标签在移动端点击时的蓝色 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">a</span>&#123;</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-tap-highlight-color</span>: <span class=\"built_in\">rgba</span>(255, 255, 255, 0);</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-user-select</span>: none;</span><br><span class=\"line\">    <span class=\"attribute\">-moz-user-focus</span>: none;</span><br><span class=\"line\">    <span class=\"attribute\">-moz-user-select</span>: none;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 使用图片作为 a 的点击按钮时，触发 touchstart 时总有一个灰色背景 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">a</span>,<span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:hover</span>,<span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:active</span>,<span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:visited</span>,<span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:link</span>,<span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:focus</span>&#123;</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-tap-highlight-color</span>:<span class=\"built_in\">rgba</span>(0,0,0,0);</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-tap-highlight-color</span>: transparent;</span><br><span class=\"line\">    <span class=\"attribute\">outline</span>:none;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: none;</span><br><span class=\"line\">    <span class=\"attribute\">text-decoration</span>: none;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 模拟按钮 hover 效果 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.btn-blue</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">42px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">line-height</span>: <span class=\"number\">42px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">text-align</span>: center;</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">4px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">18px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#FFF</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#4185F3</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.btn-blue</span><span class=\"selector-pseudo\">:active</span>&#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#357AE8</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  active 兼容处理：:active 伪类失效</span></span><br><span class=\"line\"><span class=\"comment\"> </span></span><br><span class=\"line\"><span class=\"comment\">  法一：body ontouchstart=\"fn\"</span></span><br><span class=\"line\"><span class=\"comment\">  法二：document.addEventListener(\"touchstart\", fn, false)</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">    同等比例的图片在 PC 端很清楚，但在手机上有些设备会模糊。这是因为手机分辨率太小，</span></span><br><span class=\"line\"><span class=\"comment\">    解决方案是使用元素宽高两倍的背景图而非 img 标签</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"selector-tag\">div</span>&#123;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: <span class=\"built_in\">url</span>(../images/icon.png) no-repeat center center;</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-background-size</span>: <span class=\"number\">50px</span> <span class=\"number\">50px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-size</span>: <span class=\"number\">50px</span> <span class=\"number\">50px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: inline-block; </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">background-size</span>: contain;</span><br><span class=\"line\">    <span class=\"comment\">/* 或  width: 100%;  height: 50px; */</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* overflow: scroll 时上下拉动滚动条时卡顿、慢 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">body</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">/* 法一： CSS3新属性 */</span></span><br><span class=\"line\">  <span class=\"attribute\">-webkit-overflow-scrolling</span>: touch;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* 法二 */</span></span><br><span class=\"line\">  <span class=\"attribute\">overflow-x</span>: hidden;  </span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">/* 法三：去掉 body/html 的 height: 100%  */</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* IOS 滚动不平滑的问题 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">div</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/* 手指移开触摸屏滚动一段时间 */</span></span><br><span class=\"line\">    <span class=\"attribute\">-webkit-overflow-scrolling</span>: touch;  </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* 手指移开触摸屏立即停止滚动 */</span></span><br><span class=\"line\">    <span class=\"attribute\">-webkit-overflow-scrolling</span>: auto;   </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h1 id=\"三、优化方案\"><a href=\"#三、优化方案\" class=\"headerlink\" title=\"三、优化方案\"></a>三、优化方案</h1><ul><li>不滥用 Float：渲染页面时计算量比较大</li><li>不滥用 Web 字体：需要下载、解析、重绘当前页面</li><li>不声明过多的 Font-size：会影响 CSS 树的效率</li><li>减少重绘和回流<ul><li>减少 drawImage</li><li>避免不必要的 DOM 操作</li><li>避免使用 document.write</li><li>尽量改变 class 而不是 Style</li></ul></li><li>动画优化<ul><li>尽量使用 CSS3 动画：5 个以内的元素时</li><li>适当使用 Canvas 动画：5 个以上元素时</li><li>合理使用 requestAnimationFrame 动画代替 setTimeout</li></ul></li><li>GPU 加速<ul><li>注意过渡使用会引发手机过耗电增加</li><li>触发 GPU 渲染：transitions、3D transforms、Opacity、Canvas、WebGL、Video</li></ul></li></ul><div align=\"center\"><br><img src=\"images/mobile/optimization.png\" alt=\"移动端优化\"><br></div><!-- rebuild by neat -->"},{"title":"PC 端开发常用标签和样式","top":false,"keywords":["html","css"],"date":"2019-03-06T14:32:08.000Z","description":"HTML、CSS","_content":"\n# 一、HTML 元素\n> __相互转换：display__ \n\n  * 块级元素：独占一行、可设宽高、不设宽度时默认是其父元素的100%\n    * 常用5个标签：h、p、ul、div、table\n    * 6大属性：width、height、background、border、padding、margin \n  * 行内元素：一行可放多个、宽高不可设置、宽度包裹内容\n    * 常用标签：a、span、label、strong\n  * 行内块元素：一行多个、可设宽高  \n    * 常用标签：img、input等\n  \n\n\n# 二、浮动\n## float\n  1. 设计初衷：文字环绕效果\n  2. 主要特性：包裹性 和 破坏性\n\n## 清除浮动\n  1. 本质：清除浮动元素对后面元素的影响\n  2. 方法\n    * 给父元素指定高度：不太灵活\n    * 在浮动元素后面盒子添加 clear: both\n    * 给浮动元素父元素添加 overflow: hidden/auto\n    * 底部添加伪元素 after \n  3. 特例：父元素有浮动/绝对定位时不需清除\n  4. 经典方法\n    ```css\n    div::after {\n        content: \"\";       /* 添加内容为空 */   \n        display: block;\n        height: 0;           /* 不占空间 */\n        visibility: hidden;  /* 不可见  */   \n        clear: both\n    }\n    div {  \n        *zoom : 1;   /* 兼容低版本浏览器 */   \n    }\n    ```\n\n# 三、布局模型\n> 网页布局：整体布局用浮动，局部布局用定位\n\n  1. 流动模型：浏览器默认的文档流。块级元素自下而上、内联元素自左而右按顺序排列\n  2. 浮动模型：浮动流。元素脱离文档流而释放空间，但浮动元素不能遮挡后面文档流中内容的正常显示\n  3. 层模型：定位流。父元素相对定位，子元素绝对定位/固定定位，z-index规定定位元素的堆叠顺序\n\n\n# 四、常用知识点\n  * 文件引入优先级：就近原则，距离相应代码近的引入方式优先级高\n  * 浏览器读取规则：从右向左，因为相比从左到右匹配更快、性能更优\n  * 元素隐藏方法：display、Opacity、visibility、hide、遮罩等\n  * 元素间距处理：父子元素的间距给父元素加 padding，同级元素的间距则给一个元素加 margin\n  * 伪类和伪元素：`:hover、:link 等伪类`用于向已有元素添加特殊效果，`::before、::after 等伪元素`用于新建抽象元素并添加样式从而实现特殊效果\n\n\n# 五、css 单位\n  * __rem__: 相对于根元素字体尺寸\n  * __em__: 相对于父级元素的字体尺寸\n  * __%__: 百分比，相对于父元素的尺寸\n  * __px__: 像素，相对于用户设备分辨率的最基本单元\n  * pt：Word等办公软件中使用的字体大小单位\n  * dp：安卓开发时使用的长度单位\n  * sp：安卓开发时使用的字体大小单位\n  * vw：视窗宽度，1vw等于视窗宽度的 1%\n  * vh：视窗高度，1vh等于视窗高度的 1%\n  * vmin / vmax：vw和vh中较 小/大 的那个\n\n\n# 六、浏览器兼容\n\n## 常见兼容问题\n  * __img 之间出现间距__：浮动\n  * __上下 margin 重合问题__：上下选一个\n  * __opacity、placeholder、outline、伪元素、z-index__  \n  * __子元素的 margin-top,会出现在父元素的上方__\n    * 给父元素加 overflow: hidden\n    * 能用 padding-top 替代时就替代\n    * 给父元素设置 border: 1px solid transparent\n  * __li 元素使用 display: inline-block 时会出现缝隙__\n    * 使用浮动\n    * 给li重新设置字号 font-size: 0 \n\n\n## css hack\n> 针对不同的浏览器写不同的 CSS 来解决浏览器兼容\n\n  * 选择器前缀法：@media screen\n  * CSS 属性前缀法：-webkit-、-moz-、-ms-、-o-\n  * IE 条件注释语句：解决 IE 兼容问题\n\n\n# 七、CSS3\n\n## 引用字体文件\n  ```css\n  @font-face {                       \n      font-family: ArtifaktBlod;     \n      src: url('fonts/ArtifaktElementOfc-Bold.ttf');  /* 引入字体资源 */    \n  }  \n  div {\n      font-family: ArtifaktBlod;          \n  }\n  ```\n\n\n## transform \n  1. __转换属性__\n    * transform-origin：指定元素变换的中心点\n    * transform-style：指定场景为 2D 或 3D\n    * perspective：指定 3D 的视距\n    * perspective-origin：设置视距的基点\n    * backface-visibility：是否可以看见 3D 场景背面\n  2. __2D变换__\n    * translate：位移，translate / translateX / translateY\n    * scale：缩放，scale / scaleX / scaleY\n    * rotate：旋转，rotate\n    * skew：变形，skew / skewX / skewY\n    * matrix：矩阵，是所有 2D 变换的本质\n  3. __3D变换__\n    * translate3d：位移，translate3d / translateZ\n    * scale3d：缩放，scale3d / scaleZ\n    * rotate3d：旋转，rotate3d / rotateX / rotateY / rotateZ\n    * matrix3d：矩阵，是所有 3D 变换的本质\n\n\n  ```scss\n  .img {\n      transform: rotate(30deg);\n      transform-origin: 200px 300px;\n\n      // 等价于 \n      transform: translate(200px, 300px) \n                rotate(30deg)\n                translate(-200px, -300px); \n      transform-origin: 0 0;\n  }\n\n  .box {\n      transform-style: preserve-3d;\n\n      /* perspective() 配合 transform 其他函数一起使用，\n      仅表示当前变形元素的视距 */\n      transform: perspective(200px) rotateY(45deg);\n\n      // perspective 指定子元素共享的视距 \n      perspective: 100px;\n\n      // center表示眼睛在场景正中心\n      perspective-origin: center;\n\n\n      img {\n          // 父元素不指定 3D 则失效 \n          transform: translateZ(16px);\n\n          // 让背面不可见，旋转时常用\n          backface-visibility: hidden;\n      }\n  }\n\n  ```\n\n\n## transition\n\n  1. __过渡效果__：默认样式中定义元素的初始样式和过渡函数，然后定义过渡后的元素样式\n  2. __缩写语法__：`transition：过渡属性 过渡时间 [过渡曲线] [时间延迟]`\n\n  ```css\n  .box {\n      width: 100px;\n      height: 20px;\n      background-color: orange;\n      /* transition: width 1s ease-in, backgroundColor 1s ease-in; */\n      transition: all 1s ease-in .2s;\n  }\n\n  .box:hover {\n      width: 300px;\n      background-color: red;\n  }\n  ```\n\n\n## animation\n\n  1. __动画效果__：通过 animation 绑定 @keyframes 定义的动画，自动实现一种或多种形态同时变化的效果\n  2. __动画定义__：`@keyframes 动画名{ //百分比 或 from、to }`\n  3. __动画绑定__：`animation: 动画名 时间 动画曲线 延迟时间 播放次数 是否逆向播放 [非动画时间的状态]`\n  4. __动画暂停__：`animation-play-state: paused;`\n\n  ```css\n  .box { \n      color: #f00; \n      font-size: 36px; \n      font-weight: bold;\n      animation: change 1s ease-in infinite; \n      /* animation-play-state: paused; */\n  }\n  @keyframes change {\n      0%   { text-shadow: 0 0 4px #f00 }\n      50%  { text-shadow: 0 0 40px #f00 }\n      100% { text-shadow: 0 0 4px #f00 }\n  }\n  ```\n  \n\n\n# 八、PC 端开发常用样式\n## 初始化\n  ```css\n  /* reset.css  */\n  body, h1, h2, h3, h4, h5, h6, hr, p, blockquote, dl, dt, dd, ul, ol, li, pre, form, fieldset, legend, button, input, textarea, th, td { margin:0; padding:0; } \n  body, button, input, select, textarea { font:12px/1.5tahoma, arial, \\5b8b\\4f53; } \n  h1, h2, h3, h4, h5, h6{ font-size:100%; } \n  address, cite, dfn, em, var { font-style:normal; } \n  code, kbd, pre, samp { font-family:couriernew, courier, monospace; } \n  small{ font-size:12px; } \n  ul, ol { list-style:none; } \n  a { text-decoration:none; color: #3D3F40; } \n  a:hover { color: #62B060; } \n  sup { vertical-align:text-top; } \n  sub{ vertical-align:text-bottom; } \n  fieldset, img { border:0; } \n  button, input, select, textarea { font-size:100%; } \n  table { border-collapse:collapse; border-spacing:0; }\n  body {\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n    -moz-osx-font-smoothing: grayscale;\n    -webkit-font-smoothing: antialiased;  /* 设置字体平滑 */\n    font-family: \"Microsoft YaHei\", 'Muli', \"Helvetica\", Arial, sans-serif;\n  }\n  ```\n\n\n## 滚动条 \n  ```css\n  /*  定义滚动条样式   */   \n  ::-webkit-scrollbar {   \n  /* ::-webkit-scrollbar:horizontal  */\n      width: 10px;   \n      height: 10px;  /*  高宽分别对应横竖滚动条的尺寸  */\n      background-color: #F5F5F5;   \n  }  \n  /*定义滚动条轨道 内阴影+圆角*/   \n  ::-webkit-scrollbar-track {   \n      box-shadow: inset 0 0 6px rgba(0,0,0,0.3);     \n      border-radius: 10px;   \n      background-color: #F5F5F5;   \n  }   \n  /*定义滑块 内阴影+圆角*/   \n  ::-webkit-scrollbar-thumb {   \n      border-radius: 10px;   \n      box-shadow: inset 0 0 6px rgba(0,0,0,.3);   \n      background-color: #C0C0C0;   \n  }  \n  ```\n\n\n## 元素居中 \n  ```css\n  /* 块中块元素 */\n  .div-child {\n      margin: 0 auto;  \n  }\n  .div-parent {\n      display: table-cell;   \n      vertical-align: middle; \n  }\n\n  /* 块中内联元素 */\n  .div-parent {\n      text-align: center;   \n      height: 100px;\n      line-height: 100px;  \n      \n      /* 其它方法垂直居中 */\n      display: table-cell;    \n      vertical-align: middle;\n  }\n\n  /* 不定宽高的水平、垂直居中 */\n  /* 1.定位 */\n  .parent {\n      position: relative;\n  }\n  .child { \n      position: absolute;\n      left: 50%;\n      top: 50%;\n      margin-left: -100px;   /* 自身宽度一半 */\n      margin-top: -50px;    /* 自身高度一半 */\n  }\n  /* 2.CSS3 */\n  .wrapper {\n      position: absolute;\n      top: 50%;\n      left: 50%;\n      z-index: 3;\n      transform: translate(-50%,-50%);\n  }\n  /* 3.flexbox方法 (设置父元素，让子元素水平居中) */\n  .parent {       \n      display:-webkit-flex;\n      justify-content:center;  \n      align-items:center;      \n  }  \n  ```\n\n\n## 布局方式 \n  ```css\n  /* 左边固定右边自适应的两列布局（定位和flex方式略） */\n  .parent::after {\n      content: \"\";            \n      display: block;\n      height: 0;               \n      visibility: hidden;     \n      clear: both;\n  }\n  .parent {  \n      *zoom : 1      \n  }\n  .left {\n      float: left;\n      width: 100px;\n  }\n  .right {\n      margin-left: 120px;  \n  }\n\n  /* 两边固定中间自适应的三列布局 (浮动和定位略) */\n  .parent {\n      display: flex;\n  }\n  .left,.right {\n      width: 100px;\n      height: 100px;\n  }\n  .middle {\n      flex: 1;\n      margin: 0 200px; \n  }\n\n  /* 移动端窗口居中布局 */\n  .text_box span {\n      color: #eff1f2;\n      display: block;\n      position: absolute;\n      left: 50vw;\n      top: 50vh;\n      transform: translate(-50%, -50%);  \n  }\n  .text_box div {\n      position: absolute;\n      left: 50vw;\n      top: 50vh;\n      transform: translate(-50%, -50%);\n      border-radius: 50%;\n      border: 1px solid #fff;\n      opacity: 0;\n  }\n  ```\n\n## 瀑布流布局\n<div style=\"text-indent: 2em\">原理是页面容器内的多个高度不固定的 div 之间按照一定的间隔参差不齐的无序浮动，鼠标滚动时不断在容器内的尾部加载数据并自动加载到空缺位置，不断循环。</div>\n<div style=\"text-indent: 2em\">核心是基于一个网格的布局，而且每行包含的项目列表高度是随机的（随自身内容动态改变高度），同时每个项目列表呈堆栈形式排列，最关键的是，堆栈之间彼此之间没有多余的间距差存大。</div>\n\n  ```css\n  /* 大层 */\n  .container {\n      width: 100%;\n      margin: 0 auto;\n  }\n\n  /* 瀑布流层 */\n  .waterfall {\n      column-count: 4;\n      column-gap: 1em;\n  }\n\n  /* 一个内容层 */\n  .item { \n      padding: 20px;\n      -webkit-column-break-inside: avoid; /* Chrome, Safari, Opera */\n      page-break-inside: avoid;  /* Firefox */\n      break-inside: avoid;       /* IE 10+ */\n      border: 1px solid #000;\n      height: 100%;\n      overflow: auto;\n  }\n  .item img {\n      width: 100%;\n      margin-bottom:10px;\n  }\n  ```\n\n\n## 表单元素\n  ```css\n  /* 清除默认框 */\n  input{\n      border: none / 0 ;  \n  }\n  /* 清除下拉框默认选择样式 */\n  select{\n    appearance: none;\n  }\n  /* 隐藏下拉箭头 */\n  select::-ms-expand { \n    display: none; \n  }\n\n  /* 应用于有焦点的元素(输入框, 超链接)具有焦点的时间内*/\n  a:focus, a:hover{ \n      outline: 1px  dotted red; \n      opacity: 0.6;\n  }\n  input:focus{ \n      background: yellow; \n  }\n\n  /* placeholder 颜色 */\n  ::-webkit-input-placeholder{  \n      color: #d3d3d3; \n  } \n  :-moz-placeholder{  \n      color: #d3d3d3; \n  } \n  ::-moz-placeholder{ \n      color: #d3d3d3;\n  } \n  :-ms-input-placeholder{  \n      color: #d3d3d3; \n  } \n  ```\n\n\n## 文本溢出省略\n  ```css\n  /* 单行文本 */\n  div{\n      width: 100px;\n      overflow: hidden;\n      text-overflow: ellipsis;  \n      white-space: nowrap;      \n  }\n\n  /* 多行文本 */\n  div{\n      width: 100px;\n      display: -webkit-box; \n      overflow: hidden; \n      text-overflow: ellipsis;\n      -webkit-line-clamp: 2;\n      -webkit-box-orient: vertical;\n  }\n  ```\n\n## 特殊图形\n```css\n/* 半圆 */\n.semi-circle {\n    width: 100px;\n    height: 50px;\n    background: red;\n    border-radius: 50px 50px 0 0;\n}\n/* 半椭圆 */\n.semiellipse {\n    margin-top: 30px;\n    width: 100px;\n    height: 50px;\n    background: red;\n    border-radius: 100% 0 0 100% /50%;\n}\n/* 椭圆 */\n.ellipse {\n    width: 100px;\n    height: 50px;\n    background: red;\n    border-radius: 50px/25px;\n}\n\n/* 梯形 */\n.echelon {\n    width: 600px;\n    border: 100px solid;\n    border-color: transparent transparent #c00;\n}\n\n/* 三栏 */\n.three-cols {\n    width: 150px;\n    height: 30px;\n    padding: 15px 0;\n    border-top: 30px solid;\n    border-bottom: 30px solid;\n    background-color: currentColor;\n    background-clip: content-box;\n}\n\n/* 多层阴影 */\n.shadows {\n    width: 100px;\n    height: 100px;\n    background-color: #fff;\n    border: 5px solid black;\n    box-shadow: 0 0 0 5px green,0 0 0 10px red;\n}\n\n/* <div class=\"demo\" data-title=\"hello world\">title悬浮框</div> */\n.title {\n    margin-top: 100px;\n    margin-left: 100px;\n    position: relative;\n}\n.title:hover::after {\n    content: attr(data-title);/* 取到data-title属性的值 */\n    display: inline-block;\n    padding: 10px 14px;\n    border: 1px solid #ddd;\n    border-radius: 5px;\n    position: absolute;\n    top: -50px;\n    left: -30px;\n}\n\n/* 眼睛 */\n.eye {\n    width: 150px;\n    height: 150px;\n    padding: 10px;\n    border: 10px solid;\n    border-radius: 50%;\n    background-color: currentColor;\n    background-clip: content-box;\n}\n\n/* 放大镜 */\n.magnifier {\n    width: 50px;\n    height: 50px;\n    border-radius: 50%;\n    border: 5px solid #333;\n    position: relative;\n}\n.magnifier::after {\n    content: '';\n    display: block;    \n    width: 8px;    \n    height: 60px;    \n    border-radius: 5px;    \n    background: #333;    \n    position: absolute;    \n    right: -22px;    \n    top: 38px;    \n    transform: rotate(-45deg);\n}\n```\n\n\n","source":"_posts/5-html和css.md","raw":"---\ntitle: PC 端开发常用标签和样式\ntags:\n  - HTML\n  - CSS\ncategories: HTML + CSS\ntop: false\nkeywords:\n  - html\n  - css\ndate: 2019-03-06 22:32:08\ndescription: HTML、CSS\n\n---\n\n# 一、HTML 元素\n> __相互转换：display__ \n\n  * 块级元素：独占一行、可设宽高、不设宽度时默认是其父元素的100%\n    * 常用5个标签：h、p、ul、div、table\n    * 6大属性：width、height、background、border、padding、margin \n  * 行内元素：一行可放多个、宽高不可设置、宽度包裹内容\n    * 常用标签：a、span、label、strong\n  * 行内块元素：一行多个、可设宽高  \n    * 常用标签：img、input等\n  \n\n\n# 二、浮动\n## float\n  1. 设计初衷：文字环绕效果\n  2. 主要特性：包裹性 和 破坏性\n\n## 清除浮动\n  1. 本质：清除浮动元素对后面元素的影响\n  2. 方法\n    * 给父元素指定高度：不太灵活\n    * 在浮动元素后面盒子添加 clear: both\n    * 给浮动元素父元素添加 overflow: hidden/auto\n    * 底部添加伪元素 after \n  3. 特例：父元素有浮动/绝对定位时不需清除\n  4. 经典方法\n    ```css\n    div::after {\n        content: \"\";       /* 添加内容为空 */   \n        display: block;\n        height: 0;           /* 不占空间 */\n        visibility: hidden;  /* 不可见  */   \n        clear: both\n    }\n    div {  \n        *zoom : 1;   /* 兼容低版本浏览器 */   \n    }\n    ```\n\n# 三、布局模型\n> 网页布局：整体布局用浮动，局部布局用定位\n\n  1. 流动模型：浏览器默认的文档流。块级元素自下而上、内联元素自左而右按顺序排列\n  2. 浮动模型：浮动流。元素脱离文档流而释放空间，但浮动元素不能遮挡后面文档流中内容的正常显示\n  3. 层模型：定位流。父元素相对定位，子元素绝对定位/固定定位，z-index规定定位元素的堆叠顺序\n\n\n# 四、常用知识点\n  * 文件引入优先级：就近原则，距离相应代码近的引入方式优先级高\n  * 浏览器读取规则：从右向左，因为相比从左到右匹配更快、性能更优\n  * 元素隐藏方法：display、Opacity、visibility、hide、遮罩等\n  * 元素间距处理：父子元素的间距给父元素加 padding，同级元素的间距则给一个元素加 margin\n  * 伪类和伪元素：`:hover、:link 等伪类`用于向已有元素添加特殊效果，`::before、::after 等伪元素`用于新建抽象元素并添加样式从而实现特殊效果\n\n\n# 五、css 单位\n  * __rem__: 相对于根元素字体尺寸\n  * __em__: 相对于父级元素的字体尺寸\n  * __%__: 百分比，相对于父元素的尺寸\n  * __px__: 像素，相对于用户设备分辨率的最基本单元\n  * pt：Word等办公软件中使用的字体大小单位\n  * dp：安卓开发时使用的长度单位\n  * sp：安卓开发时使用的字体大小单位\n  * vw：视窗宽度，1vw等于视窗宽度的 1%\n  * vh：视窗高度，1vh等于视窗高度的 1%\n  * vmin / vmax：vw和vh中较 小/大 的那个\n\n\n# 六、浏览器兼容\n\n## 常见兼容问题\n  * __img 之间出现间距__：浮动\n  * __上下 margin 重合问题__：上下选一个\n  * __opacity、placeholder、outline、伪元素、z-index__  \n  * __子元素的 margin-top,会出现在父元素的上方__\n    * 给父元素加 overflow: hidden\n    * 能用 padding-top 替代时就替代\n    * 给父元素设置 border: 1px solid transparent\n  * __li 元素使用 display: inline-block 时会出现缝隙__\n    * 使用浮动\n    * 给li重新设置字号 font-size: 0 \n\n\n## css hack\n> 针对不同的浏览器写不同的 CSS 来解决浏览器兼容\n\n  * 选择器前缀法：@media screen\n  * CSS 属性前缀法：-webkit-、-moz-、-ms-、-o-\n  * IE 条件注释语句：解决 IE 兼容问题\n\n\n# 七、CSS3\n\n## 引用字体文件\n  ```css\n  @font-face {                       \n      font-family: ArtifaktBlod;     \n      src: url('fonts/ArtifaktElementOfc-Bold.ttf');  /* 引入字体资源 */    \n  }  \n  div {\n      font-family: ArtifaktBlod;          \n  }\n  ```\n\n\n## transform \n  1. __转换属性__\n    * transform-origin：指定元素变换的中心点\n    * transform-style：指定场景为 2D 或 3D\n    * perspective：指定 3D 的视距\n    * perspective-origin：设置视距的基点\n    * backface-visibility：是否可以看见 3D 场景背面\n  2. __2D变换__\n    * translate：位移，translate / translateX / translateY\n    * scale：缩放，scale / scaleX / scaleY\n    * rotate：旋转，rotate\n    * skew：变形，skew / skewX / skewY\n    * matrix：矩阵，是所有 2D 变换的本质\n  3. __3D变换__\n    * translate3d：位移，translate3d / translateZ\n    * scale3d：缩放，scale3d / scaleZ\n    * rotate3d：旋转，rotate3d / rotateX / rotateY / rotateZ\n    * matrix3d：矩阵，是所有 3D 变换的本质\n\n\n  ```scss\n  .img {\n      transform: rotate(30deg);\n      transform-origin: 200px 300px;\n\n      // 等价于 \n      transform: translate(200px, 300px) \n                rotate(30deg)\n                translate(-200px, -300px); \n      transform-origin: 0 0;\n  }\n\n  .box {\n      transform-style: preserve-3d;\n\n      /* perspective() 配合 transform 其他函数一起使用，\n      仅表示当前变形元素的视距 */\n      transform: perspective(200px) rotateY(45deg);\n\n      // perspective 指定子元素共享的视距 \n      perspective: 100px;\n\n      // center表示眼睛在场景正中心\n      perspective-origin: center;\n\n\n      img {\n          // 父元素不指定 3D 则失效 \n          transform: translateZ(16px);\n\n          // 让背面不可见，旋转时常用\n          backface-visibility: hidden;\n      }\n  }\n\n  ```\n\n\n## transition\n\n  1. __过渡效果__：默认样式中定义元素的初始样式和过渡函数，然后定义过渡后的元素样式\n  2. __缩写语法__：`transition：过渡属性 过渡时间 [过渡曲线] [时间延迟]`\n\n  ```css\n  .box {\n      width: 100px;\n      height: 20px;\n      background-color: orange;\n      /* transition: width 1s ease-in, backgroundColor 1s ease-in; */\n      transition: all 1s ease-in .2s;\n  }\n\n  .box:hover {\n      width: 300px;\n      background-color: red;\n  }\n  ```\n\n\n## animation\n\n  1. __动画效果__：通过 animation 绑定 @keyframes 定义的动画，自动实现一种或多种形态同时变化的效果\n  2. __动画定义__：`@keyframes 动画名{ //百分比 或 from、to }`\n  3. __动画绑定__：`animation: 动画名 时间 动画曲线 延迟时间 播放次数 是否逆向播放 [非动画时间的状态]`\n  4. __动画暂停__：`animation-play-state: paused;`\n\n  ```css\n  .box { \n      color: #f00; \n      font-size: 36px; \n      font-weight: bold;\n      animation: change 1s ease-in infinite; \n      /* animation-play-state: paused; */\n  }\n  @keyframes change {\n      0%   { text-shadow: 0 0 4px #f00 }\n      50%  { text-shadow: 0 0 40px #f00 }\n      100% { text-shadow: 0 0 4px #f00 }\n  }\n  ```\n  \n\n\n# 八、PC 端开发常用样式\n## 初始化\n  ```css\n  /* reset.css  */\n  body, h1, h2, h3, h4, h5, h6, hr, p, blockquote, dl, dt, dd, ul, ol, li, pre, form, fieldset, legend, button, input, textarea, th, td { margin:0; padding:0; } \n  body, button, input, select, textarea { font:12px/1.5tahoma, arial, \\5b8b\\4f53; } \n  h1, h2, h3, h4, h5, h6{ font-size:100%; } \n  address, cite, dfn, em, var { font-style:normal; } \n  code, kbd, pre, samp { font-family:couriernew, courier, monospace; } \n  small{ font-size:12px; } \n  ul, ol { list-style:none; } \n  a { text-decoration:none; color: #3D3F40; } \n  a:hover { color: #62B060; } \n  sup { vertical-align:text-top; } \n  sub{ vertical-align:text-bottom; } \n  fieldset, img { border:0; } \n  button, input, select, textarea { font-size:100%; } \n  table { border-collapse:collapse; border-spacing:0; }\n  body {\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n    -moz-osx-font-smoothing: grayscale;\n    -webkit-font-smoothing: antialiased;  /* 设置字体平滑 */\n    font-family: \"Microsoft YaHei\", 'Muli', \"Helvetica\", Arial, sans-serif;\n  }\n  ```\n\n\n## 滚动条 \n  ```css\n  /*  定义滚动条样式   */   \n  ::-webkit-scrollbar {   \n  /* ::-webkit-scrollbar:horizontal  */\n      width: 10px;   \n      height: 10px;  /*  高宽分别对应横竖滚动条的尺寸  */\n      background-color: #F5F5F5;   \n  }  \n  /*定义滚动条轨道 内阴影+圆角*/   \n  ::-webkit-scrollbar-track {   \n      box-shadow: inset 0 0 6px rgba(0,0,0,0.3);     \n      border-radius: 10px;   \n      background-color: #F5F5F5;   \n  }   \n  /*定义滑块 内阴影+圆角*/   \n  ::-webkit-scrollbar-thumb {   \n      border-radius: 10px;   \n      box-shadow: inset 0 0 6px rgba(0,0,0,.3);   \n      background-color: #C0C0C0;   \n  }  \n  ```\n\n\n## 元素居中 \n  ```css\n  /* 块中块元素 */\n  .div-child {\n      margin: 0 auto;  \n  }\n  .div-parent {\n      display: table-cell;   \n      vertical-align: middle; \n  }\n\n  /* 块中内联元素 */\n  .div-parent {\n      text-align: center;   \n      height: 100px;\n      line-height: 100px;  \n      \n      /* 其它方法垂直居中 */\n      display: table-cell;    \n      vertical-align: middle;\n  }\n\n  /* 不定宽高的水平、垂直居中 */\n  /* 1.定位 */\n  .parent {\n      position: relative;\n  }\n  .child { \n      position: absolute;\n      left: 50%;\n      top: 50%;\n      margin-left: -100px;   /* 自身宽度一半 */\n      margin-top: -50px;    /* 自身高度一半 */\n  }\n  /* 2.CSS3 */\n  .wrapper {\n      position: absolute;\n      top: 50%;\n      left: 50%;\n      z-index: 3;\n      transform: translate(-50%,-50%);\n  }\n  /* 3.flexbox方法 (设置父元素，让子元素水平居中) */\n  .parent {       \n      display:-webkit-flex;\n      justify-content:center;  \n      align-items:center;      \n  }  \n  ```\n\n\n## 布局方式 \n  ```css\n  /* 左边固定右边自适应的两列布局（定位和flex方式略） */\n  .parent::after {\n      content: \"\";            \n      display: block;\n      height: 0;               \n      visibility: hidden;     \n      clear: both;\n  }\n  .parent {  \n      *zoom : 1      \n  }\n  .left {\n      float: left;\n      width: 100px;\n  }\n  .right {\n      margin-left: 120px;  \n  }\n\n  /* 两边固定中间自适应的三列布局 (浮动和定位略) */\n  .parent {\n      display: flex;\n  }\n  .left,.right {\n      width: 100px;\n      height: 100px;\n  }\n  .middle {\n      flex: 1;\n      margin: 0 200px; \n  }\n\n  /* 移动端窗口居中布局 */\n  .text_box span {\n      color: #eff1f2;\n      display: block;\n      position: absolute;\n      left: 50vw;\n      top: 50vh;\n      transform: translate(-50%, -50%);  \n  }\n  .text_box div {\n      position: absolute;\n      left: 50vw;\n      top: 50vh;\n      transform: translate(-50%, -50%);\n      border-radius: 50%;\n      border: 1px solid #fff;\n      opacity: 0;\n  }\n  ```\n\n## 瀑布流布局\n<div style=\"text-indent: 2em\">原理是页面容器内的多个高度不固定的 div 之间按照一定的间隔参差不齐的无序浮动，鼠标滚动时不断在容器内的尾部加载数据并自动加载到空缺位置，不断循环。</div>\n<div style=\"text-indent: 2em\">核心是基于一个网格的布局，而且每行包含的项目列表高度是随机的（随自身内容动态改变高度），同时每个项目列表呈堆栈形式排列，最关键的是，堆栈之间彼此之间没有多余的间距差存大。</div>\n\n  ```css\n  /* 大层 */\n  .container {\n      width: 100%;\n      margin: 0 auto;\n  }\n\n  /* 瀑布流层 */\n  .waterfall {\n      column-count: 4;\n      column-gap: 1em;\n  }\n\n  /* 一个内容层 */\n  .item { \n      padding: 20px;\n      -webkit-column-break-inside: avoid; /* Chrome, Safari, Opera */\n      page-break-inside: avoid;  /* Firefox */\n      break-inside: avoid;       /* IE 10+ */\n      border: 1px solid #000;\n      height: 100%;\n      overflow: auto;\n  }\n  .item img {\n      width: 100%;\n      margin-bottom:10px;\n  }\n  ```\n\n\n## 表单元素\n  ```css\n  /* 清除默认框 */\n  input{\n      border: none / 0 ;  \n  }\n  /* 清除下拉框默认选择样式 */\n  select{\n    appearance: none;\n  }\n  /* 隐藏下拉箭头 */\n  select::-ms-expand { \n    display: none; \n  }\n\n  /* 应用于有焦点的元素(输入框, 超链接)具有焦点的时间内*/\n  a:focus, a:hover{ \n      outline: 1px  dotted red; \n      opacity: 0.6;\n  }\n  input:focus{ \n      background: yellow; \n  }\n\n  /* placeholder 颜色 */\n  ::-webkit-input-placeholder{  \n      color: #d3d3d3; \n  } \n  :-moz-placeholder{  \n      color: #d3d3d3; \n  } \n  ::-moz-placeholder{ \n      color: #d3d3d3;\n  } \n  :-ms-input-placeholder{  \n      color: #d3d3d3; \n  } \n  ```\n\n\n## 文本溢出省略\n  ```css\n  /* 单行文本 */\n  div{\n      width: 100px;\n      overflow: hidden;\n      text-overflow: ellipsis;  \n      white-space: nowrap;      \n  }\n\n  /* 多行文本 */\n  div{\n      width: 100px;\n      display: -webkit-box; \n      overflow: hidden; \n      text-overflow: ellipsis;\n      -webkit-line-clamp: 2;\n      -webkit-box-orient: vertical;\n  }\n  ```\n\n## 特殊图形\n```css\n/* 半圆 */\n.semi-circle {\n    width: 100px;\n    height: 50px;\n    background: red;\n    border-radius: 50px 50px 0 0;\n}\n/* 半椭圆 */\n.semiellipse {\n    margin-top: 30px;\n    width: 100px;\n    height: 50px;\n    background: red;\n    border-radius: 100% 0 0 100% /50%;\n}\n/* 椭圆 */\n.ellipse {\n    width: 100px;\n    height: 50px;\n    background: red;\n    border-radius: 50px/25px;\n}\n\n/* 梯形 */\n.echelon {\n    width: 600px;\n    border: 100px solid;\n    border-color: transparent transparent #c00;\n}\n\n/* 三栏 */\n.three-cols {\n    width: 150px;\n    height: 30px;\n    padding: 15px 0;\n    border-top: 30px solid;\n    border-bottom: 30px solid;\n    background-color: currentColor;\n    background-clip: content-box;\n}\n\n/* 多层阴影 */\n.shadows {\n    width: 100px;\n    height: 100px;\n    background-color: #fff;\n    border: 5px solid black;\n    box-shadow: 0 0 0 5px green,0 0 0 10px red;\n}\n\n/* <div class=\"demo\" data-title=\"hello world\">title悬浮框</div> */\n.title {\n    margin-top: 100px;\n    margin-left: 100px;\n    position: relative;\n}\n.title:hover::after {\n    content: attr(data-title);/* 取到data-title属性的值 */\n    display: inline-block;\n    padding: 10px 14px;\n    border: 1px solid #ddd;\n    border-radius: 5px;\n    position: absolute;\n    top: -50px;\n    left: -30px;\n}\n\n/* 眼睛 */\n.eye {\n    width: 150px;\n    height: 150px;\n    padding: 10px;\n    border: 10px solid;\n    border-radius: 50%;\n    background-color: currentColor;\n    background-clip: content-box;\n}\n\n/* 放大镜 */\n.magnifier {\n    width: 50px;\n    height: 50px;\n    border-radius: 50%;\n    border: 5px solid #333;\n    position: relative;\n}\n.magnifier::after {\n    content: '';\n    display: block;    \n    width: 8px;    \n    height: 60px;    \n    border-radius: 5px;    \n    background: #333;    \n    position: absolute;    \n    right: -22px;    \n    top: 38px;    \n    transform: rotate(-45deg);\n}\n```\n\n\n","slug":"5-html和css","published":1,"updated":"2019-04-14T14:49:35.251Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvid4pj3000j0nbxlbl4lwev","content":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><html><head></head><body><h1 id=\"一、HTML-元素\"><a href=\"#一、HTML-元素\" class=\"headerlink\" title=\"一、HTML 元素\"></a>一、HTML 元素</h1><blockquote><p><strong>相互转换：display</strong></p></blockquote><ul><li>块级元素：独占一行、可设宽高、不设宽度时默认是其父元素的100%<ul><li>常用5个标签：h、p、ul、div、table</li><li>6大属性：width、height、background、border、padding、margin</li></ul></li><li>行内元素：一行可放多个、宽高不可设置、宽度包裹内容<ul><li>常用标签：a、span、label、strong</li></ul></li><li>行内块元素：一行多个、可设宽高<ul><li>常用标签：img、input等</li></ul></li></ul><h1 id=\"二、浮动\"><a href=\"#二、浮动\" class=\"headerlink\" title=\"二、浮动\"></a>二、浮动</h1><h2 id=\"float\"><a href=\"#float\" class=\"headerlink\" title=\"float\"></a>float</h2><ol><li>设计初衷：文字环绕效果</li><li>主要特性：包裹性 和 破坏性</li></ol><h2 id=\"清除浮动\"><a href=\"#清除浮动\" class=\"headerlink\" title=\"清除浮动\"></a>清除浮动</h2><ol><li>本质：清除浮动元素对后面元素的影响</li><li>方法<ul><li>给父元素指定高度：不太灵活</li><li>在浮动元素后面盒子添加 clear: both</li><li>给浮动元素父元素添加 overflow: hidden/auto</li><li>底部添加伪元素 after</li></ul></li><li>特例：父元素有浮动/绝对定位时不需清除</li><li>经典方法<figure class=\"highlight css\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">div</span><span class=\"selector-pseudo\">::after</span> {</span><br><span class=\"line\">    <span class=\"attribute\">content</span>: <span class=\"string\">\"\"</span>;       <span class=\"comment\">/* 添加内容为空 */</span>   </span><br><span class=\"line\">    <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">0</span>;           <span class=\"comment\">/* 不占空间 */</span></span><br><span class=\"line\">    <span class=\"attribute\">visibility</span>: hidden;  <span class=\"comment\">/* 不可见  */</span>   </span><br><span class=\"line\">    <span class=\"attribute\">clear</span>: both</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-tag\">div</span> {  </span><br><span class=\"line\">    *zoom : 1;   /* 兼容低版本浏览器 */   </span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure></li></ol><h1 id=\"三、布局模型\"><a href=\"#三、布局模型\" class=\"headerlink\" title=\"三、布局模型\"></a>三、布局模型</h1><blockquote><p>网页布局：整体布局用浮动，局部布局用定位</p></blockquote><ol><li>流动模型：浏览器默认的文档流。块级元素自下而上、内联元素自左而右按顺序排列</li><li>浮动模型：浮动流。元素脱离文档流而释放空间，但浮动元素不能遮挡后面文档流中内容的正常显示</li><li>层模型：定位流。父元素相对定位，子元素绝对定位/固定定位，z-index规定定位元素的堆叠顺序</li></ol><h1 id=\"四、常用知识点\"><a href=\"#四、常用知识点\" class=\"headerlink\" title=\"四、常用知识点\"></a>四、常用知识点</h1><ul><li>文件引入优先级：就近原则，距离相应代码近的引入方式优先级高</li><li>浏览器读取规则：从右向左，因为相比从左到右匹配更快、性能更优</li><li>元素隐藏方法：display、Opacity、visibility、hide、遮罩等</li><li>元素间距处理：父子元素的间距给父元素加 padding，同级元素的间距则给一个元素加 margin</li><li>伪类和伪元素：<code>:hover、:link 等伪类</code>用于向已有元素添加特殊效果，<code>::before、::after 等伪元素</code>用于新建抽象元素并添加样式从而实现特殊效果</li></ul><h1 id=\"五、css-单位\"><a href=\"#五、css-单位\" class=\"headerlink\" title=\"五、css 单位\"></a>五、css 单位</h1><ul><li><strong>rem</strong>: 相对于根元素字体尺寸</li><li><strong>em</strong>: 相对于父级元素的字体尺寸</li><li><strong>%</strong>: 百分比，相对于父元素的尺寸</li><li><strong>px</strong>: 像素，相对于用户设备分辨率的最基本单元</li><li>pt：Word等办公软件中使用的字体大小单位</li><li>dp：安卓开发时使用的长度单位</li><li>sp：安卓开发时使用的字体大小单位</li><li>vw：视窗宽度，1vw等于视窗宽度的 1%</li><li>vh：视窗高度，1vh等于视窗高度的 1%</li><li>vmin / vmax：vw和vh中较 小/大 的那个</li></ul><h1 id=\"六、浏览器兼容\"><a href=\"#六、浏览器兼容\" class=\"headerlink\" title=\"六、浏览器兼容\"></a>六、浏览器兼容</h1><h2 id=\"常见兼容问题\"><a href=\"#常见兼容问题\" class=\"headerlink\" title=\"常见兼容问题\"></a>常见兼容问题</h2><ul><li><strong>img 之间出现间距</strong>：浮动</li><li><strong>上下 margin 重合问题</strong>：上下选一个</li><li><strong>opacity、placeholder、outline、伪元素、z-index</strong></li><li><strong>子元素的 margin-top,会出现在父元素的上方</strong><ul><li>给父元素加 overflow: hidden</li><li>能用 padding-top 替代时就替代</li><li>给父元素设置 border: 1px solid transparent</li></ul></li><li><strong>li 元素使用 display: inline-block 时会出现缝隙</strong><ul><li>使用浮动</li><li>给li重新设置字号 font-size: 0</li></ul></li></ul><h2 id=\"css-hack\"><a href=\"#css-hack\" class=\"headerlink\" title=\"css hack\"></a>css hack</h2><blockquote><p>针对不同的浏览器写不同的 CSS 来解决浏览器兼容</p></blockquote><ul><li>选择器前缀法：@media screen</li><li>CSS 属性前缀法：-webkit-、-moz-、-ms-、-o-</li><li>IE 条件注释语句：解决 IE 兼容问题</li></ul><h1 id=\"七、CSS3\"><a href=\"#七、CSS3\" class=\"headerlink\" title=\"七、CSS3\"></a>七、CSS3</h1><h2 id=\"引用字体文件\"><a href=\"#引用字体文件\" class=\"headerlink\" title=\"引用字体文件\"></a>引用字体文件</h2><figure class=\"highlight css\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"keyword\">font-face</span> {                       </span><br><span class=\"line\">    <span class=\"attribute\">font-family</span>: ArtifaktBlod;     </span><br><span class=\"line\">    <span class=\"attribute\">src</span>: <span class=\"built_in\">url</span>(<span class=\"string\">'fonts/ArtifaktElementOfc-Bold.ttf'</span>);  <span class=\"comment\">/* 引入字体资源 */</span>    </span><br><span class=\"line\">}  </span><br><span class=\"line\"><span class=\"selector-tag\">div</span> {</span><br><span class=\"line\">    <span class=\"attribute\">font-family</span>: ArtifaktBlod;          </span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"transform\"><a href=\"#transform\" class=\"headerlink\" title=\"transform\"></a>transform</h2><ol><li><strong>转换属性</strong><ul><li>transform-origin：指定元素变换的中心点</li><li>transform-style：指定场景为 2D 或 3D</li><li>perspective：指定 3D 的视距</li><li>perspective-origin：设置视距的基点</li><li>backface-visibility：是否可以看见 3D 场景背面</li></ul></li><li><strong>2D变换</strong><ul><li>translate：位移，translate / translateX / translateY</li><li>scale：缩放，scale / scaleX / scaleY</li><li>rotate：旋转，rotate</li><li>skew：变形，skew / skewX / skewY</li><li>matrix：矩阵，是所有 2D 变换的本质</li></ul></li><li><strong>3D变换</strong><ul><li>translate3d：位移，translate3d / translateZ</li><li>scale3d：缩放，scale3d / scaleZ</li><li>rotate3d：旋转，rotate3d / rotateX / rotateY / rotateZ</li><li>matrix3d：矩阵，是所有 3D 变换的本质</li></ul></li></ol><figure class=\"highlight scss\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.img</span> {</span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: rotate(<span class=\"number\">30deg</span>);</span><br><span class=\"line\">    <span class=\"attribute\">transform-origin</span>: <span class=\"number\">200px</span> <span class=\"number\">300px</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 等价于 </span></span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: translate(<span class=\"number\">200px</span>, <span class=\"number\">300px</span>) </span><br><span class=\"line\">              rotate(<span class=\"number\">30deg</span>)</span><br><span class=\"line\">              translate(-<span class=\"number\">200px</span>, -<span class=\"number\">300px</span>); </span><br><span class=\"line\">    <span class=\"attribute\">transform-origin</span>: <span class=\"number\">0</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.box</span> {</span><br><span class=\"line\">    <span class=\"attribute\">transform-style</span>: preserve-<span class=\"number\">3</span>d;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* perspective() 配合 transform 其他函数一起使用，</span></span><br><span class=\"line\"><span class=\"comment\">    仅表示当前变形元素的视距 */</span></span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: perspective(<span class=\"number\">200px</span>) rotateY(<span class=\"number\">45deg</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// perspective 指定子元素共享的视距 </span></span><br><span class=\"line\">    <span class=\"attribute\">perspective</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// center表示眼睛在场景正中心</span></span><br><span class=\"line\">    <span class=\"attribute\">perspective-origin</span>: center;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-tag\">img</span> {</span><br><span class=\"line\">        <span class=\"comment\">// 父元素不指定 3D 则失效 </span></span><br><span class=\"line\">        <span class=\"attribute\">transform</span>: translateZ(<span class=\"number\">16px</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 让背面不可见，旋转时常用</span></span><br><span class=\"line\">        <span class=\"attribute\">backface-visibility</span>: hidden;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"transition\"><a href=\"#transition\" class=\"headerlink\" title=\"transition\"></a>transition</h2><ol><li><strong>过渡效果</strong>：默认样式中定义元素的初始样式和过渡函数，然后定义过渡后的元素样式</li><li><p><strong>缩写语法</strong>：<code>transition：过渡属性 过渡时间 [过渡曲线] [时间延迟]</code></p><figure class=\"highlight css\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.box</span> {</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: orange;</span><br><span class=\"line\">    <span class=\"comment\">/* transition: width 1s ease-in, backgroundColor 1s ease-in; */</span></span><br><span class=\"line\">    <span class=\"attribute\">transition</span>: all <span class=\"number\">1s</span> ease-in .<span class=\"number\">2s</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.box</span><span class=\"selector-pseudo\">:hover</span> {</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">300px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: red;</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure></li></ol><h2 id=\"animation\"><a href=\"#animation\" class=\"headerlink\" title=\"animation\"></a>animation</h2><ol><li><strong>动画效果</strong>：通过 animation 绑定 @keyframes 定义的动画，自动实现一种或多种形态同时变化的效果</li><li><strong>动画定义</strong>：<code>@keyframes 动画名{ //百分比 或 from、to }</code></li><li><strong>动画绑定</strong>：<code>animation: 动画名 时间 动画曲线 延迟时间 播放次数 是否逆向播放 [非动画时间的状态]</code></li><li><p><strong>动画暂停</strong>：<code>animation-play-state: paused;</code></p><figure class=\"highlight css\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.box</span> { </span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#f00</span>; </span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">36px</span>; </span><br><span class=\"line\">    <span class=\"attribute\">font-weight</span>: bold;</span><br><span class=\"line\">    <span class=\"attribute\">animation</span>: change <span class=\"number\">1s</span> ease-in infinite; </span><br><span class=\"line\">    <span class=\"comment\">/* animation-play-state: paused; */</span></span><br><span class=\"line\">}</span><br><span class=\"line\">@<span class=\"keyword\">keyframes</span> change {</span><br><span class=\"line\">    0%   { <span class=\"attribute\">text-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">4px</span> <span class=\"number\">#f00</span> }</span><br><span class=\"line\">    50%  { <span class=\"attribute\">text-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">40px</span> <span class=\"number\">#f00</span> }</span><br><span class=\"line\">    100% { <span class=\"attribute\">text-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">4px</span> <span class=\"number\">#f00</span> }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure></li></ol><h1 id=\"八、PC-端开发常用样式\"><a href=\"#八、PC-端开发常用样式\" class=\"headerlink\" title=\"八、PC 端开发常用样式\"></a>八、PC 端开发常用样式</h1><h2 id=\"初始化\"><a href=\"#初始化\" class=\"headerlink\" title=\"初始化\"></a>初始化</h2><figure class=\"highlight css\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* reset.css  */</span></span><br><span class=\"line\"><span class=\"selector-tag\">body</span>, <span class=\"selector-tag\">h1</span>, <span class=\"selector-tag\">h2</span>, <span class=\"selector-tag\">h3</span>, <span class=\"selector-tag\">h4</span>, <span class=\"selector-tag\">h5</span>, <span class=\"selector-tag\">h6</span>, <span class=\"selector-tag\">hr</span>, <span class=\"selector-tag\">p</span>, <span class=\"selector-tag\">blockquote</span>, <span class=\"selector-tag\">dl</span>, <span class=\"selector-tag\">dt</span>, <span class=\"selector-tag\">dd</span>, <span class=\"selector-tag\">ul</span>, <span class=\"selector-tag\">ol</span>, <span class=\"selector-tag\">li</span>, <span class=\"selector-tag\">pre</span>, <span class=\"selector-tag\">form</span>, <span class=\"selector-tag\">fieldset</span>, <span class=\"selector-tag\">legend</span>, <span class=\"selector-tag\">button</span>, <span class=\"selector-tag\">input</span>, <span class=\"selector-tag\">textarea</span>, <span class=\"selector-tag\">th</span>, <span class=\"selector-tag\">td</span> { <span class=\"attribute\">margin</span>:<span class=\"number\">0</span>; <span class=\"attribute\">padding</span>:<span class=\"number\">0</span>; } </span><br><span class=\"line\"><span class=\"selector-tag\">body</span>, <span class=\"selector-tag\">button</span>, <span class=\"selector-tag\">input</span>, <span class=\"selector-tag\">select</span>, <span class=\"selector-tag\">textarea</span> { <span class=\"attribute\">font</span>:<span class=\"number\">12px</span>/<span class=\"number\">1.5</span>tahoma, arial, \\<span class=\"number\">5</span>b8b\\<span class=\"number\">4</span>f53; } </span><br><span class=\"line\"><span class=\"selector-tag\">h1</span>, <span class=\"selector-tag\">h2</span>, <span class=\"selector-tag\">h3</span>, <span class=\"selector-tag\">h4</span>, <span class=\"selector-tag\">h5</span>, <span class=\"selector-tag\">h6</span>{ <span class=\"attribute\">font-size</span>:<span class=\"number\">100%</span>; } </span><br><span class=\"line\"><span class=\"selector-tag\">address</span>, <span class=\"selector-tag\">cite</span>, <span class=\"selector-tag\">dfn</span>, <span class=\"selector-tag\">em</span>, <span class=\"selector-tag\">var</span> { <span class=\"attribute\">font-style</span>:normal; } </span><br><span class=\"line\"><span class=\"selector-tag\">code</span>, <span class=\"selector-tag\">kbd</span>, <span class=\"selector-tag\">pre</span>, <span class=\"selector-tag\">samp</span> { <span class=\"attribute\">font-family</span>:couriernew, courier, monospace; } </span><br><span class=\"line\"><span class=\"selector-tag\">small</span>{ <span class=\"attribute\">font-size</span>:<span class=\"number\">12px</span>; } </span><br><span class=\"line\"><span class=\"selector-tag\">ul</span>, <span class=\"selector-tag\">ol</span> { <span class=\"attribute\">list-style</span>:none; } </span><br><span class=\"line\"><span class=\"selector-tag\">a</span> { <span class=\"attribute\">text-decoration</span>:none; <span class=\"attribute\">color</span>: <span class=\"number\">#3D3F40</span>; } </span><br><span class=\"line\"><span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:hover</span> { <span class=\"attribute\">color</span>: <span class=\"number\">#62B060</span>; } </span><br><span class=\"line\"><span class=\"selector-tag\">sup</span> { <span class=\"attribute\">vertical-align</span>:text-top; } </span><br><span class=\"line\"><span class=\"selector-tag\">sub</span>{ <span class=\"attribute\">vertical-align</span>:text-bottom; } </span><br><span class=\"line\"><span class=\"selector-tag\">fieldset</span>, <span class=\"selector-tag\">img</span> { <span class=\"attribute\">border</span>:<span class=\"number\">0</span>; } </span><br><span class=\"line\"><span class=\"selector-tag\">button</span>, <span class=\"selector-tag\">input</span>, <span class=\"selector-tag\">select</span>, <span class=\"selector-tag\">textarea</span> { <span class=\"attribute\">font-size</span>:<span class=\"number\">100%</span>; } </span><br><span class=\"line\"><span class=\"selector-tag\">table</span> { <span class=\"attribute\">border-collapse</span>:collapse; <span class=\"attribute\">border-spacing</span>:<span class=\"number\">0</span>; }</span><br><span class=\"line\"><span class=\"selector-tag\">body</span> {</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">  <span class=\"attribute\">-moz-osx-font-smoothing</span>: grayscale;</span><br><span class=\"line\">  <span class=\"attribute\">-webkit-font-smoothing</span>: antialiased;  <span class=\"comment\">/* 设置字体平滑 */</span></span><br><span class=\"line\">  <span class=\"attribute\">font-family</span>: <span class=\"string\">\"Microsoft YaHei\"</span>, <span class=\"string\">'Muli'</span>, <span class=\"string\">\"Helvetica\"</span>, Arial, sans-serif;</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"滚动条\"><a href=\"#滚动条\" class=\"headerlink\" title=\"滚动条\"></a>滚动条</h2><figure class=\"highlight css\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*  定义滚动条样式   */</span>   </span><br><span class=\"line\"><span class=\"selector-pseudo\">::-webkit-scrollbar</span> {   </span><br><span class=\"line\"><span class=\"comment\">/* ::-webkit-scrollbar:horizontal  */</span></span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">10px</span>;   </span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">10px</span>;  <span class=\"comment\">/*  高宽分别对应横竖滚动条的尺寸  */</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#F5F5F5</span>;   </span><br><span class=\"line\">}  </span><br><span class=\"line\"><span class=\"comment\">/*定义滚动条轨道 内阴影+圆角*/</span>   </span><br><span class=\"line\"><span class=\"selector-pseudo\">::-webkit-scrollbar-track</span> {   </span><br><span class=\"line\">    <span class=\"attribute\">box-shadow</span>: inset <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">6px</span> <span class=\"built_in\">rgba</span>(0,0,0,0.3);     </span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">10px</span>;   </span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#F5F5F5</span>;   </span><br><span class=\"line\">}   </span><br><span class=\"line\"><span class=\"comment\">/*定义滑块 内阴影+圆角*/</span>   </span><br><span class=\"line\"><span class=\"selector-pseudo\">::-webkit-scrollbar-thumb</span> {   </span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">10px</span>;   </span><br><span class=\"line\">    <span class=\"attribute\">box-shadow</span>: inset <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">6px</span> <span class=\"built_in\">rgba</span>(0,0,0,.3);   </span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#C0C0C0</span>;   </span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"元素居中\"><a href=\"#元素居中\" class=\"headerlink\" title=\"元素居中\"></a>元素居中</h2><figure class=\"highlight css\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 块中块元素 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.div-child</span> {</span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: <span class=\"number\">0</span> auto;  </span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-class\">.div-parent</span> {</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: table-cell;   </span><br><span class=\"line\">    <span class=\"attribute\">vertical-align</span>: middle; </span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 块中内联元素 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.div-parent</span> {</span><br><span class=\"line\">    <span class=\"attribute\">text-align</span>: center;   </span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">line-height</span>: <span class=\"number\">100px</span>;  </span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/* 其它方法垂直居中 */</span></span><br><span class=\"line\">    <span class=\"attribute\">display</span>: table-cell;    </span><br><span class=\"line\">    <span class=\"attribute\">vertical-align</span>: middle;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 不定宽高的水平、垂直居中 */</span></span><br><span class=\"line\"><span class=\"comment\">/* 1.定位 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.parent</span> {</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> { </span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin-left</span>: -<span class=\"number\">100px</span>;   <span class=\"comment\">/* 自身宽度一半 */</span></span><br><span class=\"line\">    <span class=\"attribute\">margin-top</span>: -<span class=\"number\">50px</span>;    <span class=\"comment\">/* 自身高度一半 */</span></span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"comment\">/* 2.CSS3 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.wrapper</span> {</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">z-index</span>: <span class=\"number\">3</span>;</span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: <span class=\"built_in\">translate</span>(-50%,-50%);</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"comment\">/* 3.flexbox方法 (设置父元素，让子元素水平居中) */</span></span><br><span class=\"line\"><span class=\"selector-class\">.parent</span> {       </span><br><span class=\"line\">    <span class=\"attribute\">display</span>:-webkit-flex;</span><br><span class=\"line\">    <span class=\"attribute\">justify-content</span>:center;  </span><br><span class=\"line\">    <span class=\"attribute\">align-items</span>:center;      </span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"布局方式\"><a href=\"#布局方式\" class=\"headerlink\" title=\"布局方式\"></a>布局方式</h2><figure class=\"highlight css\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 左边固定右边自适应的两列布局（定位和flex方式略） */</span></span><br><span class=\"line\"><span class=\"selector-class\">.parent</span><span class=\"selector-pseudo\">::after</span> {</span><br><span class=\"line\">    <span class=\"attribute\">content</span>: <span class=\"string\">\"\"</span>;            </span><br><span class=\"line\">    <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">0</span>;               </span><br><span class=\"line\">    <span class=\"attribute\">visibility</span>: hidden;     </span><br><span class=\"line\">    <span class=\"attribute\">clear</span>: both;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-class\">.parent</span> {  </span><br><span class=\"line\">    *zoom : 1      </span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-class\">.left</span> {</span><br><span class=\"line\">    <span class=\"attribute\">float</span>: left;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-class\">.right</span> {</span><br><span class=\"line\">    <span class=\"attribute\">margin-left</span>: <span class=\"number\">120px</span>;  </span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 两边固定中间自适应的三列布局 (浮动和定位略) */</span></span><br><span class=\"line\"><span class=\"selector-class\">.parent</span> {</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-class\">.left</span>,<span class=\"selector-class\">.right</span> {</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-class\">.middle</span> {</span><br><span class=\"line\">    <span class=\"attribute\">flex</span>: <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: <span class=\"number\">0</span> <span class=\"number\">200px</span>; </span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 移动端窗口居中布局 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.text_box</span> <span class=\"selector-tag\">span</span> {</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#eff1f2</span>;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">50vw</span>;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">50vh</span>;</span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: <span class=\"built_in\">translate</span>(-50%, -50%);  </span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-class\">.text_box</span> <span class=\"selector-tag\">div</span> {</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">50vw</span>;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">50vh</span>;</span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: <span class=\"built_in\">translate</span>(-50%, -50%);</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#fff</span>;</span><br><span class=\"line\">    <span class=\"attribute\">opacity</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"瀑布流布局\"><a href=\"#瀑布流布局\" class=\"headerlink\" title=\"瀑布流布局\"></a>瀑布流布局</h2><div style=\"text-indent:2em\">原理是页面容器内的多个高度不固定的 div 之间按照一定的间隔参差不齐的无序浮动，鼠标滚动时不断在容器内的尾部加载数据并自动加载到空缺位置，不断循环。</div><br><div style=\"text-indent:2em\">核心是基于一个网格的布局，而且每行包含的项目列表高度是随机的（随自身内容动态改变高度），同时每个项目列表呈堆栈形式排列，最关键的是，堆栈之间彼此之间没有多余的间距差存大。</div><figure class=\"highlight css\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 大层 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.container</span> {</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: <span class=\"number\">0</span> auto;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 瀑布流层 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.waterfall</span> {</span><br><span class=\"line\">    <span class=\"attribute\">column-count</span>: <span class=\"number\">4</span>;</span><br><span class=\"line\">    <span class=\"attribute\">column-gap</span>: <span class=\"number\">1em</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 一个内容层 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.item</span> { </span><br><span class=\"line\">    <span class=\"attribute\">padding</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-column-break-inside</span>: avoid; <span class=\"comment\">/* Chrome, Safari, Opera */</span></span><br><span class=\"line\">    <span class=\"attribute\">page-break-inside</span>: avoid;  <span class=\"comment\">/* Firefox */</span></span><br><span class=\"line\">    <span class=\"attribute\">break-inside</span>: avoid;       <span class=\"comment\">/* IE 10+ */</span></span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#000</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">overflow</span>: auto;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-class\">.item</span> <span class=\"selector-tag\">img</span> {</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin-bottom</span>:<span class=\"number\">10px</span>;</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"表单元素\"><a href=\"#表单元素\" class=\"headerlink\" title=\"表单元素\"></a>表单元素</h2><figure class=\"highlight css\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 清除默认框 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">input</span>{</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: none / <span class=\"number\">0</span> ;  </span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"comment\">/* 清除下拉框默认选择样式 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">select</span>{</span><br><span class=\"line\">  <span class=\"attribute\">appearance</span>: none;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"comment\">/* 隐藏下拉箭头 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">select</span><span class=\"selector-pseudo\">::-ms-expand</span> { </span><br><span class=\"line\">  <span class=\"attribute\">display</span>: none; </span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 应用于有焦点的元素(输入框, 超链接)具有焦点的时间内*/</span></span><br><span class=\"line\"><span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:focus</span>, <span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:hover</span>{ </span><br><span class=\"line\">    <span class=\"attribute\">outline</span>: <span class=\"number\">1px</span>  dotted red; </span><br><span class=\"line\">    <span class=\"attribute\">opacity</span>: <span class=\"number\">0.6</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-tag\">input</span><span class=\"selector-pseudo\">:focus</span>{ </span><br><span class=\"line\">    <span class=\"attribute\">background</span>: yellow; </span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* placeholder 颜色 */</span></span><br><span class=\"line\"><span class=\"selector-pseudo\">::-webkit-input-placeholder</span>{  </span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#d3d3d3</span>; </span><br><span class=\"line\">} </span><br><span class=\"line\"><span class=\"selector-pseudo\">:-moz-placeholder</span>{  </span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#d3d3d3</span>; </span><br><span class=\"line\">} </span><br><span class=\"line\"><span class=\"selector-pseudo\">::-moz-placeholder</span>{ </span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#d3d3d3</span>;</span><br><span class=\"line\">} </span><br><span class=\"line\"><span class=\"selector-pseudo\">:-ms-input-placeholder</span>{  </span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#d3d3d3</span>; </span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"文本溢出省略\"><a href=\"#文本溢出省略\" class=\"headerlink\" title=\"文本溢出省略\"></a>文本溢出省略</h2><figure class=\"highlight css\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 单行文本 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">div</span>{</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">    <span class=\"attribute\">text-overflow</span>: ellipsis;  </span><br><span class=\"line\">    <span class=\"attribute\">white-space</span>: nowrap;      </span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 多行文本 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">div</span>{</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: -webkit-box; </span><br><span class=\"line\">    <span class=\"attribute\">overflow</span>: hidden; </span><br><span class=\"line\">    <span class=\"attribute\">text-overflow</span>: ellipsis;</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-line-clamp</span>: <span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-box-orient</span>: vertical;</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"特殊图形\"><a href=\"#特殊图形\" class=\"headerlink\" title=\"特殊图形\"></a>特殊图形</h2><figure class=\"highlight css\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 半圆 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.semi-circle</span> {</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">50px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: red;</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">50px</span> <span class=\"number\">50px</span> <span class=\"number\">0</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"comment\">/* 半椭圆 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.semiellipse</span> {</span><br><span class=\"line\">    <span class=\"attribute\">margin-top</span>: <span class=\"number\">30px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">50px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: red;</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">100%</span> <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">100%</span> /<span class=\"number\">50%</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"comment\">/* 椭圆 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.ellipse</span> {</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">50px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: red;</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">50px</span>/<span class=\"number\">25px</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 梯形 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.echelon</span> {</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">600px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">100px</span> solid;</span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: transparent transparent <span class=\"number\">#c00</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 三栏 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.three-cols</span> {</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">150px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">30px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">padding</span>: <span class=\"number\">15px</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border-top</span>: <span class=\"number\">30px</span> solid;</span><br><span class=\"line\">    <span class=\"attribute\">border-bottom</span>: <span class=\"number\">30px</span> solid;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: currentColor;</span><br><span class=\"line\">    <span class=\"attribute\">background-clip</span>: content-box;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 多层阴影 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.shadows</span> {</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#fff</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">5px</span> solid black;</span><br><span class=\"line\">    <span class=\"attribute\">box-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">5px</span> green,<span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">10px</span> red;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* <div class=\"demo\" data-title=\"hello world\">title悬浮框</div> */</span></span><br><span class=\"line\"><span class=\"selector-class\">.title</span> {</span><br><span class=\"line\">    <span class=\"attribute\">margin-top</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin-left</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-class\">.title</span><span class=\"selector-pseudo\">:hover</span><span class=\"selector-pseudo\">::after</span> {</span><br><span class=\"line\">    <span class=\"attribute\">content</span>: <span class=\"built_in\">attr</span>(data-title);<span class=\"comment\">/* 取到data-title属性的值 */</span></span><br><span class=\"line\">    <span class=\"attribute\">display</span>: inline-block;</span><br><span class=\"line\">    <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span> <span class=\"number\">14px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#ddd</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: -<span class=\"number\">50px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: -<span class=\"number\">30px</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 眼睛 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.eye</span> {</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">150px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">150px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">10px</span> solid;</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: currentColor;</span><br><span class=\"line\">    <span class=\"attribute\">background-clip</span>: content-box;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 放大镜 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.magnifier</span> {</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">50px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">50px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">5px</span> solid <span class=\"number\">#333</span>;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"selector-class\">.magnifier</span><span class=\"selector-pseudo\">::after</span> {</span><br><span class=\"line\">    <span class=\"attribute\">content</span>: <span class=\"string\">''</span>;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: block;    </span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">8px</span>;    </span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">60px</span>;    </span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;    </span><br><span class=\"line\">    <span class=\"attribute\">background</span>: <span class=\"number\">#333</span>;    </span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;    </span><br><span class=\"line\">    <span class=\"attribute\">right</span>: -<span class=\"number\">22px</span>;    </span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">38px</span>;    </span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: <span class=\"built_in\">rotate</span>(-45deg);</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><!-- rebuild by neat --></body></html>","site":{"data":{"next":{"override":false,"cache":{"enable":true},"favicon":{"small":"/images/favicon-16.ico","medium":"/images/favicon-32.ico","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"rss":"/atom.xml","footer":{"since":2019,"icon":{"name":"snowflake-o","animated":false,"color":"#808080"},"copyright":"chuangge","powered":{"enable":false,"version":true},"theme":{"enable":false,"version":true},"beian":{"enable":false,"icp":null}},"creative_commons":{"license":"by-nc-sa","sidebar":false,"post":false},"canonical":true,"seo":false,"index_with_subtitle":false,"exturl":false,"menu":{"home":"/ || home  //首页","tags":"/tags/ || tags  //标签","categories":"/categories/ || th   //分类","archives":"/archives/ || archive //归档"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":{"GitHub":"https://github.com/ || github","StackOverflow":"https://stackoverflow.com/ || stack-overflow"},"social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"友情链接","links_layout":"inline","links":{"个人简历":"https://chuanggefighting.github.io/project/","印记中文":"https://www.docschina.org/","在线工具":"http://tool.lu/","Learn Anything":"https://learn-anything.xyz/"},"avatar":{"url":"/images/chuang.png","rounded":true,"opacity":1,"rotated":true},"toc":{"enable":true,"number":true,"wrap":false,"max_depth":6},"sidebar":{"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"read_more_btn":true,"post_meta":{"item_text":true,"created_at":true,"updated_at":{"enabled":true,"another_day":true},"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":true,"awl":4,"wpm":275},"codeblock":{"border_radius":null,"copy_button":{"enable":false,"show_result":false}},"reward":{"enable":false},"related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_edit":{"enable":false,"url":"https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name"},"disable_baidu_tranformation":false,"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"font":{"enable":true,"host":"//fonts.proxy.ustclug.org","global":{"external":true,"family":"Lato","size":16},"headings":{"external":true,"family":"Roboto Slab","size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":"Lobster Two","size":24},"codes":{"external":true,"family":"Roboto Mono","size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css","copy_tex":{"enable":false,"copy_tex_js":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js","copy_tex_css":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css"}}},"pdf":{"enable":false,"per_page":true,"height":"500px","pdfobject":{"cdn":"//cdn.jsdelivr.net/npm/pdfobject@2.1.1/pdfobject.min.js"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":true,"appid":"snOvapuSplYTVflf5p9Ml9JX-gzGzoHsz","appkey":"5ABGdfyEdAtu6lTXdGdo7hf9","notify":false,"verify":false,"placeholder":"ヾﾉ≧∀≦)o 来呀！吐槽一番吧！","avatar":"mm","guest_info":"nick,mail,link","pageSize":10,"visitor":false,"comment_count":true},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"gitalk":{"enable":false,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true},"needmoreshare2":{"enable":true,"postbottom":{"enable":true,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null,"security":false,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":true,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":true,"pace_theme":"pace-theme-center-simple","canvas_nest":{"enable":true,"onmobile":true,"color":"0,0,255","opacity":0.5,"zIndex":-1,"count":99},"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"canvas_nest_nomobile":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"leancloud":null,"valine":null,"gitalk_js":null,"gitalk_css":null,"md5":null},"css":"css","js":"js","images":"images","passage_end_tag":{"enabled":true},"daovoice":true,"daovoice_app_id":"2ed51855"}}},"excerpt":"","more":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><h1 id=\"一、HTML-元素\"><a href=\"#一、HTML-元素\" class=\"headerlink\" title=\"一、HTML 元素\"></a>一、HTML 元素</h1><blockquote><p><strong>相互转换：display</strong></p></blockquote><ul><li>块级元素：独占一行、可设宽高、不设宽度时默认是其父元素的100%<ul><li>常用5个标签：h、p、ul、div、table</li><li>6大属性：width、height、background、border、padding、margin</li></ul></li><li>行内元素：一行可放多个、宽高不可设置、宽度包裹内容<ul><li>常用标签：a、span、label、strong</li></ul></li><li>行内块元素：一行多个、可设宽高<ul><li>常用标签：img、input等</li></ul></li></ul><h1 id=\"二、浮动\"><a href=\"#二、浮动\" class=\"headerlink\" title=\"二、浮动\"></a>二、浮动</h1><h2 id=\"float\"><a href=\"#float\" class=\"headerlink\" title=\"float\"></a>float</h2><ol><li>设计初衷：文字环绕效果</li><li>主要特性：包裹性 和 破坏性</li></ol><h2 id=\"清除浮动\"><a href=\"#清除浮动\" class=\"headerlink\" title=\"清除浮动\"></a>清除浮动</h2><ol><li>本质：清除浮动元素对后面元素的影响</li><li>方法<ul><li>给父元素指定高度：不太灵活</li><li>在浮动元素后面盒子添加 clear: both</li><li>给浮动元素父元素添加 overflow: hidden/auto</li><li>底部添加伪元素 after</li></ul></li><li>特例：父元素有浮动/绝对定位时不需清除</li><li>经典方法<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">div</span><span class=\"selector-pseudo\">::after</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">content</span>: <span class=\"string\">\"\"</span>;       <span class=\"comment\">/* 添加内容为空 */</span>   </span><br><span class=\"line\">    <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">0</span>;           <span class=\"comment\">/* 不占空间 */</span></span><br><span class=\"line\">    <span class=\"attribute\">visibility</span>: hidden;  <span class=\"comment\">/* 不可见  */</span>   </span><br><span class=\"line\">    <span class=\"attribute\">clear</span>: both</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-tag\">div</span> &#123;  </span><br><span class=\"line\">    *zoom : 1;   /* 兼容低版本浏览器 */   </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id=\"三、布局模型\"><a href=\"#三、布局模型\" class=\"headerlink\" title=\"三、布局模型\"></a>三、布局模型</h1><blockquote><p>网页布局：整体布局用浮动，局部布局用定位</p></blockquote><ol><li>流动模型：浏览器默认的文档流。块级元素自下而上、内联元素自左而右按顺序排列</li><li>浮动模型：浮动流。元素脱离文档流而释放空间，但浮动元素不能遮挡后面文档流中内容的正常显示</li><li>层模型：定位流。父元素相对定位，子元素绝对定位/固定定位，z-index规定定位元素的堆叠顺序</li></ol><h1 id=\"四、常用知识点\"><a href=\"#四、常用知识点\" class=\"headerlink\" title=\"四、常用知识点\"></a>四、常用知识点</h1><ul><li>文件引入优先级：就近原则，距离相应代码近的引入方式优先级高</li><li>浏览器读取规则：从右向左，因为相比从左到右匹配更快、性能更优</li><li>元素隐藏方法：display、Opacity、visibility、hide、遮罩等</li><li>元素间距处理：父子元素的间距给父元素加 padding，同级元素的间距则给一个元素加 margin</li><li>伪类和伪元素：<code>:hover、:link 等伪类</code>用于向已有元素添加特殊效果，<code>::before、::after 等伪元素</code>用于新建抽象元素并添加样式从而实现特殊效果</li></ul><h1 id=\"五、css-单位\"><a href=\"#五、css-单位\" class=\"headerlink\" title=\"五、css 单位\"></a>五、css 单位</h1><ul><li><strong>rem</strong>: 相对于根元素字体尺寸</li><li><strong>em</strong>: 相对于父级元素的字体尺寸</li><li><strong>%</strong>: 百分比，相对于父元素的尺寸</li><li><strong>px</strong>: 像素，相对于用户设备分辨率的最基本单元</li><li>pt：Word等办公软件中使用的字体大小单位</li><li>dp：安卓开发时使用的长度单位</li><li>sp：安卓开发时使用的字体大小单位</li><li>vw：视窗宽度，1vw等于视窗宽度的 1%</li><li>vh：视窗高度，1vh等于视窗高度的 1%</li><li>vmin / vmax：vw和vh中较 小/大 的那个</li></ul><h1 id=\"六、浏览器兼容\"><a href=\"#六、浏览器兼容\" class=\"headerlink\" title=\"六、浏览器兼容\"></a>六、浏览器兼容</h1><h2 id=\"常见兼容问题\"><a href=\"#常见兼容问题\" class=\"headerlink\" title=\"常见兼容问题\"></a>常见兼容问题</h2><ul><li><strong>img 之间出现间距</strong>：浮动</li><li><strong>上下 margin 重合问题</strong>：上下选一个</li><li><strong>opacity、placeholder、outline、伪元素、z-index</strong></li><li><strong>子元素的 margin-top,会出现在父元素的上方</strong><ul><li>给父元素加 overflow: hidden</li><li>能用 padding-top 替代时就替代</li><li>给父元素设置 border: 1px solid transparent</li></ul></li><li><strong>li 元素使用 display: inline-block 时会出现缝隙</strong><ul><li>使用浮动</li><li>给li重新设置字号 font-size: 0</li></ul></li></ul><h2 id=\"css-hack\"><a href=\"#css-hack\" class=\"headerlink\" title=\"css hack\"></a>css hack</h2><blockquote><p>针对不同的浏览器写不同的 CSS 来解决浏览器兼容</p></blockquote><ul><li>选择器前缀法：@media screen</li><li>CSS 属性前缀法：-webkit-、-moz-、-ms-、-o-</li><li>IE 条件注释语句：解决 IE 兼容问题</li></ul><h1 id=\"七、CSS3\"><a href=\"#七、CSS3\" class=\"headerlink\" title=\"七、CSS3\"></a>七、CSS3</h1><h2 id=\"引用字体文件\"><a href=\"#引用字体文件\" class=\"headerlink\" title=\"引用字体文件\"></a>引用字体文件</h2><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"keyword\">font-face</span> &#123;                       </span><br><span class=\"line\">    <span class=\"attribute\">font-family</span>: ArtifaktBlod;     </span><br><span class=\"line\">    <span class=\"attribute\">src</span>: <span class=\"built_in\">url</span>(<span class=\"string\">'fonts/ArtifaktElementOfc-Bold.ttf'</span>);  <span class=\"comment\">/* 引入字体资源 */</span>    </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\"><span class=\"selector-tag\">div</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-family</span>: ArtifaktBlod;          </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"transform\"><a href=\"#transform\" class=\"headerlink\" title=\"transform\"></a>transform</h2><ol><li><strong>转换属性</strong><ul><li>transform-origin：指定元素变换的中心点</li><li>transform-style：指定场景为 2D 或 3D</li><li>perspective：指定 3D 的视距</li><li>perspective-origin：设置视距的基点</li><li>backface-visibility：是否可以看见 3D 场景背面</li></ul></li><li><strong>2D变换</strong><ul><li>translate：位移，translate / translateX / translateY</li><li>scale：缩放，scale / scaleX / scaleY</li><li>rotate：旋转，rotate</li><li>skew：变形，skew / skewX / skewY</li><li>matrix：矩阵，是所有 2D 变换的本质</li></ul></li><li><strong>3D变换</strong><ul><li>translate3d：位移，translate3d / translateZ</li><li>scale3d：缩放，scale3d / scaleZ</li><li>rotate3d：旋转，rotate3d / rotateX / rotateY / rotateZ</li><li>matrix3d：矩阵，是所有 3D 变换的本质</li></ul></li></ol><figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.img</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: rotate(<span class=\"number\">30deg</span>);</span><br><span class=\"line\">    <span class=\"attribute\">transform-origin</span>: <span class=\"number\">200px</span> <span class=\"number\">300px</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 等价于 </span></span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: translate(<span class=\"number\">200px</span>, <span class=\"number\">300px</span>) </span><br><span class=\"line\">              rotate(<span class=\"number\">30deg</span>)</span><br><span class=\"line\">              translate(-<span class=\"number\">200px</span>, -<span class=\"number\">300px</span>); </span><br><span class=\"line\">    <span class=\"attribute\">transform-origin</span>: <span class=\"number\">0</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.box</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">transform-style</span>: preserve-<span class=\"number\">3</span>d;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* perspective() 配合 transform 其他函数一起使用，</span></span><br><span class=\"line\"><span class=\"comment\">    仅表示当前变形元素的视距 */</span></span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: perspective(<span class=\"number\">200px</span>) rotateY(<span class=\"number\">45deg</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// perspective 指定子元素共享的视距 </span></span><br><span class=\"line\">    <span class=\"attribute\">perspective</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// center表示眼睛在场景正中心</span></span><br><span class=\"line\">    <span class=\"attribute\">perspective-origin</span>: center;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-tag\">img</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 父元素不指定 3D 则失效 </span></span><br><span class=\"line\">        <span class=\"attribute\">transform</span>: translateZ(<span class=\"number\">16px</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 让背面不可见，旋转时常用</span></span><br><span class=\"line\">        <span class=\"attribute\">backface-visibility</span>: hidden;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"transition\"><a href=\"#transition\" class=\"headerlink\" title=\"transition\"></a>transition</h2><ol><li><strong>过渡效果</strong>：默认样式中定义元素的初始样式和过渡函数，然后定义过渡后的元素样式</li><li><p><strong>缩写语法</strong>：<code>transition：过渡属性 过渡时间 [过渡曲线] [时间延迟]</code></p><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.box</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: orange;</span><br><span class=\"line\">    <span class=\"comment\">/* transition: width 1s ease-in, backgroundColor 1s ease-in; */</span></span><br><span class=\"line\">    <span class=\"attribute\">transition</span>: all <span class=\"number\">1s</span> ease-in .<span class=\"number\">2s</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.box</span><span class=\"selector-pseudo\">:hover</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">300px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: red;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id=\"animation\"><a href=\"#animation\" class=\"headerlink\" title=\"animation\"></a>animation</h2><ol><li><strong>动画效果</strong>：通过 animation 绑定 @keyframes 定义的动画，自动实现一种或多种形态同时变化的效果</li><li><strong>动画定义</strong>：<code>@keyframes 动画名{ //百分比 或 from、to }</code></li><li><strong>动画绑定</strong>：<code>animation: 动画名 时间 动画曲线 延迟时间 播放次数 是否逆向播放 [非动画时间的状态]</code></li><li><p><strong>动画暂停</strong>：<code>animation-play-state: paused;</code></p><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.box</span> &#123; </span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#f00</span>; </span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">36px</span>; </span><br><span class=\"line\">    <span class=\"attribute\">font-weight</span>: bold;</span><br><span class=\"line\">    <span class=\"attribute\">animation</span>: change <span class=\"number\">1s</span> ease-in infinite; </span><br><span class=\"line\">    <span class=\"comment\">/* animation-play-state: paused; */</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">@<span class=\"keyword\">keyframes</span> change &#123;</span><br><span class=\"line\">    0%   &#123; <span class=\"attribute\">text-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">4px</span> <span class=\"number\">#f00</span> &#125;</span><br><span class=\"line\">    50%  &#123; <span class=\"attribute\">text-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">40px</span> <span class=\"number\">#f00</span> &#125;</span><br><span class=\"line\">    100% &#123; <span class=\"attribute\">text-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">4px</span> <span class=\"number\">#f00</span> &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id=\"八、PC-端开发常用样式\"><a href=\"#八、PC-端开发常用样式\" class=\"headerlink\" title=\"八、PC 端开发常用样式\"></a>八、PC 端开发常用样式</h1><h2 id=\"初始化\"><a href=\"#初始化\" class=\"headerlink\" title=\"初始化\"></a>初始化</h2><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* reset.css  */</span></span><br><span class=\"line\"><span class=\"selector-tag\">body</span>, <span class=\"selector-tag\">h1</span>, <span class=\"selector-tag\">h2</span>, <span class=\"selector-tag\">h3</span>, <span class=\"selector-tag\">h4</span>, <span class=\"selector-tag\">h5</span>, <span class=\"selector-tag\">h6</span>, <span class=\"selector-tag\">hr</span>, <span class=\"selector-tag\">p</span>, <span class=\"selector-tag\">blockquote</span>, <span class=\"selector-tag\">dl</span>, <span class=\"selector-tag\">dt</span>, <span class=\"selector-tag\">dd</span>, <span class=\"selector-tag\">ul</span>, <span class=\"selector-tag\">ol</span>, <span class=\"selector-tag\">li</span>, <span class=\"selector-tag\">pre</span>, <span class=\"selector-tag\">form</span>, <span class=\"selector-tag\">fieldset</span>, <span class=\"selector-tag\">legend</span>, <span class=\"selector-tag\">button</span>, <span class=\"selector-tag\">input</span>, <span class=\"selector-tag\">textarea</span>, <span class=\"selector-tag\">th</span>, <span class=\"selector-tag\">td</span> &#123; <span class=\"attribute\">margin</span>:<span class=\"number\">0</span>; <span class=\"attribute\">padding</span>:<span class=\"number\">0</span>; &#125; </span><br><span class=\"line\"><span class=\"selector-tag\">body</span>, <span class=\"selector-tag\">button</span>, <span class=\"selector-tag\">input</span>, <span class=\"selector-tag\">select</span>, <span class=\"selector-tag\">textarea</span> &#123; <span class=\"attribute\">font</span>:<span class=\"number\">12px</span>/<span class=\"number\">1.5</span>tahoma, arial, \\<span class=\"number\">5</span>b8b\\<span class=\"number\">4</span>f53; &#125; </span><br><span class=\"line\"><span class=\"selector-tag\">h1</span>, <span class=\"selector-tag\">h2</span>, <span class=\"selector-tag\">h3</span>, <span class=\"selector-tag\">h4</span>, <span class=\"selector-tag\">h5</span>, <span class=\"selector-tag\">h6</span>&#123; <span class=\"attribute\">font-size</span>:<span class=\"number\">100%</span>; &#125; </span><br><span class=\"line\"><span class=\"selector-tag\">address</span>, <span class=\"selector-tag\">cite</span>, <span class=\"selector-tag\">dfn</span>, <span class=\"selector-tag\">em</span>, <span class=\"selector-tag\">var</span> &#123; <span class=\"attribute\">font-style</span>:normal; &#125; </span><br><span class=\"line\"><span class=\"selector-tag\">code</span>, <span class=\"selector-tag\">kbd</span>, <span class=\"selector-tag\">pre</span>, <span class=\"selector-tag\">samp</span> &#123; <span class=\"attribute\">font-family</span>:couriernew, courier, monospace; &#125; </span><br><span class=\"line\"><span class=\"selector-tag\">small</span>&#123; <span class=\"attribute\">font-size</span>:<span class=\"number\">12px</span>; &#125; </span><br><span class=\"line\"><span class=\"selector-tag\">ul</span>, <span class=\"selector-tag\">ol</span> &#123; <span class=\"attribute\">list-style</span>:none; &#125; </span><br><span class=\"line\"><span class=\"selector-tag\">a</span> &#123; <span class=\"attribute\">text-decoration</span>:none; <span class=\"attribute\">color</span>: <span class=\"number\">#3D3F40</span>; &#125; </span><br><span class=\"line\"><span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:hover</span> &#123; <span class=\"attribute\">color</span>: <span class=\"number\">#62B060</span>; &#125; </span><br><span class=\"line\"><span class=\"selector-tag\">sup</span> &#123; <span class=\"attribute\">vertical-align</span>:text-top; &#125; </span><br><span class=\"line\"><span class=\"selector-tag\">sub</span>&#123; <span class=\"attribute\">vertical-align</span>:text-bottom; &#125; </span><br><span class=\"line\"><span class=\"selector-tag\">fieldset</span>, <span class=\"selector-tag\">img</span> &#123; <span class=\"attribute\">border</span>:<span class=\"number\">0</span>; &#125; </span><br><span class=\"line\"><span class=\"selector-tag\">button</span>, <span class=\"selector-tag\">input</span>, <span class=\"selector-tag\">select</span>, <span class=\"selector-tag\">textarea</span> &#123; <span class=\"attribute\">font-size</span>:<span class=\"number\">100%</span>; &#125; </span><br><span class=\"line\"><span class=\"selector-tag\">table</span> &#123; <span class=\"attribute\">border-collapse</span>:collapse; <span class=\"attribute\">border-spacing</span>:<span class=\"number\">0</span>; &#125;</span><br><span class=\"line\"><span class=\"selector-tag\">body</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">  <span class=\"attribute\">-moz-osx-font-smoothing</span>: grayscale;</span><br><span class=\"line\">  <span class=\"attribute\">-webkit-font-smoothing</span>: antialiased;  <span class=\"comment\">/* 设置字体平滑 */</span></span><br><span class=\"line\">  <span class=\"attribute\">font-family</span>: <span class=\"string\">\"Microsoft YaHei\"</span>, <span class=\"string\">'Muli'</span>, <span class=\"string\">\"Helvetica\"</span>, Arial, sans-serif;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"滚动条\"><a href=\"#滚动条\" class=\"headerlink\" title=\"滚动条\"></a>滚动条</h2><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*  定义滚动条样式   */</span>   </span><br><span class=\"line\"><span class=\"selector-pseudo\">::-webkit-scrollbar</span> &#123;   </span><br><span class=\"line\"><span class=\"comment\">/* ::-webkit-scrollbar:horizontal  */</span></span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">10px</span>;   </span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">10px</span>;  <span class=\"comment\">/*  高宽分别对应横竖滚动条的尺寸  */</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#F5F5F5</span>;   </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\"><span class=\"comment\">/*定义滚动条轨道 内阴影+圆角*/</span>   </span><br><span class=\"line\"><span class=\"selector-pseudo\">::-webkit-scrollbar-track</span> &#123;   </span><br><span class=\"line\">    <span class=\"attribute\">box-shadow</span>: inset <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">6px</span> <span class=\"built_in\">rgba</span>(0,0,0,0.3);     </span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">10px</span>;   </span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#F5F5F5</span>;   </span><br><span class=\"line\">&#125;   </span><br><span class=\"line\"><span class=\"comment\">/*定义滑块 内阴影+圆角*/</span>   </span><br><span class=\"line\"><span class=\"selector-pseudo\">::-webkit-scrollbar-thumb</span> &#123;   </span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">10px</span>;   </span><br><span class=\"line\">    <span class=\"attribute\">box-shadow</span>: inset <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">6px</span> <span class=\"built_in\">rgba</span>(0,0,0,.3);   </span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#C0C0C0</span>;   </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"元素居中\"><a href=\"#元素居中\" class=\"headerlink\" title=\"元素居中\"></a>元素居中</h2><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 块中块元素 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.div-child</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: <span class=\"number\">0</span> auto;  </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.div-parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: table-cell;   </span><br><span class=\"line\">    <span class=\"attribute\">vertical-align</span>: middle; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 块中内联元素 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.div-parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">text-align</span>: center;   </span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">line-height</span>: <span class=\"number\">100px</span>;  </span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/* 其它方法垂直居中 */</span></span><br><span class=\"line\">    <span class=\"attribute\">display</span>: table-cell;    </span><br><span class=\"line\">    <span class=\"attribute\">vertical-align</span>: middle;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 不定宽高的水平、垂直居中 */</span></span><br><span class=\"line\"><span class=\"comment\">/* 1.定位 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123; </span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin-left</span>: -<span class=\"number\">100px</span>;   <span class=\"comment\">/* 自身宽度一半 */</span></span><br><span class=\"line\">    <span class=\"attribute\">margin-top</span>: -<span class=\"number\">50px</span>;    <span class=\"comment\">/* 自身高度一半 */</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/* 2.CSS3 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.wrapper</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">z-index</span>: <span class=\"number\">3</span>;</span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: <span class=\"built_in\">translate</span>(-50%,-50%);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/* 3.flexbox方法 (设置父元素，让子元素水平居中) */</span></span><br><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;       </span><br><span class=\"line\">    <span class=\"attribute\">display</span>:-webkit-flex;</span><br><span class=\"line\">    <span class=\"attribute\">justify-content</span>:center;  </span><br><span class=\"line\">    <span class=\"attribute\">align-items</span>:center;      </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"布局方式\"><a href=\"#布局方式\" class=\"headerlink\" title=\"布局方式\"></a>布局方式</h2><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 左边固定右边自适应的两列布局（定位和flex方式略） */</span></span><br><span class=\"line\"><span class=\"selector-class\">.parent</span><span class=\"selector-pseudo\">::after</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">content</span>: <span class=\"string\">\"\"</span>;            </span><br><span class=\"line\">    <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">0</span>;               </span><br><span class=\"line\">    <span class=\"attribute\">visibility</span>: hidden;     </span><br><span class=\"line\">    <span class=\"attribute\">clear</span>: both;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;  </span><br><span class=\"line\">    *zoom : 1      </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.left</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">float</span>: left;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.right</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin-left</span>: <span class=\"number\">120px</span>;  </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 两边固定中间自适应的三列布局 (浮动和定位略) */</span></span><br><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.left</span>,<span class=\"selector-class\">.right</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.middle</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">flex</span>: <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: <span class=\"number\">0</span> <span class=\"number\">200px</span>; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 移动端窗口居中布局 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.text_box</span> <span class=\"selector-tag\">span</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#eff1f2</span>;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">50vw</span>;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">50vh</span>;</span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: <span class=\"built_in\">translate</span>(-50%, -50%);  </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.text_box</span> <span class=\"selector-tag\">div</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">50vw</span>;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">50vh</span>;</span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: <span class=\"built_in\">translate</span>(-50%, -50%);</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#fff</span>;</span><br><span class=\"line\">    <span class=\"attribute\">opacity</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"瀑布流布局\"><a href=\"#瀑布流布局\" class=\"headerlink\" title=\"瀑布流布局\"></a>瀑布流布局</h2><div style=\"text-indent:2em\">原理是页面容器内的多个高度不固定的 div 之间按照一定的间隔参差不齐的无序浮动，鼠标滚动时不断在容器内的尾部加载数据并自动加载到空缺位置，不断循环。</div><br><div style=\"text-indent:2em\">核心是基于一个网格的布局，而且每行包含的项目列表高度是随机的（随自身内容动态改变高度），同时每个项目列表呈堆栈形式排列，最关键的是，堆栈之间彼此之间没有多余的间距差存大。</div><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 大层 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: <span class=\"number\">0</span> auto;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 瀑布流层 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.waterfall</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">column-count</span>: <span class=\"number\">4</span>;</span><br><span class=\"line\">    <span class=\"attribute\">column-gap</span>: <span class=\"number\">1em</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 一个内容层 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.item</span> &#123; </span><br><span class=\"line\">    <span class=\"attribute\">padding</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-column-break-inside</span>: avoid; <span class=\"comment\">/* Chrome, Safari, Opera */</span></span><br><span class=\"line\">    <span class=\"attribute\">page-break-inside</span>: avoid;  <span class=\"comment\">/* Firefox */</span></span><br><span class=\"line\">    <span class=\"attribute\">break-inside</span>: avoid;       <span class=\"comment\">/* IE 10+ */</span></span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#000</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">overflow</span>: auto;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.item</span> <span class=\"selector-tag\">img</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin-bottom</span>:<span class=\"number\">10px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"表单元素\"><a href=\"#表单元素\" class=\"headerlink\" title=\"表单元素\"></a>表单元素</h2><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 清除默认框 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">input</span>&#123;</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: none / <span class=\"number\">0</span> ;  </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/* 清除下拉框默认选择样式 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">select</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">appearance</span>: none;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/* 隐藏下拉箭头 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">select</span><span class=\"selector-pseudo\">::-ms-expand</span> &#123; </span><br><span class=\"line\">  <span class=\"attribute\">display</span>: none; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 应用于有焦点的元素(输入框, 超链接)具有焦点的时间内*/</span></span><br><span class=\"line\"><span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:focus</span>, <span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:hover</span>&#123; </span><br><span class=\"line\">    <span class=\"attribute\">outline</span>: <span class=\"number\">1px</span>  dotted red; </span><br><span class=\"line\">    <span class=\"attribute\">opacity</span>: <span class=\"number\">0.6</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-tag\">input</span><span class=\"selector-pseudo\">:focus</span>&#123; </span><br><span class=\"line\">    <span class=\"attribute\">background</span>: yellow; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* placeholder 颜色 */</span></span><br><span class=\"line\"><span class=\"selector-pseudo\">::-webkit-input-placeholder</span>&#123;  </span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#d3d3d3</span>; </span><br><span class=\"line\">&#125; </span><br><span class=\"line\"><span class=\"selector-pseudo\">:-moz-placeholder</span>&#123;  </span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#d3d3d3</span>; </span><br><span class=\"line\">&#125; </span><br><span class=\"line\"><span class=\"selector-pseudo\">::-moz-placeholder</span>&#123; </span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#d3d3d3</span>;</span><br><span class=\"line\">&#125; </span><br><span class=\"line\"><span class=\"selector-pseudo\">:-ms-input-placeholder</span>&#123;  </span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#d3d3d3</span>; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"文本溢出省略\"><a href=\"#文本溢出省略\" class=\"headerlink\" title=\"文本溢出省略\"></a>文本溢出省略</h2><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 单行文本 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">div</span>&#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">    <span class=\"attribute\">text-overflow</span>: ellipsis;  </span><br><span class=\"line\">    <span class=\"attribute\">white-space</span>: nowrap;      </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 多行文本 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">div</span>&#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: -webkit-box; </span><br><span class=\"line\">    <span class=\"attribute\">overflow</span>: hidden; </span><br><span class=\"line\">    <span class=\"attribute\">text-overflow</span>: ellipsis;</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-line-clamp</span>: <span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"attribute\">-webkit-box-orient</span>: vertical;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"特殊图形\"><a href=\"#特殊图形\" class=\"headerlink\" title=\"特殊图形\"></a>特殊图形</h2><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 半圆 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.semi-circle</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">50px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: red;</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">50px</span> <span class=\"number\">50px</span> <span class=\"number\">0</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/* 半椭圆 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.semiellipse</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin-top</span>: <span class=\"number\">30px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">50px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: red;</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">100%</span> <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">100%</span> /<span class=\"number\">50%</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/* 椭圆 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.ellipse</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">50px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: red;</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">50px</span>/<span class=\"number\">25px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 梯形 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.echelon</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">600px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">100px</span> solid;</span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: transparent transparent <span class=\"number\">#c00</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 三栏 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.three-cols</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">150px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">30px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">padding</span>: <span class=\"number\">15px</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border-top</span>: <span class=\"number\">30px</span> solid;</span><br><span class=\"line\">    <span class=\"attribute\">border-bottom</span>: <span class=\"number\">30px</span> solid;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: currentColor;</span><br><span class=\"line\">    <span class=\"attribute\">background-clip</span>: content-box;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 多层阴影 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.shadows</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#fff</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">5px</span> solid black;</span><br><span class=\"line\">    <span class=\"attribute\">box-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">5px</span> green,<span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">10px</span> red;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* &lt;div class=\"demo\" data-title=\"hello world\"&gt;title悬浮框&lt;/div&gt; */</span></span><br><span class=\"line\"><span class=\"selector-class\">.title</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin-top</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin-left</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.title</span><span class=\"selector-pseudo\">:hover</span><span class=\"selector-pseudo\">::after</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">content</span>: <span class=\"built_in\">attr</span>(data-title);<span class=\"comment\">/* 取到data-title属性的值 */</span></span><br><span class=\"line\">    <span class=\"attribute\">display</span>: inline-block;</span><br><span class=\"line\">    <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span> <span class=\"number\">14px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#ddd</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: -<span class=\"number\">50px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: -<span class=\"number\">30px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 眼睛 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.eye</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">150px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">150px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">10px</span> solid;</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: currentColor;</span><br><span class=\"line\">    <span class=\"attribute\">background-clip</span>: content-box;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 放大镜 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.magnifier</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">50px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">50px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">5px</span> solid <span class=\"number\">#333</span>;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.magnifier</span><span class=\"selector-pseudo\">::after</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">content</span>: <span class=\"string\">''</span>;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: block;    </span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">8px</span>;    </span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">60px</span>;    </span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;    </span><br><span class=\"line\">    <span class=\"attribute\">background</span>: <span class=\"number\">#333</span>;    </span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;    </span><br><span class=\"line\">    <span class=\"attribute\">right</span>: -<span class=\"number\">22px</span>;    </span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">38px</span>;    </span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: <span class=\"built_in\">rotate</span>(-45deg);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->"},{"title":"ES6 ～ ES9 新特性","top":false,"keywords":["js","ES"],"date":"2019-04-03T16:35:46.000Z","description":"ECMAScript6 ～ 9 常用的新语法规范","_content":"\n# 一、ES6\n\n## let const\n  * __var__：声明变量或常量\n    * 存在变量提升现象：变量可以在声明之前使用，值为 undefined \n    * 没有块级作用域：ES6 之前的 js 只有全局作用域和函数作用域\n  * __let__：声明变量\n    * 存在暂时性死区：变量在声明之前使用会报错\n    * 存在块级作用域：声明的变量只能在其所在的代码块内才能访问\n  * __const__：声明常量\n    * 存在暂时性死区和块级作用域\n    * 常量名建议写成纯大写字母表示\n    * 不允许重新赋值，只能在声明时立即初始化\n\n\n## 字符串\n\n### 字符串拼接\n  ```js\n  // ES5 \n  var name = 'lux'\n  console.log('hello' + name)\n\n  // ES6：${}\n  const name = 'lux'\n  console.log(`hello ${name}`)  // hello lux\n  ```\n\n\n### 多行字符串\n  ```js\n  // ES5：反斜杠\n  var msg = \"Hi \\\n  man\n  \"\n\n  // ES6：反引号\n  const template = `welcome\n      to\n  world`\n  ```\n\n\n### API\n  ```js\n  // includes：判断是否包含\n  const str = 'hahay'\n  console.log(str.includes('y')) // true\n\n  // repeat: 获取字符串重复n次\n  const str = 'he'\n  console.log(str.repeat(3)) // 'hehehe'\n  // 如果带有小数，先进行 Math.floor(num) 处理\n\n  // startsWith、endsWith：判断是否以给定文本 开始、结束\n  const str =  'hello world!'\n  console.log(str.startsWith('hello'))  // true\n  console.log(str.endsWith('!'))        // true\n  \n  // padStart、padEnd：若字符串不够指定长度则在 头部、尾部 补全\n  setInterval(() => {\n      const now = new Date()\n      const hours = now.getHours().toString()\n      const minutes = now.getMinutes().toString()\n      const seconds = now.getSeconds().toString()\n      console.log(`${hours.padStart(2, 0)}:${minutes.padStart(2, 0)}:${seconds.padStart(2, 0)}`)\n  }, 1000)\n  ```\n\n\n## 函数\n\n### 箭头函数\n  * 省略 return 关键字\n  * 不需要 function 关键字\n  * 始终指向当前上下文的 this 对象\n  \n```js\n// 只有一个参数时不需要 ()\nlet f = n => n  \nlet f = () => 5 \n\n// 只有一条返回语句时不需要 {}\n[1,2,3].map(x => x + 1)\n\n// 返回对象则需要括号包裹\nlet obj = name => ({\"name\":name}) \n```\n\n\n            \n### 函数参数\n  * 默认参数：定义函数时指定\n  * Rest 参数：获取函数的不定参数\n\n```js\n// 默认参数\nfunction sum(x=1, y=1){  \n  return x + y;  \n}\n\n// Rest 参数\nfunction foo(x, ...params){ \n  console.log(params) \n} \n\nfoo(1, 2)      // [2]\nfoo(1, 2, 3)   // [2, 3]\n```\n\n\n## 对象\n  ```js\n  // 属性简写：属性名相同\n  function people(name, age) {\n      return {\n          name, age     \n      }\n  }\n  var name = 'bar';\n  var user = { name }; // { name: \"bar\" }\n\n\n  // 方法简写\n  const people = {\n    name: 'lux',\n    getName () {\n        console.log(this.name)\n    }\n  }\n\n  // 浅拷贝方法\n  const target = {}   \n  Object.assign(target, { name: 'Lisa' }, { age: 18 })\n  ```\n\n\n## 解构赋值\n> 自动提取数组或对象中的值并赋值给变量，要求前后结构相同或包含\n\n  ```js\n  // 对象：变量须与属性同名但不分顺序\n  let { name, age } = { name: 'lux', age: 20 }\n  console.log(`${name}: ${age}`)  // lux : 20\n\n  var {foo} = {bar: 'baz'}\n  console.log(foo)           // undefined\n  \n\n  // 数组：变量值由其位置决定\n  let [x, y] = [1, 2]\n  console.log(x, y)     // 1, 2\n\n  let [a, ...b] = [1, 2, 3, 4]\n\n  // 不完全解构\n  let [x, y] = [1, 2, 3]\n\n  // 默认值\n  [x, y = 'b'] = ['a']    // x='a', y='b'\n\n\n  // 代码重构：最后一行即可\n  var body = request.body\n  var username = body.username\n  var password = body.password\n  const { body, body: { username, password } } = request \n  ``` \n\n\n## Spread 扩展运算符 \n> Rest 参数的逆运算，用于将数组或对象展开成一系列用逗号隔开的值\n\n  * 合并对象或数组：参数位置不限制\n  * 配合解构赋值：必须将参数放到最后，否则报错\n\n```js\n// 数组\nconst color = ['red', 'yellow']\nconst colorful = [...color, 'green', 'pink']  \nconst [first, ...colorful] = color  // ['yellow']\n\n// 对象\nconst user = { name: 'lux', age: 20 }\nconst userinfo = { ...user, address: 'shanghai' }\nconst { name, ...userinfo } = user   // {age: 20}\n```\n\n\n## Symbol 类型\n> 一种新的原始数据类型，Symbol 值类似于字符串但每一个都表示独一无二的值\n\n  ```js\n  // 创建\n  var s1 = Symbol();          \n  var s2 = Symbol();\n  var s3 = Symbol(\"foo\");      // 传入字符串表示描述信息\n  var s4 = Symbol.for(\"foo\");  // 有则返回，无则创建\n\n  // 任何两个 Symbol 值都不相等\n  console.log(typeof s1, s1 == s2)   // symbol false\n\n  console.log(Symbol.keyFor(s3))     // undefined\n  console.log(Symbol.keyFor(s4))     // foo\n\n\n  // 不能与其他类型的值进行运算，否则会报错\n  // var k = s1 + 1\n\n  // 可以转为字符串、布尔值\n  var str = String(s1)\n  var bl = Boolean(s1)\n\n\n  // 作为对象属性名：不能使用点操作\n  var obj = { [s1]: 'hello' };\n\n  var obj = {}\n  obj[s1] = 'hello';\n\n  var obj = {};\n  Object.defineProperty(obj, s1, { value: 'hello' });\n\n\n  // 属性名的遍历\n  var sKey = Object.getOwnPropertySymbols(obj)  // 返回Symbol键名\n  var aKey = Reflect.ownKeys(obj)               // 返回所有键名\n  ```\n\n\n## for-of 遍历\n  * 方式对比\n    * forEach：无法跳出循环，即 break、return 命令都不奏效\n    * for-in：主要是为遍历对象而设计的，不适用于遍历数组\n    * for-of：调用遍历器接口，使用范围较广\n  * 使用技巧\n    * 类似数组的对象：通过 Array.from 方法转为数组\n    * 普通对象\n      * 通过 Object.keys 方法将键名生成数组\n      * 通过 Generator 函数将对象重新包装\n\n  ```js\n  let arrLike = { length: 2, 0: 'a', 1: 'b' };\n  for (let x of Array.from(arrLike)) {\n      console.log(x)\n  }\n\n  let obj = { name: 'Jane', age: 20 };\n  for (var key of Object.keys(obj)) {\n    console.log(obj[key]);\n  }\n  ```\n\n\n## Iterator 遍历器\n> 本质是一种有 next() 方法的指针对象，第几次调用就指向第几个成员\n\n### 功能\n  * 为各种数据结构提供一个统一的、简便的访问接口（统一）\n  * 使得数据结构的成员能够按某种次序排列（按序）\n  * 配合 for-of 实现遍历\n\n\n### 接口\n> 本质是一个生成遍历器的函数，不同于 forEach 等遍历方法\n\n  <div style=\"text-indent: 2em\">默认部署在数据结构的 Symbol.iterator 属性，它是当前数据结构默认的遍历器生成函数，执行这个函数就会返回一个遍历器。原生具备 Iterator 接口的数据结构如下：Array、TypedArray、Map、Set、String，只有这些数据结构不需要自定义遍历器生成函数并部署，循环遍历时可以直接通过 for-of 循环或 while 判断对象的 done 属性。</div>\n\n  ```js\n  // 原生接口\n  let arr = ['a', 'b', 'c'];\n  let iter = arr[Symbol.iterator]();\n  console.log(iter.next())  // {value: \"a\", done: false}\n\n  // 自定义接口\n  const obj = {\n    a: 1,\n    b: 2,\n    [Symbol.iterator]: function(){\n      const that = this;\n      let index = 0;\n      // 对象属性组成的数组\n      const ks = Object.keys(that);\n      return {\n        next: function() {\n          return {\n            value: that[ks[index++]],\n            done: (index &gt; ks.length)\n          }\n        }\n      }\n    }\n  }\n  for(const v of obj) {\n    console.log(v);      // 1\n    break;      // 触发 return \n  }\n  ```\n\n\n### 使用场景\n> 任何接受数组作为参数的场景都默认调用了遍历器接口，比如 Array.from、Object.keys、Promise.all、Map() 等\n\n  ```js\n  // 解构赋值\n  let set = new Set().add('a').add('b');\n  let [first, ...rest] = set;\n\n  // 扩展运算符\n  var str = 'hello';\n  [...str] //  ['h','e','l','l','o']\n\n  // yield*\n  let generator = function* () {\n    yield 1;\n    yield* [2,3,4];\n    yield 5;\n  };\n  var iterator = generator();\n  iterator.next()\n  ```\n\n\n## Promise 对象\n> 处理异步操作的对象，可以通过链式调用的方式来组织代码，让代码更加直观\n\n  ```js\n  //创建promise\n  var promise = new Promise(function(resolve, reject) {\n      // 进行一些异步或耗时操作\n      if ( /*如果成功 */ ) {\n          resolve(\"Stuff worked!\")\n      } else {\n          reject(Error(\"It broke\"))\n      }\n  })\n\n  //绑定处理程序\n  promise.then(function(result) {\n          console.log(result)   //promise成功执行\n  }, function(err) {\n          console.log(err)    //promise失败执行\n  })\n  ```\n\n\n## Generators 函数\n\n### 基础语法\n* __定义__\n  * function 关键字和函数名之间有一个星号\n  * 内部使用 yield 语句，定义不同的内部状态\n  * 作为对象属性时可以简写\n* __调用__\n  * 调用函数会返回一个生成的遍历器对象，并没有执行函数体并返回结果\n  * 调用 next 方法分段执行，从上次暂停地方开始直到 yield/return 语句，返回对象的 \n  value 值会被赋值为 yield/return 右边的结果\n* __原理__\n  * 通过 yield 语句实现传出返回对象\n  * 通过 next(value) 方法传入参数，参数值将作为上一个 yield 语句的返回值\n* __yield 语句__ \n  * 只能用于 Generator 函数内部\n  * 如果用于其它表达式中，则必须放到圆括号里面\n  * 用作函数参数或放在赋值表达式的右边时，可以不加括号\n    \n```js\nfunction* foo(){\n  yield 100;\n  yield 200;\n  return 300;\n}\nlet f = foo();\t\t\t\t\n\nconsole.log(f.next());  // { value: 100, done: false }\t\nconsole.log(f.next());\t// { value: 200, done: false }\nconsole.log(f.next());\t// { value: 300, done: true }\nconsole.log(f.next());\t// { value: undefined, done: true }\n```\n\n\n### 应用场景\n  * 异步编程：将异步操作写到 yield 语句，等到调用 next 方法时再继续执行\n  * 控制流管理：执行多步的耗时操作时，通过回调函数或 Promise 方式都不简洁\n  * 部署 Iterator 接口：利用 Generator 函数，可以在任意对象上部署 Iterator 接口\n  * 作为数据结构：可以返回一系列的值，所以它可以对任意表达式提供类似数组的接口\n\n  ```js\n  // 异步操作的同步化表达\n  function* loadUI() {\n    showLoading();\n    yield loadUIDataAsynchronously();\n    hideLoading();\n  }\n  var loader = loadUI();\n  loader.next()  // 加载\n  loader.next()  // 隐藏\n  \n\n  // 控制流管理\n  step1(function (value1) {\n    step2(value1, function(value2) {\n      step3(value2, function(value3) {\n        // Do something with value3\n      })\n    })\n  })\n\n  Promise.resolve(step1)\n    .then(step2)\n    .then(step3)\n    .then(function (value3) {\n        // Do something with value3\n    }, function (error) {})\n    .done();\n\n  function* longRunningTask(value1) {\n    try {\n      var value2 = yield step1(value1);\n      var value3 = yield step2(value2);\n      var value4 = yield step3(value3);\n      var value5 = yield step4(value4);\n      // Do something with value4\n\n    } catch (e) {\n      \n    }\n  }\n\n\n  // 部署 Iterator 接口\n  function* iterEntries(obj) {\n    let keys = Object.keys(obj);\n    for (let i=0; i &lt; keys.length; i++) {\n      let key = keys[i];\n      yield [key, obj[key]];\n    }\n  }\n\n  let myObj = { foo: 3, bar: 7 };\n  for (let [key, value] of iterEntries(myObj)) {\n    console.log(key, value);\n  }\n\n\n  // 作为数据结构\n  function doStuff() {\n    return [\n      fs.readFile.bind(null, 'hello.txt'),\n      fs.readFile.bind(null, 'world.txt'),\n      fs.readFile.bind(null, 'and-such.txt')\n    ]\n  }\n\n  function *doStuff() {\n    yield fs.readFile.bind(null, 'hello.txt');\n    yield fs.readFile.bind(null, 'world.txt');\n    yield fs.readFile.bind(null, 'and-such.txt');\n  }\n  for (task of doStuff()) {\n      // task是一个函数，可以像回调函数那样使用\n  }\n  ```\n\n\n\n## Moudle 模块化\n  <div style=\"text-indent: 2em\">ES5 不支持原生的模块化，ES6 的 内置模块功能借鉴了 CommonJS、AMD 各自的优点，根据功能将代码封装到不同模块中。每一个模块都有独立的作用域和命名空间，可以防止命名冲突。当前模块通过 export (default) 定义对外暴露的接口，其它模块通过 import 加载对应模块。</div>\n      \n  * export：对外输出当前模块中的多个变量或函数的接口\n    * 通过 export 方式导出时需要加 {}，export default 则不需要\n    * 在一个模块中可以有多个 export，但最多只能有一个 export default\n  * import：一个模块中加载另一个含有 export 接口的模块\n    \n\n  ```js  \n  // lib.js \n  let name = 'freddy'\n  let sayName = function(name) {\n      console.log(name);\n  };\n\n  // export 在一个模块中可以多次使用\n  export const age = 20;\n  export { name, sayName }\n  export { name as userName, sayName as say }  // 改变输出的变量名\n\n  // export default：在一个模块中只能输出一次\n  export default name;\n  export default sayName;  \n  export default { name, sayName }  // 输出一个对象\n\n\n  // main.js\n\n  // 导入部分\n  // export 输出的变量名不可改变\n  import { name, sayName } from \"./lib\";  \n  import { name as userName } from \"./lib\";  \n  import { userName, say } from \"./lib\";  // 接收新变量名\n\n  // export default 输出的变量名可以重新自定义\n  import userName from \"./lib\";\n  import userObj from \"./lib\";\n\n  // 将整个模块当作单一对象导入\n  import * as userinfo from \"./lib\";\n  ```\n        \n\n## class 类的支持\n> 关键字有 constructor、extends、super\n\n### 定义类\n  ```js\n  // ES5 \n  (function(){\n      // 定义类、构造函数\n      function User(name, age){\n          this.name = name;\n          this.age = age;\n      }\n\n      // 定义原型方法\n      User.prototype.show = function(){\n          console.log('prototype');\n      }\n\n      // 定义静态方法\n      User.run = function(){\n          console.log('static');\n      }\n\n      // 暴露接口\n      window.User = user;\n  })();\n\n  // ES6：构造函数、静态方法、原型方法\n  class User {\n      // 构造函数：实例化时默认执行\n      constructor(name, age){\n          // 初始化对象\n          this.name = name;\n          this.age = age;\n      }\n\n      // 原型方法\n      show(){\n          console.log('prototype');\n      }\n\n      // 静态方法\n      static run(){\n          console.log('static');\n      }\n  }\n  ```\n\n\n### 继承类     \n  ```js\n  function Father(name, age){  \n      this.name = name;\n      this.age = age; \n  }\n  Father.prototype.show = function(){ }\n\n  // ES5 \n  function Son(name, age, address){\n      // 继承第一句：让子类实例化的对象具备父类的所有属性\n      // Father.apply(this,arguments);\n      Father.call(this, name, age);\n      this.address = address;\n  }\n  // 继承第二句：让子类实例化对象具备父类的所有原型方法\n  Son.prototype = Object.create(Father.prototype);\n\n  // 继承第三句：找回丢失的构造函数\n  Son.prototype.constructor = Son;\n\n  Son.prototype.run = function(){ }\n\n\n  // ES6 \n  class Son extends Father{\n      constructor(name, age, address){\n          // super 指代整个 prototype/proto 指向的对象\n          super(name, age);\n          this.address = address;\n      }\n  }\n  ```\n \n\n### getters & setters\n> 对某个属性设置存值函数和取值函数，拦截该属性的存取行为\n\n  ```js\n  // 只有 getter 没有 setter 时无法进行赋值操作\n  class People {\n      constructor(name) { //构造函数\n          this.name = name;\n      }\n      get name() {\n          return this._name.toUpperCase();\n      }\n      set name(name) {\n          // 对 this.name 赋则会调用 set name 导致无限递归\n          this._name = name;\n      }\n      sayName() {\n          console.log(this.name);\n      }\n  }\n  var p = new People(\"tom\");\n  console.log(p.name);    // TOM\n  console.log(p._name);   // tom\n  p.sayName();            // TOM\n  ```\n\n\n# 二、ES7\n\n## arr.includes\n> 判断数组是否包含一个指定值\n\n  * 参数\n    * 要搜索的值\n    * 搜索的开始索引\n  * 区别\n    * 返回布尔值，indexOf 返回数值\n    * 可用来判断数组是否包含 NaN，而 indexOf 不行\n    * 对于数组中的空值，includes 返回 undefined，而 indexOf 不会\n\n\n  ```js\n  var arr = [1, , 3, NaN]\n  arr.includes(1)          // true\n  arr.includes(1, 1)       // false\n  arr.includes(NaN)        // true\n  arr.includes(undefined)  // true\n  ```\n\n\n## 求幂运算符 \n  ```js   \n  // 运算符 **  \n  let a = 2\n  a **= 3\n  a == Math.pow(2, 3) == 2 ** 3   // 8    \n  ```\n \n\n\n# 三、ES8\n\n## async/await\n> async 可看作多个异步操作包装成的一个 Promise 对象，await 是 then() 的语法糖\n  \n### 本质\n> async 函数是对 Generator 函数的改进，使用时将它的 星号、yield 分别替换为 async、await 即可，优点如下：\n\n  * 内置执行器：Generator 函数的执行必须依靠 co 模块的执行器，而 async 函数自带\n  * 更好的语义：async、await 分别表示函数里有异步操作、需要等待后面表达式\n      的执行结果，语义比较清楚\n  * 更广的适用性：co 模块约定 yield 命令后面只能是 Thunk 函数或 Promise 对象，\n      而 await 命令后面可以是 Promise 对象和原始类型的值（数值、字符串和布尔值，但这时等同于同步操作）。\n  * 返回 Promise 对象：可以用 then 方法指定下一步的操作\n\n\n### 基础使用\n  ```js\n  login(userName) {\n      return new Promise((resolve, reject) => {\n          setTimeout(() => {\n              resolve('1001');\n          }, 600);\n      });\n  }\n\n  getData(userId) {\n      return new Promise((resolve, reject) => {\n          setTimeout(() => {\n              if (userId === '1001') {\n                  resolve('Success');\n              } else {\n                  reject('Fail');\n              }\n          }, 600);\n      });\n  }\n\n  // 不使用 async/await\n  doLogin(userName) {\n      this.login(userName)\n          .then(this.getData)\n          .then(result => {\n              console.log(result)\n          })\n  }\n\n  // 使用 async/await\n  async doLogin2(userName) {\n      const userId=await this.login(userName);\n      const result=await this.getData(userId);\n  }\n\n  this.doLogin()   // Success\n  this.doLogin2()  // Succes\n  ```\n\n\n## SharedArrayBuffer-Atomics\n>  用于从共享内存位置读取和写入\n\n* 并行：同时执行多个任务\n  * JavaScript 在单线程中执行任务\n    * 同步任务直接在单线程中排队执行\n    * 异步任务通过回调函数将结果重新放入到单线程等待执行调用\n  * Web Worker 引入了多线程并行处理任务\n    * 主线程用来与用户互动\n    * Worker 线程用来承担计算任务\n    * 每个线程的数据都是隔离的，通过 postMessage() 通信\n  * WebGL 用于 GPU 计算来并行处理数据\n* 并发：在重叠的时间段内执行几个任务\n  * SharedArrayBuffer：允许 Worker 线程与主线程共享同一块内存\n  * Atomics: 用于处理 worker 共同操作同一内存地址时引起的冲突等问题\n\n\n## Object.values/entries\n  * Object.values：返回自身属性值的数组\n  * Object.entries：返回自身属性的键值对的数组\n  * Object.getOwnPropertyDescriptors：返回自身属性的描述对象\n\n\n  ```js\n  const obj = { \n    name: \"Jine\",\n    get age() { return '18' }\n  }\n  Object.values(obj)   // [\"Jine\", \"18\"]\n  Object.entries(obj)  // [[\"name\", \"Jine\"], [\"age\", \"18\"]]\n\n  Object.getOwnPropertyDescriptor(obj, \"name\")  // 单个属性\n  Object.getOwnPropertyDescriptors(obj)         // 所有属性\n  ```\n\n\n## String.padStart/padEnd\n> 用于填补字符串的首部或尾部来达到给定长度，参数为 目标长度和可选的填充字符\n\n  ```js\n  \"a\".padStart(2)         //  a \n  \"a\".padStart(2, \"bc\")   // ba\n  \"a\".padEnd(3, \"b\")      // abb\n  ```\n\n\n# 四、ES9\n> 正则命名捕获组、反向断言、Unicode 转义等略过\n\n## 异步迭代\n> 允许 async/await 和 for-of 一起使用，以串行的方式执行异步操作\n\n  ```js\n  // ES6 同步迭代器\n  const items = ['a', 'b'];\n  for(const item of items) {\n      console.log(item);  // a b   \n  }\n\n  // 异步迭代器：返回一个 Promise\n  const promises = [\n      new Promise(resolve => resolve(1)),\n      new Promise(resolve => resolve(2)),\n      new Promise(resolve => resolve(3)),\n  ]\n  async function test() {\n      for await (let p of promises) {\n          console.log(p);\n      }\n  }\n  test(); //1 ,2 3\n  ```\n\n\n\n## Promise.finally\n> 指定最终一定会执行的逻辑处理\n\n  ```js\n  Promise.resolve(42)\n    .then(result =>{ })\n    .catch(error => { })\n    .finally(() => { }) \n  ```\n\n\n\n\n\n\n\n","source":"_posts/12-ES语法.md","raw":"---\ntitle: ES6 ～ ES9 新特性\ntags:\n  - Javascript\n  - ES\ncategories: Javascript\ntop: false\nkeywords:\n  - js\n  - ES\ndate: 2019-04-04 00:35:46\ndescription: ECMAScript6 ～ 9 常用的新语法规范\n---\n\n# 一、ES6\n\n## let const\n  * __var__：声明变量或常量\n    * 存在变量提升现象：变量可以在声明之前使用，值为 undefined \n    * 没有块级作用域：ES6 之前的 js 只有全局作用域和函数作用域\n  * __let__：声明变量\n    * 存在暂时性死区：变量在声明之前使用会报错\n    * 存在块级作用域：声明的变量只能在其所在的代码块内才能访问\n  * __const__：声明常量\n    * 存在暂时性死区和块级作用域\n    * 常量名建议写成纯大写字母表示\n    * 不允许重新赋值，只能在声明时立即初始化\n\n\n## 字符串\n\n### 字符串拼接\n  ```js\n  // ES5 \n  var name = 'lux'\n  console.log('hello' + name)\n\n  // ES6：${}\n  const name = 'lux'\n  console.log(`hello ${name}`)  // hello lux\n  ```\n\n\n### 多行字符串\n  ```js\n  // ES5：反斜杠\n  var msg = \"Hi \\\n  man\n  \"\n\n  // ES6：反引号\n  const template = `welcome\n      to\n  world`\n  ```\n\n\n### API\n  ```js\n  // includes：判断是否包含\n  const str = 'hahay'\n  console.log(str.includes('y')) // true\n\n  // repeat: 获取字符串重复n次\n  const str = 'he'\n  console.log(str.repeat(3)) // 'hehehe'\n  // 如果带有小数，先进行 Math.floor(num) 处理\n\n  // startsWith、endsWith：判断是否以给定文本 开始、结束\n  const str =  'hello world!'\n  console.log(str.startsWith('hello'))  // true\n  console.log(str.endsWith('!'))        // true\n  \n  // padStart、padEnd：若字符串不够指定长度则在 头部、尾部 补全\n  setInterval(() => {\n      const now = new Date()\n      const hours = now.getHours().toString()\n      const minutes = now.getMinutes().toString()\n      const seconds = now.getSeconds().toString()\n      console.log(`${hours.padStart(2, 0)}:${minutes.padStart(2, 0)}:${seconds.padStart(2, 0)}`)\n  }, 1000)\n  ```\n\n\n## 函数\n\n### 箭头函数\n  * 省略 return 关键字\n  * 不需要 function 关键字\n  * 始终指向当前上下文的 this 对象\n  \n```js\n// 只有一个参数时不需要 ()\nlet f = n => n  \nlet f = () => 5 \n\n// 只有一条返回语句时不需要 {}\n[1,2,3].map(x => x + 1)\n\n// 返回对象则需要括号包裹\nlet obj = name => ({\"name\":name}) \n```\n\n\n            \n### 函数参数\n  * 默认参数：定义函数时指定\n  * Rest 参数：获取函数的不定参数\n\n```js\n// 默认参数\nfunction sum(x=1, y=1){  \n  return x + y;  \n}\n\n// Rest 参数\nfunction foo(x, ...params){ \n  console.log(params) \n} \n\nfoo(1, 2)      // [2]\nfoo(1, 2, 3)   // [2, 3]\n```\n\n\n## 对象\n  ```js\n  // 属性简写：属性名相同\n  function people(name, age) {\n      return {\n          name, age     \n      }\n  }\n  var name = 'bar';\n  var user = { name }; // { name: \"bar\" }\n\n\n  // 方法简写\n  const people = {\n    name: 'lux',\n    getName () {\n        console.log(this.name)\n    }\n  }\n\n  // 浅拷贝方法\n  const target = {}   \n  Object.assign(target, { name: 'Lisa' }, { age: 18 })\n  ```\n\n\n## 解构赋值\n> 自动提取数组或对象中的值并赋值给变量，要求前后结构相同或包含\n\n  ```js\n  // 对象：变量须与属性同名但不分顺序\n  let { name, age } = { name: 'lux', age: 20 }\n  console.log(`${name}: ${age}`)  // lux : 20\n\n  var {foo} = {bar: 'baz'}\n  console.log(foo)           // undefined\n  \n\n  // 数组：变量值由其位置决定\n  let [x, y] = [1, 2]\n  console.log(x, y)     // 1, 2\n\n  let [a, ...b] = [1, 2, 3, 4]\n\n  // 不完全解构\n  let [x, y] = [1, 2, 3]\n\n  // 默认值\n  [x, y = 'b'] = ['a']    // x='a', y='b'\n\n\n  // 代码重构：最后一行即可\n  var body = request.body\n  var username = body.username\n  var password = body.password\n  const { body, body: { username, password } } = request \n  ``` \n\n\n## Spread 扩展运算符 \n> Rest 参数的逆运算，用于将数组或对象展开成一系列用逗号隔开的值\n\n  * 合并对象或数组：参数位置不限制\n  * 配合解构赋值：必须将参数放到最后，否则报错\n\n```js\n// 数组\nconst color = ['red', 'yellow']\nconst colorful = [...color, 'green', 'pink']  \nconst [first, ...colorful] = color  // ['yellow']\n\n// 对象\nconst user = { name: 'lux', age: 20 }\nconst userinfo = { ...user, address: 'shanghai' }\nconst { name, ...userinfo } = user   // {age: 20}\n```\n\n\n## Symbol 类型\n> 一种新的原始数据类型，Symbol 值类似于字符串但每一个都表示独一无二的值\n\n  ```js\n  // 创建\n  var s1 = Symbol();          \n  var s2 = Symbol();\n  var s3 = Symbol(\"foo\");      // 传入字符串表示描述信息\n  var s4 = Symbol.for(\"foo\");  // 有则返回，无则创建\n\n  // 任何两个 Symbol 值都不相等\n  console.log(typeof s1, s1 == s2)   // symbol false\n\n  console.log(Symbol.keyFor(s3))     // undefined\n  console.log(Symbol.keyFor(s4))     // foo\n\n\n  // 不能与其他类型的值进行运算，否则会报错\n  // var k = s1 + 1\n\n  // 可以转为字符串、布尔值\n  var str = String(s1)\n  var bl = Boolean(s1)\n\n\n  // 作为对象属性名：不能使用点操作\n  var obj = { [s1]: 'hello' };\n\n  var obj = {}\n  obj[s1] = 'hello';\n\n  var obj = {};\n  Object.defineProperty(obj, s1, { value: 'hello' });\n\n\n  // 属性名的遍历\n  var sKey = Object.getOwnPropertySymbols(obj)  // 返回Symbol键名\n  var aKey = Reflect.ownKeys(obj)               // 返回所有键名\n  ```\n\n\n## for-of 遍历\n  * 方式对比\n    * forEach：无法跳出循环，即 break、return 命令都不奏效\n    * for-in：主要是为遍历对象而设计的，不适用于遍历数组\n    * for-of：调用遍历器接口，使用范围较广\n  * 使用技巧\n    * 类似数组的对象：通过 Array.from 方法转为数组\n    * 普通对象\n      * 通过 Object.keys 方法将键名生成数组\n      * 通过 Generator 函数将对象重新包装\n\n  ```js\n  let arrLike = { length: 2, 0: 'a', 1: 'b' };\n  for (let x of Array.from(arrLike)) {\n      console.log(x)\n  }\n\n  let obj = { name: 'Jane', age: 20 };\n  for (var key of Object.keys(obj)) {\n    console.log(obj[key]);\n  }\n  ```\n\n\n## Iterator 遍历器\n> 本质是一种有 next() 方法的指针对象，第几次调用就指向第几个成员\n\n### 功能\n  * 为各种数据结构提供一个统一的、简便的访问接口（统一）\n  * 使得数据结构的成员能够按某种次序排列（按序）\n  * 配合 for-of 实现遍历\n\n\n### 接口\n> 本质是一个生成遍历器的函数，不同于 forEach 等遍历方法\n\n  <div style=\"text-indent: 2em\">默认部署在数据结构的 Symbol.iterator 属性，它是当前数据结构默认的遍历器生成函数，执行这个函数就会返回一个遍历器。原生具备 Iterator 接口的数据结构如下：Array、TypedArray、Map、Set、String，只有这些数据结构不需要自定义遍历器生成函数并部署，循环遍历时可以直接通过 for-of 循环或 while 判断对象的 done 属性。</div>\n\n  ```js\n  // 原生接口\n  let arr = ['a', 'b', 'c'];\n  let iter = arr[Symbol.iterator]();\n  console.log(iter.next())  // {value: \"a\", done: false}\n\n  // 自定义接口\n  const obj = {\n    a: 1,\n    b: 2,\n    [Symbol.iterator]: function(){\n      const that = this;\n      let index = 0;\n      // 对象属性组成的数组\n      const ks = Object.keys(that);\n      return {\n        next: function() {\n          return {\n            value: that[ks[index++]],\n            done: (index &gt; ks.length)\n          }\n        }\n      }\n    }\n  }\n  for(const v of obj) {\n    console.log(v);      // 1\n    break;      // 触发 return \n  }\n  ```\n\n\n### 使用场景\n> 任何接受数组作为参数的场景都默认调用了遍历器接口，比如 Array.from、Object.keys、Promise.all、Map() 等\n\n  ```js\n  // 解构赋值\n  let set = new Set().add('a').add('b');\n  let [first, ...rest] = set;\n\n  // 扩展运算符\n  var str = 'hello';\n  [...str] //  ['h','e','l','l','o']\n\n  // yield*\n  let generator = function* () {\n    yield 1;\n    yield* [2,3,4];\n    yield 5;\n  };\n  var iterator = generator();\n  iterator.next()\n  ```\n\n\n## Promise 对象\n> 处理异步操作的对象，可以通过链式调用的方式来组织代码，让代码更加直观\n\n  ```js\n  //创建promise\n  var promise = new Promise(function(resolve, reject) {\n      // 进行一些异步或耗时操作\n      if ( /*如果成功 */ ) {\n          resolve(\"Stuff worked!\")\n      } else {\n          reject(Error(\"It broke\"))\n      }\n  })\n\n  //绑定处理程序\n  promise.then(function(result) {\n          console.log(result)   //promise成功执行\n  }, function(err) {\n          console.log(err)    //promise失败执行\n  })\n  ```\n\n\n## Generators 函数\n\n### 基础语法\n* __定义__\n  * function 关键字和函数名之间有一个星号\n  * 内部使用 yield 语句，定义不同的内部状态\n  * 作为对象属性时可以简写\n* __调用__\n  * 调用函数会返回一个生成的遍历器对象，并没有执行函数体并返回结果\n  * 调用 next 方法分段执行，从上次暂停地方开始直到 yield/return 语句，返回对象的 \n  value 值会被赋值为 yield/return 右边的结果\n* __原理__\n  * 通过 yield 语句实现传出返回对象\n  * 通过 next(value) 方法传入参数，参数值将作为上一个 yield 语句的返回值\n* __yield 语句__ \n  * 只能用于 Generator 函数内部\n  * 如果用于其它表达式中，则必须放到圆括号里面\n  * 用作函数参数或放在赋值表达式的右边时，可以不加括号\n    \n```js\nfunction* foo(){\n  yield 100;\n  yield 200;\n  return 300;\n}\nlet f = foo();\t\t\t\t\n\nconsole.log(f.next());  // { value: 100, done: false }\t\nconsole.log(f.next());\t// { value: 200, done: false }\nconsole.log(f.next());\t// { value: 300, done: true }\nconsole.log(f.next());\t// { value: undefined, done: true }\n```\n\n\n### 应用场景\n  * 异步编程：将异步操作写到 yield 语句，等到调用 next 方法时再继续执行\n  * 控制流管理：执行多步的耗时操作时，通过回调函数或 Promise 方式都不简洁\n  * 部署 Iterator 接口：利用 Generator 函数，可以在任意对象上部署 Iterator 接口\n  * 作为数据结构：可以返回一系列的值，所以它可以对任意表达式提供类似数组的接口\n\n  ```js\n  // 异步操作的同步化表达\n  function* loadUI() {\n    showLoading();\n    yield loadUIDataAsynchronously();\n    hideLoading();\n  }\n  var loader = loadUI();\n  loader.next()  // 加载\n  loader.next()  // 隐藏\n  \n\n  // 控制流管理\n  step1(function (value1) {\n    step2(value1, function(value2) {\n      step3(value2, function(value3) {\n        // Do something with value3\n      })\n    })\n  })\n\n  Promise.resolve(step1)\n    .then(step2)\n    .then(step3)\n    .then(function (value3) {\n        // Do something with value3\n    }, function (error) {})\n    .done();\n\n  function* longRunningTask(value1) {\n    try {\n      var value2 = yield step1(value1);\n      var value3 = yield step2(value2);\n      var value4 = yield step3(value3);\n      var value5 = yield step4(value4);\n      // Do something with value4\n\n    } catch (e) {\n      \n    }\n  }\n\n\n  // 部署 Iterator 接口\n  function* iterEntries(obj) {\n    let keys = Object.keys(obj);\n    for (let i=0; i &lt; keys.length; i++) {\n      let key = keys[i];\n      yield [key, obj[key]];\n    }\n  }\n\n  let myObj = { foo: 3, bar: 7 };\n  for (let [key, value] of iterEntries(myObj)) {\n    console.log(key, value);\n  }\n\n\n  // 作为数据结构\n  function doStuff() {\n    return [\n      fs.readFile.bind(null, 'hello.txt'),\n      fs.readFile.bind(null, 'world.txt'),\n      fs.readFile.bind(null, 'and-such.txt')\n    ]\n  }\n\n  function *doStuff() {\n    yield fs.readFile.bind(null, 'hello.txt');\n    yield fs.readFile.bind(null, 'world.txt');\n    yield fs.readFile.bind(null, 'and-such.txt');\n  }\n  for (task of doStuff()) {\n      // task是一个函数，可以像回调函数那样使用\n  }\n  ```\n\n\n\n## Moudle 模块化\n  <div style=\"text-indent: 2em\">ES5 不支持原生的模块化，ES6 的 内置模块功能借鉴了 CommonJS、AMD 各自的优点，根据功能将代码封装到不同模块中。每一个模块都有独立的作用域和命名空间，可以防止命名冲突。当前模块通过 export (default) 定义对外暴露的接口，其它模块通过 import 加载对应模块。</div>\n      \n  * export：对外输出当前模块中的多个变量或函数的接口\n    * 通过 export 方式导出时需要加 {}，export default 则不需要\n    * 在一个模块中可以有多个 export，但最多只能有一个 export default\n  * import：一个模块中加载另一个含有 export 接口的模块\n    \n\n  ```js  \n  // lib.js \n  let name = 'freddy'\n  let sayName = function(name) {\n      console.log(name);\n  };\n\n  // export 在一个模块中可以多次使用\n  export const age = 20;\n  export { name, sayName }\n  export { name as userName, sayName as say }  // 改变输出的变量名\n\n  // export default：在一个模块中只能输出一次\n  export default name;\n  export default sayName;  \n  export default { name, sayName }  // 输出一个对象\n\n\n  // main.js\n\n  // 导入部分\n  // export 输出的变量名不可改变\n  import { name, sayName } from \"./lib\";  \n  import { name as userName } from \"./lib\";  \n  import { userName, say } from \"./lib\";  // 接收新变量名\n\n  // export default 输出的变量名可以重新自定义\n  import userName from \"./lib\";\n  import userObj from \"./lib\";\n\n  // 将整个模块当作单一对象导入\n  import * as userinfo from \"./lib\";\n  ```\n        \n\n## class 类的支持\n> 关键字有 constructor、extends、super\n\n### 定义类\n  ```js\n  // ES5 \n  (function(){\n      // 定义类、构造函数\n      function User(name, age){\n          this.name = name;\n          this.age = age;\n      }\n\n      // 定义原型方法\n      User.prototype.show = function(){\n          console.log('prototype');\n      }\n\n      // 定义静态方法\n      User.run = function(){\n          console.log('static');\n      }\n\n      // 暴露接口\n      window.User = user;\n  })();\n\n  // ES6：构造函数、静态方法、原型方法\n  class User {\n      // 构造函数：实例化时默认执行\n      constructor(name, age){\n          // 初始化对象\n          this.name = name;\n          this.age = age;\n      }\n\n      // 原型方法\n      show(){\n          console.log('prototype');\n      }\n\n      // 静态方法\n      static run(){\n          console.log('static');\n      }\n  }\n  ```\n\n\n### 继承类     \n  ```js\n  function Father(name, age){  \n      this.name = name;\n      this.age = age; \n  }\n  Father.prototype.show = function(){ }\n\n  // ES5 \n  function Son(name, age, address){\n      // 继承第一句：让子类实例化的对象具备父类的所有属性\n      // Father.apply(this,arguments);\n      Father.call(this, name, age);\n      this.address = address;\n  }\n  // 继承第二句：让子类实例化对象具备父类的所有原型方法\n  Son.prototype = Object.create(Father.prototype);\n\n  // 继承第三句：找回丢失的构造函数\n  Son.prototype.constructor = Son;\n\n  Son.prototype.run = function(){ }\n\n\n  // ES6 \n  class Son extends Father{\n      constructor(name, age, address){\n          // super 指代整个 prototype/proto 指向的对象\n          super(name, age);\n          this.address = address;\n      }\n  }\n  ```\n \n\n### getters & setters\n> 对某个属性设置存值函数和取值函数，拦截该属性的存取行为\n\n  ```js\n  // 只有 getter 没有 setter 时无法进行赋值操作\n  class People {\n      constructor(name) { //构造函数\n          this.name = name;\n      }\n      get name() {\n          return this._name.toUpperCase();\n      }\n      set name(name) {\n          // 对 this.name 赋则会调用 set name 导致无限递归\n          this._name = name;\n      }\n      sayName() {\n          console.log(this.name);\n      }\n  }\n  var p = new People(\"tom\");\n  console.log(p.name);    // TOM\n  console.log(p._name);   // tom\n  p.sayName();            // TOM\n  ```\n\n\n# 二、ES7\n\n## arr.includes\n> 判断数组是否包含一个指定值\n\n  * 参数\n    * 要搜索的值\n    * 搜索的开始索引\n  * 区别\n    * 返回布尔值，indexOf 返回数值\n    * 可用来判断数组是否包含 NaN，而 indexOf 不行\n    * 对于数组中的空值，includes 返回 undefined，而 indexOf 不会\n\n\n  ```js\n  var arr = [1, , 3, NaN]\n  arr.includes(1)          // true\n  arr.includes(1, 1)       // false\n  arr.includes(NaN)        // true\n  arr.includes(undefined)  // true\n  ```\n\n\n## 求幂运算符 \n  ```js   \n  // 运算符 **  \n  let a = 2\n  a **= 3\n  a == Math.pow(2, 3) == 2 ** 3   // 8    \n  ```\n \n\n\n# 三、ES8\n\n## async/await\n> async 可看作多个异步操作包装成的一个 Promise 对象，await 是 then() 的语法糖\n  \n### 本质\n> async 函数是对 Generator 函数的改进，使用时将它的 星号、yield 分别替换为 async、await 即可，优点如下：\n\n  * 内置执行器：Generator 函数的执行必须依靠 co 模块的执行器，而 async 函数自带\n  * 更好的语义：async、await 分别表示函数里有异步操作、需要等待后面表达式\n      的执行结果，语义比较清楚\n  * 更广的适用性：co 模块约定 yield 命令后面只能是 Thunk 函数或 Promise 对象，\n      而 await 命令后面可以是 Promise 对象和原始类型的值（数值、字符串和布尔值，但这时等同于同步操作）。\n  * 返回 Promise 对象：可以用 then 方法指定下一步的操作\n\n\n### 基础使用\n  ```js\n  login(userName) {\n      return new Promise((resolve, reject) => {\n          setTimeout(() => {\n              resolve('1001');\n          }, 600);\n      });\n  }\n\n  getData(userId) {\n      return new Promise((resolve, reject) => {\n          setTimeout(() => {\n              if (userId === '1001') {\n                  resolve('Success');\n              } else {\n                  reject('Fail');\n              }\n          }, 600);\n      });\n  }\n\n  // 不使用 async/await\n  doLogin(userName) {\n      this.login(userName)\n          .then(this.getData)\n          .then(result => {\n              console.log(result)\n          })\n  }\n\n  // 使用 async/await\n  async doLogin2(userName) {\n      const userId=await this.login(userName);\n      const result=await this.getData(userId);\n  }\n\n  this.doLogin()   // Success\n  this.doLogin2()  // Succes\n  ```\n\n\n## SharedArrayBuffer-Atomics\n>  用于从共享内存位置读取和写入\n\n* 并行：同时执行多个任务\n  * JavaScript 在单线程中执行任务\n    * 同步任务直接在单线程中排队执行\n    * 异步任务通过回调函数将结果重新放入到单线程等待执行调用\n  * Web Worker 引入了多线程并行处理任务\n    * 主线程用来与用户互动\n    * Worker 线程用来承担计算任务\n    * 每个线程的数据都是隔离的，通过 postMessage() 通信\n  * WebGL 用于 GPU 计算来并行处理数据\n* 并发：在重叠的时间段内执行几个任务\n  * SharedArrayBuffer：允许 Worker 线程与主线程共享同一块内存\n  * Atomics: 用于处理 worker 共同操作同一内存地址时引起的冲突等问题\n\n\n## Object.values/entries\n  * Object.values：返回自身属性值的数组\n  * Object.entries：返回自身属性的键值对的数组\n  * Object.getOwnPropertyDescriptors：返回自身属性的描述对象\n\n\n  ```js\n  const obj = { \n    name: \"Jine\",\n    get age() { return '18' }\n  }\n  Object.values(obj)   // [\"Jine\", \"18\"]\n  Object.entries(obj)  // [[\"name\", \"Jine\"], [\"age\", \"18\"]]\n\n  Object.getOwnPropertyDescriptor(obj, \"name\")  // 单个属性\n  Object.getOwnPropertyDescriptors(obj)         // 所有属性\n  ```\n\n\n## String.padStart/padEnd\n> 用于填补字符串的首部或尾部来达到给定长度，参数为 目标长度和可选的填充字符\n\n  ```js\n  \"a\".padStart(2)         //  a \n  \"a\".padStart(2, \"bc\")   // ba\n  \"a\".padEnd(3, \"b\")      // abb\n  ```\n\n\n# 四、ES9\n> 正则命名捕获组、反向断言、Unicode 转义等略过\n\n## 异步迭代\n> 允许 async/await 和 for-of 一起使用，以串行的方式执行异步操作\n\n  ```js\n  // ES6 同步迭代器\n  const items = ['a', 'b'];\n  for(const item of items) {\n      console.log(item);  // a b   \n  }\n\n  // 异步迭代器：返回一个 Promise\n  const promises = [\n      new Promise(resolve => resolve(1)),\n      new Promise(resolve => resolve(2)),\n      new Promise(resolve => resolve(3)),\n  ]\n  async function test() {\n      for await (let p of promises) {\n          console.log(p);\n      }\n  }\n  test(); //1 ,2 3\n  ```\n\n\n\n## Promise.finally\n> 指定最终一定会执行的逻辑处理\n\n  ```js\n  Promise.resolve(42)\n    .then(result =>{ })\n    .catch(error => { })\n    .finally(() => { }) \n  ```\n\n\n\n\n\n\n\n","slug":"12-ES语法","published":1,"updated":"2019-04-13T19:50:24.203Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvid4plk00160nbxxqdyqm8o","content":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><html><head></head><body><h1 id=\"一、ES6\"><a href=\"#一、ES6\" class=\"headerlink\" title=\"一、ES6\"></a>一、ES6</h1><h2 id=\"let-const\"><a href=\"#let-const\" class=\"headerlink\" title=\"let const\"></a>let const</h2><ul><li><strong>var</strong>：声明变量或常量<ul><li>存在变量提升现象：变量可以在声明之前使用，值为 undefined</li><li>没有块级作用域：ES6 之前的 js 只有全局作用域和函数作用域</li></ul></li><li><strong>let</strong>：声明变量<ul><li>存在暂时性死区：变量在声明之前使用会报错</li><li>存在块级作用域：声明的变量只能在其所在的代码块内才能访问</li></ul></li><li><strong>const</strong>：声明常量<ul><li>存在暂时性死区和块级作用域</li><li>常量名建议写成纯大写字母表示</li><li>不允许重新赋值，只能在声明时立即初始化</li></ul></li></ul><h2 id=\"字符串\"><a href=\"#字符串\" class=\"headerlink\" title=\"字符串\"></a>字符串</h2><h3 id=\"字符串拼接\"><a href=\"#字符串拼接\" class=\"headerlink\" title=\"字符串拼接\"></a>字符串拼接</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ES5 </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">'lux'</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'hello'</span> + name)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ES6：${}</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> name = <span class=\"string\">'lux'</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">`hello <span class=\"subst\">${name}</span>`</span>)  <span class=\"comment\">// hello lux</span></span><br></pre></td></tr></tbody></table></figure><h3 id=\"多行字符串\"><a href=\"#多行字符串\" class=\"headerlink\" title=\"多行字符串\"></a>多行字符串</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ES5：反斜杠</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> msg = <span class=\"string\">\"Hi \\</span></span><br><span class=\"line\"><span class=\"string\">man</span></span><br><span class=\"line\"><span class=\"string\">\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ES6：反引号</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> template = <span class=\"string\">`welcome</span></span><br><span class=\"line\"><span class=\"string\">    to</span></span><br><span class=\"line\"><span class=\"string\">world`</span></span><br></pre></td></tr></tbody></table></figure><h3 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// includes：判断是否包含</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> str = <span class=\"string\">'hahay'</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(str.includes(<span class=\"string\">'y'</span>)) <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// repeat: 获取字符串重复n次</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> str = <span class=\"string\">'he'</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(str.repeat(<span class=\"number\">3</span>)) <span class=\"comment\">// 'hehehe'</span></span><br><span class=\"line\"><span class=\"comment\">// 如果带有小数，先进行 Math.floor(num) 处理</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// startsWith、endsWith：判断是否以给定文本 开始、结束</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> str =  <span class=\"string\">'hello world!'</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(str.startsWith(<span class=\"string\">'hello'</span>))  <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(str.endsWith(<span class=\"string\">'!'</span>))        <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// padStart、padEnd：若字符串不够指定长度则在 头部、尾部 补全</span></span><br><span class=\"line\">setInterval(<span class=\"function\"><span class=\"params\">()</span> =></span> {</span><br><span class=\"line\">    <span class=\"keyword\">const</span> now = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>()</span><br><span class=\"line\">    <span class=\"keyword\">const</span> hours = now.getHours().toString()</span><br><span class=\"line\">    <span class=\"keyword\">const</span> minutes = now.getMinutes().toString()</span><br><span class=\"line\">    <span class=\"keyword\">const</span> seconds = now.getSeconds().toString()</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">`<span class=\"subst\">${hours.padStart(<span class=\"number\">2</span>, <span class=\"number\">0</span>)}</span>:<span class=\"subst\">${minutes.padStart(<span class=\"number\">2</span>, <span class=\"number\">0</span>)}</span>:<span class=\"subst\">${seconds.padStart(<span class=\"number\">2</span>, <span class=\"number\">0</span>)}</span>`</span>)</span><br><span class=\"line\">}, <span class=\"number\">1000</span>)</span><br></pre></td></tr></tbody></table></figure><h2 id=\"函数\"><a href=\"#函数\" class=\"headerlink\" title=\"函数\"></a>函数</h2><h3 id=\"箭头函数\"><a href=\"#箭头函数\" class=\"headerlink\" title=\"箭头函数\"></a>箭头函数</h3><ul><li>省略 return 关键字</li><li>不需要 function 关键字</li><li>始终指向当前上下文的 this 对象</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 只有一个参数时不需要 ()</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> f = <span class=\"function\"><span class=\"params\">n</span> =></span> n  </span><br><span class=\"line\"><span class=\"keyword\">let</span> f = <span class=\"function\"><span class=\"params\">()</span> =></span> <span class=\"number\">5</span> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 只有一条返回语句时不需要 {}</span></span><br><span class=\"line\">[<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>].map(<span class=\"function\"><span class=\"params\">x</span> =></span> x + <span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 返回对象则需要括号包裹</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> obj = <span class=\"function\"><span class=\"params\">name</span> =></span> ({<span class=\"string\">\"name\"</span>:name})</span><br></pre></td></tr></tbody></table></figure><h3 id=\"函数参数\"><a href=\"#函数参数\" class=\"headerlink\" title=\"函数参数\"></a>函数参数</h3><ul><li>默认参数：定义函数时指定</li><li>Rest 参数：获取函数的不定参数</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 默认参数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sum</span>(<span class=\"params\">x=<span class=\"number\">1</span>, y=<span class=\"number\">1</span></span>)</span>{  </span><br><span class=\"line\">  <span class=\"keyword\">return</span> x + y;  </span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Rest 参数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">x, ...params</span>)</span>{ </span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(params) </span><br><span class=\"line\">} </span><br><span class=\"line\"></span><br><span class=\"line\">foo(<span class=\"number\">1</span>, <span class=\"number\">2</span>)      <span class=\"comment\">// [2]</span></span><br><span class=\"line\">foo(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>)   <span class=\"comment\">// [2, 3]</span></span><br></pre></td></tr></tbody></table></figure><h2 id=\"对象\"><a href=\"#对象\" class=\"headerlink\" title=\"对象\"></a>对象</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 属性简写：属性名相同</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">people</span>(<span class=\"params\">name, age</span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">return</span> {</span><br><span class=\"line\">        name, age     </span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">'bar'</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> user = { name }; <span class=\"comment\">// { name: \"bar\" }</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 方法简写</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> people = {</span><br><span class=\"line\">  name: <span class=\"string\">'lux'</span>,</span><br><span class=\"line\">  getName () {</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name)</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 浅拷贝方法</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> target = {}   </span><br><span class=\"line\"><span class=\"built_in\">Object</span>.assign(target, { <span class=\"attr\">name</span>: <span class=\"string\">'Lisa'</span> }, { <span class=\"attr\">age</span>: <span class=\"number\">18</span> })</span><br></pre></td></tr></tbody></table></figure><h2 id=\"解构赋值\"><a href=\"#解构赋值\" class=\"headerlink\" title=\"解构赋值\"></a>解构赋值</h2><blockquote><p>自动提取数组或对象中的值并赋值给变量，要求前后结构相同或包含</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  <span class=\"comment\">// 对象：变量须与属性同名但不分顺序</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> { name, age } = { <span class=\"attr\">name</span>: <span class=\"string\">'lux'</span>, <span class=\"attr\">age</span>: <span class=\"number\">20</span> }</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">`<span class=\"subst\">${name}</span>: <span class=\"subst\">${age}</span>`</span>)  <span class=\"comment\">// lux : 20</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> {foo} = {<span class=\"attr\">bar</span>: <span class=\"string\">'baz'</span>}</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(foo)           <span class=\"comment\">// undefined</span></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 数组：变量值由其位置决定</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> [x, y] = [<span class=\"number\">1</span>, <span class=\"number\">2</span>]</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(x, y)     <span class=\"comment\">// 1, 2</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> [a, ...b] = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 不完全解构</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> [x, y] = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 默认值</span></span><br><span class=\"line\">  [x, y = <span class=\"string\">'b'</span>] = [<span class=\"string\">'a'</span>]    <span class=\"comment\">// x='a', y='b'</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 代码重构：最后一行即可</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> body = request.body</span><br><span class=\"line\">  <span class=\"keyword\">var</span> username = body.username</span><br><span class=\"line\">  <span class=\"keyword\">var</span> password = body.password</span><br><span class=\"line\">  <span class=\"keyword\">const</span> { body, <span class=\"attr\">body</span>: { username, password } } = request </span><br><span class=\"line\">  <span class=\"string\">``</span><span class=\"string\">` </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">## Spread 扩展运算符 </span></span><br><span class=\"line\"><span class=\"string\">> Rest 参数的逆运算，用于将数组或对象展开成一系列用逗号隔开的值</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">  * 合并对象或数组：参数位置不限制</span></span><br><span class=\"line\"><span class=\"string\">  * 配合解构赋值：必须将参数放到最后，否则报错</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>js</span><br><span class=\"line\"><span class=\"comment\">// 数组</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> color = [<span class=\"string\">'red'</span>, <span class=\"string\">'yellow'</span>]</span><br><span class=\"line\"><span class=\"keyword\">const</span> colorful = [...color, <span class=\"string\">'green'</span>, <span class=\"string\">'pink'</span>]  </span><br><span class=\"line\"><span class=\"keyword\">const</span> [first, ...colorful] = color  <span class=\"comment\">// ['yellow']</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 对象</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> user = { <span class=\"attr\">name</span>: <span class=\"string\">'lux'</span>, <span class=\"attr\">age</span>: <span class=\"number\">20</span> }</span><br><span class=\"line\"><span class=\"keyword\">const</span> userinfo = { ...user, <span class=\"attr\">address</span>: <span class=\"string\">'shanghai'</span> }</span><br><span class=\"line\"><span class=\"keyword\">const</span> { name, ...userinfo } = user   <span class=\"comment\">// {age: 20}</span></span><br></pre></td></tr></tbody></table></figure><h2 id=\"Symbol-类型\"><a href=\"#Symbol-类型\" class=\"headerlink\" title=\"Symbol 类型\"></a>Symbol 类型</h2><blockquote><p>一种新的原始数据类型，Symbol 值类似于字符串但每一个都表示独一无二的值</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 创建</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> s1 = <span class=\"built_in\">Symbol</span>();          </span><br><span class=\"line\"><span class=\"keyword\">var</span> s2 = <span class=\"built_in\">Symbol</span>();</span><br><span class=\"line\"><span class=\"keyword\">var</span> s3 = <span class=\"built_in\">Symbol</span>(<span class=\"string\">\"foo\"</span>);      <span class=\"comment\">// 传入字符串表示描述信息</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> s4 = <span class=\"built_in\">Symbol</span>.for(<span class=\"string\">\"foo\"</span>);  <span class=\"comment\">// 有则返回，无则创建</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 任何两个 Symbol 值都不相等</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"keyword\">typeof</span> s1, s1 == s2)   <span class=\"comment\">// symbol false</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">Symbol</span>.keyFor(s3))     <span class=\"comment\">// undefined</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">Symbol</span>.keyFor(s4))     <span class=\"comment\">// foo</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 不能与其他类型的值进行运算，否则会报错</span></span><br><span class=\"line\"><span class=\"comment\">// var k = s1 + 1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 可以转为字符串、布尔值</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> str = <span class=\"built_in\">String</span>(s1)</span><br><span class=\"line\"><span class=\"keyword\">var</span> bl = <span class=\"built_in\">Boolean</span>(s1)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 作为对象属性名：不能使用点操作</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = { [s1]: <span class=\"string\">'hello'</span> };</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = {}</span><br><span class=\"line\">obj[s1] = <span class=\"string\">'hello'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = {};</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(obj, s1, { <span class=\"attr\">value</span>: <span class=\"string\">'hello'</span> });</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 属性名的遍历</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> sKey = <span class=\"built_in\">Object</span>.getOwnPropertySymbols(obj)  <span class=\"comment\">// 返回Symbol键名</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> aKey = <span class=\"built_in\">Reflect</span>.ownKeys(obj)               <span class=\"comment\">// 返回所有键名</span></span><br></pre></td></tr></tbody></table></figure><h2 id=\"for-of-遍历\"><a href=\"#for-of-遍历\" class=\"headerlink\" title=\"for-of 遍历\"></a>for-of 遍历</h2><ul><li>方式对比<ul><li>forEach：无法跳出循环，即 break、return 命令都不奏效</li><li>for-in：主要是为遍历对象而设计的，不适用于遍历数组</li><li>for-of：调用遍历器接口，使用范围较广</li></ul></li><li><p>使用技巧</p><ul><li>类似数组的对象：通过 Array.from 方法转为数组</li><li>普通对象<ul><li>通过 Object.keys 方法将键名生成数组</li><li>通过 Generator 函数将对象重新包装</li></ul></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> arrLike = { <span class=\"attr\">length</span>: <span class=\"number\">2</span>, <span class=\"number\">0</span>: <span class=\"string\">'a'</span>, <span class=\"number\">1</span>: <span class=\"string\">'b'</span> };</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> x <span class=\"keyword\">of</span> <span class=\"built_in\">Array</span>.from(arrLike)) {</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(x)</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> obj = { <span class=\"attr\">name</span>: <span class=\"string\">'Jane'</span>, <span class=\"attr\">age</span>: <span class=\"number\">20</span> };</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> key <span class=\"keyword\">of</span> <span class=\"built_in\">Object</span>.keys(obj)) {</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(obj[key]);</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure></li></ul><h2 id=\"Iterator-遍历器\"><a href=\"#Iterator-遍历器\" class=\"headerlink\" title=\"Iterator 遍历器\"></a>Iterator 遍历器</h2><blockquote><p>本质是一种有 next() 方法的指针对象，第几次调用就指向第几个成员</p></blockquote><h3 id=\"功能\"><a href=\"#功能\" class=\"headerlink\" title=\"功能\"></a>功能</h3><ul><li>为各种数据结构提供一个统一的、简便的访问接口（统一）</li><li>使得数据结构的成员能够按某种次序排列（按序）</li><li>配合 for-of 实现遍历</li></ul><h3 id=\"接口\"><a href=\"#接口\" class=\"headerlink\" title=\"接口\"></a>接口</h3><blockquote><p>本质是一个生成遍历器的函数，不同于 forEach 等遍历方法</p></blockquote><div style=\"text-indent:2em\">默认部署在数据结构的 Symbol.iterator 属性，它是当前数据结构默认的遍历器生成函数，执行这个函数就会返回一个遍历器。原生具备 Iterator 接口的数据结构如下：Array、TypedArray、Map、Set、String，只有这些数据结构不需要自定义遍历器生成函数并部署，循环遍历时可以直接通过 for-of 循环或 while 判断对象的 done 属性。</div><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 原生接口</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> arr = [<span class=\"string\">'a'</span>, <span class=\"string\">'b'</span>, <span class=\"string\">'c'</span>];</span><br><span class=\"line\"><span class=\"keyword\">let</span> iter = arr[<span class=\"built_in\">Symbol</span>.iterator]();</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(iter.next())  <span class=\"comment\">// {value: \"a\", done: false}</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 自定义接口</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> obj = {</span><br><span class=\"line\">  a: <span class=\"number\">1</span>,</span><br><span class=\"line\">  b: <span class=\"number\">2</span>,</span><br><span class=\"line\">  [<span class=\"built_in\">Symbol</span>.iterator]: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"keyword\">const</span> that = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> index = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 对象属性组成的数组</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> ks = <span class=\"built_in\">Object</span>.keys(that);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> {</span><br><span class=\"line\">      next: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">        <span class=\"keyword\">return</span> {</span><br><span class=\"line\">          value: that[ks[index++]],</span><br><span class=\"line\">          done: (index &gt; ks.length)</span><br><span class=\"line\">        }</span><br><span class=\"line\">      }</span><br><span class=\"line\">    }</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"keyword\">const</span> v <span class=\"keyword\">of</span> obj) {</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(v);      <span class=\"comment\">// 1</span></span><br><span class=\"line\">  <span class=\"keyword\">break</span>;      <span class=\"comment\">// 触发 return </span></span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h3 id=\"使用场景\"><a href=\"#使用场景\" class=\"headerlink\" title=\"使用场景\"></a>使用场景</h3><blockquote><p>任何接受数组作为参数的场景都默认调用了遍历器接口，比如 Array.from、Object.keys、Promise.all、Map() 等</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 解构赋值</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">set</span> = new Set().add('a').add('b');</span><br><span class=\"line\">let [first, ...rest] = <span class=\"keyword\">set</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">// 扩展运算符</span><br><span class=\"line\">var str = 'hello';</span><br><span class=\"line\">[...str] //  ['h','e','l','l','o']</span><br><span class=\"line\"></span><br><span class=\"line\">// yield*</span><br><span class=\"line\">let generator = function* () {</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">yield</span>* [<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>];</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"number\">5</span>;</span><br><span class=\"line\">};</span><br><span class=\"line\"><span class=\"keyword\">var</span> iterator = generator();</span><br><span class=\"line\">iterator.next()</span><br></pre></td></tr></tbody></table></figure><h2 id=\"Promise-对象\"><a href=\"#Promise-对象\" class=\"headerlink\" title=\"Promise 对象\"></a>Promise 对象</h2><blockquote><p>处理异步操作的对象，可以通过链式调用的方式来组织代码，让代码更加直观</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//创建promise</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> promise = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>) </span>{</span><br><span class=\"line\">    <span class=\"comment\">// 进行一些异步或耗时操作</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( <span class=\"comment\">/*如果成功 */</span> ) {</span><br><span class=\"line\">        resolve(<span class=\"string\">\"Stuff worked!\"</span>)</span><br><span class=\"line\">    } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">        reject(<span class=\"built_in\">Error</span>(<span class=\"string\">\"It broke\"</span>))</span><br><span class=\"line\">    }</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//绑定处理程序</span></span><br><span class=\"line\">promise.then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">result</span>) </span>{</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(result)   <span class=\"comment\">//promise成功执行</span></span><br><span class=\"line\">}, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>{</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(err)    <span class=\"comment\">//promise失败执行</span></span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h2 id=\"Generators-函数\"><a href=\"#Generators-函数\" class=\"headerlink\" title=\"Generators 函数\"></a>Generators 函数</h2><h3 id=\"基础语法\"><a href=\"#基础语法\" class=\"headerlink\" title=\"基础语法\"></a>基础语法</h3><ul><li><strong>定义</strong><ul><li>function 关键字和函数名之间有一个星号</li><li>内部使用 yield 语句，定义不同的内部状态</li><li>作为对象属性时可以简写</li></ul></li><li><strong>调用</strong><ul><li>调用函数会返回一个生成的遍历器对象，并没有执行函数体并返回结果</li><li>调用 next 方法分段执行，从上次暂停地方开始直到 yield/return 语句，返回对象的<br>value 值会被赋值为 yield/return 右边的结果</li></ul></li><li><strong>原理</strong><ul><li>通过 yield 语句实现传出返回对象</li><li>通过 next(value) 方法传入参数，参数值将作为上一个 yield 语句的返回值</li></ul></li><li><strong>yield 语句</strong><ul><li>只能用于 Generator 函数内部</li><li>如果用于其它表达式中，则必须放到圆括号里面</li><li>用作函数参数或放在赋值表达式的右边时，可以不加括号</li></ul></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>* <span class=\"title\">foo</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"number\">100</span>;</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"number\">200</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">300</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">let</span> f = foo();\t\t\t\t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(f.next());  <span class=\"comment\">// { value: 100, done: false }\t</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(f.next());\t<span class=\"comment\">// { value: 200, done: false }</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(f.next());\t<span class=\"comment\">// { value: 300, done: true }</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(f.next());\t<span class=\"comment\">// { value: undefined, done: true }</span></span><br></pre></td></tr></tbody></table></figure><h3 id=\"应用场景\"><a href=\"#应用场景\" class=\"headerlink\" title=\"应用场景\"></a>应用场景</h3><ul><li>异步编程：将异步操作写到 yield 语句，等到调用 next 方法时再继续执行</li><li>控制流管理：执行多步的耗时操作时，通过回调函数或 Promise 方式都不简洁</li><li>部署 Iterator 接口：利用 Generator 函数，可以在任意对象上部署 Iterator 接口</li><li><p>作为数据结构：可以返回一系列的值，所以它可以对任意表达式提供类似数组的接口</p><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 异步操作的同步化表达</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>* <span class=\"title\">loadUI</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">  showLoading();</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> loadUIDataAsynchronously();</span><br><span class=\"line\">  hideLoading();</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">var</span> loader = loadUI();</span><br><span class=\"line\">loader.next()  <span class=\"comment\">// 加载</span></span><br><span class=\"line\">loader.next()  <span class=\"comment\">// 隐藏</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 控制流管理</span></span><br><span class=\"line\">step1(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value1</span>) </span>{</span><br><span class=\"line\">  step2(value1, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value2</span>) </span>{</span><br><span class=\"line\">    step3(value2, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value3</span>) </span>{</span><br><span class=\"line\">      <span class=\"comment\">// Do something with value3</span></span><br><span class=\"line\">    })</span><br><span class=\"line\">  })</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.resolve(step1)</span><br><span class=\"line\">  .then(step2)</span><br><span class=\"line\">  .then(step3)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value3</span>) </span>{</span><br><span class=\"line\">      <span class=\"comment\">// Do something with value3</span></span><br><span class=\"line\">  }, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">error</span>) </span>{})</span><br><span class=\"line\">  .done();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>* <span class=\"title\">longRunningTask</span>(<span class=\"params\">value1</span>) </span>{</span><br><span class=\"line\">  <span class=\"keyword\">try</span> {</span><br><span class=\"line\">    <span class=\"keyword\">var</span> value2 = <span class=\"keyword\">yield</span> step1(value1);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> value3 = <span class=\"keyword\">yield</span> step2(value2);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> value4 = <span class=\"keyword\">yield</span> step3(value3);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> value5 = <span class=\"keyword\">yield</span> step4(value4);</span><br><span class=\"line\">    <span class=\"comment\">// Do something with value4</span></span><br><span class=\"line\"></span><br><span class=\"line\">  } <span class=\"keyword\">catch</span> (e) {</span><br><span class=\"line\">    </span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 部署 Iterator 接口</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>* <span class=\"title\">iterEntries</span>(<span class=\"params\">obj</span>) </span>{</span><br><span class=\"line\">  <span class=\"keyword\">let</span> keys = <span class=\"built_in\">Object</span>.keys(obj);</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i=<span class=\"number\">0</span>; i &lt; keys.length; i++) {</span><br><span class=\"line\">    <span class=\"keyword\">let</span> key = keys[i];</span><br><span class=\"line\">    <span class=\"keyword\">yield</span> [key, obj[key]];</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> myObj = { <span class=\"attr\">foo</span>: <span class=\"number\">3</span>, <span class=\"attr\">bar</span>: <span class=\"number\">7</span> };</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> [key, value] <span class=\"keyword\">of</span> iterEntries(myObj)) {</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(key, value);</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 作为数据结构</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doStuff</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">  <span class=\"keyword\">return</span> [</span><br><span class=\"line\">    fs.readFile.bind(<span class=\"literal\">null</span>, <span class=\"string\">'hello.txt'</span>),</span><br><span class=\"line\">    fs.readFile.bind(<span class=\"literal\">null</span>, <span class=\"string\">'world.txt'</span>),</span><br><span class=\"line\">    fs.readFile.bind(<span class=\"literal\">null</span>, <span class=\"string\">'and-such.txt'</span>)</span><br><span class=\"line\">  ]</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> *<span class=\"title\">doStuff</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> fs.readFile.bind(<span class=\"literal\">null</span>, <span class=\"string\">'hello.txt'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> fs.readFile.bind(<span class=\"literal\">null</span>, <span class=\"string\">'world.txt'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> fs.readFile.bind(<span class=\"literal\">null</span>, <span class=\"string\">'and-such.txt'</span>);</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">for</span> (task <span class=\"keyword\">of</span> doStuff()) {</span><br><span class=\"line\">    <span class=\"comment\">// task是一个函数，可以像回调函数那样使用</span></span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure></li></ul><h2 id=\"Moudle-模块化\"><a href=\"#Moudle-模块化\" class=\"headerlink\" title=\"Moudle 模块化\"></a>Moudle 模块化</h2><div style=\"text-indent:2em\">ES5 不支持原生的模块化，ES6 的 内置模块功能借鉴了 CommonJS、AMD 各自的优点，根据功能将代码封装到不同模块中。每一个模块都有独立的作用域和命名空间，可以防止命名冲突。当前模块通过 export (default) 定义对外暴露的接口，其它模块通过 import 加载对应模块。</div><ul><li>export：对外输出当前模块中的多个变量或函数的接口<ul><li>通过 export 方式导出时需要加 {}，export default 则不需要</li><li>在一个模块中可以有多个 export，但最多只能有一个 export default</li></ul></li><li>import：一个模块中加载另一个含有 export 接口的模块</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// lib.js </span></span><br><span class=\"line\"><span class=\"keyword\">let</span> name = <span class=\"string\">'freddy'</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> sayName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">name</span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(name);</span><br><span class=\"line\">};</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// export 在一个模块中可以多次使用</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> age = <span class=\"number\">20</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> { name, sayName }</span><br><span class=\"line\"><span class=\"keyword\">export</span> { name <span class=\"keyword\">as</span> userName, sayName <span class=\"keyword\">as</span> say }  <span class=\"comment\">// 改变输出的变量名</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// export default：在一个模块中只能输出一次</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> name;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> sayName;  </span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> { name, sayName }  <span class=\"comment\">// 输出一个对象</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// main.js</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 导入部分</span></span><br><span class=\"line\"><span class=\"comment\">// export 输出的变量名不可改变</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> { name, sayName } <span class=\"keyword\">from</span> <span class=\"string\">\"./lib\"</span>;  </span><br><span class=\"line\"><span class=\"keyword\">import</span> { name <span class=\"keyword\">as</span> userName } <span class=\"keyword\">from</span> <span class=\"string\">\"./lib\"</span>;  </span><br><span class=\"line\"><span class=\"keyword\">import</span> { userName, say } <span class=\"keyword\">from</span> <span class=\"string\">\"./lib\"</span>;  <span class=\"comment\">// 接收新变量名</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// export default 输出的变量名可以重新自定义</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> userName <span class=\"keyword\">from</span> <span class=\"string\">\"./lib\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> userObj <span class=\"keyword\">from</span> <span class=\"string\">\"./lib\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 将整个模块当作单一对象导入</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> * <span class=\"keyword\">as</span> userinfo <span class=\"keyword\">from</span> <span class=\"string\">\"./lib\"</span>;</span><br></pre></td></tr></tbody></table></figure><h2 id=\"class-类的支持\"><a href=\"#class-类的支持\" class=\"headerlink\" title=\"class 类的支持\"></a>class 类的支持</h2><blockquote><p>关键字有 constructor、extends、super</p></blockquote><h3 id=\"定义类\"><a href=\"#定义类\" class=\"headerlink\" title=\"定义类\"></a>定义类</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ES5 </span></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"comment\">// 定义类、构造函数</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">User</span>(<span class=\"params\">name, age</span>)</span>{</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.age = age;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 定义原型方法</span></span><br><span class=\"line\">    User.prototype.show = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'prototype'</span>);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 定义静态方法</span></span><br><span class=\"line\">    User.run = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'static'</span>);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 暴露接口</span></span><br><span class=\"line\">    <span class=\"built_in\">window</span>.User = user;</span><br><span class=\"line\">})();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ES6：构造函数、静态方法、原型方法</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span> </span>{</span><br><span class=\"line\">    <span class=\"comment\">// 构造函数：实例化时默认执行</span></span><br><span class=\"line\">    <span class=\"keyword\">constructor</span>(name, age){</span><br><span class=\"line\">        <span class=\"comment\">// 初始化对象</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.age = age;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 原型方法</span></span><br><span class=\"line\">    show(){</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'prototype'</span>);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 静态方法</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> run(){</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'static'</span>);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h3 id=\"继承类\"><a href=\"#继承类\" class=\"headerlink\" title=\"继承类\"></a>继承类</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Father</span>(<span class=\"params\">name, age</span>)</span>{  </span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.age = age; </span><br><span class=\"line\">}</span><br><span class=\"line\">Father.prototype.show = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{ }</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ES5 </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Son</span>(<span class=\"params\">name, age, address</span>)</span>{</span><br><span class=\"line\">    <span class=\"comment\">// 继承第一句：让子类实例化的对象具备父类的所有属性</span></span><br><span class=\"line\">    <span class=\"comment\">// Father.apply(this,arguments);</span></span><br><span class=\"line\">    Father.call(<span class=\"keyword\">this</span>, name, age);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.address = address;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"comment\">// 继承第二句：让子类实例化对象具备父类的所有原型方法</span></span><br><span class=\"line\">Son.prototype = <span class=\"built_in\">Object</span>.create(Father.prototype);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 继承第三句：找回丢失的构造函数</span></span><br><span class=\"line\">Son.prototype.constructor = Son;</span><br><span class=\"line\"></span><br><span class=\"line\">Son.prototype.run = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{ }</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ES6 </span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Son</span> <span class=\"keyword\">extends</span> <span class=\"title\">Father</span></span>{</span><br><span class=\"line\">    <span class=\"keyword\">constructor</span>(name, age, address){</span><br><span class=\"line\">        <span class=\"comment\">// super 指代整个 prototype/proto 指向的对象</span></span><br><span class=\"line\">        <span class=\"keyword\">super</span>(name, age);</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.address = address;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h3 id=\"getters-amp-setters\"><a href=\"#getters-amp-setters\" class=\"headerlink\" title=\"getters & setters\"></a>getters & setters</h3><blockquote><p>对某个属性设置存值函数和取值函数，拦截该属性的存取行为</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 只有 getter 没有 setter 时无法进行赋值操作</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">People</span> </span>{</span><br><span class=\"line\">    <span class=\"keyword\">constructor</span>(name) { <span class=\"comment\">//构造函数</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">get</span> name() {</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>._name.toUpperCase();</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">set</span> name(name) {</span><br><span class=\"line\">        <span class=\"comment\">// 对 this.name 赋则会调用 set name 导致无限递归</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>._name = name;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    sayName() {</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> People(<span class=\"string\">\"tom\"</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(p.name);    <span class=\"comment\">// TOM</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(p._name);   <span class=\"comment\">// tom</span></span><br><span class=\"line\">p.sayName();            <span class=\"comment\">// TOM</span></span><br></pre></td></tr></tbody></table></figure><h1 id=\"二、ES7\"><a href=\"#二、ES7\" class=\"headerlink\" title=\"二、ES7\"></a>二、ES7</h1><h2 id=\"arr-includes\"><a href=\"#arr-includes\" class=\"headerlink\" title=\"arr.includes\"></a>arr.includes</h2><blockquote><p>判断数组是否包含一个指定值</p></blockquote><ul><li>参数<ul><li>要搜索的值</li><li>搜索的开始索引</li></ul></li><li>区别<ul><li>返回布尔值，indexOf 返回数值</li><li>可用来判断数组是否包含 NaN，而 indexOf 不行</li><li>对于数组中的空值，includes 返回 undefined，而 indexOf 不会</li></ul></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, , <span class=\"number\">3</span>, <span class=\"literal\">NaN</span>]</span><br><span class=\"line\">arr.includes(<span class=\"number\">1</span>)          <span class=\"comment\">// true</span></span><br><span class=\"line\">arr.includes(<span class=\"number\">1</span>, <span class=\"number\">1</span>)       <span class=\"comment\">// false</span></span><br><span class=\"line\">arr.includes(<span class=\"literal\">NaN</span>)        <span class=\"comment\">// true</span></span><br><span class=\"line\">arr.includes(<span class=\"literal\">undefined</span>)  <span class=\"comment\">// true</span></span><br></pre></td></tr></tbody></table></figure><h2 id=\"求幂运算符\"><a href=\"#求幂运算符\" class=\"headerlink\" title=\"求幂运算符\"></a>求幂运算符</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 运算符 **  </span></span><br><span class=\"line\"><span class=\"keyword\">let</span> a = <span class=\"number\">2</span></span><br><span class=\"line\">a **= <span class=\"number\">3</span></span><br><span class=\"line\">a == <span class=\"built_in\">Math</span>.pow(<span class=\"number\">2</span>, <span class=\"number\">3</span>) == <span class=\"number\">2</span> ** <span class=\"number\">3</span>   <span class=\"comment\">// 8</span></span><br></pre></td></tr></tbody></table></figure><h1 id=\"三、ES8\"><a href=\"#三、ES8\" class=\"headerlink\" title=\"三、ES8\"></a>三、ES8</h1><h2 id=\"async-await\"><a href=\"#async-await\" class=\"headerlink\" title=\"async/await\"></a>async/await</h2><blockquote><p>async 可看作多个异步操作包装成的一个 Promise 对象，await 是 then() 的语法糖</p></blockquote><h3 id=\"本质\"><a href=\"#本质\" class=\"headerlink\" title=\"本质\"></a>本质</h3><blockquote><p>async 函数是对 Generator 函数的改进，使用时将它的 星号、yield 分别替换为 async、await 即可，优点如下：</p></blockquote><ul><li>内置执行器：Generator 函数的执行必须依靠 co 模块的执行器，而 async 函数自带</li><li>更好的语义：async、await 分别表示函数里有异步操作、需要等待后面表达式<br>的执行结果，语义比较清楚</li><li>更广的适用性：co 模块约定 yield 命令后面只能是 Thunk 函数或 Promise 对象，<br>而 await 命令后面可以是 Promise 对象和原始类型的值（数值、字符串和布尔值，但这时等同于同步操作）。</li><li>返回 Promise 对象：可以用 then 方法指定下一步的操作</li></ul><h3 id=\"基础使用\"><a href=\"#基础使用\" class=\"headerlink\" title=\"基础使用\"></a>基础使用</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">login(userName) {</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =></span> {</span><br><span class=\"line\">        setTimeout(<span class=\"function\"><span class=\"params\">()</span> =></span> {</span><br><span class=\"line\">            resolve(<span class=\"string\">'1001'</span>);</span><br><span class=\"line\">        }, <span class=\"number\">600</span>);</span><br><span class=\"line\">    });</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\">getData(userId) {</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =></span> {</span><br><span class=\"line\">        setTimeout(<span class=\"function\"><span class=\"params\">()</span> =></span> {</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (userId === <span class=\"string\">'1001'</span>) {</span><br><span class=\"line\">                resolve(<span class=\"string\">'Success'</span>);</span><br><span class=\"line\">            } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">                reject(<span class=\"string\">'Fail'</span>);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }, <span class=\"number\">600</span>);</span><br><span class=\"line\">    });</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 不使用 async/await</span></span><br><span class=\"line\">doLogin(userName) {</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.login(userName)</span><br><span class=\"line\">        .then(<span class=\"keyword\">this</span>.getData)</span><br><span class=\"line\">        .then(<span class=\"function\"><span class=\"params\">result</span> =></span> {</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(result)</span><br><span class=\"line\">        })</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用 async/await</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> doLogin2(userName) {</span><br><span class=\"line\">    <span class=\"keyword\">const</span> userId=<span class=\"keyword\">await</span> <span class=\"keyword\">this</span>.login(userName);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> result=<span class=\"keyword\">await</span> <span class=\"keyword\">this</span>.getData(userId);</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">this</span>.doLogin()   <span class=\"comment\">// Success</span></span><br><span class=\"line\"><span class=\"keyword\">this</span>.doLogin2()  <span class=\"comment\">// Succes</span></span><br></pre></td></tr></tbody></table></figure><h2 id=\"SharedArrayBuffer-Atomics\"><a href=\"#SharedArrayBuffer-Atomics\" class=\"headerlink\" title=\"SharedArrayBuffer-Atomics\"></a>SharedArrayBuffer-Atomics</h2><blockquote><p>用于从共享内存位置读取和写入</p></blockquote><ul><li>并行：同时执行多个任务<ul><li>JavaScript 在单线程中执行任务<ul><li>同步任务直接在单线程中排队执行</li><li>异步任务通过回调函数将结果重新放入到单线程等待执行调用</li></ul></li><li>Web Worker 引入了多线程并行处理任务<ul><li>主线程用来与用户互动</li><li>Worker 线程用来承担计算任务</li><li>每个线程的数据都是隔离的，通过 postMessage() 通信</li></ul></li><li>WebGL 用于 GPU 计算来并行处理数据</li></ul></li><li>并发：在重叠的时间段内执行几个任务<ul><li>SharedArrayBuffer：允许 Worker 线程与主线程共享同一块内存</li><li>Atomics: 用于处理 worker 共同操作同一内存地址时引起的冲突等问题</li></ul></li></ul><h2 id=\"Object-values-entries\"><a href=\"#Object-values-entries\" class=\"headerlink\" title=\"Object.values/entries\"></a>Object.values/entries</h2><ul><li>Object.values：返回自身属性值的数组</li><li>Object.entries：返回自身属性的键值对的数组</li><li>Object.getOwnPropertyDescriptors：返回自身属性的描述对象</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> obj = { </span><br><span class=\"line\">  name: <span class=\"string\">\"Jine\"</span>,</span><br><span class=\"line\">  <span class=\"keyword\">get</span> age() { <span class=\"keyword\">return</span> <span class=\"string\">'18'</span> }</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.values(obj)   <span class=\"comment\">// [\"Jine\", \"18\"]</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.entries(obj)  <span class=\"comment\">// [[\"name\", \"Jine\"], [\"age\", \"18\"]]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.getOwnPropertyDescriptor(obj, <span class=\"string\">\"name\"</span>)  <span class=\"comment\">// 单个属性</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.getOwnPropertyDescriptors(obj)         <span class=\"comment\">// 所有属性</span></span><br></pre></td></tr></tbody></table></figure><h2 id=\"String-padStart-padEnd\"><a href=\"#String-padStart-padEnd\" class=\"headerlink\" title=\"String.padStart/padEnd\"></a>String.padStart/padEnd</h2><blockquote><p>用于填补字符串的首部或尾部来达到给定长度，参数为 目标长度和可选的填充字符</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">\"a\"</span>.padStart(<span class=\"number\">2</span>)         <span class=\"comment\">//  a </span></span><br><span class=\"line\"><span class=\"string\">\"a\"</span>.padStart(<span class=\"number\">2</span>, <span class=\"string\">\"bc\"</span>)   <span class=\"comment\">// ba</span></span><br><span class=\"line\"><span class=\"string\">\"a\"</span>.padEnd(<span class=\"number\">3</span>, <span class=\"string\">\"b\"</span>)      <span class=\"comment\">// abb</span></span><br></pre></td></tr></tbody></table></figure><h1 id=\"四、ES9\"><a href=\"#四、ES9\" class=\"headerlink\" title=\"四、ES9\"></a>四、ES9</h1><blockquote><p>正则命名捕获组、反向断言、Unicode 转义等略过</p></blockquote><h2 id=\"异步迭代\"><a href=\"#异步迭代\" class=\"headerlink\" title=\"异步迭代\"></a>异步迭代</h2><blockquote><p>允许 async/await 和 for-of 一起使用，以串行的方式执行异步操作</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ES6 同步迭代器</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> items = [<span class=\"string\">'a'</span>, <span class=\"string\">'b'</span>];</span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"keyword\">const</span> item <span class=\"keyword\">of</span> items) {</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(item);  <span class=\"comment\">// a b   </span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 异步迭代器：返回一个 Promise</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> promises = [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =></span> resolve(<span class=\"number\">1</span>)),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =></span> resolve(<span class=\"number\">2</span>)),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =></span> resolve(<span class=\"number\">3</span>)),</span><br><span class=\"line\">]</span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">for</span> <span class=\"keyword\">await</span> (<span class=\"keyword\">let</span> p <span class=\"keyword\">of</span> promises) {</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(p);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\">test(); <span class=\"comment\">//1 ,2 3</span></span><br></pre></td></tr></tbody></table></figure><h2 id=\"Promise-finally\"><a href=\"#Promise-finally\" class=\"headerlink\" title=\"Promise.finally\"></a>Promise.finally</h2><blockquote><p>指定最终一定会执行的逻辑处理</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Promise</span>.resolve(<span class=\"number\">42</span>)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"params\">result</span> =></span>{ })</span><br><span class=\"line\">  .catch(<span class=\"function\"><span class=\"params\">error</span> =></span> { })</span><br><span class=\"line\">  .finally(<span class=\"function\"><span class=\"params\">()</span> =></span> { })</span><br></pre></td></tr></tbody></table></figure><!-- rebuild by neat --></body></html>","site":{"data":{"next":{"override":false,"cache":{"enable":true},"favicon":{"small":"/images/favicon-16.ico","medium":"/images/favicon-32.ico","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"rss":"/atom.xml","footer":{"since":2019,"icon":{"name":"snowflake-o","animated":false,"color":"#808080"},"copyright":"chuangge","powered":{"enable":false,"version":true},"theme":{"enable":false,"version":true},"beian":{"enable":false,"icp":null}},"creative_commons":{"license":"by-nc-sa","sidebar":false,"post":false},"canonical":true,"seo":false,"index_with_subtitle":false,"exturl":false,"menu":{"home":"/ || home  //首页","tags":"/tags/ || tags  //标签","categories":"/categories/ || th   //分类","archives":"/archives/ || archive //归档"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":{"GitHub":"https://github.com/ || github","StackOverflow":"https://stackoverflow.com/ || stack-overflow"},"social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"友情链接","links_layout":"inline","links":{"个人简历":"https://chuanggefighting.github.io/project/","印记中文":"https://www.docschina.org/","在线工具":"http://tool.lu/","Learn Anything":"https://learn-anything.xyz/"},"avatar":{"url":"/images/chuang.png","rounded":true,"opacity":1,"rotated":true},"toc":{"enable":true,"number":true,"wrap":false,"max_depth":6},"sidebar":{"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"read_more_btn":true,"post_meta":{"item_text":true,"created_at":true,"updated_at":{"enabled":true,"another_day":true},"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":true,"awl":4,"wpm":275},"codeblock":{"border_radius":null,"copy_button":{"enable":false,"show_result":false}},"reward":{"enable":false},"related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_edit":{"enable":false,"url":"https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name"},"disable_baidu_tranformation":false,"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"font":{"enable":true,"host":"//fonts.proxy.ustclug.org","global":{"external":true,"family":"Lato","size":16},"headings":{"external":true,"family":"Roboto Slab","size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":"Lobster Two","size":24},"codes":{"external":true,"family":"Roboto Mono","size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css","copy_tex":{"enable":false,"copy_tex_js":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js","copy_tex_css":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css"}}},"pdf":{"enable":false,"per_page":true,"height":"500px","pdfobject":{"cdn":"//cdn.jsdelivr.net/npm/pdfobject@2.1.1/pdfobject.min.js"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":true,"appid":"snOvapuSplYTVflf5p9Ml9JX-gzGzoHsz","appkey":"5ABGdfyEdAtu6lTXdGdo7hf9","notify":false,"verify":false,"placeholder":"ヾﾉ≧∀≦)o 来呀！吐槽一番吧！","avatar":"mm","guest_info":"nick,mail,link","pageSize":10,"visitor":false,"comment_count":true},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"gitalk":{"enable":false,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true},"needmoreshare2":{"enable":true,"postbottom":{"enable":true,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null,"security":false,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":true,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":true,"pace_theme":"pace-theme-center-simple","canvas_nest":{"enable":true,"onmobile":true,"color":"0,0,255","opacity":0.5,"zIndex":-1,"count":99},"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"canvas_nest_nomobile":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"leancloud":null,"valine":null,"gitalk_js":null,"gitalk_css":null,"md5":null},"css":"css","js":"js","images":"images","passage_end_tag":{"enabled":true},"daovoice":true,"daovoice_app_id":"2ed51855"}}},"excerpt":"","more":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><h1 id=\"一、ES6\"><a href=\"#一、ES6\" class=\"headerlink\" title=\"一、ES6\"></a>一、ES6</h1><h2 id=\"let-const\"><a href=\"#let-const\" class=\"headerlink\" title=\"let const\"></a>let const</h2><ul><li><strong>var</strong>：声明变量或常量<ul><li>存在变量提升现象：变量可以在声明之前使用，值为 undefined</li><li>没有块级作用域：ES6 之前的 js 只有全局作用域和函数作用域</li></ul></li><li><strong>let</strong>：声明变量<ul><li>存在暂时性死区：变量在声明之前使用会报错</li><li>存在块级作用域：声明的变量只能在其所在的代码块内才能访问</li></ul></li><li><strong>const</strong>：声明常量<ul><li>存在暂时性死区和块级作用域</li><li>常量名建议写成纯大写字母表示</li><li>不允许重新赋值，只能在声明时立即初始化</li></ul></li></ul><h2 id=\"字符串\"><a href=\"#字符串\" class=\"headerlink\" title=\"字符串\"></a>字符串</h2><h3 id=\"字符串拼接\"><a href=\"#字符串拼接\" class=\"headerlink\" title=\"字符串拼接\"></a>字符串拼接</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ES5 </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">'lux'</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'hello'</span> + name)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ES6：$&#123;&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> name = <span class=\"string\">'lux'</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">`hello <span class=\"subst\">$&#123;name&#125;</span>`</span>)  <span class=\"comment\">// hello lux</span></span><br></pre></td></tr></table></figure><h3 id=\"多行字符串\"><a href=\"#多行字符串\" class=\"headerlink\" title=\"多行字符串\"></a>多行字符串</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ES5：反斜杠</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> msg = <span class=\"string\">\"Hi \\</span></span><br><span class=\"line\"><span class=\"string\">man</span></span><br><span class=\"line\"><span class=\"string\">\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ES6：反引号</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> template = <span class=\"string\">`welcome</span></span><br><span class=\"line\"><span class=\"string\">    to</span></span><br><span class=\"line\"><span class=\"string\">world`</span></span><br></pre></td></tr></table></figure><h3 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// includes：判断是否包含</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> str = <span class=\"string\">'hahay'</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(str.includes(<span class=\"string\">'y'</span>)) <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// repeat: 获取字符串重复n次</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> str = <span class=\"string\">'he'</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(str.repeat(<span class=\"number\">3</span>)) <span class=\"comment\">// 'hehehe'</span></span><br><span class=\"line\"><span class=\"comment\">// 如果带有小数，先进行 Math.floor(num) 处理</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// startsWith、endsWith：判断是否以给定文本 开始、结束</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> str =  <span class=\"string\">'hello world!'</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(str.startsWith(<span class=\"string\">'hello'</span>))  <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(str.endsWith(<span class=\"string\">'!'</span>))        <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// padStart、padEnd：若字符串不够指定长度则在 头部、尾部 补全</span></span><br><span class=\"line\">setInterval(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> now = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>()</span><br><span class=\"line\">    <span class=\"keyword\">const</span> hours = now.getHours().toString()</span><br><span class=\"line\">    <span class=\"keyword\">const</span> minutes = now.getMinutes().toString()</span><br><span class=\"line\">    <span class=\"keyword\">const</span> seconds = now.getSeconds().toString()</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">`<span class=\"subst\">$&#123;hours.padStart(<span class=\"number\">2</span>, <span class=\"number\">0</span>)&#125;</span>:<span class=\"subst\">$&#123;minutes.padStart(<span class=\"number\">2</span>, <span class=\"number\">0</span>)&#125;</span>:<span class=\"subst\">$&#123;seconds.padStart(<span class=\"number\">2</span>, <span class=\"number\">0</span>)&#125;</span>`</span>)</span><br><span class=\"line\">&#125;, <span class=\"number\">1000</span>)</span><br></pre></td></tr></table></figure><h2 id=\"函数\"><a href=\"#函数\" class=\"headerlink\" title=\"函数\"></a>函数</h2><h3 id=\"箭头函数\"><a href=\"#箭头函数\" class=\"headerlink\" title=\"箭头函数\"></a>箭头函数</h3><ul><li>省略 return 关键字</li><li>不需要 function 关键字</li><li>始终指向当前上下文的 this 对象</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 只有一个参数时不需要 ()</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> f = <span class=\"function\"><span class=\"params\">n</span> =&gt;</span> n  </span><br><span class=\"line\"><span class=\"keyword\">let</span> f = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> <span class=\"number\">5</span> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 只有一条返回语句时不需要 &#123;&#125;</span></span><br><span class=\"line\">[<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>].map(<span class=\"function\"><span class=\"params\">x</span> =&gt;</span> x + <span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 返回对象则需要括号包裹</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> obj = <span class=\"function\"><span class=\"params\">name</span> =&gt;</span> (&#123;<span class=\"string\">\"name\"</span>:name&#125;)</span><br></pre></td></tr></table></figure><h3 id=\"函数参数\"><a href=\"#函数参数\" class=\"headerlink\" title=\"函数参数\"></a>函数参数</h3><ul><li>默认参数：定义函数时指定</li><li>Rest 参数：获取函数的不定参数</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 默认参数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sum</span>(<span class=\"params\">x=<span class=\"number\">1</span>, y=<span class=\"number\">1</span></span>)</span>&#123;  </span><br><span class=\"line\">  <span class=\"keyword\">return</span> x + y;  </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Rest 参数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">x, ...params</span>)</span>&#123; </span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(params) </span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\">foo(<span class=\"number\">1</span>, <span class=\"number\">2</span>)      <span class=\"comment\">// [2]</span></span><br><span class=\"line\">foo(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>)   <span class=\"comment\">// [2, 3]</span></span><br></pre></td></tr></table></figure><h2 id=\"对象\"><a href=\"#对象\" class=\"headerlink\" title=\"对象\"></a>对象</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 属性简写：属性名相同</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">people</span>(<span class=\"params\">name, age</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        name, age     </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">'bar'</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> user = &#123; name &#125;; <span class=\"comment\">// &#123; name: \"bar\" &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 方法简写</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> people = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'lux'</span>,</span><br><span class=\"line\">  getName () &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 浅拷贝方法</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> target = &#123;&#125;   </span><br><span class=\"line\"><span class=\"built_in\">Object</span>.assign(target, &#123; <span class=\"attr\">name</span>: <span class=\"string\">'Lisa'</span> &#125;, &#123; <span class=\"attr\">age</span>: <span class=\"number\">18</span> &#125;)</span><br></pre></td></tr></table></figure><h2 id=\"解构赋值\"><a href=\"#解构赋值\" class=\"headerlink\" title=\"解构赋值\"></a>解构赋值</h2><blockquote><p>自动提取数组或对象中的值并赋值给变量，要求前后结构相同或包含</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  <span class=\"comment\">// 对象：变量须与属性同名但不分顺序</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> &#123; name, age &#125; = &#123; <span class=\"attr\">name</span>: <span class=\"string\">'lux'</span>, <span class=\"attr\">age</span>: <span class=\"number\">20</span> &#125;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">`<span class=\"subst\">$&#123;name&#125;</span>: <span class=\"subst\">$&#123;age&#125;</span>`</span>)  <span class=\"comment\">// lux : 20</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> &#123;foo&#125; = &#123;<span class=\"attr\">bar</span>: <span class=\"string\">'baz'</span>&#125;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(foo)           <span class=\"comment\">// undefined</span></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 数组：变量值由其位置决定</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> [x, y] = [<span class=\"number\">1</span>, <span class=\"number\">2</span>]</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(x, y)     <span class=\"comment\">// 1, 2</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> [a, ...b] = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 不完全解构</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> [x, y] = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 默认值</span></span><br><span class=\"line\">  [x, y = <span class=\"string\">'b'</span>] = [<span class=\"string\">'a'</span>]    <span class=\"comment\">// x='a', y='b'</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 代码重构：最后一行即可</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> body = request.body</span><br><span class=\"line\">  <span class=\"keyword\">var</span> username = body.username</span><br><span class=\"line\">  <span class=\"keyword\">var</span> password = body.password</span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123; body, <span class=\"attr\">body</span>: &#123; username, password &#125; &#125; = request </span><br><span class=\"line\">  <span class=\"string\">``</span><span class=\"string\">` </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">## Spread 扩展运算符 </span></span><br><span class=\"line\"><span class=\"string\">&gt; Rest 参数的逆运算，用于将数组或对象展开成一系列用逗号隔开的值</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">  * 合并对象或数组：参数位置不限制</span></span><br><span class=\"line\"><span class=\"string\">  * 配合解构赋值：必须将参数放到最后，否则报错</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>js</span><br><span class=\"line\"><span class=\"comment\">// 数组</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> color = [<span class=\"string\">'red'</span>, <span class=\"string\">'yellow'</span>]</span><br><span class=\"line\"><span class=\"keyword\">const</span> colorful = [...color, <span class=\"string\">'green'</span>, <span class=\"string\">'pink'</span>]  </span><br><span class=\"line\"><span class=\"keyword\">const</span> [first, ...colorful] = color  <span class=\"comment\">// ['yellow']</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 对象</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> user = &#123; <span class=\"attr\">name</span>: <span class=\"string\">'lux'</span>, <span class=\"attr\">age</span>: <span class=\"number\">20</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> userinfo = &#123; ...user, <span class=\"attr\">address</span>: <span class=\"string\">'shanghai'</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; name, ...userinfo &#125; = user   <span class=\"comment\">// &#123;age: 20&#125;</span></span><br></pre></td></tr></table></figure><h2 id=\"Symbol-类型\"><a href=\"#Symbol-类型\" class=\"headerlink\" title=\"Symbol 类型\"></a>Symbol 类型</h2><blockquote><p>一种新的原始数据类型，Symbol 值类似于字符串但每一个都表示独一无二的值</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 创建</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> s1 = <span class=\"built_in\">Symbol</span>();          </span><br><span class=\"line\"><span class=\"keyword\">var</span> s2 = <span class=\"built_in\">Symbol</span>();</span><br><span class=\"line\"><span class=\"keyword\">var</span> s3 = <span class=\"built_in\">Symbol</span>(<span class=\"string\">\"foo\"</span>);      <span class=\"comment\">// 传入字符串表示描述信息</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> s4 = <span class=\"built_in\">Symbol</span>.for(<span class=\"string\">\"foo\"</span>);  <span class=\"comment\">// 有则返回，无则创建</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 任何两个 Symbol 值都不相等</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"keyword\">typeof</span> s1, s1 == s2)   <span class=\"comment\">// symbol false</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">Symbol</span>.keyFor(s3))     <span class=\"comment\">// undefined</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">Symbol</span>.keyFor(s4))     <span class=\"comment\">// foo</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 不能与其他类型的值进行运算，否则会报错</span></span><br><span class=\"line\"><span class=\"comment\">// var k = s1 + 1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 可以转为字符串、布尔值</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> str = <span class=\"built_in\">String</span>(s1)</span><br><span class=\"line\"><span class=\"keyword\">var</span> bl = <span class=\"built_in\">Boolean</span>(s1)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 作为对象属性名：不能使用点操作</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123; [s1]: <span class=\"string\">'hello'</span> &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;&#125;</span><br><span class=\"line\">obj[s1] = <span class=\"string\">'hello'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;&#125;;</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(obj, s1, &#123; <span class=\"attr\">value</span>: <span class=\"string\">'hello'</span> &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 属性名的遍历</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> sKey = <span class=\"built_in\">Object</span>.getOwnPropertySymbols(obj)  <span class=\"comment\">// 返回Symbol键名</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> aKey = <span class=\"built_in\">Reflect</span>.ownKeys(obj)               <span class=\"comment\">// 返回所有键名</span></span><br></pre></td></tr></table></figure><h2 id=\"for-of-遍历\"><a href=\"#for-of-遍历\" class=\"headerlink\" title=\"for-of 遍历\"></a>for-of 遍历</h2><ul><li>方式对比<ul><li>forEach：无法跳出循环，即 break、return 命令都不奏效</li><li>for-in：主要是为遍历对象而设计的，不适用于遍历数组</li><li>for-of：调用遍历器接口，使用范围较广</li></ul></li><li><p>使用技巧</p><ul><li>类似数组的对象：通过 Array.from 方法转为数组</li><li>普通对象<ul><li>通过 Object.keys 方法将键名生成数组</li><li>通过 Generator 函数将对象重新包装</li></ul></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> arrLike = &#123; <span class=\"attr\">length</span>: <span class=\"number\">2</span>, <span class=\"number\">0</span>: <span class=\"string\">'a'</span>, <span class=\"number\">1</span>: <span class=\"string\">'b'</span> &#125;;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> x <span class=\"keyword\">of</span> <span class=\"built_in\">Array</span>.from(arrLike)) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(x)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> obj = &#123; <span class=\"attr\">name</span>: <span class=\"string\">'Jane'</span>, <span class=\"attr\">age</span>: <span class=\"number\">20</span> &#125;;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> key <span class=\"keyword\">of</span> <span class=\"built_in\">Object</span>.keys(obj)) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(obj[key]);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id=\"Iterator-遍历器\"><a href=\"#Iterator-遍历器\" class=\"headerlink\" title=\"Iterator 遍历器\"></a>Iterator 遍历器</h2><blockquote><p>本质是一种有 next() 方法的指针对象，第几次调用就指向第几个成员</p></blockquote><h3 id=\"功能\"><a href=\"#功能\" class=\"headerlink\" title=\"功能\"></a>功能</h3><ul><li>为各种数据结构提供一个统一的、简便的访问接口（统一）</li><li>使得数据结构的成员能够按某种次序排列（按序）</li><li>配合 for-of 实现遍历</li></ul><h3 id=\"接口\"><a href=\"#接口\" class=\"headerlink\" title=\"接口\"></a>接口</h3><blockquote><p>本质是一个生成遍历器的函数，不同于 forEach 等遍历方法</p></blockquote><div style=\"text-indent:2em\">默认部署在数据结构的 Symbol.iterator 属性，它是当前数据结构默认的遍历器生成函数，执行这个函数就会返回一个遍历器。原生具备 Iterator 接口的数据结构如下：Array、TypedArray、Map、Set、String，只有这些数据结构不需要自定义遍历器生成函数并部署，循环遍历时可以直接通过 for-of 循环或 while 判断对象的 done 属性。</div><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 原生接口</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> arr = [<span class=\"string\">'a'</span>, <span class=\"string\">'b'</span>, <span class=\"string\">'c'</span>];</span><br><span class=\"line\"><span class=\"keyword\">let</span> iter = arr[<span class=\"built_in\">Symbol</span>.iterator]();</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(iter.next())  <span class=\"comment\">// &#123;value: \"a\", done: false&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 自定义接口</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> obj = &#123;</span><br><span class=\"line\">  a: <span class=\"number\">1</span>,</span><br><span class=\"line\">  b: <span class=\"number\">2</span>,</span><br><span class=\"line\">  [<span class=\"built_in\">Symbol</span>.iterator]: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> that = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> index = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 对象属性组成的数组</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> ks = <span class=\"built_in\">Object</span>.keys(that);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      next: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">          value: that[ks[index++]],</span><br><span class=\"line\">          done: (index &amp;gt; ks.length)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"keyword\">const</span> v <span class=\"keyword\">of</span> obj) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(v);      <span class=\"comment\">// 1</span></span><br><span class=\"line\">  <span class=\"keyword\">break</span>;      <span class=\"comment\">// 触发 return </span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h3 id=\"使用场景\"><a href=\"#使用场景\" class=\"headerlink\" title=\"使用场景\"></a>使用场景</h3><blockquote><p>任何接受数组作为参数的场景都默认调用了遍历器接口，比如 Array.from、Object.keys、Promise.all、Map() 等</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 解构赋值</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">set</span> = new Set().add('a').add('b');</span><br><span class=\"line\">let [first, ...rest] = <span class=\"keyword\">set</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">// 扩展运算符</span><br><span class=\"line\">var str = 'hello';</span><br><span class=\"line\">[...str] //  ['h','e','l','l','o']</span><br><span class=\"line\"></span><br><span class=\"line\">// yield*</span><br><span class=\"line\">let generator = function* () &#123;</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">yield</span>* [<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>];</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"number\">5</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> iterator = generator();</span><br><span class=\"line\">iterator.next()</span><br></pre></td></tr></table></figure><h2 id=\"Promise-对象\"><a href=\"#Promise-对象\" class=\"headerlink\" title=\"Promise 对象\"></a>Promise 对象</h2><blockquote><p>处理异步操作的对象，可以通过链式调用的方式来组织代码，让代码更加直观</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//创建promise</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> promise = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 进行一些异步或耗时操作</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( <span class=\"comment\">/*如果成功 */</span> ) &#123;</span><br><span class=\"line\">        resolve(<span class=\"string\">\"Stuff worked!\"</span>)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        reject(<span class=\"built_in\">Error</span>(<span class=\"string\">\"It broke\"</span>))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//绑定处理程序</span></span><br><span class=\"line\">promise.then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">result</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(result)   <span class=\"comment\">//promise成功执行</span></span><br><span class=\"line\">&#125;, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(err)    <span class=\"comment\">//promise失败执行</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h2 id=\"Generators-函数\"><a href=\"#Generators-函数\" class=\"headerlink\" title=\"Generators 函数\"></a>Generators 函数</h2><h3 id=\"基础语法\"><a href=\"#基础语法\" class=\"headerlink\" title=\"基础语法\"></a>基础语法</h3><ul><li><strong>定义</strong><ul><li>function 关键字和函数名之间有一个星号</li><li>内部使用 yield 语句，定义不同的内部状态</li><li>作为对象属性时可以简写</li></ul></li><li><strong>调用</strong><ul><li>调用函数会返回一个生成的遍历器对象，并没有执行函数体并返回结果</li><li>调用 next 方法分段执行，从上次暂停地方开始直到 yield/return 语句，返回对象的<br>value 值会被赋值为 yield/return 右边的结果</li></ul></li><li><strong>原理</strong><ul><li>通过 yield 语句实现传出返回对象</li><li>通过 next(value) 方法传入参数，参数值将作为上一个 yield 语句的返回值</li></ul></li><li><strong>yield 语句</strong><ul><li>只能用于 Generator 函数内部</li><li>如果用于其它表达式中，则必须放到圆括号里面</li><li>用作函数参数或放在赋值表达式的右边时，可以不加括号</li></ul></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>* <span class=\"title\">foo</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"number\">100</span>;</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"number\">200</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">300</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> f = foo();\t\t\t\t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(f.next());  <span class=\"comment\">// &#123; value: 100, done: false &#125;\t</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(f.next());\t<span class=\"comment\">// &#123; value: 200, done: false &#125;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(f.next());\t<span class=\"comment\">// &#123; value: 300, done: true &#125;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(f.next());\t<span class=\"comment\">// &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure><h3 id=\"应用场景\"><a href=\"#应用场景\" class=\"headerlink\" title=\"应用场景\"></a>应用场景</h3><ul><li>异步编程：将异步操作写到 yield 语句，等到调用 next 方法时再继续执行</li><li>控制流管理：执行多步的耗时操作时，通过回调函数或 Promise 方式都不简洁</li><li>部署 Iterator 接口：利用 Generator 函数，可以在任意对象上部署 Iterator 接口</li><li><p>作为数据结构：可以返回一系列的值，所以它可以对任意表达式提供类似数组的接口</p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 异步操作的同步化表达</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>* <span class=\"title\">loadUI</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  showLoading();</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> loadUIDataAsynchronously();</span><br><span class=\"line\">  hideLoading();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> loader = loadUI();</span><br><span class=\"line\">loader.next()  <span class=\"comment\">// 加载</span></span><br><span class=\"line\">loader.next()  <span class=\"comment\">// 隐藏</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 控制流管理</span></span><br><span class=\"line\">step1(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value1</span>) </span>&#123;</span><br><span class=\"line\">  step2(value1, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value2</span>) </span>&#123;</span><br><span class=\"line\">    step3(value2, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value3</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">// Do something with value3</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.resolve(step1)</span><br><span class=\"line\">  .then(step2)</span><br><span class=\"line\">  .then(step3)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value3</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">// Do something with value3</span></span><br><span class=\"line\">  &#125;, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">error</span>) </span>&#123;&#125;)</span><br><span class=\"line\">  .done();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>* <span class=\"title\">longRunningTask</span>(<span class=\"params\">value1</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> value2 = <span class=\"keyword\">yield</span> step1(value1);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> value3 = <span class=\"keyword\">yield</span> step2(value2);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> value4 = <span class=\"keyword\">yield</span> step3(value3);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> value5 = <span class=\"keyword\">yield</span> step4(value4);</span><br><span class=\"line\">    <span class=\"comment\">// Do something with value4</span></span><br><span class=\"line\"></span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 部署 Iterator 接口</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>* <span class=\"title\">iterEntries</span>(<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> keys = <span class=\"built_in\">Object</span>.keys(obj);</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i=<span class=\"number\">0</span>; i &amp;lt; keys.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> key = keys[i];</span><br><span class=\"line\">    <span class=\"keyword\">yield</span> [key, obj[key]];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> myObj = &#123; <span class=\"attr\">foo</span>: <span class=\"number\">3</span>, <span class=\"attr\">bar</span>: <span class=\"number\">7</span> &#125;;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> [key, value] <span class=\"keyword\">of</span> iterEntries(myObj)) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(key, value);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 作为数据结构</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doStuff</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> [</span><br><span class=\"line\">    fs.readFile.bind(<span class=\"literal\">null</span>, <span class=\"string\">'hello.txt'</span>),</span><br><span class=\"line\">    fs.readFile.bind(<span class=\"literal\">null</span>, <span class=\"string\">'world.txt'</span>),</span><br><span class=\"line\">    fs.readFile.bind(<span class=\"literal\">null</span>, <span class=\"string\">'and-such.txt'</span>)</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> *<span class=\"title\">doStuff</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> fs.readFile.bind(<span class=\"literal\">null</span>, <span class=\"string\">'hello.txt'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> fs.readFile.bind(<span class=\"literal\">null</span>, <span class=\"string\">'world.txt'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> fs.readFile.bind(<span class=\"literal\">null</span>, <span class=\"string\">'and-such.txt'</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (task <span class=\"keyword\">of</span> doStuff()) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// task是一个函数，可以像回调函数那样使用</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id=\"Moudle-模块化\"><a href=\"#Moudle-模块化\" class=\"headerlink\" title=\"Moudle 模块化\"></a>Moudle 模块化</h2><div style=\"text-indent:2em\">ES5 不支持原生的模块化，ES6 的 内置模块功能借鉴了 CommonJS、AMD 各自的优点，根据功能将代码封装到不同模块中。每一个模块都有独立的作用域和命名空间，可以防止命名冲突。当前模块通过 export (default) 定义对外暴露的接口，其它模块通过 import 加载对应模块。</div><ul><li>export：对外输出当前模块中的多个变量或函数的接口<ul><li>通过 export 方式导出时需要加 {}，export default 则不需要</li><li>在一个模块中可以有多个 export，但最多只能有一个 export default</li></ul></li><li>import：一个模块中加载另一个含有 export 接口的模块</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// lib.js </span></span><br><span class=\"line\"><span class=\"keyword\">let</span> name = <span class=\"string\">'freddy'</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> sayName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(name);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// export 在一个模块中可以多次使用</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> age = <span class=\"number\">20</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> &#123; name, sayName &#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> &#123; name <span class=\"keyword\">as</span> userName, sayName <span class=\"keyword\">as</span> say &#125;  <span class=\"comment\">// 改变输出的变量名</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// export default：在一个模块中只能输出一次</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> name;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> sayName;  </span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123; name, sayName &#125;  <span class=\"comment\">// 输出一个对象</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// main.js</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 导入部分</span></span><br><span class=\"line\"><span class=\"comment\">// export 输出的变量名不可改变</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; name, sayName &#125; <span class=\"keyword\">from</span> <span class=\"string\">\"./lib\"</span>;  </span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; name <span class=\"keyword\">as</span> userName &#125; <span class=\"keyword\">from</span> <span class=\"string\">\"./lib\"</span>;  </span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; userName, say &#125; <span class=\"keyword\">from</span> <span class=\"string\">\"./lib\"</span>;  <span class=\"comment\">// 接收新变量名</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// export default 输出的变量名可以重新自定义</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> userName <span class=\"keyword\">from</span> <span class=\"string\">\"./lib\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> userObj <span class=\"keyword\">from</span> <span class=\"string\">\"./lib\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 将整个模块当作单一对象导入</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> * <span class=\"keyword\">as</span> userinfo <span class=\"keyword\">from</span> <span class=\"string\">\"./lib\"</span>;</span><br></pre></td></tr></table></figure><h2 id=\"class-类的支持\"><a href=\"#class-类的支持\" class=\"headerlink\" title=\"class 类的支持\"></a>class 类的支持</h2><blockquote><p>关键字有 constructor、extends、super</p></blockquote><h3 id=\"定义类\"><a href=\"#定义类\" class=\"headerlink\" title=\"定义类\"></a>定义类</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ES5 </span></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 定义类、构造函数</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">User</span>(<span class=\"params\">name, age</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.age = age;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 定义原型方法</span></span><br><span class=\"line\">    User.prototype.show = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'prototype'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 定义静态方法</span></span><br><span class=\"line\">    User.run = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'static'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 暴露接口</span></span><br><span class=\"line\">    <span class=\"built_in\">window</span>.User = user;</span><br><span class=\"line\">&#125;)();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ES6：构造函数、静态方法、原型方法</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 构造函数：实例化时默认执行</span></span><br><span class=\"line\">    <span class=\"keyword\">constructor</span>(name, age)&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 初始化对象</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.age = age;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 原型方法</span></span><br><span class=\"line\">    show()&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'prototype'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 静态方法</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> run()&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'static'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h3 id=\"继承类\"><a href=\"#继承类\" class=\"headerlink\" title=\"继承类\"></a>继承类</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Father</span>(<span class=\"params\">name, age</span>)</span>&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.age = age; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Father.prototype.show = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ES5 </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Son</span>(<span class=\"params\">name, age, address</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 继承第一句：让子类实例化的对象具备父类的所有属性</span></span><br><span class=\"line\">    <span class=\"comment\">// Father.apply(this,arguments);</span></span><br><span class=\"line\">    Father.call(<span class=\"keyword\">this</span>, name, age);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.address = address;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 继承第二句：让子类实例化对象具备父类的所有原型方法</span></span><br><span class=\"line\">Son.prototype = <span class=\"built_in\">Object</span>.create(Father.prototype);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 继承第三句：找回丢失的构造函数</span></span><br><span class=\"line\">Son.prototype.constructor = Son;</span><br><span class=\"line\"></span><br><span class=\"line\">Son.prototype.run = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ES6 </span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Son</span> <span class=\"keyword\">extends</span> <span class=\"title\">Father</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">constructor</span>(name, age, address)&#123;</span><br><span class=\"line\">        <span class=\"comment\">// super 指代整个 prototype/proto 指向的对象</span></span><br><span class=\"line\">        <span class=\"keyword\">super</span>(name, age);</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.address = address;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h3 id=\"getters-amp-setters\"><a href=\"#getters-amp-setters\" class=\"headerlink\" title=\"getters &amp; setters\"></a>getters &amp; setters</h3><blockquote><p>对某个属性设置存值函数和取值函数，拦截该属性的存取行为</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 只有 getter 没有 setter 时无法进行赋值操作</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">People</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">constructor</span>(name) &#123; <span class=\"comment\">//构造函数</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">get</span> name() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>._name.toUpperCase();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">set</span> name(name) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 对 this.name 赋则会调用 set name 导致无限递归</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>._name = name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    sayName() &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> People(<span class=\"string\">\"tom\"</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(p.name);    <span class=\"comment\">// TOM</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(p._name);   <span class=\"comment\">// tom</span></span><br><span class=\"line\">p.sayName();            <span class=\"comment\">// TOM</span></span><br></pre></td></tr></table></figure><h1 id=\"二、ES7\"><a href=\"#二、ES7\" class=\"headerlink\" title=\"二、ES7\"></a>二、ES7</h1><h2 id=\"arr-includes\"><a href=\"#arr-includes\" class=\"headerlink\" title=\"arr.includes\"></a>arr.includes</h2><blockquote><p>判断数组是否包含一个指定值</p></blockquote><ul><li>参数<ul><li>要搜索的值</li><li>搜索的开始索引</li></ul></li><li>区别<ul><li>返回布尔值，indexOf 返回数值</li><li>可用来判断数组是否包含 NaN，而 indexOf 不行</li><li>对于数组中的空值，includes 返回 undefined，而 indexOf 不会</li></ul></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, , <span class=\"number\">3</span>, <span class=\"literal\">NaN</span>]</span><br><span class=\"line\">arr.includes(<span class=\"number\">1</span>)          <span class=\"comment\">// true</span></span><br><span class=\"line\">arr.includes(<span class=\"number\">1</span>, <span class=\"number\">1</span>)       <span class=\"comment\">// false</span></span><br><span class=\"line\">arr.includes(<span class=\"literal\">NaN</span>)        <span class=\"comment\">// true</span></span><br><span class=\"line\">arr.includes(<span class=\"literal\">undefined</span>)  <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure><h2 id=\"求幂运算符\"><a href=\"#求幂运算符\" class=\"headerlink\" title=\"求幂运算符\"></a>求幂运算符</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 运算符 **  </span></span><br><span class=\"line\"><span class=\"keyword\">let</span> a = <span class=\"number\">2</span></span><br><span class=\"line\">a **= <span class=\"number\">3</span></span><br><span class=\"line\">a == <span class=\"built_in\">Math</span>.pow(<span class=\"number\">2</span>, <span class=\"number\">3</span>) == <span class=\"number\">2</span> ** <span class=\"number\">3</span>   <span class=\"comment\">// 8</span></span><br></pre></td></tr></table></figure><h1 id=\"三、ES8\"><a href=\"#三、ES8\" class=\"headerlink\" title=\"三、ES8\"></a>三、ES8</h1><h2 id=\"async-await\"><a href=\"#async-await\" class=\"headerlink\" title=\"async/await\"></a>async/await</h2><blockquote><p>async 可看作多个异步操作包装成的一个 Promise 对象，await 是 then() 的语法糖</p></blockquote><h3 id=\"本质\"><a href=\"#本质\" class=\"headerlink\" title=\"本质\"></a>本质</h3><blockquote><p>async 函数是对 Generator 函数的改进，使用时将它的 星号、yield 分别替换为 async、await 即可，优点如下：</p></blockquote><ul><li>内置执行器：Generator 函数的执行必须依靠 co 模块的执行器，而 async 函数自带</li><li>更好的语义：async、await 分别表示函数里有异步操作、需要等待后面表达式<br>的执行结果，语义比较清楚</li><li>更广的适用性：co 模块约定 yield 命令后面只能是 Thunk 函数或 Promise 对象，<br>而 await 命令后面可以是 Promise 对象和原始类型的值（数值、字符串和布尔值，但这时等同于同步操作）。</li><li>返回 Promise 对象：可以用 then 方法指定下一步的操作</li></ul><h3 id=\"基础使用\"><a href=\"#基础使用\" class=\"headerlink\" title=\"基础使用\"></a>基础使用</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">login(userName) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">            resolve(<span class=\"string\">'1001'</span>);</span><br><span class=\"line\">        &#125;, <span class=\"number\">600</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">getData(userId) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (userId === <span class=\"string\">'1001'</span>) &#123;</span><br><span class=\"line\">                resolve(<span class=\"string\">'Success'</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                reject(<span class=\"string\">'Fail'</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, <span class=\"number\">600</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 不使用 async/await</span></span><br><span class=\"line\">doLogin(userName) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.login(userName)</span><br><span class=\"line\">        .then(<span class=\"keyword\">this</span>.getData)</span><br><span class=\"line\">        .then(<span class=\"function\"><span class=\"params\">result</span> =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(result)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用 async/await</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> doLogin2(userName) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> userId=<span class=\"keyword\">await</span> <span class=\"keyword\">this</span>.login(userName);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> result=<span class=\"keyword\">await</span> <span class=\"keyword\">this</span>.getData(userId);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">this</span>.doLogin()   <span class=\"comment\">// Success</span></span><br><span class=\"line\"><span class=\"keyword\">this</span>.doLogin2()  <span class=\"comment\">// Succes</span></span><br></pre></td></tr></table></figure><h2 id=\"SharedArrayBuffer-Atomics\"><a href=\"#SharedArrayBuffer-Atomics\" class=\"headerlink\" title=\"SharedArrayBuffer-Atomics\"></a>SharedArrayBuffer-Atomics</h2><blockquote><p>用于从共享内存位置读取和写入</p></blockquote><ul><li>并行：同时执行多个任务<ul><li>JavaScript 在单线程中执行任务<ul><li>同步任务直接在单线程中排队执行</li><li>异步任务通过回调函数将结果重新放入到单线程等待执行调用</li></ul></li><li>Web Worker 引入了多线程并行处理任务<ul><li>主线程用来与用户互动</li><li>Worker 线程用来承担计算任务</li><li>每个线程的数据都是隔离的，通过 postMessage() 通信</li></ul></li><li>WebGL 用于 GPU 计算来并行处理数据</li></ul></li><li>并发：在重叠的时间段内执行几个任务<ul><li>SharedArrayBuffer：允许 Worker 线程与主线程共享同一块内存</li><li>Atomics: 用于处理 worker 共同操作同一内存地址时引起的冲突等问题</li></ul></li></ul><h2 id=\"Object-values-entries\"><a href=\"#Object-values-entries\" class=\"headerlink\" title=\"Object.values/entries\"></a>Object.values/entries</h2><ul><li>Object.values：返回自身属性值的数组</li><li>Object.entries：返回自身属性的键值对的数组</li><li>Object.getOwnPropertyDescriptors：返回自身属性的描述对象</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> obj = &#123; </span><br><span class=\"line\">  name: <span class=\"string\">\"Jine\"</span>,</span><br><span class=\"line\">  <span class=\"keyword\">get</span> age() &#123; <span class=\"keyword\">return</span> <span class=\"string\">'18'</span> &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.values(obj)   <span class=\"comment\">// [\"Jine\", \"18\"]</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.entries(obj)  <span class=\"comment\">// [[\"name\", \"Jine\"], [\"age\", \"18\"]]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.getOwnPropertyDescriptor(obj, <span class=\"string\">\"name\"</span>)  <span class=\"comment\">// 单个属性</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.getOwnPropertyDescriptors(obj)         <span class=\"comment\">// 所有属性</span></span><br></pre></td></tr></table></figure><h2 id=\"String-padStart-padEnd\"><a href=\"#String-padStart-padEnd\" class=\"headerlink\" title=\"String.padStart/padEnd\"></a>String.padStart/padEnd</h2><blockquote><p>用于填补字符串的首部或尾部来达到给定长度，参数为 目标长度和可选的填充字符</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">\"a\"</span>.padStart(<span class=\"number\">2</span>)         <span class=\"comment\">//  a </span></span><br><span class=\"line\"><span class=\"string\">\"a\"</span>.padStart(<span class=\"number\">2</span>, <span class=\"string\">\"bc\"</span>)   <span class=\"comment\">// ba</span></span><br><span class=\"line\"><span class=\"string\">\"a\"</span>.padEnd(<span class=\"number\">3</span>, <span class=\"string\">\"b\"</span>)      <span class=\"comment\">// abb</span></span><br></pre></td></tr></table></figure><h1 id=\"四、ES9\"><a href=\"#四、ES9\" class=\"headerlink\" title=\"四、ES9\"></a>四、ES9</h1><blockquote><p>正则命名捕获组、反向断言、Unicode 转义等略过</p></blockquote><h2 id=\"异步迭代\"><a href=\"#异步迭代\" class=\"headerlink\" title=\"异步迭代\"></a>异步迭代</h2><blockquote><p>允许 async/await 和 for-of 一起使用，以串行的方式执行异步操作</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ES6 同步迭代器</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> items = [<span class=\"string\">'a'</span>, <span class=\"string\">'b'</span>];</span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"keyword\">const</span> item <span class=\"keyword\">of</span> items) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(item);  <span class=\"comment\">// a b   </span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 异步迭代器：返回一个 Promise</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> promises = [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> resolve(<span class=\"number\">1</span>)),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> resolve(<span class=\"number\">2</span>)),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> resolve(<span class=\"number\">3</span>)),</span><br><span class=\"line\">]</span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> <span class=\"keyword\">await</span> (<span class=\"keyword\">let</span> p <span class=\"keyword\">of</span> promises) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(p);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">test(); <span class=\"comment\">//1 ,2 3</span></span><br></pre></td></tr></table></figure><h2 id=\"Promise-finally\"><a href=\"#Promise-finally\" class=\"headerlink\" title=\"Promise.finally\"></a>Promise.finally</h2><blockquote><p>指定最终一定会执行的逻辑处理</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Promise</span>.resolve(<span class=\"number\">42</span>)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"params\">result</span> =&gt;</span>&#123; &#125;)</span><br><span class=\"line\">  .catch(<span class=\"function\"><span class=\"params\">error</span> =&gt;</span> &#123; &#125;)</span><br><span class=\"line\">  .finally(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123; &#125;)</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->"},{"title":"Vue 组件化开发","top":false,"keywords":["vue"],"date":"2019-04-14T10:26:43.000Z","description":"实例对象、全局方法、插件开发、组件基础","_content":"\n# 一、实例对象\n> 一个包含数据、方法和组件的 vue 实例对象\n\n## 初始化\n  ```js\n  // 1、直接创建\n  var app1 = new Vue({\n    el:\"#app1\",\n  })\n\n  // 2、首先创建无挂载点的实例\n  var app2 = new Vue({    \n    data: {          // 对象\n        msg:\"app2\" \n    }\n  })\n  app2.$mount('#app2');\n\n  // 3、使用基础 Vue 构造器创建\"子类\"\n  var app3 = Vue.extend({\n    data: function(){   // 函数\n        return{ \n            msg:\"app3\" \n        }\n    }\n  })    \n  new app3().$mount('#app3');\n  ```\n\n\n## 配置选项\n> 如果对 data、created 等属性使用箭头函数，this 将是 undefined\n\n  ```js\n  var app = new Vue({\n    el: \"#app\",        // 挂载元素\n    data: {            // 挂载数据\n        user: {\n            name: \"tom\"\n            age: 20\n        }  \n    },\n    computed: { },     // 计算属性：派生所需数据\n    methods: { },      // 事件绑定：事件名不区分大小写)\n    components: {      // 组件注册(组件名不要和已有标签冲突)\n    },\n    watch:{           // 监听数据\n        \n        user: {       // 深度监听(可监听到对象内部属性变化)\n            handler: function(val, oldval){ },  \n            deep: true,     \n            immediate: true    \n        },  \n        \"user.name\": function(val, oldval){  // 必须加引号  \n            console.log(val + \"a\")  \n        },\n        inputVal:{    // 组件创建和 input 变化时获取列表\n            handler: 'getList',\n            immediate: true  \n        },\n        $route(to, from){         // 监听子组件路由变化\n            console.log(to.name)\n        }\n    },\n    filters: {          // 过滤器：{{user.age | sum}} \n        sum: function (value) {\n            return value > 0;\n        }\n    },\n    mounted () {       // 监听\n        this.$root.eventHub.$on('updateDash', this.getList)\n        window.addEventListener('scroll', this.handleScroll)\n    },\n    beforeDestroy(){  // 解绑\n        this.$root.eventHub.$off('updateDash')\n        window.removeEventListener('scroll', this.handleScroll)\n    }\n  })\n  ```\n\n\n## 生命周期   \n> Vue 实例由创建到销毁的完整运行一次的过程中会触发的函数\n\n### 运行流程\n  <div align=\"center\"> \n    ![Vue 生命周期](images/vue/vue_life.png)\n  </div> \n\n\n### 常用处理\n  * __beforeCreate__：初始化非响应式变量，比如添加 Loading\n  * __created__：页面初始化，比如关闭 Loading 和 Ajax 请求\n  * __mounted__：获取和操作 Dom 元素和 Ajax 请求\n  * __updated__：统一处理数据，但可能陷入死循环\n  * __beforeDestroy__：销毁定时器、解绑全局事件、销毁插件对象等操作\n\t\n \n## 常用方法\n  * __app.$watch__：监听\n  * __app.$set__：添加属性，全局 Vue.set 的别名\n  * __app.$delete__：删除属性，全局 Vue.delete 的别名\n  * __app.$on__：监听自定义事件\n  * __app.$emit__：触发事件\n  * __app.$off__：移除事件\n  * __app.$mount__：手动挂载\n  * __app.$forceUpdate__：重新渲染\n  * __app.$nextTick__：将回调延迟到下次 DOM 更新后执行\n  * __app.$destroy__：完全销毁实例\n\n\n## $nextTick\n> Vue 数据驱动视图更新是异步的，即修改数据时视图不会立刻更新，而是等同一事件循环中的所有数据变化完成后再统一进行视图更新\n\n  <div style=\"text-indent: 2em\">主线程完成同步环境执行，读取任务队列 并提取队首的任务之后放入主线程中执行，不断重复该操作的过程就是 事件循环。主线程每次读取任务队列操作时是一个事件循环的开始，异步 callback 不可能处在同一事件循环中。而 nextTick 的触发时机：同一事件循环中的代码执行完毕 --> DOM 更新 -> nextTick callback 触发，所以它的 应用场景就是需要在视图更新之后 基于新视图进行操作时，常见如下：</div>\n \n  * created 钩子中操作 DOM，因为此时的 DOM 其实并未渲染\n  * 在数据变化后执行某个操作，而且该操作需要使用随数据改变而改变的最新 DOM 结构，如获取表格数据更新后的高度\n\n\n# 二、全局 API\n> 指令和组件命名时不能使用标签和关键字，而且尽量不使用驼峰命名 (因为 webpack 编译后会统一变为小写)。如果有大写字母，则使用时必须都改为小写并添加 v-、-\n        \n## 常用汇总\n  ```js\n  // 过滤器：必须放在 Vue 实例化前面：{{data | formatDate('yyyy-MM-dd hh:mm:ss')}}\n  Vue.filter('formatDate', function (value, fmt) {\n      let date = new Date(value);\n      let obj = {\n          'M+': date.getMonth() + 1, \n          'd+': date.getDate(), \n          'h+': date.getHours(), \n          'm+': date.getMinutes(), \n          's+': date.getSeconds(), \n          'q+': Math.floor((date.getMonth() + 3) / 3), // 季度\n          'S': date.getMilliseconds() // 毫秒\n      };\n      // 匹配年\n      if (/(y+)/.test(fmt)) {\n          fmt = fmt.replace(RegExp.$1, (date.getFullYear() + '').substr(4 - RegExp.$1.length));\n      }\n      // 匹配月日 时 分 秒等\n      for (let item in obj) {\n          if (new RegExp('(' + item + ')').test(fmt)) {\n          let str = '' + obj[item];\n          fmt = fmt.replace(RegExp.$1, (RegExp.$1.length === 1) ? str : (('00' + str).substr(str.length)));\n          }\n      }\n      return fmt;\n  })          \n\n\n  // 指令：input v-auto-focus\n  Vue.directive(\"autoFocus \", {        \n      bind(el, binding, vnode){ \n          // 创建：指令第一次绑定到元素时调用，比如添加事件监听器等\n      },      \n      inserted(el){    \n          el.focus()\n          // 插入：当元素被插入到 DOM\n      },      \n      update(el, binding, vnode, oldVnode){ \n          // 更新：当元素所在模板更新时\n      },     \n      componentUpdate(el, binding, vnode, oldVnode){ \n          // 当元素所在模板完成一次更新周期时\n      },   \n      unbind(el, binding, vnode){          \n          // 解除绑定时只调用一次，比如移除 bind 时绑定的事件监听器\n      }\n  })\n\n  // 方法\n  Vue.prototype.setCookie = (name, value, expiredays) => {\n  var exdate = new Date();　　　　\n  exdate.setDate(exdate.getDate() + expiredays);　　　　\n  document.cookie = c_name + \"=\" + escape(value) + ((expiredays == null) ? \"\" : \";expires=\" + exdate.toGMTString());\n  }\n\n  // 组件\n  Vue.component('myCom', { })    // 语法糖方法\n\n  var myCom2 = Vue.extend({ })   // 构造器方法 \n  Vue.component('myCom2', myCom2) \n\n\n  // 插件：相当于 MyPlugin.install(Vue)\n  Vue.use(MyPlugin)\n  Vue.use(MyPlugin, { someOption: true })\n\n\n  // 混入：为自定义对象注入处理逻辑但会影响之后的 vue 实例\n  Vue.mixin({ })\n\n  // 推迟回调\n  Vue.nextTick()  \n  ```\n\n\n\n## mixins\n  * __组件引用__：相当于在父组件内开辟了一块单独空间给子组件，本质上两者是相对独立的\n  * __mixins 混合__：将子组件内部的属性和方法全部扩充到父组件，从而实现组件的复用\n\n  ```js\n  // mixin.js\n  export default {\n      methods: {\n          formatDate (dateTime, fmt = 'YYYY年M月DD日 HH:mm:ss') {\n              if (!dateTime) { return '' }\n              moment.locale('zh-CN')\n              return moment(dateTime).format(fmt)\n          }\n      }\n  }\n\n  // main.js 全局\n  import mixin from './mixin'\n  Vue.mixin(mixin)\n\n  // 组件 局部\n  import { formatDate } from './mixins'\n  export default {\n    name: 'modal',\n    mixins: [formatDate],\n    computed: {\n        formatDate(){\n            // 调用方法\n            return this.formatDate(new Date())\n        }\n    }\n  }\n  ```\n\n\n# 三、插件开发\n> 本质是一个必须提供一个公开接口的对象或函数，用来扩展 vue 功能\n    \n## 插件与组件\n  * 区别：插件可以实现很多组件无法实现的需求\n  * 关系：插件可以封装组件，组件可以暴露数据给插件\n\n\n## 自定义开发\n> Vue.use() 会自动调用 install() 并阻止相同插件注册多次\n\n### 常规写法\n  ```js\n  // toast.js\n  var Toast = {};        \n  Toast.install = function (Vue, options) { \n      Vue.prototype.$msg = 'Hello World';\n  }\n  module.exports = Toast;      \n\n  // main.js\n  import Toast from './toast.js';\n  Vue.use(Toast);  \n  console.log(this.$msg);   // Hello World\n  ```\n\n\n### 模板写法\n  ```js\n  export default {\n      install: function (Vue, options) { //options一般是对象\n          // 添加全局方法和属性\n          Vue.myProperty = 'Hello Vue',    \n          Vue.myGlobalMethod = function () { }, \n                  \n          // 添加全局资源：指令、过滤器、过渡等\n          Vue.directive('focus', function(el, binding, vnode, oldVnode){ })  \n          Vue.filter('formatTime', function (value){ })\n\n          // 添加组件选项：混入 Vue 实例本身没有的方法\n          Vue.mixin({        \n              created(){ },\n              methods: { }\n          }) \n\n          // 添加实例方法：调用时使用 this.$get()\n          Vue.prototype.$get = function(){ }\n      }\n  }\n  ```\n\n\n## 全局组件\n> 将组件以插件形式封装\n\n### 组件封装\n  ```js\n  // 初始化目录\n  vue init webpack-simple test\n  cd test && cnpm install  \n  src              \n    ├── App.vue               \n    ├── main.js               \n    └── lib                 \n        ├── Loading.vue  \n        └── index.js     \n\n  // index.js\n  import Load from './Loading.vue'\n  const Loading = {\n      install: function (Vue) {\n          Vue.component('Loading', Load)\n      }\n  }\n  if (typeof window !== 'undefined' && window.Vue) { \n      window.Vue.use(Loading) \n  }\n  export default Loading\n\n  // main.js \n  import Loading from './lib/index.js'\n  Vue.use(Loading)\n  ```\n\n### 修改配置\n  ```js\n  // webpack.config.js\n  module.exports = {\n      entry: './src/lib/index.js',\n      output: {\n          path: path.resolve(__dirname, './dist'),\n          publicPath: '/dist/',\n          filename: 'vue-loading.js',\n          library: 'loading',     // 指定 require 时的模块名\n          libraryTarget: 'umd',   // 生成不同 umd 的代码\n          umdNamedDefine: true    // 构建过程中对 AMD 模块进行命名\n      }\n  }\n\n  // package.json \n  {\n    \"name\": \"vue-loading\",         // 组件名, 不能与已有npm包重复\n    \"private\": false,              // 组件包改为公用\n    \"main\":\"dist/vue-slider.js\",   // 配置 import 引入的检索地址\n    \"repository\": {                // 指定代码所在的仓库地址\n        \"type\": \"git\",\n        \"url\": \"git+https://github.com/chuang/loading.git\"\n    },\n  }\n  ```\n\n\n### 打包发布\n  * 打包：`npm run build`\n  * 登录：`npm login`\n  * 发布：`npm publish`\n  \n  \n### 安装使用\n  ```js\n  // 安装插件\n  npm install vue-loading   \n\n  // main.js \n  import Loading from 'vue-loading'\n  Vue.use(Loading)\n  ```\n\n\n# 四、组件基础\n> 组件只有挂载到某个 Vue 实例下才会生效，但组件内必须使用箭头函数，否则 this 不指向当前组件\n\n## 基础使用\n\n### 书写方式\n  * __通过 script__：`script type=\"text/x-template\" id=\"myCom\"`\n  * __通过 template__：`template id=\"myCom\"`\n  * __单文件组件__：文件扩展名为 .vue，组成部分为 `template、script、style`\n\n\n### 注册方式\n  * 全局：所有实例和组件都可以直接调用\n  * 局部：只有引用组件的实例或组件可以调用\n\n\n  ```js\n  // 全局注册：my-com\n  Vue.component('myCom', { }) \n\n  // 局部注册：child\n  import child from '@/components/child' \n  export default {\n      components:{ child }              \n  }\n  ```\n\n\n### 配置选项\n> name、template、props、data、computed、methods、components、created、...\n\n\n### 对外接口\n  * __props 状态__：单向传递数据\n  * __events 事件__：触发事件\n  * __slots 片断__：嵌套内容\n\n\n### 扩展方法\n  ```js\n  // 定义一个混合对象\n  export const myMixin = {\n      data(){\n          return { num: 1 }\n      },\n      methods: {\n          hello() {\n              console.log('hello from mixin')\n          }\n      },\n      created() {\n          this.hello()\n      }\n  }\n\n  // 组件中引用\n  import {myMixin} from \"./mixin.js\"\n  var Component = Vue.extend({\n      mixins: [myMixin]\n  })\n  ```\n\n\n\n## 内置指令\n  * 数据渲染：`&#123;&#123;&#125;&#125;、v-text、v-html`\n  * 条件渲染：`v-if、v-else`\n  * 循环渲染：\n    * 数组：`v-for=\"(item, index) in arr\" :key=\"index\"`\n    * 对象：`v-for=\"(item, key, index) of obj\" :key=\"index\"`\n  * 事件绑定\n    * 普通：`v-on:click = \"todo\"`\n    * 缩写：`@click = \"todo\"`\n    * 修饰符：`@click.stop.self、@keyup.stop.enter`\n      * 阻止冒泡：stop\n      * 阻止默认：prevent\n      * 执行一次：once\n  * 动态绑定：`v-bind:`，注意可以省略 v-bind \n    * class：\n      * :class=\"['a', 'b']\"\n      * :class=\"[ true ? 'a': 'b']\"\n      * :class=\"{ 'active': isActive(id) }\"\n    * style\n      * :style=\"{color: 'red'}\"\n      * :style=\"[{color: 'red'}, {fontSize: '16px'}]\"\n  * 双向绑定\n    * 绑定：`v-model、v-model.trim`\n    * 修饰符\n      * trim：首尾空格过滤\n      * lazy：监听change事件\n      * number：字符串转为数字\n  * 性能优化\n    * 只渲染一次：`v-once`\n    * 防止页面闪烁：`v-cloak`\n    * 不输出 data：`v-pre`\n\n\n## 组件通信\n\n### 父子组件通信\n  * 子传父\n    * 法一：通过ref属性在父组件中直接取得子组件的数据\n    * 法二：子组件 $emit() 触发自定义事件，父组件 $on() 监听\n      * 父组件：`child @updateList = \"updateList\"`\n      * 子组件：`this.$emit(\"updateList\", data)`\n  * 父传子：在子组件中通过 props 定义父组件传递的属性\n    * 父组件：child name=\"Tom\" :songs=\"songs\" :age=\"age\" \n    * 子组件：props 接收属性如下\n\n  ```js\n  export default {\n      // 简洁写法\n      props: [\"name\", \"songs\"]\n\n      // 普通写法\n      props: {\n          name:{  // 静态数据\n              type: String\n          }\n          songs:{  // 动态数据\n              type: Array\n          },\n          age:{     // 动态数据验证\n              type: Number,   \n              required: true,\n              default(){     // 默认值, 可直接1000 \n                  return { time: 1000 } \n              },  \n              validator(val){  // 自定义验证\n                  return val > 0\n              }\n          }\n      }\n  }\n  ```\n\n\n### 双向绑定\n> 同步父子组件数据，注意不要在子组件中修改 props 接收的数据\n\n  * 普通写法\n    * 父组件监听自定义事件：`child @update=\"val => pmsg = val\" :msg=\"pmsg\"`\n    * 子组件触发事件：`props: { msg: String }、this.$emit('update', newVal)`\n  * 使用 sync\n    * 父组件\n      * 写法：`child :startDate.sync=\"startDate\"`\n      * 扩展：`child :startDate=\"bar\" @update:startDate=\"val => startDate = val\"`\n    * 子组件\n      * 属性：`props: { startDate: String }`\n      * 事件：`this.$emit(\"update:startDate\", startDate)`\n\n\n### 祖孙组件通信\n> $attrs 用来简化组件和后代组件的数据传递\n    \n  * 属性\n    * __$attrs__：传递不被 prop 识别的属性 (class和style除外)\n    * __$listeners__：传递组件的事件 (.native除外)\n    * __inheritAttrs__：控制 vue 对非 prop 特性默认行为\n        true：默认将组件中不被 props 识别的属性绑定到根元素\n        false：可以通过 v-bind 显性绑定到非根元素\n  * __com.vue__：child sex=\"男\"\n  * __child.vue__：grand v-bind=\"$attrs\" v-on=\"$listeners\"\n    ```js\n    export default {\n        // props 没有注册 sex\n        computed: {\n            sex(){\n                return this.$attrs.sex\n            }\n        },\n        // 去掉默认行为\n        inheritAttrs: false\n    }\n    ```\n  * __grand.vue__\n    ```js\n    export default {\n        computed: {\n            sex(){\n                return this.$attrs.sex\n            }\n        },\n        inheritAttrs: false\n    }\n    ```\n        \n\n### 全局通信\n  * 使用空实例作为事件中心\n    1. 根组件中添加空实例，允许所有组件调用\n    2. 某个组件中定义调用事件触发的方法\n    3. 另一个组件中绑定事件监听，并在组件销毁前解除绑定\n  * 借助Vuex的全局状态共享\n\n\n  ```js\n  // main.js\n  new Vue({ \n      data: { \n          eventHub: new Vue() \n      } \n  })\n\n  // com1 \n  this.$root.eventHub.$emit('updateList', true)\n\n  // com2\n  export default {\n      created(){\n          this.$root.eventHub.$on('updateList', value => {\n              console.log(value)\n          })\n      },\n      beforeDestroy() {\n          this.$root.eventHub.$off('to_sibiling')\n      }\n  }\n  ```\n\n\n## template 标签\n> 可看作一个不可见的包裹元素，主要用于分组的条件判断和列表渲染\n\n  <div align=\"center\"> \n    ![Vue template](images/vue/vue-temp.png)\n  </div> \n\n\n## 内置组件\n  * __transition__：单个元素/组件的过渡效果\n  * __transition-group__：多个元素/组件的过渡效果\n  * __component__：支持两个属性 is、inline-template\n  * __keep-alive__：保留组件状态或避免重新渲染\n  * __slot__：替换 slot 元素实现内容嵌套\n\n\n## 特殊特性   \n  * __key__  \n    * 管理可复用的元素\n    * 减少运算来提高循环性能：`v-for=\"item in items\" :key=\"item.id\"`\n  * __is__\n    * 使用 v-bind:is 实现动态组件的切换效果\n    * 用于在 ul 等受限制的 html 元素中绑定组件：`li is=\"com1\"`\n  * __slot__ \n    * 配合 slot 内置组件实现嵌套内容的相应显示\n    * 没有 slot 时不显示嵌套内容，多个 slot 时需使用具名插槽 (添加 name 属性)\n  * __ref__  \n    * 获取当前 DOM 元素：`li ref=\"cur\"、this.$refs.cur`\n    * 获取子组件实例对象：`my-com ref=\"com\"、this.$refs.com`\n\n\n  <div align=\"center\"> \n    ![Vue special](images/vue/vue-special.png)\n  </div> \n\n\n","source":"_posts/15-vue组件.md","raw":"---\ntitle: Vue 组件化开发\ntags:\n  - Vue.js\ncategories: Vue.js\ntop: false\nkeywords:\n  - vue\ndate: 2019-04-14 18:26:43\ndescription: 实例对象、全局方法、插件开发、组件基础\n---\n\n# 一、实例对象\n> 一个包含数据、方法和组件的 vue 实例对象\n\n## 初始化\n  ```js\n  // 1、直接创建\n  var app1 = new Vue({\n    el:\"#app1\",\n  })\n\n  // 2、首先创建无挂载点的实例\n  var app2 = new Vue({    \n    data: {          // 对象\n        msg:\"app2\" \n    }\n  })\n  app2.$mount('#app2');\n\n  // 3、使用基础 Vue 构造器创建\"子类\"\n  var app3 = Vue.extend({\n    data: function(){   // 函数\n        return{ \n            msg:\"app3\" \n        }\n    }\n  })    \n  new app3().$mount('#app3');\n  ```\n\n\n## 配置选项\n> 如果对 data、created 等属性使用箭头函数，this 将是 undefined\n\n  ```js\n  var app = new Vue({\n    el: \"#app\",        // 挂载元素\n    data: {            // 挂载数据\n        user: {\n            name: \"tom\"\n            age: 20\n        }  \n    },\n    computed: { },     // 计算属性：派生所需数据\n    methods: { },      // 事件绑定：事件名不区分大小写)\n    components: {      // 组件注册(组件名不要和已有标签冲突)\n    },\n    watch:{           // 监听数据\n        \n        user: {       // 深度监听(可监听到对象内部属性变化)\n            handler: function(val, oldval){ },  \n            deep: true,     \n            immediate: true    \n        },  \n        \"user.name\": function(val, oldval){  // 必须加引号  \n            console.log(val + \"a\")  \n        },\n        inputVal:{    // 组件创建和 input 变化时获取列表\n            handler: 'getList',\n            immediate: true  \n        },\n        $route(to, from){         // 监听子组件路由变化\n            console.log(to.name)\n        }\n    },\n    filters: {          // 过滤器：{{user.age | sum}} \n        sum: function (value) {\n            return value > 0;\n        }\n    },\n    mounted () {       // 监听\n        this.$root.eventHub.$on('updateDash', this.getList)\n        window.addEventListener('scroll', this.handleScroll)\n    },\n    beforeDestroy(){  // 解绑\n        this.$root.eventHub.$off('updateDash')\n        window.removeEventListener('scroll', this.handleScroll)\n    }\n  })\n  ```\n\n\n## 生命周期   \n> Vue 实例由创建到销毁的完整运行一次的过程中会触发的函数\n\n### 运行流程\n  <div align=\"center\"> \n    ![Vue 生命周期](images/vue/vue_life.png)\n  </div> \n\n\n### 常用处理\n  * __beforeCreate__：初始化非响应式变量，比如添加 Loading\n  * __created__：页面初始化，比如关闭 Loading 和 Ajax 请求\n  * __mounted__：获取和操作 Dom 元素和 Ajax 请求\n  * __updated__：统一处理数据，但可能陷入死循环\n  * __beforeDestroy__：销毁定时器、解绑全局事件、销毁插件对象等操作\n\t\n \n## 常用方法\n  * __app.$watch__：监听\n  * __app.$set__：添加属性，全局 Vue.set 的别名\n  * __app.$delete__：删除属性，全局 Vue.delete 的别名\n  * __app.$on__：监听自定义事件\n  * __app.$emit__：触发事件\n  * __app.$off__：移除事件\n  * __app.$mount__：手动挂载\n  * __app.$forceUpdate__：重新渲染\n  * __app.$nextTick__：将回调延迟到下次 DOM 更新后执行\n  * __app.$destroy__：完全销毁实例\n\n\n## $nextTick\n> Vue 数据驱动视图更新是异步的，即修改数据时视图不会立刻更新，而是等同一事件循环中的所有数据变化完成后再统一进行视图更新\n\n  <div style=\"text-indent: 2em\">主线程完成同步环境执行，读取任务队列 并提取队首的任务之后放入主线程中执行，不断重复该操作的过程就是 事件循环。主线程每次读取任务队列操作时是一个事件循环的开始，异步 callback 不可能处在同一事件循环中。而 nextTick 的触发时机：同一事件循环中的代码执行完毕 --> DOM 更新 -> nextTick callback 触发，所以它的 应用场景就是需要在视图更新之后 基于新视图进行操作时，常见如下：</div>\n \n  * created 钩子中操作 DOM，因为此时的 DOM 其实并未渲染\n  * 在数据变化后执行某个操作，而且该操作需要使用随数据改变而改变的最新 DOM 结构，如获取表格数据更新后的高度\n\n\n# 二、全局 API\n> 指令和组件命名时不能使用标签和关键字，而且尽量不使用驼峰命名 (因为 webpack 编译后会统一变为小写)。如果有大写字母，则使用时必须都改为小写并添加 v-、-\n        \n## 常用汇总\n  ```js\n  // 过滤器：必须放在 Vue 实例化前面：{{data | formatDate('yyyy-MM-dd hh:mm:ss')}}\n  Vue.filter('formatDate', function (value, fmt) {\n      let date = new Date(value);\n      let obj = {\n          'M+': date.getMonth() + 1, \n          'd+': date.getDate(), \n          'h+': date.getHours(), \n          'm+': date.getMinutes(), \n          's+': date.getSeconds(), \n          'q+': Math.floor((date.getMonth() + 3) / 3), // 季度\n          'S': date.getMilliseconds() // 毫秒\n      };\n      // 匹配年\n      if (/(y+)/.test(fmt)) {\n          fmt = fmt.replace(RegExp.$1, (date.getFullYear() + '').substr(4 - RegExp.$1.length));\n      }\n      // 匹配月日 时 分 秒等\n      for (let item in obj) {\n          if (new RegExp('(' + item + ')').test(fmt)) {\n          let str = '' + obj[item];\n          fmt = fmt.replace(RegExp.$1, (RegExp.$1.length === 1) ? str : (('00' + str).substr(str.length)));\n          }\n      }\n      return fmt;\n  })          \n\n\n  // 指令：input v-auto-focus\n  Vue.directive(\"autoFocus \", {        \n      bind(el, binding, vnode){ \n          // 创建：指令第一次绑定到元素时调用，比如添加事件监听器等\n      },      \n      inserted(el){    \n          el.focus()\n          // 插入：当元素被插入到 DOM\n      },      \n      update(el, binding, vnode, oldVnode){ \n          // 更新：当元素所在模板更新时\n      },     \n      componentUpdate(el, binding, vnode, oldVnode){ \n          // 当元素所在模板完成一次更新周期时\n      },   \n      unbind(el, binding, vnode){          \n          // 解除绑定时只调用一次，比如移除 bind 时绑定的事件监听器\n      }\n  })\n\n  // 方法\n  Vue.prototype.setCookie = (name, value, expiredays) => {\n  var exdate = new Date();　　　　\n  exdate.setDate(exdate.getDate() + expiredays);　　　　\n  document.cookie = c_name + \"=\" + escape(value) + ((expiredays == null) ? \"\" : \";expires=\" + exdate.toGMTString());\n  }\n\n  // 组件\n  Vue.component('myCom', { })    // 语法糖方法\n\n  var myCom2 = Vue.extend({ })   // 构造器方法 \n  Vue.component('myCom2', myCom2) \n\n\n  // 插件：相当于 MyPlugin.install(Vue)\n  Vue.use(MyPlugin)\n  Vue.use(MyPlugin, { someOption: true })\n\n\n  // 混入：为自定义对象注入处理逻辑但会影响之后的 vue 实例\n  Vue.mixin({ })\n\n  // 推迟回调\n  Vue.nextTick()  \n  ```\n\n\n\n## mixins\n  * __组件引用__：相当于在父组件内开辟了一块单独空间给子组件，本质上两者是相对独立的\n  * __mixins 混合__：将子组件内部的属性和方法全部扩充到父组件，从而实现组件的复用\n\n  ```js\n  // mixin.js\n  export default {\n      methods: {\n          formatDate (dateTime, fmt = 'YYYY年M月DD日 HH:mm:ss') {\n              if (!dateTime) { return '' }\n              moment.locale('zh-CN')\n              return moment(dateTime).format(fmt)\n          }\n      }\n  }\n\n  // main.js 全局\n  import mixin from './mixin'\n  Vue.mixin(mixin)\n\n  // 组件 局部\n  import { formatDate } from './mixins'\n  export default {\n    name: 'modal',\n    mixins: [formatDate],\n    computed: {\n        formatDate(){\n            // 调用方法\n            return this.formatDate(new Date())\n        }\n    }\n  }\n  ```\n\n\n# 三、插件开发\n> 本质是一个必须提供一个公开接口的对象或函数，用来扩展 vue 功能\n    \n## 插件与组件\n  * 区别：插件可以实现很多组件无法实现的需求\n  * 关系：插件可以封装组件，组件可以暴露数据给插件\n\n\n## 自定义开发\n> Vue.use() 会自动调用 install() 并阻止相同插件注册多次\n\n### 常规写法\n  ```js\n  // toast.js\n  var Toast = {};        \n  Toast.install = function (Vue, options) { \n      Vue.prototype.$msg = 'Hello World';\n  }\n  module.exports = Toast;      \n\n  // main.js\n  import Toast from './toast.js';\n  Vue.use(Toast);  \n  console.log(this.$msg);   // Hello World\n  ```\n\n\n### 模板写法\n  ```js\n  export default {\n      install: function (Vue, options) { //options一般是对象\n          // 添加全局方法和属性\n          Vue.myProperty = 'Hello Vue',    \n          Vue.myGlobalMethod = function () { }, \n                  \n          // 添加全局资源：指令、过滤器、过渡等\n          Vue.directive('focus', function(el, binding, vnode, oldVnode){ })  \n          Vue.filter('formatTime', function (value){ })\n\n          // 添加组件选项：混入 Vue 实例本身没有的方法\n          Vue.mixin({        \n              created(){ },\n              methods: { }\n          }) \n\n          // 添加实例方法：调用时使用 this.$get()\n          Vue.prototype.$get = function(){ }\n      }\n  }\n  ```\n\n\n## 全局组件\n> 将组件以插件形式封装\n\n### 组件封装\n  ```js\n  // 初始化目录\n  vue init webpack-simple test\n  cd test && cnpm install  \n  src              \n    ├── App.vue               \n    ├── main.js               \n    └── lib                 \n        ├── Loading.vue  \n        └── index.js     \n\n  // index.js\n  import Load from './Loading.vue'\n  const Loading = {\n      install: function (Vue) {\n          Vue.component('Loading', Load)\n      }\n  }\n  if (typeof window !== 'undefined' && window.Vue) { \n      window.Vue.use(Loading) \n  }\n  export default Loading\n\n  // main.js \n  import Loading from './lib/index.js'\n  Vue.use(Loading)\n  ```\n\n### 修改配置\n  ```js\n  // webpack.config.js\n  module.exports = {\n      entry: './src/lib/index.js',\n      output: {\n          path: path.resolve(__dirname, './dist'),\n          publicPath: '/dist/',\n          filename: 'vue-loading.js',\n          library: 'loading',     // 指定 require 时的模块名\n          libraryTarget: 'umd',   // 生成不同 umd 的代码\n          umdNamedDefine: true    // 构建过程中对 AMD 模块进行命名\n      }\n  }\n\n  // package.json \n  {\n    \"name\": \"vue-loading\",         // 组件名, 不能与已有npm包重复\n    \"private\": false,              // 组件包改为公用\n    \"main\":\"dist/vue-slider.js\",   // 配置 import 引入的检索地址\n    \"repository\": {                // 指定代码所在的仓库地址\n        \"type\": \"git\",\n        \"url\": \"git+https://github.com/chuang/loading.git\"\n    },\n  }\n  ```\n\n\n### 打包发布\n  * 打包：`npm run build`\n  * 登录：`npm login`\n  * 发布：`npm publish`\n  \n  \n### 安装使用\n  ```js\n  // 安装插件\n  npm install vue-loading   \n\n  // main.js \n  import Loading from 'vue-loading'\n  Vue.use(Loading)\n  ```\n\n\n# 四、组件基础\n> 组件只有挂载到某个 Vue 实例下才会生效，但组件内必须使用箭头函数，否则 this 不指向当前组件\n\n## 基础使用\n\n### 书写方式\n  * __通过 script__：`script type=\"text/x-template\" id=\"myCom\"`\n  * __通过 template__：`template id=\"myCom\"`\n  * __单文件组件__：文件扩展名为 .vue，组成部分为 `template、script、style`\n\n\n### 注册方式\n  * 全局：所有实例和组件都可以直接调用\n  * 局部：只有引用组件的实例或组件可以调用\n\n\n  ```js\n  // 全局注册：my-com\n  Vue.component('myCom', { }) \n\n  // 局部注册：child\n  import child from '@/components/child' \n  export default {\n      components:{ child }              \n  }\n  ```\n\n\n### 配置选项\n> name、template、props、data、computed、methods、components、created、...\n\n\n### 对外接口\n  * __props 状态__：单向传递数据\n  * __events 事件__：触发事件\n  * __slots 片断__：嵌套内容\n\n\n### 扩展方法\n  ```js\n  // 定义一个混合对象\n  export const myMixin = {\n      data(){\n          return { num: 1 }\n      },\n      methods: {\n          hello() {\n              console.log('hello from mixin')\n          }\n      },\n      created() {\n          this.hello()\n      }\n  }\n\n  // 组件中引用\n  import {myMixin} from \"./mixin.js\"\n  var Component = Vue.extend({\n      mixins: [myMixin]\n  })\n  ```\n\n\n\n## 内置指令\n  * 数据渲染：`&#123;&#123;&#125;&#125;、v-text、v-html`\n  * 条件渲染：`v-if、v-else`\n  * 循环渲染：\n    * 数组：`v-for=\"(item, index) in arr\" :key=\"index\"`\n    * 对象：`v-for=\"(item, key, index) of obj\" :key=\"index\"`\n  * 事件绑定\n    * 普通：`v-on:click = \"todo\"`\n    * 缩写：`@click = \"todo\"`\n    * 修饰符：`@click.stop.self、@keyup.stop.enter`\n      * 阻止冒泡：stop\n      * 阻止默认：prevent\n      * 执行一次：once\n  * 动态绑定：`v-bind:`，注意可以省略 v-bind \n    * class：\n      * :class=\"['a', 'b']\"\n      * :class=\"[ true ? 'a': 'b']\"\n      * :class=\"{ 'active': isActive(id) }\"\n    * style\n      * :style=\"{color: 'red'}\"\n      * :style=\"[{color: 'red'}, {fontSize: '16px'}]\"\n  * 双向绑定\n    * 绑定：`v-model、v-model.trim`\n    * 修饰符\n      * trim：首尾空格过滤\n      * lazy：监听change事件\n      * number：字符串转为数字\n  * 性能优化\n    * 只渲染一次：`v-once`\n    * 防止页面闪烁：`v-cloak`\n    * 不输出 data：`v-pre`\n\n\n## 组件通信\n\n### 父子组件通信\n  * 子传父\n    * 法一：通过ref属性在父组件中直接取得子组件的数据\n    * 法二：子组件 $emit() 触发自定义事件，父组件 $on() 监听\n      * 父组件：`child @updateList = \"updateList\"`\n      * 子组件：`this.$emit(\"updateList\", data)`\n  * 父传子：在子组件中通过 props 定义父组件传递的属性\n    * 父组件：child name=\"Tom\" :songs=\"songs\" :age=\"age\" \n    * 子组件：props 接收属性如下\n\n  ```js\n  export default {\n      // 简洁写法\n      props: [\"name\", \"songs\"]\n\n      // 普通写法\n      props: {\n          name:{  // 静态数据\n              type: String\n          }\n          songs:{  // 动态数据\n              type: Array\n          },\n          age:{     // 动态数据验证\n              type: Number,   \n              required: true,\n              default(){     // 默认值, 可直接1000 \n                  return { time: 1000 } \n              },  \n              validator(val){  // 自定义验证\n                  return val > 0\n              }\n          }\n      }\n  }\n  ```\n\n\n### 双向绑定\n> 同步父子组件数据，注意不要在子组件中修改 props 接收的数据\n\n  * 普通写法\n    * 父组件监听自定义事件：`child @update=\"val => pmsg = val\" :msg=\"pmsg\"`\n    * 子组件触发事件：`props: { msg: String }、this.$emit('update', newVal)`\n  * 使用 sync\n    * 父组件\n      * 写法：`child :startDate.sync=\"startDate\"`\n      * 扩展：`child :startDate=\"bar\" @update:startDate=\"val => startDate = val\"`\n    * 子组件\n      * 属性：`props: { startDate: String }`\n      * 事件：`this.$emit(\"update:startDate\", startDate)`\n\n\n### 祖孙组件通信\n> $attrs 用来简化组件和后代组件的数据传递\n    \n  * 属性\n    * __$attrs__：传递不被 prop 识别的属性 (class和style除外)\n    * __$listeners__：传递组件的事件 (.native除外)\n    * __inheritAttrs__：控制 vue 对非 prop 特性默认行为\n        true：默认将组件中不被 props 识别的属性绑定到根元素\n        false：可以通过 v-bind 显性绑定到非根元素\n  * __com.vue__：child sex=\"男\"\n  * __child.vue__：grand v-bind=\"$attrs\" v-on=\"$listeners\"\n    ```js\n    export default {\n        // props 没有注册 sex\n        computed: {\n            sex(){\n                return this.$attrs.sex\n            }\n        },\n        // 去掉默认行为\n        inheritAttrs: false\n    }\n    ```\n  * __grand.vue__\n    ```js\n    export default {\n        computed: {\n            sex(){\n                return this.$attrs.sex\n            }\n        },\n        inheritAttrs: false\n    }\n    ```\n        \n\n### 全局通信\n  * 使用空实例作为事件中心\n    1. 根组件中添加空实例，允许所有组件调用\n    2. 某个组件中定义调用事件触发的方法\n    3. 另一个组件中绑定事件监听，并在组件销毁前解除绑定\n  * 借助Vuex的全局状态共享\n\n\n  ```js\n  // main.js\n  new Vue({ \n      data: { \n          eventHub: new Vue() \n      } \n  })\n\n  // com1 \n  this.$root.eventHub.$emit('updateList', true)\n\n  // com2\n  export default {\n      created(){\n          this.$root.eventHub.$on('updateList', value => {\n              console.log(value)\n          })\n      },\n      beforeDestroy() {\n          this.$root.eventHub.$off('to_sibiling')\n      }\n  }\n  ```\n\n\n## template 标签\n> 可看作一个不可见的包裹元素，主要用于分组的条件判断和列表渲染\n\n  <div align=\"center\"> \n    ![Vue template](images/vue/vue-temp.png)\n  </div> \n\n\n## 内置组件\n  * __transition__：单个元素/组件的过渡效果\n  * __transition-group__：多个元素/组件的过渡效果\n  * __component__：支持两个属性 is、inline-template\n  * __keep-alive__：保留组件状态或避免重新渲染\n  * __slot__：替换 slot 元素实现内容嵌套\n\n\n## 特殊特性   \n  * __key__  \n    * 管理可复用的元素\n    * 减少运算来提高循环性能：`v-for=\"item in items\" :key=\"item.id\"`\n  * __is__\n    * 使用 v-bind:is 实现动态组件的切换效果\n    * 用于在 ul 等受限制的 html 元素中绑定组件：`li is=\"com1\"`\n  * __slot__ \n    * 配合 slot 内置组件实现嵌套内容的相应显示\n    * 没有 slot 时不显示嵌套内容，多个 slot 时需使用具名插槽 (添加 name 属性)\n  * __ref__  \n    * 获取当前 DOM 元素：`li ref=\"cur\"、this.$refs.cur`\n    * 获取子组件实例对象：`my-com ref=\"com\"、this.$refs.com`\n\n\n  <div align=\"center\"> \n    ![Vue special](images/vue/vue-special.png)\n  </div> \n\n\n","slug":"15-vue组件","published":1,"updated":"2019-05-10T17:21:14.060Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvid4plm00170nbxbb0ksrn7","content":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><html><head></head><body><h1 id=\"一、实例对象\"><a href=\"#一、实例对象\" class=\"headerlink\" title=\"一、实例对象\"></a>一、实例对象</h1><blockquote><p>一个包含数据、方法和组件的 vue 实例对象</p></blockquote><h2 id=\"初始化\"><a href=\"#初始化\" class=\"headerlink\" title=\"初始化\"></a>初始化</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1、直接创建</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> app1 = <span class=\"keyword\">new</span> Vue({</span><br><span class=\"line\">  el:<span class=\"string\">\"#app1\"</span>,</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2、首先创建无挂载点的实例</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> app2 = <span class=\"keyword\">new</span> Vue({    </span><br><span class=\"line\">  data: {          <span class=\"comment\">// 对象</span></span><br><span class=\"line\">      msg:<span class=\"string\">\"app2\"</span> </span><br><span class=\"line\">  }</span><br><span class=\"line\">})</span><br><span class=\"line\">app2.$mount(<span class=\"string\">'#app2'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3、使用基础 Vue 构造器创建\"子类\"</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> app3 = Vue.extend({</span><br><span class=\"line\">  data: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{   <span class=\"comment\">// 函数</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span>{ </span><br><span class=\"line\">          msg:<span class=\"string\">\"app3\"</span> </span><br><span class=\"line\">      }</span><br><span class=\"line\">  }</span><br><span class=\"line\">})    </span><br><span class=\"line\"><span class=\"keyword\">new</span> app3().$mount(<span class=\"string\">'#app3'</span>);</span><br></pre></td></tr></tbody></table></figure><h2 id=\"配置选项\"><a href=\"#配置选项\" class=\"headerlink\" title=\"配置选项\"></a>配置选项</h2><blockquote><p>如果对 data、created 等属性使用箭头函数，this 将是 undefined</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"keyword\">new</span> Vue({</span><br><span class=\"line\">  el: <span class=\"string\">\"#app\"</span>,        <span class=\"comment\">// 挂载元素</span></span><br><span class=\"line\">  data: {            <span class=\"comment\">// 挂载数据</span></span><br><span class=\"line\">      user: {</span><br><span class=\"line\">          name: <span class=\"string\">\"tom\"</span></span><br><span class=\"line\">          age: <span class=\"number\">20</span></span><br><span class=\"line\">      }  </span><br><span class=\"line\">  },</span><br><span class=\"line\">  computed: { },     <span class=\"comment\">// 计算属性：派生所需数据</span></span><br><span class=\"line\">  methods: { },      <span class=\"comment\">// 事件绑定：事件名不区分大小写)</span></span><br><span class=\"line\">  components: {      <span class=\"comment\">// 组件注册(组件名不要和已有标签冲突)</span></span><br><span class=\"line\">  },</span><br><span class=\"line\">  watch:{           <span class=\"comment\">// 监听数据</span></span><br><span class=\"line\">      </span><br><span class=\"line\">      user: {       <span class=\"comment\">// 深度监听(可监听到对象内部属性变化)</span></span><br><span class=\"line\">          handler: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">val, oldval</span>)</span>{ },  </span><br><span class=\"line\">          deep: <span class=\"literal\">true</span>,     </span><br><span class=\"line\">          immediate: <span class=\"literal\">true</span>    </span><br><span class=\"line\">      },  </span><br><span class=\"line\">      <span class=\"string\">\"user.name\"</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">val, oldval</span>)</span>{  <span class=\"comment\">// 必须加引号  </span></span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(val + <span class=\"string\">\"a\"</span>)  </span><br><span class=\"line\">      },</span><br><span class=\"line\">      inputVal:{    <span class=\"comment\">// 组件创建和 input 变化时获取列表</span></span><br><span class=\"line\">          handler: <span class=\"string\">'getList'</span>,</span><br><span class=\"line\">          immediate: <span class=\"literal\">true</span>  </span><br><span class=\"line\">      },</span><br><span class=\"line\">      $route(to, <span class=\"keyword\">from</span>){         <span class=\"comment\">// 监听子组件路由变化</span></span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(to.name)</span><br><span class=\"line\">      }</span><br><span class=\"line\">  },</span><br><span class=\"line\">  filters: {          <span class=\"comment\">// 过滤器：{{user.age | sum}} </span></span><br><span class=\"line\">      sum: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>) </span>{</span><br><span class=\"line\">          <span class=\"keyword\">return</span> value > <span class=\"number\">0</span>;</span><br><span class=\"line\">      }</span><br><span class=\"line\">  },</span><br><span class=\"line\">  mounted () {       <span class=\"comment\">// 监听</span></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.$root.eventHub.$on(<span class=\"string\">'updateDash'</span>, <span class=\"keyword\">this</span>.getList)</span><br><span class=\"line\">      <span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">'scroll'</span>, <span class=\"keyword\">this</span>.handleScroll)</span><br><span class=\"line\">  },</span><br><span class=\"line\">  beforeDestroy(){  <span class=\"comment\">// 解绑</span></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.$root.eventHub.$off(<span class=\"string\">'updateDash'</span>)</span><br><span class=\"line\">      <span class=\"built_in\">window</span>.removeEventListener(<span class=\"string\">'scroll'</span>, <span class=\"keyword\">this</span>.handleScroll)</span><br><span class=\"line\">  }</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h2 id=\"生命周期\"><a href=\"#生命周期\" class=\"headerlink\" title=\"生命周期\"></a>生命周期</h2><blockquote><p>Vue 实例由创建到销毁的完整运行一次的过程中会触发的函数</p></blockquote><h3 id=\"运行流程\"><a href=\"#运行流程\" class=\"headerlink\" title=\"运行流程\"></a>运行流程</h3><div align=\"center\"><br><img src=\"images/vue/vue_life.png\" alt=\"Vue 生命周期\"><br></div><h3 id=\"常用处理\"><a href=\"#常用处理\" class=\"headerlink\" title=\"常用处理\"></a>常用处理</h3><ul><li><strong>beforeCreate</strong>：初始化非响应式变量，比如添加 Loading</li><li><strong>created</strong>：页面初始化，比如关闭 Loading 和 Ajax 请求</li><li><strong>mounted</strong>：获取和操作 Dom 元素和 Ajax 请求</li><li><strong>updated</strong>：统一处理数据，但可能陷入死循环</li><li><strong>beforeDestroy</strong>：销毁定时器、解绑全局事件、销毁插件对象等操作</li></ul><h2 id=\"常用方法\"><a href=\"#常用方法\" class=\"headerlink\" title=\"常用方法\"></a>常用方法</h2><ul><li><strong>app.$watch</strong>：监听</li><li><strong>app.$set</strong>：添加属性，全局 Vue.set 的别名</li><li><strong>app.$delete</strong>：删除属性，全局 Vue.delete 的别名</li><li><strong>app.$on</strong>：监听自定义事件</li><li><strong>app.$emit</strong>：触发事件</li><li><strong>app.$off</strong>：移除事件</li><li><strong>app.$mount</strong>：手动挂载</li><li><strong>app.$forceUpdate</strong>：重新渲染</li><li><strong>app.$nextTick</strong>：将回调延迟到下次 DOM 更新后执行</li><li><strong>app.$destroy</strong>：完全销毁实例</li></ul><h2 id=\"nextTick\"><a href=\"#nextTick\" class=\"headerlink\" title=\"$nextTick\"></a>$nextTick</h2><blockquote><p>Vue 数据驱动视图更新是异步的，即修改数据时视图不会立刻更新，而是等同一事件循环中的所有数据变化完成后再统一进行视图更新</p></blockquote><div style=\"text-indent:2em\">主线程完成同步环境执行，读取任务队列 并提取队首的任务之后放入主线程中执行，不断重复该操作的过程就是 事件循环。主线程每次读取任务队列操作时是一个事件循环的开始，异步 callback 不可能处在同一事件循环中。而 nextTick 的触发时机：同一事件循环中的代码执行完毕 –> DOM 更新 -> nextTick callback 触发，所以它的 应用场景就是需要在视图更新之后 基于新视图进行操作时，常见如下：</div><ul><li>created 钩子中操作 DOM，因为此时的 DOM 其实并未渲染</li><li>在数据变化后执行某个操作，而且该操作需要使用随数据改变而改变的最新 DOM 结构，如获取表格数据更新后的高度</li></ul><h1 id=\"二、全局-API\"><a href=\"#二、全局-API\" class=\"headerlink\" title=\"二、全局 API\"></a>二、全局 API</h1><blockquote><p>指令和组件命名时不能使用标签和关键字，而且尽量不使用驼峰命名 (因为 webpack 编译后会统一变为小写)。如果有大写字母，则使用时必须都改为小写并添加 v-、-</p></blockquote><h2 id=\"常用汇总\"><a href=\"#常用汇总\" class=\"headerlink\" title=\"常用汇总\"></a>常用汇总</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 过滤器：必须放在 Vue 实例化前面：{{data | formatDate('yyyy-MM-dd hh:mm:ss')}}</span></span><br><span class=\"line\">Vue.filter(<span class=\"string\">'formatDate'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value, fmt</span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">let</span> date = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(value);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> obj = {</span><br><span class=\"line\">        <span class=\"string\">'M+'</span>: date.getMonth() + <span class=\"number\">1</span>, </span><br><span class=\"line\">        <span class=\"string\">'d+'</span>: date.getDate(), </span><br><span class=\"line\">        <span class=\"string\">'h+'</span>: date.getHours(), </span><br><span class=\"line\">        <span class=\"string\">'m+'</span>: date.getMinutes(), </span><br><span class=\"line\">        <span class=\"string\">'s+'</span>: date.getSeconds(), </span><br><span class=\"line\">        <span class=\"string\">'q+'</span>: <span class=\"built_in\">Math</span>.floor((date.getMonth() + <span class=\"number\">3</span>) / <span class=\"number\">3</span>), <span class=\"comment\">// 季度</span></span><br><span class=\"line\">        <span class=\"string\">'S'</span>: date.getMilliseconds() <span class=\"comment\">// 毫秒</span></span><br><span class=\"line\">    };</span><br><span class=\"line\">    <span class=\"comment\">// 匹配年</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"regexp\">/(y+)/</span>.test(fmt)) {</span><br><span class=\"line\">        fmt = fmt.replace(<span class=\"built_in\">RegExp</span>.$<span class=\"number\">1</span>, (date.getFullYear() + <span class=\"string\">''</span>).substr(<span class=\"number\">4</span> - <span class=\"built_in\">RegExp</span>.$<span class=\"number\">1.</span>length));</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"comment\">// 匹配月日 时 分 秒等</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> item <span class=\"keyword\">in</span> obj) {</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(<span class=\"string\">'('</span> + item + <span class=\"string\">')'</span>).test(fmt)) {</span><br><span class=\"line\">        <span class=\"keyword\">let</span> str = <span class=\"string\">''</span> + obj[item];</span><br><span class=\"line\">        fmt = fmt.replace(<span class=\"built_in\">RegExp</span>.$<span class=\"number\">1</span>, (<span class=\"built_in\">RegExp</span>.$<span class=\"number\">1.</span>length === <span class=\"number\">1</span>) ? str : ((<span class=\"string\">'00'</span> + str).substr(str.length)));</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> fmt;</span><br><span class=\"line\">})          </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 指令：input v-auto-focus</span></span><br><span class=\"line\">Vue.directive(<span class=\"string\">\"autoFocus \"</span>, {        </span><br><span class=\"line\">    bind(el, binding, vnode){ </span><br><span class=\"line\">        <span class=\"comment\">// 创建：指令第一次绑定到元素时调用，比如添加事件监听器等</span></span><br><span class=\"line\">    },      </span><br><span class=\"line\">    inserted(el){    </span><br><span class=\"line\">        el.focus()</span><br><span class=\"line\">        <span class=\"comment\">// 插入：当元素被插入到 DOM</span></span><br><span class=\"line\">    },      </span><br><span class=\"line\">    update(el, binding, vnode, oldVnode){ </span><br><span class=\"line\">        <span class=\"comment\">// 更新：当元素所在模板更新时</span></span><br><span class=\"line\">    },     </span><br><span class=\"line\">    componentUpdate(el, binding, vnode, oldVnode){ </span><br><span class=\"line\">        <span class=\"comment\">// 当元素所在模板完成一次更新周期时</span></span><br><span class=\"line\">    },   </span><br><span class=\"line\">    unbind(el, binding, vnode){          </span><br><span class=\"line\">        <span class=\"comment\">// 解除绑定时只调用一次，比如移除 bind 时绑定的事件监听器</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 方法</span></span><br><span class=\"line\">Vue.prototype.setCookie = <span class=\"function\">(<span class=\"params\">name, value, expiredays</span>) =></span> {</span><br><span class=\"line\"><span class=\"keyword\">var</span> exdate = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();　　　　</span><br><span class=\"line\">exdate.setDate(exdate.getDate() + expiredays);　　　　</span><br><span class=\"line\"><span class=\"built_in\">document</span>.cookie = c_name + <span class=\"string\">\"=\"</span> + <span class=\"built_in\">escape</span>(value) + ((expiredays == <span class=\"literal\">null</span>) ? <span class=\"string\">\"\"</span> : <span class=\"string\">\";expires=\"</span> + exdate.toGMTString());</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 组件</span></span><br><span class=\"line\">Vue.component(<span class=\"string\">'myCom'</span>, { })    <span class=\"comment\">// 语法糖方法</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> myCom2 = Vue.extend({ })   <span class=\"comment\">// 构造器方法 </span></span><br><span class=\"line\">Vue.component(<span class=\"string\">'myCom2'</span>, myCom2) </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 插件：相当于 MyPlugin.install(Vue)</span></span><br><span class=\"line\">Vue.use(MyPlugin)</span><br><span class=\"line\">Vue.use(MyPlugin, { <span class=\"attr\">someOption</span>: <span class=\"literal\">true</span> })</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 混入：为自定义对象注入处理逻辑但会影响之后的 vue 实例</span></span><br><span class=\"line\">Vue.mixin({ })</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 推迟回调</span></span><br><span class=\"line\">Vue.nextTick()</span><br></pre></td></tr></tbody></table></figure><h2 id=\"mixins\"><a href=\"#mixins\" class=\"headerlink\" title=\"mixins\"></a>mixins</h2><ul><li><strong>组件引用</strong>：相当于在父组件内开辟了一块单独空间给子组件，本质上两者是相对独立的</li><li><p><strong>mixins 混合</strong>：将子组件内部的属性和方法全部扩充到父组件，从而实现组件的复用</p><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// mixin.js</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> {</span><br><span class=\"line\">    methods: {</span><br><span class=\"line\">        formatDate (dateTime, fmt = <span class=\"string\">'YYYY年M月DD日 HH:mm:ss'</span>) {</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!dateTime) { <span class=\"keyword\">return</span> <span class=\"string\">''</span> }</span><br><span class=\"line\">            moment.locale(<span class=\"string\">'zh-CN'</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> moment(dateTime).format(fmt)</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// main.js 全局</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> mixin <span class=\"keyword\">from</span> <span class=\"string\">'./mixin'</span></span><br><span class=\"line\">Vue.mixin(mixin)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 组件 局部</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> { formatDate } <span class=\"keyword\">from</span> <span class=\"string\">'./mixins'</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> {</span><br><span class=\"line\">  name: <span class=\"string\">'modal'</span>,</span><br><span class=\"line\">  mixins: [formatDate],</span><br><span class=\"line\">  computed: {</span><br><span class=\"line\">      formatDate(){</span><br><span class=\"line\">          <span class=\"comment\">// 调用方法</span></span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.formatDate(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>())</span><br><span class=\"line\">      }</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure></li></ul><h1 id=\"三、插件开发\"><a href=\"#三、插件开发\" class=\"headerlink\" title=\"三、插件开发\"></a>三、插件开发</h1><blockquote><p>本质是一个必须提供一个公开接口的对象或函数，用来扩展 vue 功能</p></blockquote><h2 id=\"插件与组件\"><a href=\"#插件与组件\" class=\"headerlink\" title=\"插件与组件\"></a>插件与组件</h2><ul><li>区别：插件可以实现很多组件无法实现的需求</li><li>关系：插件可以封装组件，组件可以暴露数据给插件</li></ul><h2 id=\"自定义开发\"><a href=\"#自定义开发\" class=\"headerlink\" title=\"自定义开发\"></a>自定义开发</h2><blockquote><p>Vue.use() 会自动调用 install() 并阻止相同插件注册多次</p></blockquote><h3 id=\"常规写法\"><a href=\"#常规写法\" class=\"headerlink\" title=\"常规写法\"></a>常规写法</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// toast.js</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Toast = {};        </span><br><span class=\"line\">Toast.install = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">Vue, options</span>) </span>{ </span><br><span class=\"line\">    Vue.prototype.$msg = <span class=\"string\">'Hello World'</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = Toast;      </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// main.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> Toast <span class=\"keyword\">from</span> <span class=\"string\">'./toast.js'</span>;</span><br><span class=\"line\">Vue.use(Toast);  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.$msg);   <span class=\"comment\">// Hello World</span></span><br></pre></td></tr></tbody></table></figure><h3 id=\"模板写法\"><a href=\"#模板写法\" class=\"headerlink\" title=\"模板写法\"></a>模板写法</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> {</span><br><span class=\"line\">    install: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">Vue, options</span>) </span>{ <span class=\"comment\">//options一般是对象</span></span><br><span class=\"line\">        <span class=\"comment\">// 添加全局方法和属性</span></span><br><span class=\"line\">        Vue.myProperty = <span class=\"string\">'Hello Vue'</span>,    </span><br><span class=\"line\">        Vue.myGlobalMethod = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{ }, </span><br><span class=\"line\">                </span><br><span class=\"line\">        <span class=\"comment\">// 添加全局资源：指令、过滤器、过渡等</span></span><br><span class=\"line\">        Vue.directive(<span class=\"string\">'focus'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">el, binding, vnode, oldVnode</span>)</span>{ })  </span><br><span class=\"line\">        Vue.filter(<span class=\"string\">'formatTime'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>)</span>{ })</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 添加组件选项：混入 Vue 实例本身没有的方法</span></span><br><span class=\"line\">        Vue.mixin({        </span><br><span class=\"line\">            created(){ },</span><br><span class=\"line\">            methods: { }</span><br><span class=\"line\">        }) </span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 添加实例方法：调用时使用 this.$get()</span></span><br><span class=\"line\">        Vue.prototype.$<span class=\"keyword\">get</span> = function(){ }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"全局组件\"><a href=\"#全局组件\" class=\"headerlink\" title=\"全局组件\"></a>全局组件</h2><blockquote><p>将组件以插件形式封装</p></blockquote><h3 id=\"组件封装\"><a href=\"#组件封装\" class=\"headerlink\" title=\"组件封装\"></a>组件封装</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 初始化目录</span></span><br><span class=\"line\">vue init webpack-simple test</span><br><span class=\"line\">cd test && cnpm install  </span><br><span class=\"line\">src              </span><br><span class=\"line\">  ├── App.vue               </span><br><span class=\"line\">  ├── main.js               </span><br><span class=\"line\">  └── lib                 </span><br><span class=\"line\">      ├── Loading.vue  </span><br><span class=\"line\">      └── index.js     </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// index.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> Load <span class=\"keyword\">from</span> <span class=\"string\">'./Loading.vue'</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> Loading = {</span><br><span class=\"line\">    install: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">Vue</span>) </span>{</span><br><span class=\"line\">        Vue.component(<span class=\"string\">'Loading'</span>, Load)</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> <span class=\"built_in\">window</span> !== <span class=\"string\">'undefined'</span> && <span class=\"built_in\">window</span>.Vue) { </span><br><span class=\"line\">    <span class=\"built_in\">window</span>.Vue.use(Loading) </span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> Loading</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// main.js </span></span><br><span class=\"line\"><span class=\"keyword\">import</span> Loading <span class=\"keyword\">from</span> <span class=\"string\">'./lib/index.js'</span></span><br><span class=\"line\">Vue.use(Loading)</span><br></pre></td></tr></tbody></table></figure><h3 id=\"修改配置\"><a href=\"#修改配置\" class=\"headerlink\" title=\"修改配置\"></a>修改配置</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// webpack.config.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = {</span><br><span class=\"line\">    entry: <span class=\"string\">'./src/lib/index.js'</span>,</span><br><span class=\"line\">    output: {</span><br><span class=\"line\">        path: path.resolve(__dirname, <span class=\"string\">'./dist'</span>),</span><br><span class=\"line\">        publicPath: <span class=\"string\">'/dist/'</span>,</span><br><span class=\"line\">        filename: <span class=\"string\">'vue-loading.js'</span>,</span><br><span class=\"line\">        library: <span class=\"string\">'loading'</span>,     <span class=\"comment\">// 指定 require 时的模块名</span></span><br><span class=\"line\">        libraryTarget: <span class=\"string\">'umd'</span>,   <span class=\"comment\">// 生成不同 umd 的代码</span></span><br><span class=\"line\">        umdNamedDefine: <span class=\"literal\">true</span>    <span class=\"comment\">// 构建过程中对 AMD 模块进行命名</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// package.json </span></span><br><span class=\"line\">{</span><br><span class=\"line\">  <span class=\"string\">\"name\"</span>: <span class=\"string\">\"vue-loading\"</span>,         <span class=\"comment\">// 组件名, 不能与已有npm包重复</span></span><br><span class=\"line\">  <span class=\"string\">\"private\"</span>: <span class=\"literal\">false</span>,              <span class=\"comment\">// 组件包改为公用</span></span><br><span class=\"line\">  <span class=\"string\">\"main\"</span>:<span class=\"string\">\"dist/vue-slider.js\"</span>,   <span class=\"comment\">// 配置 import 引入的检索地址</span></span><br><span class=\"line\">  <span class=\"string\">\"repository\"</span>: {                <span class=\"comment\">// 指定代码所在的仓库地址</span></span><br><span class=\"line\">      <span class=\"string\">\"type\"</span>: <span class=\"string\">\"git\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"url\"</span>: <span class=\"string\">\"git+https://github.com/chuang/loading.git\"</span></span><br><span class=\"line\">  },</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h3 id=\"打包发布\"><a href=\"#打包发布\" class=\"headerlink\" title=\"打包发布\"></a>打包发布</h3><ul><li>打包：<code>npm run build</code></li><li>登录：<code>npm login</code></li><li>发布：<code>npm publish</code></li></ul><h3 id=\"安装使用\"><a href=\"#安装使用\" class=\"headerlink\" title=\"安装使用\"></a>安装使用</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 安装插件</span></span><br><span class=\"line\">npm install vue-loading   </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// main.js </span></span><br><span class=\"line\"><span class=\"keyword\">import</span> Loading <span class=\"keyword\">from</span> <span class=\"string\">'vue-loading'</span></span><br><span class=\"line\">Vue.use(Loading)</span><br></pre></td></tr></tbody></table></figure><h1 id=\"四、组件基础\"><a href=\"#四、组件基础\" class=\"headerlink\" title=\"四、组件基础\"></a>四、组件基础</h1><blockquote><p>组件只有挂载到某个 Vue 实例下才会生效，但组件内必须使用箭头函数，否则 this 不指向当前组件</p></blockquote><h2 id=\"基础使用\"><a href=\"#基础使用\" class=\"headerlink\" title=\"基础使用\"></a>基础使用</h2><h3 id=\"书写方式\"><a href=\"#书写方式\" class=\"headerlink\" title=\"书写方式\"></a>书写方式</h3><ul><li><strong>通过 script</strong>：<code>script type=\"text/x-template\" id=\"myCom\"</code></li><li><strong>通过 template</strong>：<code>template id=\"myCom\"</code></li><li><strong>单文件组件</strong>：文件扩展名为 .vue，组成部分为 <code>template、script、style</code></li></ul><h3 id=\"注册方式\"><a href=\"#注册方式\" class=\"headerlink\" title=\"注册方式\"></a>注册方式</h3><ul><li>全局：所有实例和组件都可以直接调用</li><li>局部：只有引用组件的实例或组件可以调用</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 全局注册：my-com</span></span><br><span class=\"line\">Vue.component(<span class=\"string\">'myCom'</span>, { }) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 局部注册：child</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> child <span class=\"keyword\">from</span> <span class=\"string\">'@/components/child'</span> </span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> {</span><br><span class=\"line\">    components:{ child }              </span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h3 id=\"配置选项-1\"><a href=\"#配置选项-1\" class=\"headerlink\" title=\"配置选项\"></a>配置选项</h3><blockquote><p>name、template、props、data、computed、methods、components、created、…</p></blockquote><h3 id=\"对外接口\"><a href=\"#对外接口\" class=\"headerlink\" title=\"对外接口\"></a>对外接口</h3><ul><li><strong>props 状态</strong>：单向传递数据</li><li><strong>events 事件</strong>：触发事件</li><li><strong>slots 片断</strong>：嵌套内容</li></ul><h3 id=\"扩展方法\"><a href=\"#扩展方法\" class=\"headerlink\" title=\"扩展方法\"></a>扩展方法</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 定义一个混合对象</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> myMixin = {</span><br><span class=\"line\">    data(){</span><br><span class=\"line\">        <span class=\"keyword\">return</span> { <span class=\"attr\">num</span>: <span class=\"number\">1</span> }</span><br><span class=\"line\">    },</span><br><span class=\"line\">    methods: {</span><br><span class=\"line\">        hello() {</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'hello from mixin'</span>)</span><br><span class=\"line\">        }</span><br><span class=\"line\">    },</span><br><span class=\"line\">    created() {</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.hello()</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 组件中引用</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> {myMixin} <span class=\"keyword\">from</span> <span class=\"string\">\"./mixin.js\"</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Component = Vue.extend({</span><br><span class=\"line\">    mixins: [myMixin]</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h2 id=\"内置指令\"><a href=\"#内置指令\" class=\"headerlink\" title=\"内置指令\"></a>内置指令</h2><ul><li>数据渲染：<code>&#123;&#123;&#125;&#125;、v-text、v-html</code></li><li>条件渲染：<code>v-if、v-else</code></li><li>循环渲染：<ul><li>数组：<code>v-for=\"(item, index) in arr\" :key=\"index\"</code></li><li>对象：<code>v-for=\"(item, key, index) of obj\" :key=\"index\"</code></li></ul></li><li>事件绑定<ul><li>普通：<code>v-on:click = \"todo\"</code></li><li>缩写：<code>@click = \"todo\"</code></li><li>修饰符：<a href=\"mailto:`@click.stop.self\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">`@click.stop.self</a>、@keyup.stop.enter`<ul><li>阻止冒泡：stop</li><li>阻止默认：prevent</li><li>执行一次：once</li></ul></li></ul></li><li>动态绑定：<code>v-bind:</code>，注意可以省略 v-bind<ul><li>class：<ul><li>:class=”[‘a’, ‘b’]”</li><li>:class=”[ true ? ‘a’: ‘b’]”</li><li>:class=”{ ‘active’: isActive(id) }”</li></ul></li><li>style<ul><li>:style=”{color: ‘red’}”</li><li>:style=”[{color: ‘red’}, {fontSize: ‘16px’}]”</li></ul></li></ul></li><li>双向绑定<ul><li>绑定：<code>v-model、v-model.trim</code></li><li>修饰符<ul><li>trim：首尾空格过滤</li><li>lazy：监听change事件</li><li>number：字符串转为数字</li></ul></li></ul></li><li>性能优化<ul><li>只渲染一次：<code>v-once</code></li><li>防止页面闪烁：<code>v-cloak</code></li><li>不输出 data：<code>v-pre</code></li></ul></li></ul><h2 id=\"组件通信\"><a href=\"#组件通信\" class=\"headerlink\" title=\"组件通信\"></a>组件通信</h2><h3 id=\"父子组件通信\"><a href=\"#父子组件通信\" class=\"headerlink\" title=\"父子组件通信\"></a>父子组件通信</h3><ul><li>子传父<ul><li>法一：通过ref属性在父组件中直接取得子组件的数据</li><li>法二：子组件 $emit() 触发自定义事件，父组件 $on() 监听<ul><li>父组件：<code>child @updateList = \"updateList\"</code></li><li>子组件：<code>this.$emit(\"updateList\", data)</code></li></ul></li></ul></li><li><p>父传子：在子组件中通过 props 定义父组件传递的属性</p><ul><li>父组件：child name=”Tom” :songs=”songs” :age=”age”</li><li>子组件：props 接收属性如下</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> {</span><br><span class=\"line\">    <span class=\"comment\">// 简洁写法</span></span><br><span class=\"line\">    props: [<span class=\"string\">\"name\"</span>, <span class=\"string\">\"songs\"</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 普通写法</span></span><br><span class=\"line\">    props: {</span><br><span class=\"line\">        name:{  <span class=\"comment\">// 静态数据</span></span><br><span class=\"line\">            type: <span class=\"built_in\">String</span></span><br><span class=\"line\">        }</span><br><span class=\"line\">        songs:{  <span class=\"comment\">// 动态数据</span></span><br><span class=\"line\">            type: <span class=\"built_in\">Array</span></span><br><span class=\"line\">        },</span><br><span class=\"line\">        age:{     <span class=\"comment\">// 动态数据验证</span></span><br><span class=\"line\">            type: <span class=\"built_in\">Number</span>,   </span><br><span class=\"line\">            required: <span class=\"literal\">true</span>,</span><br><span class=\"line\">            <span class=\"keyword\">default</span>(){     <span class=\"comment\">// 默认值, 可直接1000 </span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> { <span class=\"attr\">time</span>: <span class=\"number\">1000</span> } </span><br><span class=\"line\">            },  </span><br><span class=\"line\">            validator(val){  <span class=\"comment\">// 自定义验证</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> val > <span class=\"number\">0</span></span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure></li></ul><h3 id=\"双向绑定\"><a href=\"#双向绑定\" class=\"headerlink\" title=\"双向绑定\"></a>双向绑定</h3><blockquote><p>同步父子组件数据，注意不要在子组件中修改 props 接收的数据</p></blockquote><ul><li>普通写法<ul><li>父组件监听自定义事件：<code>child @update=\"val => pmsg = val\" :msg=\"pmsg\"</code></li><li>子组件触发事件：<code>props: { msg: String }、this.$emit('update', newVal)</code></li></ul></li><li>使用 sync<ul><li>父组件<ul><li>写法：<code>child :startDate.sync=\"startDate\"</code></li><li>扩展：<code>child :startDate=\"bar\" @update:startDate=\"val => startDate = val\"</code></li></ul></li><li>子组件<ul><li>属性：<code>props: { startDate: String }</code></li><li>事件：<code>this.$emit(\"update:startDate\", startDate)</code></li></ul></li></ul></li></ul><h3 id=\"祖孙组件通信\"><a href=\"#祖孙组件通信\" class=\"headerlink\" title=\"祖孙组件通信\"></a>祖孙组件通信</h3><blockquote><p>$attrs 用来简化组件和后代组件的数据传递</p></blockquote><ul><li>属性<ul><li><strong>$attrs</strong>：传递不被 prop 识别的属性 (class和style除外)</li><li><strong>$listeners</strong>：传递组件的事件 (.native除外)</li><li><strong>inheritAttrs</strong>：控制 vue 对非 prop 特性默认行为<br>true：默认将组件中不被 props 识别的属性绑定到根元素<br>false：可以通过 v-bind 显性绑定到非根元素</li></ul></li><li><strong>com.vue</strong>：child sex=”男”</li><li><p><strong>child.vue</strong>：grand v-bind=”$attrs” v-on=”$listeners”</p><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> {</span><br><span class=\"line\">    <span class=\"comment\">// props 没有注册 sex</span></span><br><span class=\"line\">    computed: {</span><br><span class=\"line\">        sex(){</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.$attrs.sex</span><br><span class=\"line\">        }</span><br><span class=\"line\">    },</span><br><span class=\"line\">    <span class=\"comment\">// 去掉默认行为</span></span><br><span class=\"line\">    inheritAttrs: <span class=\"literal\">false</span></span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure></li><li><p><strong>grand.vue</strong></p><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> {</span><br><span class=\"line\">    computed: {</span><br><span class=\"line\">        sex(){</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.$attrs.sex</span><br><span class=\"line\">        }</span><br><span class=\"line\">    },</span><br><span class=\"line\">    inheritAttrs: <span class=\"literal\">false</span></span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure></li></ul><h3 id=\"全局通信\"><a href=\"#全局通信\" class=\"headerlink\" title=\"全局通信\"></a>全局通信</h3><ul><li>使用空实例作为事件中心<ol><li>根组件中添加空实例，允许所有组件调用</li><li>某个组件中定义调用事件触发的方法</li><li>另一个组件中绑定事件监听，并在组件销毁前解除绑定</li></ol></li><li>借助Vuex的全局状态共享</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// main.js</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> Vue({ </span><br><span class=\"line\">    data: { </span><br><span class=\"line\">        eventHub: <span class=\"keyword\">new</span> Vue() </span><br><span class=\"line\">    } </span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// com1 </span></span><br><span class=\"line\"><span class=\"keyword\">this</span>.$root.eventHub.$emit(<span class=\"string\">'updateList'</span>, <span class=\"literal\">true</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// com2</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> {</span><br><span class=\"line\">    created(){</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.$root.eventHub.$on(<span class=\"string\">'updateList'</span>, value => {</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(value)</span><br><span class=\"line\">        })</span><br><span class=\"line\">    },</span><br><span class=\"line\">    beforeDestroy() {</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.$root.eventHub.$off(<span class=\"string\">'to_sibiling'</span>)</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"template-标签\"><a href=\"#template-标签\" class=\"headerlink\" title=\"template 标签\"></a>template 标签</h2><blockquote><p>可看作一个不可见的包裹元素，主要用于分组的条件判断和列表渲染</p></blockquote><div align=\"center\"><br><img src=\"images/vue/vue-temp.png\" alt=\"Vue template\"><br></div><h2 id=\"内置组件\"><a href=\"#内置组件\" class=\"headerlink\" title=\"内置组件\"></a>内置组件</h2><ul><li><strong>transition</strong>：单个元素/组件的过渡效果</li><li><strong>transition-group</strong>：多个元素/组件的过渡效果</li><li><strong>component</strong>：支持两个属性 is、inline-template</li><li><strong>keep-alive</strong>：保留组件状态或避免重新渲染</li><li><strong>slot</strong>：替换 slot 元素实现内容嵌套</li></ul><h2 id=\"特殊特性\"><a href=\"#特殊特性\" class=\"headerlink\" title=\"特殊特性\"></a>特殊特性</h2><ul><li><strong>key</strong><ul><li>管理可复用的元素</li><li>减少运算来提高循环性能：<code>v-for=\"item in items\" :key=\"item.id\"</code></li></ul></li><li><strong>is</strong><ul><li>使用 v-bind:is 实现动态组件的切换效果</li><li>用于在 ul 等受限制的 html 元素中绑定组件：<code>li is=\"com1\"</code></li></ul></li><li><strong>slot</strong><ul><li>配合 slot 内置组件实现嵌套内容的相应显示</li><li>没有 slot 时不显示嵌套内容，多个 slot 时需使用具名插槽 (添加 name 属性)</li></ul></li><li><strong>ref</strong><ul><li>获取当前 DOM 元素：<code>li ref=\"cur\"、this.$refs.cur</code></li><li>获取子组件实例对象：<code>my-com ref=\"com\"、this.$refs.com</code></li></ul></li></ul><div align=\"center\"><br><img src=\"images/vue/vue-special.png\" alt=\"Vue special\"><br></div><!-- rebuild by neat --></body></html>","site":{"data":{"next":{"override":false,"cache":{"enable":true},"favicon":{"small":"/images/favicon-16.ico","medium":"/images/favicon-32.ico","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"rss":"/atom.xml","footer":{"since":2019,"icon":{"name":"snowflake-o","animated":false,"color":"#808080"},"copyright":"chuangge","powered":{"enable":false,"version":true},"theme":{"enable":false,"version":true},"beian":{"enable":false,"icp":null}},"creative_commons":{"license":"by-nc-sa","sidebar":false,"post":false},"canonical":true,"seo":false,"index_with_subtitle":false,"exturl":false,"menu":{"home":"/ || home  //首页","tags":"/tags/ || tags  //标签","categories":"/categories/ || th   //分类","archives":"/archives/ || archive //归档"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":{"GitHub":"https://github.com/ || github","StackOverflow":"https://stackoverflow.com/ || stack-overflow"},"social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"友情链接","links_layout":"inline","links":{"个人简历":"https://chuanggefighting.github.io/project/","印记中文":"https://www.docschina.org/","在线工具":"http://tool.lu/","Learn Anything":"https://learn-anything.xyz/"},"avatar":{"url":"/images/chuang.png","rounded":true,"opacity":1,"rotated":true},"toc":{"enable":true,"number":true,"wrap":false,"max_depth":6},"sidebar":{"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"read_more_btn":true,"post_meta":{"item_text":true,"created_at":true,"updated_at":{"enabled":true,"another_day":true},"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":true,"awl":4,"wpm":275},"codeblock":{"border_radius":null,"copy_button":{"enable":false,"show_result":false}},"reward":{"enable":false},"related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_edit":{"enable":false,"url":"https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name"},"disable_baidu_tranformation":false,"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"font":{"enable":true,"host":"//fonts.proxy.ustclug.org","global":{"external":true,"family":"Lato","size":16},"headings":{"external":true,"family":"Roboto Slab","size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":"Lobster Two","size":24},"codes":{"external":true,"family":"Roboto Mono","size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css","copy_tex":{"enable":false,"copy_tex_js":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js","copy_tex_css":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css"}}},"pdf":{"enable":false,"per_page":true,"height":"500px","pdfobject":{"cdn":"//cdn.jsdelivr.net/npm/pdfobject@2.1.1/pdfobject.min.js"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":true,"appid":"snOvapuSplYTVflf5p9Ml9JX-gzGzoHsz","appkey":"5ABGdfyEdAtu6lTXdGdo7hf9","notify":false,"verify":false,"placeholder":"ヾﾉ≧∀≦)o 来呀！吐槽一番吧！","avatar":"mm","guest_info":"nick,mail,link","pageSize":10,"visitor":false,"comment_count":true},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"gitalk":{"enable":false,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true},"needmoreshare2":{"enable":true,"postbottom":{"enable":true,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null,"security":false,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":true,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":true,"pace_theme":"pace-theme-center-simple","canvas_nest":{"enable":true,"onmobile":true,"color":"0,0,255","opacity":0.5,"zIndex":-1,"count":99},"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"canvas_nest_nomobile":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"leancloud":null,"valine":null,"gitalk_js":null,"gitalk_css":null,"md5":null},"css":"css","js":"js","images":"images","passage_end_tag":{"enabled":true},"daovoice":true,"daovoice_app_id":"2ed51855"}}},"excerpt":"","more":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><h1 id=\"一、实例对象\"><a href=\"#一、实例对象\" class=\"headerlink\" title=\"一、实例对象\"></a>一、实例对象</h1><blockquote><p>一个包含数据、方法和组件的 vue 实例对象</p></blockquote><h2 id=\"初始化\"><a href=\"#初始化\" class=\"headerlink\" title=\"初始化\"></a>初始化</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1、直接创建</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> app1 = <span class=\"keyword\">new</span> Vue(&#123;</span><br><span class=\"line\">  el:<span class=\"string\">\"#app1\"</span>,</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2、首先创建无挂载点的实例</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> app2 = <span class=\"keyword\">new</span> Vue(&#123;    </span><br><span class=\"line\">  data: &#123;          <span class=\"comment\">// 对象</span></span><br><span class=\"line\">      msg:<span class=\"string\">\"app2\"</span> </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">app2.$mount(<span class=\"string\">'#app2'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3、使用基础 Vue 构造器创建\"子类\"</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> app3 = Vue.extend(&#123;</span><br><span class=\"line\">  data: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;   <span class=\"comment\">// 函数</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span>&#123; </span><br><span class=\"line\">          msg:<span class=\"string\">\"app3\"</span> </span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)    </span><br><span class=\"line\"><span class=\"keyword\">new</span> app3().$mount(<span class=\"string\">'#app3'</span>);</span><br></pre></td></tr></table></figure><h2 id=\"配置选项\"><a href=\"#配置选项\" class=\"headerlink\" title=\"配置选项\"></a>配置选项</h2><blockquote><p>如果对 data、created 等属性使用箭头函数，this 将是 undefined</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span><br><span class=\"line\">  el: <span class=\"string\">\"#app\"</span>,        <span class=\"comment\">// 挂载元素</span></span><br><span class=\"line\">  data: &#123;            <span class=\"comment\">// 挂载数据</span></span><br><span class=\"line\">      user: &#123;</span><br><span class=\"line\">          name: <span class=\"string\">\"tom\"</span></span><br><span class=\"line\">          age: <span class=\"number\">20</span></span><br><span class=\"line\">      &#125;  </span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  computed: &#123; &#125;,     <span class=\"comment\">// 计算属性：派生所需数据</span></span><br><span class=\"line\">  methods: &#123; &#125;,      <span class=\"comment\">// 事件绑定：事件名不区分大小写)</span></span><br><span class=\"line\">  components: &#123;      <span class=\"comment\">// 组件注册(组件名不要和已有标签冲突)</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  watch:&#123;           <span class=\"comment\">// 监听数据</span></span><br><span class=\"line\">      </span><br><span class=\"line\">      user: &#123;       <span class=\"comment\">// 深度监听(可监听到对象内部属性变化)</span></span><br><span class=\"line\">          handler: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">val, oldval</span>)</span>&#123; &#125;,  </span><br><span class=\"line\">          deep: <span class=\"literal\">true</span>,     </span><br><span class=\"line\">          immediate: <span class=\"literal\">true</span>    </span><br><span class=\"line\">      &#125;,  </span><br><span class=\"line\">      <span class=\"string\">\"user.name\"</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">val, oldval</span>)</span>&#123;  <span class=\"comment\">// 必须加引号  </span></span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(val + <span class=\"string\">\"a\"</span>)  </span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      inputVal:&#123;    <span class=\"comment\">// 组件创建和 input 变化时获取列表</span></span><br><span class=\"line\">          handler: <span class=\"string\">'getList'</span>,</span><br><span class=\"line\">          immediate: <span class=\"literal\">true</span>  </span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      $route(to, <span class=\"keyword\">from</span>)&#123;         <span class=\"comment\">// 监听子组件路由变化</span></span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(to.name)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  filters: &#123;          <span class=\"comment\">// 过滤器：&#123;&#123;user.age | sum&#125;&#125; </span></span><br><span class=\"line\">      sum: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> value &gt; <span class=\"number\">0</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  mounted () &#123;       <span class=\"comment\">// 监听</span></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.$root.eventHub.$on(<span class=\"string\">'updateDash'</span>, <span class=\"keyword\">this</span>.getList)</span><br><span class=\"line\">      <span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">'scroll'</span>, <span class=\"keyword\">this</span>.handleScroll)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  beforeDestroy()&#123;  <span class=\"comment\">// 解绑</span></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.$root.eventHub.$off(<span class=\"string\">'updateDash'</span>)</span><br><span class=\"line\">      <span class=\"built_in\">window</span>.removeEventListener(<span class=\"string\">'scroll'</span>, <span class=\"keyword\">this</span>.handleScroll)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h2 id=\"生命周期\"><a href=\"#生命周期\" class=\"headerlink\" title=\"生命周期\"></a>生命周期</h2><blockquote><p>Vue 实例由创建到销毁的完整运行一次的过程中会触发的函数</p></blockquote><h3 id=\"运行流程\"><a href=\"#运行流程\" class=\"headerlink\" title=\"运行流程\"></a>运行流程</h3><div align=\"center\"><br><img src=\"images/vue/vue_life.png\" alt=\"Vue 生命周期\"><br></div><h3 id=\"常用处理\"><a href=\"#常用处理\" class=\"headerlink\" title=\"常用处理\"></a>常用处理</h3><ul><li><strong>beforeCreate</strong>：初始化非响应式变量，比如添加 Loading</li><li><strong>created</strong>：页面初始化，比如关闭 Loading 和 Ajax 请求</li><li><strong>mounted</strong>：获取和操作 Dom 元素和 Ajax 请求</li><li><strong>updated</strong>：统一处理数据，但可能陷入死循环</li><li><strong>beforeDestroy</strong>：销毁定时器、解绑全局事件、销毁插件对象等操作</li></ul><h2 id=\"常用方法\"><a href=\"#常用方法\" class=\"headerlink\" title=\"常用方法\"></a>常用方法</h2><ul><li><strong>app.$watch</strong>：监听</li><li><strong>app.$set</strong>：添加属性，全局 Vue.set 的别名</li><li><strong>app.$delete</strong>：删除属性，全局 Vue.delete 的别名</li><li><strong>app.$on</strong>：监听自定义事件</li><li><strong>app.$emit</strong>：触发事件</li><li><strong>app.$off</strong>：移除事件</li><li><strong>app.$mount</strong>：手动挂载</li><li><strong>app.$forceUpdate</strong>：重新渲染</li><li><strong>app.$nextTick</strong>：将回调延迟到下次 DOM 更新后执行</li><li><strong>app.$destroy</strong>：完全销毁实例</li></ul><h2 id=\"nextTick\"><a href=\"#nextTick\" class=\"headerlink\" title=\"$nextTick\"></a>$nextTick</h2><blockquote><p>Vue 数据驱动视图更新是异步的，即修改数据时视图不会立刻更新，而是等同一事件循环中的所有数据变化完成后再统一进行视图更新</p></blockquote><div style=\"text-indent:2em\">主线程完成同步环境执行，读取任务队列 并提取队首的任务之后放入主线程中执行，不断重复该操作的过程就是 事件循环。主线程每次读取任务队列操作时是一个事件循环的开始，异步 callback 不可能处在同一事件循环中。而 nextTick 的触发时机：同一事件循环中的代码执行完毕 –&gt; DOM 更新 -&gt; nextTick callback 触发，所以它的 应用场景就是需要在视图更新之后 基于新视图进行操作时，常见如下：</div><ul><li>created 钩子中操作 DOM，因为此时的 DOM 其实并未渲染</li><li>在数据变化后执行某个操作，而且该操作需要使用随数据改变而改变的最新 DOM 结构，如获取表格数据更新后的高度</li></ul><h1 id=\"二、全局-API\"><a href=\"#二、全局-API\" class=\"headerlink\" title=\"二、全局 API\"></a>二、全局 API</h1><blockquote><p>指令和组件命名时不能使用标签和关键字，而且尽量不使用驼峰命名 (因为 webpack 编译后会统一变为小写)。如果有大写字母，则使用时必须都改为小写并添加 v-、-</p></blockquote><h2 id=\"常用汇总\"><a href=\"#常用汇总\" class=\"headerlink\" title=\"常用汇总\"></a>常用汇总</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 过滤器：必须放在 Vue 实例化前面：&#123;&#123;data | formatDate('yyyy-MM-dd hh:mm:ss')&#125;&#125;</span></span><br><span class=\"line\">Vue.filter(<span class=\"string\">'formatDate'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value, fmt</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> date = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(value);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> obj = &#123;</span><br><span class=\"line\">        <span class=\"string\">'M+'</span>: date.getMonth() + <span class=\"number\">1</span>, </span><br><span class=\"line\">        <span class=\"string\">'d+'</span>: date.getDate(), </span><br><span class=\"line\">        <span class=\"string\">'h+'</span>: date.getHours(), </span><br><span class=\"line\">        <span class=\"string\">'m+'</span>: date.getMinutes(), </span><br><span class=\"line\">        <span class=\"string\">'s+'</span>: date.getSeconds(), </span><br><span class=\"line\">        <span class=\"string\">'q+'</span>: <span class=\"built_in\">Math</span>.floor((date.getMonth() + <span class=\"number\">3</span>) / <span class=\"number\">3</span>), <span class=\"comment\">// 季度</span></span><br><span class=\"line\">        <span class=\"string\">'S'</span>: date.getMilliseconds() <span class=\"comment\">// 毫秒</span></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// 匹配年</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"regexp\">/(y+)/</span>.test(fmt)) &#123;</span><br><span class=\"line\">        fmt = fmt.replace(<span class=\"built_in\">RegExp</span>.$<span class=\"number\">1</span>, (date.getFullYear() + <span class=\"string\">''</span>).substr(<span class=\"number\">4</span> - <span class=\"built_in\">RegExp</span>.$<span class=\"number\">1.</span>length));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 匹配月日 时 分 秒等</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> item <span class=\"keyword\">in</span> obj) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(<span class=\"string\">'('</span> + item + <span class=\"string\">')'</span>).test(fmt)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> str = <span class=\"string\">''</span> + obj[item];</span><br><span class=\"line\">        fmt = fmt.replace(<span class=\"built_in\">RegExp</span>.$<span class=\"number\">1</span>, (<span class=\"built_in\">RegExp</span>.$<span class=\"number\">1.</span>length === <span class=\"number\">1</span>) ? str : ((<span class=\"string\">'00'</span> + str).substr(str.length)));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> fmt;</span><br><span class=\"line\">&#125;)          </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 指令：input v-auto-focus</span></span><br><span class=\"line\">Vue.directive(<span class=\"string\">\"autoFocus \"</span>, &#123;        </span><br><span class=\"line\">    bind(el, binding, vnode)&#123; </span><br><span class=\"line\">        <span class=\"comment\">// 创建：指令第一次绑定到元素时调用，比如添加事件监听器等</span></span><br><span class=\"line\">    &#125;,      </span><br><span class=\"line\">    inserted(el)&#123;    </span><br><span class=\"line\">        el.focus()</span><br><span class=\"line\">        <span class=\"comment\">// 插入：当元素被插入到 DOM</span></span><br><span class=\"line\">    &#125;,      </span><br><span class=\"line\">    update(el, binding, vnode, oldVnode)&#123; </span><br><span class=\"line\">        <span class=\"comment\">// 更新：当元素所在模板更新时</span></span><br><span class=\"line\">    &#125;,     </span><br><span class=\"line\">    componentUpdate(el, binding, vnode, oldVnode)&#123; </span><br><span class=\"line\">        <span class=\"comment\">// 当元素所在模板完成一次更新周期时</span></span><br><span class=\"line\">    &#125;,   </span><br><span class=\"line\">    unbind(el, binding, vnode)&#123;          </span><br><span class=\"line\">        <span class=\"comment\">// 解除绑定时只调用一次，比如移除 bind 时绑定的事件监听器</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 方法</span></span><br><span class=\"line\">Vue.prototype.setCookie = <span class=\"function\">(<span class=\"params\">name, value, expiredays</span>) =&gt;</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">var</span> exdate = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();　　　　</span><br><span class=\"line\">exdate.setDate(exdate.getDate() + expiredays);　　　　</span><br><span class=\"line\"><span class=\"built_in\">document</span>.cookie = c_name + <span class=\"string\">\"=\"</span> + <span class=\"built_in\">escape</span>(value) + ((expiredays == <span class=\"literal\">null</span>) ? <span class=\"string\">\"\"</span> : <span class=\"string\">\";expires=\"</span> + exdate.toGMTString());</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 组件</span></span><br><span class=\"line\">Vue.component(<span class=\"string\">'myCom'</span>, &#123; &#125;)    <span class=\"comment\">// 语法糖方法</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> myCom2 = Vue.extend(&#123; &#125;)   <span class=\"comment\">// 构造器方法 </span></span><br><span class=\"line\">Vue.component(<span class=\"string\">'myCom2'</span>, myCom2) </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 插件：相当于 MyPlugin.install(Vue)</span></span><br><span class=\"line\">Vue.use(MyPlugin)</span><br><span class=\"line\">Vue.use(MyPlugin, &#123; <span class=\"attr\">someOption</span>: <span class=\"literal\">true</span> &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 混入：为自定义对象注入处理逻辑但会影响之后的 vue 实例</span></span><br><span class=\"line\">Vue.mixin(&#123; &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 推迟回调</span></span><br><span class=\"line\">Vue.nextTick()</span><br></pre></td></tr></table></figure><h2 id=\"mixins\"><a href=\"#mixins\" class=\"headerlink\" title=\"mixins\"></a>mixins</h2><ul><li><strong>组件引用</strong>：相当于在父组件内开辟了一块单独空间给子组件，本质上两者是相对独立的</li><li><p><strong>mixins 混合</strong>：将子组件内部的属性和方法全部扩充到父组件，从而实现组件的复用</p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// mixin.js</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">    methods: &#123;</span><br><span class=\"line\">        formatDate (dateTime, fmt = <span class=\"string\">'YYYY年M月DD日 HH:mm:ss'</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!dateTime) &#123; <span class=\"keyword\">return</span> <span class=\"string\">''</span> &#125;</span><br><span class=\"line\">            moment.locale(<span class=\"string\">'zh-CN'</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> moment(dateTime).format(fmt)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// main.js 全局</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> mixin <span class=\"keyword\">from</span> <span class=\"string\">'./mixin'</span></span><br><span class=\"line\">Vue.mixin(mixin)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 组件 局部</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; formatDate &#125; <span class=\"keyword\">from</span> <span class=\"string\">'./mixins'</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'modal'</span>,</span><br><span class=\"line\">  mixins: [formatDate],</span><br><span class=\"line\">  computed: &#123;</span><br><span class=\"line\">      formatDate()&#123;</span><br><span class=\"line\">          <span class=\"comment\">// 调用方法</span></span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.formatDate(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>())</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li></ul><h1 id=\"三、插件开发\"><a href=\"#三、插件开发\" class=\"headerlink\" title=\"三、插件开发\"></a>三、插件开发</h1><blockquote><p>本质是一个必须提供一个公开接口的对象或函数，用来扩展 vue 功能</p></blockquote><h2 id=\"插件与组件\"><a href=\"#插件与组件\" class=\"headerlink\" title=\"插件与组件\"></a>插件与组件</h2><ul><li>区别：插件可以实现很多组件无法实现的需求</li><li>关系：插件可以封装组件，组件可以暴露数据给插件</li></ul><h2 id=\"自定义开发\"><a href=\"#自定义开发\" class=\"headerlink\" title=\"自定义开发\"></a>自定义开发</h2><blockquote><p>Vue.use() 会自动调用 install() 并阻止相同插件注册多次</p></blockquote><h3 id=\"常规写法\"><a href=\"#常规写法\" class=\"headerlink\" title=\"常规写法\"></a>常规写法</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// toast.js</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Toast = &#123;&#125;;        </span><br><span class=\"line\">Toast.install = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">Vue, options</span>) </span>&#123; </span><br><span class=\"line\">    Vue.prototype.$msg = <span class=\"string\">'Hello World'</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = Toast;      </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// main.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> Toast <span class=\"keyword\">from</span> <span class=\"string\">'./toast.js'</span>;</span><br><span class=\"line\">Vue.use(Toast);  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.$msg);   <span class=\"comment\">// Hello World</span></span><br></pre></td></tr></table></figure><h3 id=\"模板写法\"><a href=\"#模板写法\" class=\"headerlink\" title=\"模板写法\"></a>模板写法</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">    install: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">Vue, options</span>) </span>&#123; <span class=\"comment\">//options一般是对象</span></span><br><span class=\"line\">        <span class=\"comment\">// 添加全局方法和属性</span></span><br><span class=\"line\">        Vue.myProperty = <span class=\"string\">'Hello Vue'</span>,    </span><br><span class=\"line\">        Vue.myGlobalMethod = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; &#125;, </span><br><span class=\"line\">                </span><br><span class=\"line\">        <span class=\"comment\">// 添加全局资源：指令、过滤器、过渡等</span></span><br><span class=\"line\">        Vue.directive(<span class=\"string\">'focus'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">el, binding, vnode, oldVnode</span>)</span>&#123; &#125;)  </span><br><span class=\"line\">        Vue.filter(<span class=\"string\">'formatTime'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>)</span>&#123; &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 添加组件选项：混入 Vue 实例本身没有的方法</span></span><br><span class=\"line\">        Vue.mixin(&#123;        </span><br><span class=\"line\">            created()&#123; &#125;,</span><br><span class=\"line\">            methods: &#123; &#125;</span><br><span class=\"line\">        &#125;) </span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 添加实例方法：调用时使用 this.$get()</span></span><br><span class=\"line\">        Vue.prototype.$<span class=\"keyword\">get</span> = function()&#123; &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"全局组件\"><a href=\"#全局组件\" class=\"headerlink\" title=\"全局组件\"></a>全局组件</h2><blockquote><p>将组件以插件形式封装</p></blockquote><h3 id=\"组件封装\"><a href=\"#组件封装\" class=\"headerlink\" title=\"组件封装\"></a>组件封装</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 初始化目录</span></span><br><span class=\"line\">vue init webpack-simple test</span><br><span class=\"line\">cd test &amp;&amp; cnpm install  </span><br><span class=\"line\">src              </span><br><span class=\"line\">  ├── App.vue               </span><br><span class=\"line\">  ├── main.js               </span><br><span class=\"line\">  └── lib                 </span><br><span class=\"line\">      ├── Loading.vue  </span><br><span class=\"line\">      └── index.js     </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// index.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> Load <span class=\"keyword\">from</span> <span class=\"string\">'./Loading.vue'</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> Loading = &#123;</span><br><span class=\"line\">    install: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">Vue</span>) </span>&#123;</span><br><span class=\"line\">        Vue.component(<span class=\"string\">'Loading'</span>, Load)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> <span class=\"built_in\">window</span> !== <span class=\"string\">'undefined'</span> &amp;&amp; <span class=\"built_in\">window</span>.Vue) &#123; </span><br><span class=\"line\">    <span class=\"built_in\">window</span>.Vue.use(Loading) </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> Loading</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// main.js </span></span><br><span class=\"line\"><span class=\"keyword\">import</span> Loading <span class=\"keyword\">from</span> <span class=\"string\">'./lib/index.js'</span></span><br><span class=\"line\">Vue.use(Loading)</span><br></pre></td></tr></table></figure><h3 id=\"修改配置\"><a href=\"#修改配置\" class=\"headerlink\" title=\"修改配置\"></a>修改配置</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// webpack.config.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    entry: <span class=\"string\">'./src/lib/index.js'</span>,</span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">        path: path.resolve(__dirname, <span class=\"string\">'./dist'</span>),</span><br><span class=\"line\">        publicPath: <span class=\"string\">'/dist/'</span>,</span><br><span class=\"line\">        filename: <span class=\"string\">'vue-loading.js'</span>,</span><br><span class=\"line\">        library: <span class=\"string\">'loading'</span>,     <span class=\"comment\">// 指定 require 时的模块名</span></span><br><span class=\"line\">        libraryTarget: <span class=\"string\">'umd'</span>,   <span class=\"comment\">// 生成不同 umd 的代码</span></span><br><span class=\"line\">        umdNamedDefine: <span class=\"literal\">true</span>    <span class=\"comment\">// 构建过程中对 AMD 模块进行命名</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// package.json </span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"name\"</span>: <span class=\"string\">\"vue-loading\"</span>,         <span class=\"comment\">// 组件名, 不能与已有npm包重复</span></span><br><span class=\"line\">  <span class=\"string\">\"private\"</span>: <span class=\"literal\">false</span>,              <span class=\"comment\">// 组件包改为公用</span></span><br><span class=\"line\">  <span class=\"string\">\"main\"</span>:<span class=\"string\">\"dist/vue-slider.js\"</span>,   <span class=\"comment\">// 配置 import 引入的检索地址</span></span><br><span class=\"line\">  <span class=\"string\">\"repository\"</span>: &#123;                <span class=\"comment\">// 指定代码所在的仓库地址</span></span><br><span class=\"line\">      <span class=\"string\">\"type\"</span>: <span class=\"string\">\"git\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"url\"</span>: <span class=\"string\">\"git+https://github.com/chuang/loading.git\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h3 id=\"打包发布\"><a href=\"#打包发布\" class=\"headerlink\" title=\"打包发布\"></a>打包发布</h3><ul><li>打包：<code>npm run build</code></li><li>登录：<code>npm login</code></li><li>发布：<code>npm publish</code></li></ul><h3 id=\"安装使用\"><a href=\"#安装使用\" class=\"headerlink\" title=\"安装使用\"></a>安装使用</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 安装插件</span></span><br><span class=\"line\">npm install vue-loading   </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// main.js </span></span><br><span class=\"line\"><span class=\"keyword\">import</span> Loading <span class=\"keyword\">from</span> <span class=\"string\">'vue-loading'</span></span><br><span class=\"line\">Vue.use(Loading)</span><br></pre></td></tr></table></figure><h1 id=\"四、组件基础\"><a href=\"#四、组件基础\" class=\"headerlink\" title=\"四、组件基础\"></a>四、组件基础</h1><blockquote><p>组件只有挂载到某个 Vue 实例下才会生效，但组件内必须使用箭头函数，否则 this 不指向当前组件</p></blockquote><h2 id=\"基础使用\"><a href=\"#基础使用\" class=\"headerlink\" title=\"基础使用\"></a>基础使用</h2><h3 id=\"书写方式\"><a href=\"#书写方式\" class=\"headerlink\" title=\"书写方式\"></a>书写方式</h3><ul><li><strong>通过 script</strong>：<code>script type=&quot;text/x-template&quot; id=&quot;myCom&quot;</code></li><li><strong>通过 template</strong>：<code>template id=&quot;myCom&quot;</code></li><li><strong>单文件组件</strong>：文件扩展名为 .vue，组成部分为 <code>template、script、style</code></li></ul><h3 id=\"注册方式\"><a href=\"#注册方式\" class=\"headerlink\" title=\"注册方式\"></a>注册方式</h3><ul><li>全局：所有实例和组件都可以直接调用</li><li>局部：只有引用组件的实例或组件可以调用</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 全局注册：my-com</span></span><br><span class=\"line\">Vue.component(<span class=\"string\">'myCom'</span>, &#123; &#125;) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 局部注册：child</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> child <span class=\"keyword\">from</span> <span class=\"string\">'@/components/child'</span> </span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">    components:&#123; child &#125;              </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h3 id=\"配置选项-1\"><a href=\"#配置选项-1\" class=\"headerlink\" title=\"配置选项\"></a>配置选项</h3><blockquote><p>name、template、props、data、computed、methods、components、created、…</p></blockquote><h3 id=\"对外接口\"><a href=\"#对外接口\" class=\"headerlink\" title=\"对外接口\"></a>对外接口</h3><ul><li><strong>props 状态</strong>：单向传递数据</li><li><strong>events 事件</strong>：触发事件</li><li><strong>slots 片断</strong>：嵌套内容</li></ul><h3 id=\"扩展方法\"><a href=\"#扩展方法\" class=\"headerlink\" title=\"扩展方法\"></a>扩展方法</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 定义一个混合对象</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> myMixin = &#123;</span><br><span class=\"line\">    data()&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123; <span class=\"attr\">num</span>: <span class=\"number\">1</span> &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    methods: &#123;</span><br><span class=\"line\">        hello() &#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'hello from mixin'</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    created() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.hello()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 组件中引用</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;myMixin&#125; <span class=\"keyword\">from</span> <span class=\"string\">\"./mixin.js\"</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Component = Vue.extend(&#123;</span><br><span class=\"line\">    mixins: [myMixin]</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h2 id=\"内置指令\"><a href=\"#内置指令\" class=\"headerlink\" title=\"内置指令\"></a>内置指令</h2><ul><li>数据渲染：<code>&amp;#123;&amp;#123;&amp;#125;&amp;#125;、v-text、v-html</code></li><li>条件渲染：<code>v-if、v-else</code></li><li>循环渲染：<ul><li>数组：<code>v-for=&quot;(item, index) in arr&quot; :key=&quot;index&quot;</code></li><li>对象：<code>v-for=&quot;(item, key, index) of obj&quot; :key=&quot;index&quot;</code></li></ul></li><li>事件绑定<ul><li>普通：<code>v-on:click = &quot;todo&quot;</code></li><li>缩写：<code>@click = &quot;todo&quot;</code></li><li>修饰符：<a href=\"mailto:`@click.stop.self\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">`@click.stop.self</a>、@keyup.stop.enter`<ul><li>阻止冒泡：stop</li><li>阻止默认：prevent</li><li>执行一次：once</li></ul></li></ul></li><li>动态绑定：<code>v-bind:</code>，注意可以省略 v-bind<ul><li>class：<ul><li>:class=”[‘a’, ‘b’]”</li><li>:class=”[ true ? ‘a’: ‘b’]”</li><li>:class=”{ ‘active’: isActive(id) }”</li></ul></li><li>style<ul><li>:style=”{color: ‘red’}”</li><li>:style=”[{color: ‘red’}, {fontSize: ‘16px’}]”</li></ul></li></ul></li><li>双向绑定<ul><li>绑定：<code>v-model、v-model.trim</code></li><li>修饰符<ul><li>trim：首尾空格过滤</li><li>lazy：监听change事件</li><li>number：字符串转为数字</li></ul></li></ul></li><li>性能优化<ul><li>只渲染一次：<code>v-once</code></li><li>防止页面闪烁：<code>v-cloak</code></li><li>不输出 data：<code>v-pre</code></li></ul></li></ul><h2 id=\"组件通信\"><a href=\"#组件通信\" class=\"headerlink\" title=\"组件通信\"></a>组件通信</h2><h3 id=\"父子组件通信\"><a href=\"#父子组件通信\" class=\"headerlink\" title=\"父子组件通信\"></a>父子组件通信</h3><ul><li>子传父<ul><li>法一：通过ref属性在父组件中直接取得子组件的数据</li><li>法二：子组件 $emit() 触发自定义事件，父组件 $on() 监听<ul><li>父组件：<code>child @updateList = &quot;updateList&quot;</code></li><li>子组件：<code>this.$emit(&quot;updateList&quot;, data)</code></li></ul></li></ul></li><li><p>父传子：在子组件中通过 props 定义父组件传递的属性</p><ul><li>父组件：child name=”Tom” :songs=”songs” :age=”age”</li><li>子组件：props 接收属性如下</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 简洁写法</span></span><br><span class=\"line\">    props: [<span class=\"string\">\"name\"</span>, <span class=\"string\">\"songs\"</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 普通写法</span></span><br><span class=\"line\">    props: &#123;</span><br><span class=\"line\">        name:&#123;  <span class=\"comment\">// 静态数据</span></span><br><span class=\"line\">            type: <span class=\"built_in\">String</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        songs:&#123;  <span class=\"comment\">// 动态数据</span></span><br><span class=\"line\">            type: <span class=\"built_in\">Array</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        age:&#123;     <span class=\"comment\">// 动态数据验证</span></span><br><span class=\"line\">            type: <span class=\"built_in\">Number</span>,   </span><br><span class=\"line\">            required: <span class=\"literal\">true</span>,</span><br><span class=\"line\">            <span class=\"keyword\">default</span>()&#123;     <span class=\"comment\">// 默认值, 可直接1000 </span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> &#123; <span class=\"attr\">time</span>: <span class=\"number\">1000</span> &#125; </span><br><span class=\"line\">            &#125;,  </span><br><span class=\"line\">            validator(val)&#123;  <span class=\"comment\">// 自定义验证</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> val &gt; <span class=\"number\">0</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id=\"双向绑定\"><a href=\"#双向绑定\" class=\"headerlink\" title=\"双向绑定\"></a>双向绑定</h3><blockquote><p>同步父子组件数据，注意不要在子组件中修改 props 接收的数据</p></blockquote><ul><li>普通写法<ul><li>父组件监听自定义事件：<code>child @update=&quot;val =&gt; pmsg = val&quot; :msg=&quot;pmsg&quot;</code></li><li>子组件触发事件：<code>props: { msg: String }、this.$emit(&#39;update&#39;, newVal)</code></li></ul></li><li>使用 sync<ul><li>父组件<ul><li>写法：<code>child :startDate.sync=&quot;startDate&quot;</code></li><li>扩展：<code>child :startDate=&quot;bar&quot; @update:startDate=&quot;val =&gt; startDate = val&quot;</code></li></ul></li><li>子组件<ul><li>属性：<code>props: { startDate: String }</code></li><li>事件：<code>this.$emit(&quot;update:startDate&quot;, startDate)</code></li></ul></li></ul></li></ul><h3 id=\"祖孙组件通信\"><a href=\"#祖孙组件通信\" class=\"headerlink\" title=\"祖孙组件通信\"></a>祖孙组件通信</h3><blockquote><p>$attrs 用来简化组件和后代组件的数据传递</p></blockquote><ul><li>属性<ul><li><strong>$attrs</strong>：传递不被 prop 识别的属性 (class和style除外)</li><li><strong>$listeners</strong>：传递组件的事件 (.native除外)</li><li><strong>inheritAttrs</strong>：控制 vue 对非 prop 特性默认行为<br>true：默认将组件中不被 props 识别的属性绑定到根元素<br>false：可以通过 v-bind 显性绑定到非根元素</li></ul></li><li><strong>com.vue</strong>：child sex=”男”</li><li><p><strong>child.vue</strong>：grand v-bind=”$attrs” v-on=”$listeners”</p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// props 没有注册 sex</span></span><br><span class=\"line\">    computed: &#123;</span><br><span class=\"line\">        sex()&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.$attrs.sex</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 去掉默认行为</span></span><br><span class=\"line\">    inheritAttrs: <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>grand.vue</strong></p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">    computed: &#123;</span><br><span class=\"line\">        sex()&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.$attrs.sex</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    inheritAttrs: <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id=\"全局通信\"><a href=\"#全局通信\" class=\"headerlink\" title=\"全局通信\"></a>全局通信</h3><ul><li>使用空实例作为事件中心<ol><li>根组件中添加空实例，允许所有组件调用</li><li>某个组件中定义调用事件触发的方法</li><li>另一个组件中绑定事件监听，并在组件销毁前解除绑定</li></ol></li><li>借助Vuex的全局状态共享</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// main.js</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> Vue(&#123; </span><br><span class=\"line\">    data: &#123; </span><br><span class=\"line\">        eventHub: <span class=\"keyword\">new</span> Vue() </span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// com1 </span></span><br><span class=\"line\"><span class=\"keyword\">this</span>.$root.eventHub.$emit(<span class=\"string\">'updateList'</span>, <span class=\"literal\">true</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// com2</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">    created()&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.$root.eventHub.$on(<span class=\"string\">'updateList'</span>, value =&gt; &#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(value)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    beforeDestroy() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.$root.eventHub.$off(<span class=\"string\">'to_sibiling'</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"template-标签\"><a href=\"#template-标签\" class=\"headerlink\" title=\"template 标签\"></a>template 标签</h2><blockquote><p>可看作一个不可见的包裹元素，主要用于分组的条件判断和列表渲染</p></blockquote><div align=\"center\"><br><img src=\"images/vue/vue-temp.png\" alt=\"Vue template\"><br></div><h2 id=\"内置组件\"><a href=\"#内置组件\" class=\"headerlink\" title=\"内置组件\"></a>内置组件</h2><ul><li><strong>transition</strong>：单个元素/组件的过渡效果</li><li><strong>transition-group</strong>：多个元素/组件的过渡效果</li><li><strong>component</strong>：支持两个属性 is、inline-template</li><li><strong>keep-alive</strong>：保留组件状态或避免重新渲染</li><li><strong>slot</strong>：替换 slot 元素实现内容嵌套</li></ul><h2 id=\"特殊特性\"><a href=\"#特殊特性\" class=\"headerlink\" title=\"特殊特性\"></a>特殊特性</h2><ul><li><strong>key</strong><ul><li>管理可复用的元素</li><li>减少运算来提高循环性能：<code>v-for=&quot;item in items&quot; :key=&quot;item.id&quot;</code></li></ul></li><li><strong>is</strong><ul><li>使用 v-bind:is 实现动态组件的切换效果</li><li>用于在 ul 等受限制的 html 元素中绑定组件：<code>li is=&quot;com1&quot;</code></li></ul></li><li><strong>slot</strong><ul><li>配合 slot 内置组件实现嵌套内容的相应显示</li><li>没有 slot 时不显示嵌套内容，多个 slot 时需使用具名插槽 (添加 name 属性)</li></ul></li><li><strong>ref</strong><ul><li>获取当前 DOM 元素：<code>li ref=&quot;cur&quot;、this.$refs.cur</code></li><li>获取子组件实例对象：<code>my-com ref=&quot;com&quot;、this.$refs.com</code></li></ul></li></ul><div align=\"center\"><br><img src=\"images/vue/vue-special.png\" alt=\"Vue special\"><br></div><!-- rebuild by neat -->"},{"title":"Vue 全家桶系列","top":false,"keywords":["vue"],"date":"2019-04-14T09:14:11.000Z","description":"路由控制 Router、异步通信 Axios、状态管理 Vuex","_content":"\n# 一、路由控制 Router \n\n## 基础使用\n> 将组件映射到路由，然后通过 vue-router 渲染\n\n  1. 定义组件：`user.vue`\n  2. 定义路由配置：`var routes = []`\n  3. 生成路由对象：`var router = new VueRouter({ routes: routes })`\n  4. 注入到实例对象：`var app = new Vue({ el: '#app', router, })`\n  5. 组件中定义渲染标签：`router-link、router-view`\n\n\n## 路由配置\n  * 命名路由：`name: 'home'`\n  * 嵌套路由：`children: [{ }]`\n  * 动态路由：`path: '/user/:id'`\n  * 命名视图：`components: { }`\n\n\n  ```js\n  // router/index.js\n  import Router from 'vue-router'\n  Vue.use(Router)\n\n  import user from '@/components/user'\n  import home from '@/components/home'\n\n  // 路由懒加载\n  const home = resolve => require(['@/components/Home.vue'], resolve)\n\n  export default new Router({\n    mode: 'hash',               // 路径模式 \n    base: '/app/',              // 基路径(默认'/')\n    linkActiveClass: 'active',  // 链接激活时的class\n\n    // history 模式下滚动行为，路由切换时页面滚动到指定位置\n    scrollBehavior (to, from, savedPosition) { \n        if(savedPosition){  \n        return savedPosition  // 原位置\n    }else{\n            return {x: 0,y: 0};   // 顶部\n        } \n        \n        if(to.hash){             // 锚点定位\n            return {selector: to.hash} \n        }\n    },\n    \n    routes: [     // 路由配置\n        {\n          title: '登录页',\n          alias: '/b',       // 路径别名\n\n          path: '/', \n          name: 'Index',\n          redirect: '/home', // 重定向(解决首次进入页面时不显示内容的问题)\n          component: home\n        }, \n        {\n          path:\"/home\",     // 静态路由\n          name: 'home',\n          component: home,\n          children: [{       // 嵌套路由(须先进 home) \n              path: \"/phone\",\n              name: \"phone\",\n              component: phone\n          }]\n        },                  \n        {\n          name: \"user\",    \n          path: '/user/:id',  // 动态路由(指定参数形式)   \n          component: user,    \n        },\n        {\n          path: '/name',\n          components: {      // 命名视图(同时渲染多个组件)\n              default: Foo,\n              a: Bar,\n              b: Baz\n          }\n        }\n    ]\n  }) \n  ```\n\n\n## 路由模式\n\n### 两种模式\n> 应用于浏览器的历史记录站，在当前已有的 back、forward、go 的基础上提供了对历史记录进行修改的功能。只是当它们执行修改时，虽然改变了当前URL，但浏览器不会立即向后端发送请求。\n\n  * __hash__：默认模式，浏览器地址中的 # 及其后面的字符串称为 hash，可以通过 window.location.hash 读取，它用来模拟一个完整 URL 但不会被包括在 HTTP 请求中，改变时不会重新加载页面。\n  * __history__：利用了 HTML5 新增方法，pushState()、replaceState() 用来对浏览器历史记录栈进行修改，popState 事件用来监听到状态变化。\t\n\n       \n### 404 错误\n  * __hash 模式__：只有 # 前面的内容会被包含在请求中。因此对于后端来说，即使没有做到对路由的全覆盖也不会返回404错误\n  * __history 模式__：前端的url必须和实际向后端发起请求的url 一致，比如 /book/id ，如果后端缺少对该路由的处理则返回 404 错误 \n\n  \n### 注意问题\n  <div style=\"text-indent: 2em\">app 开发时一般需要分享页面到第三方 app，但部分 url 不允许带 #。去除 # 需要使用 history 模式，但是有一个问题：在访问二级页面时，刷新操作则会出现 404 错误，那么就需要和后端一起配置 apache 或是 nginx url 重定向，重定向到你的首页路由上即可。</div>\n            \n\n## 路由跳转\n\n### CSS 标签跳转\n  * __跳转标签__：`router-link`\n    * 样式：tag=\"li\"、active-class=\"active\"、replace\n    * 导航\n      * 普通路由：`to= \"/path\"\n      * 动态路由：to=\"/user/12\"、:to=\"{ name: 'user', params/query: { id: 1 } }\"\n  * __渲染视图__：`router-view`\n    * 命名：name=\"user\" 属性\n    * 缓存：keep-alive  包裹\n    * 样式：transition  包裹\n  \n\n### JS 编程式导航\n  ```js\n  export default {\n      methods: {\n          to_home(){   // 字符串 和 对象\n              this.$router.push(\"home\")      \n              this.$router.push({ path: '/login?url=' + this.$route.path })  \n          },\n          to_user(){  // 命名路由 和 查询参数\n              this.$router.push({ name: 'user', params: { id: 123 }})  \n              this.$router.push({ path: 'user', query: { id: 123 }})   \n          },\n          to_other(){\n              this.$router.go(n)         // 前进\n              this.$router.back()        // 后退\n              this.$router.forward()\n              this.$router.replace()     // 替换掉当前的history记录\n          },\n          get_obj(){\n              console.log(this.$route)   // 路由对象(包括 path、params 等)\n          }\n      }   \n  }\n  ```\n\n\n## 动态路由传参\n  * 方式\n    * __path__：`to=\"/user/12\"`\n    * __params__：`:to=\"{ name: 'user', params: { id: 1 } }\"`\n    * __query__：`:to=\"{ name: 'user', query: { id: 1 } }\"`\n  * 注意\n    * 通过 path/params 传参时，需要在路由配置中标识指定参数形式 `path: '/user/:id'`\n    * 通过 params/query 传参时，参数必须是对象格式而且绑定 to 属性添加 `v-bind:`\n    * 跳转后的组件中获取参数 `this.$route.params/query.id`\n\n\n## 导航钩子\n> 用于路由跳转时执行任务或不满足条件时取消跳转\n\n### 分类\n  * __全局钩子__：beforeEach，常用于登录权限等验证\n  * __路由钩子__：beforeLeave / beforeEnter \n  * __组件钩子__：\n    * beforeRouteLeave，用于 清除计时器, 提示保存内容, 存储信息等\n    * beforeRouteEnter：用于在跳转完成前获取数据\n\n    \n### 参数\n  * __to__：目标路由对象\n  * __from__：当前路由对象\n  * __next__：必须调用的函数，否则就是死循环\n    * `next()`：执行下一个钩子，如果钩子全部执行完成则导航状态为 confirmed\n    * `next(false)`：中断当前导航，即重置到 from 路由对应的地址\n    * `next('/')、next({path: '/'})`：中断掉当前导航并跳转到新地址\n    * `next(error)`：如果传入一个 Error 实例，则导航被终止并会将错误传递给 router.onError() 注册的回调\n\n\n\n# 二、异步通信 Axios\n\n## 基础使用\n  ```js\n  this.$axios.get('/user?id=12')\n      .then( res => { })\n      .catch( err => { })\n\n  let prames = Object.assign({}, this.form_data)\n  this.$axios({ \n      url: url,\n      method: 'post',\n      data: this.$qs.stringify(prames)\n      \n  }).then((res)=>{\n      console.log(res)\n  })\n      \n  \n  // formData 形式上传数据\n　let formData = new FormData();\n  formData.append('file', file);    \n　　this.$axios.post('url', formData, {\n　　　　headers:{  \n　　　　   'Content-Type':'multipart/form-data' \n　　　　}\n　　})\n\n  // 前端使用 qs 模块\n  var qs = require('qs');\n  this.$axios.post('/foo', qs.stringify({id: 12}))\n\n  // Node环境使用 querystring 模块\n  var querystring = require('querystring');\n  this.$axios.post('url', querystring.stringify({f:'a'}));\n  ```\n\n\n## 请求 API\n  * 请求：`axios(config)、axios(url, [config])`\n  * 并发：`axios.all(arr)、axios.spread(callback)`\n  * 别名：`axios.get(url, [config])、axios.post(url, [data], [config])`\n  \n\n## 自定义配置\n  ```js\n  // axios/http.js\n  import axios from 'axios'\n  import store from '@/vuex/index'\n  import router from \"../router\"\n\n  import qs from \"qs\"   \n  import { Loading } from 'element-ui'\n  import { Message } from 'element-ui'\n\n  var CancelToken = axios.CancelToken;  // 异步发送的请求--取消操作\n\n  // 创建axios实例\n  const service = axios.create({\n      baseURL: process.env.API_ROOT,\n      timeout: 5000,            // 请求超时时间\n      responseType: \"json\",\n      // withCredentials: true, // 跨域请求时是否需要使用凭证(cookie等)\n  })\n\n  // service.defaults.baseURL = process.env.API_ROOT  默认配置\n\n  // 添加请求拦截器\n  let loading;\n  service.interceptors.request.use(\n      config => {\n          // 请求时loading效果\n          loading = Loading.service({ \n              fullscreen: true,\n              lock: true,\n              text: 'Loading, please wait a moment.',\n              spinner: 'el-icon-loading'\n          });\n          // 让每个请求携带 token\n          if (store.getters.token) {\n              config.data = Object.assign({ token: store.getters.token }, config.data)\n          }\n      \n          // 设置表头  'application/json'\n          config.headers['Content-Type'] = 'application/json;charset=utf-8'\n\n          // 请求参数序列化\n          if (config.method === 'post' || config.method === \"put\" || config.method === \"delete\") {\n              config.data = qs.stringify(config.data) // 序列化\n          }\n          let cancel\n          config.cancelToken = new CancelToken( c => {\n              cancel = c;\n          })\n          // cancel()  中断请求\n          // router.push('/login')\n\n          return config;\n      }, \n      error => {\n          Message({            \n              showClose: true,\n              message: error,\n              type: \"error.data.error.message\"\n          });\n          return Promise.reject(error);\n      }\n  )\n\n  // 添加响应拦截器\n  service.interceptors.response.use(\n      res => {    \n          // 请求正常则关闭动画\n          loading.close();\n\n          // 登录验证通过则跳转页面\n          if(res.data.status ==2){\n              router.push({\n                  path: \"/login\",\n                  query:{ redirect: router.currentRoute.fullPath }\n              })\n          } \n\n          return Promise.resolve(res)\n      },\n      error => {     \n          // 请求错误则更新状态\n          const httpError = { \n              hasError: true,\n              status: error.response.status,\n              statusText: error.response.statusText\n          }\n          store.commit('ON_HTTP_ERROR', httpError)\n          \n          return Promise.reject(error)\n      }\n  )\n  export default service\n\n\n  // main.js 全局引用\n  import http from '@/assets/js/http'\n  Vue.prototype.$axios = http\n  ```\n      \n\n## 本地模拟数据\n    \n### 自定义配置\n> 数据 static/data.json\n            \n  ```js\n  // webpack.dev.conf.js\n  const portfinder = require('portfinder')\n\n  // 模拟数据添加部分   开始\n  const express = require('express')\n  const app = express()                    // 创建express应用程序\n  var appData = require('../data.json')    // 加载本地数据文件\n  var seller = appData.seller              // 获取对应的本地数据\n  var goods = appData.goods\n  var ratings = appData.ratings\n  var apiRoutes = express.Router()        // 获取一个 express 的路由实例\n  app.use('/api', apiRoutes)              // 定义数据输出接口\n  // 结束\n\n  const devWebpackConfig = merge(baseWebpackConfig, {\n    devServer: {\n        // 最后添加接口选项\n        before(app) {  //  模拟数据选项\n            app.get('/api/seller', (req, res) => {\n                res.json({ errno: 0, data: seller }) \n            }),\n            app.post('/api/foods', (req, res) => { \n                res.json({ errno: 0, data: foods })\n            })\n        }\n    }\n  }\n  ```\n\n\n### 通过 mockjs\n\n  * 安装：`cnpm install mockjs -S`\n  * 定义：`src/mack/index.js`\n  * 引入：`import './mock'`\n\n\n  ```js \n  // src/mack/index.js\n  import Mock from 'mockjs'\n  let Random = Mock.Random   // 随机函数\n\n  const data =  () => {\n      let arr = []\n      for (let i = 0; i &lt; 10; i++) {\n          let newArticleObject = {\n              title: Random.csentence(5),\n              content: Random.cparagraph(5, 7),\n              time: Random.date() + ' ' + Random.time(),\n              location: Random.city()\n          }\n          arr.push(newArticleObject)\n      }\n      return {arr}\n  }\n  // 第三个参数可以是 对象/返回对象的函数\n  Mock.mock('/api/data', 'get', data)\n  ```\n\n\n# 三、状态管理 Vuex\n\n## 核心概念\n> 本质是一个挂载到 vue 实例的全局变量对象 store，它的属性和方法负责管理所有组件的状态及其更新\n\n  * __state__：包含所有应用级别状态的对象 (组件用到的数据)\n  * __getters__：派生出 state 所需数据 (计算属性)\n  * __mutators__：更新 state 的唯一方式 (同步更新)\n  * __actions__：异步提交 mutaions 更新状态 (异步更新)\n  * __module__：划分为不同模块管理 (方便维护大型项目)\n\n\n## 单向数据流  \n  <div style=\"text-indent: 2em\">通过 vue Devtools 调试工具可以轻松查看状态变化，用户界面负责触发动作 Action 进而改变对应状态 State，从而反映到视图 View 上，所以 State 数据的流向为：`View --> Actions --> mutators --> State --> View`</div>\n\n  <div align=\"center\"> \n    ![Vuex 实现原理](images/vue/vuex_base.png)\n  </div> \n          \n      \n## 目录结构\n> 如果 store 文件太大则需要分割到单独文件\n\n  ```js\n  store\n    ├── index.js         // 组装模块并导出store \n    ├── actions.js       // 根级别的 action\n    ├── mutations.js     // 根级别的 mutation\n    └── modules          // 大型应用时分割到模块\n        ├── cart.js      // 购物车模块\n        └── products.js  // 产品模块\n  ```\n\n\n## 自定义配置\n\n### 单个文件\n  ```js\n  // vuex/store.js\n  import Vue from 'vue'\n  import Vuex from 'vuex'\n  Vue.use(Vuex)\n\n  // state 状态变量 \n  const state = {    \n      count: 1,\n      isShow: false \n  }\n\n  // state 的计算属性：派生所需状态)\n  const getters = {\n      countNew: state => {  \n          return state.count * 10;\n      }\n  }\n\n  // 更新 state 的逻辑方法 (commit mutation 触发)\n  const mutations={\n      add(state){     \n          state.count += 1;\n      },\n      reduce(state,n){  // 第二个参数可自定义类型   \n          state.count -= n;\n      },\n      tog(state){  \n          state.isShow = !state.isShow;\n      },\n      init(state){\n          state.count = 1;\n      }\n  }\n\n  // 更新 state 的异步逻辑 (dispatch actions 触发)\n  const actions = {\n      // 完整写法  \n      add_all: (context) => { context.commit('add') },\n      \n      // 简写写法  同步提交(实时跟踪)\n      add: ({ commit }) => commit('add'), \n      reduce: ({ commit },n) => commit('reduce',n), \n\n      tog: ({ commit }) => commit('tog'), \n      init: ({ commit }) => commit('init'), \n\n      // 异步提交\n      addAsync: ({ commit }) => {  \n          setTimeout (() => {\n              commit('add'); \n          }, 1000);\n      }\n  }\n\n  // 分割成不同模块使用：方便管理\n  const modules = {   \n      // 每个module中都有state等, 获取时 store.state.a\n      a: {\n          state: { count: 0},\n          // 参数 模块的局部状态state,getter和根节点状态\n          getters: {  \n              sum (state, getters, rootState) {\n                  return state.count + rootState.count\n              }\n          },\n          mutations: {    //模块的局部状态state\n              increment(state){\n                  state.count ++ ;\n              }\n          },\n          actions: { \n              incrementIf ({ state, commit, rootState }) {\n                  if ((state.count + rootState.count) % 2 === 1) {\n                      commit('increment')\n                  }\n              }\n          }\n      },  \n      b: { }\n  }\n\n  // 注册所有模块并导出\n  const store = new Vuex.Store({\n      state,\n      mutations,\n      actions,\n      getters,\n      // modules  导出 modules 时就不需要导出以上变量了\n  })\n  export default store\n  ```\n\n\n### 文件拆分\n  ```js\n  // vuex/index.js：vuex 入口函数，在 main.js 中引入\n  import Vue from 'vue'\n  import Vuex from 'vuex'\n  import * as getters from './getters'\n  import * as actions from './actions'\n  import * as mutations from './mutations'\n  Vue.use(Vuex)\n  const state = {  // 声明状态\n          count: 0, isShow: false\n  }\n  const store = new Vuex.Store({  // 注册模块\n          state, getters, actions, mutations\n  })\n  export default store\n\n\n  // vuex/getters.js：获取状态信息\n  export const countNew = state => state.count*10\n\n\n  // vuex/mutations.js：同步操作状态值\n  export const init = state => { state.count = 1 }\n  export const add = state => {  state.count += 1 }\n  export const reduce = (state,n) => { state.count -= n }\n  export const tog = state => { state.isShow = !state.isShow }\n          \n      \n  // vuex/actions.js：异步处理逻辑\n  // 完整写法\n  export const _add = (context) => { context.commit('add') }\n  // 以下为简写写法\n  export const init = ({ commit }) => commit('init')\t\n  export const add = ({ commit }) => commit('add')\n  export const reduce = ({ commit },n) => commit('reduce',n)\n  export const tog = ({ commit }) => commit('tog')\n  ```\n\n\n## 全局引用\n  ```js\n  // main.js \n  import store from './vuex'  \n  new Vue({\n      el: '#app',\n      router,\n      store,\n  })\n  ```\n\n\n## 组件使用\n  ```js\n  import { mapState, mapGetters, mapMutations, mapActions } \n  export default {\n    data(){\n        return{\n            localState: 2\n        }\n    },\n    watch:{\n        isShow: function(){    // 隐藏时初始化count\n            if(!this.show){\n                this.$store.commit('init') \n            }\n        }\n    },\n    // 普通写法\n    computed: {     \n        count () {\n            return this.$store.state.count;  \n            // getters.countNew  \n        },\n        isShow(){\n            return this.$store.state.isShow;\n        }\n    },\n    // 简洁写法：使用辅助函数返回对象并映射到组件实例\n    computed: mapState({  \n        count: state => state.count, \n        countAlias: 'count',      // 改变名称\n        countPlus(state){         // 使this指向组件对象\n            return state.count + this.localState; \n        },\n    }),\n    computed: mapState(['count','isShow']),  // 名称相同\n    computed: {\n        local(){         // 组件数据\n            return this.localState;\n        },\n        // 使用对象展开运算符将数据混入 computed 对象\n\n        ...mapState([    // 映射 State\n            'count',\n            'isShow'\n        ]),\n        ...mapGetters([  // 映射 Getters \n            'countNew'\n        ])\n    }, \n\n\n    methods: {   \n        reduce(){     // 有参数时需单独定义\n            this.$store.commit('add')           // 同步\n            this.$store.dispatch('reduce', 2)   // 异步\n        },\n        ...mapActions([  // 映射 Mutations\n            'add',  \n            'tog',\n            'addAsync'\n        ]),\n    },\n    methods: mapActions(['add'])\n    methods: mapMutations(['add'])\n  }\n  ```\n\n\n\n\n\n","source":"_posts/14-vue全家桶.md","raw":"---\ntitle: Vue 全家桶系列\ntags:\n  - Vue.js\ncategories: Vue.js\ntop: false\nkeywords:\n  - vue\ndate: 2019-04-14 17:14:11\ndescription: 路由控制 Router、异步通信 Axios、状态管理 Vuex\n---\n\n# 一、路由控制 Router \n\n## 基础使用\n> 将组件映射到路由，然后通过 vue-router 渲染\n\n  1. 定义组件：`user.vue`\n  2. 定义路由配置：`var routes = []`\n  3. 生成路由对象：`var router = new VueRouter({ routes: routes })`\n  4. 注入到实例对象：`var app = new Vue({ el: '#app', router, })`\n  5. 组件中定义渲染标签：`router-link、router-view`\n\n\n## 路由配置\n  * 命名路由：`name: 'home'`\n  * 嵌套路由：`children: [{ }]`\n  * 动态路由：`path: '/user/:id'`\n  * 命名视图：`components: { }`\n\n\n  ```js\n  // router/index.js\n  import Router from 'vue-router'\n  Vue.use(Router)\n\n  import user from '@/components/user'\n  import home from '@/components/home'\n\n  // 路由懒加载\n  const home = resolve => require(['@/components/Home.vue'], resolve)\n\n  export default new Router({\n    mode: 'hash',               // 路径模式 \n    base: '/app/',              // 基路径(默认'/')\n    linkActiveClass: 'active',  // 链接激活时的class\n\n    // history 模式下滚动行为，路由切换时页面滚动到指定位置\n    scrollBehavior (to, from, savedPosition) { \n        if(savedPosition){  \n        return savedPosition  // 原位置\n    }else{\n            return {x: 0,y: 0};   // 顶部\n        } \n        \n        if(to.hash){             // 锚点定位\n            return {selector: to.hash} \n        }\n    },\n    \n    routes: [     // 路由配置\n        {\n          title: '登录页',\n          alias: '/b',       // 路径别名\n\n          path: '/', \n          name: 'Index',\n          redirect: '/home', // 重定向(解决首次进入页面时不显示内容的问题)\n          component: home\n        }, \n        {\n          path:\"/home\",     // 静态路由\n          name: 'home',\n          component: home,\n          children: [{       // 嵌套路由(须先进 home) \n              path: \"/phone\",\n              name: \"phone\",\n              component: phone\n          }]\n        },                  \n        {\n          name: \"user\",    \n          path: '/user/:id',  // 动态路由(指定参数形式)   \n          component: user,    \n        },\n        {\n          path: '/name',\n          components: {      // 命名视图(同时渲染多个组件)\n              default: Foo,\n              a: Bar,\n              b: Baz\n          }\n        }\n    ]\n  }) \n  ```\n\n\n## 路由模式\n\n### 两种模式\n> 应用于浏览器的历史记录站，在当前已有的 back、forward、go 的基础上提供了对历史记录进行修改的功能。只是当它们执行修改时，虽然改变了当前URL，但浏览器不会立即向后端发送请求。\n\n  * __hash__：默认模式，浏览器地址中的 # 及其后面的字符串称为 hash，可以通过 window.location.hash 读取，它用来模拟一个完整 URL 但不会被包括在 HTTP 请求中，改变时不会重新加载页面。\n  * __history__：利用了 HTML5 新增方法，pushState()、replaceState() 用来对浏览器历史记录栈进行修改，popState 事件用来监听到状态变化。\t\n\n       \n### 404 错误\n  * __hash 模式__：只有 # 前面的内容会被包含在请求中。因此对于后端来说，即使没有做到对路由的全覆盖也不会返回404错误\n  * __history 模式__：前端的url必须和实际向后端发起请求的url 一致，比如 /book/id ，如果后端缺少对该路由的处理则返回 404 错误 \n\n  \n### 注意问题\n  <div style=\"text-indent: 2em\">app 开发时一般需要分享页面到第三方 app，但部分 url 不允许带 #。去除 # 需要使用 history 模式，但是有一个问题：在访问二级页面时，刷新操作则会出现 404 错误，那么就需要和后端一起配置 apache 或是 nginx url 重定向，重定向到你的首页路由上即可。</div>\n            \n\n## 路由跳转\n\n### CSS 标签跳转\n  * __跳转标签__：`router-link`\n    * 样式：tag=\"li\"、active-class=\"active\"、replace\n    * 导航\n      * 普通路由：`to= \"/path\"\n      * 动态路由：to=\"/user/12\"、:to=\"{ name: 'user', params/query: { id: 1 } }\"\n  * __渲染视图__：`router-view`\n    * 命名：name=\"user\" 属性\n    * 缓存：keep-alive  包裹\n    * 样式：transition  包裹\n  \n\n### JS 编程式导航\n  ```js\n  export default {\n      methods: {\n          to_home(){   // 字符串 和 对象\n              this.$router.push(\"home\")      \n              this.$router.push({ path: '/login?url=' + this.$route.path })  \n          },\n          to_user(){  // 命名路由 和 查询参数\n              this.$router.push({ name: 'user', params: { id: 123 }})  \n              this.$router.push({ path: 'user', query: { id: 123 }})   \n          },\n          to_other(){\n              this.$router.go(n)         // 前进\n              this.$router.back()        // 后退\n              this.$router.forward()\n              this.$router.replace()     // 替换掉当前的history记录\n          },\n          get_obj(){\n              console.log(this.$route)   // 路由对象(包括 path、params 等)\n          }\n      }   \n  }\n  ```\n\n\n## 动态路由传参\n  * 方式\n    * __path__：`to=\"/user/12\"`\n    * __params__：`:to=\"{ name: 'user', params: { id: 1 } }\"`\n    * __query__：`:to=\"{ name: 'user', query: { id: 1 } }\"`\n  * 注意\n    * 通过 path/params 传参时，需要在路由配置中标识指定参数形式 `path: '/user/:id'`\n    * 通过 params/query 传参时，参数必须是对象格式而且绑定 to 属性添加 `v-bind:`\n    * 跳转后的组件中获取参数 `this.$route.params/query.id`\n\n\n## 导航钩子\n> 用于路由跳转时执行任务或不满足条件时取消跳转\n\n### 分类\n  * __全局钩子__：beforeEach，常用于登录权限等验证\n  * __路由钩子__：beforeLeave / beforeEnter \n  * __组件钩子__：\n    * beforeRouteLeave，用于 清除计时器, 提示保存内容, 存储信息等\n    * beforeRouteEnter：用于在跳转完成前获取数据\n\n    \n### 参数\n  * __to__：目标路由对象\n  * __from__：当前路由对象\n  * __next__：必须调用的函数，否则就是死循环\n    * `next()`：执行下一个钩子，如果钩子全部执行完成则导航状态为 confirmed\n    * `next(false)`：中断当前导航，即重置到 from 路由对应的地址\n    * `next('/')、next({path: '/'})`：中断掉当前导航并跳转到新地址\n    * `next(error)`：如果传入一个 Error 实例，则导航被终止并会将错误传递给 router.onError() 注册的回调\n\n\n\n# 二、异步通信 Axios\n\n## 基础使用\n  ```js\n  this.$axios.get('/user?id=12')\n      .then( res => { })\n      .catch( err => { })\n\n  let prames = Object.assign({}, this.form_data)\n  this.$axios({ \n      url: url,\n      method: 'post',\n      data: this.$qs.stringify(prames)\n      \n  }).then((res)=>{\n      console.log(res)\n  })\n      \n  \n  // formData 形式上传数据\n　let formData = new FormData();\n  formData.append('file', file);    \n　　this.$axios.post('url', formData, {\n　　　　headers:{  \n　　　　   'Content-Type':'multipart/form-data' \n　　　　}\n　　})\n\n  // 前端使用 qs 模块\n  var qs = require('qs');\n  this.$axios.post('/foo', qs.stringify({id: 12}))\n\n  // Node环境使用 querystring 模块\n  var querystring = require('querystring');\n  this.$axios.post('url', querystring.stringify({f:'a'}));\n  ```\n\n\n## 请求 API\n  * 请求：`axios(config)、axios(url, [config])`\n  * 并发：`axios.all(arr)、axios.spread(callback)`\n  * 别名：`axios.get(url, [config])、axios.post(url, [data], [config])`\n  \n\n## 自定义配置\n  ```js\n  // axios/http.js\n  import axios from 'axios'\n  import store from '@/vuex/index'\n  import router from \"../router\"\n\n  import qs from \"qs\"   \n  import { Loading } from 'element-ui'\n  import { Message } from 'element-ui'\n\n  var CancelToken = axios.CancelToken;  // 异步发送的请求--取消操作\n\n  // 创建axios实例\n  const service = axios.create({\n      baseURL: process.env.API_ROOT,\n      timeout: 5000,            // 请求超时时间\n      responseType: \"json\",\n      // withCredentials: true, // 跨域请求时是否需要使用凭证(cookie等)\n  })\n\n  // service.defaults.baseURL = process.env.API_ROOT  默认配置\n\n  // 添加请求拦截器\n  let loading;\n  service.interceptors.request.use(\n      config => {\n          // 请求时loading效果\n          loading = Loading.service({ \n              fullscreen: true,\n              lock: true,\n              text: 'Loading, please wait a moment.',\n              spinner: 'el-icon-loading'\n          });\n          // 让每个请求携带 token\n          if (store.getters.token) {\n              config.data = Object.assign({ token: store.getters.token }, config.data)\n          }\n      \n          // 设置表头  'application/json'\n          config.headers['Content-Type'] = 'application/json;charset=utf-8'\n\n          // 请求参数序列化\n          if (config.method === 'post' || config.method === \"put\" || config.method === \"delete\") {\n              config.data = qs.stringify(config.data) // 序列化\n          }\n          let cancel\n          config.cancelToken = new CancelToken( c => {\n              cancel = c;\n          })\n          // cancel()  中断请求\n          // router.push('/login')\n\n          return config;\n      }, \n      error => {\n          Message({            \n              showClose: true,\n              message: error,\n              type: \"error.data.error.message\"\n          });\n          return Promise.reject(error);\n      }\n  )\n\n  // 添加响应拦截器\n  service.interceptors.response.use(\n      res => {    \n          // 请求正常则关闭动画\n          loading.close();\n\n          // 登录验证通过则跳转页面\n          if(res.data.status ==2){\n              router.push({\n                  path: \"/login\",\n                  query:{ redirect: router.currentRoute.fullPath }\n              })\n          } \n\n          return Promise.resolve(res)\n      },\n      error => {     \n          // 请求错误则更新状态\n          const httpError = { \n              hasError: true,\n              status: error.response.status,\n              statusText: error.response.statusText\n          }\n          store.commit('ON_HTTP_ERROR', httpError)\n          \n          return Promise.reject(error)\n      }\n  )\n  export default service\n\n\n  // main.js 全局引用\n  import http from '@/assets/js/http'\n  Vue.prototype.$axios = http\n  ```\n      \n\n## 本地模拟数据\n    \n### 自定义配置\n> 数据 static/data.json\n            \n  ```js\n  // webpack.dev.conf.js\n  const portfinder = require('portfinder')\n\n  // 模拟数据添加部分   开始\n  const express = require('express')\n  const app = express()                    // 创建express应用程序\n  var appData = require('../data.json')    // 加载本地数据文件\n  var seller = appData.seller              // 获取对应的本地数据\n  var goods = appData.goods\n  var ratings = appData.ratings\n  var apiRoutes = express.Router()        // 获取一个 express 的路由实例\n  app.use('/api', apiRoutes)              // 定义数据输出接口\n  // 结束\n\n  const devWebpackConfig = merge(baseWebpackConfig, {\n    devServer: {\n        // 最后添加接口选项\n        before(app) {  //  模拟数据选项\n            app.get('/api/seller', (req, res) => {\n                res.json({ errno: 0, data: seller }) \n            }),\n            app.post('/api/foods', (req, res) => { \n                res.json({ errno: 0, data: foods })\n            })\n        }\n    }\n  }\n  ```\n\n\n### 通过 mockjs\n\n  * 安装：`cnpm install mockjs -S`\n  * 定义：`src/mack/index.js`\n  * 引入：`import './mock'`\n\n\n  ```js \n  // src/mack/index.js\n  import Mock from 'mockjs'\n  let Random = Mock.Random   // 随机函数\n\n  const data =  () => {\n      let arr = []\n      for (let i = 0; i &lt; 10; i++) {\n          let newArticleObject = {\n              title: Random.csentence(5),\n              content: Random.cparagraph(5, 7),\n              time: Random.date() + ' ' + Random.time(),\n              location: Random.city()\n          }\n          arr.push(newArticleObject)\n      }\n      return {arr}\n  }\n  // 第三个参数可以是 对象/返回对象的函数\n  Mock.mock('/api/data', 'get', data)\n  ```\n\n\n# 三、状态管理 Vuex\n\n## 核心概念\n> 本质是一个挂载到 vue 实例的全局变量对象 store，它的属性和方法负责管理所有组件的状态及其更新\n\n  * __state__：包含所有应用级别状态的对象 (组件用到的数据)\n  * __getters__：派生出 state 所需数据 (计算属性)\n  * __mutators__：更新 state 的唯一方式 (同步更新)\n  * __actions__：异步提交 mutaions 更新状态 (异步更新)\n  * __module__：划分为不同模块管理 (方便维护大型项目)\n\n\n## 单向数据流  \n  <div style=\"text-indent: 2em\">通过 vue Devtools 调试工具可以轻松查看状态变化，用户界面负责触发动作 Action 进而改变对应状态 State，从而反映到视图 View 上，所以 State 数据的流向为：`View --> Actions --> mutators --> State --> View`</div>\n\n  <div align=\"center\"> \n    ![Vuex 实现原理](images/vue/vuex_base.png)\n  </div> \n          \n      \n## 目录结构\n> 如果 store 文件太大则需要分割到单独文件\n\n  ```js\n  store\n    ├── index.js         // 组装模块并导出store \n    ├── actions.js       // 根级别的 action\n    ├── mutations.js     // 根级别的 mutation\n    └── modules          // 大型应用时分割到模块\n        ├── cart.js      // 购物车模块\n        └── products.js  // 产品模块\n  ```\n\n\n## 自定义配置\n\n### 单个文件\n  ```js\n  // vuex/store.js\n  import Vue from 'vue'\n  import Vuex from 'vuex'\n  Vue.use(Vuex)\n\n  // state 状态变量 \n  const state = {    \n      count: 1,\n      isShow: false \n  }\n\n  // state 的计算属性：派生所需状态)\n  const getters = {\n      countNew: state => {  \n          return state.count * 10;\n      }\n  }\n\n  // 更新 state 的逻辑方法 (commit mutation 触发)\n  const mutations={\n      add(state){     \n          state.count += 1;\n      },\n      reduce(state,n){  // 第二个参数可自定义类型   \n          state.count -= n;\n      },\n      tog(state){  \n          state.isShow = !state.isShow;\n      },\n      init(state){\n          state.count = 1;\n      }\n  }\n\n  // 更新 state 的异步逻辑 (dispatch actions 触发)\n  const actions = {\n      // 完整写法  \n      add_all: (context) => { context.commit('add') },\n      \n      // 简写写法  同步提交(实时跟踪)\n      add: ({ commit }) => commit('add'), \n      reduce: ({ commit },n) => commit('reduce',n), \n\n      tog: ({ commit }) => commit('tog'), \n      init: ({ commit }) => commit('init'), \n\n      // 异步提交\n      addAsync: ({ commit }) => {  \n          setTimeout (() => {\n              commit('add'); \n          }, 1000);\n      }\n  }\n\n  // 分割成不同模块使用：方便管理\n  const modules = {   \n      // 每个module中都有state等, 获取时 store.state.a\n      a: {\n          state: { count: 0},\n          // 参数 模块的局部状态state,getter和根节点状态\n          getters: {  \n              sum (state, getters, rootState) {\n                  return state.count + rootState.count\n              }\n          },\n          mutations: {    //模块的局部状态state\n              increment(state){\n                  state.count ++ ;\n              }\n          },\n          actions: { \n              incrementIf ({ state, commit, rootState }) {\n                  if ((state.count + rootState.count) % 2 === 1) {\n                      commit('increment')\n                  }\n              }\n          }\n      },  \n      b: { }\n  }\n\n  // 注册所有模块并导出\n  const store = new Vuex.Store({\n      state,\n      mutations,\n      actions,\n      getters,\n      // modules  导出 modules 时就不需要导出以上变量了\n  })\n  export default store\n  ```\n\n\n### 文件拆分\n  ```js\n  // vuex/index.js：vuex 入口函数，在 main.js 中引入\n  import Vue from 'vue'\n  import Vuex from 'vuex'\n  import * as getters from './getters'\n  import * as actions from './actions'\n  import * as mutations from './mutations'\n  Vue.use(Vuex)\n  const state = {  // 声明状态\n          count: 0, isShow: false\n  }\n  const store = new Vuex.Store({  // 注册模块\n          state, getters, actions, mutations\n  })\n  export default store\n\n\n  // vuex/getters.js：获取状态信息\n  export const countNew = state => state.count*10\n\n\n  // vuex/mutations.js：同步操作状态值\n  export const init = state => { state.count = 1 }\n  export const add = state => {  state.count += 1 }\n  export const reduce = (state,n) => { state.count -= n }\n  export const tog = state => { state.isShow = !state.isShow }\n          \n      \n  // vuex/actions.js：异步处理逻辑\n  // 完整写法\n  export const _add = (context) => { context.commit('add') }\n  // 以下为简写写法\n  export const init = ({ commit }) => commit('init')\t\n  export const add = ({ commit }) => commit('add')\n  export const reduce = ({ commit },n) => commit('reduce',n)\n  export const tog = ({ commit }) => commit('tog')\n  ```\n\n\n## 全局引用\n  ```js\n  // main.js \n  import store from './vuex'  \n  new Vue({\n      el: '#app',\n      router,\n      store,\n  })\n  ```\n\n\n## 组件使用\n  ```js\n  import { mapState, mapGetters, mapMutations, mapActions } \n  export default {\n    data(){\n        return{\n            localState: 2\n        }\n    },\n    watch:{\n        isShow: function(){    // 隐藏时初始化count\n            if(!this.show){\n                this.$store.commit('init') \n            }\n        }\n    },\n    // 普通写法\n    computed: {     \n        count () {\n            return this.$store.state.count;  \n            // getters.countNew  \n        },\n        isShow(){\n            return this.$store.state.isShow;\n        }\n    },\n    // 简洁写法：使用辅助函数返回对象并映射到组件实例\n    computed: mapState({  \n        count: state => state.count, \n        countAlias: 'count',      // 改变名称\n        countPlus(state){         // 使this指向组件对象\n            return state.count + this.localState; \n        },\n    }),\n    computed: mapState(['count','isShow']),  // 名称相同\n    computed: {\n        local(){         // 组件数据\n            return this.localState;\n        },\n        // 使用对象展开运算符将数据混入 computed 对象\n\n        ...mapState([    // 映射 State\n            'count',\n            'isShow'\n        ]),\n        ...mapGetters([  // 映射 Getters \n            'countNew'\n        ])\n    }, \n\n\n    methods: {   \n        reduce(){     // 有参数时需单独定义\n            this.$store.commit('add')           // 同步\n            this.$store.dispatch('reduce', 2)   // 异步\n        },\n        ...mapActions([  // 映射 Mutations\n            'add',  \n            'tog',\n            'addAsync'\n        ]),\n    },\n    methods: mapActions(['add'])\n    methods: mapMutations(['add'])\n  }\n  ```\n\n\n\n\n\n","slug":"14-vue全家桶","published":1,"updated":"2019-05-10T17:19:41.084Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvid4plq00190nbxd2zxlbt6","content":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><html><head></head><body><h1 id=\"一、路由控制-Router\"><a href=\"#一、路由控制-Router\" class=\"headerlink\" title=\"一、路由控制 Router\"></a>一、路由控制 Router</h1><h2 id=\"基础使用\"><a href=\"#基础使用\" class=\"headerlink\" title=\"基础使用\"></a>基础使用</h2><blockquote><p>将组件映射到路由，然后通过 vue-router 渲染</p></blockquote><ol><li>定义组件：<code>user.vue</code></li><li>定义路由配置：<code>var routes = []</code></li><li>生成路由对象：<code>var router = new VueRouter({ routes: routes })</code></li><li>注入到实例对象：<code>var app = new Vue({ el: '#app', router, })</code></li><li>组件中定义渲染标签：<code>router-link、router-view</code></li></ol><h2 id=\"路由配置\"><a href=\"#路由配置\" class=\"headerlink\" title=\"路由配置\"></a>路由配置</h2><ul><li>命名路由：<code>name: 'home'</code></li><li>嵌套路由：<code>children: [{ }]</code></li><li>动态路由：<code>path: '/user/:id'</code></li><li>命名视图：<code>components: { }</code></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// router/index.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> Router <span class=\"keyword\">from</span> <span class=\"string\">'vue-router'</span></span><br><span class=\"line\">Vue.use(Router)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> user <span class=\"keyword\">from</span> <span class=\"string\">'@/components/user'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> home <span class=\"keyword\">from</span> <span class=\"string\">'@/components/home'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 路由懒加载</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> home = <span class=\"function\"><span class=\"params\">resolve</span> =></span> <span class=\"built_in\">require</span>([<span class=\"string\">'@/components/Home.vue'</span>], resolve)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">new</span> Router({</span><br><span class=\"line\">  mode: <span class=\"string\">'hash'</span>,               <span class=\"comment\">// 路径模式 </span></span><br><span class=\"line\">  base: <span class=\"string\">'/app/'</span>,              <span class=\"comment\">// 基路径(默认'/')</span></span><br><span class=\"line\">  linkActiveClass: <span class=\"string\">'active'</span>,  <span class=\"comment\">// 链接激活时的class</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// history 模式下滚动行为，路由切换时页面滚动到指定位置</span></span><br><span class=\"line\">  scrollBehavior (to, <span class=\"keyword\">from</span>, savedPosition) { </span><br><span class=\"line\">      <span class=\"keyword\">if</span>(savedPosition){  </span><br><span class=\"line\">      <span class=\"keyword\">return</span> savedPosition  <span class=\"comment\">// 原位置</span></span><br><span class=\"line\">  }<span class=\"keyword\">else</span>{</span><br><span class=\"line\">          <span class=\"keyword\">return</span> {<span class=\"attr\">x</span>: <span class=\"number\">0</span>,<span class=\"attr\">y</span>: <span class=\"number\">0</span>};   <span class=\"comment\">// 顶部</span></span><br><span class=\"line\">      } </span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"keyword\">if</span>(to.hash){             <span class=\"comment\">// 锚点定位</span></span><br><span class=\"line\">          <span class=\"keyword\">return</span> {<span class=\"attr\">selector</span>: to.hash} </span><br><span class=\"line\">      }</span><br><span class=\"line\">  },</span><br><span class=\"line\">  </span><br><span class=\"line\">  routes: [     <span class=\"comment\">// 路由配置</span></span><br><span class=\"line\">      {</span><br><span class=\"line\">        title: <span class=\"string\">'登录页'</span>,</span><br><span class=\"line\">        alias: <span class=\"string\">'/b'</span>,       <span class=\"comment\">// 路径别名</span></span><br><span class=\"line\"></span><br><span class=\"line\">        path: <span class=\"string\">'/'</span>, </span><br><span class=\"line\">        name: <span class=\"string\">'Index'</span>,</span><br><span class=\"line\">        redirect: <span class=\"string\">'/home'</span>, <span class=\"comment\">// 重定向(解决首次进入页面时不显示内容的问题)</span></span><br><span class=\"line\">        component: home</span><br><span class=\"line\">      }, </span><br><span class=\"line\">      {</span><br><span class=\"line\">        path:<span class=\"string\">\"/home\"</span>,     <span class=\"comment\">// 静态路由</span></span><br><span class=\"line\">        name: <span class=\"string\">'home'</span>,</span><br><span class=\"line\">        component: home,</span><br><span class=\"line\">        children: [{       <span class=\"comment\">// 嵌套路由(须先进 home) </span></span><br><span class=\"line\">            path: <span class=\"string\">\"/phone\"</span>,</span><br><span class=\"line\">            name: <span class=\"string\">\"phone\"</span>,</span><br><span class=\"line\">            component: phone</span><br><span class=\"line\">        }]</span><br><span class=\"line\">      },                  </span><br><span class=\"line\">      {</span><br><span class=\"line\">        name: <span class=\"string\">\"user\"</span>,    </span><br><span class=\"line\">        path: <span class=\"string\">'/user/:id'</span>,  <span class=\"comment\">// 动态路由(指定参数形式)   </span></span><br><span class=\"line\">        component: user,    </span><br><span class=\"line\">      },</span><br><span class=\"line\">      {</span><br><span class=\"line\">        path: <span class=\"string\">'/name'</span>,</span><br><span class=\"line\">        components: {      <span class=\"comment\">// 命名视图(同时渲染多个组件)</span></span><br><span class=\"line\">            <span class=\"keyword\">default</span>: Foo,</span><br><span class=\"line\">            a: Bar,</span><br><span class=\"line\">            b: Baz</span><br><span class=\"line\">        }</span><br><span class=\"line\">      }</span><br><span class=\"line\">  ]</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h2 id=\"路由模式\"><a href=\"#路由模式\" class=\"headerlink\" title=\"路由模式\"></a>路由模式</h2><h3 id=\"两种模式\"><a href=\"#两种模式\" class=\"headerlink\" title=\"两种模式\"></a>两种模式</h3><blockquote><p>应用于浏览器的历史记录站，在当前已有的 back、forward、go 的基础上提供了对历史记录进行修改的功能。只是当它们执行修改时，虽然改变了当前URL，但浏览器不会立即向后端发送请求。</p></blockquote><ul><li><strong>hash</strong>：默认模式，浏览器地址中的 # 及其后面的字符串称为 hash，可以通过 window.location.hash 读取，它用来模拟一个完整 URL 但不会被包括在 HTTP 请求中，改变时不会重新加载页面。</li><li><strong>history</strong>：利用了 HTML5 新增方法，pushState()、replaceState() 用来对浏览器历史记录栈进行修改，popState 事件用来监听到状态变化。</li></ul><h3 id=\"404-错误\"><a href=\"#404-错误\" class=\"headerlink\" title=\"404 错误\"></a>404 错误</h3><ul><li><strong>hash 模式</strong>：只有 # 前面的内容会被包含在请求中。因此对于后端来说，即使没有做到对路由的全覆盖也不会返回404错误</li><li><strong>history 模式</strong>：前端的url必须和实际向后端发起请求的url 一致，比如 /book/id ，如果后端缺少对该路由的处理则返回 404 错误</li></ul><h3 id=\"注意问题\"><a href=\"#注意问题\" class=\"headerlink\" title=\"注意问题\"></a>注意问题</h3><div style=\"text-indent:2em\">app 开发时一般需要分享页面到第三方 app，但部分 url 不允许带 #。去除 # 需要使用 history 模式，但是有一个问题：在访问二级页面时，刷新操作则会出现 404 错误，那么就需要和后端一起配置 apache 或是 nginx url 重定向，重定向到你的首页路由上即可。</div><h2 id=\"路由跳转\"><a href=\"#路由跳转\" class=\"headerlink\" title=\"路由跳转\"></a>路由跳转</h2><h3 id=\"CSS-标签跳转\"><a href=\"#CSS-标签跳转\" class=\"headerlink\" title=\"CSS 标签跳转\"></a>CSS 标签跳转</h3><ul><li><strong>跳转标签</strong>：<code>router-link</code><ul><li>样式：tag=”li”、active-class=”active”、replace</li><li>导航<ul><li>普通路由：`to= “/path”</li><li>动态路由：to=”/user/12”、:to=”{ name: ‘user’, params/query: { id: 1 } }”</li></ul></li></ul></li><li><strong>渲染视图</strong>：<code>router-view</code><ul><li>命名：name=”user” 属性</li><li>缓存：keep-alive 包裹</li><li>样式：transition 包裹</li></ul></li></ul><h3 id=\"JS-编程式导航\"><a href=\"#JS-编程式导航\" class=\"headerlink\" title=\"JS 编程式导航\"></a>JS 编程式导航</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> {</span><br><span class=\"line\">    methods: {</span><br><span class=\"line\">        to_home(){   <span class=\"comment\">// 字符串 和 对象</span></span><br><span class=\"line\">            <span class=\"keyword\">this</span>.$router.push(<span class=\"string\">\"home\"</span>)      </span><br><span class=\"line\">            <span class=\"keyword\">this</span>.$router.push({ <span class=\"attr\">path</span>: <span class=\"string\">'/login?url='</span> + <span class=\"keyword\">this</span>.$route.path })  </span><br><span class=\"line\">        },</span><br><span class=\"line\">        to_user(){  <span class=\"comment\">// 命名路由 和 查询参数</span></span><br><span class=\"line\">            <span class=\"keyword\">this</span>.$router.push({ <span class=\"attr\">name</span>: <span class=\"string\">'user'</span>, <span class=\"attr\">params</span>: { <span class=\"attr\">id</span>: <span class=\"number\">123</span> }})  </span><br><span class=\"line\">            <span class=\"keyword\">this</span>.$router.push({ <span class=\"attr\">path</span>: <span class=\"string\">'user'</span>, <span class=\"attr\">query</span>: { <span class=\"attr\">id</span>: <span class=\"number\">123</span> }})   </span><br><span class=\"line\">        },</span><br><span class=\"line\">        to_other(){</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.$router.go(n)         <span class=\"comment\">// 前进</span></span><br><span class=\"line\">            <span class=\"keyword\">this</span>.$router.back()        <span class=\"comment\">// 后退</span></span><br><span class=\"line\">            <span class=\"keyword\">this</span>.$router.forward()</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.$router.replace()     <span class=\"comment\">// 替换掉当前的history记录</span></span><br><span class=\"line\">        },</span><br><span class=\"line\">        get_obj(){</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.$route)   <span class=\"comment\">// 路由对象(包括 path、params 等)</span></span><br><span class=\"line\">        }</span><br><span class=\"line\">    }   </span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"动态路由传参\"><a href=\"#动态路由传参\" class=\"headerlink\" title=\"动态路由传参\"></a>动态路由传参</h2><ul><li>方式<ul><li><strong>path</strong>：<code>to=\"/user/12\"</code></li><li><strong>params</strong>：<code>:to=\"{ name: 'user', params: { id: 1 } }\"</code></li><li><strong>query</strong>：<code>:to=\"{ name: 'user', query: { id: 1 } }\"</code></li></ul></li><li>注意<ul><li>通过 path/params 传参时，需要在路由配置中标识指定参数形式 <code>path: '/user/:id'</code></li><li>通过 params/query 传参时，参数必须是对象格式而且绑定 to 属性添加 <code>v-bind:</code></li><li>跳转后的组件中获取参数 <code>this.$route.params/query.id</code></li></ul></li></ul><h2 id=\"导航钩子\"><a href=\"#导航钩子\" class=\"headerlink\" title=\"导航钩子\"></a>导航钩子</h2><blockquote><p>用于路由跳转时执行任务或不满足条件时取消跳转</p></blockquote><h3 id=\"分类\"><a href=\"#分类\" class=\"headerlink\" title=\"分类\"></a>分类</h3><ul><li><strong>全局钩子</strong>：beforeEach，常用于登录权限等验证</li><li><strong>路由钩子</strong>：beforeLeave / beforeEnter</li><li><strong>组件钩子</strong>：<ul><li>beforeRouteLeave，用于 清除计时器, 提示保存内容, 存储信息等</li><li>beforeRouteEnter：用于在跳转完成前获取数据</li></ul></li></ul><h3 id=\"参数\"><a href=\"#参数\" class=\"headerlink\" title=\"参数\"></a>参数</h3><ul><li><strong>to</strong>：目标路由对象</li><li><strong>from</strong>：当前路由对象</li><li><strong>next</strong>：必须调用的函数，否则就是死循环<ul><li><code>next()</code>：执行下一个钩子，如果钩子全部执行完成则导航状态为 confirmed</li><li><code>next(false)</code>：中断当前导航，即重置到 from 路由对应的地址</li><li><code>next('/')、next({path: '/'})</code>：中断掉当前导航并跳转到新地址</li><li><code>next(error)</code>：如果传入一个 Error 实例，则导航被终止并会将错误传递给 router.onError() 注册的回调</li></ul></li></ul><h1 id=\"二、异步通信-Axios\"><a href=\"#二、异步通信-Axios\" class=\"headerlink\" title=\"二、异步通信 Axios\"></a>二、异步通信 Axios</h1><h2 id=\"基础使用-1\"><a href=\"#基础使用-1\" class=\"headerlink\" title=\"基础使用\"></a>基础使用</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">this</span>.$axios.get(<span class=\"string\">'/user?id=12'</span>)</span><br><span class=\"line\">    .then( <span class=\"function\"><span class=\"params\">res</span> =></span> { })</span><br><span class=\"line\">    .catch( <span class=\"function\"><span class=\"params\">err</span> =></span> { })</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> prames = <span class=\"built_in\">Object</span>.assign({}, <span class=\"keyword\">this</span>.form_data)</span><br><span class=\"line\"><span class=\"keyword\">this</span>.$axios({ </span><br><span class=\"line\">    url: url,</span><br><span class=\"line\">    method: <span class=\"string\">'post'</span>,</span><br><span class=\"line\">    data: <span class=\"keyword\">this</span>.$qs.stringify(prames)</span><br><span class=\"line\">    </span><br><span class=\"line\">}).then(<span class=\"function\">(<span class=\"params\">res</span>)=></span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(res)</span><br><span class=\"line\">})</span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// formData 形式上传数据</span></span><br><span class=\"line\">　<span class=\"keyword\">let</span> formData = <span class=\"keyword\">new</span> FormData();</span><br><span class=\"line\">formData.append(<span class=\"string\">'file'</span>, file);    </span><br><span class=\"line\">　　<span class=\"keyword\">this</span>.$axios.post(<span class=\"string\">'url'</span>, formData, {</span><br><span class=\"line\">　　　　headers:{  </span><br><span class=\"line\">　　　　   <span class=\"string\">'Content-Type'</span>:<span class=\"string\">'multipart/form-data'</span> </span><br><span class=\"line\">　　　　}</span><br><span class=\"line\">　　})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 前端使用 qs 模块</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> qs = <span class=\"built_in\">require</span>(<span class=\"string\">'qs'</span>);</span><br><span class=\"line\"><span class=\"keyword\">this</span>.$axios.post(<span class=\"string\">'/foo'</span>, qs.stringify({<span class=\"attr\">id</span>: <span class=\"number\">12</span>}))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Node环境使用 querystring 模块</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> querystring = <span class=\"built_in\">require</span>(<span class=\"string\">'querystring'</span>);</span><br><span class=\"line\"><span class=\"keyword\">this</span>.$axios.post(<span class=\"string\">'url'</span>, querystring.stringify({<span class=\"attr\">f</span>:<span class=\"string\">'a'</span>}));</span><br></pre></td></tr></tbody></table></figure><h2 id=\"请求-API\"><a href=\"#请求-API\" class=\"headerlink\" title=\"请求 API\"></a>请求 API</h2><ul><li>请求：<code>axios(config)、axios(url, [config])</code></li><li>并发：<code>axios.all(arr)、axios.spread(callback)</code></li><li>别名：<code>axios.get(url, [config])、axios.post(url, [data], [config])</code></li></ul><h2 id=\"自定义配置\"><a href=\"#自定义配置\" class=\"headerlink\" title=\"自定义配置\"></a>自定义配置</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// axios/http.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> axios <span class=\"keyword\">from</span> <span class=\"string\">'axios'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> store <span class=\"keyword\">from</span> <span class=\"string\">'@/vuex/index'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> router <span class=\"keyword\">from</span> <span class=\"string\">\"../router\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> qs <span class=\"keyword\">from</span> <span class=\"string\">\"qs\"</span>   </span><br><span class=\"line\"><span class=\"keyword\">import</span> { Loading } <span class=\"keyword\">from</span> <span class=\"string\">'element-ui'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> { Message } <span class=\"keyword\">from</span> <span class=\"string\">'element-ui'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> CancelToken = axios.CancelToken;  <span class=\"comment\">// 异步发送的请求--取消操作</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 创建axios实例</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> service = axios.create({</span><br><span class=\"line\">    baseURL: process.env.API_ROOT,</span><br><span class=\"line\">    timeout: <span class=\"number\">5000</span>,            <span class=\"comment\">// 请求超时时间</span></span><br><span class=\"line\">    responseType: <span class=\"string\">\"json\"</span>,</span><br><span class=\"line\">    <span class=\"comment\">// withCredentials: true, // 跨域请求时是否需要使用凭证(cookie等)</span></span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// service.defaults.baseURL = process.env.API_ROOT  默认配置</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 添加请求拦截器</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> loading;</span><br><span class=\"line\">service.interceptors.request.use(</span><br><span class=\"line\">    config => {</span><br><span class=\"line\">        <span class=\"comment\">// 请求时loading效果</span></span><br><span class=\"line\">        loading = Loading.service({ </span><br><span class=\"line\">            fullscreen: <span class=\"literal\">true</span>,</span><br><span class=\"line\">            lock: <span class=\"literal\">true</span>,</span><br><span class=\"line\">            text: <span class=\"string\">'Loading, please wait a moment.'</span>,</span><br><span class=\"line\">            spinner: <span class=\"string\">'el-icon-loading'</span></span><br><span class=\"line\">        });</span><br><span class=\"line\">        <span class=\"comment\">// 让每个请求携带 token</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (store.getters.token) {</span><br><span class=\"line\">            config.data = <span class=\"built_in\">Object</span>.assign({ <span class=\"attr\">token</span>: store.getters.token }, config.data)</span><br><span class=\"line\">        }</span><br><span class=\"line\">    </span><br><span class=\"line\">        <span class=\"comment\">// 设置表头  'application/json'</span></span><br><span class=\"line\">        config.headers[<span class=\"string\">'Content-Type'</span>] = <span class=\"string\">'application/json;charset=utf-8'</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 请求参数序列化</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (config.method === <span class=\"string\">'post'</span> || config.method === <span class=\"string\">\"put\"</span> || config.method === <span class=\"string\">\"delete\"</span>) {</span><br><span class=\"line\">            config.data = qs.stringify(config.data) <span class=\"comment\">// 序列化</span></span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"keyword\">let</span> cancel</span><br><span class=\"line\">        config.cancelToken = <span class=\"keyword\">new</span> CancelToken( <span class=\"function\"><span class=\"params\">c</span> =></span> {</span><br><span class=\"line\">            cancel = c;</span><br><span class=\"line\">        })</span><br><span class=\"line\">        <span class=\"comment\">// cancel()  中断请求</span></span><br><span class=\"line\">        <span class=\"comment\">// router.push('/login')</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> config;</span><br><span class=\"line\">    }, </span><br><span class=\"line\">    error => {</span><br><span class=\"line\">        Message({            </span><br><span class=\"line\">            showClose: <span class=\"literal\">true</span>,</span><br><span class=\"line\">            message: error,</span><br><span class=\"line\">            type: <span class=\"string\">\"error.data.error.message\"</span></span><br><span class=\"line\">        });</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.reject(error);</span><br><span class=\"line\">    }</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 添加响应拦截器</span></span><br><span class=\"line\">service.interceptors.response.use(</span><br><span class=\"line\">    res => {    </span><br><span class=\"line\">        <span class=\"comment\">// 请求正常则关闭动画</span></span><br><span class=\"line\">        loading.close();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 登录验证通过则跳转页面</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(res.data.status ==<span class=\"number\">2</span>){</span><br><span class=\"line\">            router.push({</span><br><span class=\"line\">                path: <span class=\"string\">\"/login\"</span>,</span><br><span class=\"line\">                query:{ <span class=\"attr\">redirect</span>: router.currentRoute.fullPath }</span><br><span class=\"line\">            })</span><br><span class=\"line\">        } </span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.resolve(res)</span><br><span class=\"line\">    },</span><br><span class=\"line\">    error => {     </span><br><span class=\"line\">        <span class=\"comment\">// 请求错误则更新状态</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> httpError = { </span><br><span class=\"line\">            hasError: <span class=\"literal\">true</span>,</span><br><span class=\"line\">            status: error.response.status,</span><br><span class=\"line\">            statusText: error.response.statusText</span><br><span class=\"line\">        }</span><br><span class=\"line\">        store.commit(<span class=\"string\">'ON_HTTP_ERROR'</span>, httpError)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.reject(error)</span><br><span class=\"line\">    }</span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> service</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// main.js 全局引用</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> http <span class=\"keyword\">from</span> <span class=\"string\">'@/assets/js/http'</span></span><br><span class=\"line\">Vue.prototype.$axios = http</span><br></pre></td></tr></tbody></table></figure><h2 id=\"本地模拟数据\"><a href=\"#本地模拟数据\" class=\"headerlink\" title=\"本地模拟数据\"></a>本地模拟数据</h2><h3 id=\"自定义配置-1\"><a href=\"#自定义配置-1\" class=\"headerlink\" title=\"自定义配置\"></a>自定义配置</h3><blockquote><p>数据 static/data.json</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// webpack.dev.conf.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> portfinder = <span class=\"built_in\">require</span>(<span class=\"string\">'portfinder'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 模拟数据添加部分   开始</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = express()                    <span class=\"comment\">// 创建express应用程序</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> appData = <span class=\"built_in\">require</span>(<span class=\"string\">'../data.json'</span>)    <span class=\"comment\">// 加载本地数据文件</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> seller = appData.seller              <span class=\"comment\">// 获取对应的本地数据</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> goods = appData.goods</span><br><span class=\"line\"><span class=\"keyword\">var</span> ratings = appData.ratings</span><br><span class=\"line\"><span class=\"keyword\">var</span> apiRoutes = express.Router()        <span class=\"comment\">// 获取一个 express 的路由实例</span></span><br><span class=\"line\">app.use(<span class=\"string\">'/api'</span>, apiRoutes)              <span class=\"comment\">// 定义数据输出接口</span></span><br><span class=\"line\"><span class=\"comment\">// 结束</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> devWebpackConfig = merge(baseWebpackConfig, {</span><br><span class=\"line\">  devServer: {</span><br><span class=\"line\">      <span class=\"comment\">// 最后添加接口选项</span></span><br><span class=\"line\">      before(app) {  <span class=\"comment\">//  模拟数据选项</span></span><br><span class=\"line\">          app.get(<span class=\"string\">'/api/seller'</span>, (req, res) => {</span><br><span class=\"line\">              res.json({ <span class=\"attr\">errno</span>: <span class=\"number\">0</span>, <span class=\"attr\">data</span>: seller }) </span><br><span class=\"line\">          }),</span><br><span class=\"line\">          app.post(<span class=\"string\">'/api/foods'</span>, (req, res) => { </span><br><span class=\"line\">              res.json({ <span class=\"attr\">errno</span>: <span class=\"number\">0</span>, <span class=\"attr\">data</span>: foods })</span><br><span class=\"line\">          })</span><br><span class=\"line\">      }</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h3 id=\"通过-mockjs\"><a href=\"#通过-mockjs\" class=\"headerlink\" title=\"通过 mockjs\"></a>通过 mockjs</h3><ul><li>安装：<code>cnpm install mockjs -S</code></li><li>定义：<code>src/mack/index.js</code></li><li>引入：<code>import './mock'</code></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// src/mack/index.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> Mock <span class=\"keyword\">from</span> <span class=\"string\">'mockjs'</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> Random = Mock.Random   <span class=\"comment\">// 随机函数</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> data =  <span class=\"function\"><span class=\"params\">()</span> =></span> {</span><br><span class=\"line\">    <span class=\"keyword\">let</span> arr = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) {</span><br><span class=\"line\">        <span class=\"keyword\">let</span> newArticleObject = {</span><br><span class=\"line\">            title: Random.csentence(<span class=\"number\">5</span>),</span><br><span class=\"line\">            content: Random.cparagraph(<span class=\"number\">5</span>, <span class=\"number\">7</span>),</span><br><span class=\"line\">            time: Random.date() + <span class=\"string\">' '</span> + Random.time(),</span><br><span class=\"line\">            location: Random.city()</span><br><span class=\"line\">        }</span><br><span class=\"line\">        arr.push(newArticleObject)</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> {arr}</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"comment\">// 第三个参数可以是 对象/返回对象的函数</span></span><br><span class=\"line\">Mock.mock(<span class=\"string\">'/api/data'</span>, <span class=\"string\">'get'</span>, data)</span><br></pre></td></tr></tbody></table></figure><h1 id=\"三、状态管理-Vuex\"><a href=\"#三、状态管理-Vuex\" class=\"headerlink\" title=\"三、状态管理 Vuex\"></a>三、状态管理 Vuex</h1><h2 id=\"核心概念\"><a href=\"#核心概念\" class=\"headerlink\" title=\"核心概念\"></a>核心概念</h2><blockquote><p>本质是一个挂载到 vue 实例的全局变量对象 store，它的属性和方法负责管理所有组件的状态及其更新</p></blockquote><ul><li><strong>state</strong>：包含所有应用级别状态的对象 (组件用到的数据)</li><li><strong>getters</strong>：派生出 state 所需数据 (计算属性)</li><li><strong>mutators</strong>：更新 state 的唯一方式 (同步更新)</li><li><strong>actions</strong>：异步提交 mutaions 更新状态 (异步更新)</li><li><strong>module</strong>：划分为不同模块管理 (方便维护大型项目)</li></ul><h2 id=\"单向数据流\"><a href=\"#单向数据流\" class=\"headerlink\" title=\"单向数据流\"></a>单向数据流</h2><div style=\"text-indent:2em\">通过 vue Devtools 调试工具可以轻松查看状态变化，用户界面负责触发动作 Action 进而改变对应状态 State，从而反映到视图 View 上，所以 State 数据的流向为：<code>View --> Actions --> mutators --> State --> View</code></div><div align=\"center\"><br><img src=\"images/vue/vuex_base.png\" alt=\"Vuex 实现原理\"><br></div><h2 id=\"目录结构\"><a href=\"#目录结构\" class=\"headerlink\" title=\"目录结构\"></a>目录结构</h2><blockquote><p>如果 store 文件太大则需要分割到单独文件</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">store</span><br><span class=\"line\">  ├── index.js         <span class=\"comment\">// 组装模块并导出store </span></span><br><span class=\"line\">  ├── actions.js       <span class=\"comment\">// 根级别的 action</span></span><br><span class=\"line\">  ├── mutations.js     <span class=\"comment\">// 根级别的 mutation</span></span><br><span class=\"line\">  └── modules          <span class=\"comment\">// 大型应用时分割到模块</span></span><br><span class=\"line\">      ├── cart.js      <span class=\"comment\">// 购物车模块</span></span><br><span class=\"line\">      └── products.js  <span class=\"comment\">// 产品模块</span></span><br></pre></td></tr></tbody></table></figure><h2 id=\"自定义配置-2\"><a href=\"#自定义配置-2\" class=\"headerlink\" title=\"自定义配置\"></a>自定义配置</h2><h3 id=\"单个文件\"><a href=\"#单个文件\" class=\"headerlink\" title=\"单个文件\"></a>单个文件</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// vuex/store.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> Vue <span class=\"keyword\">from</span> <span class=\"string\">'vue'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> Vuex <span class=\"keyword\">from</span> <span class=\"string\">'vuex'</span></span><br><span class=\"line\">Vue.use(Vuex)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// state 状态变量 </span></span><br><span class=\"line\"><span class=\"keyword\">const</span> state = {    </span><br><span class=\"line\">    count: <span class=\"number\">1</span>,</span><br><span class=\"line\">    isShow: <span class=\"literal\">false</span> </span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// state 的计算属性：派生所需状态)</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> getters = {</span><br><span class=\"line\">    countNew: <span class=\"function\"><span class=\"params\">state</span> =></span> {  </span><br><span class=\"line\">        <span class=\"keyword\">return</span> state.count * <span class=\"number\">10</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 更新 state 的逻辑方法 (commit mutation 触发)</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> mutations={</span><br><span class=\"line\">    add(state){     </span><br><span class=\"line\">        state.count += <span class=\"number\">1</span>;</span><br><span class=\"line\">    },</span><br><span class=\"line\">    reduce(state,n){  <span class=\"comment\">// 第二个参数可自定义类型   </span></span><br><span class=\"line\">        state.count -= n;</span><br><span class=\"line\">    },</span><br><span class=\"line\">    tog(state){  </span><br><span class=\"line\">        state.isShow = !state.isShow;</span><br><span class=\"line\">    },</span><br><span class=\"line\">    init(state){</span><br><span class=\"line\">        state.count = <span class=\"number\">1</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 更新 state 的异步逻辑 (dispatch actions 触发)</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> actions = {</span><br><span class=\"line\">    <span class=\"comment\">// 完整写法  </span></span><br><span class=\"line\">    add_all: <span class=\"function\">(<span class=\"params\">context</span>) =></span> { context.commit(<span class=\"string\">'add'</span>) },</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 简写写法  同步提交(实时跟踪)</span></span><br><span class=\"line\">    add: <span class=\"function\">(<span class=\"params\">{ commit }</span>) =></span> commit(<span class=\"string\">'add'</span>), </span><br><span class=\"line\">    reduce: <span class=\"function\">(<span class=\"params\">{ commit },n</span>) =></span> commit(<span class=\"string\">'reduce'</span>,n), </span><br><span class=\"line\"></span><br><span class=\"line\">    tog: <span class=\"function\">(<span class=\"params\">{ commit }</span>) =></span> commit(<span class=\"string\">'tog'</span>), </span><br><span class=\"line\">    init: <span class=\"function\">(<span class=\"params\">{ commit }</span>) =></span> commit(<span class=\"string\">'init'</span>), </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 异步提交</span></span><br><span class=\"line\">    addAsync: <span class=\"function\">(<span class=\"params\">{ commit }</span>) =></span> {  </span><br><span class=\"line\">        setTimeout (<span class=\"function\"><span class=\"params\">()</span> =></span> {</span><br><span class=\"line\">            commit(<span class=\"string\">'add'</span>); </span><br><span class=\"line\">        }, <span class=\"number\">1000</span>);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 分割成不同模块使用：方便管理</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> modules = {   </span><br><span class=\"line\">    <span class=\"comment\">// 每个module中都有state等, 获取时 store.state.a</span></span><br><span class=\"line\">    a: {</span><br><span class=\"line\">        state: { <span class=\"attr\">count</span>: <span class=\"number\">0</span>},</span><br><span class=\"line\">        <span class=\"comment\">// 参数 模块的局部状态state,getter和根节点状态</span></span><br><span class=\"line\">        getters: {  </span><br><span class=\"line\">            sum (state, getters, rootState) {</span><br><span class=\"line\">                <span class=\"keyword\">return</span> state.count + rootState.count</span><br><span class=\"line\">            }</span><br><span class=\"line\">        },</span><br><span class=\"line\">        mutations: {    <span class=\"comment\">//模块的局部状态state</span></span><br><span class=\"line\">            increment(state){</span><br><span class=\"line\">                state.count ++ ;</span><br><span class=\"line\">            }</span><br><span class=\"line\">        },</span><br><span class=\"line\">        actions: { </span><br><span class=\"line\">            incrementIf ({ state, commit, rootState }) {</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ((state.count + rootState.count) % <span class=\"number\">2</span> === <span class=\"number\">1</span>) {</span><br><span class=\"line\">                    commit(<span class=\"string\">'increment'</span>)</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    },  </span><br><span class=\"line\">    b: { }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 注册所有模块并导出</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> store = <span class=\"keyword\">new</span> Vuex.Store({</span><br><span class=\"line\">    state,</span><br><span class=\"line\">    mutations,</span><br><span class=\"line\">    actions,</span><br><span class=\"line\">    getters,</span><br><span class=\"line\">    <span class=\"comment\">// modules  导出 modules 时就不需要导出以上变量了</span></span><br><span class=\"line\">})</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> store</span><br></pre></td></tr></tbody></table></figure><h3 id=\"文件拆分\"><a href=\"#文件拆分\" class=\"headerlink\" title=\"文件拆分\"></a>文件拆分</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// vuex/index.js：vuex 入口函数，在 main.js 中引入</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> Vue <span class=\"keyword\">from</span> <span class=\"string\">'vue'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> Vuex <span class=\"keyword\">from</span> <span class=\"string\">'vuex'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> * <span class=\"keyword\">as</span> getters <span class=\"keyword\">from</span> <span class=\"string\">'./getters'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> * <span class=\"keyword\">as</span> actions <span class=\"keyword\">from</span> <span class=\"string\">'./actions'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> * <span class=\"keyword\">as</span> mutations <span class=\"keyword\">from</span> <span class=\"string\">'./mutations'</span></span><br><span class=\"line\">Vue.use(Vuex)</span><br><span class=\"line\"><span class=\"keyword\">const</span> state = {  <span class=\"comment\">// 声明状态</span></span><br><span class=\"line\">        count: <span class=\"number\">0</span>, <span class=\"attr\">isShow</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">const</span> store = <span class=\"keyword\">new</span> Vuex.Store({  <span class=\"comment\">// 注册模块</span></span><br><span class=\"line\">        state, getters, actions, mutations</span><br><span class=\"line\">})</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> store</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// vuex/getters.js：获取状态信息</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> countNew = <span class=\"function\"><span class=\"params\">state</span> =></span> state.count*<span class=\"number\">10</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// vuex/mutations.js：同步操作状态值</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> init = <span class=\"function\"><span class=\"params\">state</span> =></span> { state.count = <span class=\"number\">1</span> }</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> add = <span class=\"function\"><span class=\"params\">state</span> =></span> {  state.count += <span class=\"number\">1</span> }</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> reduce = <span class=\"function\">(<span class=\"params\">state,n</span>) =></span> { state.count -= n }</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> tog = <span class=\"function\"><span class=\"params\">state</span> =></span> { state.isShow = !state.isShow }</span><br><span class=\"line\">        </span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"comment\">// vuex/actions.js：异步处理逻辑</span></span><br><span class=\"line\"><span class=\"comment\">// 完整写法</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> _add = <span class=\"function\">(<span class=\"params\">context</span>) =></span> { context.commit(<span class=\"string\">'add'</span>) }</span><br><span class=\"line\"><span class=\"comment\">// 以下为简写写法</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> init = <span class=\"function\">(<span class=\"params\">{ commit }</span>) =></span> commit(<span class=\"string\">'init'</span>)\t</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> add = <span class=\"function\">(<span class=\"params\">{ commit }</span>) =></span> commit(<span class=\"string\">'add'</span>)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> reduce = <span class=\"function\">(<span class=\"params\">{ commit },n</span>) =></span> commit(<span class=\"string\">'reduce'</span>,n)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> tog = <span class=\"function\">(<span class=\"params\">{ commit }</span>) =></span> commit(<span class=\"string\">'tog'</span>)</span><br></pre></td></tr></tbody></table></figure><h2 id=\"全局引用\"><a href=\"#全局引用\" class=\"headerlink\" title=\"全局引用\"></a>全局引用</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// main.js </span></span><br><span class=\"line\"><span class=\"keyword\">import</span> store <span class=\"keyword\">from</span> <span class=\"string\">'./vuex'</span>  </span><br><span class=\"line\"><span class=\"keyword\">new</span> Vue({</span><br><span class=\"line\">    el: <span class=\"string\">'#app'</span>,</span><br><span class=\"line\">    router,</span><br><span class=\"line\">    store,</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h2 id=\"组件使用\"><a href=\"#组件使用\" class=\"headerlink\" title=\"组件使用\"></a>组件使用</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> { mapState, mapGetters, mapMutations, mapActions } </span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> {</span><br><span class=\"line\">  data(){</span><br><span class=\"line\">      <span class=\"keyword\">return</span>{</span><br><span class=\"line\">          localState: <span class=\"number\">2</span></span><br><span class=\"line\">      }</span><br><span class=\"line\">  },</span><br><span class=\"line\">  watch:{</span><br><span class=\"line\">      isShow: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{    <span class=\"comment\">// 隐藏时初始化count</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span>(!<span class=\"keyword\">this</span>.show){</span><br><span class=\"line\">              <span class=\"keyword\">this</span>.$store.commit(<span class=\"string\">'init'</span>) </span><br><span class=\"line\">          }</span><br><span class=\"line\">      }</span><br><span class=\"line\">  },</span><br><span class=\"line\">  <span class=\"comment\">// 普通写法</span></span><br><span class=\"line\">  computed: {     </span><br><span class=\"line\">      count () {</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.$store.state.count;  </span><br><span class=\"line\">          <span class=\"comment\">// getters.countNew  </span></span><br><span class=\"line\">      },</span><br><span class=\"line\">      isShow(){</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.$store.state.isShow;</span><br><span class=\"line\">      }</span><br><span class=\"line\">  },</span><br><span class=\"line\">  <span class=\"comment\">// 简洁写法：使用辅助函数返回对象并映射到组件实例</span></span><br><span class=\"line\">  computed: mapState({  </span><br><span class=\"line\">      count: <span class=\"function\"><span class=\"params\">state</span> =></span> state.count, </span><br><span class=\"line\">      countAlias: <span class=\"string\">'count'</span>,      <span class=\"comment\">// 改变名称</span></span><br><span class=\"line\">      countPlus(state){         <span class=\"comment\">// 使this指向组件对象</span></span><br><span class=\"line\">          <span class=\"keyword\">return</span> state.count + <span class=\"keyword\">this</span>.localState; </span><br><span class=\"line\">      },</span><br><span class=\"line\">  }),</span><br><span class=\"line\">  computed: mapState([<span class=\"string\">'count'</span>,<span class=\"string\">'isShow'</span>]),  <span class=\"comment\">// 名称相同</span></span><br><span class=\"line\">  computed: {</span><br><span class=\"line\">      local(){         <span class=\"comment\">// 组件数据</span></span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.localState;</span><br><span class=\"line\">      },</span><br><span class=\"line\">      <span class=\"comment\">// 使用对象展开运算符将数据混入 computed 对象</span></span><br><span class=\"line\"></span><br><span class=\"line\">      ...mapState([    <span class=\"comment\">// 映射 State</span></span><br><span class=\"line\">          <span class=\"string\">'count'</span>,</span><br><span class=\"line\">          <span class=\"string\">'isShow'</span></span><br><span class=\"line\">      ]),</span><br><span class=\"line\">      ...mapGetters([  <span class=\"comment\">// 映射 Getters </span></span><br><span class=\"line\">          <span class=\"string\">'countNew'</span></span><br><span class=\"line\">      ])</span><br><span class=\"line\">  }, </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  methods: {   </span><br><span class=\"line\">      reduce(){     <span class=\"comment\">// 有参数时需单独定义</span></span><br><span class=\"line\">          <span class=\"keyword\">this</span>.$store.commit(<span class=\"string\">'add'</span>)           <span class=\"comment\">// 同步</span></span><br><span class=\"line\">          <span class=\"keyword\">this</span>.$store.dispatch(<span class=\"string\">'reduce'</span>, <span class=\"number\">2</span>)   <span class=\"comment\">// 异步</span></span><br><span class=\"line\">      },</span><br><span class=\"line\">      ...mapActions([  <span class=\"comment\">// 映射 Mutations</span></span><br><span class=\"line\">          <span class=\"string\">'add'</span>,  </span><br><span class=\"line\">          <span class=\"string\">'tog'</span>,</span><br><span class=\"line\">          <span class=\"string\">'addAsync'</span></span><br><span class=\"line\">      ]),</span><br><span class=\"line\">  },</span><br><span class=\"line\">  methods: mapActions([<span class=\"string\">'add'</span>])</span><br><span class=\"line\">  methods: mapMutations([<span class=\"string\">'add'</span>])</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><!-- rebuild by neat --></body></html>","site":{"data":{"next":{"override":false,"cache":{"enable":true},"favicon":{"small":"/images/favicon-16.ico","medium":"/images/favicon-32.ico","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"rss":"/atom.xml","footer":{"since":2019,"icon":{"name":"snowflake-o","animated":false,"color":"#808080"},"copyright":"chuangge","powered":{"enable":false,"version":true},"theme":{"enable":false,"version":true},"beian":{"enable":false,"icp":null}},"creative_commons":{"license":"by-nc-sa","sidebar":false,"post":false},"canonical":true,"seo":false,"index_with_subtitle":false,"exturl":false,"menu":{"home":"/ || home  //首页","tags":"/tags/ || tags  //标签","categories":"/categories/ || th   //分类","archives":"/archives/ || archive //归档"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":{"GitHub":"https://github.com/ || github","StackOverflow":"https://stackoverflow.com/ || stack-overflow"},"social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"友情链接","links_layout":"inline","links":{"个人简历":"https://chuanggefighting.github.io/project/","印记中文":"https://www.docschina.org/","在线工具":"http://tool.lu/","Learn Anything":"https://learn-anything.xyz/"},"avatar":{"url":"/images/chuang.png","rounded":true,"opacity":1,"rotated":true},"toc":{"enable":true,"number":true,"wrap":false,"max_depth":6},"sidebar":{"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"read_more_btn":true,"post_meta":{"item_text":true,"created_at":true,"updated_at":{"enabled":true,"another_day":true},"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":true,"awl":4,"wpm":275},"codeblock":{"border_radius":null,"copy_button":{"enable":false,"show_result":false}},"reward":{"enable":false},"related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_edit":{"enable":false,"url":"https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name"},"disable_baidu_tranformation":false,"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"font":{"enable":true,"host":"//fonts.proxy.ustclug.org","global":{"external":true,"family":"Lato","size":16},"headings":{"external":true,"family":"Roboto Slab","size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":"Lobster Two","size":24},"codes":{"external":true,"family":"Roboto Mono","size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css","copy_tex":{"enable":false,"copy_tex_js":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js","copy_tex_css":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css"}}},"pdf":{"enable":false,"per_page":true,"height":"500px","pdfobject":{"cdn":"//cdn.jsdelivr.net/npm/pdfobject@2.1.1/pdfobject.min.js"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":true,"appid":"snOvapuSplYTVflf5p9Ml9JX-gzGzoHsz","appkey":"5ABGdfyEdAtu6lTXdGdo7hf9","notify":false,"verify":false,"placeholder":"ヾﾉ≧∀≦)o 来呀！吐槽一番吧！","avatar":"mm","guest_info":"nick,mail,link","pageSize":10,"visitor":false,"comment_count":true},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"gitalk":{"enable":false,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true},"needmoreshare2":{"enable":true,"postbottom":{"enable":true,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null,"security":false,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":true,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":true,"pace_theme":"pace-theme-center-simple","canvas_nest":{"enable":true,"onmobile":true,"color":"0,0,255","opacity":0.5,"zIndex":-1,"count":99},"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"canvas_nest_nomobile":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"leancloud":null,"valine":null,"gitalk_js":null,"gitalk_css":null,"md5":null},"css":"css","js":"js","images":"images","passage_end_tag":{"enabled":true},"daovoice":true,"daovoice_app_id":"2ed51855"}}},"excerpt":"","more":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><h1 id=\"一、路由控制-Router\"><a href=\"#一、路由控制-Router\" class=\"headerlink\" title=\"一、路由控制 Router\"></a>一、路由控制 Router</h1><h2 id=\"基础使用\"><a href=\"#基础使用\" class=\"headerlink\" title=\"基础使用\"></a>基础使用</h2><blockquote><p>将组件映射到路由，然后通过 vue-router 渲染</p></blockquote><ol><li>定义组件：<code>user.vue</code></li><li>定义路由配置：<code>var routes = []</code></li><li>生成路由对象：<code>var router = new VueRouter({ routes: routes })</code></li><li>注入到实例对象：<code>var app = new Vue({ el: &#39;#app&#39;, router, })</code></li><li>组件中定义渲染标签：<code>router-link、router-view</code></li></ol><h2 id=\"路由配置\"><a href=\"#路由配置\" class=\"headerlink\" title=\"路由配置\"></a>路由配置</h2><ul><li>命名路由：<code>name: &#39;home&#39;</code></li><li>嵌套路由：<code>children: [{ }]</code></li><li>动态路由：<code>path: &#39;/user/:id&#39;</code></li><li>命名视图：<code>components: { }</code></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// router/index.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> Router <span class=\"keyword\">from</span> <span class=\"string\">'vue-router'</span></span><br><span class=\"line\">Vue.use(Router)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> user <span class=\"keyword\">from</span> <span class=\"string\">'@/components/user'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> home <span class=\"keyword\">from</span> <span class=\"string\">'@/components/home'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 路由懒加载</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> home = <span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> <span class=\"built_in\">require</span>([<span class=\"string\">'@/components/Home.vue'</span>], resolve)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">new</span> Router(&#123;</span><br><span class=\"line\">  mode: <span class=\"string\">'hash'</span>,               <span class=\"comment\">// 路径模式 </span></span><br><span class=\"line\">  base: <span class=\"string\">'/app/'</span>,              <span class=\"comment\">// 基路径(默认'/')</span></span><br><span class=\"line\">  linkActiveClass: <span class=\"string\">'active'</span>,  <span class=\"comment\">// 链接激活时的class</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// history 模式下滚动行为，路由切换时页面滚动到指定位置</span></span><br><span class=\"line\">  scrollBehavior (to, <span class=\"keyword\">from</span>, savedPosition) &#123; </span><br><span class=\"line\">      <span class=\"keyword\">if</span>(savedPosition)&#123;  </span><br><span class=\"line\">      <span class=\"keyword\">return</span> savedPosition  <span class=\"comment\">// 原位置</span></span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> &#123;<span class=\"attr\">x</span>: <span class=\"number\">0</span>,<span class=\"attr\">y</span>: <span class=\"number\">0</span>&#125;;   <span class=\"comment\">// 顶部</span></span><br><span class=\"line\">      &#125; </span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"keyword\">if</span>(to.hash)&#123;             <span class=\"comment\">// 锚点定位</span></span><br><span class=\"line\">          <span class=\"keyword\">return</span> &#123;<span class=\"attr\">selector</span>: to.hash&#125; </span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  </span><br><span class=\"line\">  routes: [     <span class=\"comment\">// 路由配置</span></span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        title: <span class=\"string\">'登录页'</span>,</span><br><span class=\"line\">        alias: <span class=\"string\">'/b'</span>,       <span class=\"comment\">// 路径别名</span></span><br><span class=\"line\"></span><br><span class=\"line\">        path: <span class=\"string\">'/'</span>, </span><br><span class=\"line\">        name: <span class=\"string\">'Index'</span>,</span><br><span class=\"line\">        redirect: <span class=\"string\">'/home'</span>, <span class=\"comment\">// 重定向(解决首次进入页面时不显示内容的问题)</span></span><br><span class=\"line\">        component: home</span><br><span class=\"line\">      &#125;, </span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        path:<span class=\"string\">\"/home\"</span>,     <span class=\"comment\">// 静态路由</span></span><br><span class=\"line\">        name: <span class=\"string\">'home'</span>,</span><br><span class=\"line\">        component: home,</span><br><span class=\"line\">        children: [&#123;       <span class=\"comment\">// 嵌套路由(须先进 home) </span></span><br><span class=\"line\">            path: <span class=\"string\">\"/phone\"</span>,</span><br><span class=\"line\">            name: <span class=\"string\">\"phone\"</span>,</span><br><span class=\"line\">            component: phone</span><br><span class=\"line\">        &#125;]</span><br><span class=\"line\">      &#125;,                  </span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">\"user\"</span>,    </span><br><span class=\"line\">        path: <span class=\"string\">'/user/:id'</span>,  <span class=\"comment\">// 动态路由(指定参数形式)   </span></span><br><span class=\"line\">        component: user,    </span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        path: <span class=\"string\">'/name'</span>,</span><br><span class=\"line\">        components: &#123;      <span class=\"comment\">// 命名视图(同时渲染多个组件)</span></span><br><span class=\"line\">            <span class=\"keyword\">default</span>: Foo,</span><br><span class=\"line\">            a: Bar,</span><br><span class=\"line\">            b: Baz</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h2 id=\"路由模式\"><a href=\"#路由模式\" class=\"headerlink\" title=\"路由模式\"></a>路由模式</h2><h3 id=\"两种模式\"><a href=\"#两种模式\" class=\"headerlink\" title=\"两种模式\"></a>两种模式</h3><blockquote><p>应用于浏览器的历史记录站，在当前已有的 back、forward、go 的基础上提供了对历史记录进行修改的功能。只是当它们执行修改时，虽然改变了当前URL，但浏览器不会立即向后端发送请求。</p></blockquote><ul><li><strong>hash</strong>：默认模式，浏览器地址中的 # 及其后面的字符串称为 hash，可以通过 window.location.hash 读取，它用来模拟一个完整 URL 但不会被包括在 HTTP 请求中，改变时不会重新加载页面。</li><li><strong>history</strong>：利用了 HTML5 新增方法，pushState()、replaceState() 用来对浏览器历史记录栈进行修改，popState 事件用来监听到状态变化。</li></ul><h3 id=\"404-错误\"><a href=\"#404-错误\" class=\"headerlink\" title=\"404 错误\"></a>404 错误</h3><ul><li><strong>hash 模式</strong>：只有 # 前面的内容会被包含在请求中。因此对于后端来说，即使没有做到对路由的全覆盖也不会返回404错误</li><li><strong>history 模式</strong>：前端的url必须和实际向后端发起请求的url 一致，比如 /book/id ，如果后端缺少对该路由的处理则返回 404 错误</li></ul><h3 id=\"注意问题\"><a href=\"#注意问题\" class=\"headerlink\" title=\"注意问题\"></a>注意问题</h3><div style=\"text-indent:2em\">app 开发时一般需要分享页面到第三方 app，但部分 url 不允许带 #。去除 # 需要使用 history 模式，但是有一个问题：在访问二级页面时，刷新操作则会出现 404 错误，那么就需要和后端一起配置 apache 或是 nginx url 重定向，重定向到你的首页路由上即可。</div><h2 id=\"路由跳转\"><a href=\"#路由跳转\" class=\"headerlink\" title=\"路由跳转\"></a>路由跳转</h2><h3 id=\"CSS-标签跳转\"><a href=\"#CSS-标签跳转\" class=\"headerlink\" title=\"CSS 标签跳转\"></a>CSS 标签跳转</h3><ul><li><strong>跳转标签</strong>：<code>router-link</code><ul><li>样式：tag=”li”、active-class=”active”、replace</li><li>导航<ul><li>普通路由：`to= “/path”</li><li>动态路由：to=”/user/12”、:to=”{ name: ‘user’, params/query: { id: 1 } }”</li></ul></li></ul></li><li><strong>渲染视图</strong>：<code>router-view</code><ul><li>命名：name=”user” 属性</li><li>缓存：keep-alive 包裹</li><li>样式：transition 包裹</li></ul></li></ul><h3 id=\"JS-编程式导航\"><a href=\"#JS-编程式导航\" class=\"headerlink\" title=\"JS 编程式导航\"></a>JS 编程式导航</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">    methods: &#123;</span><br><span class=\"line\">        to_home()&#123;   <span class=\"comment\">// 字符串 和 对象</span></span><br><span class=\"line\">            <span class=\"keyword\">this</span>.$router.push(<span class=\"string\">\"home\"</span>)      </span><br><span class=\"line\">            <span class=\"keyword\">this</span>.$router.push(&#123; <span class=\"attr\">path</span>: <span class=\"string\">'/login?url='</span> + <span class=\"keyword\">this</span>.$route.path &#125;)  </span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        to_user()&#123;  <span class=\"comment\">// 命名路由 和 查询参数</span></span><br><span class=\"line\">            <span class=\"keyword\">this</span>.$router.push(&#123; <span class=\"attr\">name</span>: <span class=\"string\">'user'</span>, <span class=\"attr\">params</span>: &#123; <span class=\"attr\">id</span>: <span class=\"number\">123</span> &#125;&#125;)  </span><br><span class=\"line\">            <span class=\"keyword\">this</span>.$router.push(&#123; <span class=\"attr\">path</span>: <span class=\"string\">'user'</span>, <span class=\"attr\">query</span>: &#123; <span class=\"attr\">id</span>: <span class=\"number\">123</span> &#125;&#125;)   </span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        to_other()&#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.$router.go(n)         <span class=\"comment\">// 前进</span></span><br><span class=\"line\">            <span class=\"keyword\">this</span>.$router.back()        <span class=\"comment\">// 后退</span></span><br><span class=\"line\">            <span class=\"keyword\">this</span>.$router.forward()</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.$router.replace()     <span class=\"comment\">// 替换掉当前的history记录</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        get_obj()&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.$route)   <span class=\"comment\">// 路由对象(包括 path、params 等)</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;   </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"动态路由传参\"><a href=\"#动态路由传参\" class=\"headerlink\" title=\"动态路由传参\"></a>动态路由传参</h2><ul><li>方式<ul><li><strong>path</strong>：<code>to=&quot;/user/12&quot;</code></li><li><strong>params</strong>：<code>:to=&quot;{ name: &#39;user&#39;, params: { id: 1 } }&quot;</code></li><li><strong>query</strong>：<code>:to=&quot;{ name: &#39;user&#39;, query: { id: 1 } }&quot;</code></li></ul></li><li>注意<ul><li>通过 path/params 传参时，需要在路由配置中标识指定参数形式 <code>path: &#39;/user/:id&#39;</code></li><li>通过 params/query 传参时，参数必须是对象格式而且绑定 to 属性添加 <code>v-bind:</code></li><li>跳转后的组件中获取参数 <code>this.$route.params/query.id</code></li></ul></li></ul><h2 id=\"导航钩子\"><a href=\"#导航钩子\" class=\"headerlink\" title=\"导航钩子\"></a>导航钩子</h2><blockquote><p>用于路由跳转时执行任务或不满足条件时取消跳转</p></blockquote><h3 id=\"分类\"><a href=\"#分类\" class=\"headerlink\" title=\"分类\"></a>分类</h3><ul><li><strong>全局钩子</strong>：beforeEach，常用于登录权限等验证</li><li><strong>路由钩子</strong>：beforeLeave / beforeEnter</li><li><strong>组件钩子</strong>：<ul><li>beforeRouteLeave，用于 清除计时器, 提示保存内容, 存储信息等</li><li>beforeRouteEnter：用于在跳转完成前获取数据</li></ul></li></ul><h3 id=\"参数\"><a href=\"#参数\" class=\"headerlink\" title=\"参数\"></a>参数</h3><ul><li><strong>to</strong>：目标路由对象</li><li><strong>from</strong>：当前路由对象</li><li><strong>next</strong>：必须调用的函数，否则就是死循环<ul><li><code>next()</code>：执行下一个钩子，如果钩子全部执行完成则导航状态为 confirmed</li><li><code>next(false)</code>：中断当前导航，即重置到 from 路由对应的地址</li><li><code>next(&#39;/&#39;)、next({path: &#39;/&#39;})</code>：中断掉当前导航并跳转到新地址</li><li><code>next(error)</code>：如果传入一个 Error 实例，则导航被终止并会将错误传递给 router.onError() 注册的回调</li></ul></li></ul><h1 id=\"二、异步通信-Axios\"><a href=\"#二、异步通信-Axios\" class=\"headerlink\" title=\"二、异步通信 Axios\"></a>二、异步通信 Axios</h1><h2 id=\"基础使用-1\"><a href=\"#基础使用-1\" class=\"headerlink\" title=\"基础使用\"></a>基础使用</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">this</span>.$axios.get(<span class=\"string\">'/user?id=12'</span>)</span><br><span class=\"line\">    .then( <span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123; &#125;)</span><br><span class=\"line\">    .catch( <span class=\"function\"><span class=\"params\">err</span> =&gt;</span> &#123; &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> prames = <span class=\"built_in\">Object</span>.assign(&#123;&#125;, <span class=\"keyword\">this</span>.form_data)</span><br><span class=\"line\"><span class=\"keyword\">this</span>.$axios(&#123; </span><br><span class=\"line\">    url: url,</span><br><span class=\"line\">    method: <span class=\"string\">'post'</span>,</span><br><span class=\"line\">    data: <span class=\"keyword\">this</span>.$qs.stringify(prames)</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;).then(<span class=\"function\">(<span class=\"params\">res</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(res)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// formData 形式上传数据</span></span><br><span class=\"line\">　<span class=\"keyword\">let</span> formData = <span class=\"keyword\">new</span> FormData();</span><br><span class=\"line\">formData.append(<span class=\"string\">'file'</span>, file);    </span><br><span class=\"line\">　　<span class=\"keyword\">this</span>.$axios.post(<span class=\"string\">'url'</span>, formData, &#123;</span><br><span class=\"line\">　　　　headers:&#123;  </span><br><span class=\"line\">　　　　   <span class=\"string\">'Content-Type'</span>:<span class=\"string\">'multipart/form-data'</span> </span><br><span class=\"line\">　　　　&#125;</span><br><span class=\"line\">　　&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 前端使用 qs 模块</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> qs = <span class=\"built_in\">require</span>(<span class=\"string\">'qs'</span>);</span><br><span class=\"line\"><span class=\"keyword\">this</span>.$axios.post(<span class=\"string\">'/foo'</span>, qs.stringify(&#123;<span class=\"attr\">id</span>: <span class=\"number\">12</span>&#125;))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Node环境使用 querystring 模块</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> querystring = <span class=\"built_in\">require</span>(<span class=\"string\">'querystring'</span>);</span><br><span class=\"line\"><span class=\"keyword\">this</span>.$axios.post(<span class=\"string\">'url'</span>, querystring.stringify(&#123;<span class=\"attr\">f</span>:<span class=\"string\">'a'</span>&#125;));</span><br></pre></td></tr></table></figure><h2 id=\"请求-API\"><a href=\"#请求-API\" class=\"headerlink\" title=\"请求 API\"></a>请求 API</h2><ul><li>请求：<code>axios(config)、axios(url, [config])</code></li><li>并发：<code>axios.all(arr)、axios.spread(callback)</code></li><li>别名：<code>axios.get(url, [config])、axios.post(url, [data], [config])</code></li></ul><h2 id=\"自定义配置\"><a href=\"#自定义配置\" class=\"headerlink\" title=\"自定义配置\"></a>自定义配置</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// axios/http.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> axios <span class=\"keyword\">from</span> <span class=\"string\">'axios'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> store <span class=\"keyword\">from</span> <span class=\"string\">'@/vuex/index'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> router <span class=\"keyword\">from</span> <span class=\"string\">\"../router\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> qs <span class=\"keyword\">from</span> <span class=\"string\">\"qs\"</span>   </span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Loading &#125; <span class=\"keyword\">from</span> <span class=\"string\">'element-ui'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Message &#125; <span class=\"keyword\">from</span> <span class=\"string\">'element-ui'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> CancelToken = axios.CancelToken;  <span class=\"comment\">// 异步发送的请求--取消操作</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 创建axios实例</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> service = axios.create(&#123;</span><br><span class=\"line\">    baseURL: process.env.API_ROOT,</span><br><span class=\"line\">    timeout: <span class=\"number\">5000</span>,            <span class=\"comment\">// 请求超时时间</span></span><br><span class=\"line\">    responseType: <span class=\"string\">\"json\"</span>,</span><br><span class=\"line\">    <span class=\"comment\">// withCredentials: true, // 跨域请求时是否需要使用凭证(cookie等)</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// service.defaults.baseURL = process.env.API_ROOT  默认配置</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 添加请求拦截器</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> loading;</span><br><span class=\"line\">service.interceptors.request.use(</span><br><span class=\"line\">    config =&gt; &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 请求时loading效果</span></span><br><span class=\"line\">        loading = Loading.service(&#123; </span><br><span class=\"line\">            fullscreen: <span class=\"literal\">true</span>,</span><br><span class=\"line\">            lock: <span class=\"literal\">true</span>,</span><br><span class=\"line\">            text: <span class=\"string\">'Loading, please wait a moment.'</span>,</span><br><span class=\"line\">            spinner: <span class=\"string\">'el-icon-loading'</span></span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"comment\">// 让每个请求携带 token</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (store.getters.token) &#123;</span><br><span class=\"line\">            config.data = <span class=\"built_in\">Object</span>.assign(&#123; <span class=\"attr\">token</span>: store.getters.token &#125;, config.data)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">        <span class=\"comment\">// 设置表头  'application/json'</span></span><br><span class=\"line\">        config.headers[<span class=\"string\">'Content-Type'</span>] = <span class=\"string\">'application/json;charset=utf-8'</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 请求参数序列化</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (config.method === <span class=\"string\">'post'</span> || config.method === <span class=\"string\">\"put\"</span> || config.method === <span class=\"string\">\"delete\"</span>) &#123;</span><br><span class=\"line\">            config.data = qs.stringify(config.data) <span class=\"comment\">// 序列化</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> cancel</span><br><span class=\"line\">        config.cancelToken = <span class=\"keyword\">new</span> CancelToken( <span class=\"function\"><span class=\"params\">c</span> =&gt;</span> &#123;</span><br><span class=\"line\">            cancel = c;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        <span class=\"comment\">// cancel()  中断请求</span></span><br><span class=\"line\">        <span class=\"comment\">// router.push('/login')</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> config;</span><br><span class=\"line\">    &#125;, </span><br><span class=\"line\">    error =&gt; &#123;</span><br><span class=\"line\">        Message(&#123;            </span><br><span class=\"line\">            showClose: <span class=\"literal\">true</span>,</span><br><span class=\"line\">            message: error,</span><br><span class=\"line\">            type: <span class=\"string\">\"error.data.error.message\"</span></span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.reject(error);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 添加响应拦截器</span></span><br><span class=\"line\">service.interceptors.response.use(</span><br><span class=\"line\">    res =&gt; &#123;    </span><br><span class=\"line\">        <span class=\"comment\">// 请求正常则关闭动画</span></span><br><span class=\"line\">        loading.close();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 登录验证通过则跳转页面</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(res.data.status ==<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">            router.push(&#123;</span><br><span class=\"line\">                path: <span class=\"string\">\"/login\"</span>,</span><br><span class=\"line\">                query:&#123; <span class=\"attr\">redirect</span>: router.currentRoute.fullPath &#125;</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125; </span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.resolve(res)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    error =&gt; &#123;     </span><br><span class=\"line\">        <span class=\"comment\">// 请求错误则更新状态</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> httpError = &#123; </span><br><span class=\"line\">            hasError: <span class=\"literal\">true</span>,</span><br><span class=\"line\">            status: error.response.status,</span><br><span class=\"line\">            statusText: error.response.statusText</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        store.commit(<span class=\"string\">'ON_HTTP_ERROR'</span>, httpError)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.reject(error)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> service</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// main.js 全局引用</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> http <span class=\"keyword\">from</span> <span class=\"string\">'@/assets/js/http'</span></span><br><span class=\"line\">Vue.prototype.$axios = http</span><br></pre></td></tr></table></figure><h2 id=\"本地模拟数据\"><a href=\"#本地模拟数据\" class=\"headerlink\" title=\"本地模拟数据\"></a>本地模拟数据</h2><h3 id=\"自定义配置-1\"><a href=\"#自定义配置-1\" class=\"headerlink\" title=\"自定义配置\"></a>自定义配置</h3><blockquote><p>数据 static/data.json</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// webpack.dev.conf.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> portfinder = <span class=\"built_in\">require</span>(<span class=\"string\">'portfinder'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 模拟数据添加部分   开始</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = express()                    <span class=\"comment\">// 创建express应用程序</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> appData = <span class=\"built_in\">require</span>(<span class=\"string\">'../data.json'</span>)    <span class=\"comment\">// 加载本地数据文件</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> seller = appData.seller              <span class=\"comment\">// 获取对应的本地数据</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> goods = appData.goods</span><br><span class=\"line\"><span class=\"keyword\">var</span> ratings = appData.ratings</span><br><span class=\"line\"><span class=\"keyword\">var</span> apiRoutes = express.Router()        <span class=\"comment\">// 获取一个 express 的路由实例</span></span><br><span class=\"line\">app.use(<span class=\"string\">'/api'</span>, apiRoutes)              <span class=\"comment\">// 定义数据输出接口</span></span><br><span class=\"line\"><span class=\"comment\">// 结束</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> devWebpackConfig = merge(baseWebpackConfig, &#123;</span><br><span class=\"line\">  devServer: &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 最后添加接口选项</span></span><br><span class=\"line\">      before(app) &#123;  <span class=\"comment\">//  模拟数据选项</span></span><br><span class=\"line\">          app.get(<span class=\"string\">'/api/seller'</span>, (req, res) =&gt; &#123;</span><br><span class=\"line\">              res.json(&#123; <span class=\"attr\">errno</span>: <span class=\"number\">0</span>, <span class=\"attr\">data</span>: seller &#125;) </span><br><span class=\"line\">          &#125;),</span><br><span class=\"line\">          app.post(<span class=\"string\">'/api/foods'</span>, (req, res) =&gt; &#123; </span><br><span class=\"line\">              res.json(&#123; <span class=\"attr\">errno</span>: <span class=\"number\">0</span>, <span class=\"attr\">data</span>: foods &#125;)</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h3 id=\"通过-mockjs\"><a href=\"#通过-mockjs\" class=\"headerlink\" title=\"通过 mockjs\"></a>通过 mockjs</h3><ul><li>安装：<code>cnpm install mockjs -S</code></li><li>定义：<code>src/mack/index.js</code></li><li>引入：<code>import &#39;./mock&#39;</code></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// src/mack/index.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> Mock <span class=\"keyword\">from</span> <span class=\"string\">'mockjs'</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> Random = Mock.Random   <span class=\"comment\">// 随机函数</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> data =  <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> arr = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &amp;lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> newArticleObject = &#123;</span><br><span class=\"line\">            title: Random.csentence(<span class=\"number\">5</span>),</span><br><span class=\"line\">            content: Random.cparagraph(<span class=\"number\">5</span>, <span class=\"number\">7</span>),</span><br><span class=\"line\">            time: Random.date() + <span class=\"string\">' '</span> + Random.time(),</span><br><span class=\"line\">            location: Random.city()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        arr.push(newArticleObject)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;arr&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 第三个参数可以是 对象/返回对象的函数</span></span><br><span class=\"line\">Mock.mock(<span class=\"string\">'/api/data'</span>, <span class=\"string\">'get'</span>, data)</span><br></pre></td></tr></table></figure><h1 id=\"三、状态管理-Vuex\"><a href=\"#三、状态管理-Vuex\" class=\"headerlink\" title=\"三、状态管理 Vuex\"></a>三、状态管理 Vuex</h1><h2 id=\"核心概念\"><a href=\"#核心概念\" class=\"headerlink\" title=\"核心概念\"></a>核心概念</h2><blockquote><p>本质是一个挂载到 vue 实例的全局变量对象 store，它的属性和方法负责管理所有组件的状态及其更新</p></blockquote><ul><li><strong>state</strong>：包含所有应用级别状态的对象 (组件用到的数据)</li><li><strong>getters</strong>：派生出 state 所需数据 (计算属性)</li><li><strong>mutators</strong>：更新 state 的唯一方式 (同步更新)</li><li><strong>actions</strong>：异步提交 mutaions 更新状态 (异步更新)</li><li><strong>module</strong>：划分为不同模块管理 (方便维护大型项目)</li></ul><h2 id=\"单向数据流\"><a href=\"#单向数据流\" class=\"headerlink\" title=\"单向数据流\"></a>单向数据流</h2><div style=\"text-indent:2em\">通过 vue Devtools 调试工具可以轻松查看状态变化，用户界面负责触发动作 Action 进而改变对应状态 State，从而反映到视图 View 上，所以 State 数据的流向为：<code>View --&gt; Actions --&gt; mutators --&gt; State --&gt; View</code></div><div align=\"center\"><br><img src=\"images/vue/vuex_base.png\" alt=\"Vuex 实现原理\"><br></div><h2 id=\"目录结构\"><a href=\"#目录结构\" class=\"headerlink\" title=\"目录结构\"></a>目录结构</h2><blockquote><p>如果 store 文件太大则需要分割到单独文件</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">store</span><br><span class=\"line\">  ├── index.js         <span class=\"comment\">// 组装模块并导出store </span></span><br><span class=\"line\">  ├── actions.js       <span class=\"comment\">// 根级别的 action</span></span><br><span class=\"line\">  ├── mutations.js     <span class=\"comment\">// 根级别的 mutation</span></span><br><span class=\"line\">  └── modules          <span class=\"comment\">// 大型应用时分割到模块</span></span><br><span class=\"line\">      ├── cart.js      <span class=\"comment\">// 购物车模块</span></span><br><span class=\"line\">      └── products.js  <span class=\"comment\">// 产品模块</span></span><br></pre></td></tr></table></figure><h2 id=\"自定义配置-2\"><a href=\"#自定义配置-2\" class=\"headerlink\" title=\"自定义配置\"></a>自定义配置</h2><h3 id=\"单个文件\"><a href=\"#单个文件\" class=\"headerlink\" title=\"单个文件\"></a>单个文件</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// vuex/store.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> Vue <span class=\"keyword\">from</span> <span class=\"string\">'vue'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> Vuex <span class=\"keyword\">from</span> <span class=\"string\">'vuex'</span></span><br><span class=\"line\">Vue.use(Vuex)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// state 状态变量 </span></span><br><span class=\"line\"><span class=\"keyword\">const</span> state = &#123;    </span><br><span class=\"line\">    count: <span class=\"number\">1</span>,</span><br><span class=\"line\">    isShow: <span class=\"literal\">false</span> </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// state 的计算属性：派生所需状态)</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> getters = &#123;</span><br><span class=\"line\">    countNew: <span class=\"function\"><span class=\"params\">state</span> =&gt;</span> &#123;  </span><br><span class=\"line\">        <span class=\"keyword\">return</span> state.count * <span class=\"number\">10</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 更新 state 的逻辑方法 (commit mutation 触发)</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> mutations=&#123;</span><br><span class=\"line\">    add(state)&#123;     </span><br><span class=\"line\">        state.count += <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    reduce(state,n)&#123;  <span class=\"comment\">// 第二个参数可自定义类型   </span></span><br><span class=\"line\">        state.count -= n;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    tog(state)&#123;  </span><br><span class=\"line\">        state.isShow = !state.isShow;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    init(state)&#123;</span><br><span class=\"line\">        state.count = <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 更新 state 的异步逻辑 (dispatch actions 触发)</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> actions = &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 完整写法  </span></span><br><span class=\"line\">    add_all: <span class=\"function\">(<span class=\"params\">context</span>) =&gt;</span> &#123; context.commit(<span class=\"string\">'add'</span>) &#125;,</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 简写写法  同步提交(实时跟踪)</span></span><br><span class=\"line\">    add: <span class=\"function\">(<span class=\"params\">&#123; commit &#125;</span>) =&gt;</span> commit(<span class=\"string\">'add'</span>), </span><br><span class=\"line\">    reduce: <span class=\"function\">(<span class=\"params\">&#123; commit &#125;,n</span>) =&gt;</span> commit(<span class=\"string\">'reduce'</span>,n), </span><br><span class=\"line\"></span><br><span class=\"line\">    tog: <span class=\"function\">(<span class=\"params\">&#123; commit &#125;</span>) =&gt;</span> commit(<span class=\"string\">'tog'</span>), </span><br><span class=\"line\">    init: <span class=\"function\">(<span class=\"params\">&#123; commit &#125;</span>) =&gt;</span> commit(<span class=\"string\">'init'</span>), </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 异步提交</span></span><br><span class=\"line\">    addAsync: <span class=\"function\">(<span class=\"params\">&#123; commit &#125;</span>) =&gt;</span> &#123;  </span><br><span class=\"line\">        setTimeout (<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">            commit(<span class=\"string\">'add'</span>); </span><br><span class=\"line\">        &#125;, <span class=\"number\">1000</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 分割成不同模块使用：方便管理</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> modules = &#123;   </span><br><span class=\"line\">    <span class=\"comment\">// 每个module中都有state等, 获取时 store.state.a</span></span><br><span class=\"line\">    a: &#123;</span><br><span class=\"line\">        state: &#123; <span class=\"attr\">count</span>: <span class=\"number\">0</span>&#125;,</span><br><span class=\"line\">        <span class=\"comment\">// 参数 模块的局部状态state,getter和根节点状态</span></span><br><span class=\"line\">        getters: &#123;  </span><br><span class=\"line\">            sum (state, getters, rootState) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> state.count + rootState.count</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        mutations: &#123;    <span class=\"comment\">//模块的局部状态state</span></span><br><span class=\"line\">            increment(state)&#123;</span><br><span class=\"line\">                state.count ++ ;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        actions: &#123; </span><br><span class=\"line\">            incrementIf (&#123; state, commit, rootState &#125;) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ((state.count + rootState.count) % <span class=\"number\">2</span> === <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                    commit(<span class=\"string\">'increment'</span>)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,  </span><br><span class=\"line\">    b: &#123; &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 注册所有模块并导出</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> store = <span class=\"keyword\">new</span> Vuex.Store(&#123;</span><br><span class=\"line\">    state,</span><br><span class=\"line\">    mutations,</span><br><span class=\"line\">    actions,</span><br><span class=\"line\">    getters,</span><br><span class=\"line\">    <span class=\"comment\">// modules  导出 modules 时就不需要导出以上变量了</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> store</span><br></pre></td></tr></table></figure><h3 id=\"文件拆分\"><a href=\"#文件拆分\" class=\"headerlink\" title=\"文件拆分\"></a>文件拆分</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// vuex/index.js：vuex 入口函数，在 main.js 中引入</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> Vue <span class=\"keyword\">from</span> <span class=\"string\">'vue'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> Vuex <span class=\"keyword\">from</span> <span class=\"string\">'vuex'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> * <span class=\"keyword\">as</span> getters <span class=\"keyword\">from</span> <span class=\"string\">'./getters'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> * <span class=\"keyword\">as</span> actions <span class=\"keyword\">from</span> <span class=\"string\">'./actions'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> * <span class=\"keyword\">as</span> mutations <span class=\"keyword\">from</span> <span class=\"string\">'./mutations'</span></span><br><span class=\"line\">Vue.use(Vuex)</span><br><span class=\"line\"><span class=\"keyword\">const</span> state = &#123;  <span class=\"comment\">// 声明状态</span></span><br><span class=\"line\">        count: <span class=\"number\">0</span>, <span class=\"attr\">isShow</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> store = <span class=\"keyword\">new</span> Vuex.Store(&#123;  <span class=\"comment\">// 注册模块</span></span><br><span class=\"line\">        state, getters, actions, mutations</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> store</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// vuex/getters.js：获取状态信息</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> countNew = <span class=\"function\"><span class=\"params\">state</span> =&gt;</span> state.count*<span class=\"number\">10</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// vuex/mutations.js：同步操作状态值</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> init = <span class=\"function\"><span class=\"params\">state</span> =&gt;</span> &#123; state.count = <span class=\"number\">1</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> add = <span class=\"function\"><span class=\"params\">state</span> =&gt;</span> &#123;  state.count += <span class=\"number\">1</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> reduce = <span class=\"function\">(<span class=\"params\">state,n</span>) =&gt;</span> &#123; state.count -= n &#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> tog = <span class=\"function\"><span class=\"params\">state</span> =&gt;</span> &#123; state.isShow = !state.isShow &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"comment\">// vuex/actions.js：异步处理逻辑</span></span><br><span class=\"line\"><span class=\"comment\">// 完整写法</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> _add = <span class=\"function\">(<span class=\"params\">context</span>) =&gt;</span> &#123; context.commit(<span class=\"string\">'add'</span>) &#125;</span><br><span class=\"line\"><span class=\"comment\">// 以下为简写写法</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> init = <span class=\"function\">(<span class=\"params\">&#123; commit &#125;</span>) =&gt;</span> commit(<span class=\"string\">'init'</span>)\t</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> add = <span class=\"function\">(<span class=\"params\">&#123; commit &#125;</span>) =&gt;</span> commit(<span class=\"string\">'add'</span>)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> reduce = <span class=\"function\">(<span class=\"params\">&#123; commit &#125;,n</span>) =&gt;</span> commit(<span class=\"string\">'reduce'</span>,n)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> tog = <span class=\"function\">(<span class=\"params\">&#123; commit &#125;</span>) =&gt;</span> commit(<span class=\"string\">'tog'</span>)</span><br></pre></td></tr></table></figure><h2 id=\"全局引用\"><a href=\"#全局引用\" class=\"headerlink\" title=\"全局引用\"></a>全局引用</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// main.js </span></span><br><span class=\"line\"><span class=\"keyword\">import</span> store <span class=\"keyword\">from</span> <span class=\"string\">'./vuex'</span>  </span><br><span class=\"line\"><span class=\"keyword\">new</span> Vue(&#123;</span><br><span class=\"line\">    el: <span class=\"string\">'#app'</span>,</span><br><span class=\"line\">    router,</span><br><span class=\"line\">    store,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h2 id=\"组件使用\"><a href=\"#组件使用\" class=\"headerlink\" title=\"组件使用\"></a>组件使用</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; mapState, mapGetters, mapMutations, mapActions &#125; </span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  data()&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span>&#123;</span><br><span class=\"line\">          localState: <span class=\"number\">2</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  watch:&#123;</span><br><span class=\"line\">      isShow: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;    <span class=\"comment\">// 隐藏时初始化count</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span>(!<span class=\"keyword\">this</span>.show)&#123;</span><br><span class=\"line\">              <span class=\"keyword\">this</span>.$store.commit(<span class=\"string\">'init'</span>) </span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">// 普通写法</span></span><br><span class=\"line\">  computed: &#123;     </span><br><span class=\"line\">      count () &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.$store.state.count;  </span><br><span class=\"line\">          <span class=\"comment\">// getters.countNew  </span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      isShow()&#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.$store.state.isShow;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">// 简洁写法：使用辅助函数返回对象并映射到组件实例</span></span><br><span class=\"line\">  computed: mapState(&#123;  </span><br><span class=\"line\">      count: <span class=\"function\"><span class=\"params\">state</span> =&gt;</span> state.count, </span><br><span class=\"line\">      countAlias: <span class=\"string\">'count'</span>,      <span class=\"comment\">// 改变名称</span></span><br><span class=\"line\">      countPlus(state)&#123;         <span class=\"comment\">// 使this指向组件对象</span></span><br><span class=\"line\">          <span class=\"keyword\">return</span> state.count + <span class=\"keyword\">this</span>.localState; </span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  computed: mapState([<span class=\"string\">'count'</span>,<span class=\"string\">'isShow'</span>]),  <span class=\"comment\">// 名称相同</span></span><br><span class=\"line\">  computed: &#123;</span><br><span class=\"line\">      local()&#123;         <span class=\"comment\">// 组件数据</span></span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.localState;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"comment\">// 使用对象展开运算符将数据混入 computed 对象</span></span><br><span class=\"line\"></span><br><span class=\"line\">      ...mapState([    <span class=\"comment\">// 映射 State</span></span><br><span class=\"line\">          <span class=\"string\">'count'</span>,</span><br><span class=\"line\">          <span class=\"string\">'isShow'</span></span><br><span class=\"line\">      ]),</span><br><span class=\"line\">      ...mapGetters([  <span class=\"comment\">// 映射 Getters </span></span><br><span class=\"line\">          <span class=\"string\">'countNew'</span></span><br><span class=\"line\">      ])</span><br><span class=\"line\">  &#125;, </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  methods: &#123;   </span><br><span class=\"line\">      reduce()&#123;     <span class=\"comment\">// 有参数时需单独定义</span></span><br><span class=\"line\">          <span class=\"keyword\">this</span>.$store.commit(<span class=\"string\">'add'</span>)           <span class=\"comment\">// 同步</span></span><br><span class=\"line\">          <span class=\"keyword\">this</span>.$store.dispatch(<span class=\"string\">'reduce'</span>, <span class=\"number\">2</span>)   <span class=\"comment\">// 异步</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      ...mapActions([  <span class=\"comment\">// 映射 Mutations</span></span><br><span class=\"line\">          <span class=\"string\">'add'</span>,  </span><br><span class=\"line\">          <span class=\"string\">'tog'</span>,</span><br><span class=\"line\">          <span class=\"string\">'addAsync'</span></span><br><span class=\"line\">      ]),</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  methods: mapActions([<span class=\"string\">'add'</span>])</span><br><span class=\"line\">  methods: mapMutations([<span class=\"string\">'add'</span>])</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->"},{"title":"Node.js 常用框架","top":false,"keywords":["node"],"date":"2019-04-17T16:23:49.000Z","description":"Express、Koa、Egg","_content":"\n# 一、Express\n> 基于 ES5 语法实现而只能通过回调实现异步代码，框架本身缺少约束而写法较多，只适合开发小型项目并作为新手入门级框架\n\n## 核心特性\n  * 设置中间件来响应 HTTP 请求\n  * 定义路由表用于执行不同的 HTTP 请求\n  * 通过向模板传递参数来动态渲染 HTML\n\n\n## 基础使用\n  ```js\n  var express = require('express');\n  var app = express();\n\n  // 设置 views 的文件夹和模板\n  app.set(\"views\", __dirname + \"/views\");\n  app.set(\"view engine\", \"jade\")\n\n  // 静态资源\n  app.use(express.static(__dirname + '/public'))\n\n  // 动态渲染\n  app.get('/', function (req, res) {\n      res.send('Hello world');\n  }).listen(3000)\n  ```\n\n\n## 搭建应用\n  ```js\n  // 默认 localhost:3000\n  npm install express express-generator -g \n\n  express -e myApp  // 使用 ejs 模板\n  cd myApp\n  npm install\n\n  npm start \n  ```\n\n\n\n## 中间件\n> 本质是处理 HTTP 请求的函数。每个中间件都可以接收到请求对象 req、响应对象 res 和回调函数 next 这三个参数，经过处理后可以通过调用 next() 传递给下一个中间件\n\n### 分类\n  * __应用级中间件__：使用 app.use/method 绑定到 app 对象\n  * __路由级中间件__：使用 router.use/method 绑定到 express.Router() 对象\n  * __错误处理中间件__：接收四个参数，用于处理应用中的错误\n  * __第三方中间件__：安装后 require 到文件中使用，用来扩展功能\n  * __内置中间件__：express.static 托管静态资源、express.json 解析请求\n\n\n  ```js\n  // 应用级\n  app.use((req,res,next) => {   \n      next()   \n  })\n\n  // 路由级\n  var router = express.Router()\n  router.get('/user/:id', (req, res, next) => {\n      if(req.params.id==0) next('route')\n      else next()\n  },(req, res, next) => {\n      res.end(\"Hello world\");\n  })\n\n  // 错误处理\n  app.use((err, req, res, next) => {\n      res.status(500).send('Something broke')\n  })\n\n  // 内置中间件 \n  app.use(express.static(__dirname + '/public'))\n  ```\n\n\n### 定义方法\n  * __app.use__：会对客户端请求路径及其所有扩展结果进行匹配\n  * __app.method__：会对客户端请求路径进行精确匹配，但会忽略其中的锚点和 get 提交的参数数据\n  \n  \n  ```js\n  // 路径默认 '/'，匹配所有路径(都可以看作是 '/' 的扩展)\n  app.use((req, res, next) => { })\n\n  // 路径默认 '/' ，只匹配根路径\n  app.get((req, res, next) => { })\n  ```\n\n\n### 响应方法\n  * __res.end__：结束响应进程但不返回数据\n  * __res.send__：发送各种类型的响应\n  * __res.json__：发送 JSON 响应\n  * __res.jsonp__：在 JSONP 的支持下发送 JSON 响应\n  * __res.render__：呈现视图模板\n  * __res.redirect__：重定向请求\n  * __res.sendFile__：以八位元流形式发送文件\n  * __res.download__：提示将要下载文件\n  * __res.sendStatus__：设置响应状态码并发送其字符串表示\n\n\n## 路由管理\n\n### 路径规则\n  * url 字符串不区分字母的大小写\n  * url 传递的数据通过冒号语法提取\n  * 所有 get 方式提交的 url 参数及锚点均会被忽略\n  * 所有路由中间件的书写顺序至关重要，只会执行首次匹配到的中间件\n\n\n  ```js\n  // localhost:3000/tom/24：tom, 24\n  app.get('/:name/:age', (req, res)=>{\n      console.log(req.params.name, req.params.age)\n      res.send()\n  })\n\n  // localhost:3000/a#?name=tom \n  app.get('/a', (req, res)=>{\n      res.send('success')\n  })\n\n\n  // localhost:3000/admin/login：只执行第一个\n  app.get('/:username/:method', (req, res)=>{\n      console.log(1)\n      res.end()  // 此处如果执行 next() 则会第二个\n  })\n  app.get('/admin/login', (req, res)=>{\n      console.log(2)\n      res.end()\n  })\n  ```\n\n\n### 路径匹配\n\n#### 字符串\n  ```js\n  // 匹配根路径的请求\n  app.get('/', function (req, res) {\n      res.send('root');\n  })\n\n  // 匹配 /about 路径的请求\n  app.get('/about', function (req, res) {\n      res.send('about');\n  })\n\n  // 匹配 /random.text 路径的请求\n  app.get('/random.text', function (req, res) {\n      res.send('random.text');\n  })\n  ```\n\n\n#### 字符串模式\n  ```js\n  // 匹配 /user、/user/5，去掉 ? 则只匹配 /user/5\n  app.get('/user/:id?', function(req, res) {\n      res.send('/users/:id?')\n  })\n\n  // 匹配 acd 和 abcd\n  app.get('/ab?cd', function(req, res) {\n      res.send('ab?cd')\n  })\n\n  // 匹配 /abe 和 /abcde\n  app.get('/ab(cd)?e', function(req, res) {\n      res.send('ab(cd)?e')\n  })\n\n  // 匹配 abcd、abbcd、abbbcd等\n  app.get('/ab+cd', function(req, res) {\n      res.send('ab+cd')\n  })\n\n  // 匹配 abcd、abxcd、abRABDOMcd、ab123cd等\n  app.get('/ab*cd', function(req, res) {\n      res.send('ab*cd')\n  })\n  ```\n\n\n#### 正则表达式\n  ```js\n  // 匹配任何路径中含有 a 的路径：\n  app.get(/a/, function(req, res) {\n      res.send('/a/')\n  })\n\n  // 匹配 butterfly、dragonfly，不匹配 butterflyman、dragonfly man等\n  app.get(/.*fly$/, function(req, res) {\n      res.send('/.*fly$/')\n  })\n  ```\n\n#### 数组\n  ```js\n  // 匹配 /abcd、/xyza、/lmnand、/pqr\n  app.use(['/abcd', '/xyza', /\\/lmn|\\/pqr/], function (req, res, next) {\n      next()\n  })\n  ```\n\n\n### 路由句柄\n  ```js\n  // 一个回调函数\n  app.get('/example/a', function (req, res) {\n      res.send('Hello from A')\n  })\n  // 多个回调函数\n  app.get('/example/b', function (req, res, next) {\n      next()\n  }, function (req, res) {\n      res.send('Hello')\n  });\n\n  // 回调函数数组\n  var a = function (req, res, next) { next() }\n  var b = function (req, res, next) { next() }\n  var c = function (req, res) { res.send('Hello from C') }\n  app.get('/example/c', [a, b, c])\n\n  // 混合使用\n  app.get('/example/d', [a, b], function (req, res, next) {\n      next()\n  }, function (req, res) {\n      res.send('Hello from D');\n  })\n  ```\n\n\n### 参数解析\n  * __req.param__：已被弃用\n  * __req.query__：解析 GET 请求中的查询字符串\n  * __req.body__：解析 POST 请求中的数据（需引用body-parser）\n  * __req.params__：解析 GET/POST 请求中的占位符数据（如/:name）\n  \n\n  ```js\n  // user/10\n  app.get(\"user/:id\", function (req, res) {\n      res.send(req.params[\"id\"])\n  });\n\n  // user/?id=10\n  app.get(\"/user\", function (req, res) {\n      res.send(req.query[\"id\"])\n  })\n  \n  // 通过 body-parser 模块获取 post 请求数据\n  let bodyParser=require('body-parser')\n  app.use(bodyParser.urlencoded({ extended: true }))\n  app.post(\"/login\", function (req, res) {\n      res.send(req.body.name, req.body.password)\n  })\n  ```\n\n\n### 特殊路由\n  ```js\n  // 验证或处理 路径参数\n  router.param('id', function (req, res, next, id) {\n      req.name = name\n      next()\n  })\n  router.get('/user/:id', function (req, res) {\n      res.send('hello ' + req.name)\n  })\n\n\n  // 链式路由：一个路径处理多种请求\n  app.route('/book')\n    .get(function(req, res) {\n        res.send('Get a random book');\n    })\n    .post(function(req, res) {\n        res.send('Add a book');\n    })\n  ```\n\n\n### next 方法\n  * __next()__：从下一个处理函数开始往下执行\n  * __next('router')__：直接执行下一个相同路由\n\n\n  ```js\n  app.get('/', function (req, res) {\n      console.log(1)\n      next()           \n      // 结果：1234，替换为next('route')则结果：1234\n      \n  }, function (req, res) {\n      console.log(2)\n      next('route')\n  })\n\n  app.get('/', function (req, res) {\n      console.log(3)\n      next()\n  }, function (req, res) {\n      console.log(4)\n  })\n  ```\n\n\n# 二、Koa\n> Express 团队打造的进阶框架，基于 ES7 语法使用 Promise 实现异步而极大简化了异步代码。但是开发项目时缺少约束，多人开发时代码合并困难而不适合团队协作开发项目\n\n\n## 主要特点\n  * __洋葱中间件模式__：next函数决定是否执行下一个中间件\n  * __Context 对象__：内部封装了 HTTP 请求对象和响应对象\n  * __异步处理__：使用 Promise 并配合 async await 实现异步\n\n\n## 基础使用\n  ```js\n  // npm install koa koa-route\n  const Koa = require('koa')\n  const app = new Koa()\n  const path = require('path')\n  const route = require('koa-route')\n\n  // 静态资源服务器：npm install koa-static\n  const serve = require('koa-static')\n  app.use(serve(path.join(__dirname, '/public')))\n\n\n  // 动态渲染页面：npm install koa-views ejs\n  let views = require('koa-views');\n  app.use(views(__dirname,{\n      extension:'ejs' //指定用ejs模板\n  }))\n  app.use(async (ctx, next)=>{\n      // 渲染 index.ejs\n      await ctx.render('index', {name:'cgp', age:9})\n  })\n\n  app.listen(3000)\n  ```\n\n\n## 搭建应用\n  ```js\n  // 默认 localhost:3000\n  npm install koa koa-generator -g \n\n  koa2 project \n  cd project\n  npm install\n\n  npm start\n  ```\n\n\n## 路由管理\n\n### 原生路由\n  ```js\n  // 通过 ctx.request.path 获取用户请求的路径\n  app.use(ctx => {\n      if (ctx.request.path == '/') {\n          // ctx.response.body的简写 \n          ctx.body = '<p>Hello World</p>'\n      }\n  })\n  ```\n\n\n### 路由中间件\n> 安装：npm install koa koa-router\n\n  ```js\n  var Koa = require('koa');\n  var app = new Koa();\n  var router = require('koa-router')();\n\n  // 基础用法：常用 get、post、all\n  router.get('/', async (ctx, next)=>{\n      ctx.body = 'hello people';\n      await next()\n  });\n  router.get('/list', async (ctx, next)=>{\n      ctx.body = 'list';\n  });\n\n\n  // 传递参数\n  router.get('/home', (ctx,next)=>{ \n      console.log('/home?id=1 传递参数：', ctx.query);\n      next();\n  });\n  router.get('/user/:name', (ctx, next) => {\n      console.log('/user/tom 传递参数：', ctx.params.name);\n      next();\n  });\n  router.post('/user/register',async(ctx, next)=>{\n      console.log(ctx.request.body)\n  })\n\n\n  // 重定向\n  router.get('/login', async (ctx, next) => {\n      ctx.redirect('/user')\n  })\n\n\n  // 嵌套路由\n  let home = new Router();\n  home.get('/list', async(ctx)=>{\n      ctx.body = \"Home list\";\n  }).get('/todo', async(ctx)=>{\n      ctx.body ='Home ToDo';\n  });\n  let user = new Router();\n  user.get('/list', async(ctx)=>{\n      ctx.body = \"User list\";\n  });\n\n\n  // 装载所有子路由\n  let router = new Router();\n  router.use('/home', home.routes(), home.allowedMethods());\n  router.use('/user', user.routes(), user.allowedMethods());\n\n  // 加载路由：当请求数据的方法与设置的方法不一致时会报错\n  app.use(router.routes()).use(router.allowedMethods());\n\n  // 监听服务\n  app.listen(3000);\n  ```\n\n\n## 中间件\n  <div style=\"text-indent: 2em\">每个中间件默认接受 `Context 对象、next 函数` 两个参数。`Context 对象内部封装了原生 NodeJS 包含的 request、response 对象，分别为 ctx.req、ctx.res。next函数被调用时，会暂停该中间件的运行并将控制传递给下一个中间件。</div>\n\n\n### 分类\n  ```js\n  // 第三方中间件：引入koa-router并对其实例化\n  var router = require('koa-router')()\n\n  // 错误处理中间件\n  app.use(async (ctx, next) => {\n      try {\n          await next()\n      } catch (error) {\n          ctx.response.body = {\n          code: '404',\n          message: '服务器异常',\n          desc: error.message\n      }\n  })\n\n  // 应用级中间件\n  app.use(async (ctx, next) => {\n      await next();\n      if(ctx.status === 404){\n          ctx.body = \"404页面\"\n      }\n  })\n\n  // 路由级中间件\n  router.get('/', async ctx => {\n      ctx.body = 'hello koa';\n  })\n\n  // 启动路由\n  app.use(router.routes()).use(router.allowedMethods())\n  ```\n        \n\n### 执行顺序\n  * 多个中间件会形成堆栈结构，按先进后出顺序执行。\n  * 任何路由都会先经过应用级中间件，当执行完成next后再去匹配相应路由\n  * 路由在匹配成功并执行完相应操作后还会再次进入应用级中间件执行 next 之后的逻辑\n\n\n  ```js\n  app.use(async (ctx, next) => {\n      console.log('1')\n      await next();\n      console.log('7')\n  })\n\n  app.use(async (ctx, next) => {\n      console.log('2');\n      await next();\n      console.log('4')\n  })\n\n  router.get('/user', async (ctx, next) => {\n      console.log('3')\n      ctx.body = 'Hello Koa';\n  })\n  ```\n\n\n### 第三方中间件\n  * __kao-views__：模板渲染\n  * __koa-router__：路由处理\n  * __koa-static__：静态文件读取\n  * __koa-bodyparse__：处理post请求的数据\n\n\n\n## 常用功能\n\n### Cookies\n> 框架自带属性，不需要引入中间件\n\n  ```js\n  // 设置中文时报错解决\n  app.use(async (ctx, next) => {\n\n      // 使用new Buffer().toString('base64')转换\n      this.cookies.set('test', new Buffer('你好').toString('base64'))\n      const test = new Buffer(ctx.cookies.get('test'), 'base64').toString()\n\n      // 使用encodeURIComponent()转换\n      ctx.cookies.set('name', encodeURIComponent('李'))\n      const name = decodeURIComponent(ctx.cookies.get('name'))\n  })\n  ```\n\n\n### 表单处理\n  ```js\n  const router = require('koa-router')();\n  const bodyParser = require('koa-bodyparse');\n  app.use(bodyParser()); \n  \n  router.post('/add', async (ctx)=>{\n      // 获取表单提交的数据\n      const body = ctx.request.body\n      ctx.body = { name: body.name }\n  })\n  ```\n\n\n### 上传文件\n\n  <div align=\"center\"> \n    ![Node UploadFile](images/nodejs/node-uploadFile.png)\n  </div> \n\n  ```js\n  // 引入：npm install koa-body --save\n  const koaBody = require('koa-body');\n  app.use(koaBody({\n      multipart: true,\n      formidable: {\n          maxFileSize: 200*1024*1024  // 设置文件最大限制，默认 2M\n      }\n  }));\n\n\n  // 上传图片\n  router.post('/file_upload', async (ctx) => {\n      // 获取上传图片\n      const data = ctx.request.body.files.data;\n      // 创建可读流\n      const savePath = path.join(`./files`, data.name)\n      const reader = fs.createReadStream(data.path)\n      // 创建可写流\n      const writer = fs.createWriteStream(savePath)\n\n      \n      const pro = new Promise( (resolve, reject) => {\n          // 可读流通过管道写入可写流\n          var stream = reader.pipe(writer);\n\n          // 图片上传成功后返回服务器地址，实时显示服务器图片\n          stream.on('finish', function () {\n              resolve(`http://当前服务器地址${data.name}`);\n          });\n      })\n      ctx.response.body =  await pro\n  })\n\n\n  // 上传单个文件\n  router.post('/uploadfile', async (ctx, next) => {\n      // 获取上传文件\n      const file = ctx.request.files.file; \n      // 创建可读流\n      const reader = fs.createReadStream(file.path);\n      let filePath = path.join(__dirname, 'public/upload/') + `/${file.name}`;\n      // 创建可写流\n      const upStream = fs.createWriteStream(filePath);\n      // 可读流通过管道写入可写流\n      reader.pipe(upStream);\n      return ctx.body = \"上传成功！\";\n  })\n\n  \n  // 上传多个文件\n  router.post('/uploadfiles', async (ctx, next) => {\n      // 获取上传文件，旧版本通过 ctx.request.body.files\n      const files = ctx.request.files.file; \n      for (let file of files) {\n        // 创建可读流\n        const reader = fs.createReadStream(file.path);\n        // 获取上传文件扩展名\n        let filePath = path.join(__dirname, 'public/upload/') + `/${file.name}`;\n        // 创建可写流\n        const upStream = fs.createWriteStream(filePath);\n        // 可读流通过管道写入可写流\n        reader.pipe(upStream);\n      }\n      return ctx.body = \"上传成功！\";\n  })\n  ```\n\n\n\n### 合并中间件\n  ```js\n  // koa-compose：将多个中间件合成为一个\n  const compose = require('koa-compose')\n  const first = asycn (ctx, next) => {\n      await next()\n  }\n  const second = async ctx => {\n      ctx.body = 'Hello'\n  }\n  const middle = compose([first, second])\n  app.use(middle)\n  ```\n\n\n# 三、Egg\n> 基于 koa2 的企业级框架，是由阿里 NodeJS 团队封装的企业级 Web 应用解决方案\n\n  <div style=\"text-indent: 2em\">官方定位是 为企业级框架和应用而生和孕育出更多上层框架，奉行 `约定优于配置`，帮助开发团队和开发人员降低开发和维护成本。async 的特性避免了回调地狱，洋葱式的中间件架构更容易后置逻辑，内置的多进程管理会更好的利用服务器性能，以及更方便的单元测试和更加约束的目录架构。</div>\n\n\n## 框架体系\n  * 核心体系：egg-core 模块\n    * 以 Koa.js 为基类，利用它的 中间件机制 和 HTTP服务机制 作为框架基础\n    * 以 Loader 机制作为 Egg.js 各分层机制的约定基础\n  * 辅助体系：egg-script、egg-bin 等模块\n    * 支持 开发模式、生产模式、多线程模式\n  * 生态体系：中间件、插件、框架\n\n\n## 主要特点\n  * 渐进式开发\n  * 内置多进程管理\n  * 高度可扩展的插件机制\n  * 框架稳定，测试覆盖率高\n  * 基于 Koa 开发，性能优异\n  * 提供基于 Egg 定制上层框架的能力\n\n\n## 搭建应用\n  ```js\n  npm i egg-init -g\n  egg-init test --type=simple  \n\n  cd test\n  npm install\n\n  npm run dev \n  ```\n\n\n## 项目运行\n  * 绿色虚线框中的所有组件组成了一个实际执行代码逻辑的进程\n  * request 进来后先穿过中间件，自定义中间件放在 app/middleware 并在 config 中启用\n  * 静态资源（project/app/public）经过内置的 egg-static 中间件时会直接响应给客户端，其它资源则会穿越所有中间件并到达路由文件 router.js\n  * 路由文件一般没有任何逻辑而只起到目录和索引的作用，它会直接指向一个处理请求的 controller（app/controller）\n  * Controller 负责调用并组合 Service（app/service），最后将响应提交给客户端。Service 负责调用 Model 处理具体的业务逻辑\n  * 除此之外，Worker 中还有定时任务（app/schedule）\n\n  <div align=\"center\"> \n    ![Egg Run](images/nodejs/egg-run.png)\n  </div> \n\n\n## 原理分析\n> 要分析框架的实现原理，直接从所有源码开始分析比较难。但是可以先将其精简到最小功能系统，然后针对各个功能进行分析和叠加 \n\n### 模块架构\n  <div align=\"center\"> \n    ![Egg Framework](images/nodejs/egg-framework.png)\n  </div> \n\n\n### 最简目录\n  ```js\n  ├── index.js          // 启动文件：初始化 应用实例 和 HTTP 服务器\n  ├── app               // 业务模块：路由文件\n  │     └── router.js   \n  ├── lib               // 应用模块：提供加载器和底层的中间件、插件、路由等机制\n  |     ├── egg-core \n  │     └── egg.js                    \n  └── package.json\n  ```\n\n\n### 执行流程\n  1. 应用初始化\n    * 加载所有 loader\n    * 加载所有中间件、插件等内容\n    * 路由注册\n  2. 服务启动\n    * 提供 http 服务\n    * 执行路由处理\n\n\n### 代码逻辑\n  1. EggApplication \n    * 继承：EggCore\n    * 构建：按照顺序加载所有中间件、插件、路由等内容，this.loader.loadAll()\n\n  2. EggCore\n    * 继承：Koa\n    * 功能\n      * 服务器的底层逻辑\n      * 工程项目文件的加载器\n      * 提供底层的中间件、插件、路由等机制\n    * 构建\n      * AppWorkerLoader\n        * 继承：EggLoader\n        * 加载器初始化：this.loader = new EggLoader()\n      * Router\n        * 继承：Koa-router\n        * 路由初始化：this.router = new Router()\n        * 路由方法注入：将路由方法注册到对象属性\n  3. EggLoader\n    * 构建：注入各种加载器方法\n              \n\n### 路由优化\n  * 路由大小写敏感\n  * RESTFul 实现\n  * Controller 句柄使用\n  * Generator Function 兼容\n\n\n\n### RESTFul\n> 测试时需要先安装接口测试工具：chrome postman，然后在 chrome 地址栏使用\n\n  * 约定路由路径和对应的控制器\n  * 统一处理封装 router 参数\n  * 统一封装 controller：根据请求类型和路径注册对应的控制器\n    * Async Function\n    * Generator Function\n    * controller 句柄读取 this.app.controller\n\n\n  ```js\n  // 路由文件添加\n  router.resources('users', '/v1/users', 'users');\n\n  // 新建文件 app/controller/users.js\n  const { Controller } = require('egg');\n\n  class UsersController extends Controller {\n\n      async create() {\n          const { ctx } = this;\n          this.ctx.body = '创建';\n      }\n      async destroy() {\n          const { ctx } = this;\n          this.ctx.body = '删除';\n      }\n      async update() {\n          const { ctx } = this;\n          this.ctx.body = '修改';\n      }\n      async show() {\n          const { ctx } = this;\n          this.ctx.body = '查询';\n      }\n      async index() {\n          const { ctx } = this;\n          this.ctx.body = '列表';\n      }\n      async new() {\n          const { ctx } = this;\n          this.ctx.body = '创建页面';\n      }\n      async edit() {\n          const { ctx } = this;\n          this.ctx.body = '修改页面';\n      }\n  }\n\n  module.exports = UsersController;\n  ```\n\n\n### 加载器\n  <div style=\"text-indent: 2em\">实际项目中的业务代码除了路由文件，还有 controller、service 等其他分层的源码文件。Egg.js 是通过加载器 EggLoader 将这些分层的项目业务代码、中间件和插件代码的大部分功能注入到 this、this.app、this.ctx 对象。</div>\n\n\n\n \n\n\n\n\n","source":"_posts/20-Node框架.md","raw":"---\ntitle: Node.js 常用框架\ntags:\n  - Node.js\ncategories: Node.js\ntop: false\nkeywords:\n  - node\ndate: 2019-04-18 00:23:49\ndescription: Express、Koa、Egg \n---\n\n# 一、Express\n> 基于 ES5 语法实现而只能通过回调实现异步代码，框架本身缺少约束而写法较多，只适合开发小型项目并作为新手入门级框架\n\n## 核心特性\n  * 设置中间件来响应 HTTP 请求\n  * 定义路由表用于执行不同的 HTTP 请求\n  * 通过向模板传递参数来动态渲染 HTML\n\n\n## 基础使用\n  ```js\n  var express = require('express');\n  var app = express();\n\n  // 设置 views 的文件夹和模板\n  app.set(\"views\", __dirname + \"/views\");\n  app.set(\"view engine\", \"jade\")\n\n  // 静态资源\n  app.use(express.static(__dirname + '/public'))\n\n  // 动态渲染\n  app.get('/', function (req, res) {\n      res.send('Hello world');\n  }).listen(3000)\n  ```\n\n\n## 搭建应用\n  ```js\n  // 默认 localhost:3000\n  npm install express express-generator -g \n\n  express -e myApp  // 使用 ejs 模板\n  cd myApp\n  npm install\n\n  npm start \n  ```\n\n\n\n## 中间件\n> 本质是处理 HTTP 请求的函数。每个中间件都可以接收到请求对象 req、响应对象 res 和回调函数 next 这三个参数，经过处理后可以通过调用 next() 传递给下一个中间件\n\n### 分类\n  * __应用级中间件__：使用 app.use/method 绑定到 app 对象\n  * __路由级中间件__：使用 router.use/method 绑定到 express.Router() 对象\n  * __错误处理中间件__：接收四个参数，用于处理应用中的错误\n  * __第三方中间件__：安装后 require 到文件中使用，用来扩展功能\n  * __内置中间件__：express.static 托管静态资源、express.json 解析请求\n\n\n  ```js\n  // 应用级\n  app.use((req,res,next) => {   \n      next()   \n  })\n\n  // 路由级\n  var router = express.Router()\n  router.get('/user/:id', (req, res, next) => {\n      if(req.params.id==0) next('route')\n      else next()\n  },(req, res, next) => {\n      res.end(\"Hello world\");\n  })\n\n  // 错误处理\n  app.use((err, req, res, next) => {\n      res.status(500).send('Something broke')\n  })\n\n  // 内置中间件 \n  app.use(express.static(__dirname + '/public'))\n  ```\n\n\n### 定义方法\n  * __app.use__：会对客户端请求路径及其所有扩展结果进行匹配\n  * __app.method__：会对客户端请求路径进行精确匹配，但会忽略其中的锚点和 get 提交的参数数据\n  \n  \n  ```js\n  // 路径默认 '/'，匹配所有路径(都可以看作是 '/' 的扩展)\n  app.use((req, res, next) => { })\n\n  // 路径默认 '/' ，只匹配根路径\n  app.get((req, res, next) => { })\n  ```\n\n\n### 响应方法\n  * __res.end__：结束响应进程但不返回数据\n  * __res.send__：发送各种类型的响应\n  * __res.json__：发送 JSON 响应\n  * __res.jsonp__：在 JSONP 的支持下发送 JSON 响应\n  * __res.render__：呈现视图模板\n  * __res.redirect__：重定向请求\n  * __res.sendFile__：以八位元流形式发送文件\n  * __res.download__：提示将要下载文件\n  * __res.sendStatus__：设置响应状态码并发送其字符串表示\n\n\n## 路由管理\n\n### 路径规则\n  * url 字符串不区分字母的大小写\n  * url 传递的数据通过冒号语法提取\n  * 所有 get 方式提交的 url 参数及锚点均会被忽略\n  * 所有路由中间件的书写顺序至关重要，只会执行首次匹配到的中间件\n\n\n  ```js\n  // localhost:3000/tom/24：tom, 24\n  app.get('/:name/:age', (req, res)=>{\n      console.log(req.params.name, req.params.age)\n      res.send()\n  })\n\n  // localhost:3000/a#?name=tom \n  app.get('/a', (req, res)=>{\n      res.send('success')\n  })\n\n\n  // localhost:3000/admin/login：只执行第一个\n  app.get('/:username/:method', (req, res)=>{\n      console.log(1)\n      res.end()  // 此处如果执行 next() 则会第二个\n  })\n  app.get('/admin/login', (req, res)=>{\n      console.log(2)\n      res.end()\n  })\n  ```\n\n\n### 路径匹配\n\n#### 字符串\n  ```js\n  // 匹配根路径的请求\n  app.get('/', function (req, res) {\n      res.send('root');\n  })\n\n  // 匹配 /about 路径的请求\n  app.get('/about', function (req, res) {\n      res.send('about');\n  })\n\n  // 匹配 /random.text 路径的请求\n  app.get('/random.text', function (req, res) {\n      res.send('random.text');\n  })\n  ```\n\n\n#### 字符串模式\n  ```js\n  // 匹配 /user、/user/5，去掉 ? 则只匹配 /user/5\n  app.get('/user/:id?', function(req, res) {\n      res.send('/users/:id?')\n  })\n\n  // 匹配 acd 和 abcd\n  app.get('/ab?cd', function(req, res) {\n      res.send('ab?cd')\n  })\n\n  // 匹配 /abe 和 /abcde\n  app.get('/ab(cd)?e', function(req, res) {\n      res.send('ab(cd)?e')\n  })\n\n  // 匹配 abcd、abbcd、abbbcd等\n  app.get('/ab+cd', function(req, res) {\n      res.send('ab+cd')\n  })\n\n  // 匹配 abcd、abxcd、abRABDOMcd、ab123cd等\n  app.get('/ab*cd', function(req, res) {\n      res.send('ab*cd')\n  })\n  ```\n\n\n#### 正则表达式\n  ```js\n  // 匹配任何路径中含有 a 的路径：\n  app.get(/a/, function(req, res) {\n      res.send('/a/')\n  })\n\n  // 匹配 butterfly、dragonfly，不匹配 butterflyman、dragonfly man等\n  app.get(/.*fly$/, function(req, res) {\n      res.send('/.*fly$/')\n  })\n  ```\n\n#### 数组\n  ```js\n  // 匹配 /abcd、/xyza、/lmnand、/pqr\n  app.use(['/abcd', '/xyza', /\\/lmn|\\/pqr/], function (req, res, next) {\n      next()\n  })\n  ```\n\n\n### 路由句柄\n  ```js\n  // 一个回调函数\n  app.get('/example/a', function (req, res) {\n      res.send('Hello from A')\n  })\n  // 多个回调函数\n  app.get('/example/b', function (req, res, next) {\n      next()\n  }, function (req, res) {\n      res.send('Hello')\n  });\n\n  // 回调函数数组\n  var a = function (req, res, next) { next() }\n  var b = function (req, res, next) { next() }\n  var c = function (req, res) { res.send('Hello from C') }\n  app.get('/example/c', [a, b, c])\n\n  // 混合使用\n  app.get('/example/d', [a, b], function (req, res, next) {\n      next()\n  }, function (req, res) {\n      res.send('Hello from D');\n  })\n  ```\n\n\n### 参数解析\n  * __req.param__：已被弃用\n  * __req.query__：解析 GET 请求中的查询字符串\n  * __req.body__：解析 POST 请求中的数据（需引用body-parser）\n  * __req.params__：解析 GET/POST 请求中的占位符数据（如/:name）\n  \n\n  ```js\n  // user/10\n  app.get(\"user/:id\", function (req, res) {\n      res.send(req.params[\"id\"])\n  });\n\n  // user/?id=10\n  app.get(\"/user\", function (req, res) {\n      res.send(req.query[\"id\"])\n  })\n  \n  // 通过 body-parser 模块获取 post 请求数据\n  let bodyParser=require('body-parser')\n  app.use(bodyParser.urlencoded({ extended: true }))\n  app.post(\"/login\", function (req, res) {\n      res.send(req.body.name, req.body.password)\n  })\n  ```\n\n\n### 特殊路由\n  ```js\n  // 验证或处理 路径参数\n  router.param('id', function (req, res, next, id) {\n      req.name = name\n      next()\n  })\n  router.get('/user/:id', function (req, res) {\n      res.send('hello ' + req.name)\n  })\n\n\n  // 链式路由：一个路径处理多种请求\n  app.route('/book')\n    .get(function(req, res) {\n        res.send('Get a random book');\n    })\n    .post(function(req, res) {\n        res.send('Add a book');\n    })\n  ```\n\n\n### next 方法\n  * __next()__：从下一个处理函数开始往下执行\n  * __next('router')__：直接执行下一个相同路由\n\n\n  ```js\n  app.get('/', function (req, res) {\n      console.log(1)\n      next()           \n      // 结果：1234，替换为next('route')则结果：1234\n      \n  }, function (req, res) {\n      console.log(2)\n      next('route')\n  })\n\n  app.get('/', function (req, res) {\n      console.log(3)\n      next()\n  }, function (req, res) {\n      console.log(4)\n  })\n  ```\n\n\n# 二、Koa\n> Express 团队打造的进阶框架，基于 ES7 语法使用 Promise 实现异步而极大简化了异步代码。但是开发项目时缺少约束，多人开发时代码合并困难而不适合团队协作开发项目\n\n\n## 主要特点\n  * __洋葱中间件模式__：next函数决定是否执行下一个中间件\n  * __Context 对象__：内部封装了 HTTP 请求对象和响应对象\n  * __异步处理__：使用 Promise 并配合 async await 实现异步\n\n\n## 基础使用\n  ```js\n  // npm install koa koa-route\n  const Koa = require('koa')\n  const app = new Koa()\n  const path = require('path')\n  const route = require('koa-route')\n\n  // 静态资源服务器：npm install koa-static\n  const serve = require('koa-static')\n  app.use(serve(path.join(__dirname, '/public')))\n\n\n  // 动态渲染页面：npm install koa-views ejs\n  let views = require('koa-views');\n  app.use(views(__dirname,{\n      extension:'ejs' //指定用ejs模板\n  }))\n  app.use(async (ctx, next)=>{\n      // 渲染 index.ejs\n      await ctx.render('index', {name:'cgp', age:9})\n  })\n\n  app.listen(3000)\n  ```\n\n\n## 搭建应用\n  ```js\n  // 默认 localhost:3000\n  npm install koa koa-generator -g \n\n  koa2 project \n  cd project\n  npm install\n\n  npm start\n  ```\n\n\n## 路由管理\n\n### 原生路由\n  ```js\n  // 通过 ctx.request.path 获取用户请求的路径\n  app.use(ctx => {\n      if (ctx.request.path == '/') {\n          // ctx.response.body的简写 \n          ctx.body = '<p>Hello World</p>'\n      }\n  })\n  ```\n\n\n### 路由中间件\n> 安装：npm install koa koa-router\n\n  ```js\n  var Koa = require('koa');\n  var app = new Koa();\n  var router = require('koa-router')();\n\n  // 基础用法：常用 get、post、all\n  router.get('/', async (ctx, next)=>{\n      ctx.body = 'hello people';\n      await next()\n  });\n  router.get('/list', async (ctx, next)=>{\n      ctx.body = 'list';\n  });\n\n\n  // 传递参数\n  router.get('/home', (ctx,next)=>{ \n      console.log('/home?id=1 传递参数：', ctx.query);\n      next();\n  });\n  router.get('/user/:name', (ctx, next) => {\n      console.log('/user/tom 传递参数：', ctx.params.name);\n      next();\n  });\n  router.post('/user/register',async(ctx, next)=>{\n      console.log(ctx.request.body)\n  })\n\n\n  // 重定向\n  router.get('/login', async (ctx, next) => {\n      ctx.redirect('/user')\n  })\n\n\n  // 嵌套路由\n  let home = new Router();\n  home.get('/list', async(ctx)=>{\n      ctx.body = \"Home list\";\n  }).get('/todo', async(ctx)=>{\n      ctx.body ='Home ToDo';\n  });\n  let user = new Router();\n  user.get('/list', async(ctx)=>{\n      ctx.body = \"User list\";\n  });\n\n\n  // 装载所有子路由\n  let router = new Router();\n  router.use('/home', home.routes(), home.allowedMethods());\n  router.use('/user', user.routes(), user.allowedMethods());\n\n  // 加载路由：当请求数据的方法与设置的方法不一致时会报错\n  app.use(router.routes()).use(router.allowedMethods());\n\n  // 监听服务\n  app.listen(3000);\n  ```\n\n\n## 中间件\n  <div style=\"text-indent: 2em\">每个中间件默认接受 `Context 对象、next 函数` 两个参数。`Context 对象内部封装了原生 NodeJS 包含的 request、response 对象，分别为 ctx.req、ctx.res。next函数被调用时，会暂停该中间件的运行并将控制传递给下一个中间件。</div>\n\n\n### 分类\n  ```js\n  // 第三方中间件：引入koa-router并对其实例化\n  var router = require('koa-router')()\n\n  // 错误处理中间件\n  app.use(async (ctx, next) => {\n      try {\n          await next()\n      } catch (error) {\n          ctx.response.body = {\n          code: '404',\n          message: '服务器异常',\n          desc: error.message\n      }\n  })\n\n  // 应用级中间件\n  app.use(async (ctx, next) => {\n      await next();\n      if(ctx.status === 404){\n          ctx.body = \"404页面\"\n      }\n  })\n\n  // 路由级中间件\n  router.get('/', async ctx => {\n      ctx.body = 'hello koa';\n  })\n\n  // 启动路由\n  app.use(router.routes()).use(router.allowedMethods())\n  ```\n        \n\n### 执行顺序\n  * 多个中间件会形成堆栈结构，按先进后出顺序执行。\n  * 任何路由都会先经过应用级中间件，当执行完成next后再去匹配相应路由\n  * 路由在匹配成功并执行完相应操作后还会再次进入应用级中间件执行 next 之后的逻辑\n\n\n  ```js\n  app.use(async (ctx, next) => {\n      console.log('1')\n      await next();\n      console.log('7')\n  })\n\n  app.use(async (ctx, next) => {\n      console.log('2');\n      await next();\n      console.log('4')\n  })\n\n  router.get('/user', async (ctx, next) => {\n      console.log('3')\n      ctx.body = 'Hello Koa';\n  })\n  ```\n\n\n### 第三方中间件\n  * __kao-views__：模板渲染\n  * __koa-router__：路由处理\n  * __koa-static__：静态文件读取\n  * __koa-bodyparse__：处理post请求的数据\n\n\n\n## 常用功能\n\n### Cookies\n> 框架自带属性，不需要引入中间件\n\n  ```js\n  // 设置中文时报错解决\n  app.use(async (ctx, next) => {\n\n      // 使用new Buffer().toString('base64')转换\n      this.cookies.set('test', new Buffer('你好').toString('base64'))\n      const test = new Buffer(ctx.cookies.get('test'), 'base64').toString()\n\n      // 使用encodeURIComponent()转换\n      ctx.cookies.set('name', encodeURIComponent('李'))\n      const name = decodeURIComponent(ctx.cookies.get('name'))\n  })\n  ```\n\n\n### 表单处理\n  ```js\n  const router = require('koa-router')();\n  const bodyParser = require('koa-bodyparse');\n  app.use(bodyParser()); \n  \n  router.post('/add', async (ctx)=>{\n      // 获取表单提交的数据\n      const body = ctx.request.body\n      ctx.body = { name: body.name }\n  })\n  ```\n\n\n### 上传文件\n\n  <div align=\"center\"> \n    ![Node UploadFile](images/nodejs/node-uploadFile.png)\n  </div> \n\n  ```js\n  // 引入：npm install koa-body --save\n  const koaBody = require('koa-body');\n  app.use(koaBody({\n      multipart: true,\n      formidable: {\n          maxFileSize: 200*1024*1024  // 设置文件最大限制，默认 2M\n      }\n  }));\n\n\n  // 上传图片\n  router.post('/file_upload', async (ctx) => {\n      // 获取上传图片\n      const data = ctx.request.body.files.data;\n      // 创建可读流\n      const savePath = path.join(`./files`, data.name)\n      const reader = fs.createReadStream(data.path)\n      // 创建可写流\n      const writer = fs.createWriteStream(savePath)\n\n      \n      const pro = new Promise( (resolve, reject) => {\n          // 可读流通过管道写入可写流\n          var stream = reader.pipe(writer);\n\n          // 图片上传成功后返回服务器地址，实时显示服务器图片\n          stream.on('finish', function () {\n              resolve(`http://当前服务器地址${data.name}`);\n          });\n      })\n      ctx.response.body =  await pro\n  })\n\n\n  // 上传单个文件\n  router.post('/uploadfile', async (ctx, next) => {\n      // 获取上传文件\n      const file = ctx.request.files.file; \n      // 创建可读流\n      const reader = fs.createReadStream(file.path);\n      let filePath = path.join(__dirname, 'public/upload/') + `/${file.name}`;\n      // 创建可写流\n      const upStream = fs.createWriteStream(filePath);\n      // 可读流通过管道写入可写流\n      reader.pipe(upStream);\n      return ctx.body = \"上传成功！\";\n  })\n\n  \n  // 上传多个文件\n  router.post('/uploadfiles', async (ctx, next) => {\n      // 获取上传文件，旧版本通过 ctx.request.body.files\n      const files = ctx.request.files.file; \n      for (let file of files) {\n        // 创建可读流\n        const reader = fs.createReadStream(file.path);\n        // 获取上传文件扩展名\n        let filePath = path.join(__dirname, 'public/upload/') + `/${file.name}`;\n        // 创建可写流\n        const upStream = fs.createWriteStream(filePath);\n        // 可读流通过管道写入可写流\n        reader.pipe(upStream);\n      }\n      return ctx.body = \"上传成功！\";\n  })\n  ```\n\n\n\n### 合并中间件\n  ```js\n  // koa-compose：将多个中间件合成为一个\n  const compose = require('koa-compose')\n  const first = asycn (ctx, next) => {\n      await next()\n  }\n  const second = async ctx => {\n      ctx.body = 'Hello'\n  }\n  const middle = compose([first, second])\n  app.use(middle)\n  ```\n\n\n# 三、Egg\n> 基于 koa2 的企业级框架，是由阿里 NodeJS 团队封装的企业级 Web 应用解决方案\n\n  <div style=\"text-indent: 2em\">官方定位是 为企业级框架和应用而生和孕育出更多上层框架，奉行 `约定优于配置`，帮助开发团队和开发人员降低开发和维护成本。async 的特性避免了回调地狱，洋葱式的中间件架构更容易后置逻辑，内置的多进程管理会更好的利用服务器性能，以及更方便的单元测试和更加约束的目录架构。</div>\n\n\n## 框架体系\n  * 核心体系：egg-core 模块\n    * 以 Koa.js 为基类，利用它的 中间件机制 和 HTTP服务机制 作为框架基础\n    * 以 Loader 机制作为 Egg.js 各分层机制的约定基础\n  * 辅助体系：egg-script、egg-bin 等模块\n    * 支持 开发模式、生产模式、多线程模式\n  * 生态体系：中间件、插件、框架\n\n\n## 主要特点\n  * 渐进式开发\n  * 内置多进程管理\n  * 高度可扩展的插件机制\n  * 框架稳定，测试覆盖率高\n  * 基于 Koa 开发，性能优异\n  * 提供基于 Egg 定制上层框架的能力\n\n\n## 搭建应用\n  ```js\n  npm i egg-init -g\n  egg-init test --type=simple  \n\n  cd test\n  npm install\n\n  npm run dev \n  ```\n\n\n## 项目运行\n  * 绿色虚线框中的所有组件组成了一个实际执行代码逻辑的进程\n  * request 进来后先穿过中间件，自定义中间件放在 app/middleware 并在 config 中启用\n  * 静态资源（project/app/public）经过内置的 egg-static 中间件时会直接响应给客户端，其它资源则会穿越所有中间件并到达路由文件 router.js\n  * 路由文件一般没有任何逻辑而只起到目录和索引的作用，它会直接指向一个处理请求的 controller（app/controller）\n  * Controller 负责调用并组合 Service（app/service），最后将响应提交给客户端。Service 负责调用 Model 处理具体的业务逻辑\n  * 除此之外，Worker 中还有定时任务（app/schedule）\n\n  <div align=\"center\"> \n    ![Egg Run](images/nodejs/egg-run.png)\n  </div> \n\n\n## 原理分析\n> 要分析框架的实现原理，直接从所有源码开始分析比较难。但是可以先将其精简到最小功能系统，然后针对各个功能进行分析和叠加 \n\n### 模块架构\n  <div align=\"center\"> \n    ![Egg Framework](images/nodejs/egg-framework.png)\n  </div> \n\n\n### 最简目录\n  ```js\n  ├── index.js          // 启动文件：初始化 应用实例 和 HTTP 服务器\n  ├── app               // 业务模块：路由文件\n  │     └── router.js   \n  ├── lib               // 应用模块：提供加载器和底层的中间件、插件、路由等机制\n  |     ├── egg-core \n  │     └── egg.js                    \n  └── package.json\n  ```\n\n\n### 执行流程\n  1. 应用初始化\n    * 加载所有 loader\n    * 加载所有中间件、插件等内容\n    * 路由注册\n  2. 服务启动\n    * 提供 http 服务\n    * 执行路由处理\n\n\n### 代码逻辑\n  1. EggApplication \n    * 继承：EggCore\n    * 构建：按照顺序加载所有中间件、插件、路由等内容，this.loader.loadAll()\n\n  2. EggCore\n    * 继承：Koa\n    * 功能\n      * 服务器的底层逻辑\n      * 工程项目文件的加载器\n      * 提供底层的中间件、插件、路由等机制\n    * 构建\n      * AppWorkerLoader\n        * 继承：EggLoader\n        * 加载器初始化：this.loader = new EggLoader()\n      * Router\n        * 继承：Koa-router\n        * 路由初始化：this.router = new Router()\n        * 路由方法注入：将路由方法注册到对象属性\n  3. EggLoader\n    * 构建：注入各种加载器方法\n              \n\n### 路由优化\n  * 路由大小写敏感\n  * RESTFul 实现\n  * Controller 句柄使用\n  * Generator Function 兼容\n\n\n\n### RESTFul\n> 测试时需要先安装接口测试工具：chrome postman，然后在 chrome 地址栏使用\n\n  * 约定路由路径和对应的控制器\n  * 统一处理封装 router 参数\n  * 统一封装 controller：根据请求类型和路径注册对应的控制器\n    * Async Function\n    * Generator Function\n    * controller 句柄读取 this.app.controller\n\n\n  ```js\n  // 路由文件添加\n  router.resources('users', '/v1/users', 'users');\n\n  // 新建文件 app/controller/users.js\n  const { Controller } = require('egg');\n\n  class UsersController extends Controller {\n\n      async create() {\n          const { ctx } = this;\n          this.ctx.body = '创建';\n      }\n      async destroy() {\n          const { ctx } = this;\n          this.ctx.body = '删除';\n      }\n      async update() {\n          const { ctx } = this;\n          this.ctx.body = '修改';\n      }\n      async show() {\n          const { ctx } = this;\n          this.ctx.body = '查询';\n      }\n      async index() {\n          const { ctx } = this;\n          this.ctx.body = '列表';\n      }\n      async new() {\n          const { ctx } = this;\n          this.ctx.body = '创建页面';\n      }\n      async edit() {\n          const { ctx } = this;\n          this.ctx.body = '修改页面';\n      }\n  }\n\n  module.exports = UsersController;\n  ```\n\n\n### 加载器\n  <div style=\"text-indent: 2em\">实际项目中的业务代码除了路由文件，还有 controller、service 等其他分层的源码文件。Egg.js 是通过加载器 EggLoader 将这些分层的项目业务代码、中间件和插件代码的大部分功能注入到 this、this.app、this.ctx 对象。</div>\n\n\n\n \n\n\n\n\n","slug":"20-Node框架","published":1,"updated":"2019-05-10T17:25:59.579Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvid4pls001b0nbxi29gzcq5","content":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><html><head></head><body><h1 id=\"一、Express\"><a href=\"#一、Express\" class=\"headerlink\" title=\"一、Express\"></a>一、Express</h1><blockquote><p>基于 ES5 语法实现而只能通过回调实现异步代码，框架本身缺少约束而写法较多，只适合开发小型项目并作为新手入门级框架</p></blockquote><h2 id=\"核心特性\"><a href=\"#核心特性\" class=\"headerlink\" title=\"核心特性\"></a>核心特性</h2><ul><li>设置中间件来响应 HTTP 请求</li><li>定义路由表用于执行不同的 HTTP 请求</li><li>通过向模板传递参数来动态渲染 HTML</li></ul><h2 id=\"基础使用\"><a href=\"#基础使用\" class=\"headerlink\" title=\"基础使用\"></a>基础使用</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> app = express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 设置 views 的文件夹和模板</span></span><br><span class=\"line\">app.set(<span class=\"string\">\"views\"</span>, __dirname + <span class=\"string\">\"/views\"</span>);</span><br><span class=\"line\">app.set(<span class=\"string\">\"view engine\"</span>, <span class=\"string\">\"jade\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 静态资源</span></span><br><span class=\"line\">app.use(express.static(__dirname + <span class=\"string\">'/public'</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 动态渲染</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">    res.send(<span class=\"string\">'Hello world'</span>);</span><br><span class=\"line\">}).listen(<span class=\"number\">3000</span>)</span><br></pre></td></tr></tbody></table></figure><h2 id=\"搭建应用\"><a href=\"#搭建应用\" class=\"headerlink\" title=\"搭建应用\"></a>搭建应用</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 默认 localhost:3000</span></span><br><span class=\"line\">npm install express express-generator -g </span><br><span class=\"line\"></span><br><span class=\"line\">express -e myApp  <span class=\"comment\">// 使用 ejs 模板</span></span><br><span class=\"line\">cd myApp</span><br><span class=\"line\">npm install</span><br><span class=\"line\"></span><br><span class=\"line\">npm start</span><br></pre></td></tr></tbody></table></figure><h2 id=\"中间件\"><a href=\"#中间件\" class=\"headerlink\" title=\"中间件\"></a>中间件</h2><blockquote><p>本质是处理 HTTP 请求的函数。每个中间件都可以接收到请求对象 req、响应对象 res 和回调函数 next 这三个参数，经过处理后可以通过调用 next() 传递给下一个中间件</p></blockquote><h3 id=\"分类\"><a href=\"#分类\" class=\"headerlink\" title=\"分类\"></a>分类</h3><ul><li><strong>应用级中间件</strong>：使用 app.use/method 绑定到 app 对象</li><li><strong>路由级中间件</strong>：使用 router.use/method 绑定到 express.Router() 对象</li><li><strong>错误处理中间件</strong>：接收四个参数，用于处理应用中的错误</li><li><strong>第三方中间件</strong>：安装后 require 到文件中使用，用来扩展功能</li><li><strong>内置中间件</strong>：express.static 托管静态资源、express.json 解析请求</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 应用级</span></span><br><span class=\"line\">app.use(<span class=\"function\">(<span class=\"params\">req,res,next</span>) =></span> {   </span><br><span class=\"line\">    next()   </span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 路由级</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> router = express.Router()</span><br><span class=\"line\">router.get(<span class=\"string\">'/user/:id'</span>, (req, res, next) => {</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(req.params.id==<span class=\"number\">0</span>) next(<span class=\"string\">'route'</span>)</span><br><span class=\"line\">    <span class=\"keyword\">else</span> next()</span><br><span class=\"line\">},(req, res, next) => {</span><br><span class=\"line\">    res.end(<span class=\"string\">\"Hello world\"</span>);</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 错误处理</span></span><br><span class=\"line\">app.use(<span class=\"function\">(<span class=\"params\">err, req, res, next</span>) =></span> {</span><br><span class=\"line\">    res.status(<span class=\"number\">500</span>).send(<span class=\"string\">'Something broke'</span>)</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 内置中间件 </span></span><br><span class=\"line\">app.use(express.static(__dirname + <span class=\"string\">'/public'</span>))</span><br></pre></td></tr></tbody></table></figure><h3 id=\"定义方法\"><a href=\"#定义方法\" class=\"headerlink\" title=\"定义方法\"></a>定义方法</h3><ul><li><strong>app.use</strong>：会对客户端请求路径及其所有扩展结果进行匹配</li><li><strong>app.method</strong>：会对客户端请求路径进行精确匹配，但会忽略其中的锚点和 get 提交的参数数据</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 路径默认 '/'，匹配所有路径(都可以看作是 '/' 的扩展)</span></span><br><span class=\"line\">app.use(<span class=\"function\">(<span class=\"params\">req, res, next</span>) =></span> { })</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 路径默认 '/' ，只匹配根路径</span></span><br><span class=\"line\">app.get(<span class=\"function\">(<span class=\"params\">req, res, next</span>) =></span> { })</span><br></pre></td></tr></tbody></table></figure><h3 id=\"响应方法\"><a href=\"#响应方法\" class=\"headerlink\" title=\"响应方法\"></a>响应方法</h3><ul><li><strong>res.end</strong>：结束响应进程但不返回数据</li><li><strong>res.send</strong>：发送各种类型的响应</li><li><strong>res.json</strong>：发送 JSON 响应</li><li><strong>res.jsonp</strong>：在 JSONP 的支持下发送 JSON 响应</li><li><strong>res.render</strong>：呈现视图模板</li><li><strong>res.redirect</strong>：重定向请求</li><li><strong>res.sendFile</strong>：以八位元流形式发送文件</li><li><strong>res.download</strong>：提示将要下载文件</li><li><strong>res.sendStatus</strong>：设置响应状态码并发送其字符串表示</li></ul><h2 id=\"路由管理\"><a href=\"#路由管理\" class=\"headerlink\" title=\"路由管理\"></a>路由管理</h2><h3 id=\"路径规则\"><a href=\"#路径规则\" class=\"headerlink\" title=\"路径规则\"></a>路径规则</h3><ul><li>url 字符串不区分字母的大小写</li><li>url 传递的数据通过冒号语法提取</li><li>所有 get 方式提交的 url 参数及锚点均会被忽略</li><li>所有路由中间件的书写顺序至关重要，只会执行首次匹配到的中间件</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// localhost:3000/tom/24：tom, 24</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/:name/:age'</span>, (req, res)=>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(req.params.name, req.params.age)</span><br><span class=\"line\">    res.send()</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// localhost:3000/a#?name=tom </span></span><br><span class=\"line\">app.get(<span class=\"string\">'/a'</span>, (req, res)=>{</span><br><span class=\"line\">    res.send(<span class=\"string\">'success'</span>)</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// localhost:3000/admin/login：只执行第一个</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/:username/:method'</span>, (req, res)=>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>)</span><br><span class=\"line\">    res.end()  <span class=\"comment\">// 此处如果执行 next() 则会第二个</span></span><br><span class=\"line\">})</span><br><span class=\"line\">app.get(<span class=\"string\">'/admin/login'</span>, (req, res)=>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>)</span><br><span class=\"line\">    res.end()</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h3 id=\"路径匹配\"><a href=\"#路径匹配\" class=\"headerlink\" title=\"路径匹配\"></a>路径匹配</h3><h4 id=\"字符串\"><a href=\"#字符串\" class=\"headerlink\" title=\"字符串\"></a>字符串</h4><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 匹配根路径的请求</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">    res.send(<span class=\"string\">'root'</span>);</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 /about 路径的请求</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/about'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">    res.send(<span class=\"string\">'about'</span>);</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 /random.text 路径的请求</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/random.text'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">    res.send(<span class=\"string\">'random.text'</span>);</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h4 id=\"字符串模式\"><a href=\"#字符串模式\" class=\"headerlink\" title=\"字符串模式\"></a>字符串模式</h4><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 匹配 /user、/user/5，去掉 ? 则只匹配 /user/5</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/user/:id?'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">    res.send(<span class=\"string\">'/users/:id?'</span>)</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 acd 和 abcd</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/ab?cd'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">    res.send(<span class=\"string\">'ab?cd'</span>)</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 /abe 和 /abcde</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/ab(cd)?e'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">    res.send(<span class=\"string\">'ab(cd)?e'</span>)</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 abcd、abbcd、abbbcd等</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/ab+cd'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">    res.send(<span class=\"string\">'ab+cd'</span>)</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 abcd、abxcd、abRABDOMcd、ab123cd等</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/ab*cd'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">    res.send(<span class=\"string\">'ab*cd'</span>)</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h4 id=\"正则表达式\"><a href=\"#正则表达式\" class=\"headerlink\" title=\"正则表达式\"></a>正则表达式</h4><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 匹配任何路径中含有 a 的路径：</span></span><br><span class=\"line\">app.get(<span class=\"regexp\">/a/</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">    res.send(<span class=\"string\">'/a/'</span>)</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 butterfly、dragonfly，不匹配 butterflyman、dragonfly man等</span></span><br><span class=\"line\">app.get(<span class=\"regexp\">/.*fly$/</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">    res.send(<span class=\"string\">'/.*fly$/'</span>)</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h4 id=\"数组\"><a href=\"#数组\" class=\"headerlink\" title=\"数组\"></a>数组</h4><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 匹配 /abcd、/xyza、/lmnand、/pqr</span></span><br><span class=\"line\">app.use([<span class=\"string\">'/abcd'</span>, <span class=\"string\">'/xyza'</span>, /\\/lmn|\\/pqr/], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>{</span><br><span class=\"line\">    next()</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h3 id=\"路由句柄\"><a href=\"#路由句柄\" class=\"headerlink\" title=\"路由句柄\"></a>路由句柄</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 一个回调函数</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/example/a'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">    res.send(<span class=\"string\">'Hello from A'</span>)</span><br><span class=\"line\">})</span><br><span class=\"line\"><span class=\"comment\">// 多个回调函数</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/example/b'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>{</span><br><span class=\"line\">    next()</span><br><span class=\"line\">}, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">    res.send(<span class=\"string\">'Hello'</span>)</span><br><span class=\"line\">});</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 回调函数数组</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>{ next() }</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>{ next() }</span><br><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>{ res.send(<span class=\"string\">'Hello from C'</span>) }</span><br><span class=\"line\">app.get(<span class=\"string\">'/example/c'</span>, [a, b, c])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 混合使用</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/example/d'</span>, [a, b], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>{</span><br><span class=\"line\">    next()</span><br><span class=\"line\">}, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">    res.send(<span class=\"string\">'Hello from D'</span>);</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h3 id=\"参数解析\"><a href=\"#参数解析\" class=\"headerlink\" title=\"参数解析\"></a>参数解析</h3><ul><li><strong>req.param</strong>：已被弃用</li><li><strong>req.query</strong>：解析 GET 请求中的查询字符串</li><li><strong>req.body</strong>：解析 POST 请求中的数据（需引用body-parser）</li><li><strong>req.params</strong>：解析 GET/POST 请求中的占位符数据（如/:name）</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// user/10</span></span><br><span class=\"line\">app.get(<span class=\"string\">\"user/:id\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">    res.send(req.params[<span class=\"string\">\"id\"</span>])</span><br><span class=\"line\">});</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// user/?id=10</span></span><br><span class=\"line\">app.get(<span class=\"string\">\"/user\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">    res.send(req.query[<span class=\"string\">\"id\"</span>])</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 通过 body-parser 模块获取 post 请求数据</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> bodyParser=<span class=\"built_in\">require</span>(<span class=\"string\">'body-parser'</span>)</span><br><span class=\"line\">app.use(bodyParser.urlencoded({ <span class=\"attr\">extended</span>: <span class=\"literal\">true</span> }))</span><br><span class=\"line\">app.post(<span class=\"string\">\"/login\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">    res.send(req.body.name, req.body.password)</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h3 id=\"特殊路由\"><a href=\"#特殊路由\" class=\"headerlink\" title=\"特殊路由\"></a>特殊路由</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 验证或处理 路径参数</span></span><br><span class=\"line\">router.param(<span class=\"string\">'id'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next, id</span>) </span>{</span><br><span class=\"line\">    req.name = name</span><br><span class=\"line\">    next()</span><br><span class=\"line\">})</span><br><span class=\"line\">router.get(<span class=\"string\">'/user/:id'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">    res.send(<span class=\"string\">'hello '</span> + req.name)</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 链式路由：一个路径处理多种请求</span></span><br><span class=\"line\">app.route(<span class=\"string\">'/book'</span>)</span><br><span class=\"line\">  .get(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">      res.send(<span class=\"string\">'Get a random book'</span>);</span><br><span class=\"line\">  })</span><br><span class=\"line\">  .post(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">      res.send(<span class=\"string\">'Add a book'</span>);</span><br><span class=\"line\">  })</span><br></pre></td></tr></tbody></table></figure><h3 id=\"next-方法\"><a href=\"#next-方法\" class=\"headerlink\" title=\"next 方法\"></a>next 方法</h3><ul><li><strong>next()</strong>：从下一个处理函数开始往下执行</li><li><strong>next(‘router’)</strong>：直接执行下一个相同路由</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.get(<span class=\"string\">'/'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>)</span><br><span class=\"line\">    next()           </span><br><span class=\"line\">    <span class=\"comment\">// 结果：1234，替换为next('route')则结果：1234</span></span><br><span class=\"line\">    </span><br><span class=\"line\">}, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>)</span><br><span class=\"line\">    next(<span class=\"string\">'route'</span>)</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>)</span><br><span class=\"line\">    next()</span><br><span class=\"line\">}, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">4</span>)</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h1 id=\"二、Koa\"><a href=\"#二、Koa\" class=\"headerlink\" title=\"二、Koa\"></a>二、Koa</h1><blockquote><p>Express 团队打造的进阶框架，基于 ES7 语法使用 Promise 实现异步而极大简化了异步代码。但是开发项目时缺少约束，多人开发时代码合并困难而不适合团队协作开发项目</p></blockquote><h2 id=\"主要特点\"><a href=\"#主要特点\" class=\"headerlink\" title=\"主要特点\"></a>主要特点</h2><ul><li><strong>洋葱中间件模式</strong>：next函数决定是否执行下一个中间件</li><li><strong>Context 对象</strong>：内部封装了 HTTP 请求对象和响应对象</li><li><strong>异步处理</strong>：使用 Promise 并配合 async await 实现异步</li></ul><h2 id=\"基础使用-1\"><a href=\"#基础使用-1\" class=\"headerlink\" title=\"基础使用\"></a>基础使用</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// npm install koa koa-route</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> Koa = <span class=\"built_in\">require</span>(<span class=\"string\">'koa'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Koa()</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> route = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-route'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 静态资源服务器：npm install koa-static</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> serve = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-static'</span>)</span><br><span class=\"line\">app.use(serve(path.join(__dirname, <span class=\"string\">'/public'</span>)))</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 动态渲染页面：npm install koa-views ejs</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> views = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-views'</span>);</span><br><span class=\"line\">app.use(views(__dirname,{</span><br><span class=\"line\">    extension:<span class=\"string\">'ejs'</span> <span class=\"comment\">//指定用ejs模板</span></span><br><span class=\"line\">}))</span><br><span class=\"line\">app.use(<span class=\"keyword\">async</span> (ctx, next)=>{</span><br><span class=\"line\">    <span class=\"comment\">// 渲染 index.ejs</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> ctx.render(<span class=\"string\">'index'</span>, {<span class=\"attr\">name</span>:<span class=\"string\">'cgp'</span>, <span class=\"attr\">age</span>:<span class=\"number\">9</span>})</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">3000</span>)</span><br></pre></td></tr></tbody></table></figure><h2 id=\"搭建应用-1\"><a href=\"#搭建应用-1\" class=\"headerlink\" title=\"搭建应用\"></a>搭建应用</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 默认 localhost:3000</span></span><br><span class=\"line\">npm install koa koa-generator -g </span><br><span class=\"line\"></span><br><span class=\"line\">koa2 project </span><br><span class=\"line\">cd project</span><br><span class=\"line\">npm install</span><br><span class=\"line\"></span><br><span class=\"line\">npm start</span><br></pre></td></tr></tbody></table></figure><h2 id=\"路由管理-1\"><a href=\"#路由管理-1\" class=\"headerlink\" title=\"路由管理\"></a>路由管理</h2><h3 id=\"原生路由\"><a href=\"#原生路由\" class=\"headerlink\" title=\"原生路由\"></a>原生路由</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 通过 ctx.request.path 获取用户请求的路径</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"params\">ctx</span> =></span> {</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ctx.request.path == <span class=\"string\">'/'</span>) {</span><br><span class=\"line\">        <span class=\"comment\">// ctx.response.body的简写 </span></span><br><span class=\"line\">        ctx.body = <span class=\"string\">'<p>Hello World</p>'</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h3 id=\"路由中间件\"><a href=\"#路由中间件\" class=\"headerlink\" title=\"路由中间件\"></a>路由中间件</h3><blockquote><p>安装：npm install koa koa-router</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Koa = <span class=\"built_in\">require</span>(<span class=\"string\">'koa'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"keyword\">new</span> Koa();</span><br><span class=\"line\"><span class=\"keyword\">var</span> router = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-router'</span>)();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 基础用法：常用 get、post、all</span></span><br><span class=\"line\">router.get(<span class=\"string\">'/'</span>, <span class=\"keyword\">async</span> (ctx, next)=>{</span><br><span class=\"line\">    ctx.body = <span class=\"string\">'hello people'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">await</span> next()</span><br><span class=\"line\">});</span><br><span class=\"line\">router.get(<span class=\"string\">'/list'</span>, <span class=\"keyword\">async</span> (ctx, next)=>{</span><br><span class=\"line\">    ctx.body = <span class=\"string\">'list'</span>;</span><br><span class=\"line\">});</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 传递参数</span></span><br><span class=\"line\">router.get(<span class=\"string\">'/home'</span>, (ctx,next)=>{ </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'/home?id=1 传递参数：'</span>, ctx.query);</span><br><span class=\"line\">    next();</span><br><span class=\"line\">});</span><br><span class=\"line\">router.get(<span class=\"string\">'/user/:name'</span>, (ctx, next) => {</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'/user/tom 传递参数：'</span>, ctx.params.name);</span><br><span class=\"line\">    next();</span><br><span class=\"line\">});</span><br><span class=\"line\">router.post(<span class=\"string\">'/user/register'</span>,<span class=\"keyword\">async</span>(ctx, next)=>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(ctx.request.body)</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 重定向</span></span><br><span class=\"line\">router.get(<span class=\"string\">'/login'</span>, <span class=\"keyword\">async</span> (ctx, next) => {</span><br><span class=\"line\">    ctx.redirect(<span class=\"string\">'/user'</span>)</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 嵌套路由</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> home = <span class=\"keyword\">new</span> Router();</span><br><span class=\"line\">home.get(<span class=\"string\">'/list'</span>, <span class=\"keyword\">async</span>(ctx)=>{</span><br><span class=\"line\">    ctx.body = <span class=\"string\">\"Home list\"</span>;</span><br><span class=\"line\">}).get(<span class=\"string\">'/todo'</span>, <span class=\"keyword\">async</span>(ctx)=>{</span><br><span class=\"line\">    ctx.body =<span class=\"string\">'Home ToDo'</span>;</span><br><span class=\"line\">});</span><br><span class=\"line\"><span class=\"keyword\">let</span> user = <span class=\"keyword\">new</span> Router();</span><br><span class=\"line\">user.get(<span class=\"string\">'/list'</span>, <span class=\"keyword\">async</span>(ctx)=>{</span><br><span class=\"line\">    ctx.body = <span class=\"string\">\"User list\"</span>;</span><br><span class=\"line\">});</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 装载所有子路由</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> router = <span class=\"keyword\">new</span> Router();</span><br><span class=\"line\">router.use(<span class=\"string\">'/home'</span>, home.routes(), home.allowedMethods());</span><br><span class=\"line\">router.use(<span class=\"string\">'/user'</span>, user.routes(), user.allowedMethods());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 加载路由：当请求数据的方法与设置的方法不一致时会报错</span></span><br><span class=\"line\">app.use(router.routes()).use(router.allowedMethods());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 监听服务</span></span><br><span class=\"line\">app.listen(<span class=\"number\">3000</span>);</span><br></pre></td></tr></tbody></table></figure><h2 id=\"中间件-1\"><a href=\"#中间件-1\" class=\"headerlink\" title=\"中间件\"></a>中间件</h2><div style=\"text-indent:2em\">每个中间件默认接受 <code>Context 对象、next 函数</code> 两个参数。`Context 对象内部封装了原生 NodeJS 包含的 request、response 对象，分别为 ctx.req、ctx.res。next函数被调用时，会暂停该中间件的运行并将控制传递给下一个中间件。</div><h3 id=\"分类-1\"><a href=\"#分类-1\" class=\"headerlink\" title=\"分类\"></a>分类</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 第三方中间件：引入koa-router并对其实例化</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> router = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-router'</span>)()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 错误处理中间件</span></span><br><span class=\"line\">app.use(<span class=\"keyword\">async</span> (ctx, next) => {</span><br><span class=\"line\">    <span class=\"keyword\">try</span> {</span><br><span class=\"line\">        <span class=\"keyword\">await</span> next()</span><br><span class=\"line\">    } <span class=\"keyword\">catch</span> (error) {</span><br><span class=\"line\">        ctx.response.body = {</span><br><span class=\"line\">        code: <span class=\"string\">'404'</span>,</span><br><span class=\"line\">        message: <span class=\"string\">'服务器异常'</span>,</span><br><span class=\"line\">        desc: error.message</span><br><span class=\"line\">    }</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 应用级中间件</span></span><br><span class=\"line\">app.use(<span class=\"keyword\">async</span> (ctx, next) => {</span><br><span class=\"line\">    <span class=\"keyword\">await</span> next();</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(ctx.status === <span class=\"number\">404</span>){</span><br><span class=\"line\">        ctx.body = <span class=\"string\">\"404页面\"</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 路由级中间件</span></span><br><span class=\"line\">router.get(<span class=\"string\">'/'</span>, <span class=\"keyword\">async</span> ctx => {</span><br><span class=\"line\">    ctx.body = <span class=\"string\">'hello koa'</span>;</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 启动路由</span></span><br><span class=\"line\">app.use(router.routes()).use(router.allowedMethods())</span><br></pre></td></tr></tbody></table></figure><h3 id=\"执行顺序\"><a href=\"#执行顺序\" class=\"headerlink\" title=\"执行顺序\"></a>执行顺序</h3><ul><li>多个中间件会形成堆栈结构，按先进后出顺序执行。</li><li>任何路由都会先经过应用级中间件，当执行完成next后再去匹配相应路由</li><li>路由在匹配成功并执行完相应操作后还会再次进入应用级中间件执行 next 之后的逻辑</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.use(<span class=\"keyword\">async</span> (ctx, next) => {</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'1'</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> next();</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'7'</span>)</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(<span class=\"keyword\">async</span> (ctx, next) => {</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'2'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">await</span> next();</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'4'</span>)</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\">router.get(<span class=\"string\">'/user'</span>, <span class=\"keyword\">async</span> (ctx, next) => {</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'3'</span>)</span><br><span class=\"line\">    ctx.body = <span class=\"string\">'Hello Koa'</span>;</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h3 id=\"第三方中间件\"><a href=\"#第三方中间件\" class=\"headerlink\" title=\"第三方中间件\"></a>第三方中间件</h3><ul><li><strong>kao-views</strong>：模板渲染</li><li><strong>koa-router</strong>：路由处理</li><li><strong>koa-static</strong>：静态文件读取</li><li><strong>koa-bodyparse</strong>：处理post请求的数据</li></ul><h2 id=\"常用功能\"><a href=\"#常用功能\" class=\"headerlink\" title=\"常用功能\"></a>常用功能</h2><h3 id=\"Cookies\"><a href=\"#Cookies\" class=\"headerlink\" title=\"Cookies\"></a>Cookies</h3><blockquote><p>框架自带属性，不需要引入中间件</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 设置中文时报错解决</span></span><br><span class=\"line\">app.use(<span class=\"keyword\">async</span> (ctx, next) => {</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 使用new Buffer().toString('base64')转换</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.cookies.set(<span class=\"string\">'test'</span>, <span class=\"keyword\">new</span> Buffer(<span class=\"string\">'你好'</span>).toString(<span class=\"string\">'base64'</span>))</span><br><span class=\"line\">    <span class=\"keyword\">const</span> test = <span class=\"keyword\">new</span> Buffer(ctx.cookies.get(<span class=\"string\">'test'</span>), <span class=\"string\">'base64'</span>).toString()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 使用encodeURIComponent()转换</span></span><br><span class=\"line\">    ctx.cookies.set(<span class=\"string\">'name'</span>, <span class=\"built_in\">encodeURIComponent</span>(<span class=\"string\">'李'</span>))</span><br><span class=\"line\">    <span class=\"keyword\">const</span> name = <span class=\"built_in\">decodeURIComponent</span>(ctx.cookies.get(<span class=\"string\">'name'</span>))</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h3 id=\"表单处理\"><a href=\"#表单处理\" class=\"headerlink\" title=\"表单处理\"></a>表单处理</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-router'</span>)();</span><br><span class=\"line\"><span class=\"keyword\">const</span> bodyParser = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-bodyparse'</span>);</span><br><span class=\"line\">app.use(bodyParser()); </span><br><span class=\"line\"></span><br><span class=\"line\">router.post(<span class=\"string\">'/add'</span>, <span class=\"keyword\">async</span> (ctx)=>{</span><br><span class=\"line\">    <span class=\"comment\">// 获取表单提交的数据</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> body = ctx.request.body</span><br><span class=\"line\">    ctx.body = { <span class=\"attr\">name</span>: body.name }</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h3 id=\"上传文件\"><a href=\"#上传文件\" class=\"headerlink\" title=\"上传文件\"></a>上传文件</h3><div align=\"center\"><br><img src=\"images/nodejs/node-uploadFile.png\" alt=\"Node UploadFile\"><br></div><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 引入：npm install koa-body --save</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> koaBody = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-body'</span>);</span><br><span class=\"line\">app.use(koaBody({</span><br><span class=\"line\">    multipart: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    formidable: {</span><br><span class=\"line\">        maxFileSize: <span class=\"number\">200</span>*<span class=\"number\">1024</span>*<span class=\"number\">1024</span>  <span class=\"comment\">// 设置文件最大限制，默认 2M</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">}));</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 上传图片</span></span><br><span class=\"line\">router.post(<span class=\"string\">'/file_upload'</span>, <span class=\"keyword\">async</span> (ctx) => {</span><br><span class=\"line\">    <span class=\"comment\">// 获取上传图片</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> data = ctx.request.body.files.data;</span><br><span class=\"line\">    <span class=\"comment\">// 创建可读流</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> savePath = path.join(<span class=\"string\">`./files`</span>, data.name)</span><br><span class=\"line\">    <span class=\"keyword\">const</span> reader = fs.createReadStream(data.path)</span><br><span class=\"line\">    <span class=\"comment\">// 创建可写流</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> writer = fs.createWriteStream(savePath)</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">const</span> pro = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>( <span class=\"function\">(<span class=\"params\">resolve, reject</span>) =></span> {</span><br><span class=\"line\">        <span class=\"comment\">// 可读流通过管道写入可写流</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> stream = reader.pipe(writer);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 图片上传成功后返回服务器地址，实时显示服务器图片</span></span><br><span class=\"line\">        stream.on(<span class=\"string\">'finish'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">            resolve(<span class=\"string\">`http://当前服务器地址<span class=\"subst\">${data.name}</span>`</span>);</span><br><span class=\"line\">        });</span><br><span class=\"line\">    })</span><br><span class=\"line\">    ctx.response.body =  <span class=\"keyword\">await</span> pro</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 上传单个文件</span></span><br><span class=\"line\">router.post(<span class=\"string\">'/uploadfile'</span>, <span class=\"keyword\">async</span> (ctx, next) => {</span><br><span class=\"line\">    <span class=\"comment\">// 获取上传文件</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> file = ctx.request.files.file; </span><br><span class=\"line\">    <span class=\"comment\">// 创建可读流</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> reader = fs.createReadStream(file.path);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> filePath = path.join(__dirname, <span class=\"string\">'public/upload/'</span>) + <span class=\"string\">`/<span class=\"subst\">${file.name}</span>`</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 创建可写流</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> upStream = fs.createWriteStream(filePath);</span><br><span class=\"line\">    <span class=\"comment\">// 可读流通过管道写入可写流</span></span><br><span class=\"line\">    reader.pipe(upStream);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ctx.body = <span class=\"string\">\"上传成功！\"</span>;</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 上传多个文件</span></span><br><span class=\"line\">router.post(<span class=\"string\">'/uploadfiles'</span>, <span class=\"keyword\">async</span> (ctx, next) => {</span><br><span class=\"line\">    <span class=\"comment\">// 获取上传文件，旧版本通过 ctx.request.body.files</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> files = ctx.request.files.file; </span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> file <span class=\"keyword\">of</span> files) {</span><br><span class=\"line\">      <span class=\"comment\">// 创建可读流</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> reader = fs.createReadStream(file.path);</span><br><span class=\"line\">      <span class=\"comment\">// 获取上传文件扩展名</span></span><br><span class=\"line\">      <span class=\"keyword\">let</span> filePath = path.join(__dirname, <span class=\"string\">'public/upload/'</span>) + <span class=\"string\">`/<span class=\"subst\">${file.name}</span>`</span>;</span><br><span class=\"line\">      <span class=\"comment\">// 创建可写流</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> upStream = fs.createWriteStream(filePath);</span><br><span class=\"line\">      <span class=\"comment\">// 可读流通过管道写入可写流</span></span><br><span class=\"line\">      reader.pipe(upStream);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ctx.body = <span class=\"string\">\"上传成功！\"</span>;</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h3 id=\"合并中间件\"><a href=\"#合并中间件\" class=\"headerlink\" title=\"合并中间件\"></a>合并中间件</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// koa-compose：将多个中间件合成为一个</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> compose = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-compose'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> first = asycn (ctx, next) => {</span><br><span class=\"line\">    <span class=\"keyword\">await</span> next()</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">const</span> second = <span class=\"keyword\">async</span> ctx => {</span><br><span class=\"line\">    ctx.body = <span class=\"string\">'Hello'</span></span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">const</span> middle = compose([first, second])</span><br><span class=\"line\">app.use(middle)</span><br></pre></td></tr></tbody></table></figure><h1 id=\"三、Egg\"><a href=\"#三、Egg\" class=\"headerlink\" title=\"三、Egg\"></a>三、Egg</h1><blockquote><p>基于 koa2 的企业级框架，是由阿里 NodeJS 团队封装的企业级 Web 应用解决方案</p></blockquote><div style=\"text-indent:2em\">官方定位是 为企业级框架和应用而生和孕育出更多上层框架，奉行 <code>约定优于配置</code>，帮助开发团队和开发人员降低开发和维护成本。async 的特性避免了回调地狱，洋葱式的中间件架构更容易后置逻辑，内置的多进程管理会更好的利用服务器性能，以及更方便的单元测试和更加约束的目录架构。</div><h2 id=\"框架体系\"><a href=\"#框架体系\" class=\"headerlink\" title=\"框架体系\"></a>框架体系</h2><ul><li>核心体系：egg-core 模块<ul><li>以 Koa.js 为基类，利用它的 中间件机制 和 HTTP服务机制 作为框架基础</li><li>以 Loader 机制作为 Egg.js 各分层机制的约定基础</li></ul></li><li>辅助体系：egg-script、egg-bin 等模块<ul><li>支持 开发模式、生产模式、多线程模式</li></ul></li><li>生态体系：中间件、插件、框架</li></ul><h2 id=\"主要特点-1\"><a href=\"#主要特点-1\" class=\"headerlink\" title=\"主要特点\"></a>主要特点</h2><ul><li>渐进式开发</li><li>内置多进程管理</li><li>高度可扩展的插件机制</li><li>框架稳定，测试覆盖率高</li><li>基于 Koa 开发，性能优异</li><li>提供基于 Egg 定制上层框架的能力</li></ul><h2 id=\"搭建应用-2\"><a href=\"#搭建应用-2\" class=\"headerlink\" title=\"搭建应用\"></a>搭建应用</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i egg-init -g</span><br><span class=\"line\">egg-init test --type=simple  </span><br><span class=\"line\"></span><br><span class=\"line\">cd test</span><br><span class=\"line\">npm install</span><br><span class=\"line\"></span><br><span class=\"line\">npm run dev</span><br></pre></td></tr></tbody></table></figure><h2 id=\"项目运行\"><a href=\"#项目运行\" class=\"headerlink\" title=\"项目运行\"></a>项目运行</h2><ul><li>绿色虚线框中的所有组件组成了一个实际执行代码逻辑的进程</li><li>request 进来后先穿过中间件，自定义中间件放在 app/middleware 并在 config 中启用</li><li>静态资源（project/app/public）经过内置的 egg-static 中间件时会直接响应给客户端，其它资源则会穿越所有中间件并到达路由文件 router.js</li><li>路由文件一般没有任何逻辑而只起到目录和索引的作用，它会直接指向一个处理请求的 controller（app/controller）</li><li>Controller 负责调用并组合 Service（app/service），最后将响应提交给客户端。Service 负责调用 Model 处理具体的业务逻辑</li><li><p>除此之外，Worker 中还有定时任务（app/schedule）</p><div align=\"center\"><br><img src=\"images/nodejs/egg-run.png\" alt=\"Egg Run\"><br></div></li></ul><h2 id=\"原理分析\"><a href=\"#原理分析\" class=\"headerlink\" title=\"原理分析\"></a>原理分析</h2><blockquote><p>要分析框架的实现原理，直接从所有源码开始分析比较难。但是可以先将其精简到最小功能系统，然后针对各个功能进行分析和叠加</p></blockquote><h3 id=\"模块架构\"><a href=\"#模块架构\" class=\"headerlink\" title=\"模块架构\"></a>模块架构</h3><div align=\"center\"><br><img src=\"images/nodejs/egg-framework.png\" alt=\"Egg Framework\"><br></div><h3 id=\"最简目录\"><a href=\"#最简目录\" class=\"headerlink\" title=\"最简目录\"></a>最简目录</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">├── index.js          <span class=\"comment\">// 启动文件：初始化 应用实例 和 HTTP 服务器</span></span><br><span class=\"line\">├── app               <span class=\"comment\">// 业务模块：路由文件</span></span><br><span class=\"line\">│     └── router.js   </span><br><span class=\"line\">├── lib               <span class=\"comment\">// 应用模块：提供加载器和底层的中间件、插件、路由等机制</span></span><br><span class=\"line\">|     ├── egg-core </span><br><span class=\"line\">│     └── egg.js                    </span><br><span class=\"line\">└── package.json</span><br></pre></td></tr></tbody></table></figure><h3 id=\"执行流程\"><a href=\"#执行流程\" class=\"headerlink\" title=\"执行流程\"></a>执行流程</h3><ol><li>应用初始化<ul><li>加载所有 loader</li><li>加载所有中间件、插件等内容</li><li>路由注册</li></ul></li><li>服务启动<ul><li>提供 http 服务</li><li>执行路由处理</li></ul></li></ol><h3 id=\"代码逻辑\"><a href=\"#代码逻辑\" class=\"headerlink\" title=\"代码逻辑\"></a>代码逻辑</h3><ol><li><p>EggApplication</p><ul><li>继承：EggCore</li><li>构建：按照顺序加载所有中间件、插件、路由等内容，this.loader.loadAll()</li></ul></li><li><p>EggCore</p><ul><li>继承：Koa</li><li>功能<ul><li>服务器的底层逻辑</li><li>工程项目文件的加载器</li><li>提供底层的中间件、插件、路由等机制</li></ul></li><li>构建<ul><li>AppWorkerLoader<ul><li>继承：EggLoader</li><li>加载器初始化：this.loader = new EggLoader()</li></ul></li><li>Router<ul><li>继承：Koa-router</li><li>路由初始化：this.router = new Router()</li><li>路由方法注入：将路由方法注册到对象属性</li></ul></li></ul></li></ul></li><li>EggLoader<ul><li>构建：注入各种加载器方法</li></ul></li></ol><h3 id=\"路由优化\"><a href=\"#路由优化\" class=\"headerlink\" title=\"路由优化\"></a>路由优化</h3><ul><li>路由大小写敏感</li><li>RESTFul 实现</li><li>Controller 句柄使用</li><li>Generator Function 兼容</li></ul><h3 id=\"RESTFul\"><a href=\"#RESTFul\" class=\"headerlink\" title=\"RESTFul\"></a>RESTFul</h3><blockquote><p>测试时需要先安装接口测试工具：chrome postman，然后在 chrome 地址栏使用</p></blockquote><ul><li>约定路由路径和对应的控制器</li><li>统一处理封装 router 参数</li><li>统一封装 controller：根据请求类型和路径注册对应的控制器<ul><li>Async Function</li><li>Generator Function</li><li>controller 句柄读取 this.app.controller</li></ul></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 路由文件添加</span></span><br><span class=\"line\">router.resources(<span class=\"string\">'users'</span>, <span class=\"string\">'/v1/users'</span>, <span class=\"string\">'users'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 新建文件 app/controller/users.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> { Controller } = <span class=\"built_in\">require</span>(<span class=\"string\">'egg'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UsersController</span> <span class=\"keyword\">extends</span> <span class=\"title\">Controller</span> </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">async</span> create() {</span><br><span class=\"line\">        <span class=\"keyword\">const</span> { ctx } = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.ctx.body = <span class=\"string\">'创建'</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">async</span> destroy() {</span><br><span class=\"line\">        <span class=\"keyword\">const</span> { ctx } = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.ctx.body = <span class=\"string\">'删除'</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">async</span> update() {</span><br><span class=\"line\">        <span class=\"keyword\">const</span> { ctx } = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.ctx.body = <span class=\"string\">'修改'</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">async</span> show() {</span><br><span class=\"line\">        <span class=\"keyword\">const</span> { ctx } = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.ctx.body = <span class=\"string\">'查询'</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">async</span> index() {</span><br><span class=\"line\">        <span class=\"keyword\">const</span> { ctx } = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.ctx.body = <span class=\"string\">'列表'</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"keyword\">new</span>() {</span><br><span class=\"line\">        <span class=\"keyword\">const</span> { ctx } = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.ctx.body = <span class=\"string\">'创建页面'</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">async</span> edit() {</span><br><span class=\"line\">        <span class=\"keyword\">const</span> { ctx } = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.ctx.body = <span class=\"string\">'修改页面'</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = UsersController;</span><br></pre></td></tr></tbody></table></figure><h3 id=\"加载器\"><a href=\"#加载器\" class=\"headerlink\" title=\"加载器\"></a>加载器</h3><div style=\"text-indent:2em\">实际项目中的业务代码除了路由文件，还有 controller、service 等其他分层的源码文件。Egg.js 是通过加载器 EggLoader 将这些分层的项目业务代码、中间件和插件代码的大部分功能注入到 this、this.app、this.ctx 对象。</div><!-- rebuild by neat --></body></html>","site":{"data":{"next":{"override":false,"cache":{"enable":true},"favicon":{"small":"/images/favicon-16.ico","medium":"/images/favicon-32.ico","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"rss":"/atom.xml","footer":{"since":2019,"icon":{"name":"snowflake-o","animated":false,"color":"#808080"},"copyright":"chuangge","powered":{"enable":false,"version":true},"theme":{"enable":false,"version":true},"beian":{"enable":false,"icp":null}},"creative_commons":{"license":"by-nc-sa","sidebar":false,"post":false},"canonical":true,"seo":false,"index_with_subtitle":false,"exturl":false,"menu":{"home":"/ || home  //首页","tags":"/tags/ || tags  //标签","categories":"/categories/ || th   //分类","archives":"/archives/ || archive //归档"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":{"GitHub":"https://github.com/ || github","StackOverflow":"https://stackoverflow.com/ || stack-overflow"},"social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"友情链接","links_layout":"inline","links":{"个人简历":"https://chuanggefighting.github.io/project/","印记中文":"https://www.docschina.org/","在线工具":"http://tool.lu/","Learn Anything":"https://learn-anything.xyz/"},"avatar":{"url":"/images/chuang.png","rounded":true,"opacity":1,"rotated":true},"toc":{"enable":true,"number":true,"wrap":false,"max_depth":6},"sidebar":{"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"read_more_btn":true,"post_meta":{"item_text":true,"created_at":true,"updated_at":{"enabled":true,"another_day":true},"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":true,"awl":4,"wpm":275},"codeblock":{"border_radius":null,"copy_button":{"enable":false,"show_result":false}},"reward":{"enable":false},"related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_edit":{"enable":false,"url":"https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name"},"disable_baidu_tranformation":false,"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"font":{"enable":true,"host":"//fonts.proxy.ustclug.org","global":{"external":true,"family":"Lato","size":16},"headings":{"external":true,"family":"Roboto Slab","size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":"Lobster Two","size":24},"codes":{"external":true,"family":"Roboto Mono","size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css","copy_tex":{"enable":false,"copy_tex_js":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js","copy_tex_css":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css"}}},"pdf":{"enable":false,"per_page":true,"height":"500px","pdfobject":{"cdn":"//cdn.jsdelivr.net/npm/pdfobject@2.1.1/pdfobject.min.js"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":true,"appid":"snOvapuSplYTVflf5p9Ml9JX-gzGzoHsz","appkey":"5ABGdfyEdAtu6lTXdGdo7hf9","notify":false,"verify":false,"placeholder":"ヾﾉ≧∀≦)o 来呀！吐槽一番吧！","avatar":"mm","guest_info":"nick,mail,link","pageSize":10,"visitor":false,"comment_count":true},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"gitalk":{"enable":false,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true},"needmoreshare2":{"enable":true,"postbottom":{"enable":true,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null,"security":false,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":true,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":true,"pace_theme":"pace-theme-center-simple","canvas_nest":{"enable":true,"onmobile":true,"color":"0,0,255","opacity":0.5,"zIndex":-1,"count":99},"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"canvas_nest_nomobile":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"leancloud":null,"valine":null,"gitalk_js":null,"gitalk_css":null,"md5":null},"css":"css","js":"js","images":"images","passage_end_tag":{"enabled":true},"daovoice":true,"daovoice_app_id":"2ed51855"}}},"excerpt":"","more":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><h1 id=\"一、Express\"><a href=\"#一、Express\" class=\"headerlink\" title=\"一、Express\"></a>一、Express</h1><blockquote><p>基于 ES5 语法实现而只能通过回调实现异步代码，框架本身缺少约束而写法较多，只适合开发小型项目并作为新手入门级框架</p></blockquote><h2 id=\"核心特性\"><a href=\"#核心特性\" class=\"headerlink\" title=\"核心特性\"></a>核心特性</h2><ul><li>设置中间件来响应 HTTP 请求</li><li>定义路由表用于执行不同的 HTTP 请求</li><li>通过向模板传递参数来动态渲染 HTML</li></ul><h2 id=\"基础使用\"><a href=\"#基础使用\" class=\"headerlink\" title=\"基础使用\"></a>基础使用</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> app = express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 设置 views 的文件夹和模板</span></span><br><span class=\"line\">app.set(<span class=\"string\">\"views\"</span>, __dirname + <span class=\"string\">\"/views\"</span>);</span><br><span class=\"line\">app.set(<span class=\"string\">\"view engine\"</span>, <span class=\"string\">\"jade\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 静态资源</span></span><br><span class=\"line\">app.use(express.static(__dirname + <span class=\"string\">'/public'</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 动态渲染</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    res.send(<span class=\"string\">'Hello world'</span>);</span><br><span class=\"line\">&#125;).listen(<span class=\"number\">3000</span>)</span><br></pre></td></tr></table></figure><h2 id=\"搭建应用\"><a href=\"#搭建应用\" class=\"headerlink\" title=\"搭建应用\"></a>搭建应用</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 默认 localhost:3000</span></span><br><span class=\"line\">npm install express express-generator -g </span><br><span class=\"line\"></span><br><span class=\"line\">express -e myApp  <span class=\"comment\">// 使用 ejs 模板</span></span><br><span class=\"line\">cd myApp</span><br><span class=\"line\">npm install</span><br><span class=\"line\"></span><br><span class=\"line\">npm start</span><br></pre></td></tr></table></figure><h2 id=\"中间件\"><a href=\"#中间件\" class=\"headerlink\" title=\"中间件\"></a>中间件</h2><blockquote><p>本质是处理 HTTP 请求的函数。每个中间件都可以接收到请求对象 req、响应对象 res 和回调函数 next 这三个参数，经过处理后可以通过调用 next() 传递给下一个中间件</p></blockquote><h3 id=\"分类\"><a href=\"#分类\" class=\"headerlink\" title=\"分类\"></a>分类</h3><ul><li><strong>应用级中间件</strong>：使用 app.use/method 绑定到 app 对象</li><li><strong>路由级中间件</strong>：使用 router.use/method 绑定到 express.Router() 对象</li><li><strong>错误处理中间件</strong>：接收四个参数，用于处理应用中的错误</li><li><strong>第三方中间件</strong>：安装后 require 到文件中使用，用来扩展功能</li><li><strong>内置中间件</strong>：express.static 托管静态资源、express.json 解析请求</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 应用级</span></span><br><span class=\"line\">app.use(<span class=\"function\">(<span class=\"params\">req,res,next</span>) =&gt;</span> &#123;   </span><br><span class=\"line\">    next()   </span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 路由级</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> router = express.Router()</span><br><span class=\"line\">router.get(<span class=\"string\">'/user/:id'</span>, (req, res, next) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(req.params.id==<span class=\"number\">0</span>) next(<span class=\"string\">'route'</span>)</span><br><span class=\"line\">    <span class=\"keyword\">else</span> next()</span><br><span class=\"line\">&#125;,(req, res, next) =&gt; &#123;</span><br><span class=\"line\">    res.end(<span class=\"string\">\"Hello world\"</span>);</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 错误处理</span></span><br><span class=\"line\">app.use(<span class=\"function\">(<span class=\"params\">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    res.status(<span class=\"number\">500</span>).send(<span class=\"string\">'Something broke'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 内置中间件 </span></span><br><span class=\"line\">app.use(express.static(__dirname + <span class=\"string\">'/public'</span>))</span><br></pre></td></tr></table></figure><h3 id=\"定义方法\"><a href=\"#定义方法\" class=\"headerlink\" title=\"定义方法\"></a>定义方法</h3><ul><li><strong>app.use</strong>：会对客户端请求路径及其所有扩展结果进行匹配</li><li><strong>app.method</strong>：会对客户端请求路径进行精确匹配，但会忽略其中的锚点和 get 提交的参数数据</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 路径默认 '/'，匹配所有路径(都可以看作是 '/' 的扩展)</span></span><br><span class=\"line\">app.use(<span class=\"function\">(<span class=\"params\">req, res, next</span>) =&gt;</span> &#123; &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 路径默认 '/' ，只匹配根路径</span></span><br><span class=\"line\">app.get(<span class=\"function\">(<span class=\"params\">req, res, next</span>) =&gt;</span> &#123; &#125;)</span><br></pre></td></tr></table></figure><h3 id=\"响应方法\"><a href=\"#响应方法\" class=\"headerlink\" title=\"响应方法\"></a>响应方法</h3><ul><li><strong>res.end</strong>：结束响应进程但不返回数据</li><li><strong>res.send</strong>：发送各种类型的响应</li><li><strong>res.json</strong>：发送 JSON 响应</li><li><strong>res.jsonp</strong>：在 JSONP 的支持下发送 JSON 响应</li><li><strong>res.render</strong>：呈现视图模板</li><li><strong>res.redirect</strong>：重定向请求</li><li><strong>res.sendFile</strong>：以八位元流形式发送文件</li><li><strong>res.download</strong>：提示将要下载文件</li><li><strong>res.sendStatus</strong>：设置响应状态码并发送其字符串表示</li></ul><h2 id=\"路由管理\"><a href=\"#路由管理\" class=\"headerlink\" title=\"路由管理\"></a>路由管理</h2><h3 id=\"路径规则\"><a href=\"#路径规则\" class=\"headerlink\" title=\"路径规则\"></a>路径规则</h3><ul><li>url 字符串不区分字母的大小写</li><li>url 传递的数据通过冒号语法提取</li><li>所有 get 方式提交的 url 参数及锚点均会被忽略</li><li>所有路由中间件的书写顺序至关重要，只会执行首次匹配到的中间件</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// localhost:3000/tom/24：tom, 24</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/:name/:age'</span>, (req, res)=&gt;&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(req.params.name, req.params.age)</span><br><span class=\"line\">    res.send()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// localhost:3000/a#?name=tom </span></span><br><span class=\"line\">app.get(<span class=\"string\">'/a'</span>, (req, res)=&gt;&#123;</span><br><span class=\"line\">    res.send(<span class=\"string\">'success'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// localhost:3000/admin/login：只执行第一个</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/:username/:method'</span>, (req, res)=&gt;&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>)</span><br><span class=\"line\">    res.end()  <span class=\"comment\">// 此处如果执行 next() 则会第二个</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">app.get(<span class=\"string\">'/admin/login'</span>, (req, res)=&gt;&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>)</span><br><span class=\"line\">    res.end()</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h3 id=\"路径匹配\"><a href=\"#路径匹配\" class=\"headerlink\" title=\"路径匹配\"></a>路径匹配</h3><h4 id=\"字符串\"><a href=\"#字符串\" class=\"headerlink\" title=\"字符串\"></a>字符串</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 匹配根路径的请求</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    res.send(<span class=\"string\">'root'</span>);</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 /about 路径的请求</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/about'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    res.send(<span class=\"string\">'about'</span>);</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 /random.text 路径的请求</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/random.text'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    res.send(<span class=\"string\">'random.text'</span>);</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h4 id=\"字符串模式\"><a href=\"#字符串模式\" class=\"headerlink\" title=\"字符串模式\"></a>字符串模式</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 匹配 /user、/user/5，去掉 ? 则只匹配 /user/5</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/user/:id?'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    res.send(<span class=\"string\">'/users/:id?'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 acd 和 abcd</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/ab?cd'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    res.send(<span class=\"string\">'ab?cd'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 /abe 和 /abcde</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/ab(cd)?e'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    res.send(<span class=\"string\">'ab(cd)?e'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 abcd、abbcd、abbbcd等</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/ab+cd'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    res.send(<span class=\"string\">'ab+cd'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 abcd、abxcd、abRABDOMcd、ab123cd等</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/ab*cd'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    res.send(<span class=\"string\">'ab*cd'</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h4 id=\"正则表达式\"><a href=\"#正则表达式\" class=\"headerlink\" title=\"正则表达式\"></a>正则表达式</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 匹配任何路径中含有 a 的路径：</span></span><br><span class=\"line\">app.get(<span class=\"regexp\">/a/</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    res.send(<span class=\"string\">'/a/'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 butterfly、dragonfly，不匹配 butterflyman、dragonfly man等</span></span><br><span class=\"line\">app.get(<span class=\"regexp\">/.*fly$/</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    res.send(<span class=\"string\">'/.*fly$/'</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h4 id=\"数组\"><a href=\"#数组\" class=\"headerlink\" title=\"数组\"></a>数组</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 匹配 /abcd、/xyza、/lmnand、/pqr</span></span><br><span class=\"line\">app.use([<span class=\"string\">'/abcd'</span>, <span class=\"string\">'/xyza'</span>, /\\/lmn|\\/pqr/], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">    next()</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h3 id=\"路由句柄\"><a href=\"#路由句柄\" class=\"headerlink\" title=\"路由句柄\"></a>路由句柄</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 一个回调函数</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/example/a'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    res.send(<span class=\"string\">'Hello from A'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"comment\">// 多个回调函数</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/example/b'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">    next()</span><br><span class=\"line\">&#125;, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    res.send(<span class=\"string\">'Hello'</span>)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 回调函数数组</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123; next() &#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123; next() &#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123; res.send(<span class=\"string\">'Hello from C'</span>) &#125;</span><br><span class=\"line\">app.get(<span class=\"string\">'/example/c'</span>, [a, b, c])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 混合使用</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/example/d'</span>, [a, b], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">    next()</span><br><span class=\"line\">&#125;, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    res.send(<span class=\"string\">'Hello from D'</span>);</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h3 id=\"参数解析\"><a href=\"#参数解析\" class=\"headerlink\" title=\"参数解析\"></a>参数解析</h3><ul><li><strong>req.param</strong>：已被弃用</li><li><strong>req.query</strong>：解析 GET 请求中的查询字符串</li><li><strong>req.body</strong>：解析 POST 请求中的数据（需引用body-parser）</li><li><strong>req.params</strong>：解析 GET/POST 请求中的占位符数据（如/:name）</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// user/10</span></span><br><span class=\"line\">app.get(<span class=\"string\">\"user/:id\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    res.send(req.params[<span class=\"string\">\"id\"</span>])</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// user/?id=10</span></span><br><span class=\"line\">app.get(<span class=\"string\">\"/user\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    res.send(req.query[<span class=\"string\">\"id\"</span>])</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 通过 body-parser 模块获取 post 请求数据</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> bodyParser=<span class=\"built_in\">require</span>(<span class=\"string\">'body-parser'</span>)</span><br><span class=\"line\">app.use(bodyParser.urlencoded(&#123; <span class=\"attr\">extended</span>: <span class=\"literal\">true</span> &#125;))</span><br><span class=\"line\">app.post(<span class=\"string\">\"/login\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    res.send(req.body.name, req.body.password)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h3 id=\"特殊路由\"><a href=\"#特殊路由\" class=\"headerlink\" title=\"特殊路由\"></a>特殊路由</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 验证或处理 路径参数</span></span><br><span class=\"line\">router.param(<span class=\"string\">'id'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next, id</span>) </span>&#123;</span><br><span class=\"line\">    req.name = name</span><br><span class=\"line\">    next()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">router.get(<span class=\"string\">'/user/:id'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    res.send(<span class=\"string\">'hello '</span> + req.name)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 链式路由：一个路径处理多种请求</span></span><br><span class=\"line\">app.route(<span class=\"string\">'/book'</span>)</span><br><span class=\"line\">  .get(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">      res.send(<span class=\"string\">'Get a random book'</span>);</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .post(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">      res.send(<span class=\"string\">'Add a book'</span>);</span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure><h3 id=\"next-方法\"><a href=\"#next-方法\" class=\"headerlink\" title=\"next 方法\"></a>next 方法</h3><ul><li><strong>next()</strong>：从下一个处理函数开始往下执行</li><li><strong>next(‘router’)</strong>：直接执行下一个相同路由</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.get(<span class=\"string\">'/'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>)</span><br><span class=\"line\">    next()           </span><br><span class=\"line\">    <span class=\"comment\">// 结果：1234，替换为next('route')则结果：1234</span></span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>)</span><br><span class=\"line\">    next(<span class=\"string\">'route'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>)</span><br><span class=\"line\">    next()</span><br><span class=\"line\">&#125;, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">4</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h1 id=\"二、Koa\"><a href=\"#二、Koa\" class=\"headerlink\" title=\"二、Koa\"></a>二、Koa</h1><blockquote><p>Express 团队打造的进阶框架，基于 ES7 语法使用 Promise 实现异步而极大简化了异步代码。但是开发项目时缺少约束，多人开发时代码合并困难而不适合团队协作开发项目</p></blockquote><h2 id=\"主要特点\"><a href=\"#主要特点\" class=\"headerlink\" title=\"主要特点\"></a>主要特点</h2><ul><li><strong>洋葱中间件模式</strong>：next函数决定是否执行下一个中间件</li><li><strong>Context 对象</strong>：内部封装了 HTTP 请求对象和响应对象</li><li><strong>异步处理</strong>：使用 Promise 并配合 async await 实现异步</li></ul><h2 id=\"基础使用-1\"><a href=\"#基础使用-1\" class=\"headerlink\" title=\"基础使用\"></a>基础使用</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// npm install koa koa-route</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> Koa = <span class=\"built_in\">require</span>(<span class=\"string\">'koa'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Koa()</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> route = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-route'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 静态资源服务器：npm install koa-static</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> serve = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-static'</span>)</span><br><span class=\"line\">app.use(serve(path.join(__dirname, <span class=\"string\">'/public'</span>)))</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 动态渲染页面：npm install koa-views ejs</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> views = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-views'</span>);</span><br><span class=\"line\">app.use(views(__dirname,&#123;</span><br><span class=\"line\">    extension:<span class=\"string\">'ejs'</span> <span class=\"comment\">//指定用ejs模板</span></span><br><span class=\"line\">&#125;))</span><br><span class=\"line\">app.use(<span class=\"keyword\">async</span> (ctx, next)=&gt;&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 渲染 index.ejs</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> ctx.render(<span class=\"string\">'index'</span>, &#123;<span class=\"attr\">name</span>:<span class=\"string\">'cgp'</span>, <span class=\"attr\">age</span>:<span class=\"number\">9</span>&#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">3000</span>)</span><br></pre></td></tr></table></figure><h2 id=\"搭建应用-1\"><a href=\"#搭建应用-1\" class=\"headerlink\" title=\"搭建应用\"></a>搭建应用</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 默认 localhost:3000</span></span><br><span class=\"line\">npm install koa koa-generator -g </span><br><span class=\"line\"></span><br><span class=\"line\">koa2 project </span><br><span class=\"line\">cd project</span><br><span class=\"line\">npm install</span><br><span class=\"line\"></span><br><span class=\"line\">npm start</span><br></pre></td></tr></table></figure><h2 id=\"路由管理-1\"><a href=\"#路由管理-1\" class=\"headerlink\" title=\"路由管理\"></a>路由管理</h2><h3 id=\"原生路由\"><a href=\"#原生路由\" class=\"headerlink\" title=\"原生路由\"></a>原生路由</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 通过 ctx.request.path 获取用户请求的路径</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"params\">ctx</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ctx.request.path == <span class=\"string\">'/'</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// ctx.response.body的简写 </span></span><br><span class=\"line\">        ctx.body = <span class=\"string\">'&lt;p&gt;Hello World&lt;/p&gt;'</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h3 id=\"路由中间件\"><a href=\"#路由中间件\" class=\"headerlink\" title=\"路由中间件\"></a>路由中间件</h3><blockquote><p>安装：npm install koa koa-router</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Koa = <span class=\"built_in\">require</span>(<span class=\"string\">'koa'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"keyword\">new</span> Koa();</span><br><span class=\"line\"><span class=\"keyword\">var</span> router = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-router'</span>)();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 基础用法：常用 get、post、all</span></span><br><span class=\"line\">router.get(<span class=\"string\">'/'</span>, <span class=\"keyword\">async</span> (ctx, next)=&gt;&#123;</span><br><span class=\"line\">    ctx.body = <span class=\"string\">'hello people'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">await</span> next()</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">router.get(<span class=\"string\">'/list'</span>, <span class=\"keyword\">async</span> (ctx, next)=&gt;&#123;</span><br><span class=\"line\">    ctx.body = <span class=\"string\">'list'</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 传递参数</span></span><br><span class=\"line\">router.get(<span class=\"string\">'/home'</span>, (ctx,next)=&gt;&#123; </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'/home?id=1 传递参数：'</span>, ctx.query);</span><br><span class=\"line\">    next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">router.get(<span class=\"string\">'/user/:name'</span>, (ctx, next) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'/user/tom 传递参数：'</span>, ctx.params.name);</span><br><span class=\"line\">    next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">router.post(<span class=\"string\">'/user/register'</span>,<span class=\"keyword\">async</span>(ctx, next)=&gt;&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(ctx.request.body)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 重定向</span></span><br><span class=\"line\">router.get(<span class=\"string\">'/login'</span>, <span class=\"keyword\">async</span> (ctx, next) =&gt; &#123;</span><br><span class=\"line\">    ctx.redirect(<span class=\"string\">'/user'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 嵌套路由</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> home = <span class=\"keyword\">new</span> Router();</span><br><span class=\"line\">home.get(<span class=\"string\">'/list'</span>, <span class=\"keyword\">async</span>(ctx)=&gt;&#123;</span><br><span class=\"line\">    ctx.body = <span class=\"string\">\"Home list\"</span>;</span><br><span class=\"line\">&#125;).get(<span class=\"string\">'/todo'</span>, <span class=\"keyword\">async</span>(ctx)=&gt;&#123;</span><br><span class=\"line\">    ctx.body =<span class=\"string\">'Home ToDo'</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"keyword\">let</span> user = <span class=\"keyword\">new</span> Router();</span><br><span class=\"line\">user.get(<span class=\"string\">'/list'</span>, <span class=\"keyword\">async</span>(ctx)=&gt;&#123;</span><br><span class=\"line\">    ctx.body = <span class=\"string\">\"User list\"</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 装载所有子路由</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> router = <span class=\"keyword\">new</span> Router();</span><br><span class=\"line\">router.use(<span class=\"string\">'/home'</span>, home.routes(), home.allowedMethods());</span><br><span class=\"line\">router.use(<span class=\"string\">'/user'</span>, user.routes(), user.allowedMethods());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 加载路由：当请求数据的方法与设置的方法不一致时会报错</span></span><br><span class=\"line\">app.use(router.routes()).use(router.allowedMethods());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 监听服务</span></span><br><span class=\"line\">app.listen(<span class=\"number\">3000</span>);</span><br></pre></td></tr></table></figure><h2 id=\"中间件-1\"><a href=\"#中间件-1\" class=\"headerlink\" title=\"中间件\"></a>中间件</h2><div style=\"text-indent:2em\">每个中间件默认接受 <code>Context 对象、next 函数</code> 两个参数。`Context 对象内部封装了原生 NodeJS 包含的 request、response 对象，分别为 ctx.req、ctx.res。next函数被调用时，会暂停该中间件的运行并将控制传递给下一个中间件。</div><h3 id=\"分类-1\"><a href=\"#分类-1\" class=\"headerlink\" title=\"分类\"></a>分类</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 第三方中间件：引入koa-router并对其实例化</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> router = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-router'</span>)()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 错误处理中间件</span></span><br><span class=\"line\">app.use(<span class=\"keyword\">async</span> (ctx, next) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">await</span> next()</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        ctx.response.body = &#123;</span><br><span class=\"line\">        code: <span class=\"string\">'404'</span>,</span><br><span class=\"line\">        message: <span class=\"string\">'服务器异常'</span>,</span><br><span class=\"line\">        desc: error.message</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 应用级中间件</span></span><br><span class=\"line\">app.use(<span class=\"keyword\">async</span> (ctx, next) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">await</span> next();</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(ctx.status === <span class=\"number\">404</span>)&#123;</span><br><span class=\"line\">        ctx.body = <span class=\"string\">\"404页面\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 路由级中间件</span></span><br><span class=\"line\">router.get(<span class=\"string\">'/'</span>, <span class=\"keyword\">async</span> ctx =&gt; &#123;</span><br><span class=\"line\">    ctx.body = <span class=\"string\">'hello koa'</span>;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 启动路由</span></span><br><span class=\"line\">app.use(router.routes()).use(router.allowedMethods())</span><br></pre></td></tr></table></figure><h3 id=\"执行顺序\"><a href=\"#执行顺序\" class=\"headerlink\" title=\"执行顺序\"></a>执行顺序</h3><ul><li>多个中间件会形成堆栈结构，按先进后出顺序执行。</li><li>任何路由都会先经过应用级中间件，当执行完成next后再去匹配相应路由</li><li>路由在匹配成功并执行完相应操作后还会再次进入应用级中间件执行 next 之后的逻辑</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.use(<span class=\"keyword\">async</span> (ctx, next) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'1'</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> next();</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'7'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(<span class=\"keyword\">async</span> (ctx, next) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'2'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">await</span> next();</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'4'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">router.get(<span class=\"string\">'/user'</span>, <span class=\"keyword\">async</span> (ctx, next) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'3'</span>)</span><br><span class=\"line\">    ctx.body = <span class=\"string\">'Hello Koa'</span>;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h3 id=\"第三方中间件\"><a href=\"#第三方中间件\" class=\"headerlink\" title=\"第三方中间件\"></a>第三方中间件</h3><ul><li><strong>kao-views</strong>：模板渲染</li><li><strong>koa-router</strong>：路由处理</li><li><strong>koa-static</strong>：静态文件读取</li><li><strong>koa-bodyparse</strong>：处理post请求的数据</li></ul><h2 id=\"常用功能\"><a href=\"#常用功能\" class=\"headerlink\" title=\"常用功能\"></a>常用功能</h2><h3 id=\"Cookies\"><a href=\"#Cookies\" class=\"headerlink\" title=\"Cookies\"></a>Cookies</h3><blockquote><p>框架自带属性，不需要引入中间件</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 设置中文时报错解决</span></span><br><span class=\"line\">app.use(<span class=\"keyword\">async</span> (ctx, next) =&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 使用new Buffer().toString('base64')转换</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.cookies.set(<span class=\"string\">'test'</span>, <span class=\"keyword\">new</span> Buffer(<span class=\"string\">'你好'</span>).toString(<span class=\"string\">'base64'</span>))</span><br><span class=\"line\">    <span class=\"keyword\">const</span> test = <span class=\"keyword\">new</span> Buffer(ctx.cookies.get(<span class=\"string\">'test'</span>), <span class=\"string\">'base64'</span>).toString()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 使用encodeURIComponent()转换</span></span><br><span class=\"line\">    ctx.cookies.set(<span class=\"string\">'name'</span>, <span class=\"built_in\">encodeURIComponent</span>(<span class=\"string\">'李'</span>))</span><br><span class=\"line\">    <span class=\"keyword\">const</span> name = <span class=\"built_in\">decodeURIComponent</span>(ctx.cookies.get(<span class=\"string\">'name'</span>))</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h3 id=\"表单处理\"><a href=\"#表单处理\" class=\"headerlink\" title=\"表单处理\"></a>表单处理</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-router'</span>)();</span><br><span class=\"line\"><span class=\"keyword\">const</span> bodyParser = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-bodyparse'</span>);</span><br><span class=\"line\">app.use(bodyParser()); </span><br><span class=\"line\"></span><br><span class=\"line\">router.post(<span class=\"string\">'/add'</span>, <span class=\"keyword\">async</span> (ctx)=&gt;&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 获取表单提交的数据</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> body = ctx.request.body</span><br><span class=\"line\">    ctx.body = &#123; <span class=\"attr\">name</span>: body.name &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h3 id=\"上传文件\"><a href=\"#上传文件\" class=\"headerlink\" title=\"上传文件\"></a>上传文件</h3><div align=\"center\"><br><img src=\"images/nodejs/node-uploadFile.png\" alt=\"Node UploadFile\"><br></div><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 引入：npm install koa-body --save</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> koaBody = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-body'</span>);</span><br><span class=\"line\">app.use(koaBody(&#123;</span><br><span class=\"line\">    multipart: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    formidable: &#123;</span><br><span class=\"line\">        maxFileSize: <span class=\"number\">200</span>*<span class=\"number\">1024</span>*<span class=\"number\">1024</span>  <span class=\"comment\">// 设置文件最大限制，默认 2M</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;));</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 上传图片</span></span><br><span class=\"line\">router.post(<span class=\"string\">'/file_upload'</span>, <span class=\"keyword\">async</span> (ctx) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 获取上传图片</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> data = ctx.request.body.files.data;</span><br><span class=\"line\">    <span class=\"comment\">// 创建可读流</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> savePath = path.join(<span class=\"string\">`./files`</span>, data.name)</span><br><span class=\"line\">    <span class=\"keyword\">const</span> reader = fs.createReadStream(data.path)</span><br><span class=\"line\">    <span class=\"comment\">// 创建可写流</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> writer = fs.createWriteStream(savePath)</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">const</span> pro = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>( <span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 可读流通过管道写入可写流</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> stream = reader.pipe(writer);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 图片上传成功后返回服务器地址，实时显示服务器图片</span></span><br><span class=\"line\">        stream.on(<span class=\"string\">'finish'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            resolve(<span class=\"string\">`http://当前服务器地址<span class=\"subst\">$&#123;data.name&#125;</span>`</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    ctx.response.body =  <span class=\"keyword\">await</span> pro</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 上传单个文件</span></span><br><span class=\"line\">router.post(<span class=\"string\">'/uploadfile'</span>, <span class=\"keyword\">async</span> (ctx, next) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 获取上传文件</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> file = ctx.request.files.file; </span><br><span class=\"line\">    <span class=\"comment\">// 创建可读流</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> reader = fs.createReadStream(file.path);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> filePath = path.join(__dirname, <span class=\"string\">'public/upload/'</span>) + <span class=\"string\">`/<span class=\"subst\">$&#123;file.name&#125;</span>`</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 创建可写流</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> upStream = fs.createWriteStream(filePath);</span><br><span class=\"line\">    <span class=\"comment\">// 可读流通过管道写入可写流</span></span><br><span class=\"line\">    reader.pipe(upStream);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ctx.body = <span class=\"string\">\"上传成功！\"</span>;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 上传多个文件</span></span><br><span class=\"line\">router.post(<span class=\"string\">'/uploadfiles'</span>, <span class=\"keyword\">async</span> (ctx, next) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 获取上传文件，旧版本通过 ctx.request.body.files</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> files = ctx.request.files.file; </span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> file <span class=\"keyword\">of</span> files) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 创建可读流</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> reader = fs.createReadStream(file.path);</span><br><span class=\"line\">      <span class=\"comment\">// 获取上传文件扩展名</span></span><br><span class=\"line\">      <span class=\"keyword\">let</span> filePath = path.join(__dirname, <span class=\"string\">'public/upload/'</span>) + <span class=\"string\">`/<span class=\"subst\">$&#123;file.name&#125;</span>`</span>;</span><br><span class=\"line\">      <span class=\"comment\">// 创建可写流</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> upStream = fs.createWriteStream(filePath);</span><br><span class=\"line\">      <span class=\"comment\">// 可读流通过管道写入可写流</span></span><br><span class=\"line\">      reader.pipe(upStream);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ctx.body = <span class=\"string\">\"上传成功！\"</span>;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h3 id=\"合并中间件\"><a href=\"#合并中间件\" class=\"headerlink\" title=\"合并中间件\"></a>合并中间件</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// koa-compose：将多个中间件合成为一个</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> compose = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-compose'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> first = asycn (ctx, next) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">await</span> next()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> second = <span class=\"keyword\">async</span> ctx =&gt; &#123;</span><br><span class=\"line\">    ctx.body = <span class=\"string\">'Hello'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> middle = compose([first, second])</span><br><span class=\"line\">app.use(middle)</span><br></pre></td></tr></table></figure><h1 id=\"三、Egg\"><a href=\"#三、Egg\" class=\"headerlink\" title=\"三、Egg\"></a>三、Egg</h1><blockquote><p>基于 koa2 的企业级框架，是由阿里 NodeJS 团队封装的企业级 Web 应用解决方案</p></blockquote><div style=\"text-indent:2em\">官方定位是 为企业级框架和应用而生和孕育出更多上层框架，奉行 <code>约定优于配置</code>，帮助开发团队和开发人员降低开发和维护成本。async 的特性避免了回调地狱，洋葱式的中间件架构更容易后置逻辑，内置的多进程管理会更好的利用服务器性能，以及更方便的单元测试和更加约束的目录架构。</div><h2 id=\"框架体系\"><a href=\"#框架体系\" class=\"headerlink\" title=\"框架体系\"></a>框架体系</h2><ul><li>核心体系：egg-core 模块<ul><li>以 Koa.js 为基类，利用它的 中间件机制 和 HTTP服务机制 作为框架基础</li><li>以 Loader 机制作为 Egg.js 各分层机制的约定基础</li></ul></li><li>辅助体系：egg-script、egg-bin 等模块<ul><li>支持 开发模式、生产模式、多线程模式</li></ul></li><li>生态体系：中间件、插件、框架</li></ul><h2 id=\"主要特点-1\"><a href=\"#主要特点-1\" class=\"headerlink\" title=\"主要特点\"></a>主要特点</h2><ul><li>渐进式开发</li><li>内置多进程管理</li><li>高度可扩展的插件机制</li><li>框架稳定，测试覆盖率高</li><li>基于 Koa 开发，性能优异</li><li>提供基于 Egg 定制上层框架的能力</li></ul><h2 id=\"搭建应用-2\"><a href=\"#搭建应用-2\" class=\"headerlink\" title=\"搭建应用\"></a>搭建应用</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i egg-init -g</span><br><span class=\"line\">egg-init test --type=simple  </span><br><span class=\"line\"></span><br><span class=\"line\">cd test</span><br><span class=\"line\">npm install</span><br><span class=\"line\"></span><br><span class=\"line\">npm run dev</span><br></pre></td></tr></table></figure><h2 id=\"项目运行\"><a href=\"#项目运行\" class=\"headerlink\" title=\"项目运行\"></a>项目运行</h2><ul><li>绿色虚线框中的所有组件组成了一个实际执行代码逻辑的进程</li><li>request 进来后先穿过中间件，自定义中间件放在 app/middleware 并在 config 中启用</li><li>静态资源（project/app/public）经过内置的 egg-static 中间件时会直接响应给客户端，其它资源则会穿越所有中间件并到达路由文件 router.js</li><li>路由文件一般没有任何逻辑而只起到目录和索引的作用，它会直接指向一个处理请求的 controller（app/controller）</li><li>Controller 负责调用并组合 Service（app/service），最后将响应提交给客户端。Service 负责调用 Model 处理具体的业务逻辑</li><li><p>除此之外，Worker 中还有定时任务（app/schedule）</p><div align=\"center\"><br><img src=\"images/nodejs/egg-run.png\" alt=\"Egg Run\"><br></div></li></ul><h2 id=\"原理分析\"><a href=\"#原理分析\" class=\"headerlink\" title=\"原理分析\"></a>原理分析</h2><blockquote><p>要分析框架的实现原理，直接从所有源码开始分析比较难。但是可以先将其精简到最小功能系统，然后针对各个功能进行分析和叠加</p></blockquote><h3 id=\"模块架构\"><a href=\"#模块架构\" class=\"headerlink\" title=\"模块架构\"></a>模块架构</h3><div align=\"center\"><br><img src=\"images/nodejs/egg-framework.png\" alt=\"Egg Framework\"><br></div><h3 id=\"最简目录\"><a href=\"#最简目录\" class=\"headerlink\" title=\"最简目录\"></a>最简目录</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">├── index.js          <span class=\"comment\">// 启动文件：初始化 应用实例 和 HTTP 服务器</span></span><br><span class=\"line\">├── app               <span class=\"comment\">// 业务模块：路由文件</span></span><br><span class=\"line\">│     └── router.js   </span><br><span class=\"line\">├── lib               <span class=\"comment\">// 应用模块：提供加载器和底层的中间件、插件、路由等机制</span></span><br><span class=\"line\">|     ├── egg-core </span><br><span class=\"line\">│     └── egg.js                    </span><br><span class=\"line\">└── package.json</span><br></pre></td></tr></table></figure><h3 id=\"执行流程\"><a href=\"#执行流程\" class=\"headerlink\" title=\"执行流程\"></a>执行流程</h3><ol><li>应用初始化<ul><li>加载所有 loader</li><li>加载所有中间件、插件等内容</li><li>路由注册</li></ul></li><li>服务启动<ul><li>提供 http 服务</li><li>执行路由处理</li></ul></li></ol><h3 id=\"代码逻辑\"><a href=\"#代码逻辑\" class=\"headerlink\" title=\"代码逻辑\"></a>代码逻辑</h3><ol><li><p>EggApplication</p><ul><li>继承：EggCore</li><li>构建：按照顺序加载所有中间件、插件、路由等内容，this.loader.loadAll()</li></ul></li><li><p>EggCore</p><ul><li>继承：Koa</li><li>功能<ul><li>服务器的底层逻辑</li><li>工程项目文件的加载器</li><li>提供底层的中间件、插件、路由等机制</li></ul></li><li>构建<ul><li>AppWorkerLoader<ul><li>继承：EggLoader</li><li>加载器初始化：this.loader = new EggLoader()</li></ul></li><li>Router<ul><li>继承：Koa-router</li><li>路由初始化：this.router = new Router()</li><li>路由方法注入：将路由方法注册到对象属性</li></ul></li></ul></li></ul></li><li>EggLoader<ul><li>构建：注入各种加载器方法</li></ul></li></ol><h3 id=\"路由优化\"><a href=\"#路由优化\" class=\"headerlink\" title=\"路由优化\"></a>路由优化</h3><ul><li>路由大小写敏感</li><li>RESTFul 实现</li><li>Controller 句柄使用</li><li>Generator Function 兼容</li></ul><h3 id=\"RESTFul\"><a href=\"#RESTFul\" class=\"headerlink\" title=\"RESTFul\"></a>RESTFul</h3><blockquote><p>测试时需要先安装接口测试工具：chrome postman，然后在 chrome 地址栏使用</p></blockquote><ul><li>约定路由路径和对应的控制器</li><li>统一处理封装 router 参数</li><li>统一封装 controller：根据请求类型和路径注册对应的控制器<ul><li>Async Function</li><li>Generator Function</li><li>controller 句柄读取 this.app.controller</li></ul></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 路由文件添加</span></span><br><span class=\"line\">router.resources(<span class=\"string\">'users'</span>, <span class=\"string\">'/v1/users'</span>, <span class=\"string\">'users'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 新建文件 app/controller/users.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; Controller &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">'egg'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UsersController</span> <span class=\"keyword\">extends</span> <span class=\"title\">Controller</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">async</span> create() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; ctx &#125; = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.ctx.body = <span class=\"string\">'创建'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">async</span> destroy() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; ctx &#125; = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.ctx.body = <span class=\"string\">'删除'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">async</span> update() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; ctx &#125; = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.ctx.body = <span class=\"string\">'修改'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">async</span> show() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; ctx &#125; = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.ctx.body = <span class=\"string\">'查询'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">async</span> index() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; ctx &#125; = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.ctx.body = <span class=\"string\">'列表'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"keyword\">new</span>() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; ctx &#125; = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.ctx.body = <span class=\"string\">'创建页面'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">async</span> edit() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; ctx &#125; = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.ctx.body = <span class=\"string\">'修改页面'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = UsersController;</span><br></pre></td></tr></table></figure><h3 id=\"加载器\"><a href=\"#加载器\" class=\"headerlink\" title=\"加载器\"></a>加载器</h3><div style=\"text-indent:2em\">实际项目中的业务代码除了路由文件，还有 controller、service 等其他分层的源码文件。Egg.js 是通过加载器 EggLoader 将这些分层的项目业务代码、中间件和插件代码的大部分功能注入到 this、this.app、this.ctx 对象。</div><!-- rebuild by neat -->"},{"title":"HTML5 新特性","top":false,"keywords":["html5","移动端"],"date":"2019-04-18T14:50:40.000Z","description":"audio、Canvas、WebSocket、Web Worker、拖放、定位、全屏、存储","_content":"\n\n# 一、audio、video  \n> 支持的格式：Ogg、MP3、WAV\n\n## 基础使用\n  <div align=\"center\"> \n    ![media](images/mobile/media.png)\n  </div> \n       \n  ```js\n  // var audio = new Audio(\"test.mp3\");\n  var audio = document.getElementById(\"audio\");\n\n  // 资源属性\n  audio.load()         // 重新加载\n  audio.currentSrc     // 当前资源地址\n  audio.src = value      // 设置当前资源地址\n  audio.canPlayType(type)  // 是否能播放某种格式的资源\n\n  // 播放状态属性\n  audio.currentTime = value  // 当前播放的位置\n  audio.startTime/duration/loop/autoPlay\n  audio.played/paused/ended/\n  \n  // 状态控制\n  audio.play();          // 播放\n  audio.pause();         // 暂停\n  audio.controls;        // 默认控制条\n  audio.volume = value;  // 音量\n  audio.muted = value;   // 静音\n\n  // 事件：loadstart、progress、\n  \n  \n  // 监听开始播放\n  audio.addEventListener('pause', function (e) {\n      console.log('开始播放')\n  })\n  // 监听暂停播放\n  audio.addEventListener('pause', function (e) {\n      console.log('暂停播放')\n  })\n  // 监听媒体数据已经加载完成，\n  audio.addEventListener('loadedmetadata', function (e) {\n      console.log('音频时长：'+ e.target.duration)\n  });\n  // 监听时间改变，durationchange 资源长度，volumechange 音量\n  audio.addEventListener('timeupdate', function (e) {\n      let t = e.target\n      console.log('剩余时长：'(t.duration - t.currentTime))\n  }, false);  \n  // 监听播放完成\n  audio.addEventListener('ended', function (e) {\n      console.log('播放完成')\n  }, false);   \n\n\n  var video = document.getElementById('video');\n  // 事件：play、pause、progress、error\n  video.addEventListener('play',function(){ });\n  ```\n\n\n\n## 自动播放\n> ios、Android、微信为了节省流量而规定忽视 autoplay 属性\n\n  ```js\n// ios、Android：循环播放失效时方案相似，\ndocument.addEventListener('touchstart', function () {\n\n    document.getElementById('audio').play();\n})\n\n\n// 微信\ndocument.addEventListener('WeixinJSBridgeReady', function() {\n    document.getElementById('audios').play()\n})\n// 针对苹果的手机微信端\nfunction autoPlayVideo(){\n    wx.config({\n        debug:false,\n        appId:\"\",\n        timestamp:1,\n        nonceStr:\"\",\n        signature:\"\",\n        jsApiList:[]\n    });\n    wx.ready(function(){\n        var autoplayVideo = document.getElementById(\"audio\");\n        autoplayVideo.play()\n    })\n}\n\n\n## 用户权限\n> navigator.getUserMedia 可以提示用户需要权限去使用像摄像头、麦克风等媒体设备\n\n// 兼容写法\nnavigator.getMedia = (navigator.getUserMedia ||\n    navigator.webkitGetUserMedia ||\n    navigator.mozGetUserMedia ||\n    navigator.msGetUserMedia);\n\n// 获取用户摄像头并提供拍照功能：video、canvas、button\nwindow.addEventListener(\"DOMContentLoaded\", function() {\n    // 获取元素，创建设置等等\n    var canvas = document.getElementById(\"canvas\"),\n            context = canvas.getContext(\"2d\"),\n            video = document.getElementById(\"video\"),\n            videoObj = { \"video\": true },\n            errBack = function(error) {\n                console.log(\"Video capture error: \", error.code);\n            };\n\n    // 添加video 监听器\n    if(navigator.getUserMedia) { // 标准\n        navigator.getUserMedia(videoObj, function(stream) {\n            video.src = stream;\n            video.play();\n        }, errBack);\n    } else if(navigator.webkitGetUserMedia) { // WebKit 前缀\n        navigator.webkitGetUserMedia(videoObj, function(stream){\n            video.src = window.webkitURL.createObjectURL(stream);\n            video.play();\n        }, errBack);\n    }\n    else if(navigator.mozGetUserMedia) {    // Firefox 前缀\n        navigator.mozGetUserMedia(videoObj, function(stream){\n            video.src = window.URL.createObjectURL(stream);\n            video.play();\n        }, errBack);\n    }\n\n    document.getElementById(\"snap\").addEventListener(\"click\", function() {\n        context.drawImage(video, 0, 0, 640, 480);\n    });\n\n  }, false)\n  ```\n\n\n# 二、Canvas\n> 提供了一系列绘图方法的对象\n\n## 绘制图形\n  ```js\n  let canvas = document.getElementById(\"canvas\"); \n  if(canvas.getContext){\n    let ctx = canvas.getContext(\"2d\"); \n  }\n  \n  // 线段 \n  ctx.moveTo(100, 20); \n  ctx.lineTo(200, 40);\n  ctx.lineWidth = 5; \n  ctx.strokeStyle = '#CC0000'; \n  ctx.stroke();    // 绘制\n\n  ctx.beginPath();\n  ctx.strokeStyle = \"#ff0000\";\n  ctx.lineTo(20, 20);\n  ctx.lineTo(20, 70);\n  ctx.lineTo(70, 70);\n  ctx.closePath();\n  ctx.stroke();\n\n\n  // 路径：填充\n  ctx.beginPath();\n  ctx.arc(240, 20, 50, 0, Math.PI/2 , false);\n  ctx.closePath();\n  ctx.fillStyle = '#0000ff';\n  ctx.fill();\n\n  // 路径：填充 + 边框\n  ctx.beginPath();\n  ctx.arc(300, 20, 50, 0, Math.PI/2 , false);\n  ctx.strokeStyle = '#0000ff';\n  ctx.closePath();\n  ctx.stroke();\n  ctx.fillStyle = 'rgba(0,0,255,0.2)';\n  ctx.fill();\n\n\n  // 贝塞尔曲线\n  ctx.moveTo(300, 300);\n  ctx.lineWidth = 10;\n  ctx.strokeStyle = \"skyblue\";\n  ctx.bezierCurveTo(300, 50, 500, 50, 150, 150);\n  ctx.stroke();\n        \n\n  // 蓝色填充矩形\n  ctx.fillStyle = \"#0000ff\";\n  ctx.fillRect(20, 100, 60, 60);    \n\n  // 红色边框矩形\n  ctx.lineWidth = 10; \n  ctx.strokeRect(100, 100, 60, 60);  \n  \n\n  // 圆\n  ctx.fillStyle = \"#0000ff\";\n  ctx.strokeStyle = \"#ff0000\";\n  ctx.beginPath();\n  ctx.arc(50, 240, 40, 0, 2*Math.PI, true);\n  ctx.closePath();\n  ctx.stroke();\n  ctx.fill();\n\n  ctx.fillStyle = \"pink\";\n  ctx.beginPath();\n  ctx.arc(50, 240, 20, 0, 2*Math.PI, true);\n  ctx.closePath();\n  ctx.fill();\n\n\n  // 文本\n  ctx.font = \"Bold 20px Arial\"; \n  ctx.textAlign = \"left\";\n  ctx.fillStyle = \"#008600\"; \n  ctx.fillText(\"Hello!\", 10, 50); \n  ctx.strokeText(\"Hello!\", 10, 100); \n\n\n  // 渐变色\n  var grd = ctx.createLinearGradient(0, 0, 300, 200);\n  grd.addColorStop(0,\"#ff0000\");\n  grd.addColorStop(1,\"#0000ff\");\n  ctx.fillStyle = grd;\n  ctx.fillRect(0, 0, 300,200);\n\n\n  // 阴影\n  ctx.shadowOffsetX = 10; \n  ctx.shadowOffsetY = 10; \n  ctx.shadowBlur = 5; \n  ctx.shadowColor = \"rgba(0,0,0,0.5)\"; \n  ctx.fillStyle = \"#CC0000\"; \n  ctx.fillRect(10, 10, 200, 100);\n  ```\n\n\n## 绘制图像\n  ```js\n  // canvas id=\"canvas\" width=\"400\" height=\"400\"\n  let canvas = document.getElementById(\"canvas\");\n  let ctx = canvas.getContext(\"2d\");\n  let image = new Image();\n  image.onload = function() {\n      \n      // 图片绘制\n      // ctx.drawImage(image, 0, 0)\n\n      // 图片裁剪\n      ctx.beginPath(); \n      ctx.arc(100, 100, 100, 0, Math.PI*2, true); \n      ctx.clip();          \n      ctx.drawImage(image, 0, 0);\n  }\n  image.src = './mobile-type.png';\n\n  // 获取图片保存地址\n  let src = canvas.toDataURL('image/png')\n  ```\n\n   \n## 动画效果\n  ```js\n  var x = 0;\n  var y = 15;\n  var speed = 5;\n  function animation() {\n      window.requestAnimationFrame(animate);\n      x += speed;\n      if(x &lt;= 0 || x &gt;= 475){\n          speed = -speed;\n      }\n      draw()\n  }\n  function draw() {\n      var canvas = document.getElementById(\"canvas\");\n      var context = canvas.getContext(\"2d\");\n      context.clearRect(0, 0, 500, 170);\n      context.fillStyle = \"#ff00ff\";\n      context.fillRect(x, y, 25, 25);\n  }\n  animation()\n  ```\n\n\n## 像素处理\n\n  ```js\n  // 获取图像数据\n  let imgData = ctx.getImageData(0, 0, canvas.width, canvas.height)\n      \n  // 处理图像数据\n  filter(imageData);\n\n  // 重新绘制图像\n  ctx.putImageData(imageData, 0, 0)\n  ```\n\n\n# 三、WebSocket\n  ```js\n  // 创建实例\n  var socket = new WebSocket('ws://localhost:8080');\n\n  // 打开 socket\n  socket.onopen = function(event) {\n\n      // 发送消息\n      socket.send('hello HTML5')\n\n      // 监听消息\n      socket.onmessage = function(event) {\n          console.log('receive a message', event)\n      };\n\n      // 监听关闭\n      socket.onclose = function(ev) {\n          console.log('socket has closed', event)\n      };\n\n      // 关闭 socket\n      socket.close()\n  }\n  ```\n\n\n# 四、Web Worker\n\n## 机制\n  * 在当前 js 的主线程中，通过 Worker 类加载一个 js 文件来开辟一个新的线程\n  * 新线程可以加载 JS 进行大量的复杂运算，同时主线程不需要挂起等待而是执行其它代码\n  * 新线程创建时，它的脚本文件生成的两个对象和一套 API 可以实现主线程和子线程的数据通信\n    * __worker 对象__：主线程脚本中通过构造函数显式创建，通过实例方法获取\n    * __WorkerGlobalScope 对象__：子线程脚本中隐式创建的全局对象，通过 this 获取\n    * __API 接口__：主线程和子线程脚本间进行数据传输的接口，主要为 postMessage、onmessage\n      \n\n## Web 主线程\n  1. 创建新线程：`var worker = new Worker(url)`\n  2. 发送数据：`worker.postMessage(data)`\n  3. 接收数据：`worker.onmessage = fn`\n  4. 结束新线程：`worker.terminate()`\n\n  ```js\n  // 判断当前浏览器是否支持 web worker\n  if (typeof (Worker) != \"undefined\") {\n      if (typeof (w) == \"undefined\") {       \n          w = new Worker(\"webworker.js\"); \n      }  \n      // 事件处理函数，用来处理后端的 web worker 传递的消息  \n      w.onmessage = function (event) { \n          // do something\n      };\n  } else { \n      \n  }\n\n  // 加载一个 JS 文件来创建一个 worker，同时返回一个 worker 实例\n  var worker = new Worker(\"worker.js\")\n\n  // 向 worker 发送数据\n  worker.postMessage()\n\n  // 接收 worker 发送的数据\n  worker.onmessage = function(event){ }\n\n  // 异常处理\n  worker.onerror = function(err){\n    // 错误所在的代码文件和行数、错误信息\n    alert(\"Line #\" + err.lineno + \" - \" + err.message + \" in \" + err.filename);\n  }\n\n  // 结束 worker\n  worker.terminate()  \n  ```\n      \n\n## worker 新线程\n> 全局变量 this 省略\n\n  1. 发送数据：`postMessage(data)`\n  2. 接收数据：`onmessage = fn`\n  3. 加载脚本：`importScripts('a.js', 'b.js')`\n  4. 结束自身：`self.close()`    \n\n\n## 应用场景\n\n  * 用来进行处理大量的复杂计算而不挂起主线程\n  * 可以在 worker 中通过 `importScripts(url) `加载其它脚本文件\n  * 可以使用 `setTimeout()、clearTimeout()、setInterval()、clearInterval()`\n  * 可以使用 `XMLHttpRequest` 来发送请求\n  * 可以访问 `navigator、location` 对象\n\n\n## 操作限制\n> Worker 线程脚本\n\n  * __脚本限制__：无法调用 alert、confirm 等函数\n  * __同源限制__：不能跨域加载脚本文件，它必须与主线程的脚本文件同源\n  * __通信限制__：Worker 线程和主线程不在同一个上下文环境，它们不能直接通信\n  * __文件限制__：无法读取本地文件，所加载的脚本必须 来自网络或通过服务器打开\n  * __DOM 限制__\n    * 无法访问 DOM 节点\n    * 无法访问 window、document 等全局变量\n\n\n## 分类\n  * __专用线程__\n    * 特点：只能被创建它的页面访问，随当前页面的关闭而结束\n    * 通信：通过 onmessage()、postmessage()\n  * __共享线程__\n    * 特点：可以被多个页面访问\n    * 通信：connect 后通过 port 属性\n\n  ```js\n  // ---------- 专用线程 -----------\n  // 主线程 index.html/script\n  var worker = new Worker(\"worker.js\"); \n  worker.postMessage(\"hello world\");      // 发送数据\n  worker.onmessage = function (event) {   // 接收数据\n      console.log(event.data);             \n      worker.terminate();\n  }\n  \n  // 子线程：worker.js \n  onmessage = function (event){          // 接收数据\n      var d = event.data;    \n      postMessage(\"已收到：\" + d);        // 发送数据\n  }\n\n  // 通过服务器打开文件：直接打开会报错\n  live-server\n\n\n  // ---------- 共享线程 -----------\n  // 主线程 \n  worker.port.onmessage = function(e){}\n  worker.port.postMessage('data');\n  \n  // 子线程 \n  addEventListener('connect', function(event){\n      var port = event.ports[0]\n      // 接收\n      port.onmessage = function(event){\n          console.log(event.data);\n      };\n      // 发送\n      port.postMessage(\"data\");\n      port.start();\n  })\n  ```\n\n\n# 五、拖放操作\n\n## 事件\n> 事件对象为 被拖拽的元素、放置的目标元素 (拖放范围)\n\n  * 拖拽元素\n    * __dragstart__：拖拽开始时触发 \n    * __drag__：拖拽过程中连续触发\n    * __dragend__：拖拽结束时触发\n  * 目标元素\n    * __dragenter__：拖入元素时触发\n    * __dragover__：拖拽元素时连续触发\n    * __dragleave__：元素拖出时触发\n    * __drop__：拖入后释放鼠标时触发\n  * 执行顺序\n    * drop 触发：`dragstart、drag、dragenter、dragover、drop、dragend`\n    * drop 不触发：`dragstart、drag、dragenter、dragover、dragleave、dragend`\n\n\n## dataTransfer 对象\n> 拖动时回调函数接受的事件参数。注意火狐浏览器下必须设置它的 setData 方法才可以拖拽除图片外的其他标签\n\n  * 属性\n    * __dropEffect__：元素行为和相应光标\n    * __effectAllowed__：允许拖动元素的光标样式\n    * __files__：被拖放文件的 FileList 对象\n  * 方法\n    * __getData__：读取对象中的数据\n    * __setData__：在对象上储存数据\n    * __clearData__：清除对象中的数据\n    * __setDragImage__：指定拖动时显示的图像\n    * __addElement__：添加元素和被拖拽元素一同被拖拽\n\n  ```js\n  img,ondragstart = event => {\n      event.dataTransfer.setData(\"text/plain\", event.target.id)\n  }\n  div.drop = event => {\n      event.preventDefault();\n      var imgId = event.dataTransfer.getData(\"text/plain\")\n  }\n  ```\n\n\n## 拖拽上传预览图片\n  ```js\n  window.onload = function(){\n      var list = document.getElementById('list');\n      var box = document.getElementById('box');\n      box.ondragenter = function(){\n          this.innerHTML = '可以释放';\n      };\n      box.ondragover = function(e){\n          e.preventDefault();\n      };\n      box.ondragleave = function(){\n          this.innerHTML = '请拖拽到此区域';\n      };\n      box.ondrop = function(event){\n          // 连续触发事件阻止冒泡\n          event.preventDefault(); \n\n          // 获取数据对象\n          var fs = event.dataTransfer.files;\n          for(var i=0; i &gt; fs.length; i++){\n\n              // 读取文件信息的接口对象\n              var fr = new FileReader();  \n              if( fs[i].type.indexOf('image')!=-1 ){\n                  fr.readAsDataURL( fs[i] );\n                  fr.onload = function(){\n                      var oLi = document.createElement('li');\n                      var oImg = document.createElement('img');\n                      oImg.src = this.result;\n                      oLi.appendChild( oImg );\n                      list.appendChild( oLi );\n                  }\n              }else{\n                  alert('请拖放图片指定格式');\n              }\n          }\n      }\n  }\n  ```\n\n\n# 六、地理定位 \n> 常用的地理位置定位方式：HTML5、百度地图、高德地图\n        \n  ```js\n  // HTML5 定位\n  function getLocation() {\n      var options = {\n            enableHighAccuracy: true,  // 是否要求高精度\n            maximumAge: 1000           // 应用缓存时间\n      }\n      if (navigator.geolocation) {\n          navigator.geolocation.getCurrentPosition(position =>  {\n              var latitude = position.coords.latitude;    \n              var longitude = position.coords.longitude;  \n              console.log(`纬度：${latitude}, 经度：${longitude}`)\n\n          }, error => {\n              console.log(error)\n              // 常见错误：需要用户授权、仅限 HTTPS、需要翻墙 (谷歌浏览器)\n          }, options);\n\n      } else {\n          // 浏览器不支持\n      }\n  }\n\n  // 百度地图：申请密钥之后以参数形式引入，然后即可调用\n  // script src=\"http://api.map.baidu.com/api?v=2.0&ak=wmwHFMPxi66GlPBVUrdgEhDzbLUqlSrM\"\n\n  var map = new BMap.Map(\"allmap\"); // 创建Map实例\n  var point = new BMap.Point(116.404, 39.915)\n  map.centerAndZoom(point, 15); // 初始化地图，设置中心点坐标和地图级别\n  // map.centerAndZoom(\"上海\",15);  \n\n  map.addControl(new BMap.MapTypeControl()); // 添加地图类型控件\n  map.setCurrentCity(\"北京\");      // 设置地图显示的城市\n  map.enableScrollWheelZoom(true); // 开启鼠标滚轮缩放\n  ```\n\n\n# 七、全屏模式\n  ```js\n  // 启动全屏模式  \n  launchFullScreen(document.documentElement);   // 整个页面  \n  launchFullScreen(document.getElementById(\"video\")); // 单独元素 \n\n  // 取消全屏  \n  cancelFullscreen(); \n\n  function launchFullScreen(element) {  \n      if(element.requestFullScreen) {  \n          element.requestFullScreen();  \n      } else if(element.mozRequestFullScreen) {  \n          element.mozRequestFullScreen();  \n      } else if(element.webkitRequestFullScreen) {  \n          element.webkitRequestFullScreen();  \n      }  \n  }  \n  function cancelFullscreen() {  \n      if(document.cancelFullScreen) {  \n          document.cancelFullScreen();  \n      } else if(document.mozCancelFullScreen) {  \n          document.mozCancelFullScreen();  \n      } else if(document.webkitCancelFullScreen) {  \n          document.webkitCancelFullScreen();  \n      }  \n  }  \n\n \n  // 全屏元素\n  var fullscreenEle = document.fullscreenElement ||\n                      document.mozFullScreenElement ||\n                      document.webkitFullscreenElement;\n\n  // 是否全屏\n  var isFullscreen = document.fullscreenEnabled ||\n                      window.fullScreen ||\n                      document.webkitIsFullScreen ||\n                      document.msFullscreenEnabled;\n\n  // 全屏事件\n  document.addEventListener('fullscreenchange', function(){ })\n  document.addEventListener('fullscreenerror', function(){ })\n  ```\n  \n\n# 八、存储方式\n> 客户端存储方式：localStorage、sessionStorage、cookie、UserData、webSQL、indexeddb、HTML5 离线存储等\n\n\n## 离线存储\n> Application Cache 应用程序缓存，常用于存储网页\n\n  * 优势\n    * 加载快：已缓存资源加载速度块\n    * 离线浏览：用户可以在应用离线时使用\n    * 减少服务器负载：浏览器只从服务器下载更新过的资源\n  * 使用\n    * html 标签添加 manifest 属性：html manifest=\"./js/demo.manifest\"\n    * 编写 manifest 文件：用于告知浏览器需要缓存和不需要缓存的内容\n\n  ```\n  CACHE MANIFEST\n  #version 1.1   // 版本号\n  CACHE:\n      html/index.html   // 首次下载后需要缓存的文件\n  NETWORK:\n      js/jquery.js      // 需要与服务器的连接，不需要缓存的文件\n  FALLBACK: \n      html/index.html   // 当页面无法访问时的回退页面\n  ```\n\n\n## IndexedDB\n> Indexed Database API，是在浏览器中保存结构化数据的一种数据库\n\n  * 有需要再研究：https://www.cnblogs.com/best/p/6084209.html\n\n\n\n# 九、其它\n\n  * 普通元素\n    * 新增标签：`nav、header、aside、section、footer、canvas、video、output、...`\n    * 新增属性：`contextmenu、contentEditable、hidden、draggable、data-*`\n  * 表单元素\n    * 输入验证：`邮箱、地址、日期、数字、电话、范围、搜索、颜色`\n    * 新增属性：`required、pattern、autofocus、autocomplete、novalidate、multiple`\n  * 超链接\n    * 短信：`a href='sms:15919218899'`\n    * 电话：`a href=\"tel:15919218899\"`\n    * 邮件：`a href=\"mailto:99519876@qq.com\"`\n    * 地图：`a href=\"http://map.baidu.com/mobile/search...\"`\n    * QQ客服：`a target=\"_blank\" href=\"http://wpa.qq.com/msgrd?v=3&...\"`\n  * History\n    * 功能：实现无刷新更新地址\n    * API：`history.pushState、history.replaceState`\n   \n\n\n\n\n\n\n\n\n","source":"_posts/21-HTML5新特性.md","raw":"---\ntitle: HTML5 新特性\ntags:\n  - 移动端\ncategories: 移动端\ntop: false\nkeywords:\n  - html5\n  - 移动端\ndate: 2019-04-18 22:50:40\ndescription: audio、Canvas、WebSocket、Web Worker、拖放、定位、全屏、存储\n---\n\n\n# 一、audio、video  \n> 支持的格式：Ogg、MP3、WAV\n\n## 基础使用\n  <div align=\"center\"> \n    ![media](images/mobile/media.png)\n  </div> \n       \n  ```js\n  // var audio = new Audio(\"test.mp3\");\n  var audio = document.getElementById(\"audio\");\n\n  // 资源属性\n  audio.load()         // 重新加载\n  audio.currentSrc     // 当前资源地址\n  audio.src = value      // 设置当前资源地址\n  audio.canPlayType(type)  // 是否能播放某种格式的资源\n\n  // 播放状态属性\n  audio.currentTime = value  // 当前播放的位置\n  audio.startTime/duration/loop/autoPlay\n  audio.played/paused/ended/\n  \n  // 状态控制\n  audio.play();          // 播放\n  audio.pause();         // 暂停\n  audio.controls;        // 默认控制条\n  audio.volume = value;  // 音量\n  audio.muted = value;   // 静音\n\n  // 事件：loadstart、progress、\n  \n  \n  // 监听开始播放\n  audio.addEventListener('pause', function (e) {\n      console.log('开始播放')\n  })\n  // 监听暂停播放\n  audio.addEventListener('pause', function (e) {\n      console.log('暂停播放')\n  })\n  // 监听媒体数据已经加载完成，\n  audio.addEventListener('loadedmetadata', function (e) {\n      console.log('音频时长：'+ e.target.duration)\n  });\n  // 监听时间改变，durationchange 资源长度，volumechange 音量\n  audio.addEventListener('timeupdate', function (e) {\n      let t = e.target\n      console.log('剩余时长：'(t.duration - t.currentTime))\n  }, false);  \n  // 监听播放完成\n  audio.addEventListener('ended', function (e) {\n      console.log('播放完成')\n  }, false);   \n\n\n  var video = document.getElementById('video');\n  // 事件：play、pause、progress、error\n  video.addEventListener('play',function(){ });\n  ```\n\n\n\n## 自动播放\n> ios、Android、微信为了节省流量而规定忽视 autoplay 属性\n\n  ```js\n// ios、Android：循环播放失效时方案相似，\ndocument.addEventListener('touchstart', function () {\n\n    document.getElementById('audio').play();\n})\n\n\n// 微信\ndocument.addEventListener('WeixinJSBridgeReady', function() {\n    document.getElementById('audios').play()\n})\n// 针对苹果的手机微信端\nfunction autoPlayVideo(){\n    wx.config({\n        debug:false,\n        appId:\"\",\n        timestamp:1,\n        nonceStr:\"\",\n        signature:\"\",\n        jsApiList:[]\n    });\n    wx.ready(function(){\n        var autoplayVideo = document.getElementById(\"audio\");\n        autoplayVideo.play()\n    })\n}\n\n\n## 用户权限\n> navigator.getUserMedia 可以提示用户需要权限去使用像摄像头、麦克风等媒体设备\n\n// 兼容写法\nnavigator.getMedia = (navigator.getUserMedia ||\n    navigator.webkitGetUserMedia ||\n    navigator.mozGetUserMedia ||\n    navigator.msGetUserMedia);\n\n// 获取用户摄像头并提供拍照功能：video、canvas、button\nwindow.addEventListener(\"DOMContentLoaded\", function() {\n    // 获取元素，创建设置等等\n    var canvas = document.getElementById(\"canvas\"),\n            context = canvas.getContext(\"2d\"),\n            video = document.getElementById(\"video\"),\n            videoObj = { \"video\": true },\n            errBack = function(error) {\n                console.log(\"Video capture error: \", error.code);\n            };\n\n    // 添加video 监听器\n    if(navigator.getUserMedia) { // 标准\n        navigator.getUserMedia(videoObj, function(stream) {\n            video.src = stream;\n            video.play();\n        }, errBack);\n    } else if(navigator.webkitGetUserMedia) { // WebKit 前缀\n        navigator.webkitGetUserMedia(videoObj, function(stream){\n            video.src = window.webkitURL.createObjectURL(stream);\n            video.play();\n        }, errBack);\n    }\n    else if(navigator.mozGetUserMedia) {    // Firefox 前缀\n        navigator.mozGetUserMedia(videoObj, function(stream){\n            video.src = window.URL.createObjectURL(stream);\n            video.play();\n        }, errBack);\n    }\n\n    document.getElementById(\"snap\").addEventListener(\"click\", function() {\n        context.drawImage(video, 0, 0, 640, 480);\n    });\n\n  }, false)\n  ```\n\n\n# 二、Canvas\n> 提供了一系列绘图方法的对象\n\n## 绘制图形\n  ```js\n  let canvas = document.getElementById(\"canvas\"); \n  if(canvas.getContext){\n    let ctx = canvas.getContext(\"2d\"); \n  }\n  \n  // 线段 \n  ctx.moveTo(100, 20); \n  ctx.lineTo(200, 40);\n  ctx.lineWidth = 5; \n  ctx.strokeStyle = '#CC0000'; \n  ctx.stroke();    // 绘制\n\n  ctx.beginPath();\n  ctx.strokeStyle = \"#ff0000\";\n  ctx.lineTo(20, 20);\n  ctx.lineTo(20, 70);\n  ctx.lineTo(70, 70);\n  ctx.closePath();\n  ctx.stroke();\n\n\n  // 路径：填充\n  ctx.beginPath();\n  ctx.arc(240, 20, 50, 0, Math.PI/2 , false);\n  ctx.closePath();\n  ctx.fillStyle = '#0000ff';\n  ctx.fill();\n\n  // 路径：填充 + 边框\n  ctx.beginPath();\n  ctx.arc(300, 20, 50, 0, Math.PI/2 , false);\n  ctx.strokeStyle = '#0000ff';\n  ctx.closePath();\n  ctx.stroke();\n  ctx.fillStyle = 'rgba(0,0,255,0.2)';\n  ctx.fill();\n\n\n  // 贝塞尔曲线\n  ctx.moveTo(300, 300);\n  ctx.lineWidth = 10;\n  ctx.strokeStyle = \"skyblue\";\n  ctx.bezierCurveTo(300, 50, 500, 50, 150, 150);\n  ctx.stroke();\n        \n\n  // 蓝色填充矩形\n  ctx.fillStyle = \"#0000ff\";\n  ctx.fillRect(20, 100, 60, 60);    \n\n  // 红色边框矩形\n  ctx.lineWidth = 10; \n  ctx.strokeRect(100, 100, 60, 60);  \n  \n\n  // 圆\n  ctx.fillStyle = \"#0000ff\";\n  ctx.strokeStyle = \"#ff0000\";\n  ctx.beginPath();\n  ctx.arc(50, 240, 40, 0, 2*Math.PI, true);\n  ctx.closePath();\n  ctx.stroke();\n  ctx.fill();\n\n  ctx.fillStyle = \"pink\";\n  ctx.beginPath();\n  ctx.arc(50, 240, 20, 0, 2*Math.PI, true);\n  ctx.closePath();\n  ctx.fill();\n\n\n  // 文本\n  ctx.font = \"Bold 20px Arial\"; \n  ctx.textAlign = \"left\";\n  ctx.fillStyle = \"#008600\"; \n  ctx.fillText(\"Hello!\", 10, 50); \n  ctx.strokeText(\"Hello!\", 10, 100); \n\n\n  // 渐变色\n  var grd = ctx.createLinearGradient(0, 0, 300, 200);\n  grd.addColorStop(0,\"#ff0000\");\n  grd.addColorStop(1,\"#0000ff\");\n  ctx.fillStyle = grd;\n  ctx.fillRect(0, 0, 300,200);\n\n\n  // 阴影\n  ctx.shadowOffsetX = 10; \n  ctx.shadowOffsetY = 10; \n  ctx.shadowBlur = 5; \n  ctx.shadowColor = \"rgba(0,0,0,0.5)\"; \n  ctx.fillStyle = \"#CC0000\"; \n  ctx.fillRect(10, 10, 200, 100);\n  ```\n\n\n## 绘制图像\n  ```js\n  // canvas id=\"canvas\" width=\"400\" height=\"400\"\n  let canvas = document.getElementById(\"canvas\");\n  let ctx = canvas.getContext(\"2d\");\n  let image = new Image();\n  image.onload = function() {\n      \n      // 图片绘制\n      // ctx.drawImage(image, 0, 0)\n\n      // 图片裁剪\n      ctx.beginPath(); \n      ctx.arc(100, 100, 100, 0, Math.PI*2, true); \n      ctx.clip();          \n      ctx.drawImage(image, 0, 0);\n  }\n  image.src = './mobile-type.png';\n\n  // 获取图片保存地址\n  let src = canvas.toDataURL('image/png')\n  ```\n\n   \n## 动画效果\n  ```js\n  var x = 0;\n  var y = 15;\n  var speed = 5;\n  function animation() {\n      window.requestAnimationFrame(animate);\n      x += speed;\n      if(x &lt;= 0 || x &gt;= 475){\n          speed = -speed;\n      }\n      draw()\n  }\n  function draw() {\n      var canvas = document.getElementById(\"canvas\");\n      var context = canvas.getContext(\"2d\");\n      context.clearRect(0, 0, 500, 170);\n      context.fillStyle = \"#ff00ff\";\n      context.fillRect(x, y, 25, 25);\n  }\n  animation()\n  ```\n\n\n## 像素处理\n\n  ```js\n  // 获取图像数据\n  let imgData = ctx.getImageData(0, 0, canvas.width, canvas.height)\n      \n  // 处理图像数据\n  filter(imageData);\n\n  // 重新绘制图像\n  ctx.putImageData(imageData, 0, 0)\n  ```\n\n\n# 三、WebSocket\n  ```js\n  // 创建实例\n  var socket = new WebSocket('ws://localhost:8080');\n\n  // 打开 socket\n  socket.onopen = function(event) {\n\n      // 发送消息\n      socket.send('hello HTML5')\n\n      // 监听消息\n      socket.onmessage = function(event) {\n          console.log('receive a message', event)\n      };\n\n      // 监听关闭\n      socket.onclose = function(ev) {\n          console.log('socket has closed', event)\n      };\n\n      // 关闭 socket\n      socket.close()\n  }\n  ```\n\n\n# 四、Web Worker\n\n## 机制\n  * 在当前 js 的主线程中，通过 Worker 类加载一个 js 文件来开辟一个新的线程\n  * 新线程可以加载 JS 进行大量的复杂运算，同时主线程不需要挂起等待而是执行其它代码\n  * 新线程创建时，它的脚本文件生成的两个对象和一套 API 可以实现主线程和子线程的数据通信\n    * __worker 对象__：主线程脚本中通过构造函数显式创建，通过实例方法获取\n    * __WorkerGlobalScope 对象__：子线程脚本中隐式创建的全局对象，通过 this 获取\n    * __API 接口__：主线程和子线程脚本间进行数据传输的接口，主要为 postMessage、onmessage\n      \n\n## Web 主线程\n  1. 创建新线程：`var worker = new Worker(url)`\n  2. 发送数据：`worker.postMessage(data)`\n  3. 接收数据：`worker.onmessage = fn`\n  4. 结束新线程：`worker.terminate()`\n\n  ```js\n  // 判断当前浏览器是否支持 web worker\n  if (typeof (Worker) != \"undefined\") {\n      if (typeof (w) == \"undefined\") {       \n          w = new Worker(\"webworker.js\"); \n      }  \n      // 事件处理函数，用来处理后端的 web worker 传递的消息  \n      w.onmessage = function (event) { \n          // do something\n      };\n  } else { \n      \n  }\n\n  // 加载一个 JS 文件来创建一个 worker，同时返回一个 worker 实例\n  var worker = new Worker(\"worker.js\")\n\n  // 向 worker 发送数据\n  worker.postMessage()\n\n  // 接收 worker 发送的数据\n  worker.onmessage = function(event){ }\n\n  // 异常处理\n  worker.onerror = function(err){\n    // 错误所在的代码文件和行数、错误信息\n    alert(\"Line #\" + err.lineno + \" - \" + err.message + \" in \" + err.filename);\n  }\n\n  // 结束 worker\n  worker.terminate()  \n  ```\n      \n\n## worker 新线程\n> 全局变量 this 省略\n\n  1. 发送数据：`postMessage(data)`\n  2. 接收数据：`onmessage = fn`\n  3. 加载脚本：`importScripts('a.js', 'b.js')`\n  4. 结束自身：`self.close()`    \n\n\n## 应用场景\n\n  * 用来进行处理大量的复杂计算而不挂起主线程\n  * 可以在 worker 中通过 `importScripts(url) `加载其它脚本文件\n  * 可以使用 `setTimeout()、clearTimeout()、setInterval()、clearInterval()`\n  * 可以使用 `XMLHttpRequest` 来发送请求\n  * 可以访问 `navigator、location` 对象\n\n\n## 操作限制\n> Worker 线程脚本\n\n  * __脚本限制__：无法调用 alert、confirm 等函数\n  * __同源限制__：不能跨域加载脚本文件，它必须与主线程的脚本文件同源\n  * __通信限制__：Worker 线程和主线程不在同一个上下文环境，它们不能直接通信\n  * __文件限制__：无法读取本地文件，所加载的脚本必须 来自网络或通过服务器打开\n  * __DOM 限制__\n    * 无法访问 DOM 节点\n    * 无法访问 window、document 等全局变量\n\n\n## 分类\n  * __专用线程__\n    * 特点：只能被创建它的页面访问，随当前页面的关闭而结束\n    * 通信：通过 onmessage()、postmessage()\n  * __共享线程__\n    * 特点：可以被多个页面访问\n    * 通信：connect 后通过 port 属性\n\n  ```js\n  // ---------- 专用线程 -----------\n  // 主线程 index.html/script\n  var worker = new Worker(\"worker.js\"); \n  worker.postMessage(\"hello world\");      // 发送数据\n  worker.onmessage = function (event) {   // 接收数据\n      console.log(event.data);             \n      worker.terminate();\n  }\n  \n  // 子线程：worker.js \n  onmessage = function (event){          // 接收数据\n      var d = event.data;    \n      postMessage(\"已收到：\" + d);        // 发送数据\n  }\n\n  // 通过服务器打开文件：直接打开会报错\n  live-server\n\n\n  // ---------- 共享线程 -----------\n  // 主线程 \n  worker.port.onmessage = function(e){}\n  worker.port.postMessage('data');\n  \n  // 子线程 \n  addEventListener('connect', function(event){\n      var port = event.ports[0]\n      // 接收\n      port.onmessage = function(event){\n          console.log(event.data);\n      };\n      // 发送\n      port.postMessage(\"data\");\n      port.start();\n  })\n  ```\n\n\n# 五、拖放操作\n\n## 事件\n> 事件对象为 被拖拽的元素、放置的目标元素 (拖放范围)\n\n  * 拖拽元素\n    * __dragstart__：拖拽开始时触发 \n    * __drag__：拖拽过程中连续触发\n    * __dragend__：拖拽结束时触发\n  * 目标元素\n    * __dragenter__：拖入元素时触发\n    * __dragover__：拖拽元素时连续触发\n    * __dragleave__：元素拖出时触发\n    * __drop__：拖入后释放鼠标时触发\n  * 执行顺序\n    * drop 触发：`dragstart、drag、dragenter、dragover、drop、dragend`\n    * drop 不触发：`dragstart、drag、dragenter、dragover、dragleave、dragend`\n\n\n## dataTransfer 对象\n> 拖动时回调函数接受的事件参数。注意火狐浏览器下必须设置它的 setData 方法才可以拖拽除图片外的其他标签\n\n  * 属性\n    * __dropEffect__：元素行为和相应光标\n    * __effectAllowed__：允许拖动元素的光标样式\n    * __files__：被拖放文件的 FileList 对象\n  * 方法\n    * __getData__：读取对象中的数据\n    * __setData__：在对象上储存数据\n    * __clearData__：清除对象中的数据\n    * __setDragImage__：指定拖动时显示的图像\n    * __addElement__：添加元素和被拖拽元素一同被拖拽\n\n  ```js\n  img,ondragstart = event => {\n      event.dataTransfer.setData(\"text/plain\", event.target.id)\n  }\n  div.drop = event => {\n      event.preventDefault();\n      var imgId = event.dataTransfer.getData(\"text/plain\")\n  }\n  ```\n\n\n## 拖拽上传预览图片\n  ```js\n  window.onload = function(){\n      var list = document.getElementById('list');\n      var box = document.getElementById('box');\n      box.ondragenter = function(){\n          this.innerHTML = '可以释放';\n      };\n      box.ondragover = function(e){\n          e.preventDefault();\n      };\n      box.ondragleave = function(){\n          this.innerHTML = '请拖拽到此区域';\n      };\n      box.ondrop = function(event){\n          // 连续触发事件阻止冒泡\n          event.preventDefault(); \n\n          // 获取数据对象\n          var fs = event.dataTransfer.files;\n          for(var i=0; i &gt; fs.length; i++){\n\n              // 读取文件信息的接口对象\n              var fr = new FileReader();  \n              if( fs[i].type.indexOf('image')!=-1 ){\n                  fr.readAsDataURL( fs[i] );\n                  fr.onload = function(){\n                      var oLi = document.createElement('li');\n                      var oImg = document.createElement('img');\n                      oImg.src = this.result;\n                      oLi.appendChild( oImg );\n                      list.appendChild( oLi );\n                  }\n              }else{\n                  alert('请拖放图片指定格式');\n              }\n          }\n      }\n  }\n  ```\n\n\n# 六、地理定位 \n> 常用的地理位置定位方式：HTML5、百度地图、高德地图\n        \n  ```js\n  // HTML5 定位\n  function getLocation() {\n      var options = {\n            enableHighAccuracy: true,  // 是否要求高精度\n            maximumAge: 1000           // 应用缓存时间\n      }\n      if (navigator.geolocation) {\n          navigator.geolocation.getCurrentPosition(position =>  {\n              var latitude = position.coords.latitude;    \n              var longitude = position.coords.longitude;  \n              console.log(`纬度：${latitude}, 经度：${longitude}`)\n\n          }, error => {\n              console.log(error)\n              // 常见错误：需要用户授权、仅限 HTTPS、需要翻墙 (谷歌浏览器)\n          }, options);\n\n      } else {\n          // 浏览器不支持\n      }\n  }\n\n  // 百度地图：申请密钥之后以参数形式引入，然后即可调用\n  // script src=\"http://api.map.baidu.com/api?v=2.0&ak=wmwHFMPxi66GlPBVUrdgEhDzbLUqlSrM\"\n\n  var map = new BMap.Map(\"allmap\"); // 创建Map实例\n  var point = new BMap.Point(116.404, 39.915)\n  map.centerAndZoom(point, 15); // 初始化地图，设置中心点坐标和地图级别\n  // map.centerAndZoom(\"上海\",15);  \n\n  map.addControl(new BMap.MapTypeControl()); // 添加地图类型控件\n  map.setCurrentCity(\"北京\");      // 设置地图显示的城市\n  map.enableScrollWheelZoom(true); // 开启鼠标滚轮缩放\n  ```\n\n\n# 七、全屏模式\n  ```js\n  // 启动全屏模式  \n  launchFullScreen(document.documentElement);   // 整个页面  \n  launchFullScreen(document.getElementById(\"video\")); // 单独元素 \n\n  // 取消全屏  \n  cancelFullscreen(); \n\n  function launchFullScreen(element) {  \n      if(element.requestFullScreen) {  \n          element.requestFullScreen();  \n      } else if(element.mozRequestFullScreen) {  \n          element.mozRequestFullScreen();  \n      } else if(element.webkitRequestFullScreen) {  \n          element.webkitRequestFullScreen();  \n      }  \n  }  \n  function cancelFullscreen() {  \n      if(document.cancelFullScreen) {  \n          document.cancelFullScreen();  \n      } else if(document.mozCancelFullScreen) {  \n          document.mozCancelFullScreen();  \n      } else if(document.webkitCancelFullScreen) {  \n          document.webkitCancelFullScreen();  \n      }  \n  }  \n\n \n  // 全屏元素\n  var fullscreenEle = document.fullscreenElement ||\n                      document.mozFullScreenElement ||\n                      document.webkitFullscreenElement;\n\n  // 是否全屏\n  var isFullscreen = document.fullscreenEnabled ||\n                      window.fullScreen ||\n                      document.webkitIsFullScreen ||\n                      document.msFullscreenEnabled;\n\n  // 全屏事件\n  document.addEventListener('fullscreenchange', function(){ })\n  document.addEventListener('fullscreenerror', function(){ })\n  ```\n  \n\n# 八、存储方式\n> 客户端存储方式：localStorage、sessionStorage、cookie、UserData、webSQL、indexeddb、HTML5 离线存储等\n\n\n## 离线存储\n> Application Cache 应用程序缓存，常用于存储网页\n\n  * 优势\n    * 加载快：已缓存资源加载速度块\n    * 离线浏览：用户可以在应用离线时使用\n    * 减少服务器负载：浏览器只从服务器下载更新过的资源\n  * 使用\n    * html 标签添加 manifest 属性：html manifest=\"./js/demo.manifest\"\n    * 编写 manifest 文件：用于告知浏览器需要缓存和不需要缓存的内容\n\n  ```\n  CACHE MANIFEST\n  #version 1.1   // 版本号\n  CACHE:\n      html/index.html   // 首次下载后需要缓存的文件\n  NETWORK:\n      js/jquery.js      // 需要与服务器的连接，不需要缓存的文件\n  FALLBACK: \n      html/index.html   // 当页面无法访问时的回退页面\n  ```\n\n\n## IndexedDB\n> Indexed Database API，是在浏览器中保存结构化数据的一种数据库\n\n  * 有需要再研究：https://www.cnblogs.com/best/p/6084209.html\n\n\n\n# 九、其它\n\n  * 普通元素\n    * 新增标签：`nav、header、aside、section、footer、canvas、video、output、...`\n    * 新增属性：`contextmenu、contentEditable、hidden、draggable、data-*`\n  * 表单元素\n    * 输入验证：`邮箱、地址、日期、数字、电话、范围、搜索、颜色`\n    * 新增属性：`required、pattern、autofocus、autocomplete、novalidate、multiple`\n  * 超链接\n    * 短信：`a href='sms:15919218899'`\n    * 电话：`a href=\"tel:15919218899\"`\n    * 邮件：`a href=\"mailto:99519876@qq.com\"`\n    * 地图：`a href=\"http://map.baidu.com/mobile/search...\"`\n    * QQ客服：`a target=\"_blank\" href=\"http://wpa.qq.com/msgrd?v=3&...\"`\n  * History\n    * 功能：实现无刷新更新地址\n    * API：`history.pushState、history.replaceState`\n   \n\n\n\n\n\n\n\n\n","slug":"21-HTML5新特性","published":1,"updated":"2019-05-10T17:29:00.345Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvid4plt001e0nbxrxzukbbp","content":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><html><head></head><body><h1 id=\"一、audio、video\"><a href=\"#一、audio、video\" class=\"headerlink\" title=\"一、audio、video\"></a>一、audio、video</h1><blockquote><p>支持的格式：Ogg、MP3、WAV</p></blockquote><h2 id=\"基础使用\"><a href=\"#基础使用\" class=\"headerlink\" title=\"基础使用\"></a>基础使用</h2><div align=\"center\"><br><img src=\"images/mobile/media.png\" alt=\"media\"><br></div><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// var audio = new Audio(\"test.mp3\");</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> audio = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"audio\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 资源属性</span></span><br><span class=\"line\">audio.load()         <span class=\"comment\">// 重新加载</span></span><br><span class=\"line\">audio.currentSrc     <span class=\"comment\">// 当前资源地址</span></span><br><span class=\"line\">audio.src = value      <span class=\"comment\">// 设置当前资源地址</span></span><br><span class=\"line\">audio.canPlayType(type)  <span class=\"comment\">// 是否能播放某种格式的资源</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 播放状态属性</span></span><br><span class=\"line\">audio.currentTime = value  <span class=\"comment\">// 当前播放的位置</span></span><br><span class=\"line\">audio.startTime/duration/loop/autoPlay</span><br><span class=\"line\">audio.played/paused/ended/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 状态控制</span></span><br><span class=\"line\">audio.play();          <span class=\"comment\">// 播放</span></span><br><span class=\"line\">audio.pause();         <span class=\"comment\">// 暂停</span></span><br><span class=\"line\">audio.controls;        <span class=\"comment\">// 默认控制条</span></span><br><span class=\"line\">audio.volume = value;  <span class=\"comment\">// 音量</span></span><br><span class=\"line\">audio.muted = value;   <span class=\"comment\">// 静音</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 事件：loadstart、progress、</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 监听开始播放</span></span><br><span class=\"line\">audio.addEventListener(<span class=\"string\">'pause'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'开始播放'</span>)</span><br><span class=\"line\">})</span><br><span class=\"line\"><span class=\"comment\">// 监听暂停播放</span></span><br><span class=\"line\">audio.addEventListener(<span class=\"string\">'pause'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'暂停播放'</span>)</span><br><span class=\"line\">})</span><br><span class=\"line\"><span class=\"comment\">// 监听媒体数据已经加载完成，</span></span><br><span class=\"line\">audio.addEventListener(<span class=\"string\">'loadedmetadata'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'音频时长：'</span>+ e.target.duration)</span><br><span class=\"line\">});</span><br><span class=\"line\"><span class=\"comment\">// 监听时间改变，durationchange 资源长度，volumechange 音量</span></span><br><span class=\"line\">audio.addEventListener(<span class=\"string\">'timeupdate'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">let</span> t = e.target</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'剩余时长：'</span>(t.duration - t.currentTime))</span><br><span class=\"line\">}, <span class=\"literal\">false</span>);  </span><br><span class=\"line\"><span class=\"comment\">// 监听播放完成</span></span><br><span class=\"line\">audio.addEventListener(<span class=\"string\">'ended'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'播放完成'</span>)</span><br><span class=\"line\">}, <span class=\"literal\">false</span>);   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> video = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'video'</span>);</span><br><span class=\"line\"><span class=\"comment\">// 事件：play、pause、progress、error</span></span><br><span class=\"line\">video.addEventListener(<span class=\"string\">'play'</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{ });</span><br></pre></td></tr></tbody></table></figure><h2 id=\"自动播放\"><a href=\"#自动播放\" class=\"headerlink\" title=\"自动播放\"></a>自动播放</h2><blockquote><p>ios、Android、微信为了节省流量而规定忽视 autoplay 属性</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ios、Android：循环播放失效时方案相似，</span></span><br><span class=\"line\"><span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">'touchstart'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'audio'</span>).play();</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 微信</span></span><br><span class=\"line\"><span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">'WeixinJSBridgeReady'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'audios'</span>).play()</span><br><span class=\"line\">})</span><br><span class=\"line\"><span class=\"comment\">// 针对苹果的手机微信端</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">autoPlayVideo</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    wx.config({</span><br><span class=\"line\">        debug:<span class=\"literal\">false</span>,</span><br><span class=\"line\">        appId:<span class=\"string\">\"\"</span>,</span><br><span class=\"line\">        timestamp:<span class=\"number\">1</span>,</span><br><span class=\"line\">        nonceStr:<span class=\"string\">\"\"</span>,</span><br><span class=\"line\">        signature:<span class=\"string\">\"\"</span>,</span><br><span class=\"line\">        jsApiList:[]</span><br><span class=\"line\">    });</span><br><span class=\"line\">    wx.ready(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">        <span class=\"keyword\">var</span> autoplayVideo = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"audio\"</span>);</span><br><span class=\"line\">        autoplayVideo.play()</span><br><span class=\"line\">    })</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">## 用户权限</span><br><span class=\"line\">> navigator.getUserMedia 可以提示用户需要权限去使用像摄像头、麦克风等媒体设备</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 兼容写法</span></span><br><span class=\"line\">navigator.getMedia = (navigator.getUserMedia ||</span><br><span class=\"line\">    navigator.webkitGetUserMedia ||</span><br><span class=\"line\">    navigator.mozGetUserMedia ||</span><br><span class=\"line\">    navigator.msGetUserMedia);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 获取用户摄像头并提供拍照功能：video、canvas、button</span></span><br><span class=\"line\"><span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">\"DOMContentLoaded\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"comment\">// 获取元素，创建设置等等</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"canvas\"</span>),</span><br><span class=\"line\">            context = canvas.getContext(<span class=\"string\">\"2d\"</span>),</span><br><span class=\"line\">            video = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"video\"</span>),</span><br><span class=\"line\">            videoObj = { <span class=\"string\">\"video\"</span>: <span class=\"literal\">true</span> },</span><br><span class=\"line\">            errBack = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">error</span>) </span>{</span><br><span class=\"line\">                <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Video capture error: \"</span>, error.code);</span><br><span class=\"line\">            };</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 添加video 监听器</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(navigator.getUserMedia) { <span class=\"comment\">// 标准</span></span><br><span class=\"line\">        navigator.getUserMedia(videoObj, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">stream</span>) </span>{</span><br><span class=\"line\">            video.src = stream;</span><br><span class=\"line\">            video.play();</span><br><span class=\"line\">        }, errBack);</span><br><span class=\"line\">    } <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(navigator.webkitGetUserMedia) { <span class=\"comment\">// WebKit 前缀</span></span><br><span class=\"line\">        navigator.webkitGetUserMedia(videoObj, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">stream</span>)</span>{</span><br><span class=\"line\">            video.src = <span class=\"built_in\">window</span>.webkitURL.createObjectURL(stream);</span><br><span class=\"line\">            video.play();</span><br><span class=\"line\">        }, errBack);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(navigator.mozGetUserMedia) {    <span class=\"comment\">// Firefox 前缀</span></span><br><span class=\"line\">        navigator.mozGetUserMedia(videoObj, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">stream</span>)</span>{</span><br><span class=\"line\">            video.src = <span class=\"built_in\">window</span>.URL.createObjectURL(stream);</span><br><span class=\"line\">            video.play();</span><br><span class=\"line\">        }, errBack);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"snap\"</span>).addEventListener(<span class=\"string\">\"click\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">        context.drawImage(video, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">640</span>, <span class=\"number\">480</span>);</span><br><span class=\"line\">    });</span><br><span class=\"line\"></span><br><span class=\"line\">  }, <span class=\"literal\">false</span>)</span><br></pre></td></tr></tbody></table></figure><h1 id=\"二、Canvas\"><a href=\"#二、Canvas\" class=\"headerlink\" title=\"二、Canvas\"></a>二、Canvas</h1><blockquote><p>提供了一系列绘图方法的对象</p></blockquote><h2 id=\"绘制图形\"><a href=\"#绘制图形\" class=\"headerlink\" title=\"绘制图形\"></a>绘制图形</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> canvas = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"canvas\"</span>); </span><br><span class=\"line\"><span class=\"keyword\">if</span>(canvas.getContext){</span><br><span class=\"line\">  <span class=\"keyword\">let</span> ctx = canvas.getContext(<span class=\"string\">\"2d\"</span>); </span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 线段 </span></span><br><span class=\"line\">ctx.moveTo(<span class=\"number\">100</span>, <span class=\"number\">20</span>); </span><br><span class=\"line\">ctx.lineTo(<span class=\"number\">200</span>, <span class=\"number\">40</span>);</span><br><span class=\"line\">ctx.lineWidth = <span class=\"number\">5</span>; </span><br><span class=\"line\">ctx.strokeStyle = <span class=\"string\">'#CC0000'</span>; </span><br><span class=\"line\">ctx.stroke();    <span class=\"comment\">// 绘制</span></span><br><span class=\"line\"></span><br><span class=\"line\">ctx.beginPath();</span><br><span class=\"line\">ctx.strokeStyle = <span class=\"string\">\"#ff0000\"</span>;</span><br><span class=\"line\">ctx.lineTo(<span class=\"number\">20</span>, <span class=\"number\">20</span>);</span><br><span class=\"line\">ctx.lineTo(<span class=\"number\">20</span>, <span class=\"number\">70</span>);</span><br><span class=\"line\">ctx.lineTo(<span class=\"number\">70</span>, <span class=\"number\">70</span>);</span><br><span class=\"line\">ctx.closePath();</span><br><span class=\"line\">ctx.stroke();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 路径：填充</span></span><br><span class=\"line\">ctx.beginPath();</span><br><span class=\"line\">ctx.arc(<span class=\"number\">240</span>, <span class=\"number\">20</span>, <span class=\"number\">50</span>, <span class=\"number\">0</span>, <span class=\"built_in\">Math</span>.PI/<span class=\"number\">2</span> , <span class=\"literal\">false</span>);</span><br><span class=\"line\">ctx.closePath();</span><br><span class=\"line\">ctx.fillStyle = <span class=\"string\">'#0000ff'</span>;</span><br><span class=\"line\">ctx.fill();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 路径：填充 + 边框</span></span><br><span class=\"line\">ctx.beginPath();</span><br><span class=\"line\">ctx.arc(<span class=\"number\">300</span>, <span class=\"number\">20</span>, <span class=\"number\">50</span>, <span class=\"number\">0</span>, <span class=\"built_in\">Math</span>.PI/<span class=\"number\">2</span> , <span class=\"literal\">false</span>);</span><br><span class=\"line\">ctx.strokeStyle = <span class=\"string\">'#0000ff'</span>;</span><br><span class=\"line\">ctx.closePath();</span><br><span class=\"line\">ctx.stroke();</span><br><span class=\"line\">ctx.fillStyle = <span class=\"string\">'rgba(0,0,255,0.2)'</span>;</span><br><span class=\"line\">ctx.fill();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 贝塞尔曲线</span></span><br><span class=\"line\">ctx.moveTo(<span class=\"number\">300</span>, <span class=\"number\">300</span>);</span><br><span class=\"line\">ctx.lineWidth = <span class=\"number\">10</span>;</span><br><span class=\"line\">ctx.strokeStyle = <span class=\"string\">\"skyblue\"</span>;</span><br><span class=\"line\">ctx.bezierCurveTo(<span class=\"number\">300</span>, <span class=\"number\">50</span>, <span class=\"number\">500</span>, <span class=\"number\">50</span>, <span class=\"number\">150</span>, <span class=\"number\">150</span>);</span><br><span class=\"line\">ctx.stroke();</span><br><span class=\"line\">      </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 蓝色填充矩形</span></span><br><span class=\"line\">ctx.fillStyle = <span class=\"string\">\"#0000ff\"</span>;</span><br><span class=\"line\">ctx.fillRect(<span class=\"number\">20</span>, <span class=\"number\">100</span>, <span class=\"number\">60</span>, <span class=\"number\">60</span>);    </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 红色边框矩形</span></span><br><span class=\"line\">ctx.lineWidth = <span class=\"number\">10</span>; </span><br><span class=\"line\">ctx.strokeRect(<span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">60</span>, <span class=\"number\">60</span>);  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 圆</span></span><br><span class=\"line\">ctx.fillStyle = <span class=\"string\">\"#0000ff\"</span>;</span><br><span class=\"line\">ctx.strokeStyle = <span class=\"string\">\"#ff0000\"</span>;</span><br><span class=\"line\">ctx.beginPath();</span><br><span class=\"line\">ctx.arc(<span class=\"number\">50</span>, <span class=\"number\">240</span>, <span class=\"number\">40</span>, <span class=\"number\">0</span>, <span class=\"number\">2</span>*<span class=\"built_in\">Math</span>.PI, <span class=\"literal\">true</span>);</span><br><span class=\"line\">ctx.closePath();</span><br><span class=\"line\">ctx.stroke();</span><br><span class=\"line\">ctx.fill();</span><br><span class=\"line\"></span><br><span class=\"line\">ctx.fillStyle = <span class=\"string\">\"pink\"</span>;</span><br><span class=\"line\">ctx.beginPath();</span><br><span class=\"line\">ctx.arc(<span class=\"number\">50</span>, <span class=\"number\">240</span>, <span class=\"number\">20</span>, <span class=\"number\">0</span>, <span class=\"number\">2</span>*<span class=\"built_in\">Math</span>.PI, <span class=\"literal\">true</span>);</span><br><span class=\"line\">ctx.closePath();</span><br><span class=\"line\">ctx.fill();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 文本</span></span><br><span class=\"line\">ctx.font = <span class=\"string\">\"Bold 20px Arial\"</span>; </span><br><span class=\"line\">ctx.textAlign = <span class=\"string\">\"left\"</span>;</span><br><span class=\"line\">ctx.fillStyle = <span class=\"string\">\"#008600\"</span>; </span><br><span class=\"line\">ctx.fillText(<span class=\"string\">\"Hello!\"</span>, <span class=\"number\">10</span>, <span class=\"number\">50</span>); </span><br><span class=\"line\">ctx.strokeText(<span class=\"string\">\"Hello!\"</span>, <span class=\"number\">10</span>, <span class=\"number\">100</span>); </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 渐变色</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> grd = ctx.createLinearGradient(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">300</span>, <span class=\"number\">200</span>);</span><br><span class=\"line\">grd.addColorStop(<span class=\"number\">0</span>,<span class=\"string\">\"#ff0000\"</span>);</span><br><span class=\"line\">grd.addColorStop(<span class=\"number\">1</span>,<span class=\"string\">\"#0000ff\"</span>);</span><br><span class=\"line\">ctx.fillStyle = grd;</span><br><span class=\"line\">ctx.fillRect(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">300</span>,<span class=\"number\">200</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 阴影</span></span><br><span class=\"line\">ctx.shadowOffsetX = <span class=\"number\">10</span>; </span><br><span class=\"line\">ctx.shadowOffsetY = <span class=\"number\">10</span>; </span><br><span class=\"line\">ctx.shadowBlur = <span class=\"number\">5</span>; </span><br><span class=\"line\">ctx.shadowColor = <span class=\"string\">\"rgba(0,0,0,0.5)\"</span>; </span><br><span class=\"line\">ctx.fillStyle = <span class=\"string\">\"#CC0000\"</span>; </span><br><span class=\"line\">ctx.fillRect(<span class=\"number\">10</span>, <span class=\"number\">10</span>, <span class=\"number\">200</span>, <span class=\"number\">100</span>);</span><br></pre></td></tr></tbody></table></figure><h2 id=\"绘制图像\"><a href=\"#绘制图像\" class=\"headerlink\" title=\"绘制图像\"></a>绘制图像</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// canvas id=\"canvas\" width=\"400\" height=\"400\"</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> canvas = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"canvas\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> ctx = canvas.getContext(<span class=\"string\">\"2d\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> image = <span class=\"keyword\">new</span> Image();</span><br><span class=\"line\">image.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 图片绘制</span></span><br><span class=\"line\">    <span class=\"comment\">// ctx.drawImage(image, 0, 0)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 图片裁剪</span></span><br><span class=\"line\">    ctx.beginPath(); </span><br><span class=\"line\">    ctx.arc(<span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">0</span>, <span class=\"built_in\">Math</span>.PI*<span class=\"number\">2</span>, <span class=\"literal\">true</span>); </span><br><span class=\"line\">    ctx.clip();          </span><br><span class=\"line\">    ctx.drawImage(image, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">}</span><br><span class=\"line\">image.src = <span class=\"string\">'./mobile-type.png'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 获取图片保存地址</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> src = canvas.toDataURL(<span class=\"string\">'image/png'</span>)</span><br></pre></td></tr></tbody></table></figure><h2 id=\"动画效果\"><a href=\"#动画效果\" class=\"headerlink\" title=\"动画效果\"></a>动画效果</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> x = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> y = <span class=\"number\">15</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> speed = <span class=\"number\">5</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">animation</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">window</span>.requestAnimationFrame(animate);</span><br><span class=\"line\">    x += speed;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(x &lt;= <span class=\"number\">0</span> || x &gt;= <span class=\"number\">475</span>){</span><br><span class=\"line\">        speed = -speed;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    draw()</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">draw</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"canvas\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> context = canvas.getContext(<span class=\"string\">\"2d\"</span>);</span><br><span class=\"line\">    context.clearRect(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">500</span>, <span class=\"number\">170</span>);</span><br><span class=\"line\">    context.fillStyle = <span class=\"string\">\"#ff00ff\"</span>;</span><br><span class=\"line\">    context.fillRect(x, y, <span class=\"number\">25</span>, <span class=\"number\">25</span>);</span><br><span class=\"line\">}</span><br><span class=\"line\">animation()</span><br></pre></td></tr></tbody></table></figure><h2 id=\"像素处理\"><a href=\"#像素处理\" class=\"headerlink\" title=\"像素处理\"></a>像素处理</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 获取图像数据</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> imgData = ctx.getImageData(<span class=\"number\">0</span>, <span class=\"number\">0</span>, canvas.width, canvas.height)</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"comment\">// 处理图像数据</span></span><br><span class=\"line\">filter(imageData);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 重新绘制图像</span></span><br><span class=\"line\">ctx.putImageData(imageData, <span class=\"number\">0</span>, <span class=\"number\">0</span>)</span><br></pre></td></tr></tbody></table></figure><h1 id=\"三、WebSocket\"><a href=\"#三、WebSocket\" class=\"headerlink\" title=\"三、WebSocket\"></a>三、WebSocket</h1><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 创建实例</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> socket = <span class=\"keyword\">new</span> WebSocket(<span class=\"string\">'ws://localhost:8080'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 打开 socket</span></span><br><span class=\"line\">socket.onopen = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 发送消息</span></span><br><span class=\"line\">    socket.send(<span class=\"string\">'hello HTML5'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 监听消息</span></span><br><span class=\"line\">    socket.onmessage = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>{</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'receive a message'</span>, event)</span><br><span class=\"line\">    };</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 监听关闭</span></span><br><span class=\"line\">    socket.onclose = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">ev</span>) </span>{</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'socket has closed'</span>, event)</span><br><span class=\"line\">    };</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 关闭 socket</span></span><br><span class=\"line\">    socket.close()</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h1 id=\"四、Web-Worker\"><a href=\"#四、Web-Worker\" class=\"headerlink\" title=\"四、Web Worker\"></a>四、Web Worker</h1><h2 id=\"机制\"><a href=\"#机制\" class=\"headerlink\" title=\"机制\"></a>机制</h2><ul><li>在当前 js 的主线程中，通过 Worker 类加载一个 js 文件来开辟一个新的线程</li><li>新线程可以加载 JS 进行大量的复杂运算，同时主线程不需要挂起等待而是执行其它代码</li><li>新线程创建时，它的脚本文件生成的两个对象和一套 API 可以实现主线程和子线程的数据通信<ul><li><strong>worker 对象</strong>：主线程脚本中通过构造函数显式创建，通过实例方法获取</li><li><strong>WorkerGlobalScope 对象</strong>：子线程脚本中隐式创建的全局对象，通过 this 获取</li><li><strong>API 接口</strong>：主线程和子线程脚本间进行数据传输的接口，主要为 postMessage、onmessage</li></ul></li></ul><h2 id=\"Web-主线程\"><a href=\"#Web-主线程\" class=\"headerlink\" title=\"Web 主线程\"></a>Web 主线程</h2><ol><li>创建新线程：<code>var worker = new Worker(url)</code></li><li>发送数据：<code>worker.postMessage(data)</code></li><li>接收数据：<code>worker.onmessage = fn</code></li><li><p>结束新线程：<code>worker.terminate()</code></p><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 判断当前浏览器是否支持 web worker</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> (Worker) != <span class=\"string\">\"undefined\"</span>) {</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> (w) == <span class=\"string\">\"undefined\"</span>) {       </span><br><span class=\"line\">        w = <span class=\"keyword\">new</span> Worker(<span class=\"string\">\"webworker.js\"</span>); </span><br><span class=\"line\">    }  </span><br><span class=\"line\">    <span class=\"comment\">// 事件处理函数，用来处理后端的 web worker 传递的消息  </span></span><br><span class=\"line\">    w.onmessage = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>) </span>{ </span><br><span class=\"line\">        <span class=\"comment\">// do something</span></span><br><span class=\"line\">    };</span><br><span class=\"line\">} <span class=\"keyword\">else</span> { </span><br><span class=\"line\">    </span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 加载一个 JS 文件来创建一个 worker，同时返回一个 worker 实例</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> worker = <span class=\"keyword\">new</span> Worker(<span class=\"string\">\"worker.js\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 向 worker 发送数据</span></span><br><span class=\"line\">worker.postMessage()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 接收 worker 发送的数据</span></span><br><span class=\"line\">worker.onmessage = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>)</span>{ }</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 异常处理</span></span><br><span class=\"line\">worker.onerror = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>)</span>{</span><br><span class=\"line\">  <span class=\"comment\">// 错误所在的代码文件和行数、错误信息</span></span><br><span class=\"line\">  alert(<span class=\"string\">\"Line #\"</span> + err.lineno + <span class=\"string\">\" - \"</span> + err.message + <span class=\"string\">\" in \"</span> + err.filename);</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 结束 worker</span></span><br><span class=\"line\">worker.terminate()</span><br></pre></td></tr></tbody></table></figure></li></ol><h2 id=\"worker-新线程\"><a href=\"#worker-新线程\" class=\"headerlink\" title=\"worker 新线程\"></a>worker 新线程</h2><blockquote><p>全局变量 this 省略</p></blockquote><ol><li>发送数据：<code>postMessage(data)</code></li><li>接收数据：<code>onmessage = fn</code></li><li>加载脚本：<code>importScripts('a.js', 'b.js')</code></li><li>结束自身：<code>self.close()</code></li></ol><h2 id=\"应用场景\"><a href=\"#应用场景\" class=\"headerlink\" title=\"应用场景\"></a>应用场景</h2><ul><li>用来进行处理大量的复杂计算而不挂起主线程</li><li>可以在 worker 中通过 <code>importScripts(url)</code>加载其它脚本文件</li><li>可以使用 <code>setTimeout()、clearTimeout()、setInterval()、clearInterval()</code></li><li>可以使用 <code>XMLHttpRequest</code> 来发送请求</li><li>可以访问 <code>navigator、location</code> 对象</li></ul><h2 id=\"操作限制\"><a href=\"#操作限制\" class=\"headerlink\" title=\"操作限制\"></a>操作限制</h2><blockquote><p>Worker 线程脚本</p></blockquote><ul><li><strong>脚本限制</strong>：无法调用 alert、confirm 等函数</li><li><strong>同源限制</strong>：不能跨域加载脚本文件，它必须与主线程的脚本文件同源</li><li><strong>通信限制</strong>：Worker 线程和主线程不在同一个上下文环境，它们不能直接通信</li><li><strong>文件限制</strong>：无法读取本地文件，所加载的脚本必须 来自网络或通过服务器打开</li><li><strong>DOM 限制</strong><ul><li>无法访问 DOM 节点</li><li>无法访问 window、document 等全局变量</li></ul></li></ul><h2 id=\"分类\"><a href=\"#分类\" class=\"headerlink\" title=\"分类\"></a>分类</h2><ul><li><strong>专用线程</strong><ul><li>特点：只能被创建它的页面访问，随当前页面的关闭而结束</li><li>通信：通过 onmessage()、postmessage()</li></ul></li><li><p><strong>共享线程</strong></p><ul><li>特点：可以被多个页面访问</li><li>通信：connect 后通过 port 属性</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ---------- 专用线程 -----------</span></span><br><span class=\"line\"><span class=\"comment\">// 主线程 index.html/script</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> worker = <span class=\"keyword\">new</span> Worker(<span class=\"string\">\"worker.js\"</span>); </span><br><span class=\"line\">worker.postMessage(<span class=\"string\">\"hello world\"</span>);      <span class=\"comment\">// 发送数据</span></span><br><span class=\"line\">worker.onmessage = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>) </span>{   <span class=\"comment\">// 接收数据</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(event.data);             </span><br><span class=\"line\">    worker.terminate();</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 子线程：worker.js </span></span><br><span class=\"line\">onmessage = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>)</span>{          <span class=\"comment\">// 接收数据</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> d = event.data;    </span><br><span class=\"line\">    postMessage(<span class=\"string\">\"已收到：\"</span> + d);        <span class=\"comment\">// 发送数据</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 通过服务器打开文件：直接打开会报错</span></span><br><span class=\"line\">live-server</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ---------- 共享线程 -----------</span></span><br><span class=\"line\"><span class=\"comment\">// 主线程 </span></span><br><span class=\"line\">worker.port.onmessage = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>)</span>{}</span><br><span class=\"line\">worker.port.postMessage(<span class=\"string\">'data'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 子线程 </span></span><br><span class=\"line\">addEventListener(<span class=\"string\">'connect'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>)</span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> port = event.ports[<span class=\"number\">0</span>]</span><br><span class=\"line\">    <span class=\"comment\">// 接收</span></span><br><span class=\"line\">    port.onmessage = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>)</span>{</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(event.data);</span><br><span class=\"line\">    };</span><br><span class=\"line\">    <span class=\"comment\">// 发送</span></span><br><span class=\"line\">    port.postMessage(<span class=\"string\">\"data\"</span>);</span><br><span class=\"line\">    port.start();</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure></li></ul><h1 id=\"五、拖放操作\"><a href=\"#五、拖放操作\" class=\"headerlink\" title=\"五、拖放操作\"></a>五、拖放操作</h1><h2 id=\"事件\"><a href=\"#事件\" class=\"headerlink\" title=\"事件\"></a>事件</h2><blockquote><p>事件对象为 被拖拽的元素、放置的目标元素 (拖放范围)</p></blockquote><ul><li>拖拽元素<ul><li><strong>dragstart</strong>：拖拽开始时触发</li><li><strong>drag</strong>：拖拽过程中连续触发</li><li><strong>dragend</strong>：拖拽结束时触发</li></ul></li><li>目标元素<ul><li><strong>dragenter</strong>：拖入元素时触发</li><li><strong>dragover</strong>：拖拽元素时连续触发</li><li><strong>dragleave</strong>：元素拖出时触发</li><li><strong>drop</strong>：拖入后释放鼠标时触发</li></ul></li><li>执行顺序<ul><li>drop 触发：<code>dragstart、drag、dragenter、dragover、drop、dragend</code></li><li>drop 不触发：<code>dragstart、drag、dragenter、dragover、dragleave、dragend</code></li></ul></li></ul><h2 id=\"dataTransfer-对象\"><a href=\"#dataTransfer-对象\" class=\"headerlink\" title=\"dataTransfer 对象\"></a>dataTransfer 对象</h2><blockquote><p>拖动时回调函数接受的事件参数。注意火狐浏览器下必须设置它的 setData 方法才可以拖拽除图片外的其他标签</p></blockquote><ul><li>属性<ul><li><strong>dropEffect</strong>：元素行为和相应光标</li><li><strong>effectAllowed</strong>：允许拖动元素的光标样式</li><li><strong>files</strong>：被拖放文件的 FileList 对象</li></ul></li><li><p>方法</p><ul><li><strong>getData</strong>：读取对象中的数据</li><li><strong>setData</strong>：在对象上储存数据</li><li><strong>clearData</strong>：清除对象中的数据</li><li><strong>setDragImage</strong>：指定拖动时显示的图像</li><li><strong>addElement</strong>：添加元素和被拖拽元素一同被拖拽</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">img,ondragstart = <span class=\"function\"><span class=\"params\">event</span> =></span> {</span><br><span class=\"line\">    event.dataTransfer.setData(<span class=\"string\">\"text/plain\"</span>, event.target.id)</span><br><span class=\"line\">}</span><br><span class=\"line\">div.drop = <span class=\"function\"><span class=\"params\">event</span> =></span> {</span><br><span class=\"line\">    event.preventDefault();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> imgId = event.dataTransfer.getData(<span class=\"string\">\"text/plain\"</span>)</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure></li></ul><h2 id=\"拖拽上传预览图片\"><a href=\"#拖拽上传预览图片\" class=\"headerlink\" title=\"拖拽上传预览图片\"></a>拖拽上传预览图片</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> list = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'list'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> box = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'box'</span>);</span><br><span class=\"line\">    box.ondragenter = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.innerHTML = <span class=\"string\">'可以释放'</span>;</span><br><span class=\"line\">    };</span><br><span class=\"line\">    box.ondragover = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>)</span>{</span><br><span class=\"line\">        e.preventDefault();</span><br><span class=\"line\">    };</span><br><span class=\"line\">    box.ondragleave = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.innerHTML = <span class=\"string\">'请拖拽到此区域'</span>;</span><br><span class=\"line\">    };</span><br><span class=\"line\">    box.ondrop = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>)</span>{</span><br><span class=\"line\">        <span class=\"comment\">// 连续触发事件阻止冒泡</span></span><br><span class=\"line\">        event.preventDefault(); </span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 获取数据对象</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> fs = event.dataTransfer.files;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>; i &gt; fs.length; i++){</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 读取文件信息的接口对象</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> fr = <span class=\"keyword\">new</span> FileReader();  </span><br><span class=\"line\">            <span class=\"keyword\">if</span>( fs[i].type.indexOf(<span class=\"string\">'image'</span>)!=<span class=\"number\">-1</span> ){</span><br><span class=\"line\">                fr.readAsDataURL( fs[i] );</span><br><span class=\"line\">                fr.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> oLi = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'li'</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> oImg = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'img'</span>);</span><br><span class=\"line\">                    oImg.src = <span class=\"keyword\">this</span>.result;</span><br><span class=\"line\">                    oLi.appendChild( oImg );</span><br><span class=\"line\">                    list.appendChild( oLi );</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }<span class=\"keyword\">else</span>{</span><br><span class=\"line\">                alert(<span class=\"string\">'请拖放图片指定格式'</span>);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h1 id=\"六、地理定位\"><a href=\"#六、地理定位\" class=\"headerlink\" title=\"六、地理定位\"></a>六、地理定位</h1><blockquote><p>常用的地理位置定位方式：HTML5、百度地图、高德地图</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// HTML5 定位</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getLocation</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> options = {</span><br><span class=\"line\">          enableHighAccuracy: <span class=\"literal\">true</span>,  <span class=\"comment\">// 是否要求高精度</span></span><br><span class=\"line\">          maximumAge: <span class=\"number\">1000</span>           <span class=\"comment\">// 应用缓存时间</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (navigator.geolocation) {</span><br><span class=\"line\">        navigator.geolocation.getCurrentPosition(<span class=\"function\"><span class=\"params\">position</span> =></span>  {</span><br><span class=\"line\">            <span class=\"keyword\">var</span> latitude = position.coords.latitude;    </span><br><span class=\"line\">            <span class=\"keyword\">var</span> longitude = position.coords.longitude;  </span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">`纬度：<span class=\"subst\">${latitude}</span>, 经度：<span class=\"subst\">${longitude}</span>`</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        }, error => {</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(error)</span><br><span class=\"line\">            <span class=\"comment\">// 常见错误：需要用户授权、仅限 HTTPS、需要翻墙 (谷歌浏览器)</span></span><br><span class=\"line\">        }, options);</span><br><span class=\"line\"></span><br><span class=\"line\">    } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">        <span class=\"comment\">// 浏览器不支持</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 百度地图：申请密钥之后以参数形式引入，然后即可调用</span></span><br><span class=\"line\"><span class=\"comment\">// script src=\"http://api.map.baidu.com/api?v=2.0&ak=wmwHFMPxi66GlPBVUrdgEhDzbLUqlSrM\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> map = <span class=\"keyword\">new</span> BMap.Map(<span class=\"string\">\"allmap\"</span>); <span class=\"comment\">// 创建Map实例</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> point = <span class=\"keyword\">new</span> BMap.Point(<span class=\"number\">116.404</span>, <span class=\"number\">39.915</span>)</span><br><span class=\"line\">map.centerAndZoom(point, <span class=\"number\">15</span>); <span class=\"comment\">// 初始化地图，设置中心点坐标和地图级别</span></span><br><span class=\"line\"><span class=\"comment\">// map.centerAndZoom(\"上海\",15);  </span></span><br><span class=\"line\"></span><br><span class=\"line\">map.addControl(<span class=\"keyword\">new</span> BMap.MapTypeControl()); <span class=\"comment\">// 添加地图类型控件</span></span><br><span class=\"line\">map.setCurrentCity(<span class=\"string\">\"北京\"</span>);      <span class=\"comment\">// 设置地图显示的城市</span></span><br><span class=\"line\">map.enableScrollWheelZoom(<span class=\"literal\">true</span>); <span class=\"comment\">// 开启鼠标滚轮缩放</span></span><br></pre></td></tr></tbody></table></figure><h1 id=\"七、全屏模式\"><a href=\"#七、全屏模式\" class=\"headerlink\" title=\"七、全屏模式\"></a>七、全屏模式</h1><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 启动全屏模式  </span></span><br><span class=\"line\">launchFullScreen(<span class=\"built_in\">document</span>.documentElement);   <span class=\"comment\">// 整个页面  </span></span><br><span class=\"line\">launchFullScreen(<span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"video\"</span>)); <span class=\"comment\">// 单独元素 </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 取消全屏  </span></span><br><span class=\"line\">cancelFullscreen(); </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">launchFullScreen</span>(<span class=\"params\">element</span>) </span>{  </span><br><span class=\"line\">    <span class=\"keyword\">if</span>(element.requestFullScreen) {  </span><br><span class=\"line\">        element.requestFullScreen();  </span><br><span class=\"line\">    } <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(element.mozRequestFullScreen) {  </span><br><span class=\"line\">        element.mozRequestFullScreen();  </span><br><span class=\"line\">    } <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(element.webkitRequestFullScreen) {  </span><br><span class=\"line\">        element.webkitRequestFullScreen();  </span><br><span class=\"line\">    }  </span><br><span class=\"line\">}  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">cancelFullscreen</span>(<span class=\"params\"></span>) </span>{  </span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"built_in\">document</span>.cancelFullScreen) {  </span><br><span class=\"line\">        <span class=\"built_in\">document</span>.cancelFullScreen();  </span><br><span class=\"line\">    } <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"built_in\">document</span>.mozCancelFullScreen) {  </span><br><span class=\"line\">        <span class=\"built_in\">document</span>.mozCancelFullScreen();  </span><br><span class=\"line\">    } <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"built_in\">document</span>.webkitCancelFullScreen) {  </span><br><span class=\"line\">        <span class=\"built_in\">document</span>.webkitCancelFullScreen();  </span><br><span class=\"line\">    }  </span><br><span class=\"line\">}  </span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">// 全屏元素</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fullscreenEle = <span class=\"built_in\">document</span>.fullscreenElement ||</span><br><span class=\"line\">                    <span class=\"built_in\">document</span>.mozFullScreenElement ||</span><br><span class=\"line\">                    <span class=\"built_in\">document</span>.webkitFullscreenElement;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 是否全屏</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> isFullscreen = <span class=\"built_in\">document</span>.fullscreenEnabled ||</span><br><span class=\"line\">                    <span class=\"built_in\">window</span>.fullScreen ||</span><br><span class=\"line\">                    <span class=\"built_in\">document</span>.webkitIsFullScreen ||</span><br><span class=\"line\">                    <span class=\"built_in\">document</span>.msFullscreenEnabled;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 全屏事件</span></span><br><span class=\"line\"><span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">'fullscreenchange'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{ })</span><br><span class=\"line\"><span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">'fullscreenerror'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{ })</span><br></pre></td></tr></tbody></table></figure><h1 id=\"八、存储方式\"><a href=\"#八、存储方式\" class=\"headerlink\" title=\"八、存储方式\"></a>八、存储方式</h1><blockquote><p>客户端存储方式：localStorage、sessionStorage、cookie、UserData、webSQL、indexeddb、HTML5 离线存储等</p></blockquote><h2 id=\"离线存储\"><a href=\"#离线存储\" class=\"headerlink\" title=\"离线存储\"></a>离线存储</h2><blockquote><p>Application Cache 应用程序缓存，常用于存储网页</p></blockquote><ul><li>优势<ul><li>加载快：已缓存资源加载速度块</li><li>离线浏览：用户可以在应用离线时使用</li><li>减少服务器负载：浏览器只从服务器下载更新过的资源</li></ul></li><li><p>使用</p><ul><li>html 标签添加 manifest 属性：html manifest=”./js/demo.manifest”</li><li>编写 manifest 文件：用于告知浏览器需要缓存和不需要缓存的内容</li></ul><figure class=\"highlight plain\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CACHE MANIFEST</span><br><span class=\"line\">#version 1.1   // 版本号</span><br><span class=\"line\">CACHE:</span><br><span class=\"line\">    html/index.html   // 首次下载后需要缓存的文件</span><br><span class=\"line\">NETWORK:</span><br><span class=\"line\">    js/jquery.js      // 需要与服务器的连接，不需要缓存的文件</span><br><span class=\"line\">FALLBACK: </span><br><span class=\"line\">    html/index.html   // 当页面无法访问时的回退页面</span><br></pre></td></tr></tbody></table></figure></li></ul><h2 id=\"IndexedDB\"><a href=\"#IndexedDB\" class=\"headerlink\" title=\"IndexedDB\"></a>IndexedDB</h2><blockquote><p>Indexed Database API，是在浏览器中保存结构化数据的一种数据库</p></blockquote><ul><li>有需要再研究：<a href=\"https://www.cnblogs.com/best/p/6084209.html\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">https://www.cnblogs.com/best/p/6084209.html</a></li></ul><h1 id=\"九、其它\"><a href=\"#九、其它\" class=\"headerlink\" title=\"九、其它\"></a>九、其它</h1><ul><li>普通元素<ul><li>新增标签：<code>nav、header、aside、section、footer、canvas、video、output、...</code></li><li>新增属性：<code>contextmenu、contentEditable、hidden、draggable、data-*</code></li></ul></li><li>表单元素<ul><li>输入验证：<code>邮箱、地址、日期、数字、电话、范围、搜索、颜色</code></li><li>新增属性：<code>required、pattern、autofocus、autocomplete、novalidate、multiple</code></li></ul></li><li>超链接<ul><li>短信：<code>a href='sms:15919218899'</code></li><li>电话：<code>a href=\"tel:15919218899\"</code></li><li>邮件：<code>a href=\"mailto:99519876@qq.com\"</code></li><li>地图：<code>a href=\"http://map.baidu.com/mobile/search...\"</code></li><li>QQ客服：<code>a target=\"_blank\" href=\"http://wpa.qq.com/msgrd?v=3&...\"</code></li></ul></li><li>History<ul><li>功能：实现无刷新更新地址</li><li>API：<code>history.pushState、history.replaceState</code></li></ul></li></ul><!-- rebuild by neat --></body></html>","site":{"data":{"next":{"override":false,"cache":{"enable":true},"favicon":{"small":"/images/favicon-16.ico","medium":"/images/favicon-32.ico","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"rss":"/atom.xml","footer":{"since":2019,"icon":{"name":"snowflake-o","animated":false,"color":"#808080"},"copyright":"chuangge","powered":{"enable":false,"version":true},"theme":{"enable":false,"version":true},"beian":{"enable":false,"icp":null}},"creative_commons":{"license":"by-nc-sa","sidebar":false,"post":false},"canonical":true,"seo":false,"index_with_subtitle":false,"exturl":false,"menu":{"home":"/ || home  //首页","tags":"/tags/ || tags  //标签","categories":"/categories/ || th   //分类","archives":"/archives/ || archive //归档"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":{"GitHub":"https://github.com/ || github","StackOverflow":"https://stackoverflow.com/ || stack-overflow"},"social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"友情链接","links_layout":"inline","links":{"个人简历":"https://chuanggefighting.github.io/project/","印记中文":"https://www.docschina.org/","在线工具":"http://tool.lu/","Learn Anything":"https://learn-anything.xyz/"},"avatar":{"url":"/images/chuang.png","rounded":true,"opacity":1,"rotated":true},"toc":{"enable":true,"number":true,"wrap":false,"max_depth":6},"sidebar":{"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"read_more_btn":true,"post_meta":{"item_text":true,"created_at":true,"updated_at":{"enabled":true,"another_day":true},"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":true,"awl":4,"wpm":275},"codeblock":{"border_radius":null,"copy_button":{"enable":false,"show_result":false}},"reward":{"enable":false},"related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_edit":{"enable":false,"url":"https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name"},"disable_baidu_tranformation":false,"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"font":{"enable":true,"host":"//fonts.proxy.ustclug.org","global":{"external":true,"family":"Lato","size":16},"headings":{"external":true,"family":"Roboto Slab","size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":"Lobster Two","size":24},"codes":{"external":true,"family":"Roboto Mono","size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css","copy_tex":{"enable":false,"copy_tex_js":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js","copy_tex_css":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css"}}},"pdf":{"enable":false,"per_page":true,"height":"500px","pdfobject":{"cdn":"//cdn.jsdelivr.net/npm/pdfobject@2.1.1/pdfobject.min.js"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":true,"appid":"snOvapuSplYTVflf5p9Ml9JX-gzGzoHsz","appkey":"5ABGdfyEdAtu6lTXdGdo7hf9","notify":false,"verify":false,"placeholder":"ヾﾉ≧∀≦)o 来呀！吐槽一番吧！","avatar":"mm","guest_info":"nick,mail,link","pageSize":10,"visitor":false,"comment_count":true},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"gitalk":{"enable":false,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true},"needmoreshare2":{"enable":true,"postbottom":{"enable":true,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null,"security":false,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":true,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":true,"pace_theme":"pace-theme-center-simple","canvas_nest":{"enable":true,"onmobile":true,"color":"0,0,255","opacity":0.5,"zIndex":-1,"count":99},"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"canvas_nest_nomobile":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"leancloud":null,"valine":null,"gitalk_js":null,"gitalk_css":null,"md5":null},"css":"css","js":"js","images":"images","passage_end_tag":{"enabled":true},"daovoice":true,"daovoice_app_id":"2ed51855"}}},"excerpt":"","more":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><h1 id=\"一、audio、video\"><a href=\"#一、audio、video\" class=\"headerlink\" title=\"一、audio、video\"></a>一、audio、video</h1><blockquote><p>支持的格式：Ogg、MP3、WAV</p></blockquote><h2 id=\"基础使用\"><a href=\"#基础使用\" class=\"headerlink\" title=\"基础使用\"></a>基础使用</h2><div align=\"center\"><br><img src=\"images/mobile/media.png\" alt=\"media\"><br></div><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// var audio = new Audio(\"test.mp3\");</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> audio = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"audio\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 资源属性</span></span><br><span class=\"line\">audio.load()         <span class=\"comment\">// 重新加载</span></span><br><span class=\"line\">audio.currentSrc     <span class=\"comment\">// 当前资源地址</span></span><br><span class=\"line\">audio.src = value      <span class=\"comment\">// 设置当前资源地址</span></span><br><span class=\"line\">audio.canPlayType(type)  <span class=\"comment\">// 是否能播放某种格式的资源</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 播放状态属性</span></span><br><span class=\"line\">audio.currentTime = value  <span class=\"comment\">// 当前播放的位置</span></span><br><span class=\"line\">audio.startTime/duration/loop/autoPlay</span><br><span class=\"line\">audio.played/paused/ended/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 状态控制</span></span><br><span class=\"line\">audio.play();          <span class=\"comment\">// 播放</span></span><br><span class=\"line\">audio.pause();         <span class=\"comment\">// 暂停</span></span><br><span class=\"line\">audio.controls;        <span class=\"comment\">// 默认控制条</span></span><br><span class=\"line\">audio.volume = value;  <span class=\"comment\">// 音量</span></span><br><span class=\"line\">audio.muted = value;   <span class=\"comment\">// 静音</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 事件：loadstart、progress、</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 监听开始播放</span></span><br><span class=\"line\">audio.addEventListener(<span class=\"string\">'pause'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'开始播放'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"comment\">// 监听暂停播放</span></span><br><span class=\"line\">audio.addEventListener(<span class=\"string\">'pause'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'暂停播放'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"comment\">// 监听媒体数据已经加载完成，</span></span><br><span class=\"line\">audio.addEventListener(<span class=\"string\">'loadedmetadata'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'音频时长：'</span>+ e.target.duration)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">// 监听时间改变，durationchange 资源长度，volumechange 音量</span></span><br><span class=\"line\">audio.addEventListener(<span class=\"string\">'timeupdate'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> t = e.target</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'剩余时长：'</span>(t.duration - t.currentTime))</span><br><span class=\"line\">&#125;, <span class=\"literal\">false</span>);  </span><br><span class=\"line\"><span class=\"comment\">// 监听播放完成</span></span><br><span class=\"line\">audio.addEventListener(<span class=\"string\">'ended'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'播放完成'</span>)</span><br><span class=\"line\">&#125;, <span class=\"literal\">false</span>);   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> video = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'video'</span>);</span><br><span class=\"line\"><span class=\"comment\">// 事件：play、pause、progress、error</span></span><br><span class=\"line\">video.addEventListener(<span class=\"string\">'play'</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; &#125;);</span><br></pre></td></tr></table></figure><h2 id=\"自动播放\"><a href=\"#自动播放\" class=\"headerlink\" title=\"自动播放\"></a>自动播放</h2><blockquote><p>ios、Android、微信为了节省流量而规定忽视 autoplay 属性</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ios、Android：循环播放失效时方案相似，</span></span><br><span class=\"line\"><span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">'touchstart'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'audio'</span>).play();</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 微信</span></span><br><span class=\"line\"><span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">'WeixinJSBridgeReady'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'audios'</span>).play()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"comment\">// 针对苹果的手机微信端</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">autoPlayVideo</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    wx.config(&#123;</span><br><span class=\"line\">        debug:<span class=\"literal\">false</span>,</span><br><span class=\"line\">        appId:<span class=\"string\">\"\"</span>,</span><br><span class=\"line\">        timestamp:<span class=\"number\">1</span>,</span><br><span class=\"line\">        nonceStr:<span class=\"string\">\"\"</span>,</span><br><span class=\"line\">        signature:<span class=\"string\">\"\"</span>,</span><br><span class=\"line\">        jsApiList:[]</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    wx.ready(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> autoplayVideo = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"audio\"</span>);</span><br><span class=\"line\">        autoplayVideo.play()</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">## 用户权限</span><br><span class=\"line\">&gt; navigator.getUserMedia 可以提示用户需要权限去使用像摄像头、麦克风等媒体设备</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 兼容写法</span></span><br><span class=\"line\">navigator.getMedia = (navigator.getUserMedia ||</span><br><span class=\"line\">    navigator.webkitGetUserMedia ||</span><br><span class=\"line\">    navigator.mozGetUserMedia ||</span><br><span class=\"line\">    navigator.msGetUserMedia);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 获取用户摄像头并提供拍照功能：video、canvas、button</span></span><br><span class=\"line\"><span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">\"DOMContentLoaded\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 获取元素，创建设置等等</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"canvas\"</span>),</span><br><span class=\"line\">            context = canvas.getContext(<span class=\"string\">\"2d\"</span>),</span><br><span class=\"line\">            video = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"video\"</span>),</span><br><span class=\"line\">            videoObj = &#123; <span class=\"string\">\"video\"</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">            errBack = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">error</span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Video capture error: \"</span>, error.code);</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 添加video 监听器</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(navigator.getUserMedia) &#123; <span class=\"comment\">// 标准</span></span><br><span class=\"line\">        navigator.getUserMedia(videoObj, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">stream</span>) </span>&#123;</span><br><span class=\"line\">            video.src = stream;</span><br><span class=\"line\">            video.play();</span><br><span class=\"line\">        &#125;, errBack);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(navigator.webkitGetUserMedia) &#123; <span class=\"comment\">// WebKit 前缀</span></span><br><span class=\"line\">        navigator.webkitGetUserMedia(videoObj, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">stream</span>)</span>&#123;</span><br><span class=\"line\">            video.src = <span class=\"built_in\">window</span>.webkitURL.createObjectURL(stream);</span><br><span class=\"line\">            video.play();</span><br><span class=\"line\">        &#125;, errBack);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(navigator.mozGetUserMedia) &#123;    <span class=\"comment\">// Firefox 前缀</span></span><br><span class=\"line\">        navigator.mozGetUserMedia(videoObj, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">stream</span>)</span>&#123;</span><br><span class=\"line\">            video.src = <span class=\"built_in\">window</span>.URL.createObjectURL(stream);</span><br><span class=\"line\">            video.play();</span><br><span class=\"line\">        &#125;, errBack);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"snap\"</span>).addEventListener(<span class=\"string\">\"click\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        context.drawImage(video, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">640</span>, <span class=\"number\">480</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;, <span class=\"literal\">false</span>)</span><br></pre></td></tr></table></figure><h1 id=\"二、Canvas\"><a href=\"#二、Canvas\" class=\"headerlink\" title=\"二、Canvas\"></a>二、Canvas</h1><blockquote><p>提供了一系列绘图方法的对象</p></blockquote><h2 id=\"绘制图形\"><a href=\"#绘制图形\" class=\"headerlink\" title=\"绘制图形\"></a>绘制图形</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> canvas = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"canvas\"</span>); </span><br><span class=\"line\"><span class=\"keyword\">if</span>(canvas.getContext)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> ctx = canvas.getContext(<span class=\"string\">\"2d\"</span>); </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 线段 </span></span><br><span class=\"line\">ctx.moveTo(<span class=\"number\">100</span>, <span class=\"number\">20</span>); </span><br><span class=\"line\">ctx.lineTo(<span class=\"number\">200</span>, <span class=\"number\">40</span>);</span><br><span class=\"line\">ctx.lineWidth = <span class=\"number\">5</span>; </span><br><span class=\"line\">ctx.strokeStyle = <span class=\"string\">'#CC0000'</span>; </span><br><span class=\"line\">ctx.stroke();    <span class=\"comment\">// 绘制</span></span><br><span class=\"line\"></span><br><span class=\"line\">ctx.beginPath();</span><br><span class=\"line\">ctx.strokeStyle = <span class=\"string\">\"#ff0000\"</span>;</span><br><span class=\"line\">ctx.lineTo(<span class=\"number\">20</span>, <span class=\"number\">20</span>);</span><br><span class=\"line\">ctx.lineTo(<span class=\"number\">20</span>, <span class=\"number\">70</span>);</span><br><span class=\"line\">ctx.lineTo(<span class=\"number\">70</span>, <span class=\"number\">70</span>);</span><br><span class=\"line\">ctx.closePath();</span><br><span class=\"line\">ctx.stroke();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 路径：填充</span></span><br><span class=\"line\">ctx.beginPath();</span><br><span class=\"line\">ctx.arc(<span class=\"number\">240</span>, <span class=\"number\">20</span>, <span class=\"number\">50</span>, <span class=\"number\">0</span>, <span class=\"built_in\">Math</span>.PI/<span class=\"number\">2</span> , <span class=\"literal\">false</span>);</span><br><span class=\"line\">ctx.closePath();</span><br><span class=\"line\">ctx.fillStyle = <span class=\"string\">'#0000ff'</span>;</span><br><span class=\"line\">ctx.fill();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 路径：填充 + 边框</span></span><br><span class=\"line\">ctx.beginPath();</span><br><span class=\"line\">ctx.arc(<span class=\"number\">300</span>, <span class=\"number\">20</span>, <span class=\"number\">50</span>, <span class=\"number\">0</span>, <span class=\"built_in\">Math</span>.PI/<span class=\"number\">2</span> , <span class=\"literal\">false</span>);</span><br><span class=\"line\">ctx.strokeStyle = <span class=\"string\">'#0000ff'</span>;</span><br><span class=\"line\">ctx.closePath();</span><br><span class=\"line\">ctx.stroke();</span><br><span class=\"line\">ctx.fillStyle = <span class=\"string\">'rgba(0,0,255,0.2)'</span>;</span><br><span class=\"line\">ctx.fill();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 贝塞尔曲线</span></span><br><span class=\"line\">ctx.moveTo(<span class=\"number\">300</span>, <span class=\"number\">300</span>);</span><br><span class=\"line\">ctx.lineWidth = <span class=\"number\">10</span>;</span><br><span class=\"line\">ctx.strokeStyle = <span class=\"string\">\"skyblue\"</span>;</span><br><span class=\"line\">ctx.bezierCurveTo(<span class=\"number\">300</span>, <span class=\"number\">50</span>, <span class=\"number\">500</span>, <span class=\"number\">50</span>, <span class=\"number\">150</span>, <span class=\"number\">150</span>);</span><br><span class=\"line\">ctx.stroke();</span><br><span class=\"line\">      </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 蓝色填充矩形</span></span><br><span class=\"line\">ctx.fillStyle = <span class=\"string\">\"#0000ff\"</span>;</span><br><span class=\"line\">ctx.fillRect(<span class=\"number\">20</span>, <span class=\"number\">100</span>, <span class=\"number\">60</span>, <span class=\"number\">60</span>);    </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 红色边框矩形</span></span><br><span class=\"line\">ctx.lineWidth = <span class=\"number\">10</span>; </span><br><span class=\"line\">ctx.strokeRect(<span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">60</span>, <span class=\"number\">60</span>);  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 圆</span></span><br><span class=\"line\">ctx.fillStyle = <span class=\"string\">\"#0000ff\"</span>;</span><br><span class=\"line\">ctx.strokeStyle = <span class=\"string\">\"#ff0000\"</span>;</span><br><span class=\"line\">ctx.beginPath();</span><br><span class=\"line\">ctx.arc(<span class=\"number\">50</span>, <span class=\"number\">240</span>, <span class=\"number\">40</span>, <span class=\"number\">0</span>, <span class=\"number\">2</span>*<span class=\"built_in\">Math</span>.PI, <span class=\"literal\">true</span>);</span><br><span class=\"line\">ctx.closePath();</span><br><span class=\"line\">ctx.stroke();</span><br><span class=\"line\">ctx.fill();</span><br><span class=\"line\"></span><br><span class=\"line\">ctx.fillStyle = <span class=\"string\">\"pink\"</span>;</span><br><span class=\"line\">ctx.beginPath();</span><br><span class=\"line\">ctx.arc(<span class=\"number\">50</span>, <span class=\"number\">240</span>, <span class=\"number\">20</span>, <span class=\"number\">0</span>, <span class=\"number\">2</span>*<span class=\"built_in\">Math</span>.PI, <span class=\"literal\">true</span>);</span><br><span class=\"line\">ctx.closePath();</span><br><span class=\"line\">ctx.fill();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 文本</span></span><br><span class=\"line\">ctx.font = <span class=\"string\">\"Bold 20px Arial\"</span>; </span><br><span class=\"line\">ctx.textAlign = <span class=\"string\">\"left\"</span>;</span><br><span class=\"line\">ctx.fillStyle = <span class=\"string\">\"#008600\"</span>; </span><br><span class=\"line\">ctx.fillText(<span class=\"string\">\"Hello!\"</span>, <span class=\"number\">10</span>, <span class=\"number\">50</span>); </span><br><span class=\"line\">ctx.strokeText(<span class=\"string\">\"Hello!\"</span>, <span class=\"number\">10</span>, <span class=\"number\">100</span>); </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 渐变色</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> grd = ctx.createLinearGradient(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">300</span>, <span class=\"number\">200</span>);</span><br><span class=\"line\">grd.addColorStop(<span class=\"number\">0</span>,<span class=\"string\">\"#ff0000\"</span>);</span><br><span class=\"line\">grd.addColorStop(<span class=\"number\">1</span>,<span class=\"string\">\"#0000ff\"</span>);</span><br><span class=\"line\">ctx.fillStyle = grd;</span><br><span class=\"line\">ctx.fillRect(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">300</span>,<span class=\"number\">200</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 阴影</span></span><br><span class=\"line\">ctx.shadowOffsetX = <span class=\"number\">10</span>; </span><br><span class=\"line\">ctx.shadowOffsetY = <span class=\"number\">10</span>; </span><br><span class=\"line\">ctx.shadowBlur = <span class=\"number\">5</span>; </span><br><span class=\"line\">ctx.shadowColor = <span class=\"string\">\"rgba(0,0,0,0.5)\"</span>; </span><br><span class=\"line\">ctx.fillStyle = <span class=\"string\">\"#CC0000\"</span>; </span><br><span class=\"line\">ctx.fillRect(<span class=\"number\">10</span>, <span class=\"number\">10</span>, <span class=\"number\">200</span>, <span class=\"number\">100</span>);</span><br></pre></td></tr></table></figure><h2 id=\"绘制图像\"><a href=\"#绘制图像\" class=\"headerlink\" title=\"绘制图像\"></a>绘制图像</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// canvas id=\"canvas\" width=\"400\" height=\"400\"</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> canvas = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"canvas\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> ctx = canvas.getContext(<span class=\"string\">\"2d\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> image = <span class=\"keyword\">new</span> Image();</span><br><span class=\"line\">image.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 图片绘制</span></span><br><span class=\"line\">    <span class=\"comment\">// ctx.drawImage(image, 0, 0)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 图片裁剪</span></span><br><span class=\"line\">    ctx.beginPath(); </span><br><span class=\"line\">    ctx.arc(<span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">0</span>, <span class=\"built_in\">Math</span>.PI*<span class=\"number\">2</span>, <span class=\"literal\">true</span>); </span><br><span class=\"line\">    ctx.clip();          </span><br><span class=\"line\">    ctx.drawImage(image, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">image.src = <span class=\"string\">'./mobile-type.png'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 获取图片保存地址</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> src = canvas.toDataURL(<span class=\"string\">'image/png'</span>)</span><br></pre></td></tr></table></figure><h2 id=\"动画效果\"><a href=\"#动画效果\" class=\"headerlink\" title=\"动画效果\"></a>动画效果</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> x = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> y = <span class=\"number\">15</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> speed = <span class=\"number\">5</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">animation</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">window</span>.requestAnimationFrame(animate);</span><br><span class=\"line\">    x += speed;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(x &amp;lt;= <span class=\"number\">0</span> || x &amp;gt;= <span class=\"number\">475</span>)&#123;</span><br><span class=\"line\">        speed = -speed;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    draw()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">draw</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"canvas\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> context = canvas.getContext(<span class=\"string\">\"2d\"</span>);</span><br><span class=\"line\">    context.clearRect(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">500</span>, <span class=\"number\">170</span>);</span><br><span class=\"line\">    context.fillStyle = <span class=\"string\">\"#ff00ff\"</span>;</span><br><span class=\"line\">    context.fillRect(x, y, <span class=\"number\">25</span>, <span class=\"number\">25</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">animation()</span><br></pre></td></tr></table></figure><h2 id=\"像素处理\"><a href=\"#像素处理\" class=\"headerlink\" title=\"像素处理\"></a>像素处理</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 获取图像数据</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> imgData = ctx.getImageData(<span class=\"number\">0</span>, <span class=\"number\">0</span>, canvas.width, canvas.height)</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"comment\">// 处理图像数据</span></span><br><span class=\"line\">filter(imageData);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 重新绘制图像</span></span><br><span class=\"line\">ctx.putImageData(imageData, <span class=\"number\">0</span>, <span class=\"number\">0</span>)</span><br></pre></td></tr></table></figure><h1 id=\"三、WebSocket\"><a href=\"#三、WebSocket\" class=\"headerlink\" title=\"三、WebSocket\"></a>三、WebSocket</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 创建实例</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> socket = <span class=\"keyword\">new</span> WebSocket(<span class=\"string\">'ws://localhost:8080'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 打开 socket</span></span><br><span class=\"line\">socket.onopen = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 发送消息</span></span><br><span class=\"line\">    socket.send(<span class=\"string\">'hello HTML5'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 监听消息</span></span><br><span class=\"line\">    socket.onmessage = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'receive a message'</span>, event)</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 监听关闭</span></span><br><span class=\"line\">    socket.onclose = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">ev</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'socket has closed'</span>, event)</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 关闭 socket</span></span><br><span class=\"line\">    socket.close()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h1 id=\"四、Web-Worker\"><a href=\"#四、Web-Worker\" class=\"headerlink\" title=\"四、Web Worker\"></a>四、Web Worker</h1><h2 id=\"机制\"><a href=\"#机制\" class=\"headerlink\" title=\"机制\"></a>机制</h2><ul><li>在当前 js 的主线程中，通过 Worker 类加载一个 js 文件来开辟一个新的线程</li><li>新线程可以加载 JS 进行大量的复杂运算，同时主线程不需要挂起等待而是执行其它代码</li><li>新线程创建时，它的脚本文件生成的两个对象和一套 API 可以实现主线程和子线程的数据通信<ul><li><strong>worker 对象</strong>：主线程脚本中通过构造函数显式创建，通过实例方法获取</li><li><strong>WorkerGlobalScope 对象</strong>：子线程脚本中隐式创建的全局对象，通过 this 获取</li><li><strong>API 接口</strong>：主线程和子线程脚本间进行数据传输的接口，主要为 postMessage、onmessage</li></ul></li></ul><h2 id=\"Web-主线程\"><a href=\"#Web-主线程\" class=\"headerlink\" title=\"Web 主线程\"></a>Web 主线程</h2><ol><li>创建新线程：<code>var worker = new Worker(url)</code></li><li>发送数据：<code>worker.postMessage(data)</code></li><li>接收数据：<code>worker.onmessage = fn</code></li><li><p>结束新线程：<code>worker.terminate()</code></p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 判断当前浏览器是否支持 web worker</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> (Worker) != <span class=\"string\">\"undefined\"</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> (w) == <span class=\"string\">\"undefined\"</span>) &#123;       </span><br><span class=\"line\">        w = <span class=\"keyword\">new</span> Worker(<span class=\"string\">\"webworker.js\"</span>); </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">    <span class=\"comment\">// 事件处理函数，用来处理后端的 web worker 传递的消息  </span></span><br><span class=\"line\">    w.onmessage = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>) </span>&#123; </span><br><span class=\"line\">        <span class=\"comment\">// do something</span></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123; </span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 加载一个 JS 文件来创建一个 worker，同时返回一个 worker 实例</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> worker = <span class=\"keyword\">new</span> Worker(<span class=\"string\">\"worker.js\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 向 worker 发送数据</span></span><br><span class=\"line\">worker.postMessage()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 接收 worker 发送的数据</span></span><br><span class=\"line\">worker.onmessage = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>)</span>&#123; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 异常处理</span></span><br><span class=\"line\">worker.onerror = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 错误所在的代码文件和行数、错误信息</span></span><br><span class=\"line\">  alert(<span class=\"string\">\"Line #\"</span> + err.lineno + <span class=\"string\">\" - \"</span> + err.message + <span class=\"string\">\" in \"</span> + err.filename);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 结束 worker</span></span><br><span class=\"line\">worker.terminate()</span><br></pre></td></tr></table></figure></li></ol><h2 id=\"worker-新线程\"><a href=\"#worker-新线程\" class=\"headerlink\" title=\"worker 新线程\"></a>worker 新线程</h2><blockquote><p>全局变量 this 省略</p></blockquote><ol><li>发送数据：<code>postMessage(data)</code></li><li>接收数据：<code>onmessage = fn</code></li><li>加载脚本：<code>importScripts(&#39;a.js&#39;, &#39;b.js&#39;)</code></li><li>结束自身：<code>self.close()</code></li></ol><h2 id=\"应用场景\"><a href=\"#应用场景\" class=\"headerlink\" title=\"应用场景\"></a>应用场景</h2><ul><li>用来进行处理大量的复杂计算而不挂起主线程</li><li>可以在 worker 中通过 <code>importScripts(url)</code>加载其它脚本文件</li><li>可以使用 <code>setTimeout()、clearTimeout()、setInterval()、clearInterval()</code></li><li>可以使用 <code>XMLHttpRequest</code> 来发送请求</li><li>可以访问 <code>navigator、location</code> 对象</li></ul><h2 id=\"操作限制\"><a href=\"#操作限制\" class=\"headerlink\" title=\"操作限制\"></a>操作限制</h2><blockquote><p>Worker 线程脚本</p></blockquote><ul><li><strong>脚本限制</strong>：无法调用 alert、confirm 等函数</li><li><strong>同源限制</strong>：不能跨域加载脚本文件，它必须与主线程的脚本文件同源</li><li><strong>通信限制</strong>：Worker 线程和主线程不在同一个上下文环境，它们不能直接通信</li><li><strong>文件限制</strong>：无法读取本地文件，所加载的脚本必须 来自网络或通过服务器打开</li><li><strong>DOM 限制</strong><ul><li>无法访问 DOM 节点</li><li>无法访问 window、document 等全局变量</li></ul></li></ul><h2 id=\"分类\"><a href=\"#分类\" class=\"headerlink\" title=\"分类\"></a>分类</h2><ul><li><strong>专用线程</strong><ul><li>特点：只能被创建它的页面访问，随当前页面的关闭而结束</li><li>通信：通过 onmessage()、postmessage()</li></ul></li><li><p><strong>共享线程</strong></p><ul><li>特点：可以被多个页面访问</li><li>通信：connect 后通过 port 属性</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ---------- 专用线程 -----------</span></span><br><span class=\"line\"><span class=\"comment\">// 主线程 index.html/script</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> worker = <span class=\"keyword\">new</span> Worker(<span class=\"string\">\"worker.js\"</span>); </span><br><span class=\"line\">worker.postMessage(<span class=\"string\">\"hello world\"</span>);      <span class=\"comment\">// 发送数据</span></span><br><span class=\"line\">worker.onmessage = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>) </span>&#123;   <span class=\"comment\">// 接收数据</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(event.data);             </span><br><span class=\"line\">    worker.terminate();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 子线程：worker.js </span></span><br><span class=\"line\">onmessage = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>)</span>&#123;          <span class=\"comment\">// 接收数据</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> d = event.data;    </span><br><span class=\"line\">    postMessage(<span class=\"string\">\"已收到：\"</span> + d);        <span class=\"comment\">// 发送数据</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 通过服务器打开文件：直接打开会报错</span></span><br><span class=\"line\">live-server</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ---------- 共享线程 -----------</span></span><br><span class=\"line\"><span class=\"comment\">// 主线程 </span></span><br><span class=\"line\">worker.port.onmessage = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>)</span>&#123;&#125;</span><br><span class=\"line\">worker.port.postMessage(<span class=\"string\">'data'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 子线程 </span></span><br><span class=\"line\">addEventListener(<span class=\"string\">'connect'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> port = event.ports[<span class=\"number\">0</span>]</span><br><span class=\"line\">    <span class=\"comment\">// 接收</span></span><br><span class=\"line\">    port.onmessage = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(event.data);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// 发送</span></span><br><span class=\"line\">    port.postMessage(<span class=\"string\">\"data\"</span>);</span><br><span class=\"line\">    port.start();</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></li></ul><h1 id=\"五、拖放操作\"><a href=\"#五、拖放操作\" class=\"headerlink\" title=\"五、拖放操作\"></a>五、拖放操作</h1><h2 id=\"事件\"><a href=\"#事件\" class=\"headerlink\" title=\"事件\"></a>事件</h2><blockquote><p>事件对象为 被拖拽的元素、放置的目标元素 (拖放范围)</p></blockquote><ul><li>拖拽元素<ul><li><strong>dragstart</strong>：拖拽开始时触发</li><li><strong>drag</strong>：拖拽过程中连续触发</li><li><strong>dragend</strong>：拖拽结束时触发</li></ul></li><li>目标元素<ul><li><strong>dragenter</strong>：拖入元素时触发</li><li><strong>dragover</strong>：拖拽元素时连续触发</li><li><strong>dragleave</strong>：元素拖出时触发</li><li><strong>drop</strong>：拖入后释放鼠标时触发</li></ul></li><li>执行顺序<ul><li>drop 触发：<code>dragstart、drag、dragenter、dragover、drop、dragend</code></li><li>drop 不触发：<code>dragstart、drag、dragenter、dragover、dragleave、dragend</code></li></ul></li></ul><h2 id=\"dataTransfer-对象\"><a href=\"#dataTransfer-对象\" class=\"headerlink\" title=\"dataTransfer 对象\"></a>dataTransfer 对象</h2><blockquote><p>拖动时回调函数接受的事件参数。注意火狐浏览器下必须设置它的 setData 方法才可以拖拽除图片外的其他标签</p></blockquote><ul><li>属性<ul><li><strong>dropEffect</strong>：元素行为和相应光标</li><li><strong>effectAllowed</strong>：允许拖动元素的光标样式</li><li><strong>files</strong>：被拖放文件的 FileList 对象</li></ul></li><li><p>方法</p><ul><li><strong>getData</strong>：读取对象中的数据</li><li><strong>setData</strong>：在对象上储存数据</li><li><strong>clearData</strong>：清除对象中的数据</li><li><strong>setDragImage</strong>：指定拖动时显示的图像</li><li><strong>addElement</strong>：添加元素和被拖拽元素一同被拖拽</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">img,ondragstart = <span class=\"function\"><span class=\"params\">event</span> =&gt;</span> &#123;</span><br><span class=\"line\">    event.dataTransfer.setData(<span class=\"string\">\"text/plain\"</span>, event.target.id)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">div.drop = <span class=\"function\"><span class=\"params\">event</span> =&gt;</span> &#123;</span><br><span class=\"line\">    event.preventDefault();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> imgId = event.dataTransfer.getData(<span class=\"string\">\"text/plain\"</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id=\"拖拽上传预览图片\"><a href=\"#拖拽上传预览图片\" class=\"headerlink\" title=\"拖拽上传预览图片\"></a>拖拽上传预览图片</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> list = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'list'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> box = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'box'</span>);</span><br><span class=\"line\">    box.ondragenter = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.innerHTML = <span class=\"string\">'可以释放'</span>;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    box.ondragover = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>)</span>&#123;</span><br><span class=\"line\">        e.preventDefault();</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    box.ondragleave = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.innerHTML = <span class=\"string\">'请拖拽到此区域'</span>;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    box.ondrop = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 连续触发事件阻止冒泡</span></span><br><span class=\"line\">        event.preventDefault(); </span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 获取数据对象</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> fs = event.dataTransfer.files;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>; i &amp;gt; fs.length; i++)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 读取文件信息的接口对象</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> fr = <span class=\"keyword\">new</span> FileReader();  </span><br><span class=\"line\">            <span class=\"keyword\">if</span>( fs[i].type.indexOf(<span class=\"string\">'image'</span>)!=<span class=\"number\">-1</span> )&#123;</span><br><span class=\"line\">                fr.readAsDataURL( fs[i] );</span><br><span class=\"line\">                fr.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> oLi = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'li'</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> oImg = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'img'</span>);</span><br><span class=\"line\">                    oImg.src = <span class=\"keyword\">this</span>.result;</span><br><span class=\"line\">                    oLi.appendChild( oImg );</span><br><span class=\"line\">                    list.appendChild( oLi );</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                alert(<span class=\"string\">'请拖放图片指定格式'</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h1 id=\"六、地理定位\"><a href=\"#六、地理定位\" class=\"headerlink\" title=\"六、地理定位\"></a>六、地理定位</h1><blockquote><p>常用的地理位置定位方式：HTML5、百度地图、高德地图</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// HTML5 定位</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getLocation</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> options = &#123;</span><br><span class=\"line\">          enableHighAccuracy: <span class=\"literal\">true</span>,  <span class=\"comment\">// 是否要求高精度</span></span><br><span class=\"line\">          maximumAge: <span class=\"number\">1000</span>           <span class=\"comment\">// 应用缓存时间</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (navigator.geolocation) &#123;</span><br><span class=\"line\">        navigator.geolocation.getCurrentPosition(<span class=\"function\"><span class=\"params\">position</span> =&gt;</span>  &#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> latitude = position.coords.latitude;    </span><br><span class=\"line\">            <span class=\"keyword\">var</span> longitude = position.coords.longitude;  </span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">`纬度：<span class=\"subst\">$&#123;latitude&#125;</span>, 经度：<span class=\"subst\">$&#123;longitude&#125;</span>`</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;, error =&gt; &#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(error)</span><br><span class=\"line\">            <span class=\"comment\">// 常见错误：需要用户授权、仅限 HTTPS、需要翻墙 (谷歌浏览器)</span></span><br><span class=\"line\">        &#125;, options);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 浏览器不支持</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 百度地图：申请密钥之后以参数形式引入，然后即可调用</span></span><br><span class=\"line\"><span class=\"comment\">// script src=\"http://api.map.baidu.com/api?v=2.0&amp;ak=wmwHFMPxi66GlPBVUrdgEhDzbLUqlSrM\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> map = <span class=\"keyword\">new</span> BMap.Map(<span class=\"string\">\"allmap\"</span>); <span class=\"comment\">// 创建Map实例</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> point = <span class=\"keyword\">new</span> BMap.Point(<span class=\"number\">116.404</span>, <span class=\"number\">39.915</span>)</span><br><span class=\"line\">map.centerAndZoom(point, <span class=\"number\">15</span>); <span class=\"comment\">// 初始化地图，设置中心点坐标和地图级别</span></span><br><span class=\"line\"><span class=\"comment\">// map.centerAndZoom(\"上海\",15);  </span></span><br><span class=\"line\"></span><br><span class=\"line\">map.addControl(<span class=\"keyword\">new</span> BMap.MapTypeControl()); <span class=\"comment\">// 添加地图类型控件</span></span><br><span class=\"line\">map.setCurrentCity(<span class=\"string\">\"北京\"</span>);      <span class=\"comment\">// 设置地图显示的城市</span></span><br><span class=\"line\">map.enableScrollWheelZoom(<span class=\"literal\">true</span>); <span class=\"comment\">// 开启鼠标滚轮缩放</span></span><br></pre></td></tr></table></figure><h1 id=\"七、全屏模式\"><a href=\"#七、全屏模式\" class=\"headerlink\" title=\"七、全屏模式\"></a>七、全屏模式</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 启动全屏模式  </span></span><br><span class=\"line\">launchFullScreen(<span class=\"built_in\">document</span>.documentElement);   <span class=\"comment\">// 整个页面  </span></span><br><span class=\"line\">launchFullScreen(<span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"video\"</span>)); <span class=\"comment\">// 单独元素 </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 取消全屏  </span></span><br><span class=\"line\">cancelFullscreen(); </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">launchFullScreen</span>(<span class=\"params\">element</span>) </span>&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">if</span>(element.requestFullScreen) &#123;  </span><br><span class=\"line\">        element.requestFullScreen();  </span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(element.mozRequestFullScreen) &#123;  </span><br><span class=\"line\">        element.mozRequestFullScreen();  </span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(element.webkitRequestFullScreen) &#123;  </span><br><span class=\"line\">        element.webkitRequestFullScreen();  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">cancelFullscreen</span>(<span class=\"params\"></span>) </span>&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"built_in\">document</span>.cancelFullScreen) &#123;  </span><br><span class=\"line\">        <span class=\"built_in\">document</span>.cancelFullScreen();  </span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"built_in\">document</span>.mozCancelFullScreen) &#123;  </span><br><span class=\"line\">        <span class=\"built_in\">document</span>.mozCancelFullScreen();  </span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"built_in\">document</span>.webkitCancelFullScreen) &#123;  </span><br><span class=\"line\">        <span class=\"built_in\">document</span>.webkitCancelFullScreen();  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">// 全屏元素</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fullscreenEle = <span class=\"built_in\">document</span>.fullscreenElement ||</span><br><span class=\"line\">                    <span class=\"built_in\">document</span>.mozFullScreenElement ||</span><br><span class=\"line\">                    <span class=\"built_in\">document</span>.webkitFullscreenElement;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 是否全屏</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> isFullscreen = <span class=\"built_in\">document</span>.fullscreenEnabled ||</span><br><span class=\"line\">                    <span class=\"built_in\">window</span>.fullScreen ||</span><br><span class=\"line\">                    <span class=\"built_in\">document</span>.webkitIsFullScreen ||</span><br><span class=\"line\">                    <span class=\"built_in\">document</span>.msFullscreenEnabled;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 全屏事件</span></span><br><span class=\"line\"><span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">'fullscreenchange'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; &#125;)</span><br><span class=\"line\"><span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">'fullscreenerror'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; &#125;)</span><br></pre></td></tr></table></figure><h1 id=\"八、存储方式\"><a href=\"#八、存储方式\" class=\"headerlink\" title=\"八、存储方式\"></a>八、存储方式</h1><blockquote><p>客户端存储方式：localStorage、sessionStorage、cookie、UserData、webSQL、indexeddb、HTML5 离线存储等</p></blockquote><h2 id=\"离线存储\"><a href=\"#离线存储\" class=\"headerlink\" title=\"离线存储\"></a>离线存储</h2><blockquote><p>Application Cache 应用程序缓存，常用于存储网页</p></blockquote><ul><li>优势<ul><li>加载快：已缓存资源加载速度块</li><li>离线浏览：用户可以在应用离线时使用</li><li>减少服务器负载：浏览器只从服务器下载更新过的资源</li></ul></li><li><p>使用</p><ul><li>html 标签添加 manifest 属性：html manifest=”./js/demo.manifest”</li><li>编写 manifest 文件：用于告知浏览器需要缓存和不需要缓存的内容</li></ul><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CACHE MANIFEST</span><br><span class=\"line\">#version 1.1   // 版本号</span><br><span class=\"line\">CACHE:</span><br><span class=\"line\">    html/index.html   // 首次下载后需要缓存的文件</span><br><span class=\"line\">NETWORK:</span><br><span class=\"line\">    js/jquery.js      // 需要与服务器的连接，不需要缓存的文件</span><br><span class=\"line\">FALLBACK: </span><br><span class=\"line\">    html/index.html   // 当页面无法访问时的回退页面</span><br></pre></td></tr></table></figure></li></ul><h2 id=\"IndexedDB\"><a href=\"#IndexedDB\" class=\"headerlink\" title=\"IndexedDB\"></a>IndexedDB</h2><blockquote><p>Indexed Database API，是在浏览器中保存结构化数据的一种数据库</p></blockquote><ul><li>有需要再研究：<a href=\"https://www.cnblogs.com/best/p/6084209.html\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">https://www.cnblogs.com/best/p/6084209.html</a></li></ul><h1 id=\"九、其它\"><a href=\"#九、其它\" class=\"headerlink\" title=\"九、其它\"></a>九、其它</h1><ul><li>普通元素<ul><li>新增标签：<code>nav、header、aside、section、footer、canvas、video、output、...</code></li><li>新增属性：<code>contextmenu、contentEditable、hidden、draggable、data-*</code></li></ul></li><li>表单元素<ul><li>输入验证：<code>邮箱、地址、日期、数字、电话、范围、搜索、颜色</code></li><li>新增属性：<code>required、pattern、autofocus、autocomplete、novalidate、multiple</code></li></ul></li><li>超链接<ul><li>短信：<code>a href=&#39;sms:15919218899&#39;</code></li><li>电话：<code>a href=&quot;tel:15919218899&quot;</code></li><li>邮件：<code>a href=&quot;mailto:99519876@qq.com&quot;</code></li><li>地图：<code>a href=&quot;http://map.baidu.com/mobile/search...&quot;</code></li><li>QQ客服：<code>a target=&quot;_blank&quot; href=&quot;http://wpa.qq.com/msgrd?v=3&amp;...&quot;</code></li></ul></li><li>History<ul><li>功能：实现无刷新更新地址</li><li>API：<code>history.pushState、history.replaceState</code></li></ul></li></ul><!-- rebuild by neat -->"},{"title":"Javascript 主要内容","top":false,"keywords":["js","javascript"],"date":"2019-03-09T16:11:13.000Z","description":"ECMAScript、DOM、BOM","_content":"\n# 一、Javascript \n> JavaScript 由对象组成，一切皆为对象\n\n## 组成部分\n  * __ECMAScript__：核心，描述了JS的语法和基本对象\n  * __DOM__：文档对象模型，处理网页内容的方法和接口\n  * __BOM__：浏览器对象模型，与浏览器交互的方法和接口\n\n\n## 语言特点\n  * 解释型的脚本语言：在程序的运行过程中逐行进行解释\n  * 语法简单：使用弱类型的变量，对数据类型也没有严格要求\n  * 事件驱动：通过事件对用户操作做出响应\n  * 跨平台性：不依赖于操作系统，只需要兼容浏览器即可\n\n\n## 历史演变\n  * 始于1995年，前身为网景公司开发的 LiveScript，用来处理 以前由服务端负责的数据验证\n  * 后更名为JavaScript，功能演变为：前后端数据交互、页面特效、服务端开发 NodeJS\n  * JS 的很多语法和 Java、C# 语法相似，和 Java 毫无关系\n\n\n# 二、ECMAScript\n> 一种根据 ECMA-262 标准制定的通用脚本语言规范，JavaScript 是遵守该标准实现的一种脚本语言\n\n\n## 变量\n\n### 命名\n  * 方法：匈牙利命名法、驼峰命名法\n  * 规则\n    * 首字符：英文字母、下划线\n    * 组成：英文字母、下划线、数字\n    * 禁忌：关键字、保留字\n\n### 声明\n  * 显式声明：`var 变量名`\n  * 错误用法：没有类型、重复声明、隐式声明、不声明直接使用\n  * 正确用法：先声明后读写、先赋值后运算\n\n\n### 作用域\n1. 全局变量\n  * 包含：在函数外定义的变量，没有使用 var 的变量\n  * 调用：任何位置\n2. 局部变量\n  * 包含：在函数内使用 var 声明的变量，函数的参数变量\n  * 调用：当前函数体内\n3. 优先级\n  * 局部变量 > 同名参数变量 > 同名全局变量\n4. 特性\n  * 忽略块级用域\n    * ES6之前，js的作用域只有 函数作用域和全局作用域\n    * ES6中定义了块级作用域，有“暂时性死区”的特性（声明前不可用）\n  * 作用域链\n    * 内层函数可以访问外层函数的局部变量\n    * 外层函数不能访问内层函数的局部变量\n  生命周期\n    * 全局变量除非被显式删除，否则一直存在\n    * 局部变量从声明开始到函数运行完毕或被显式删除\n    * 回收机制有 标记清除、引用计数\n\n\n### 面试题\n  ```js\n  var obj = {\n        say: function(){\n            console.log(say)\n        }\n  }\n  obj.say()   // 报错，没有在函数作用域内创建 fn\n\n\n  var a = 1;\n  function test() {\n    var a = 2;\n    console.log(a);   // 2，遵循就近原则\n  }\n  test();\n\n  var a = 1;\n  function test2() {\n    console.log(a);   // undefined，变量提升\n    var a = 2;\n  }\n  test2(); \n\n  var a = 1; \n  function test3() {\n    console.log(a);   // 1，重新赋值而未重新声明\n    a = 2;\n  }\n  test3();\n\n  let b = 1;\n  function test4() {\n    console.log(b); // 报错，let 不能变量提升\n    let b = 2;\n  }\n  test4();\n\n  function test5() {\n    let a = 1;\n    { let a = 2; }\n    console.log(a);  // 1，console不在块级作用域中\n  }\n  test5();\n  ```\n\n\n## 数据类型\n> 分为原始数据和引用数据，js 变量的类型会根据其所赋值的数据类型来决定\n\n### 基本数据\n  * 即原始值：`Number、String、Boolean、undefined、Null`\n  * 6 个假值：`0、\" \"、undefined、null、NaN、false`\n  * 存储方式：存储在栈中的简单数据段。js 可按值访问其实际保存的值，复制时则会创建其副本\n  * 检测方法：`typeof`\n      \n### 引用数据\n  * 即引用值：`Object`\n  * 存储方式：存储在堆中的对象。js按引用访问其值，即访问时先从栈中读取内存地址（大小固定，保存于栈中），然后再找到保存在堆内存中的值。复制时只是复制了地址，两个对象实际指向的都是同一个值。\n  * 检测方法：`instanceof`\n\n  \n### 栈和堆\n  * __栈 stack__：可理解为一个无盖水缸，它会自动分配内存空间和释放。用于存储基本数据类型，具有空间大小固定和先进后出的特点。\n  * __堆 heap__：可理解为封闭盒子，动态分配内存，大小不固定而且不会自动释放。用于存储基本数据类型包装起来的类，实际上保存的不是变量本身，而是指向该对象的指针。\n\n### 类型转换\n  * 强制转换：`Boolean()、Number()、String()`\n  * 普通转换：`parseInt()、parseFloat()、num.toString()`\n\n\n## 运算符\n  * 算术运算符：`+、-、*、/、%、++、--`\n  * 赋值运算符：`=、+=、-=、*=、/=`\n  * 字符串运算符：`+、+=`\n  * 比较运算符：`&gt;、&lt;、&gt;=、&lt;=、==、!=、===、!==`\n  * 逻辑运算符：`&&、||、!`\n  * 三元运算符：`?:`\n\n\n## 流程语句\n\n### 循环语句\n  * while：`while(条件表达式) { 代码段 }`\n  * do-while：`do{ 代码段 } while(条件表达式)`\n  * for：`for(循环变量 = 初值; 循环条件; 递增/递减){ 代码段 }`\n  * for-in：`for(声明变量 in 对象){ 代码段 }`\n\n### 跳转语句\n  * return：终止函数体的运行，并返回一个值\n  * break：终止整个循环，不再判断\n  * continue：结束本次循环，判断是否执行下次循环\n\n### 选择语句\n  * if：`if(条件1){ } else if(条件2){ } else{ }`\n  * switch：`switch(条件){ case 1: break; default: break; }`\n  * 三元表达式：`var res = x>0 ? 1 : (x=0 ? -1 : 2)`\n\n### 异常处理语句\n  * throw：主动抛出异常\n  * try：指明需要处理的代码段\n  * catch：捕获异常\n  * finally：后期处理\n\n\n\n## 函数\n> 一段可以反复调用的代码块\n\n### 分类\n  * 普通函数\n  * 构造函数：类，可分为 内置类和自定义类\n  * 函数对象：通过 new Function() 创建的对象\n\n\n  ```js\n  // 1、普通函数\n\n  // 函数声明\n  function f1(){  } \n\n  // 函数表达式    \n  var f2 = function(){ }  \n\n  // 回调函数 callback：特定条件下调用\n  function f(num, callback){   \n    if(num == 3){\n        callback();\n    }\n  }\n\n  // 自执行函数 IIFE：独立作用域而不会污染全局环境\n  (function(x, y){\n      console.log(x + y);\n  })(2, 3);\n  ;(function(){ \n      console.log(111);\n  })();\n\n\n  // 2-1、内置类\n  var f3 = new Function('a','b','c','return a+b');\n  console.log(f3.constructor);   // 当前实例所属类\n\n\n  // 2-2、自定义类\n  function Person(name, age){ \n      this.name = name;\n      this.age = age;\n      return 1;  // return 基本类型则被忽略\n      // return { 'Jack': 18 }; // return 引用类型则被返回\n  }\n  Person.prototype.eat = function(){ };  \n  var p = new Person('Tom', 20);  \n    \n\n  // 3、函数对象\n  var f4 = new Function('str', 'console.log(str)');\n  ```\n\n\n### 调用\n  * 函数模式：`fn()`\n  * 方法模式：`obj.fn()、绑定 html 标签`\n  * 构造器模式：`new`\n  * 上下文模式：`call / apply`\n\n\n  ```js\n  function foo(m, n){\n      console.log(this);\n      return m + n;\n  }\n  // 函数调用\n  var f1 = foo(1, 5);\n  // 以 window 为上下文调用\n  var f1 = foo.apply(null, [1, 5])\n  var f1 = foo.call(null, 1, 5);\n\n  \n  var obj = {\n      age: 20,\n      getAge: function(){\n          return this.age;\n      }\n  }\n  // 方法调用\n  var f2 = obj.getAge();\n  //  以 obj 为上下文调用\n  var f2 = obj.getAge.apply(obj);\n  var f2 = obj.getAge.call(obj);\n  ```\n\n\n### apply 和 call\n  ```js\n  // 1、改变 this 指向\n  var obj = {\n      name: 'linxin'\n  }\n  function foo(){\n      console.log(this.name);\n  }\n  foo.call(obj);   // linxin\n  // obj 作为参数传给了 foo，此时函数中的 this 便指向了 obj。foo函数里相当于\n  function func(){\n      console.log(obj.name);\n  }\n\n\n  // 2、借用别的对象的方法\n  var Person1  = function(){\n      this.name = 'linxin';\n  }\n  var Person2 = function(){\n      this.getname = function(){\n          console.log(this.name);\n      }\n      // 使用 Person1 对象代替 this 对象，所以 Person2 继承了 Person1 的属性和方法\n      Person1.call(this);\n  }\n  var person = new Person2();\n  person.getname();  // linxin\n\n\n  // 3、调用函数\n  function fn() {\n      console.log('linxin');\n  }\n  fn.call();  // linxin\n  ```\n\n### this 指向\n  ```js\n  var obj = {\n        name: 'tom',\n        getName: function () {\n            return this.name;\n        }\n    };\n  var obj2 = { name: 'tony' }\n  console.log(obj.getName());  // tom，this 指向对象本身\n  var getName = obj.getName;\n  console.log(getName());      // 空，此时方法中的 this 指向 window 对象\n  console.log(getName.apply(obj2))    // tony，this 指向了 obj2 对象\n  ```\n\n\n### 函数前置\n<div style=\"text-indent: 2em\">函数声明会被 js解析器 优先读取，有重名的只留一个（变量和函数重名只留函数）。表达式只有在执行该语句时才会被逐行解析，而函数只有在被调用时才执行内部封装的函数体。</div>\n\n  ```js\n  f1() \n  var f1 = function(){ }   //报错\n\n  f2() \n  function f2(){ }        // 正常 \n  ```\n\n\n### 函数标识\n  * this：指向当前操作对象\n  * callee：指向参数集合所属对象\n  * prototype：指向函数附带的原型对象\n  * constructor：指向创建该对象的构造函数\n\n\n### 闭包\n> 指有权访问另一个函数作用域变量的函数，一般是定义在外层函数中的内层函数，主要是用来设计私有的方法和变量\n\n<div style=\"text-indent: 2em\">局部变量无法共享和长久的保存，而全局变量可能造成变量污染，所以我们希望有一种机制既可以长久的保存变量以便反复使用，但又不会造成全局污染。闭包的优点是可以避免全局变量的污染，缺点是闭包会常驻内存，会增大内存使用量，使用不当很容易造成内存泄露。</div>\n\n  * 特性\n    * 函数嵌套函数 \n    * 函数内部可以引用外部的参数和变量 \n    * 参数和变量不会被垃圾回收机制回收\n  * 用途：\n    * 数据缓存\n    * 封装私有变量\n    * 封装自定义插件\n    * 实现类和继承\n\n  ```js  \n  // 异步获取数据并缓存\n  const getList = (function() {\n      let data = {};\n      const getData = () => {\n          return new Promise((resolve, reject) => {\n              let packageOptions = {\n                  url: '/names',\n                  params: {\n                      normal: 1\n                  },\n                  success: function (rsp) {\n                      data = rsp.data\n                      resolve();\n                  }\n              };\n              ajax(packageOptions);\n          })\n      }\n      // 闭包存储data\n      const result = async function (type) {\n          if (JONS.stringify(data) === '{}') {\n              await getData();\n              return data;\n          } else {\n              return data;\n          }\n      }\n      return result;\n  })() \n  getList().then(res => {\n      console.log(res);\n  })\n\n\n  // 封装私有变量\n  var person = function(){     \n      var name = \"default\";       \n        \n      return {    \n          getName : function(){    \n              return name;    \n          },    \n          setName : function(newName){    \n              name = newName;    \n        }    \n      }    \n  }();    \n  console.log(person.name);       // undefined    \n  console.log(person.getName());  // default  \n  person.setName(\"chuang\");    \n  console.log(person.getName());  // chuang  \n \n\n  // 封装插件：匿名自执行函数执行完后会立刻释放资源\n  ;(function(document) { \n    var obj = {\n          setColor: function(id, color) {\n            document.getElementById(id).style.color = color;\n          }\n    }\n    window.view = obj;  // 暴露接口\n  })(document);\n  view.setColor('main','red');\n\n\n  // 实现类和继承\n  function Person(){    \n    var name = \"default\";       \n       \n    return {    \n       getName: function(){    \n           return name;    \n       },    \n       setName: function(newName){    \n           name = newName;    \n       }    \n    }    \n  }\n  var p = new Person();\n  p.setName(\"Tom\");\n  console.log(p.getName());\n  ```\n            \n\n\n## 正则表达式\n> 使用 `RegExp` 对象表示并由元字符、字符串和量词组成，用于描述字符串的匹配规则\n\n### 创建\n  1. 方式\n    * 字面量：`/pattern/attributes`，特殊字符不需要转义，不支持字符串拼接\n    * 实例化：`new RegExp(“pattern”, “attributes”)`，特殊字符需要转义，支持字符串拼接\n  2. 参数\n    * pattern：正则表达式\n    * attributes：匹配模式，`g、i、m` 分别表示 全局匹配、忽略大小写、多行匹配\n\n  ```js\n  var regExp = 'ab';\n\n  // 字面量 \n  var reg_1 = /regExp/;\n  var reg_1 = /^[a-zA-Z0-9]{3,8}$/;\n\n  // 实例化\n  var reg_2 = new RegExp(regExp+'1');\n  var reg_2 = new RegExp(“[a-zA-Z0-9]{3,8}”);\n  ```\n\n### 基础语法\n<div align=\"center\"> \n  ![regExp](images/js/regExp.png)\n</div> \n\n\n\n## 全局对象\n> Window 对象，表示允许 JavaScript 代码访问的 Web 浏览器窗口\n\n### 全局函数\n  * 编码：`encodeURI、encodeURIComponent、escape`\n  * 解码：`decodeURI、decodeURIComponent、unescape`\n  * 检测：`isNaN、isFinite`\n  * 转换：`eval、String、Number`\n  * 解析：`parseInt、parseFloat`\n\n### 全局属性\n  * NaN：不是数字值\n  * undefined：未定义的值\n  * Infinity：正无穷大的数值 \n\n\n## 计时器\n<div style=\"text-indent: 2em\">requestAnimationFrame 采用系统时间间隔来保持最佳绘制效率而不需要手动设置，这样就不会因间隔时间过短而会造成 过度绘制并增加开销，也不会因时间太长则导致 动画卡顿不流畅，让各种网页动画效果能够有一个统一的刷新机制，从而节省系统资源，提高系统性能，改善视觉效果。</div>\n\n  * __setTimeout__：延时执行指定代码, 取消时使用 clearTimeout\n  * __setInterval__：间隔时间重复执行代码, 取消时使用 clearInterval\n  * __requestAnimationFrame__：在浏览器每次刷新页面之前执行代码，时间间隔由浏览器刷新频率决定，取消时使用 cancelAnimationFrame\n\n  ```js\n  var box = document.getElementById(\"box\");\n  var timer = requestAnimationFrame(function step(){\n        var width = parseInt(box.style.width);\n        if(width &lt; 500){\n            box.style.width = width + 10;\n            requestAnimationFrame(step);\n        }else{\n            cancelAnimationFrame(timer);\n        } \n  })\n  ```\n\n\n\n# 三、DOM\n> 文档对象模型，用于操作 HTML 和 XML 文档（浏览器内容）的编程接口\n\n## 节点\n<div style=\"text-indent: 2em\">DOM 将整个文档（XML文档和HTML文档）看作一个树形结构，并用document对象表示该文档，并规定其中每个成分都是一个节点（Node），JavaScript 通过 DOM API 可以操作到每个节点。</div>\n\n### 节点信息\n  * `nodeType`：节点类型\n  * `nodeName`：节点名称\n  * `nodeValue`：节点值\n\n### 节点类型\n  * 文档节点：整个文档\n  * 注释节点：文档注释\n  * 元素节点：html 标签\n  * 文本节点：元素/属性节点中的文本内容\n  * 属性节点：元素节点的属性\n\n  <div align=\"center\"> \n    ![节点类型](images/js/domNodes.png) \n  </div> \n\n\n### 文档节点\n  * 标签：`document.documentElement/body/forms`\n  * 信息：`document.URL/domain/readyState`\n  * 方法：`document.write/writeln/open/close`\n\n\n### 元素节点\n> 文本节点、属性节点都属于元素节点的子节点，操作时都需要先获取 元素节点\n\n  1. 获取\n    * document\n      * `document.getElementById/TagName/ClassName/Name`\n      * `document.querySelector [All]`\n      * `document.documentElement`\n      * `document.body`\n      * `document.forms` \n    * 节点指针\n      * 父节点：`parentNode`\n      * 同级节点：`previousSibling、nextSibling`\n      * 子节点：`firstChild、lastChild、childNodes、children`\n  2. 操作\n    * 创建：`createElement、createAttribute、createTextNode`\n    * 插入：`appendChild、insertBefore`\n    * 替换：`replaceChild`\n    * 复制：`cloneNode`\n    * 删除：`removeChild` \n    * 样式：`dom.style.样式名`\n      * 样式名必须使用驼峰命名法\n      * 修改 class 时必须使用 className\n  3. 属性\n    * 获取：`getAttribute`\n    * 设置：`setAttribute`\n    * 移除：`removeAttribute`\n  4. 文本\n    * 获取：`innerHTML / innerText`\n    * 设置：`dom.innerHTML / innerText = \"new\"`\n    * 表单元素：`input.value、input.value = “new”`\n\n \n  ```js\n  // 设置元素属性\n  var box = document.getElementById(\"box\");\n  box.setAttribute(\"title\", \"this is box\");  \n  console.log(box.getAttribute(\"title\"));  \n    \n  // 创建属性节点\n  var placeholder = document.createAttribute(\"placeholder\");\n  placeholder.nodeValue = \"请输入姓名\"; \n  box.setAttributeNode(placeholder);  \n  ```\n\n\n## 事件\n\n### DOM0 级  \n> 在 DOM 中直接绑定事件\n\n  * 绑定：`DOM.onclick = function(){ }`\n  * 移除：`DOM.onclick = null / \"\"`\n  \n\n### DOM2 级  \n> 使用事件监听绑定事件，浏览器监听到用户执行相关操作做出响应\n\n  1. 主流浏览器\n    * 绑定：`DOM.addEventListener('click', fn, false)`\n    * 移除：`DOM.removeEventListener('click', fn)`\n    * 参数：false 时在冒泡阶段执行，true 则在捕获阶段执行\n  2. IE8及以下\n    * 绑定：`DOM.attachEvent('onclick', fn)`\n    * 移除：`DOM.detachEvent('click', fn)`\n\n\n  ```js\n  // DOM0 级事件可能被覆盖：2，3，4\n  var box = document.querySelector('#box')\n  box.onclick = function() {\n      alert(1)\n  }\n  box.onclick = function() {\n      alert(2)\n  }\n  box.addEventListener('click', function() {\n      alert(3)\n  })\n  box.addEventListener('click', function() {\n      alert(4)\n  })  \n  ```\n\n### 事件流\n> 事件的执行顺序\n\n  * 事件冒泡：事件从事件目标元素开始触发，向上触发到最外层的 document 对象\n  * 事件捕获：与冒泡相反\n  * DOM 事件流：DOM 先捕获到目标元素，然后冒泡到最外层\n \n\n### 事件对象\n> 触发 DOM 上的某个事件时会产生一个事件对象 event，它包含着所有与事件有关的信息\n\n  1. 属性：鼠标 / 键盘属性、IE 属性、标准 Event 属性\n  2. 方法：stopPropagation、preventDefault\n  3. 事件\n    * 鼠标事件：`click、dbclick、mousedown、mousemove、mouseout、mouseover、mouseup`\n    * 键盘事件：`keydown、keypress、keyup`\n    * HTML事件：`load、unload、resize、change、scroll、focus、blur、select、reset、submit`\n  \n  ```js\n    var Event = {\n\n      // 页面加载完成后\n      readyEvent: function(fn) {  \n          if (fn == null) { \n              fn = document;\n          } \n          var oldonload = window.onload; \n          if (typeof window.onload != 'function') {\n              window.onload = fn; \n          }else{\n              window.onload = function() { \n                  oldonload(); \n                  fn();\n              }\n          }\n      }, \n\n      // 绑定事件\n      addEvent: function(element, type, handler) { \n          if (element.addEventListener) {    \n                element.addEventListener(type, handler, false); // DOM2\n          }else if (element.attachEvent) { \n              element.attachEvent('on' + type, function() {\n                    handler.call(element);     // 兼容IE\n              }); \n          }else { \n              element['on' + type] = handler;  // DOM0\n          }\n      },\n\n      // 移除事件 \n      removeEvent: function(element, type, handler) {\n          if (element.removeEventListener) {\n              element.removeEventListener(type, handler, false); \n          }else if (element.datachEvent) { \n              element.datachEvent('on' + type, handler); \n          }else{\n              element['on' + type] = null;\n          }\n      },\n\n      // 获取应用到元素上的所有样式\n      getStyle: function(obj){\n          var style = null;\n          if(window.getComputedStyle){\n              style = window.getComputedStyle(obj,null);  // W3C\n          }else{\n              style = obj.currentStyle;   // IE\n          }\n          return style;\n      },\n\n      // 获取事件对象，确保随时可以使用\n      getEvent: function(e) { \n          var ev = e || window.event;\n          if(!ev){ \n              var c = this.getEvent.caller; \n              while(c) { \n                  ev = c.argument[0]; \n                  if (ev && Event == ev.constructor) {\n                          break; \n                  } \n                  c = c.caller; \n              } \n          } \n          return ev; \n      },\n\n      // 获取触发事件的元素 \n      getTarget: function(event) { \n          return event.target || event.srcElemnt; \n      },\n\n      // 阻止冒泡，比如 父子元素都有事件时阻止同时触发\n      stopPropagation: function(ev) { \n          if (ev.stopPropagation) { \n              ev.stopPropagation(); \n          }else { \n              ev.cancelBubble = true;\n          }\n      }, \n      stop_propagation: function() { \n          var e = window.event || arguments.callee.caller.arguments[0];\n          if(e && e.stopPropagation){ \n              e.stopPropagation();   \n          }else if(window.event){ \n              window.event.cancelBubble = true;  \n          }\n      }, \n\n      // 阻止浏览器默认行为，比如 点击提交按钮时阻止默认提交表单、a链接阻止默认跳转\n      preventDefault: function(ev) {\n          if (ev.preventDefault) { \n              ev.preventDefault(); \n          }else{\n              ev.returnValue = false; \n          }\n      } \n  }\n  ```\n\n\n### 事件委托\n> 利用事件冒泡原理，将本该元素执行的事件委托给了它的父元素执行  \n\n  1. 优势\n    * 节省内存，提升性能\n    * 减少DOM操作，运行效率更高\n\n  2. 适用场景\n    * 给多个同类元素绑定相同事件\n    * 给动态生成的新元素绑定事件\n\n  3. 实现代码\n  ```js\n  // 为三个同级的 input 绑定点击事件\n  var box = document.getElementById(\"box\");\n  // box.on(\"click\", \"input\", callback) \n  box.onclick = function (ev) {\n      var ev = ev || window.event;\n      var target = ev.target || ev.srcElement;\n\n      // 判断元素：target.className == \"box\"\n      if(target.nodeName.toLocaleLowerCase() == 'input'){\n          switch(target.id){\n              case 'add' :\n                  console.log('添加');\n                  break;\n              case 'remove' :\n                  console.log('删除');\n                  break;\n              case 'select' :\n                  console.log('选择');\n                  break;\n              default:\n                  break;\n          }\n      }\n  }\n\n  // 为添加的子元素绑定事件\n  var btn = document.getElementById(\"btn\");\n  var oUl = document.getElementById(\"ul1\");\n  oUl.addEventListener('mousedown', function(ev){\n      var ev = ev || window.event;\n      var target = ev.target || ev.srcElement;\n      if(target.nodeName.toLocaleLowerCase() == 'li'){\n          ev.target.style.backgroundColor=\"black\";\n      }\n  });\n  btn.onclick = function(){\n      var oLi = document.createElement('li');\n      oLi.innerHTML = 4;\n      oUl.appendChild(oLi);\n  };\n  ```\n\n \n\n# 四、BOM\n> 浏览器对象模型，用于操作浏览器本身的应用编程接口  \n\n  <div align=\"center\">\n  <!-- bom.png -->\n  ![BOM](images/js/bom.png)\n  </div> \n\n\n\n","source":"_posts/6-js基础.md","raw":"---\ntitle: Javascript 主要内容\ntags:\n  - Javascript \n  - ES\ncategories: Javascript \ntop: false\nkeywords:\n  - js\n  - javascript\ndate: 2019-03-10 00:11:13\ndescription: ECMAScript、DOM、BOM\n---\n\n# 一、Javascript \n> JavaScript 由对象组成，一切皆为对象\n\n## 组成部分\n  * __ECMAScript__：核心，描述了JS的语法和基本对象\n  * __DOM__：文档对象模型，处理网页内容的方法和接口\n  * __BOM__：浏览器对象模型，与浏览器交互的方法和接口\n\n\n## 语言特点\n  * 解释型的脚本语言：在程序的运行过程中逐行进行解释\n  * 语法简单：使用弱类型的变量，对数据类型也没有严格要求\n  * 事件驱动：通过事件对用户操作做出响应\n  * 跨平台性：不依赖于操作系统，只需要兼容浏览器即可\n\n\n## 历史演变\n  * 始于1995年，前身为网景公司开发的 LiveScript，用来处理 以前由服务端负责的数据验证\n  * 后更名为JavaScript，功能演变为：前后端数据交互、页面特效、服务端开发 NodeJS\n  * JS 的很多语法和 Java、C# 语法相似，和 Java 毫无关系\n\n\n# 二、ECMAScript\n> 一种根据 ECMA-262 标准制定的通用脚本语言规范，JavaScript 是遵守该标准实现的一种脚本语言\n\n\n## 变量\n\n### 命名\n  * 方法：匈牙利命名法、驼峰命名法\n  * 规则\n    * 首字符：英文字母、下划线\n    * 组成：英文字母、下划线、数字\n    * 禁忌：关键字、保留字\n\n### 声明\n  * 显式声明：`var 变量名`\n  * 错误用法：没有类型、重复声明、隐式声明、不声明直接使用\n  * 正确用法：先声明后读写、先赋值后运算\n\n\n### 作用域\n1. 全局变量\n  * 包含：在函数外定义的变量，没有使用 var 的变量\n  * 调用：任何位置\n2. 局部变量\n  * 包含：在函数内使用 var 声明的变量，函数的参数变量\n  * 调用：当前函数体内\n3. 优先级\n  * 局部变量 > 同名参数变量 > 同名全局变量\n4. 特性\n  * 忽略块级用域\n    * ES6之前，js的作用域只有 函数作用域和全局作用域\n    * ES6中定义了块级作用域，有“暂时性死区”的特性（声明前不可用）\n  * 作用域链\n    * 内层函数可以访问外层函数的局部变量\n    * 外层函数不能访问内层函数的局部变量\n  生命周期\n    * 全局变量除非被显式删除，否则一直存在\n    * 局部变量从声明开始到函数运行完毕或被显式删除\n    * 回收机制有 标记清除、引用计数\n\n\n### 面试题\n  ```js\n  var obj = {\n        say: function(){\n            console.log(say)\n        }\n  }\n  obj.say()   // 报错，没有在函数作用域内创建 fn\n\n\n  var a = 1;\n  function test() {\n    var a = 2;\n    console.log(a);   // 2，遵循就近原则\n  }\n  test();\n\n  var a = 1;\n  function test2() {\n    console.log(a);   // undefined，变量提升\n    var a = 2;\n  }\n  test2(); \n\n  var a = 1; \n  function test3() {\n    console.log(a);   // 1，重新赋值而未重新声明\n    a = 2;\n  }\n  test3();\n\n  let b = 1;\n  function test4() {\n    console.log(b); // 报错，let 不能变量提升\n    let b = 2;\n  }\n  test4();\n\n  function test5() {\n    let a = 1;\n    { let a = 2; }\n    console.log(a);  // 1，console不在块级作用域中\n  }\n  test5();\n  ```\n\n\n## 数据类型\n> 分为原始数据和引用数据，js 变量的类型会根据其所赋值的数据类型来决定\n\n### 基本数据\n  * 即原始值：`Number、String、Boolean、undefined、Null`\n  * 6 个假值：`0、\" \"、undefined、null、NaN、false`\n  * 存储方式：存储在栈中的简单数据段。js 可按值访问其实际保存的值，复制时则会创建其副本\n  * 检测方法：`typeof`\n      \n### 引用数据\n  * 即引用值：`Object`\n  * 存储方式：存储在堆中的对象。js按引用访问其值，即访问时先从栈中读取内存地址（大小固定，保存于栈中），然后再找到保存在堆内存中的值。复制时只是复制了地址，两个对象实际指向的都是同一个值。\n  * 检测方法：`instanceof`\n\n  \n### 栈和堆\n  * __栈 stack__：可理解为一个无盖水缸，它会自动分配内存空间和释放。用于存储基本数据类型，具有空间大小固定和先进后出的特点。\n  * __堆 heap__：可理解为封闭盒子，动态分配内存，大小不固定而且不会自动释放。用于存储基本数据类型包装起来的类，实际上保存的不是变量本身，而是指向该对象的指针。\n\n### 类型转换\n  * 强制转换：`Boolean()、Number()、String()`\n  * 普通转换：`parseInt()、parseFloat()、num.toString()`\n\n\n## 运算符\n  * 算术运算符：`+、-、*、/、%、++、--`\n  * 赋值运算符：`=、+=、-=、*=、/=`\n  * 字符串运算符：`+、+=`\n  * 比较运算符：`&gt;、&lt;、&gt;=、&lt;=、==、!=、===、!==`\n  * 逻辑运算符：`&&、||、!`\n  * 三元运算符：`?:`\n\n\n## 流程语句\n\n### 循环语句\n  * while：`while(条件表达式) { 代码段 }`\n  * do-while：`do{ 代码段 } while(条件表达式)`\n  * for：`for(循环变量 = 初值; 循环条件; 递增/递减){ 代码段 }`\n  * for-in：`for(声明变量 in 对象){ 代码段 }`\n\n### 跳转语句\n  * return：终止函数体的运行，并返回一个值\n  * break：终止整个循环，不再判断\n  * continue：结束本次循环，判断是否执行下次循环\n\n### 选择语句\n  * if：`if(条件1){ } else if(条件2){ } else{ }`\n  * switch：`switch(条件){ case 1: break; default: break; }`\n  * 三元表达式：`var res = x>0 ? 1 : (x=0 ? -1 : 2)`\n\n### 异常处理语句\n  * throw：主动抛出异常\n  * try：指明需要处理的代码段\n  * catch：捕获异常\n  * finally：后期处理\n\n\n\n## 函数\n> 一段可以反复调用的代码块\n\n### 分类\n  * 普通函数\n  * 构造函数：类，可分为 内置类和自定义类\n  * 函数对象：通过 new Function() 创建的对象\n\n\n  ```js\n  // 1、普通函数\n\n  // 函数声明\n  function f1(){  } \n\n  // 函数表达式    \n  var f2 = function(){ }  \n\n  // 回调函数 callback：特定条件下调用\n  function f(num, callback){   \n    if(num == 3){\n        callback();\n    }\n  }\n\n  // 自执行函数 IIFE：独立作用域而不会污染全局环境\n  (function(x, y){\n      console.log(x + y);\n  })(2, 3);\n  ;(function(){ \n      console.log(111);\n  })();\n\n\n  // 2-1、内置类\n  var f3 = new Function('a','b','c','return a+b');\n  console.log(f3.constructor);   // 当前实例所属类\n\n\n  // 2-2、自定义类\n  function Person(name, age){ \n      this.name = name;\n      this.age = age;\n      return 1;  // return 基本类型则被忽略\n      // return { 'Jack': 18 }; // return 引用类型则被返回\n  }\n  Person.prototype.eat = function(){ };  \n  var p = new Person('Tom', 20);  \n    \n\n  // 3、函数对象\n  var f4 = new Function('str', 'console.log(str)');\n  ```\n\n\n### 调用\n  * 函数模式：`fn()`\n  * 方法模式：`obj.fn()、绑定 html 标签`\n  * 构造器模式：`new`\n  * 上下文模式：`call / apply`\n\n\n  ```js\n  function foo(m, n){\n      console.log(this);\n      return m + n;\n  }\n  // 函数调用\n  var f1 = foo(1, 5);\n  // 以 window 为上下文调用\n  var f1 = foo.apply(null, [1, 5])\n  var f1 = foo.call(null, 1, 5);\n\n  \n  var obj = {\n      age: 20,\n      getAge: function(){\n          return this.age;\n      }\n  }\n  // 方法调用\n  var f2 = obj.getAge();\n  //  以 obj 为上下文调用\n  var f2 = obj.getAge.apply(obj);\n  var f2 = obj.getAge.call(obj);\n  ```\n\n\n### apply 和 call\n  ```js\n  // 1、改变 this 指向\n  var obj = {\n      name: 'linxin'\n  }\n  function foo(){\n      console.log(this.name);\n  }\n  foo.call(obj);   // linxin\n  // obj 作为参数传给了 foo，此时函数中的 this 便指向了 obj。foo函数里相当于\n  function func(){\n      console.log(obj.name);\n  }\n\n\n  // 2、借用别的对象的方法\n  var Person1  = function(){\n      this.name = 'linxin';\n  }\n  var Person2 = function(){\n      this.getname = function(){\n          console.log(this.name);\n      }\n      // 使用 Person1 对象代替 this 对象，所以 Person2 继承了 Person1 的属性和方法\n      Person1.call(this);\n  }\n  var person = new Person2();\n  person.getname();  // linxin\n\n\n  // 3、调用函数\n  function fn() {\n      console.log('linxin');\n  }\n  fn.call();  // linxin\n  ```\n\n### this 指向\n  ```js\n  var obj = {\n        name: 'tom',\n        getName: function () {\n            return this.name;\n        }\n    };\n  var obj2 = { name: 'tony' }\n  console.log(obj.getName());  // tom，this 指向对象本身\n  var getName = obj.getName;\n  console.log(getName());      // 空，此时方法中的 this 指向 window 对象\n  console.log(getName.apply(obj2))    // tony，this 指向了 obj2 对象\n  ```\n\n\n### 函数前置\n<div style=\"text-indent: 2em\">函数声明会被 js解析器 优先读取，有重名的只留一个（变量和函数重名只留函数）。表达式只有在执行该语句时才会被逐行解析，而函数只有在被调用时才执行内部封装的函数体。</div>\n\n  ```js\n  f1() \n  var f1 = function(){ }   //报错\n\n  f2() \n  function f2(){ }        // 正常 \n  ```\n\n\n### 函数标识\n  * this：指向当前操作对象\n  * callee：指向参数集合所属对象\n  * prototype：指向函数附带的原型对象\n  * constructor：指向创建该对象的构造函数\n\n\n### 闭包\n> 指有权访问另一个函数作用域变量的函数，一般是定义在外层函数中的内层函数，主要是用来设计私有的方法和变量\n\n<div style=\"text-indent: 2em\">局部变量无法共享和长久的保存，而全局变量可能造成变量污染，所以我们希望有一种机制既可以长久的保存变量以便反复使用，但又不会造成全局污染。闭包的优点是可以避免全局变量的污染，缺点是闭包会常驻内存，会增大内存使用量，使用不当很容易造成内存泄露。</div>\n\n  * 特性\n    * 函数嵌套函数 \n    * 函数内部可以引用外部的参数和变量 \n    * 参数和变量不会被垃圾回收机制回收\n  * 用途：\n    * 数据缓存\n    * 封装私有变量\n    * 封装自定义插件\n    * 实现类和继承\n\n  ```js  \n  // 异步获取数据并缓存\n  const getList = (function() {\n      let data = {};\n      const getData = () => {\n          return new Promise((resolve, reject) => {\n              let packageOptions = {\n                  url: '/names',\n                  params: {\n                      normal: 1\n                  },\n                  success: function (rsp) {\n                      data = rsp.data\n                      resolve();\n                  }\n              };\n              ajax(packageOptions);\n          })\n      }\n      // 闭包存储data\n      const result = async function (type) {\n          if (JONS.stringify(data) === '{}') {\n              await getData();\n              return data;\n          } else {\n              return data;\n          }\n      }\n      return result;\n  })() \n  getList().then(res => {\n      console.log(res);\n  })\n\n\n  // 封装私有变量\n  var person = function(){     \n      var name = \"default\";       \n        \n      return {    \n          getName : function(){    \n              return name;    \n          },    \n          setName : function(newName){    \n              name = newName;    \n        }    \n      }    \n  }();    \n  console.log(person.name);       // undefined    \n  console.log(person.getName());  // default  \n  person.setName(\"chuang\");    \n  console.log(person.getName());  // chuang  \n \n\n  // 封装插件：匿名自执行函数执行完后会立刻释放资源\n  ;(function(document) { \n    var obj = {\n          setColor: function(id, color) {\n            document.getElementById(id).style.color = color;\n          }\n    }\n    window.view = obj;  // 暴露接口\n  })(document);\n  view.setColor('main','red');\n\n\n  // 实现类和继承\n  function Person(){    \n    var name = \"default\";       \n       \n    return {    \n       getName: function(){    \n           return name;    \n       },    \n       setName: function(newName){    \n           name = newName;    \n       }    \n    }    \n  }\n  var p = new Person();\n  p.setName(\"Tom\");\n  console.log(p.getName());\n  ```\n            \n\n\n## 正则表达式\n> 使用 `RegExp` 对象表示并由元字符、字符串和量词组成，用于描述字符串的匹配规则\n\n### 创建\n  1. 方式\n    * 字面量：`/pattern/attributes`，特殊字符不需要转义，不支持字符串拼接\n    * 实例化：`new RegExp(“pattern”, “attributes”)`，特殊字符需要转义，支持字符串拼接\n  2. 参数\n    * pattern：正则表达式\n    * attributes：匹配模式，`g、i、m` 分别表示 全局匹配、忽略大小写、多行匹配\n\n  ```js\n  var regExp = 'ab';\n\n  // 字面量 \n  var reg_1 = /regExp/;\n  var reg_1 = /^[a-zA-Z0-9]{3,8}$/;\n\n  // 实例化\n  var reg_2 = new RegExp(regExp+'1');\n  var reg_2 = new RegExp(“[a-zA-Z0-9]{3,8}”);\n  ```\n\n### 基础语法\n<div align=\"center\"> \n  ![regExp](images/js/regExp.png)\n</div> \n\n\n\n## 全局对象\n> Window 对象，表示允许 JavaScript 代码访问的 Web 浏览器窗口\n\n### 全局函数\n  * 编码：`encodeURI、encodeURIComponent、escape`\n  * 解码：`decodeURI、decodeURIComponent、unescape`\n  * 检测：`isNaN、isFinite`\n  * 转换：`eval、String、Number`\n  * 解析：`parseInt、parseFloat`\n\n### 全局属性\n  * NaN：不是数字值\n  * undefined：未定义的值\n  * Infinity：正无穷大的数值 \n\n\n## 计时器\n<div style=\"text-indent: 2em\">requestAnimationFrame 采用系统时间间隔来保持最佳绘制效率而不需要手动设置，这样就不会因间隔时间过短而会造成 过度绘制并增加开销，也不会因时间太长则导致 动画卡顿不流畅，让各种网页动画效果能够有一个统一的刷新机制，从而节省系统资源，提高系统性能，改善视觉效果。</div>\n\n  * __setTimeout__：延时执行指定代码, 取消时使用 clearTimeout\n  * __setInterval__：间隔时间重复执行代码, 取消时使用 clearInterval\n  * __requestAnimationFrame__：在浏览器每次刷新页面之前执行代码，时间间隔由浏览器刷新频率决定，取消时使用 cancelAnimationFrame\n\n  ```js\n  var box = document.getElementById(\"box\");\n  var timer = requestAnimationFrame(function step(){\n        var width = parseInt(box.style.width);\n        if(width &lt; 500){\n            box.style.width = width + 10;\n            requestAnimationFrame(step);\n        }else{\n            cancelAnimationFrame(timer);\n        } \n  })\n  ```\n\n\n\n# 三、DOM\n> 文档对象模型，用于操作 HTML 和 XML 文档（浏览器内容）的编程接口\n\n## 节点\n<div style=\"text-indent: 2em\">DOM 将整个文档（XML文档和HTML文档）看作一个树形结构，并用document对象表示该文档，并规定其中每个成分都是一个节点（Node），JavaScript 通过 DOM API 可以操作到每个节点。</div>\n\n### 节点信息\n  * `nodeType`：节点类型\n  * `nodeName`：节点名称\n  * `nodeValue`：节点值\n\n### 节点类型\n  * 文档节点：整个文档\n  * 注释节点：文档注释\n  * 元素节点：html 标签\n  * 文本节点：元素/属性节点中的文本内容\n  * 属性节点：元素节点的属性\n\n  <div align=\"center\"> \n    ![节点类型](images/js/domNodes.png) \n  </div> \n\n\n### 文档节点\n  * 标签：`document.documentElement/body/forms`\n  * 信息：`document.URL/domain/readyState`\n  * 方法：`document.write/writeln/open/close`\n\n\n### 元素节点\n> 文本节点、属性节点都属于元素节点的子节点，操作时都需要先获取 元素节点\n\n  1. 获取\n    * document\n      * `document.getElementById/TagName/ClassName/Name`\n      * `document.querySelector [All]`\n      * `document.documentElement`\n      * `document.body`\n      * `document.forms` \n    * 节点指针\n      * 父节点：`parentNode`\n      * 同级节点：`previousSibling、nextSibling`\n      * 子节点：`firstChild、lastChild、childNodes、children`\n  2. 操作\n    * 创建：`createElement、createAttribute、createTextNode`\n    * 插入：`appendChild、insertBefore`\n    * 替换：`replaceChild`\n    * 复制：`cloneNode`\n    * 删除：`removeChild` \n    * 样式：`dom.style.样式名`\n      * 样式名必须使用驼峰命名法\n      * 修改 class 时必须使用 className\n  3. 属性\n    * 获取：`getAttribute`\n    * 设置：`setAttribute`\n    * 移除：`removeAttribute`\n  4. 文本\n    * 获取：`innerHTML / innerText`\n    * 设置：`dom.innerHTML / innerText = \"new\"`\n    * 表单元素：`input.value、input.value = “new”`\n\n \n  ```js\n  // 设置元素属性\n  var box = document.getElementById(\"box\");\n  box.setAttribute(\"title\", \"this is box\");  \n  console.log(box.getAttribute(\"title\"));  \n    \n  // 创建属性节点\n  var placeholder = document.createAttribute(\"placeholder\");\n  placeholder.nodeValue = \"请输入姓名\"; \n  box.setAttributeNode(placeholder);  \n  ```\n\n\n## 事件\n\n### DOM0 级  \n> 在 DOM 中直接绑定事件\n\n  * 绑定：`DOM.onclick = function(){ }`\n  * 移除：`DOM.onclick = null / \"\"`\n  \n\n### DOM2 级  \n> 使用事件监听绑定事件，浏览器监听到用户执行相关操作做出响应\n\n  1. 主流浏览器\n    * 绑定：`DOM.addEventListener('click', fn, false)`\n    * 移除：`DOM.removeEventListener('click', fn)`\n    * 参数：false 时在冒泡阶段执行，true 则在捕获阶段执行\n  2. IE8及以下\n    * 绑定：`DOM.attachEvent('onclick', fn)`\n    * 移除：`DOM.detachEvent('click', fn)`\n\n\n  ```js\n  // DOM0 级事件可能被覆盖：2，3，4\n  var box = document.querySelector('#box')\n  box.onclick = function() {\n      alert(1)\n  }\n  box.onclick = function() {\n      alert(2)\n  }\n  box.addEventListener('click', function() {\n      alert(3)\n  })\n  box.addEventListener('click', function() {\n      alert(4)\n  })  \n  ```\n\n### 事件流\n> 事件的执行顺序\n\n  * 事件冒泡：事件从事件目标元素开始触发，向上触发到最外层的 document 对象\n  * 事件捕获：与冒泡相反\n  * DOM 事件流：DOM 先捕获到目标元素，然后冒泡到最外层\n \n\n### 事件对象\n> 触发 DOM 上的某个事件时会产生一个事件对象 event，它包含着所有与事件有关的信息\n\n  1. 属性：鼠标 / 键盘属性、IE 属性、标准 Event 属性\n  2. 方法：stopPropagation、preventDefault\n  3. 事件\n    * 鼠标事件：`click、dbclick、mousedown、mousemove、mouseout、mouseover、mouseup`\n    * 键盘事件：`keydown、keypress、keyup`\n    * HTML事件：`load、unload、resize、change、scroll、focus、blur、select、reset、submit`\n  \n  ```js\n    var Event = {\n\n      // 页面加载完成后\n      readyEvent: function(fn) {  \n          if (fn == null) { \n              fn = document;\n          } \n          var oldonload = window.onload; \n          if (typeof window.onload != 'function') {\n              window.onload = fn; \n          }else{\n              window.onload = function() { \n                  oldonload(); \n                  fn();\n              }\n          }\n      }, \n\n      // 绑定事件\n      addEvent: function(element, type, handler) { \n          if (element.addEventListener) {    \n                element.addEventListener(type, handler, false); // DOM2\n          }else if (element.attachEvent) { \n              element.attachEvent('on' + type, function() {\n                    handler.call(element);     // 兼容IE\n              }); \n          }else { \n              element['on' + type] = handler;  // DOM0\n          }\n      },\n\n      // 移除事件 \n      removeEvent: function(element, type, handler) {\n          if (element.removeEventListener) {\n              element.removeEventListener(type, handler, false); \n          }else if (element.datachEvent) { \n              element.datachEvent('on' + type, handler); \n          }else{\n              element['on' + type] = null;\n          }\n      },\n\n      // 获取应用到元素上的所有样式\n      getStyle: function(obj){\n          var style = null;\n          if(window.getComputedStyle){\n              style = window.getComputedStyle(obj,null);  // W3C\n          }else{\n              style = obj.currentStyle;   // IE\n          }\n          return style;\n      },\n\n      // 获取事件对象，确保随时可以使用\n      getEvent: function(e) { \n          var ev = e || window.event;\n          if(!ev){ \n              var c = this.getEvent.caller; \n              while(c) { \n                  ev = c.argument[0]; \n                  if (ev && Event == ev.constructor) {\n                          break; \n                  } \n                  c = c.caller; \n              } \n          } \n          return ev; \n      },\n\n      // 获取触发事件的元素 \n      getTarget: function(event) { \n          return event.target || event.srcElemnt; \n      },\n\n      // 阻止冒泡，比如 父子元素都有事件时阻止同时触发\n      stopPropagation: function(ev) { \n          if (ev.stopPropagation) { \n              ev.stopPropagation(); \n          }else { \n              ev.cancelBubble = true;\n          }\n      }, \n      stop_propagation: function() { \n          var e = window.event || arguments.callee.caller.arguments[0];\n          if(e && e.stopPropagation){ \n              e.stopPropagation();   \n          }else if(window.event){ \n              window.event.cancelBubble = true;  \n          }\n      }, \n\n      // 阻止浏览器默认行为，比如 点击提交按钮时阻止默认提交表单、a链接阻止默认跳转\n      preventDefault: function(ev) {\n          if (ev.preventDefault) { \n              ev.preventDefault(); \n          }else{\n              ev.returnValue = false; \n          }\n      } \n  }\n  ```\n\n\n### 事件委托\n> 利用事件冒泡原理，将本该元素执行的事件委托给了它的父元素执行  \n\n  1. 优势\n    * 节省内存，提升性能\n    * 减少DOM操作，运行效率更高\n\n  2. 适用场景\n    * 给多个同类元素绑定相同事件\n    * 给动态生成的新元素绑定事件\n\n  3. 实现代码\n  ```js\n  // 为三个同级的 input 绑定点击事件\n  var box = document.getElementById(\"box\");\n  // box.on(\"click\", \"input\", callback) \n  box.onclick = function (ev) {\n      var ev = ev || window.event;\n      var target = ev.target || ev.srcElement;\n\n      // 判断元素：target.className == \"box\"\n      if(target.nodeName.toLocaleLowerCase() == 'input'){\n          switch(target.id){\n              case 'add' :\n                  console.log('添加');\n                  break;\n              case 'remove' :\n                  console.log('删除');\n                  break;\n              case 'select' :\n                  console.log('选择');\n                  break;\n              default:\n                  break;\n          }\n      }\n  }\n\n  // 为添加的子元素绑定事件\n  var btn = document.getElementById(\"btn\");\n  var oUl = document.getElementById(\"ul1\");\n  oUl.addEventListener('mousedown', function(ev){\n      var ev = ev || window.event;\n      var target = ev.target || ev.srcElement;\n      if(target.nodeName.toLocaleLowerCase() == 'li'){\n          ev.target.style.backgroundColor=\"black\";\n      }\n  });\n  btn.onclick = function(){\n      var oLi = document.createElement('li');\n      oLi.innerHTML = 4;\n      oUl.appendChild(oLi);\n  };\n  ```\n\n \n\n# 四、BOM\n> 浏览器对象模型，用于操作浏览器本身的应用编程接口  \n\n  <div align=\"center\">\n  <!-- bom.png -->\n  ![BOM](images/js/bom.png)\n  </div> \n\n\n\n","slug":"6-js基础","published":1,"updated":"2019-05-10T17:15:03.885Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvid4plv001i0nbxd895we27","content":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><html><head></head><body><h1 id=\"一、Javascript\"><a href=\"#一、Javascript\" class=\"headerlink\" title=\"一、Javascript\"></a>一、Javascript</h1><blockquote><p>JavaScript 由对象组成，一切皆为对象</p></blockquote><h2 id=\"组成部分\"><a href=\"#组成部分\" class=\"headerlink\" title=\"组成部分\"></a>组成部分</h2><ul><li><strong>ECMAScript</strong>：核心，描述了JS的语法和基本对象</li><li><strong>DOM</strong>：文档对象模型，处理网页内容的方法和接口</li><li><strong>BOM</strong>：浏览器对象模型，与浏览器交互的方法和接口</li></ul><h2 id=\"语言特点\"><a href=\"#语言特点\" class=\"headerlink\" title=\"语言特点\"></a>语言特点</h2><ul><li>解释型的脚本语言：在程序的运行过程中逐行进行解释</li><li>语法简单：使用弱类型的变量，对数据类型也没有严格要求</li><li>事件驱动：通过事件对用户操作做出响应</li><li>跨平台性：不依赖于操作系统，只需要兼容浏览器即可</li></ul><h2 id=\"历史演变\"><a href=\"#历史演变\" class=\"headerlink\" title=\"历史演变\"></a>历史演变</h2><ul><li>始于1995年，前身为网景公司开发的 LiveScript，用来处理 以前由服务端负责的数据验证</li><li>后更名为JavaScript，功能演变为：前后端数据交互、页面特效、服务端开发 NodeJS</li><li>JS 的很多语法和 Java、C# 语法相似，和 Java 毫无关系</li></ul><h1 id=\"二、ECMAScript\"><a href=\"#二、ECMAScript\" class=\"headerlink\" title=\"二、ECMAScript\"></a>二、ECMAScript</h1><blockquote><p>一种根据 ECMA-262 标准制定的通用脚本语言规范，JavaScript 是遵守该标准实现的一种脚本语言</p></blockquote><h2 id=\"变量\"><a href=\"#变量\" class=\"headerlink\" title=\"变量\"></a>变量</h2><h3 id=\"命名\"><a href=\"#命名\" class=\"headerlink\" title=\"命名\"></a>命名</h3><ul><li>方法：匈牙利命名法、驼峰命名法</li><li>规则<ul><li>首字符：英文字母、下划线</li><li>组成：英文字母、下划线、数字</li><li>禁忌：关键字、保留字</li></ul></li></ul><h3 id=\"声明\"><a href=\"#声明\" class=\"headerlink\" title=\"声明\"></a>声明</h3><ul><li>显式声明：<code>var 变量名</code></li><li>错误用法：没有类型、重复声明、隐式声明、不声明直接使用</li><li>正确用法：先声明后读写、先赋值后运算</li></ul><h3 id=\"作用域\"><a href=\"#作用域\" class=\"headerlink\" title=\"作用域\"></a>作用域</h3><ol><li>全局变量<ul><li>包含：在函数外定义的变量，没有使用 var 的变量</li><li>调用：任何位置</li></ul></li><li>局部变量<ul><li>包含：在函数内使用 var 声明的变量，函数的参数变量</li><li>调用：当前函数体内</li></ul></li><li>优先级<ul><li>局部变量 > 同名参数变量 > 同名全局变量</li></ul></li><li>特性<ul><li>忽略块级用域<ul><li>ES6之前，js的作用域只有 函数作用域和全局作用域</li><li>ES6中定义了块级作用域，有“暂时性死区”的特性（声明前不可用）</li></ul></li><li>作用域链<ul><li>内层函数可以访问外层函数的局部变量</li><li>外层函数不能访问内层函数的局部变量<br>生命周期</li><li>全局变量除非被显式删除，否则一直存在</li><li>局部变量从声明开始到函数运行完毕或被显式删除</li><li>回收机制有 标记清除、引用计数</li></ul></li></ul></li></ol><h3 id=\"面试题\"><a href=\"#面试题\" class=\"headerlink\" title=\"面试题\"></a>面试题</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = {</span><br><span class=\"line\">      say: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(say)</span><br><span class=\"line\">      }</span><br><span class=\"line\">}</span><br><span class=\"line\">obj.say()   <span class=\"comment\">// 报错，没有在函数作用域内创建 fn</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"number\">2</span>;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(a);   <span class=\"comment\">// 2，遵循就近原则</span></span><br><span class=\"line\">}</span><br><span class=\"line\">test();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test2</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(a);   <span class=\"comment\">// undefined，变量提升</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"number\">2</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\">test2(); </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">1</span>; </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test3</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(a);   <span class=\"comment\">// 1，重新赋值而未重新声明</span></span><br><span class=\"line\">  a = <span class=\"number\">2</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\">test3();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> b = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test4</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(b); <span class=\"comment\">// 报错，let 不能变量提升</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> b = <span class=\"number\">2</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\">test4();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test5</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">  <span class=\"keyword\">let</span> a = <span class=\"number\">1</span>;</span><br><span class=\"line\">  { <span class=\"keyword\">let</span> a = <span class=\"number\">2</span>; }</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(a);  <span class=\"comment\">// 1，console不在块级作用域中</span></span><br><span class=\"line\">}</span><br><span class=\"line\">test5();</span><br></pre></td></tr></tbody></table></figure><h2 id=\"数据类型\"><a href=\"#数据类型\" class=\"headerlink\" title=\"数据类型\"></a>数据类型</h2><blockquote><p>分为原始数据和引用数据，js 变量的类型会根据其所赋值的数据类型来决定</p></blockquote><h3 id=\"基本数据\"><a href=\"#基本数据\" class=\"headerlink\" title=\"基本数据\"></a>基本数据</h3><ul><li>即原始值：<code>Number、String、Boolean、undefined、Null</code></li><li>6 个假值：<code>0、\" \"、undefined、null、NaN、false</code></li><li>存储方式：存储在栈中的简单数据段。js 可按值访问其实际保存的值，复制时则会创建其副本</li><li>检测方法：<code>typeof</code></li></ul><h3 id=\"引用数据\"><a href=\"#引用数据\" class=\"headerlink\" title=\"引用数据\"></a>引用数据</h3><ul><li>即引用值：<code>Object</code></li><li>存储方式：存储在堆中的对象。js按引用访问其值，即访问时先从栈中读取内存地址（大小固定，保存于栈中），然后再找到保存在堆内存中的值。复制时只是复制了地址，两个对象实际指向的都是同一个值。</li><li>检测方法：<code>instanceof</code></li></ul><h3 id=\"栈和堆\"><a href=\"#栈和堆\" class=\"headerlink\" title=\"栈和堆\"></a>栈和堆</h3><ul><li><strong>栈 stack</strong>：可理解为一个无盖水缸，它会自动分配内存空间和释放。用于存储基本数据类型，具有空间大小固定和先进后出的特点。</li><li><strong>堆 heap</strong>：可理解为封闭盒子，动态分配内存，大小不固定而且不会自动释放。用于存储基本数据类型包装起来的类，实际上保存的不是变量本身，而是指向该对象的指针。</li></ul><h3 id=\"类型转换\"><a href=\"#类型转换\" class=\"headerlink\" title=\"类型转换\"></a>类型转换</h3><ul><li>强制转换：<code>Boolean()、Number()、String()</code></li><li>普通转换：<code>parseInt()、parseFloat()、num.toString()</code></li></ul><h2 id=\"运算符\"><a href=\"#运算符\" class=\"headerlink\" title=\"运算符\"></a>运算符</h2><ul><li>算术运算符：<code>+、-、*、/、%、++、--</code></li><li>赋值运算符：<code>=、+=、-=、*=、/=</code></li><li>字符串运算符：<code>+、+=</code></li><li>比较运算符：<code>&gt;、&lt;、&gt;=、&lt;=、==、!=、===、!==</code></li><li>逻辑运算符：<code>&&、||、!</code></li><li>三元运算符：<code>?:</code></li></ul><h2 id=\"流程语句\"><a href=\"#流程语句\" class=\"headerlink\" title=\"流程语句\"></a>流程语句</h2><h3 id=\"循环语句\"><a href=\"#循环语句\" class=\"headerlink\" title=\"循环语句\"></a>循环语句</h3><ul><li>while：<code>while(条件表达式) { 代码段 }</code></li><li>do-while：<code>do{ 代码段 } while(条件表达式)</code></li><li>for：<code>for(循环变量 = 初值; 循环条件; 递增/递减){ 代码段 }</code></li><li>for-in：<code>for(声明变量 in 对象){ 代码段 }</code></li></ul><h3 id=\"跳转语句\"><a href=\"#跳转语句\" class=\"headerlink\" title=\"跳转语句\"></a>跳转语句</h3><ul><li>return：终止函数体的运行，并返回一个值</li><li>break：终止整个循环，不再判断</li><li>continue：结束本次循环，判断是否执行下次循环</li></ul><h3 id=\"选择语句\"><a href=\"#选择语句\" class=\"headerlink\" title=\"选择语句\"></a>选择语句</h3><ul><li>if：<code>if(条件1){ } else if(条件2){ } else{ }</code></li><li>switch：<code>switch(条件){ case 1: break; default: break; }</code></li><li>三元表达式：<code>var res = x>0 ? 1 : (x=0 ? -1 : 2)</code></li></ul><h3 id=\"异常处理语句\"><a href=\"#异常处理语句\" class=\"headerlink\" title=\"异常处理语句\"></a>异常处理语句</h3><ul><li>throw：主动抛出异常</li><li>try：指明需要处理的代码段</li><li>catch：捕获异常</li><li>finally：后期处理</li></ul><h2 id=\"函数\"><a href=\"#函数\" class=\"headerlink\" title=\"函数\"></a>函数</h2><blockquote><p>一段可以反复调用的代码块</p></blockquote><h3 id=\"分类\"><a href=\"#分类\" class=\"headerlink\" title=\"分类\"></a>分类</h3><ul><li>普通函数</li><li>构造函数：类，可分为 内置类和自定义类</li><li>函数对象：通过 new Function() 创建的对象</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1、普通函数</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 函数声明</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f1</span>(<span class=\"params\"></span>)</span>{  } </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 函数表达式    </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> f2 = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{ }  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 回调函数 callback：特定条件下调用</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f</span>(<span class=\"params\">num, callback</span>)</span>{   </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(num == <span class=\"number\">3</span>){</span><br><span class=\"line\">      callback();</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 自执行函数 IIFE：独立作用域而不会污染全局环境</span></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">x, y</span>)</span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(x + y);</span><br><span class=\"line\">})(<span class=\"number\">2</span>, <span class=\"number\">3</span>);</span><br><span class=\"line\">;(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{ </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">111</span>);</span><br><span class=\"line\">})();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2-1、内置类</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> f3 = <span class=\"keyword\">new</span> <span class=\"built_in\">Function</span>(<span class=\"string\">'a'</span>,<span class=\"string\">'b'</span>,<span class=\"string\">'c'</span>,<span class=\"string\">'return a+b'</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(f3.constructor);   <span class=\"comment\">// 当前实例所属类</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2-2、自定义类</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name, age</span>)</span>{ </span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.age = age;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">1</span>;  <span class=\"comment\">// return 基本类型则被忽略</span></span><br><span class=\"line\">    <span class=\"comment\">// return { 'Jack': 18 }; // return 引用类型则被返回</span></span><br><span class=\"line\">}</span><br><span class=\"line\">Person.prototype.eat = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{ };  </span><br><span class=\"line\"><span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> Person(<span class=\"string\">'Tom'</span>, <span class=\"number\">20</span>);  </span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3、函数对象</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> f4 = <span class=\"keyword\">new</span> <span class=\"built_in\">Function</span>(<span class=\"string\">'str'</span>, <span class=\"string\">'console.log(str)'</span>);</span><br></pre></td></tr></tbody></table></figure><h3 id=\"调用\"><a href=\"#调用\" class=\"headerlink\" title=\"调用\"></a>调用</h3><ul><li>函数模式：<code>fn()</code></li><li>方法模式：<code>obj.fn()、绑定 html 标签</code></li><li>构造器模式：<code>new</code></li><li>上下文模式：<code>call / apply</code></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">m, n</span>)</span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> m + n;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"comment\">// 函数调用</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> f1 = foo(<span class=\"number\">1</span>, <span class=\"number\">5</span>);</span><br><span class=\"line\"><span class=\"comment\">// 以 window 为上下文调用</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> f1 = foo.apply(<span class=\"literal\">null</span>, [<span class=\"number\">1</span>, <span class=\"number\">5</span>])</span><br><span class=\"line\"><span class=\"keyword\">var</span> f1 = foo.call(<span class=\"literal\">null</span>, <span class=\"number\">1</span>, <span class=\"number\">5</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = {</span><br><span class=\"line\">    age: <span class=\"number\">20</span>,</span><br><span class=\"line\">    getAge: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.age;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"comment\">// 方法调用</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> f2 = obj.getAge();</span><br><span class=\"line\"><span class=\"comment\">//  以 obj 为上下文调用</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> f2 = obj.getAge.apply(obj);</span><br><span class=\"line\"><span class=\"keyword\">var</span> f2 = obj.getAge.call(obj);</span><br></pre></td></tr></tbody></table></figure><h3 id=\"apply-和-call\"><a href=\"#apply-和-call\" class=\"headerlink\" title=\"apply 和 call\"></a>apply 和 call</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1、改变 this 指向</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = {</span><br><span class=\"line\">    name: <span class=\"string\">'linxin'</span></span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">}</span><br><span class=\"line\">foo.call(obj);   <span class=\"comment\">// linxin</span></span><br><span class=\"line\"><span class=\"comment\">// obj 作为参数传给了 foo，此时函数中的 this 便指向了 obj。foo函数里相当于</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">func</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(obj.name);</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2、借用别的对象的方法</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Person1  = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = <span class=\"string\">'linxin'</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">var</span> Person2 = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.getname = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"comment\">// 使用 Person1 对象代替 this 对象，所以 Person2 继承了 Person1 的属性和方法</span></span><br><span class=\"line\">    Person1.call(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">var</span> person = <span class=\"keyword\">new</span> Person2();</span><br><span class=\"line\">person.getname();  <span class=\"comment\">// linxin</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3、调用函数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'linxin'</span>);</span><br><span class=\"line\">}</span><br><span class=\"line\">fn.call();  <span class=\"comment\">// linxin</span></span><br></pre></td></tr></tbody></table></figure><h3 id=\"this-指向\"><a href=\"#this-指向\" class=\"headerlink\" title=\"this 指向\"></a>this 指向</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = {</span><br><span class=\"line\">      name: <span class=\"string\">'tom'</span>,</span><br><span class=\"line\">      getName: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.name;</span><br><span class=\"line\">      }</span><br><span class=\"line\">  };</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj2 = { <span class=\"attr\">name</span>: <span class=\"string\">'tony'</span> }</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(obj.getName());  <span class=\"comment\">// tom，this 指向对象本身</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> getName = obj.getName;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(getName());      <span class=\"comment\">// 空，此时方法中的 this 指向 window 对象</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(getName.apply(obj2))    <span class=\"comment\">// tony，this 指向了 obj2 对象</span></span><br></pre></td></tr></tbody></table></figure><h3 id=\"函数前置\"><a href=\"#函数前置\" class=\"headerlink\" title=\"函数前置\"></a>函数前置</h3><div style=\"text-indent:2em\">函数声明会被 js解析器 优先读取，有重名的只留一个（变量和函数重名只留函数）。表达式只有在执行该语句时才会被逐行解析，而函数只有在被调用时才执行内部封装的函数体。</div><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">f1() </span><br><span class=\"line\"><span class=\"keyword\">var</span> f1 = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{ }   <span class=\"comment\">//报错</span></span><br><span class=\"line\"></span><br><span class=\"line\">f2() </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f2</span>(<span class=\"params\"></span>)</span>{ }        <span class=\"comment\">// 正常</span></span><br></pre></td></tr></tbody></table></figure><h3 id=\"函数标识\"><a href=\"#函数标识\" class=\"headerlink\" title=\"函数标识\"></a>函数标识</h3><ul><li>this：指向当前操作对象</li><li>callee：指向参数集合所属对象</li><li>prototype：指向函数附带的原型对象</li><li>constructor：指向创建该对象的构造函数</li></ul><h3 id=\"闭包\"><a href=\"#闭包\" class=\"headerlink\" title=\"闭包\"></a>闭包</h3><blockquote><p>指有权访问另一个函数作用域变量的函数，一般是定义在外层函数中的内层函数，主要是用来设计私有的方法和变量</p></blockquote><div style=\"text-indent:2em\">局部变量无法共享和长久的保存，而全局变量可能造成变量污染，所以我们希望有一种机制既可以长久的保存变量以便反复使用，但又不会造成全局污染。闭包的优点是可以避免全局变量的污染，缺点是闭包会常驻内存，会增大内存使用量，使用不当很容易造成内存泄露。</div><ul><li>特性<ul><li>函数嵌套函数</li><li>函数内部可以引用外部的参数和变量</li><li>参数和变量不会被垃圾回收机制回收</li></ul></li><li><p>用途：</p><ul><li>数据缓存</li><li>封装私有变量</li><li>封装自定义插件</li><li>实现类和继承</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 异步获取数据并缓存</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> getList = (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">let</span> data = {};</span><br><span class=\"line\">    <span class=\"keyword\">const</span> getData = <span class=\"function\"><span class=\"params\">()</span> =></span> {</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =></span> {</span><br><span class=\"line\">            <span class=\"keyword\">let</span> packageOptions = {</span><br><span class=\"line\">                url: <span class=\"string\">'/names'</span>,</span><br><span class=\"line\">                params: {</span><br><span class=\"line\">                    normal: <span class=\"number\">1</span></span><br><span class=\"line\">                },</span><br><span class=\"line\">                success: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">rsp</span>) </span>{</span><br><span class=\"line\">                    data = rsp.data</span><br><span class=\"line\">                    resolve();</span><br><span class=\"line\">                }</span><br><span class=\"line\">            };</span><br><span class=\"line\">            ajax(packageOptions);</span><br><span class=\"line\">        })</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"comment\">// 闭包存储data</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> result = <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">type</span>) </span>{</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (JONS.stringify(data) === <span class=\"string\">'{}'</span>) {</span><br><span class=\"line\">            <span class=\"keyword\">await</span> getData();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> data;</span><br><span class=\"line\">        } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">            <span class=\"keyword\">return</span> data;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">})() </span><br><span class=\"line\">getList().then(<span class=\"function\"><span class=\"params\">res</span> =></span> {</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 封装私有变量</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> person = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{     </span><br><span class=\"line\">    <span class=\"keyword\">var</span> name = <span class=\"string\">\"default\"</span>;       </span><br><span class=\"line\">      </span><br><span class=\"line\">    <span class=\"keyword\">return</span> {    </span><br><span class=\"line\">        getName : <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{    </span><br><span class=\"line\">            <span class=\"keyword\">return</span> name;    </span><br><span class=\"line\">        },    </span><br><span class=\"line\">        setName : <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">newName</span>)</span>{    </span><br><span class=\"line\">            name = newName;    </span><br><span class=\"line\">      }    </span><br><span class=\"line\">    }    </span><br><span class=\"line\">}();    </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(person.name);       <span class=\"comment\">// undefined    </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(person.getName());  <span class=\"comment\">// default  </span></span><br><span class=\"line\">person.setName(<span class=\"string\">\"chuang\"</span>);    </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(person.getName());  <span class=\"comment\">// chuang  </span></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 封装插件：匿名自执行函数执行完后会立刻释放资源</span></span><br><span class=\"line\">;(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">document</span>) </span>{ </span><br><span class=\"line\">  <span class=\"keyword\">var</span> obj = {</span><br><span class=\"line\">        setColor: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">id, color</span>) </span>{</span><br><span class=\"line\">          <span class=\"built_in\">document</span>.getElementById(id).style.color = color;</span><br><span class=\"line\">        }</span><br><span class=\"line\">  }</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.view = obj;  <span class=\"comment\">// 暴露接口</span></span><br><span class=\"line\">})(<span class=\"built_in\">document</span>);</span><br><span class=\"line\">view.setColor(<span class=\"string\">'main'</span>,<span class=\"string\">'red'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 实现类和继承</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\"></span>)</span>{    </span><br><span class=\"line\">  <span class=\"keyword\">var</span> name = <span class=\"string\">\"default\"</span>;       </span><br><span class=\"line\">     </span><br><span class=\"line\">  <span class=\"keyword\">return</span> {    </span><br><span class=\"line\">     getName: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{    </span><br><span class=\"line\">         <span class=\"keyword\">return</span> name;    </span><br><span class=\"line\">     },    </span><br><span class=\"line\">     setName: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">newName</span>)</span>{    </span><br><span class=\"line\">         name = newName;    </span><br><span class=\"line\">     }    </span><br><span class=\"line\">  }    </span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> Person();</span><br><span class=\"line\">p.setName(<span class=\"string\">\"Tom\"</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(p.getName());</span><br></pre></td></tr></tbody></table></figure></li></ul><h2 id=\"正则表达式\"><a href=\"#正则表达式\" class=\"headerlink\" title=\"正则表达式\"></a>正则表达式</h2><blockquote><p>使用 <code>RegExp</code> 对象表示并由元字符、字符串和量词组成，用于描述字符串的匹配规则</p></blockquote><h3 id=\"创建\"><a href=\"#创建\" class=\"headerlink\" title=\"创建\"></a>创建</h3><ol><li>方式<ul><li>字面量：<code>/pattern/attributes</code>，特殊字符不需要转义，不支持字符串拼接</li><li>实例化：<code>new RegExp(“pattern”, “attributes”)</code>，特殊字符需要转义，支持字符串拼接</li></ul></li><li><p>参数</p><ul><li>pattern：正则表达式</li><li>attributes：匹配模式，<code>g、i、m</code> 分别表示 全局匹配、忽略大小写、多行匹配</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> regExp = <span class=\"string\">'ab'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 字面量 </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> reg_1 = <span class=\"regexp\">/regExp/</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> reg_1 = <span class=\"regexp\">/^[a-zA-Z0-9]{3,8}$/</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 实例化</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> reg_2 = <span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(regExp+<span class=\"string\">'1'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> reg_2 = <span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(“[a-zA-Z0<span class=\"number\">-9</span>]{<span class=\"number\">3</span>,<span class=\"number\">8</span>}”);</span><br></pre></td></tr></tbody></table></figure></li></ol><h3 id=\"基础语法\"><a href=\"#基础语法\" class=\"headerlink\" title=\"基础语法\"></a>基础语法</h3><div align=\"center\"><br><img src=\"images/js/regExp.png\" alt=\"regExp\"><br></div><h2 id=\"全局对象\"><a href=\"#全局对象\" class=\"headerlink\" title=\"全局对象\"></a>全局对象</h2><blockquote><p>Window 对象，表示允许 JavaScript 代码访问的 Web 浏览器窗口</p></blockquote><h3 id=\"全局函数\"><a href=\"#全局函数\" class=\"headerlink\" title=\"全局函数\"></a>全局函数</h3><ul><li>编码：<code>encodeURI、encodeURIComponent、escape</code></li><li>解码：<code>decodeURI、decodeURIComponent、unescape</code></li><li>检测：<code>isNaN、isFinite</code></li><li>转换：<code>eval、String、Number</code></li><li>解析：<code>parseInt、parseFloat</code></li></ul><h3 id=\"全局属性\"><a href=\"#全局属性\" class=\"headerlink\" title=\"全局属性\"></a>全局属性</h3><ul><li>NaN：不是数字值</li><li>undefined：未定义的值</li><li>Infinity：正无穷大的数值</li></ul><h2 id=\"计时器\"><a href=\"#计时器\" class=\"headerlink\" title=\"计时器\"></a>计时器</h2><div style=\"text-indent:2em\">requestAnimationFrame 采用系统时间间隔来保持最佳绘制效率而不需要手动设置，这样就不会因间隔时间过短而会造成 过度绘制并增加开销，也不会因时间太长则导致 动画卡顿不流畅，让各种网页动画效果能够有一个统一的刷新机制，从而节省系统资源，提高系统性能，改善视觉效果。</div><ul><li><strong>setTimeout</strong>：延时执行指定代码, 取消时使用 clearTimeout</li><li><strong>setInterval</strong>：间隔时间重复执行代码, 取消时使用 clearInterval</li><li><p><strong>requestAnimationFrame</strong>：在浏览器每次刷新页面之前执行代码，时间间隔由浏览器刷新频率决定，取消时使用 cancelAnimationFrame</p><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> box = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"box\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> timer = requestAnimationFrame(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">step</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">      <span class=\"keyword\">var</span> width = <span class=\"built_in\">parseInt</span>(box.style.width);</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(width &lt; <span class=\"number\">500</span>){</span><br><span class=\"line\">          box.style.width = width + <span class=\"number\">10</span>;</span><br><span class=\"line\">          requestAnimationFrame(step);</span><br><span class=\"line\">      }<span class=\"keyword\">else</span>{</span><br><span class=\"line\">          cancelAnimationFrame(timer);</span><br><span class=\"line\">      } </span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure></li></ul><h1 id=\"三、DOM\"><a href=\"#三、DOM\" class=\"headerlink\" title=\"三、DOM\"></a>三、DOM</h1><blockquote><p>文档对象模型，用于操作 HTML 和 XML 文档（浏览器内容）的编程接口</p></blockquote><h2 id=\"节点\"><a href=\"#节点\" class=\"headerlink\" title=\"节点\"></a>节点</h2><div style=\"text-indent:2em\">DOM 将整个文档（XML文档和HTML文档）看作一个树形结构，并用document对象表示该文档，并规定其中每个成分都是一个节点（Node），JavaScript 通过 DOM API 可以操作到每个节点。</div><h3 id=\"节点信息\"><a href=\"#节点信息\" class=\"headerlink\" title=\"节点信息\"></a>节点信息</h3><ul><li><code>nodeType</code>：节点类型</li><li><code>nodeName</code>：节点名称</li><li><code>nodeValue</code>：节点值</li></ul><h3 id=\"节点类型\"><a href=\"#节点类型\" class=\"headerlink\" title=\"节点类型\"></a>节点类型</h3><ul><li>文档节点：整个文档</li><li>注释节点：文档注释</li><li>元素节点：html 标签</li><li>文本节点：元素/属性节点中的文本内容</li><li><p>属性节点：元素节点的属性</p><div align=\"center\"><br><img src=\"images/js/domNodes.png\" alt=\"节点类型\"><br></div></li></ul><h3 id=\"文档节点\"><a href=\"#文档节点\" class=\"headerlink\" title=\"文档节点\"></a>文档节点</h3><ul><li>标签：<code>document.documentElement/body/forms</code></li><li>信息：<code>document.URL/domain/readyState</code></li><li>方法：<code>document.write/writeln/open/close</code></li></ul><h3 id=\"元素节点\"><a href=\"#元素节点\" class=\"headerlink\" title=\"元素节点\"></a>元素节点</h3><blockquote><p>文本节点、属性节点都属于元素节点的子节点，操作时都需要先获取 元素节点</p></blockquote><ol><li>获取<ul><li>document<ul><li><code>document.getElementById/TagName/ClassName/Name</code></li><li><code>document.querySelector [All]</code></li><li><code>document.documentElement</code></li><li><code>document.body</code></li><li><code>document.forms</code></li></ul></li><li>节点指针<ul><li>父节点：<code>parentNode</code></li><li>同级节点：<code>previousSibling、nextSibling</code></li><li>子节点：<code>firstChild、lastChild、childNodes、children</code></li></ul></li></ul></li><li>操作<ul><li>创建：<code>createElement、createAttribute、createTextNode</code></li><li>插入：<code>appendChild、insertBefore</code></li><li>替换：<code>replaceChild</code></li><li>复制：<code>cloneNode</code></li><li>删除：<code>removeChild</code></li><li>样式：<code>dom.style.样式名</code><ul><li>样式名必须使用驼峰命名法</li><li>修改 class 时必须使用 className</li></ul></li></ul></li><li>属性<ul><li>获取：<code>getAttribute</code></li><li>设置：<code>setAttribute</code></li><li>移除：<code>removeAttribute</code></li></ul></li><li>文本<ul><li>获取：<code>innerHTML / innerText</code></li><li>设置：<code>dom.innerHTML / innerText = \"new\"</code></li><li>表单元素：<code>input.value、input.value = “new”</code></li></ul></li></ol><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 设置元素属性</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> box = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"box\"</span>);</span><br><span class=\"line\">box.setAttribute(<span class=\"string\">\"title\"</span>, <span class=\"string\">\"this is box\"</span>);  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(box.getAttribute(<span class=\"string\">\"title\"</span>));  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"comment\">// 创建属性节点</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> placeholder = <span class=\"built_in\">document</span>.createAttribute(<span class=\"string\">\"placeholder\"</span>);</span><br><span class=\"line\">placeholder.nodeValue = <span class=\"string\">\"请输入姓名\"</span>; </span><br><span class=\"line\">box.setAttributeNode(placeholder);</span><br></pre></td></tr></tbody></table></figure><h2 id=\"事件\"><a href=\"#事件\" class=\"headerlink\" title=\"事件\"></a>事件</h2><h3 id=\"DOM0-级\"><a href=\"#DOM0-级\" class=\"headerlink\" title=\"DOM0 级\"></a>DOM0 级</h3><blockquote><p>在 DOM 中直接绑定事件</p></blockquote><ul><li>绑定：<code>DOM.onclick = function(){ }</code></li><li>移除：<code>DOM.onclick = null / \"\"</code></li></ul><h3 id=\"DOM2-级\"><a href=\"#DOM2-级\" class=\"headerlink\" title=\"DOM2 级\"></a>DOM2 级</h3><blockquote><p>使用事件监听绑定事件，浏览器监听到用户执行相关操作做出响应</p></blockquote><ol><li>主流浏览器<ul><li>绑定：<code>DOM.addEventListener('click', fn, false)</code></li><li>移除：<code>DOM.removeEventListener('click', fn)</code></li><li>参数：false 时在冒泡阶段执行，true 则在捕获阶段执行</li></ul></li><li>IE8及以下<ul><li>绑定：<code>DOM.attachEvent('onclick', fn)</code></li><li>移除：<code>DOM.detachEvent('click', fn)</code></li></ul></li></ol><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// DOM0 级事件可能被覆盖：2，3，4</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> box = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'#box'</span>)</span><br><span class=\"line\">box.onclick = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    alert(<span class=\"number\">1</span>)</span><br><span class=\"line\">}</span><br><span class=\"line\">box.onclick = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    alert(<span class=\"number\">2</span>)</span><br><span class=\"line\">}</span><br><span class=\"line\">box.addEventListener(<span class=\"string\">'click'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    alert(<span class=\"number\">3</span>)</span><br><span class=\"line\">})</span><br><span class=\"line\">box.addEventListener(<span class=\"string\">'click'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    alert(<span class=\"number\">4</span>)</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h3 id=\"事件流\"><a href=\"#事件流\" class=\"headerlink\" title=\"事件流\"></a>事件流</h3><blockquote><p>事件的执行顺序</p></blockquote><ul><li>事件冒泡：事件从事件目标元素开始触发，向上触发到最外层的 document 对象</li><li>事件捕获：与冒泡相反</li><li>DOM 事件流：DOM 先捕获到目标元素，然后冒泡到最外层</li></ul><h3 id=\"事件对象\"><a href=\"#事件对象\" class=\"headerlink\" title=\"事件对象\"></a>事件对象</h3><blockquote><p>触发 DOM 上的某个事件时会产生一个事件对象 event，它包含着所有与事件有关的信息</p></blockquote><ol><li>属性：鼠标 / 键盘属性、IE 属性、标准 Event 属性</li><li>方法：stopPropagation、preventDefault</li><li><p>事件</p><ul><li>鼠标事件：<code>click、dbclick、mousedown、mousemove、mouseout、mouseover、mouseup</code></li><li>键盘事件：<code>keydown、keypress、keyup</code></li><li>HTML事件：<code>load、unload、resize、change、scroll、focus、blur、select、reset、submit</code></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  <span class=\"keyword\">var</span> Event = {</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 页面加载完成后</span></span><br><span class=\"line\">    readyEvent: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">fn</span>) </span>{  </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (fn == <span class=\"literal\">null</span>) { </span><br><span class=\"line\">            fn = <span class=\"built_in\">document</span>;</span><br><span class=\"line\">        } </span><br><span class=\"line\">        <span class=\"keyword\">var</span> oldonload = <span class=\"built_in\">window</span>.onload; </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> <span class=\"built_in\">window</span>.onload != <span class=\"string\">'function'</span>) {</span><br><span class=\"line\">            <span class=\"built_in\">window</span>.onload = fn; </span><br><span class=\"line\">        }<span class=\"keyword\">else</span>{</span><br><span class=\"line\">            <span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{ </span><br><span class=\"line\">                oldonload(); </span><br><span class=\"line\">                fn();</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }, </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 绑定事件</span></span><br><span class=\"line\">    addEvent: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">element, type, handler</span>) </span>{ </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (element.addEventListener) {    </span><br><span class=\"line\">              element.addEventListener(type, handler, <span class=\"literal\">false</span>); <span class=\"comment\">// DOM2</span></span><br><span class=\"line\">        }<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (element.attachEvent) { </span><br><span class=\"line\">            element.attachEvent(<span class=\"string\">'on'</span> + type, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">                  handler.call(element);     <span class=\"comment\">// 兼容IE</span></span><br><span class=\"line\">            }); </span><br><span class=\"line\">        }<span class=\"keyword\">else</span> { </span><br><span class=\"line\">            element[<span class=\"string\">'on'</span> + type] = handler;  <span class=\"comment\">// DOM0</span></span><br><span class=\"line\">        }</span><br><span class=\"line\">    },</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 移除事件 </span></span><br><span class=\"line\">    removeEvent: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">element, type, handler</span>) </span>{</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (element.removeEventListener) {</span><br><span class=\"line\">            element.removeEventListener(type, handler, <span class=\"literal\">false</span>); </span><br><span class=\"line\">        }<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (element.datachEvent) { </span><br><span class=\"line\">            element.datachEvent(<span class=\"string\">'on'</span> + type, handler); </span><br><span class=\"line\">        }<span class=\"keyword\">else</span>{</span><br><span class=\"line\">            element[<span class=\"string\">'on'</span> + type] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    },</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 获取应用到元素上的所有样式</span></span><br><span class=\"line\">    getStyle: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">obj</span>)</span>{</span><br><span class=\"line\">        <span class=\"keyword\">var</span> style = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">window</span>.getComputedStyle){</span><br><span class=\"line\">            style = <span class=\"built_in\">window</span>.getComputedStyle(obj,<span class=\"literal\">null</span>);  <span class=\"comment\">// W3C</span></span><br><span class=\"line\">        }<span class=\"keyword\">else</span>{</span><br><span class=\"line\">            style = obj.currentStyle;   <span class=\"comment\">// IE</span></span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"keyword\">return</span> style;</span><br><span class=\"line\">    },</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 获取事件对象，确保随时可以使用</span></span><br><span class=\"line\">    getEvent: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>{ </span><br><span class=\"line\">        <span class=\"keyword\">var</span> ev = e || <span class=\"built_in\">window</span>.event;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!ev){ </span><br><span class=\"line\">            <span class=\"keyword\">var</span> c = <span class=\"keyword\">this</span>.getEvent.caller; </span><br><span class=\"line\">            <span class=\"keyword\">while</span>(c) { </span><br><span class=\"line\">                ev = c.argument[<span class=\"number\">0</span>]; </span><br><span class=\"line\">                <span class=\"keyword\">if</span> (ev && Event == ev.constructor) {</span><br><span class=\"line\">                        <span class=\"keyword\">break</span>; </span><br><span class=\"line\">                } </span><br><span class=\"line\">                c = c.caller; </span><br><span class=\"line\">            } </span><br><span class=\"line\">        } </span><br><span class=\"line\">        <span class=\"keyword\">return</span> ev; </span><br><span class=\"line\">    },</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 获取触发事件的元素 </span></span><br><span class=\"line\">    getTarget: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>{ </span><br><span class=\"line\">        <span class=\"keyword\">return</span> event.target || event.srcElemnt; </span><br><span class=\"line\">    },</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 阻止冒泡，比如 父子元素都有事件时阻止同时触发</span></span><br><span class=\"line\">    stopPropagation: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">ev</span>) </span>{ </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (ev.stopPropagation) { </span><br><span class=\"line\">            ev.stopPropagation(); </span><br><span class=\"line\">        }<span class=\"keyword\">else</span> { </span><br><span class=\"line\">            ev.cancelBubble = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }, </span><br><span class=\"line\">    stop_propagation: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{ </span><br><span class=\"line\">        <span class=\"keyword\">var</span> e = <span class=\"built_in\">window</span>.event || <span class=\"built_in\">arguments</span>.callee.caller.arguments[<span class=\"number\">0</span>];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(e && e.stopPropagation){ </span><br><span class=\"line\">            e.stopPropagation();   </span><br><span class=\"line\">        }<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"built_in\">window</span>.event){ </span><br><span class=\"line\">            <span class=\"built_in\">window</span>.event.cancelBubble = <span class=\"literal\">true</span>;  </span><br><span class=\"line\">        }</span><br><span class=\"line\">    }, </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 阻止浏览器默认行为，比如 点击提交按钮时阻止默认提交表单、a链接阻止默认跳转</span></span><br><span class=\"line\">    preventDefault: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">ev</span>) </span>{</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (ev.preventDefault) { </span><br><span class=\"line\">            ev.preventDefault(); </span><br><span class=\"line\">        }<span class=\"keyword\">else</span>{</span><br><span class=\"line\">            ev.returnValue = <span class=\"literal\">false</span>; </span><br><span class=\"line\">        }</span><br><span class=\"line\">    } </span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure></li></ol><h3 id=\"事件委托\"><a href=\"#事件委托\" class=\"headerlink\" title=\"事件委托\"></a>事件委托</h3><blockquote><p>利用事件冒泡原理，将本该元素执行的事件委托给了它的父元素执行</p></blockquote><ol><li><p>优势</p><ul><li>节省内存，提升性能</li><li>减少DOM操作，运行效率更高</li></ul></li><li><p>适用场景</p><ul><li>给多个同类元素绑定相同事件</li><li>给动态生成的新元素绑定事件</li></ul></li><li><p>实现代码</p><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 为三个同级的 input 绑定点击事件</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> box = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"box\"</span>);</span><br><span class=\"line\"><span class=\"comment\">// box.on(\"click\", \"input\", callback) </span></span><br><span class=\"line\">box.onclick = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">ev</span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ev = ev || <span class=\"built_in\">window</span>.event;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> target = ev.target || ev.srcElement;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 判断元素：target.className == \"box\"</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(target.nodeName.toLocaleLowerCase() == <span class=\"string\">'input'</span>){</span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(target.id){</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'add'</span> :</span><br><span class=\"line\">                <span class=\"built_in\">console</span>.log(<span class=\"string\">'添加'</span>);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'remove'</span> :</span><br><span class=\"line\">                <span class=\"built_in\">console</span>.log(<span class=\"string\">'删除'</span>);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'select'</span> :</span><br><span class=\"line\">                <span class=\"built_in\">console</span>.log(<span class=\"string\">'选择'</span>);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 为添加的子元素绑定事件</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> btn = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"btn\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> oUl = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"ul1\"</span>);</span><br><span class=\"line\">oUl.addEventListener(<span class=\"string\">'mousedown'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">ev</span>)</span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ev = ev || <span class=\"built_in\">window</span>.event;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> target = ev.target || ev.srcElement;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(target.nodeName.toLocaleLowerCase() == <span class=\"string\">'li'</span>){</span><br><span class=\"line\">        ev.target.style.backgroundColor=<span class=\"string\">\"black\"</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\">});</span><br><span class=\"line\">btn.onclick = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> oLi = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'li'</span>);</span><br><span class=\"line\">    oLi.innerHTML = <span class=\"number\">4</span>;</span><br><span class=\"line\">    oUl.appendChild(oLi);</span><br><span class=\"line\">};</span><br></pre></td></tr></tbody></table></figure></li></ol><h1 id=\"四、BOM\"><a href=\"#四、BOM\" class=\"headerlink\" title=\"四、BOM\"></a>四、BOM</h1><blockquote><p>浏览器对象模型，用于操作浏览器本身的应用编程接口</p></blockquote><div align=\"center\"><br><br><img src=\"images/js/bom.png\" alt=\"BOM\"><br></div><!-- rebuild by neat --></body></html>","site":{"data":{"next":{"override":false,"cache":{"enable":true},"favicon":{"small":"/images/favicon-16.ico","medium":"/images/favicon-32.ico","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"rss":"/atom.xml","footer":{"since":2019,"icon":{"name":"snowflake-o","animated":false,"color":"#808080"},"copyright":"chuangge","powered":{"enable":false,"version":true},"theme":{"enable":false,"version":true},"beian":{"enable":false,"icp":null}},"creative_commons":{"license":"by-nc-sa","sidebar":false,"post":false},"canonical":true,"seo":false,"index_with_subtitle":false,"exturl":false,"menu":{"home":"/ || home  //首页","tags":"/tags/ || tags  //标签","categories":"/categories/ || th   //分类","archives":"/archives/ || archive //归档"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":{"GitHub":"https://github.com/ || github","StackOverflow":"https://stackoverflow.com/ || stack-overflow"},"social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"友情链接","links_layout":"inline","links":{"个人简历":"https://chuanggefighting.github.io/project/","印记中文":"https://www.docschina.org/","在线工具":"http://tool.lu/","Learn Anything":"https://learn-anything.xyz/"},"avatar":{"url":"/images/chuang.png","rounded":true,"opacity":1,"rotated":true},"toc":{"enable":true,"number":true,"wrap":false,"max_depth":6},"sidebar":{"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"read_more_btn":true,"post_meta":{"item_text":true,"created_at":true,"updated_at":{"enabled":true,"another_day":true},"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":true,"awl":4,"wpm":275},"codeblock":{"border_radius":null,"copy_button":{"enable":false,"show_result":false}},"reward":{"enable":false},"related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_edit":{"enable":false,"url":"https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name"},"disable_baidu_tranformation":false,"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"font":{"enable":true,"host":"//fonts.proxy.ustclug.org","global":{"external":true,"family":"Lato","size":16},"headings":{"external":true,"family":"Roboto Slab","size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":"Lobster Two","size":24},"codes":{"external":true,"family":"Roboto Mono","size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css","copy_tex":{"enable":false,"copy_tex_js":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js","copy_tex_css":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css"}}},"pdf":{"enable":false,"per_page":true,"height":"500px","pdfobject":{"cdn":"//cdn.jsdelivr.net/npm/pdfobject@2.1.1/pdfobject.min.js"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":true,"appid":"snOvapuSplYTVflf5p9Ml9JX-gzGzoHsz","appkey":"5ABGdfyEdAtu6lTXdGdo7hf9","notify":false,"verify":false,"placeholder":"ヾﾉ≧∀≦)o 来呀！吐槽一番吧！","avatar":"mm","guest_info":"nick,mail,link","pageSize":10,"visitor":false,"comment_count":true},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"gitalk":{"enable":false,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true},"needmoreshare2":{"enable":true,"postbottom":{"enable":true,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null,"security":false,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":true,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":true,"pace_theme":"pace-theme-center-simple","canvas_nest":{"enable":true,"onmobile":true,"color":"0,0,255","opacity":0.5,"zIndex":-1,"count":99},"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"canvas_nest_nomobile":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"leancloud":null,"valine":null,"gitalk_js":null,"gitalk_css":null,"md5":null},"css":"css","js":"js","images":"images","passage_end_tag":{"enabled":true},"daovoice":true,"daovoice_app_id":"2ed51855"}}},"excerpt":"","more":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><h1 id=\"一、Javascript\"><a href=\"#一、Javascript\" class=\"headerlink\" title=\"一、Javascript\"></a>一、Javascript</h1><blockquote><p>JavaScript 由对象组成，一切皆为对象</p></blockquote><h2 id=\"组成部分\"><a href=\"#组成部分\" class=\"headerlink\" title=\"组成部分\"></a>组成部分</h2><ul><li><strong>ECMAScript</strong>：核心，描述了JS的语法和基本对象</li><li><strong>DOM</strong>：文档对象模型，处理网页内容的方法和接口</li><li><strong>BOM</strong>：浏览器对象模型，与浏览器交互的方法和接口</li></ul><h2 id=\"语言特点\"><a href=\"#语言特点\" class=\"headerlink\" title=\"语言特点\"></a>语言特点</h2><ul><li>解释型的脚本语言：在程序的运行过程中逐行进行解释</li><li>语法简单：使用弱类型的变量，对数据类型也没有严格要求</li><li>事件驱动：通过事件对用户操作做出响应</li><li>跨平台性：不依赖于操作系统，只需要兼容浏览器即可</li></ul><h2 id=\"历史演变\"><a href=\"#历史演变\" class=\"headerlink\" title=\"历史演变\"></a>历史演变</h2><ul><li>始于1995年，前身为网景公司开发的 LiveScript，用来处理 以前由服务端负责的数据验证</li><li>后更名为JavaScript，功能演变为：前后端数据交互、页面特效、服务端开发 NodeJS</li><li>JS 的很多语法和 Java、C# 语法相似，和 Java 毫无关系</li></ul><h1 id=\"二、ECMAScript\"><a href=\"#二、ECMAScript\" class=\"headerlink\" title=\"二、ECMAScript\"></a>二、ECMAScript</h1><blockquote><p>一种根据 ECMA-262 标准制定的通用脚本语言规范，JavaScript 是遵守该标准实现的一种脚本语言</p></blockquote><h2 id=\"变量\"><a href=\"#变量\" class=\"headerlink\" title=\"变量\"></a>变量</h2><h3 id=\"命名\"><a href=\"#命名\" class=\"headerlink\" title=\"命名\"></a>命名</h3><ul><li>方法：匈牙利命名法、驼峰命名法</li><li>规则<ul><li>首字符：英文字母、下划线</li><li>组成：英文字母、下划线、数字</li><li>禁忌：关键字、保留字</li></ul></li></ul><h3 id=\"声明\"><a href=\"#声明\" class=\"headerlink\" title=\"声明\"></a>声明</h3><ul><li>显式声明：<code>var 变量名</code></li><li>错误用法：没有类型、重复声明、隐式声明、不声明直接使用</li><li>正确用法：先声明后读写、先赋值后运算</li></ul><h3 id=\"作用域\"><a href=\"#作用域\" class=\"headerlink\" title=\"作用域\"></a>作用域</h3><ol><li>全局变量<ul><li>包含：在函数外定义的变量，没有使用 var 的变量</li><li>调用：任何位置</li></ul></li><li>局部变量<ul><li>包含：在函数内使用 var 声明的变量，函数的参数变量</li><li>调用：当前函数体内</li></ul></li><li>优先级<ul><li>局部变量 &gt; 同名参数变量 &gt; 同名全局变量</li></ul></li><li>特性<ul><li>忽略块级用域<ul><li>ES6之前，js的作用域只有 函数作用域和全局作用域</li><li>ES6中定义了块级作用域，有“暂时性死区”的特性（声明前不可用）</li></ul></li><li>作用域链<ul><li>内层函数可以访问外层函数的局部变量</li><li>外层函数不能访问内层函数的局部变量<br>生命周期</li><li>全局变量除非被显式删除，否则一直存在</li><li>局部变量从声明开始到函数运行完毕或被显式删除</li><li>回收机制有 标记清除、引用计数</li></ul></li></ul></li></ol><h3 id=\"面试题\"><a href=\"#面试题\" class=\"headerlink\" title=\"面试题\"></a>面试题</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">      say: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(say)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">obj.say()   <span class=\"comment\">// 报错，没有在函数作用域内创建 fn</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"number\">2</span>;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(a);   <span class=\"comment\">// 2，遵循就近原则</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">test();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test2</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(a);   <span class=\"comment\">// undefined，变量提升</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"number\">2</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">test2(); </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">1</span>; </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test3</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(a);   <span class=\"comment\">// 1，重新赋值而未重新声明</span></span><br><span class=\"line\">  a = <span class=\"number\">2</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">test3();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> b = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test4</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(b); <span class=\"comment\">// 报错，let 不能变量提升</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> b = <span class=\"number\">2</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">test4();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test5</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> a = <span class=\"number\">1</span>;</span><br><span class=\"line\">  &#123; <span class=\"keyword\">let</span> a = <span class=\"number\">2</span>; &#125;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(a);  <span class=\"comment\">// 1，console不在块级作用域中</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">test5();</span><br></pre></td></tr></table></figure><h2 id=\"数据类型\"><a href=\"#数据类型\" class=\"headerlink\" title=\"数据类型\"></a>数据类型</h2><blockquote><p>分为原始数据和引用数据，js 变量的类型会根据其所赋值的数据类型来决定</p></blockquote><h3 id=\"基本数据\"><a href=\"#基本数据\" class=\"headerlink\" title=\"基本数据\"></a>基本数据</h3><ul><li>即原始值：<code>Number、String、Boolean、undefined、Null</code></li><li>6 个假值：<code>0、&quot; &quot;、undefined、null、NaN、false</code></li><li>存储方式：存储在栈中的简单数据段。js 可按值访问其实际保存的值，复制时则会创建其副本</li><li>检测方法：<code>typeof</code></li></ul><h3 id=\"引用数据\"><a href=\"#引用数据\" class=\"headerlink\" title=\"引用数据\"></a>引用数据</h3><ul><li>即引用值：<code>Object</code></li><li>存储方式：存储在堆中的对象。js按引用访问其值，即访问时先从栈中读取内存地址（大小固定，保存于栈中），然后再找到保存在堆内存中的值。复制时只是复制了地址，两个对象实际指向的都是同一个值。</li><li>检测方法：<code>instanceof</code></li></ul><h3 id=\"栈和堆\"><a href=\"#栈和堆\" class=\"headerlink\" title=\"栈和堆\"></a>栈和堆</h3><ul><li><strong>栈 stack</strong>：可理解为一个无盖水缸，它会自动分配内存空间和释放。用于存储基本数据类型，具有空间大小固定和先进后出的特点。</li><li><strong>堆 heap</strong>：可理解为封闭盒子，动态分配内存，大小不固定而且不会自动释放。用于存储基本数据类型包装起来的类，实际上保存的不是变量本身，而是指向该对象的指针。</li></ul><h3 id=\"类型转换\"><a href=\"#类型转换\" class=\"headerlink\" title=\"类型转换\"></a>类型转换</h3><ul><li>强制转换：<code>Boolean()、Number()、String()</code></li><li>普通转换：<code>parseInt()、parseFloat()、num.toString()</code></li></ul><h2 id=\"运算符\"><a href=\"#运算符\" class=\"headerlink\" title=\"运算符\"></a>运算符</h2><ul><li>算术运算符：<code>+、-、*、/、%、++、--</code></li><li>赋值运算符：<code>=、+=、-=、*=、/=</code></li><li>字符串运算符：<code>+、+=</code></li><li>比较运算符：<code>&amp;gt;、&amp;lt;、&amp;gt;=、&amp;lt;=、==、!=、===、!==</code></li><li>逻辑运算符：<code>&amp;&amp;、||、!</code></li><li>三元运算符：<code>?:</code></li></ul><h2 id=\"流程语句\"><a href=\"#流程语句\" class=\"headerlink\" title=\"流程语句\"></a>流程语句</h2><h3 id=\"循环语句\"><a href=\"#循环语句\" class=\"headerlink\" title=\"循环语句\"></a>循环语句</h3><ul><li>while：<code>while(条件表达式) { 代码段 }</code></li><li>do-while：<code>do{ 代码段 } while(条件表达式)</code></li><li>for：<code>for(循环变量 = 初值; 循环条件; 递增/递减){ 代码段 }</code></li><li>for-in：<code>for(声明变量 in 对象){ 代码段 }</code></li></ul><h3 id=\"跳转语句\"><a href=\"#跳转语句\" class=\"headerlink\" title=\"跳转语句\"></a>跳转语句</h3><ul><li>return：终止函数体的运行，并返回一个值</li><li>break：终止整个循环，不再判断</li><li>continue：结束本次循环，判断是否执行下次循环</li></ul><h3 id=\"选择语句\"><a href=\"#选择语句\" class=\"headerlink\" title=\"选择语句\"></a>选择语句</h3><ul><li>if：<code>if(条件1){ } else if(条件2){ } else{ }</code></li><li>switch：<code>switch(条件){ case 1: break; default: break; }</code></li><li>三元表达式：<code>var res = x&gt;0 ? 1 : (x=0 ? -1 : 2)</code></li></ul><h3 id=\"异常处理语句\"><a href=\"#异常处理语句\" class=\"headerlink\" title=\"异常处理语句\"></a>异常处理语句</h3><ul><li>throw：主动抛出异常</li><li>try：指明需要处理的代码段</li><li>catch：捕获异常</li><li>finally：后期处理</li></ul><h2 id=\"函数\"><a href=\"#函数\" class=\"headerlink\" title=\"函数\"></a>函数</h2><blockquote><p>一段可以反复调用的代码块</p></blockquote><h3 id=\"分类\"><a href=\"#分类\" class=\"headerlink\" title=\"分类\"></a>分类</h3><ul><li>普通函数</li><li>构造函数：类，可分为 内置类和自定义类</li><li>函数对象：通过 new Function() 创建的对象</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1、普通函数</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 函数声明</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f1</span>(<span class=\"params\"></span>)</span>&#123;  &#125; </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 函数表达式    </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> f2 = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; &#125;  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 回调函数 callback：特定条件下调用</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f</span>(<span class=\"params\">num, callback</span>)</span>&#123;   </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(num == <span class=\"number\">3</span>)&#123;</span><br><span class=\"line\">      callback();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 自执行函数 IIFE：独立作用域而不会污染全局环境</span></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">x, y</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(x + y);</span><br><span class=\"line\">&#125;)(<span class=\"number\">2</span>, <span class=\"number\">3</span>);</span><br><span class=\"line\">;(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">111</span>);</span><br><span class=\"line\">&#125;)();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2-1、内置类</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> f3 = <span class=\"keyword\">new</span> <span class=\"built_in\">Function</span>(<span class=\"string\">'a'</span>,<span class=\"string\">'b'</span>,<span class=\"string\">'c'</span>,<span class=\"string\">'return a+b'</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(f3.constructor);   <span class=\"comment\">// 当前实例所属类</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2-2、自定义类</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name, age</span>)</span>&#123; </span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.age = age;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">1</span>;  <span class=\"comment\">// return 基本类型则被忽略</span></span><br><span class=\"line\">    <span class=\"comment\">// return &#123; 'Jack': 18 &#125;; // return 引用类型则被返回</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Person.prototype.eat = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; &#125;;  </span><br><span class=\"line\"><span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> Person(<span class=\"string\">'Tom'</span>, <span class=\"number\">20</span>);  </span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3、函数对象</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> f4 = <span class=\"keyword\">new</span> <span class=\"built_in\">Function</span>(<span class=\"string\">'str'</span>, <span class=\"string\">'console.log(str)'</span>);</span><br></pre></td></tr></table></figure><h3 id=\"调用\"><a href=\"#调用\" class=\"headerlink\" title=\"调用\"></a>调用</h3><ul><li>函数模式：<code>fn()</code></li><li>方法模式：<code>obj.fn()、绑定 html 标签</code></li><li>构造器模式：<code>new</code></li><li>上下文模式：<code>call / apply</code></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">m, n</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> m + n;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 函数调用</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> f1 = foo(<span class=\"number\">1</span>, <span class=\"number\">5</span>);</span><br><span class=\"line\"><span class=\"comment\">// 以 window 为上下文调用</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> f1 = foo.apply(<span class=\"literal\">null</span>, [<span class=\"number\">1</span>, <span class=\"number\">5</span>])</span><br><span class=\"line\"><span class=\"keyword\">var</span> f1 = foo.call(<span class=\"literal\">null</span>, <span class=\"number\">1</span>, <span class=\"number\">5</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    age: <span class=\"number\">20</span>,</span><br><span class=\"line\">    getAge: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.age;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 方法调用</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> f2 = obj.getAge();</span><br><span class=\"line\"><span class=\"comment\">//  以 obj 为上下文调用</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> f2 = obj.getAge.apply(obj);</span><br><span class=\"line\"><span class=\"keyword\">var</span> f2 = obj.getAge.call(obj);</span><br></pre></td></tr></table></figure><h3 id=\"apply-和-call\"><a href=\"#apply-和-call\" class=\"headerlink\" title=\"apply 和 call\"></a>apply 和 call</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1、改变 this 指向</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">'linxin'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">foo.call(obj);   <span class=\"comment\">// linxin</span></span><br><span class=\"line\"><span class=\"comment\">// obj 作为参数传给了 foo，此时函数中的 this 便指向了 obj。foo函数里相当于</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">func</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(obj.name);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2、借用别的对象的方法</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Person1  = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = <span class=\"string\">'linxin'</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> Person2 = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.getname = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 使用 Person1 对象代替 this 对象，所以 Person2 继承了 Person1 的属性和方法</span></span><br><span class=\"line\">    Person1.call(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> person = <span class=\"keyword\">new</span> Person2();</span><br><span class=\"line\">person.getname();  <span class=\"comment\">// linxin</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3、调用函数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'linxin'</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">fn.call();  <span class=\"comment\">// linxin</span></span><br></pre></td></tr></table></figure><h3 id=\"this-指向\"><a href=\"#this-指向\" class=\"headerlink\" title=\"this 指向\"></a>this 指向</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'tom'</span>,</span><br><span class=\"line\">      getName: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.name;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj2 = &#123; <span class=\"attr\">name</span>: <span class=\"string\">'tony'</span> &#125;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(obj.getName());  <span class=\"comment\">// tom，this 指向对象本身</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> getName = obj.getName;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(getName());      <span class=\"comment\">// 空，此时方法中的 this 指向 window 对象</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(getName.apply(obj2))    <span class=\"comment\">// tony，this 指向了 obj2 对象</span></span><br></pre></td></tr></table></figure><h3 id=\"函数前置\"><a href=\"#函数前置\" class=\"headerlink\" title=\"函数前置\"></a>函数前置</h3><div style=\"text-indent:2em\">函数声明会被 js解析器 优先读取，有重名的只留一个（变量和函数重名只留函数）。表达式只有在执行该语句时才会被逐行解析，而函数只有在被调用时才执行内部封装的函数体。</div><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">f1() </span><br><span class=\"line\"><span class=\"keyword\">var</span> f1 = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; &#125;   <span class=\"comment\">//报错</span></span><br><span class=\"line\"></span><br><span class=\"line\">f2() </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f2</span>(<span class=\"params\"></span>)</span>&#123; &#125;        <span class=\"comment\">// 正常</span></span><br></pre></td></tr></table></figure><h3 id=\"函数标识\"><a href=\"#函数标识\" class=\"headerlink\" title=\"函数标识\"></a>函数标识</h3><ul><li>this：指向当前操作对象</li><li>callee：指向参数集合所属对象</li><li>prototype：指向函数附带的原型对象</li><li>constructor：指向创建该对象的构造函数</li></ul><h3 id=\"闭包\"><a href=\"#闭包\" class=\"headerlink\" title=\"闭包\"></a>闭包</h3><blockquote><p>指有权访问另一个函数作用域变量的函数，一般是定义在外层函数中的内层函数，主要是用来设计私有的方法和变量</p></blockquote><div style=\"text-indent:2em\">局部变量无法共享和长久的保存，而全局变量可能造成变量污染，所以我们希望有一种机制既可以长久的保存变量以便反复使用，但又不会造成全局污染。闭包的优点是可以避免全局变量的污染，缺点是闭包会常驻内存，会增大内存使用量，使用不当很容易造成内存泄露。</div><ul><li>特性<ul><li>函数嵌套函数</li><li>函数内部可以引用外部的参数和变量</li><li>参数和变量不会被垃圾回收机制回收</li></ul></li><li><p>用途：</p><ul><li>数据缓存</li><li>封装私有变量</li><li>封装自定义插件</li><li>实现类和继承</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 异步获取数据并缓存</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> getList = (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> data = &#123;&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> getData = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> packageOptions = &#123;</span><br><span class=\"line\">                url: <span class=\"string\">'/names'</span>,</span><br><span class=\"line\">                params: &#123;</span><br><span class=\"line\">                    normal: <span class=\"number\">1</span></span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                success: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">rsp</span>) </span>&#123;</span><br><span class=\"line\">                    data = rsp.data</span><br><span class=\"line\">                    resolve();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            ajax(packageOptions);</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 闭包存储data</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> result = <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">type</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (JONS.stringify(data) === <span class=\"string\">'&#123;&#125;'</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">await</span> getData();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> data;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> data;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;)() </span><br><span class=\"line\">getList().then(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 封装私有变量</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> person = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;     </span><br><span class=\"line\">    <span class=\"keyword\">var</span> name = <span class=\"string\">\"default\"</span>;       </span><br><span class=\"line\">      </span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;    </span><br><span class=\"line\">        getName : <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;    </span><br><span class=\"line\">            <span class=\"keyword\">return</span> name;    </span><br><span class=\"line\">        &#125;,    </span><br><span class=\"line\">        setName : <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">newName</span>)</span>&#123;    </span><br><span class=\"line\">            name = newName;    </span><br><span class=\"line\">      &#125;    </span><br><span class=\"line\">    &#125;    </span><br><span class=\"line\">&#125;();    </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(person.name);       <span class=\"comment\">// undefined    </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(person.getName());  <span class=\"comment\">// default  </span></span><br><span class=\"line\">person.setName(<span class=\"string\">\"chuang\"</span>);    </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(person.getName());  <span class=\"comment\">// chuang  </span></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 封装插件：匿名自执行函数执行完后会立刻释放资源</span></span><br><span class=\"line\">;(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">document</span>) </span>&#123; </span><br><span class=\"line\">  <span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">        setColor: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">id, color</span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"built_in\">document</span>.getElementById(id).style.color = color;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.view = obj;  <span class=\"comment\">// 暴露接口</span></span><br><span class=\"line\">&#125;)(<span class=\"built_in\">document</span>);</span><br><span class=\"line\">view.setColor(<span class=\"string\">'main'</span>,<span class=\"string\">'red'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 实现类和继承</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\"></span>)</span>&#123;    </span><br><span class=\"line\">  <span class=\"keyword\">var</span> name = <span class=\"string\">\"default\"</span>;       </span><br><span class=\"line\">     </span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;    </span><br><span class=\"line\">     getName: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;    </span><br><span class=\"line\">         <span class=\"keyword\">return</span> name;    </span><br><span class=\"line\">     &#125;,    </span><br><span class=\"line\">     setName: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">newName</span>)</span>&#123;    </span><br><span class=\"line\">         name = newName;    </span><br><span class=\"line\">     &#125;    </span><br><span class=\"line\">  &#125;    </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> Person();</span><br><span class=\"line\">p.setName(<span class=\"string\">\"Tom\"</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(p.getName());</span><br></pre></td></tr></table></figure></li></ul><h2 id=\"正则表达式\"><a href=\"#正则表达式\" class=\"headerlink\" title=\"正则表达式\"></a>正则表达式</h2><blockquote><p>使用 <code>RegExp</code> 对象表示并由元字符、字符串和量词组成，用于描述字符串的匹配规则</p></blockquote><h3 id=\"创建\"><a href=\"#创建\" class=\"headerlink\" title=\"创建\"></a>创建</h3><ol><li>方式<ul><li>字面量：<code>/pattern/attributes</code>，特殊字符不需要转义，不支持字符串拼接</li><li>实例化：<code>new RegExp(“pattern”, “attributes”)</code>，特殊字符需要转义，支持字符串拼接</li></ul></li><li><p>参数</p><ul><li>pattern：正则表达式</li><li>attributes：匹配模式，<code>g、i、m</code> 分别表示 全局匹配、忽略大小写、多行匹配</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> regExp = <span class=\"string\">'ab'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 字面量 </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> reg_1 = <span class=\"regexp\">/regExp/</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> reg_1 = <span class=\"regexp\">/^[a-zA-Z0-9]&#123;3,8&#125;$/</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 实例化</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> reg_2 = <span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(regExp+<span class=\"string\">'1'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> reg_2 = <span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(“[a-zA-Z0<span class=\"number\">-9</span>]&#123;<span class=\"number\">3</span>,<span class=\"number\">8</span>&#125;”);</span><br></pre></td></tr></table></figure></li></ol><h3 id=\"基础语法\"><a href=\"#基础语法\" class=\"headerlink\" title=\"基础语法\"></a>基础语法</h3><div align=\"center\"><br><img src=\"images/js/regExp.png\" alt=\"regExp\"><br></div><h2 id=\"全局对象\"><a href=\"#全局对象\" class=\"headerlink\" title=\"全局对象\"></a>全局对象</h2><blockquote><p>Window 对象，表示允许 JavaScript 代码访问的 Web 浏览器窗口</p></blockquote><h3 id=\"全局函数\"><a href=\"#全局函数\" class=\"headerlink\" title=\"全局函数\"></a>全局函数</h3><ul><li>编码：<code>encodeURI、encodeURIComponent、escape</code></li><li>解码：<code>decodeURI、decodeURIComponent、unescape</code></li><li>检测：<code>isNaN、isFinite</code></li><li>转换：<code>eval、String、Number</code></li><li>解析：<code>parseInt、parseFloat</code></li></ul><h3 id=\"全局属性\"><a href=\"#全局属性\" class=\"headerlink\" title=\"全局属性\"></a>全局属性</h3><ul><li>NaN：不是数字值</li><li>undefined：未定义的值</li><li>Infinity：正无穷大的数值</li></ul><h2 id=\"计时器\"><a href=\"#计时器\" class=\"headerlink\" title=\"计时器\"></a>计时器</h2><div style=\"text-indent:2em\">requestAnimationFrame 采用系统时间间隔来保持最佳绘制效率而不需要手动设置，这样就不会因间隔时间过短而会造成 过度绘制并增加开销，也不会因时间太长则导致 动画卡顿不流畅，让各种网页动画效果能够有一个统一的刷新机制，从而节省系统资源，提高系统性能，改善视觉效果。</div><ul><li><strong>setTimeout</strong>：延时执行指定代码, 取消时使用 clearTimeout</li><li><strong>setInterval</strong>：间隔时间重复执行代码, 取消时使用 clearInterval</li><li><p><strong>requestAnimationFrame</strong>：在浏览器每次刷新页面之前执行代码，时间间隔由浏览器刷新频率决定，取消时使用 cancelAnimationFrame</p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> box = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"box\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> timer = requestAnimationFrame(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">step</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> width = <span class=\"built_in\">parseInt</span>(box.style.width);</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(width &amp;lt; <span class=\"number\">500</span>)&#123;</span><br><span class=\"line\">          box.style.width = width + <span class=\"number\">10</span>;</span><br><span class=\"line\">          requestAnimationFrame(step);</span><br><span class=\"line\">      &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">          cancelAnimationFrame(timer);</span><br><span class=\"line\">      &#125; </span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></li></ul><h1 id=\"三、DOM\"><a href=\"#三、DOM\" class=\"headerlink\" title=\"三、DOM\"></a>三、DOM</h1><blockquote><p>文档对象模型，用于操作 HTML 和 XML 文档（浏览器内容）的编程接口</p></blockquote><h2 id=\"节点\"><a href=\"#节点\" class=\"headerlink\" title=\"节点\"></a>节点</h2><div style=\"text-indent:2em\">DOM 将整个文档（XML文档和HTML文档）看作一个树形结构，并用document对象表示该文档，并规定其中每个成分都是一个节点（Node），JavaScript 通过 DOM API 可以操作到每个节点。</div><h3 id=\"节点信息\"><a href=\"#节点信息\" class=\"headerlink\" title=\"节点信息\"></a>节点信息</h3><ul><li><code>nodeType</code>：节点类型</li><li><code>nodeName</code>：节点名称</li><li><code>nodeValue</code>：节点值</li></ul><h3 id=\"节点类型\"><a href=\"#节点类型\" class=\"headerlink\" title=\"节点类型\"></a>节点类型</h3><ul><li>文档节点：整个文档</li><li>注释节点：文档注释</li><li>元素节点：html 标签</li><li>文本节点：元素/属性节点中的文本内容</li><li><p>属性节点：元素节点的属性</p><div align=\"center\"><br><img src=\"images/js/domNodes.png\" alt=\"节点类型\"><br></div></li></ul><h3 id=\"文档节点\"><a href=\"#文档节点\" class=\"headerlink\" title=\"文档节点\"></a>文档节点</h3><ul><li>标签：<code>document.documentElement/body/forms</code></li><li>信息：<code>document.URL/domain/readyState</code></li><li>方法：<code>document.write/writeln/open/close</code></li></ul><h3 id=\"元素节点\"><a href=\"#元素节点\" class=\"headerlink\" title=\"元素节点\"></a>元素节点</h3><blockquote><p>文本节点、属性节点都属于元素节点的子节点，操作时都需要先获取 元素节点</p></blockquote><ol><li>获取<ul><li>document<ul><li><code>document.getElementById/TagName/ClassName/Name</code></li><li><code>document.querySelector [All]</code></li><li><code>document.documentElement</code></li><li><code>document.body</code></li><li><code>document.forms</code></li></ul></li><li>节点指针<ul><li>父节点：<code>parentNode</code></li><li>同级节点：<code>previousSibling、nextSibling</code></li><li>子节点：<code>firstChild、lastChild、childNodes、children</code></li></ul></li></ul></li><li>操作<ul><li>创建：<code>createElement、createAttribute、createTextNode</code></li><li>插入：<code>appendChild、insertBefore</code></li><li>替换：<code>replaceChild</code></li><li>复制：<code>cloneNode</code></li><li>删除：<code>removeChild</code></li><li>样式：<code>dom.style.样式名</code><ul><li>样式名必须使用驼峰命名法</li><li>修改 class 时必须使用 className</li></ul></li></ul></li><li>属性<ul><li>获取：<code>getAttribute</code></li><li>设置：<code>setAttribute</code></li><li>移除：<code>removeAttribute</code></li></ul></li><li>文本<ul><li>获取：<code>innerHTML / innerText</code></li><li>设置：<code>dom.innerHTML / innerText = &quot;new&quot;</code></li><li>表单元素：<code>input.value、input.value = “new”</code></li></ul></li></ol><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 设置元素属性</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> box = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"box\"</span>);</span><br><span class=\"line\">box.setAttribute(<span class=\"string\">\"title\"</span>, <span class=\"string\">\"this is box\"</span>);  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(box.getAttribute(<span class=\"string\">\"title\"</span>));  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"comment\">// 创建属性节点</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> placeholder = <span class=\"built_in\">document</span>.createAttribute(<span class=\"string\">\"placeholder\"</span>);</span><br><span class=\"line\">placeholder.nodeValue = <span class=\"string\">\"请输入姓名\"</span>; </span><br><span class=\"line\">box.setAttributeNode(placeholder);</span><br></pre></td></tr></table></figure><h2 id=\"事件\"><a href=\"#事件\" class=\"headerlink\" title=\"事件\"></a>事件</h2><h3 id=\"DOM0-级\"><a href=\"#DOM0-级\" class=\"headerlink\" title=\"DOM0 级\"></a>DOM0 级</h3><blockquote><p>在 DOM 中直接绑定事件</p></blockquote><ul><li>绑定：<code>DOM.onclick = function(){ }</code></li><li>移除：<code>DOM.onclick = null / &quot;&quot;</code></li></ul><h3 id=\"DOM2-级\"><a href=\"#DOM2-级\" class=\"headerlink\" title=\"DOM2 级\"></a>DOM2 级</h3><blockquote><p>使用事件监听绑定事件，浏览器监听到用户执行相关操作做出响应</p></blockquote><ol><li>主流浏览器<ul><li>绑定：<code>DOM.addEventListener(&#39;click&#39;, fn, false)</code></li><li>移除：<code>DOM.removeEventListener(&#39;click&#39;, fn)</code></li><li>参数：false 时在冒泡阶段执行，true 则在捕获阶段执行</li></ul></li><li>IE8及以下<ul><li>绑定：<code>DOM.attachEvent(&#39;onclick&#39;, fn)</code></li><li>移除：<code>DOM.detachEvent(&#39;click&#39;, fn)</code></li></ul></li></ol><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// DOM0 级事件可能被覆盖：2，3，4</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> box = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'#box'</span>)</span><br><span class=\"line\">box.onclick = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"number\">1</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">box.onclick = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"number\">2</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">box.addEventListener(<span class=\"string\">'click'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"number\">3</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">box.addEventListener(<span class=\"string\">'click'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"number\">4</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h3 id=\"事件流\"><a href=\"#事件流\" class=\"headerlink\" title=\"事件流\"></a>事件流</h3><blockquote><p>事件的执行顺序</p></blockquote><ul><li>事件冒泡：事件从事件目标元素开始触发，向上触发到最外层的 document 对象</li><li>事件捕获：与冒泡相反</li><li>DOM 事件流：DOM 先捕获到目标元素，然后冒泡到最外层</li></ul><h3 id=\"事件对象\"><a href=\"#事件对象\" class=\"headerlink\" title=\"事件对象\"></a>事件对象</h3><blockquote><p>触发 DOM 上的某个事件时会产生一个事件对象 event，它包含着所有与事件有关的信息</p></blockquote><ol><li>属性：鼠标 / 键盘属性、IE 属性、标准 Event 属性</li><li>方法：stopPropagation、preventDefault</li><li><p>事件</p><ul><li>鼠标事件：<code>click、dbclick、mousedown、mousemove、mouseout、mouseover、mouseup</code></li><li>键盘事件：<code>keydown、keypress、keyup</code></li><li>HTML事件：<code>load、unload、resize、change、scroll、focus、blur、select、reset、submit</code></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  <span class=\"keyword\">var</span> Event = &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 页面加载完成后</span></span><br><span class=\"line\">    readyEvent: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">fn</span>) </span>&#123;  </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (fn == <span class=\"literal\">null</span>) &#123; </span><br><span class=\"line\">            fn = <span class=\"built_in\">document</span>;</span><br><span class=\"line\">        &#125; </span><br><span class=\"line\">        <span class=\"keyword\">var</span> oldonload = <span class=\"built_in\">window</span>.onload; </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> <span class=\"built_in\">window</span>.onload != <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">window</span>.onload = fn; </span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">                oldonload(); </span><br><span class=\"line\">                fn();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;, </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 绑定事件</span></span><br><span class=\"line\">    addEvent: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">element, type, handler</span>) </span>&#123; </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (element.addEventListener) &#123;    </span><br><span class=\"line\">              element.addEventListener(type, handler, <span class=\"literal\">false</span>); <span class=\"comment\">// DOM2</span></span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (element.attachEvent) &#123; </span><br><span class=\"line\">            element.attachEvent(<span class=\"string\">'on'</span> + type, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                  handler.call(element);     <span class=\"comment\">// 兼容IE</span></span><br><span class=\"line\">            &#125;); </span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> &#123; </span><br><span class=\"line\">            element[<span class=\"string\">'on'</span> + type] = handler;  <span class=\"comment\">// DOM0</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 移除事件 </span></span><br><span class=\"line\">    removeEvent: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">element, type, handler</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (element.removeEventListener) &#123;</span><br><span class=\"line\">            element.removeEventListener(type, handler, <span class=\"literal\">false</span>); </span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (element.datachEvent) &#123; </span><br><span class=\"line\">            element.datachEvent(<span class=\"string\">'on'</span> + type, handler); </span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            element[<span class=\"string\">'on'</span> + type] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 获取应用到元素上的所有样式</span></span><br><span class=\"line\">    getStyle: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">obj</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> style = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">window</span>.getComputedStyle)&#123;</span><br><span class=\"line\">            style = <span class=\"built_in\">window</span>.getComputedStyle(obj,<span class=\"literal\">null</span>);  <span class=\"comment\">// W3C</span></span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            style = obj.currentStyle;   <span class=\"comment\">// IE</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> style;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 获取事件对象，确保随时可以使用</span></span><br><span class=\"line\">    getEvent: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123; </span><br><span class=\"line\">        <span class=\"keyword\">var</span> ev = e || <span class=\"built_in\">window</span>.event;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!ev)&#123; </span><br><span class=\"line\">            <span class=\"keyword\">var</span> c = <span class=\"keyword\">this</span>.getEvent.caller; </span><br><span class=\"line\">            <span class=\"keyword\">while</span>(c) &#123; </span><br><span class=\"line\">                ev = c.argument[<span class=\"number\">0</span>]; </span><br><span class=\"line\">                <span class=\"keyword\">if</span> (ev &amp;&amp; Event == ev.constructor) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">break</span>; </span><br><span class=\"line\">                &#125; </span><br><span class=\"line\">                c = c.caller; </span><br><span class=\"line\">            &#125; </span><br><span class=\"line\">        &#125; </span><br><span class=\"line\">        <span class=\"keyword\">return</span> ev; </span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 获取触发事件的元素 </span></span><br><span class=\"line\">    getTarget: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123; </span><br><span class=\"line\">        <span class=\"keyword\">return</span> event.target || event.srcElemnt; </span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 阻止冒泡，比如 父子元素都有事件时阻止同时触发</span></span><br><span class=\"line\">    stopPropagation: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">ev</span>) </span>&#123; </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (ev.stopPropagation) &#123; </span><br><span class=\"line\">            ev.stopPropagation(); </span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> &#123; </span><br><span class=\"line\">            ev.cancelBubble = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;, </span><br><span class=\"line\">    stop_propagation: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">        <span class=\"keyword\">var</span> e = <span class=\"built_in\">window</span>.event || <span class=\"built_in\">arguments</span>.callee.caller.arguments[<span class=\"number\">0</span>];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(e &amp;&amp; e.stopPropagation)&#123; </span><br><span class=\"line\">            e.stopPropagation();   </span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"built_in\">window</span>.event)&#123; </span><br><span class=\"line\">            <span class=\"built_in\">window</span>.event.cancelBubble = <span class=\"literal\">true</span>;  </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;, </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 阻止浏览器默认行为，比如 点击提交按钮时阻止默认提交表单、a链接阻止默认跳转</span></span><br><span class=\"line\">    preventDefault: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">ev</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (ev.preventDefault) &#123; </span><br><span class=\"line\">            ev.preventDefault(); </span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            ev.returnValue = <span class=\"literal\">false</span>; </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id=\"事件委托\"><a href=\"#事件委托\" class=\"headerlink\" title=\"事件委托\"></a>事件委托</h3><blockquote><p>利用事件冒泡原理，将本该元素执行的事件委托给了它的父元素执行</p></blockquote><ol><li><p>优势</p><ul><li>节省内存，提升性能</li><li>减少DOM操作，运行效率更高</li></ul></li><li><p>适用场景</p><ul><li>给多个同类元素绑定相同事件</li><li>给动态生成的新元素绑定事件</li></ul></li><li><p>实现代码</p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 为三个同级的 input 绑定点击事件</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> box = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"box\"</span>);</span><br><span class=\"line\"><span class=\"comment\">// box.on(\"click\", \"input\", callback) </span></span><br><span class=\"line\">box.onclick = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">ev</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ev = ev || <span class=\"built_in\">window</span>.event;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> target = ev.target || ev.srcElement;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 判断元素：target.className == \"box\"</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(target.nodeName.toLocaleLowerCase() == <span class=\"string\">'input'</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(target.id)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'add'</span> :</span><br><span class=\"line\">                <span class=\"built_in\">console</span>.log(<span class=\"string\">'添加'</span>);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'remove'</span> :</span><br><span class=\"line\">                <span class=\"built_in\">console</span>.log(<span class=\"string\">'删除'</span>);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'select'</span> :</span><br><span class=\"line\">                <span class=\"built_in\">console</span>.log(<span class=\"string\">'选择'</span>);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 为添加的子元素绑定事件</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> btn = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"btn\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> oUl = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"ul1\"</span>);</span><br><span class=\"line\">oUl.addEventListener(<span class=\"string\">'mousedown'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">ev</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ev = ev || <span class=\"built_in\">window</span>.event;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> target = ev.target || ev.srcElement;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(target.nodeName.toLocaleLowerCase() == <span class=\"string\">'li'</span>)&#123;</span><br><span class=\"line\">        ev.target.style.backgroundColor=<span class=\"string\">\"black\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">btn.onclick = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> oLi = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'li'</span>);</span><br><span class=\"line\">    oLi.innerHTML = <span class=\"number\">4</span>;</span><br><span class=\"line\">    oUl.appendChild(oLi);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></li></ol><h1 id=\"四、BOM\"><a href=\"#四、BOM\" class=\"headerlink\" title=\"四、BOM\"></a>四、BOM</h1><blockquote><p>浏览器对象模型，用于操作浏览器本身的应用编程接口</p></blockquote><div align=\"center\"><br><br><img src=\"images/js/bom.png\" alt=\"BOM\"><br></div><!-- rebuild by neat -->"},{"title":"Web 通信和页面功能","top":false,"keywords":["js","ajax","socket"],"date":"2019-03-24T15:09:57.000Z","description":"HTTP 协议、Ajax 异步请求、Socket 实时通信、上传下载和数据储存等页面功能","_content":"\n# 一、HTTP 协议\n> 超文本传输协议，它是基于 TCP/IP 协议的一个应用层协议，用于定义客户端与服务器通信的格式，具有单向请求、无状态等特点\n\n## HTTP 报文\n> HTTP 通信的传输单位，可分为 请求报文和响应报文，内部结构如下\n\n  * 请求行：用于说明请求方法、请求地址、http 版本号 \n  * 响应行：用于说明服务器 http 版本号、响应状态码、状态码的原因短句\n  * 头部字段：分为 通用首部字段、请求首部字段、响应首部字段、实体首部字段\n  * 实体部分：可以用实体首部字段加以说明，常用 content-type 说明实体内容的类型\n\n\n## 操作方式\n  * 浏览器的 url 地址栏 \n  * XMLHttpRequest 对象\n  * 页面有 src 属性的标签（img、script、link 等） \n  * 带有 action 属性的 form 表单 \n\n\n## 连接方式\n> 实际上是 TCP 协议的长/短连接，区别在于数据传输后是否立即关闭连接\n\n  1. 短连接\n    * HTTP1.0 默认方式。每次 HTTP 操作则建立一次连接，任务结束就立即关闭\n    * 常用于 并发量大但每个用户无需频繁操作的场景，比如浏览器网址的 http 服务\n  2. 长连接\n    * HTTP1.1 开始默认方式。任务结束后并不会立即关闭 TCP 连接，再次请求时继续使用\n    * HTTP 响应头会添加 `Connection: keep-alive`，而且可以在服务器软件中设定连接时间\n\n\n\n## 工作流程\n\n1. 全部流程\n  <div align=\"center\"> \n    ![HTTP 请求流程](images/web/http_req.png)\n  </div> \n2. 域名解析过程\n  <div align=\"center\"> \n    ![域名解析过程](images/web/domain.png)\n  </div> \n3. 三次握手\n  <div style=\"text-indent: 2em\">TCP 协议中，建立 TCP 需要与百度服务器握手三次，你先告诉服务器你要给服务器发东西（SYN），服务器应答你并告诉你它也要给你发东西（SYN、ACK），然后你应答服务器（ACK），共来回3次，称为3次握手。</div>\n  \n\n\n# 二、Ajax 请求\n> 异步网络请求，能够在页面不跳转不刷新的情况下实现局部加载的异步通信，减少了传输数据量\n\n## 原理\n<div style=\"text-indent: 2em\">在用户和服务器之间加了―个中间层 (Ajax 引擎)，通过 XmlHttpRequest 对象来向服务器发异步请求并获取数据，然后通过 js 操作 DOM 而更新页面，这样就让用户操作与服务器响应实现了异步化，从而 js 可以及时向服务器提出请求和处理响应而不阻塞用户，达到无刷新的效果。注意如果出现乱码问题就是因为编码格式冲突，发送中文数据时通过 encodeURI() 编码，接收中文数据时通过 decodeURI() 解码即可。</div>\n\n## 优点\n  * 使用异步方式与服务器通信，响应速度更快\n  * 基于标准化的并被广泛支持的技术，不需要下载插件或者小程序\n  * 页面无刷新，在页面内与服务器通信，减少用户等待时间，增强了用户体验\n  * 可以把一些原本服务器的工作转接到客户端，利用客户端闲置的能力来处理，减轻了服务器和带宽的负担，节约空间和宽带租用成本\n\n\n## 缺点\n  * 对搜索引擎的支持比较弱\n  * 可能会影响程序中的异常处理机制\n  * 无法进行操作的后退，即不支持浏览器的页面后退\n  * 安全问题，对一些网站攻击，比如 csrf、xxs、sql 注入等不能很好地防御\n\n\n## 请求方式\n  1. 区别\n    * method：`GET、POST`\n    * 请求头：POST 发送数据时必须设置\n    * 安全性：GET 请求时暴露参数数据，安全性较低\n    * 长度限制：GET 有长度限制，不适合发送大量数据\n    * 请求缓存：GET 请求可以被缓存和保存，而 POST 请求不能\n    * 参数位置：`url?参数=值&参数=值、xhr.send(\"参数=值&参数=值\")`\n  2. 场景\n    * GET：安全性要求不高时，从服务器获取数据\n    * POST：对于大量数据、密码数据等，提交到服务器处理\n\n   \n\n## ContentType\n> 请求体类型，告诉服务器发送数据的格式\n\n  * `application/x-www-form-urlencoded`：jquery ajax 默认类型，使用查询字符串格式的数据\n  * `multipart/form-data`：常用于表单上传文件，设置 form enctype 为该类型\n  * `application/json`：axios 默认类型，使用 json 格式的数据\n\n\n## 原生写法\n  ```js\n  // 1、创建 XMLHttpRequest 对象 (用来和服务器交换数据的 js 内置对象)\n  var xhr;\n  if(XMLHttpRequest){\n      xhr = new XMLHttpRequest();   // w3c 标准\n  }else{\n      xhr = new ActiveXObject('Microsoft.XMLHTTP')  // IE6、IE5\n  }\n\n\n  // 2、连接服务器和发送请求\n\n  // GET \n  xhr.open('GET', url?参数=值, true);   // true 表示请求异步处理\n  xhr.send();    \n\n  // POST 必须设置请求头\n  xhr.open(\"POST\", url, true);   \n  xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n  xhr.send(\"参数=值\")\n\n\n  // 3、监听回调函数状态和处理响应数据\n  xhr.onreadystatechange = function(){\n      // 判断响应是否接收完成、服务器是否成功处理请求\n      if(xhr.readyState == 4 && xhr.status ==200){\n          show.innerHTML = xhr.responseText;\n      }\n  }\n  ```\n\n\n## JQuery 写法\n  ```js\n  $.get(url?参数=值, calback)\n\n  $.post(url, {参数：值}, callback)\n\n  $.ajax({\n      type:       // 数据的提交方式：get、post\n      url:        // 请求地址\n      async:      // 是否支持异步刷新，默认 true\n      data:       // 需要提交的数据\n      dataType:   // 服务器返回数据的类型，html、json, jsonp 等\n      success: function(data){\n      }           // 请求成功后的回调函数 \n      error:function(data){\n      }           // 请求失败后的回调函数 \n  })\n  ```\n\n## Ajax 封装\n  ```js\n  function requestUrl(url, type, data, callback, error, async) {\n      var async = (async == null || async.toString() == \"\" || typeof(async) == \"undefined\") ? true : !!async;\n      $.ajax({\n          url: url,\n          method: type,\n          async: async,\n          data: data\n      })\n      .done(function( _data ) {\n          if (_data.status == 200) {\n              callback(_data.data);\n          } else {\n              if (typeof(error) == 'function') {\n                  error(_data)\n              } else {\n                  alert(_data.data.errMsg)\n              }\n          }\n      })\n      .fail(function( jqXHR, textStatus ) {\n          setTimeout(function() {\n              requestUrl(url, type, data, callback, error, async);\n          }, 1000);\n      })\n  }\n  ```\n\n\n# 三、Ajax 跨域\n> A 网站的 js 代码试图访问 B 网站的数据\n\n## 同源策略\n<div style=\"text-indent: 2em\">浏览器出于安全方面的考虑，只允许与本域下的接口交互。不同源的客户端脚本在没有明确授权的情况下，不能读写对方的资源。ajax的请求与访问同样会受到浏览器同源策略的限制，不能访问不同主域中的地址。</div>\n\n## JSONP 跨域\n> jsonp 只是一种非强制性协议而不是新技术，和 json、ajax 都没有任何关系\n\n1. __原理__：利用 script 可以引用外部文件实现跨域请求的特点，动态添加 script 调用服务器的 js 脚本\n2. __json 和 jsonp__\n  * json：一种轻量级的数据交换格式\n  * jsonp：一种借助 script 元素解决主流浏览器的跨域读取数据问题的方式\n3. __实现方式__\n  1. 定义数据处理函数：`var handler = function(data){ }`\n  2. 创建 script 标签，src 的地址设置为 `url?callback=handler`\n  3. 服务端在收到请求后，解析参数并返回数据，输出 fun(data) 字符串\n  4. fun(data) 会放到 script 标签中作为 js 执行，即此时会调用函数 \n  \n  \n## CORS 跨域\n> 一个W3C标准，全称是\"跨域资源共享，它允许浏览器向跨源服务器发出 xhr 请求\n\n  1. __原理__：使用自定义的 HTTP 头部让浏览器与服务器沟通，决定请求是应该成功或失败\n  2. __使用__：发送请求时附加一个额外的 origin 头部，比如 `Origin:http://www.nczonline.net`\n\n\n## jQuery Ajax 跨域\n  ```js\n  $.ajax({\n      type: \"get\",\n      async: false,\n      url: url,\n      data: data,\n      dataType: \"jsonp\",\n      jsonp: \"callback\",         // 传递给请求处理程序或页面来获取回调参数 \n      jsonpCallback: \"handler\"   // 自定义的 jsonp 回调函数名称  \n      success: function(data){\n          console.log(data)\n      }，\n      error: function(){ }\n  })\n  ```\n\n\n\n# 四、Ajax 数据\n\n## JSON\n> 处理大量数据的规范格式\n\n  * 对象：`var json_obj = { name: 'Alice', age: 20 }`\n  * 字符串：`var json_str = “{ name: 'Alice', age: 20 }”`\n  * 转换\n    * 对象转字符串：`JSON.stringify(json_obj)`\n    * 字符串转对象：`JSON.parse(json_str) / eval('('+json_str+')')`  \n    * eval：不推荐使用，因为它会把 js 数据而不只是 json_str 都转为 json 对象\n\n\n## FormData\n> 处理包括图片和文件的表单数据并通过 post 方式发送到服务端\n\n  * html \n    * form：`form id=\"form\" method=\"post\" enctype=\"multipart/form-data\"`\n    * input：`input type=\"file\" name=\"file\"`\n  * 操作\n    ```js\n    // 1、实例一个空 FormData 对象之后 append 键值对\n    var formdata = new FormData() \n    var file = document.getElementById(\"file\").files[0]\n    formData.append('file', file)\n                              \n    // 2、form元素对象 作为参数传入  \n    var form = document.getElementById(\"form\")\n    var formdata = new FormData(form);                          \n\n    // 3、getFormData 方法\n    var formobj =  document.getElementById(\"form\");\n    var formdata = formobj.getFormData()\n\n    // 其它 API：has、getAll、forEach\n    formdata.delete(\"file\")   \n    var file = formdata.get(\"file\")        \n    ```\n\n\n\n# 五、websocket\n> 一种全双工通信协议(双向通信)，和 HTTP 都是基于 TCP 协议的应用层协议，两者有良好的兼容性但没有联系。它能更好的节省服务器资源和带宽，而且可以实现实时通讯\n\n## 实时通信\n  * Ajax 轮询\n    * 原理：客户端设置 计时器，每隔一段时间就向服务器发送一次请求\n    * 缺点：只能由客户端发起请求，而且需要服务器有很快的 资源处理速度\n  * http 长轮询\n    * 原理：客户端发起请求建立连接后，服务器会等到有内容更新时才去响应，否则不响应\n    * 缺点：采用阻塞模型，需要服务器有很高的并发处理能力，会占用服务器更多的资源空间。    \n  * WebSocket：只需要经过一个握手的动作，客户端与服务端就可以互相传送数据，不需要询问和等待\n\n\n## 区分 Socket\n  * WebSocket 在建立握手时通过 HTTP 传输数据，但是建立之后传输真正数据时不需要 HTTP\n  * Socket 是应用层与TCP/IP协议族通信的中间软件抽象层，它其实并非一个协议而是一组接口\n\n## 连接过程\n  1. 浏览器、服务器通过 TCP 三次握手建立连接 (通信基础)\n  2. 浏览器通过向服务器发起一个包含 WebSocket 支持版本号等附加头信息的 HTTP请求\n  3. 服务器同样采用HTTP协议返回应答信息\n  4. 当收到连接成功的信息后通过 TCP 通道进行传输通信\n  5. 客户端/服务器端 关闭连接前可以自由传输数据\n\n## API\n\n  ```js\n  // 建立连接\n  var ws = null;\n  function initWebSocket{\n    // 浏览器支持则建立连接  \n    if ('WebSocket' in window) {\n        ws = new WebSocket('ws://10.148.221.210:5000')  \n\n        // 连接成功则向服务器发送数据\n        ws.onopen = function() {\n            // 0、1、2、3 ：正在连接、连接成功、连接正在关闭、连接失败或已关闭\n            if (socket.readyState===1) {\n                ws.send(\"connect success\")\n            }\n        })\n\n        // 收到服务器数据则执行相关处理\n        socket.onmessage = function(msg){ }\n\n        // 连接失败则重连\n        ws.addEventListener('error', fn)\n    }\n  }\n\n  // 离开当前页面时断开连接\n  ws.close()\n  ```\n\n\n# 六、表单数据\n\n## 表单提交\n  \n  1. 问题：点击一次按钮而执行两次 Ajax \n  2. 原因：执行完 Ajax 请之求后，并没有阻止 submit 提交\n  3. 解决方案\n    * 不使用 type=\"submit\" 的按钮，而使用 type=\"button\"\n    * 点击事件的回调函数中的最后一行添加：return false\n    * 先解绑再绑定：`$(\"#btn\").off(\"click\").on(\"click\", fn)` \n\n\n## 表单序列化\n> 普通表单元素必须设置 name，checkbox 必须设置 name、value\n\n  ```js\n  var data = $(\"form\").serialize();           // 字符串 \n  var jsonArr = $(\"form\").serializeArray();   // 数组\n  var jsonObj = $(\"form\").serializeObject();  // JSON\n\n  $.fn.serializeObject = function () {\n      var o = {};\n      var a = this.serializeArray();\n      $.each(a, function () {\n          var val = this.value || ''   // 如果是 null 则赋值为 ''  \n          if(o[this.name]) {           \n              if(this.value){\n                  o[this.name] = o[this.name] + \",\" + val;\n              }\n              \n          } else {\n              o[this.name] = val; \n          }\n      });\n      var $radio = $('input[type=radio],input[type=checkbox],select[multiple=\"multiple\"]',this);\n      $.each($radio,function(){\n          if(!o.hasOwnProperty(this.name)){\n              o[this.name] = null;\n          }else if(o[this.name] == 'on'){\n              o[this.name] = true;\n          }else{\n              o[this.name] = o[this.name];\n          }\n      });\n      return o;\n  };\n  ```\n\n\n\n\n# 七、页面功能\n\n## 页面跳转\n  1. 实现方式\n    * 关闭当前页面，打开新页面\n      * `a href=\"url\"`\n      * `window.location.href = url`\n    * 保留当前页面，打开新页面\n      * `a href=\"url\" target=\"_blank\"`\n      * `window.open(url, \"_blank\")`\n    * 模拟点击 a 标签\n      * `$(\"#box\")[0].click()`\n      * `document.getElementById(\"box\").click()` \n  2. 传递数据\n    * url 查询字符串\n    * cookie 等数据储存\n    * window.open、window.opener  \n\n\n## 页面刷新\n  * `window.location.reload()`\n  * `window.location.href = url`\n  * `window.location.replace(url)`\n\n\n## 文件下载\n> 浏览器中的文件地址打不开时就会变为下载\n\n  * `location.href = url`：\n  * 借助 Blob 和 download 属性实现文本信息文件下载\n  * 借助 Base64 实现任意文件下载\n\n  ```js\n  // location 下载文件\n\tfunction dl_file(){\n\t   var url = \"http://www.baidu.com/\"\n\t   location.href = url + \"?name=mike&age=20\"\n\t}\n\n  //借助 Blob 和 download 属性实现文本信息文件下载\n\tfunction bolb_download(content, filename) {\n\n      // 创建隐藏的可下载链接\n\t    var link = document.createElement('a');\n\t    link.download = filename;\n      link.style.display = 'none';\n      \n\t    // 字符内容转变成blob地址\n\t    var blob = new Blob([content]);\n      link.href = URL.createObjectURL(blob);\n      \n\t    // 模拟点击和移除\n\t    document.body.appendChild(link);\n      link.click();\n\t    document.body.removeChild(link);\n\t};\n\n  var textarea = document.querySelector('textarea');\n\tvar btn = document.querySelector('input[type=\"button\"]');\n\tif ('download' in document.createElement('a')) {\n\t    // 作为test.html文件下载\n\t    btn.addEventListener('click', function () {\n\t        bolb_download(textarea.value, 'test.html');    \n\t    });\n\t} else {\n\t    btn.onclick = function () {\n\t        alert('浏览器不支持');    \n\t    };\n\t}\n\n\n  // 借助 Base64 实现任意文件下载\n\tfunction di_file(domImg, filename) {\n\t    \n\t    var link = document.createElement('a');\n\t    link.download = filename;\n      link.style.display = 'none';\n      \n\t    // 图片转 base64 地址\n\t    var canvas = document.createElement('canvas');\n\t    var context = canvas.getContext('2d');\n\t    var width = domImg.width;\n\t    var height = domImg.height;\n      context.drawImage(domImg, 0, 0);\n      link.href = context.toDataURL('image/png');\n      \n\t    // 模拟点击和移除\n\t    document.body.appendChild(link);\n\t    link.click();\n\t    document.body.removeChild(link);\n\t};\n  ```\n\n\n## 图片上传\n  <div align=\"center\"> \n    ![图片上传流程图](images/web/img_upload.png)\n  </div> \n\n  ```js\n  // html：input type=\"file\" id=\"uploadImg\"\n  function getBase64Img(fileObj, callback){  \n      var reader = new FileReader();  \n      reader.readAsDataURL(fileObj);   // 转为 Base64 格式 \n      reader.onload = function(e){  \n          // 变成字符串  \n          // callback(reader.result);  \n          callback(e.target.result);\n      }  \n   }\n   var imgFile = document.getElementById(\"fileInput\").files[0];\n   fileInput.addEventListener(\"change\", function (event) {\n     var file = fileInput.files[0];\n     getBase64Img(file, function(imgBase64){\n        if (imgBase64.length &gt; 2100000) {\n              // 2 M = 2097152 B\n              alert( '请上传不大于 2M 的图片！');\n              return;\n        }else{\n            // 截取 data:image/png;base64 后面的纯字符串\n            var upload_file = imgBase64.substring(imgBase64.indexOf(\",\") + 1);\n            // 上传截取后的字符串\n            console.log(upload_file);\n        }\n    })\n   }, false)\n\n\n  // oss 图片上传\n  var ossUpload = {\n      // 获取上传文件后缀\n      getSuffix: function(filename) {\n          var pos = filename.lastIndexOf('.');\n          var suffix = '';\n          if (pos != -1) {\n              suffix = filename.substring(pos + 1)\n          }\n          return suffix;\n      },\n      // 配置上传参数\n      setUpParam: function($target ,data) {\n          var formData = new FormData();\n          $.each(data, function(i, n) {\n              formData.append(i, n)\n          })\n          formData.append('file', $target[0].files[0]);\n          return formData;\n      },\n      // 上传图片\n      uploadImg: function(url, formData, callback) {\n          $.ajax({\n              url: url.host,\n              type: 'POST',\n              data: formData,\n              processData: false,\n              contentType: false\n          })\n          .done(function(data) {\n              callback(data);\n          })\n          .fail(function() {\n              setTimeout(function() {\n                  uploadImg(url, formData, callback);\n              }, 1000)\n          })\n      }\n  }\n  ```\n\n\n\n# 八、数据储存\n\n## cookie\n> 随着每次 http 请求头信息一起发送，无形中增加了网络流量，而且能存储的数据容量较小，适用于购物车、客户端登录等场景\n\n  * 优点\n    * 可控制过期时间 \n    * 可扩展、可用性比较好\n    * 可加密减少 cookie 被破解的可能性\n  * 缺点\n    * 在请求头上携带数据安全性差\n    * 数量和长度有限制，最多 20 条，最长不能超过 40k\n  * API\n    * 存储：`document.cookie = \"键=值\"`\n    * 读取：`var val = document.cookie`         \n    * 删除：\n      * `var date = new Date()`\n      * `document.cookie = \"key=value;expires=\" + date.toGMTString()`  \n\n\n  ```js\n  export const setCookie = (name, value, expiredays) => {\n      var exdate = new Date();　　　　\n      exdate.setDate(exdate.getDate() + expiredays);　　　　\n      document.cookie = name + \"=\" + escape(value) + ((expiredays == null) ? \"\" : \";expires=\" + exdate.toGMTString());\n  }\n\n  export const getCookie = name => {\n      var arr, reg = new RegExp(\"(^| )\" + name + \"=([^;]*)(;|$)\");\n      if (arr = document.cookie.match(reg))\n          return (arr[2]);\n      else\n          return null;\n  }\n\n  export const delCookie = name => {\n      var exp = new Date();\n      exp.setTime(exp.getTime() - 1);\n      var cval = this.getCookie(name);\n      if (cval != null)\n      document.cookie = name + \"=\" + cval + \";expires=\" + exp.toGMTString();\n  }\n  ```\n\n\n## localStorage\n> 本地存储方式可以长期存储数据，没有时间限制，而且可以储存电话本等大量数据\n\n  * 特点：同源策略限制、只在本地存储、永久保存、同浏览器共享\n  * 优点\n    * 扩展了 cookie 的 4k 限制\n    * 可以将请求数据直接存储到本地，节约带宽\n    * 遵循同源策略，不同网站之间不能直接共用\n  * 缺点\n    * 需要手动删除，否则长期存在\n    * 浏览器大小不一，版本的支持也不一样\n    * 只支持存储 string 类型的数据，JSON 对象需要转换\n    * 本质是对字符串的读取，如果存储内容多则会消耗内存空间而导致页面变卡\n  * 应用场景\n    * 多页面访问共同数据：可以在多个标签页中共享数据\n    * 数据比较大的临时保存方案：比如在线编辑文章时的自动保存\n  * API\n    * 存储：`localStorage.setItem(key, value)`\n    * 读取\n      * 单个：`localStorage.getItem(key)`\n      * 全部：`localStorage.valueOf()`\n    * 删除\n      * 单个：`localStorage.removeItem(key)`\n      * 全部：`localStorage.clear()`\n\n\n  ```js\n  export const setStore = (name, content) => {\n    if (!name) return;\n    if (typeof content !== 'string') {\n      content = JSON.stringify(content);\n    }\n    window.localStorage.setItem(name, content);\n  }\n  export const getStore = name => {\n    if (!name) return;\n    return window.localStorage.getItem(name);\n  }\n  export const removeStore = name => {\n    if (!name) return;\n    window.localStorage.removeItem(name);\n  }\n  ```\n\n\n## sessionStorage\n> 会话存储，关闭浏览器之后数据就会消失。非常适合单页应用程序，便于各业务模块之间的传值\n\n  * 特点\n    * __同源策略限制__ \n    * __单标签页限制__：同一个标签页中的同源页面共享数据\n    * __只在本地存储__：数据只会在存储在本地，并在标签页关闭后清除\n    * __存储方式__：采用键值对的方式，注意 value 值必须为字符串类型\n    * __存储上限限制__：不同的浏览器存储的上限不同，但大多数限制在 5MB 以下\n  * API\n    * 存储：`sessionStorage.setItem(key, value)`\n    * 读取\n      * 单个：`sessionStorage.getItem(key)`\n      * 全部：`sessionStorage.valueOf()`\n    * 删除\n      * 单个：`sessionStorage.removeItem(key)`\n      * 全部：`sessionStorage.clear()`\n\n \n\n\n## 以上区别\n  * 传递\n    * cookie 数据通常经过加密，而且会在浏览器和服务器间来回传递\n    * 后两个不会自动把数据发给服务器，仅在本地保存。\n  * 存储大小\n    * cookie 数据大小不能超过4k，始终在同源的 http 请求中携带\n    * 后两个虽然也有存储大小的限制但比 cookie 大得多，可以达到 5M 及以上\n  * 生命周期\n    * cookie 数据只在过期时间之前一直有效\n    * localStorage存储持久数据，不要不主动删除数据就有效有效\n    * sessionStorage数据在当前浏览器窗口关闭后自动删除\n  * 作用域    \n    * sessionStorage 不在不同浏览器窗口中共享\n    * 另外两个在所有同源窗口中都共享\n\n\n## 临时数据\n> html 标签上添加自定义属性来存储和操作数据，注意 js 可以动态添加和删除，但不能删除行内添加的\n\n  * html：`div data-name=\"值\"`，name 为自定义属性名\n  * 注意：`data-e-name：eName, data-myName：myname`\n  * 原生 js\n    * 获取：`div.dataset.name`\n    * 设置：`div.dataset.name = new`\n    * 删除：`div.dataset.name = null`\n  * jQuery\n    * 获取：`$(\"div\").data(\"name\")`\n    * 设置：`$(\"div\").data(\"name\", \"new\")`\n    * 删除：`$(\"div\").removeDate(\"name\")`\n\n\n\n# 九、用户登录\n\n## 实现逻辑\n  <div align=\"center\"> \n    ![登录注册逻辑](images/web/login.png)\n  </div> \n\n\n## 实现过程\n  1. 利用 Ajax 将用户名和密码发送到对应接口\n  2. 后台接收到对应数据后，通过用户名去查询对应密码\n  3. 对比查询到的密码和前台传过来的密码是否相等，如果相等返回成功，否则返回失败\n  4. 前端接收到登陆成功状态，将对应登陆成功的样式显示在对应位置，并将 username、userid 保存为 cookie (登陆状态保持)\n\n\n## Token\n> 遵从 oauth2.0 规范的授权令牌，它是一种身份/权限的认证方式 \n\n  1. 生成方式：服务端接收客户端发送的 userId，然后根据算法和编码方式生成\n  2. 优势\n    * 可以避免 CSRF 攻击\n    * 完全由应用管理，可以避开同源策略\n    * 可扩展性强(不用存储)，还可用于 APP\n    * 可以是无状态的，可以在多个服务间共享\n\n\n\n\n","source":"_posts/10-web通信.md","raw":"---\ntitle: Web 通信和页面功能\ntags:\n  - Javascript\n  - Ajax + Socket\ncategories: Javascript\ntop: false\nkeywords:\n  - js\n  - ajax\n  - socket\ndate: 2019-03-24 23:09:57\ndescription: HTTP 协议、Ajax 异步请求、Socket 实时通信、上传下载和数据储存等页面功能\n---\n\n# 一、HTTP 协议\n> 超文本传输协议，它是基于 TCP/IP 协议的一个应用层协议，用于定义客户端与服务器通信的格式，具有单向请求、无状态等特点\n\n## HTTP 报文\n> HTTP 通信的传输单位，可分为 请求报文和响应报文，内部结构如下\n\n  * 请求行：用于说明请求方法、请求地址、http 版本号 \n  * 响应行：用于说明服务器 http 版本号、响应状态码、状态码的原因短句\n  * 头部字段：分为 通用首部字段、请求首部字段、响应首部字段、实体首部字段\n  * 实体部分：可以用实体首部字段加以说明，常用 content-type 说明实体内容的类型\n\n\n## 操作方式\n  * 浏览器的 url 地址栏 \n  * XMLHttpRequest 对象\n  * 页面有 src 属性的标签（img、script、link 等） \n  * 带有 action 属性的 form 表单 \n\n\n## 连接方式\n> 实际上是 TCP 协议的长/短连接，区别在于数据传输后是否立即关闭连接\n\n  1. 短连接\n    * HTTP1.0 默认方式。每次 HTTP 操作则建立一次连接，任务结束就立即关闭\n    * 常用于 并发量大但每个用户无需频繁操作的场景，比如浏览器网址的 http 服务\n  2. 长连接\n    * HTTP1.1 开始默认方式。任务结束后并不会立即关闭 TCP 连接，再次请求时继续使用\n    * HTTP 响应头会添加 `Connection: keep-alive`，而且可以在服务器软件中设定连接时间\n\n\n\n## 工作流程\n\n1. 全部流程\n  <div align=\"center\"> \n    ![HTTP 请求流程](images/web/http_req.png)\n  </div> \n2. 域名解析过程\n  <div align=\"center\"> \n    ![域名解析过程](images/web/domain.png)\n  </div> \n3. 三次握手\n  <div style=\"text-indent: 2em\">TCP 协议中，建立 TCP 需要与百度服务器握手三次，你先告诉服务器你要给服务器发东西（SYN），服务器应答你并告诉你它也要给你发东西（SYN、ACK），然后你应答服务器（ACK），共来回3次，称为3次握手。</div>\n  \n\n\n# 二、Ajax 请求\n> 异步网络请求，能够在页面不跳转不刷新的情况下实现局部加载的异步通信，减少了传输数据量\n\n## 原理\n<div style=\"text-indent: 2em\">在用户和服务器之间加了―个中间层 (Ajax 引擎)，通过 XmlHttpRequest 对象来向服务器发异步请求并获取数据，然后通过 js 操作 DOM 而更新页面，这样就让用户操作与服务器响应实现了异步化，从而 js 可以及时向服务器提出请求和处理响应而不阻塞用户，达到无刷新的效果。注意如果出现乱码问题就是因为编码格式冲突，发送中文数据时通过 encodeURI() 编码，接收中文数据时通过 decodeURI() 解码即可。</div>\n\n## 优点\n  * 使用异步方式与服务器通信，响应速度更快\n  * 基于标准化的并被广泛支持的技术，不需要下载插件或者小程序\n  * 页面无刷新，在页面内与服务器通信，减少用户等待时间，增强了用户体验\n  * 可以把一些原本服务器的工作转接到客户端，利用客户端闲置的能力来处理，减轻了服务器和带宽的负担，节约空间和宽带租用成本\n\n\n## 缺点\n  * 对搜索引擎的支持比较弱\n  * 可能会影响程序中的异常处理机制\n  * 无法进行操作的后退，即不支持浏览器的页面后退\n  * 安全问题，对一些网站攻击，比如 csrf、xxs、sql 注入等不能很好地防御\n\n\n## 请求方式\n  1. 区别\n    * method：`GET、POST`\n    * 请求头：POST 发送数据时必须设置\n    * 安全性：GET 请求时暴露参数数据，安全性较低\n    * 长度限制：GET 有长度限制，不适合发送大量数据\n    * 请求缓存：GET 请求可以被缓存和保存，而 POST 请求不能\n    * 参数位置：`url?参数=值&参数=值、xhr.send(\"参数=值&参数=值\")`\n  2. 场景\n    * GET：安全性要求不高时，从服务器获取数据\n    * POST：对于大量数据、密码数据等，提交到服务器处理\n\n   \n\n## ContentType\n> 请求体类型，告诉服务器发送数据的格式\n\n  * `application/x-www-form-urlencoded`：jquery ajax 默认类型，使用查询字符串格式的数据\n  * `multipart/form-data`：常用于表单上传文件，设置 form enctype 为该类型\n  * `application/json`：axios 默认类型，使用 json 格式的数据\n\n\n## 原生写法\n  ```js\n  // 1、创建 XMLHttpRequest 对象 (用来和服务器交换数据的 js 内置对象)\n  var xhr;\n  if(XMLHttpRequest){\n      xhr = new XMLHttpRequest();   // w3c 标准\n  }else{\n      xhr = new ActiveXObject('Microsoft.XMLHTTP')  // IE6、IE5\n  }\n\n\n  // 2、连接服务器和发送请求\n\n  // GET \n  xhr.open('GET', url?参数=值, true);   // true 表示请求异步处理\n  xhr.send();    \n\n  // POST 必须设置请求头\n  xhr.open(\"POST\", url, true);   \n  xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n  xhr.send(\"参数=值\")\n\n\n  // 3、监听回调函数状态和处理响应数据\n  xhr.onreadystatechange = function(){\n      // 判断响应是否接收完成、服务器是否成功处理请求\n      if(xhr.readyState == 4 && xhr.status ==200){\n          show.innerHTML = xhr.responseText;\n      }\n  }\n  ```\n\n\n## JQuery 写法\n  ```js\n  $.get(url?参数=值, calback)\n\n  $.post(url, {参数：值}, callback)\n\n  $.ajax({\n      type:       // 数据的提交方式：get、post\n      url:        // 请求地址\n      async:      // 是否支持异步刷新，默认 true\n      data:       // 需要提交的数据\n      dataType:   // 服务器返回数据的类型，html、json, jsonp 等\n      success: function(data){\n      }           // 请求成功后的回调函数 \n      error:function(data){\n      }           // 请求失败后的回调函数 \n  })\n  ```\n\n## Ajax 封装\n  ```js\n  function requestUrl(url, type, data, callback, error, async) {\n      var async = (async == null || async.toString() == \"\" || typeof(async) == \"undefined\") ? true : !!async;\n      $.ajax({\n          url: url,\n          method: type,\n          async: async,\n          data: data\n      })\n      .done(function( _data ) {\n          if (_data.status == 200) {\n              callback(_data.data);\n          } else {\n              if (typeof(error) == 'function') {\n                  error(_data)\n              } else {\n                  alert(_data.data.errMsg)\n              }\n          }\n      })\n      .fail(function( jqXHR, textStatus ) {\n          setTimeout(function() {\n              requestUrl(url, type, data, callback, error, async);\n          }, 1000);\n      })\n  }\n  ```\n\n\n# 三、Ajax 跨域\n> A 网站的 js 代码试图访问 B 网站的数据\n\n## 同源策略\n<div style=\"text-indent: 2em\">浏览器出于安全方面的考虑，只允许与本域下的接口交互。不同源的客户端脚本在没有明确授权的情况下，不能读写对方的资源。ajax的请求与访问同样会受到浏览器同源策略的限制，不能访问不同主域中的地址。</div>\n\n## JSONP 跨域\n> jsonp 只是一种非强制性协议而不是新技术，和 json、ajax 都没有任何关系\n\n1. __原理__：利用 script 可以引用外部文件实现跨域请求的特点，动态添加 script 调用服务器的 js 脚本\n2. __json 和 jsonp__\n  * json：一种轻量级的数据交换格式\n  * jsonp：一种借助 script 元素解决主流浏览器的跨域读取数据问题的方式\n3. __实现方式__\n  1. 定义数据处理函数：`var handler = function(data){ }`\n  2. 创建 script 标签，src 的地址设置为 `url?callback=handler`\n  3. 服务端在收到请求后，解析参数并返回数据，输出 fun(data) 字符串\n  4. fun(data) 会放到 script 标签中作为 js 执行，即此时会调用函数 \n  \n  \n## CORS 跨域\n> 一个W3C标准，全称是\"跨域资源共享，它允许浏览器向跨源服务器发出 xhr 请求\n\n  1. __原理__：使用自定义的 HTTP 头部让浏览器与服务器沟通，决定请求是应该成功或失败\n  2. __使用__：发送请求时附加一个额外的 origin 头部，比如 `Origin:http://www.nczonline.net`\n\n\n## jQuery Ajax 跨域\n  ```js\n  $.ajax({\n      type: \"get\",\n      async: false,\n      url: url,\n      data: data,\n      dataType: \"jsonp\",\n      jsonp: \"callback\",         // 传递给请求处理程序或页面来获取回调参数 \n      jsonpCallback: \"handler\"   // 自定义的 jsonp 回调函数名称  \n      success: function(data){\n          console.log(data)\n      }，\n      error: function(){ }\n  })\n  ```\n\n\n\n# 四、Ajax 数据\n\n## JSON\n> 处理大量数据的规范格式\n\n  * 对象：`var json_obj = { name: 'Alice', age: 20 }`\n  * 字符串：`var json_str = “{ name: 'Alice', age: 20 }”`\n  * 转换\n    * 对象转字符串：`JSON.stringify(json_obj)`\n    * 字符串转对象：`JSON.parse(json_str) / eval('('+json_str+')')`  \n    * eval：不推荐使用，因为它会把 js 数据而不只是 json_str 都转为 json 对象\n\n\n## FormData\n> 处理包括图片和文件的表单数据并通过 post 方式发送到服务端\n\n  * html \n    * form：`form id=\"form\" method=\"post\" enctype=\"multipart/form-data\"`\n    * input：`input type=\"file\" name=\"file\"`\n  * 操作\n    ```js\n    // 1、实例一个空 FormData 对象之后 append 键值对\n    var formdata = new FormData() \n    var file = document.getElementById(\"file\").files[0]\n    formData.append('file', file)\n                              \n    // 2、form元素对象 作为参数传入  \n    var form = document.getElementById(\"form\")\n    var formdata = new FormData(form);                          \n\n    // 3、getFormData 方法\n    var formobj =  document.getElementById(\"form\");\n    var formdata = formobj.getFormData()\n\n    // 其它 API：has、getAll、forEach\n    formdata.delete(\"file\")   \n    var file = formdata.get(\"file\")        \n    ```\n\n\n\n# 五、websocket\n> 一种全双工通信协议(双向通信)，和 HTTP 都是基于 TCP 协议的应用层协议，两者有良好的兼容性但没有联系。它能更好的节省服务器资源和带宽，而且可以实现实时通讯\n\n## 实时通信\n  * Ajax 轮询\n    * 原理：客户端设置 计时器，每隔一段时间就向服务器发送一次请求\n    * 缺点：只能由客户端发起请求，而且需要服务器有很快的 资源处理速度\n  * http 长轮询\n    * 原理：客户端发起请求建立连接后，服务器会等到有内容更新时才去响应，否则不响应\n    * 缺点：采用阻塞模型，需要服务器有很高的并发处理能力，会占用服务器更多的资源空间。    \n  * WebSocket：只需要经过一个握手的动作，客户端与服务端就可以互相传送数据，不需要询问和等待\n\n\n## 区分 Socket\n  * WebSocket 在建立握手时通过 HTTP 传输数据，但是建立之后传输真正数据时不需要 HTTP\n  * Socket 是应用层与TCP/IP协议族通信的中间软件抽象层，它其实并非一个协议而是一组接口\n\n## 连接过程\n  1. 浏览器、服务器通过 TCP 三次握手建立连接 (通信基础)\n  2. 浏览器通过向服务器发起一个包含 WebSocket 支持版本号等附加头信息的 HTTP请求\n  3. 服务器同样采用HTTP协议返回应答信息\n  4. 当收到连接成功的信息后通过 TCP 通道进行传输通信\n  5. 客户端/服务器端 关闭连接前可以自由传输数据\n\n## API\n\n  ```js\n  // 建立连接\n  var ws = null;\n  function initWebSocket{\n    // 浏览器支持则建立连接  \n    if ('WebSocket' in window) {\n        ws = new WebSocket('ws://10.148.221.210:5000')  \n\n        // 连接成功则向服务器发送数据\n        ws.onopen = function() {\n            // 0、1、2、3 ：正在连接、连接成功、连接正在关闭、连接失败或已关闭\n            if (socket.readyState===1) {\n                ws.send(\"connect success\")\n            }\n        })\n\n        // 收到服务器数据则执行相关处理\n        socket.onmessage = function(msg){ }\n\n        // 连接失败则重连\n        ws.addEventListener('error', fn)\n    }\n  }\n\n  // 离开当前页面时断开连接\n  ws.close()\n  ```\n\n\n# 六、表单数据\n\n## 表单提交\n  \n  1. 问题：点击一次按钮而执行两次 Ajax \n  2. 原因：执行完 Ajax 请之求后，并没有阻止 submit 提交\n  3. 解决方案\n    * 不使用 type=\"submit\" 的按钮，而使用 type=\"button\"\n    * 点击事件的回调函数中的最后一行添加：return false\n    * 先解绑再绑定：`$(\"#btn\").off(\"click\").on(\"click\", fn)` \n\n\n## 表单序列化\n> 普通表单元素必须设置 name，checkbox 必须设置 name、value\n\n  ```js\n  var data = $(\"form\").serialize();           // 字符串 \n  var jsonArr = $(\"form\").serializeArray();   // 数组\n  var jsonObj = $(\"form\").serializeObject();  // JSON\n\n  $.fn.serializeObject = function () {\n      var o = {};\n      var a = this.serializeArray();\n      $.each(a, function () {\n          var val = this.value || ''   // 如果是 null 则赋值为 ''  \n          if(o[this.name]) {           \n              if(this.value){\n                  o[this.name] = o[this.name] + \",\" + val;\n              }\n              \n          } else {\n              o[this.name] = val; \n          }\n      });\n      var $radio = $('input[type=radio],input[type=checkbox],select[multiple=\"multiple\"]',this);\n      $.each($radio,function(){\n          if(!o.hasOwnProperty(this.name)){\n              o[this.name] = null;\n          }else if(o[this.name] == 'on'){\n              o[this.name] = true;\n          }else{\n              o[this.name] = o[this.name];\n          }\n      });\n      return o;\n  };\n  ```\n\n\n\n\n# 七、页面功能\n\n## 页面跳转\n  1. 实现方式\n    * 关闭当前页面，打开新页面\n      * `a href=\"url\"`\n      * `window.location.href = url`\n    * 保留当前页面，打开新页面\n      * `a href=\"url\" target=\"_blank\"`\n      * `window.open(url, \"_blank\")`\n    * 模拟点击 a 标签\n      * `$(\"#box\")[0].click()`\n      * `document.getElementById(\"box\").click()` \n  2. 传递数据\n    * url 查询字符串\n    * cookie 等数据储存\n    * window.open、window.opener  \n\n\n## 页面刷新\n  * `window.location.reload()`\n  * `window.location.href = url`\n  * `window.location.replace(url)`\n\n\n## 文件下载\n> 浏览器中的文件地址打不开时就会变为下载\n\n  * `location.href = url`：\n  * 借助 Blob 和 download 属性实现文本信息文件下载\n  * 借助 Base64 实现任意文件下载\n\n  ```js\n  // location 下载文件\n\tfunction dl_file(){\n\t   var url = \"http://www.baidu.com/\"\n\t   location.href = url + \"?name=mike&age=20\"\n\t}\n\n  //借助 Blob 和 download 属性实现文本信息文件下载\n\tfunction bolb_download(content, filename) {\n\n      // 创建隐藏的可下载链接\n\t    var link = document.createElement('a');\n\t    link.download = filename;\n      link.style.display = 'none';\n      \n\t    // 字符内容转变成blob地址\n\t    var blob = new Blob([content]);\n      link.href = URL.createObjectURL(blob);\n      \n\t    // 模拟点击和移除\n\t    document.body.appendChild(link);\n      link.click();\n\t    document.body.removeChild(link);\n\t};\n\n  var textarea = document.querySelector('textarea');\n\tvar btn = document.querySelector('input[type=\"button\"]');\n\tif ('download' in document.createElement('a')) {\n\t    // 作为test.html文件下载\n\t    btn.addEventListener('click', function () {\n\t        bolb_download(textarea.value, 'test.html');    \n\t    });\n\t} else {\n\t    btn.onclick = function () {\n\t        alert('浏览器不支持');    \n\t    };\n\t}\n\n\n  // 借助 Base64 实现任意文件下载\n\tfunction di_file(domImg, filename) {\n\t    \n\t    var link = document.createElement('a');\n\t    link.download = filename;\n      link.style.display = 'none';\n      \n\t    // 图片转 base64 地址\n\t    var canvas = document.createElement('canvas');\n\t    var context = canvas.getContext('2d');\n\t    var width = domImg.width;\n\t    var height = domImg.height;\n      context.drawImage(domImg, 0, 0);\n      link.href = context.toDataURL('image/png');\n      \n\t    // 模拟点击和移除\n\t    document.body.appendChild(link);\n\t    link.click();\n\t    document.body.removeChild(link);\n\t};\n  ```\n\n\n## 图片上传\n  <div align=\"center\"> \n    ![图片上传流程图](images/web/img_upload.png)\n  </div> \n\n  ```js\n  // html：input type=\"file\" id=\"uploadImg\"\n  function getBase64Img(fileObj, callback){  \n      var reader = new FileReader();  \n      reader.readAsDataURL(fileObj);   // 转为 Base64 格式 \n      reader.onload = function(e){  \n          // 变成字符串  \n          // callback(reader.result);  \n          callback(e.target.result);\n      }  \n   }\n   var imgFile = document.getElementById(\"fileInput\").files[0];\n   fileInput.addEventListener(\"change\", function (event) {\n     var file = fileInput.files[0];\n     getBase64Img(file, function(imgBase64){\n        if (imgBase64.length &gt; 2100000) {\n              // 2 M = 2097152 B\n              alert( '请上传不大于 2M 的图片！');\n              return;\n        }else{\n            // 截取 data:image/png;base64 后面的纯字符串\n            var upload_file = imgBase64.substring(imgBase64.indexOf(\",\") + 1);\n            // 上传截取后的字符串\n            console.log(upload_file);\n        }\n    })\n   }, false)\n\n\n  // oss 图片上传\n  var ossUpload = {\n      // 获取上传文件后缀\n      getSuffix: function(filename) {\n          var pos = filename.lastIndexOf('.');\n          var suffix = '';\n          if (pos != -1) {\n              suffix = filename.substring(pos + 1)\n          }\n          return suffix;\n      },\n      // 配置上传参数\n      setUpParam: function($target ,data) {\n          var formData = new FormData();\n          $.each(data, function(i, n) {\n              formData.append(i, n)\n          })\n          formData.append('file', $target[0].files[0]);\n          return formData;\n      },\n      // 上传图片\n      uploadImg: function(url, formData, callback) {\n          $.ajax({\n              url: url.host,\n              type: 'POST',\n              data: formData,\n              processData: false,\n              contentType: false\n          })\n          .done(function(data) {\n              callback(data);\n          })\n          .fail(function() {\n              setTimeout(function() {\n                  uploadImg(url, formData, callback);\n              }, 1000)\n          })\n      }\n  }\n  ```\n\n\n\n# 八、数据储存\n\n## cookie\n> 随着每次 http 请求头信息一起发送，无形中增加了网络流量，而且能存储的数据容量较小，适用于购物车、客户端登录等场景\n\n  * 优点\n    * 可控制过期时间 \n    * 可扩展、可用性比较好\n    * 可加密减少 cookie 被破解的可能性\n  * 缺点\n    * 在请求头上携带数据安全性差\n    * 数量和长度有限制，最多 20 条，最长不能超过 40k\n  * API\n    * 存储：`document.cookie = \"键=值\"`\n    * 读取：`var val = document.cookie`         \n    * 删除：\n      * `var date = new Date()`\n      * `document.cookie = \"key=value;expires=\" + date.toGMTString()`  \n\n\n  ```js\n  export const setCookie = (name, value, expiredays) => {\n      var exdate = new Date();　　　　\n      exdate.setDate(exdate.getDate() + expiredays);　　　　\n      document.cookie = name + \"=\" + escape(value) + ((expiredays == null) ? \"\" : \";expires=\" + exdate.toGMTString());\n  }\n\n  export const getCookie = name => {\n      var arr, reg = new RegExp(\"(^| )\" + name + \"=([^;]*)(;|$)\");\n      if (arr = document.cookie.match(reg))\n          return (arr[2]);\n      else\n          return null;\n  }\n\n  export const delCookie = name => {\n      var exp = new Date();\n      exp.setTime(exp.getTime() - 1);\n      var cval = this.getCookie(name);\n      if (cval != null)\n      document.cookie = name + \"=\" + cval + \";expires=\" + exp.toGMTString();\n  }\n  ```\n\n\n## localStorage\n> 本地存储方式可以长期存储数据，没有时间限制，而且可以储存电话本等大量数据\n\n  * 特点：同源策略限制、只在本地存储、永久保存、同浏览器共享\n  * 优点\n    * 扩展了 cookie 的 4k 限制\n    * 可以将请求数据直接存储到本地，节约带宽\n    * 遵循同源策略，不同网站之间不能直接共用\n  * 缺点\n    * 需要手动删除，否则长期存在\n    * 浏览器大小不一，版本的支持也不一样\n    * 只支持存储 string 类型的数据，JSON 对象需要转换\n    * 本质是对字符串的读取，如果存储内容多则会消耗内存空间而导致页面变卡\n  * 应用场景\n    * 多页面访问共同数据：可以在多个标签页中共享数据\n    * 数据比较大的临时保存方案：比如在线编辑文章时的自动保存\n  * API\n    * 存储：`localStorage.setItem(key, value)`\n    * 读取\n      * 单个：`localStorage.getItem(key)`\n      * 全部：`localStorage.valueOf()`\n    * 删除\n      * 单个：`localStorage.removeItem(key)`\n      * 全部：`localStorage.clear()`\n\n\n  ```js\n  export const setStore = (name, content) => {\n    if (!name) return;\n    if (typeof content !== 'string') {\n      content = JSON.stringify(content);\n    }\n    window.localStorage.setItem(name, content);\n  }\n  export const getStore = name => {\n    if (!name) return;\n    return window.localStorage.getItem(name);\n  }\n  export const removeStore = name => {\n    if (!name) return;\n    window.localStorage.removeItem(name);\n  }\n  ```\n\n\n## sessionStorage\n> 会话存储，关闭浏览器之后数据就会消失。非常适合单页应用程序，便于各业务模块之间的传值\n\n  * 特点\n    * __同源策略限制__ \n    * __单标签页限制__：同一个标签页中的同源页面共享数据\n    * __只在本地存储__：数据只会在存储在本地，并在标签页关闭后清除\n    * __存储方式__：采用键值对的方式，注意 value 值必须为字符串类型\n    * __存储上限限制__：不同的浏览器存储的上限不同，但大多数限制在 5MB 以下\n  * API\n    * 存储：`sessionStorage.setItem(key, value)`\n    * 读取\n      * 单个：`sessionStorage.getItem(key)`\n      * 全部：`sessionStorage.valueOf()`\n    * 删除\n      * 单个：`sessionStorage.removeItem(key)`\n      * 全部：`sessionStorage.clear()`\n\n \n\n\n## 以上区别\n  * 传递\n    * cookie 数据通常经过加密，而且会在浏览器和服务器间来回传递\n    * 后两个不会自动把数据发给服务器，仅在本地保存。\n  * 存储大小\n    * cookie 数据大小不能超过4k，始终在同源的 http 请求中携带\n    * 后两个虽然也有存储大小的限制但比 cookie 大得多，可以达到 5M 及以上\n  * 生命周期\n    * cookie 数据只在过期时间之前一直有效\n    * localStorage存储持久数据，不要不主动删除数据就有效有效\n    * sessionStorage数据在当前浏览器窗口关闭后自动删除\n  * 作用域    \n    * sessionStorage 不在不同浏览器窗口中共享\n    * 另外两个在所有同源窗口中都共享\n\n\n## 临时数据\n> html 标签上添加自定义属性来存储和操作数据，注意 js 可以动态添加和删除，但不能删除行内添加的\n\n  * html：`div data-name=\"值\"`，name 为自定义属性名\n  * 注意：`data-e-name：eName, data-myName：myname`\n  * 原生 js\n    * 获取：`div.dataset.name`\n    * 设置：`div.dataset.name = new`\n    * 删除：`div.dataset.name = null`\n  * jQuery\n    * 获取：`$(\"div\").data(\"name\")`\n    * 设置：`$(\"div\").data(\"name\", \"new\")`\n    * 删除：`$(\"div\").removeDate(\"name\")`\n\n\n\n# 九、用户登录\n\n## 实现逻辑\n  <div align=\"center\"> \n    ![登录注册逻辑](images/web/login.png)\n  </div> \n\n\n## 实现过程\n  1. 利用 Ajax 将用户名和密码发送到对应接口\n  2. 后台接收到对应数据后，通过用户名去查询对应密码\n  3. 对比查询到的密码和前台传过来的密码是否相等，如果相等返回成功，否则返回失败\n  4. 前端接收到登陆成功状态，将对应登陆成功的样式显示在对应位置，并将 username、userid 保存为 cookie (登陆状态保持)\n\n\n## Token\n> 遵从 oauth2.0 规范的授权令牌，它是一种身份/权限的认证方式 \n\n  1. 生成方式：服务端接收客户端发送的 userId，然后根据算法和编码方式生成\n  2. 优势\n    * 可以避免 CSRF 攻击\n    * 完全由应用管理，可以避开同源策略\n    * 可扩展性强(不用存储)，还可用于 APP\n    * 可以是无状态的，可以在多个服务间共享\n\n\n\n\n","slug":"10-web通信","published":1,"updated":"2019-05-10T17:13:41.774Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvid4pmk001u0nbxxyoubhpz","content":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><html><head></head><body><h1 id=\"一、HTTP-协议\"><a href=\"#一、HTTP-协议\" class=\"headerlink\" title=\"一、HTTP 协议\"></a>一、HTTP 协议</h1><blockquote><p>超文本传输协议，它是基于 TCP/IP 协议的一个应用层协议，用于定义客户端与服务器通信的格式，具有单向请求、无状态等特点</p></blockquote><h2 id=\"HTTP-报文\"><a href=\"#HTTP-报文\" class=\"headerlink\" title=\"HTTP 报文\"></a>HTTP 报文</h2><blockquote><p>HTTP 通信的传输单位，可分为 请求报文和响应报文，内部结构如下</p></blockquote><ul><li>请求行：用于说明请求方法、请求地址、http 版本号</li><li>响应行：用于说明服务器 http 版本号、响应状态码、状态码的原因短句</li><li>头部字段：分为 通用首部字段、请求首部字段、响应首部字段、实体首部字段</li><li>实体部分：可以用实体首部字段加以说明，常用 content-type 说明实体内容的类型</li></ul><h2 id=\"操作方式\"><a href=\"#操作方式\" class=\"headerlink\" title=\"操作方式\"></a>操作方式</h2><ul><li>浏览器的 url 地址栏</li><li>XMLHttpRequest 对象</li><li>页面有 src 属性的标签（img、script、link 等）</li><li>带有 action 属性的 form 表单</li></ul><h2 id=\"连接方式\"><a href=\"#连接方式\" class=\"headerlink\" title=\"连接方式\"></a>连接方式</h2><blockquote><p>实际上是 TCP 协议的长/短连接，区别在于数据传输后是否立即关闭连接</p></blockquote><ol><li>短连接<ul><li>HTTP1.0 默认方式。每次 HTTP 操作则建立一次连接，任务结束就立即关闭</li><li>常用于 并发量大但每个用户无需频繁操作的场景，比如浏览器网址的 http 服务</li></ul></li><li>长连接<ul><li>HTTP1.1 开始默认方式。任务结束后并不会立即关闭 TCP 连接，再次请求时继续使用</li><li>HTTP 响应头会添加 <code>Connection: keep-alive</code>，而且可以在服务器软件中设定连接时间</li></ul></li></ol><h2 id=\"工作流程\"><a href=\"#工作流程\" class=\"headerlink\" title=\"工作流程\"></a>工作流程</h2><ol><li>全部流程<div align=\"center\"><br><img src=\"images/web/http_req.png\" alt=\"HTTP 请求流程\"><br></div></li><li>域名解析过程<div align=\"center\"><br><img src=\"images/web/domain.png\" alt=\"域名解析过程\"><br></div></li><li>三次握手<div style=\"text-indent:2em\">TCP 协议中，建立 TCP 需要与百度服务器握手三次，你先告诉服务器你要给服务器发东西（SYN），服务器应答你并告诉你它也要给你发东西（SYN、ACK），然后你应答服务器（ACK），共来回3次，称为3次握手。</div></li></ol><h1 id=\"二、Ajax-请求\"><a href=\"#二、Ajax-请求\" class=\"headerlink\" title=\"二、Ajax 请求\"></a>二、Ajax 请求</h1><blockquote><p>异步网络请求，能够在页面不跳转不刷新的情况下实现局部加载的异步通信，减少了传输数据量</p></blockquote><h2 id=\"原理\"><a href=\"#原理\" class=\"headerlink\" title=\"原理\"></a>原理</h2><div style=\"text-indent:2em\">在用户和服务器之间加了―个中间层 (Ajax 引擎)，通过 XmlHttpRequest 对象来向服务器发异步请求并获取数据，然后通过 js 操作 DOM 而更新页面，这样就让用户操作与服务器响应实现了异步化，从而 js 可以及时向服务器提出请求和处理响应而不阻塞用户，达到无刷新的效果。注意如果出现乱码问题就是因为编码格式冲突，发送中文数据时通过 encodeURI() 编码，接收中文数据时通过 decodeURI() 解码即可。</div><h2 id=\"优点\"><a href=\"#优点\" class=\"headerlink\" title=\"优点\"></a>优点</h2><ul><li>使用异步方式与服务器通信，响应速度更快</li><li>基于标准化的并被广泛支持的技术，不需要下载插件或者小程序</li><li>页面无刷新，在页面内与服务器通信，减少用户等待时间，增强了用户体验</li><li>可以把一些原本服务器的工作转接到客户端，利用客户端闲置的能力来处理，减轻了服务器和带宽的负担，节约空间和宽带租用成本</li></ul><h2 id=\"缺点\"><a href=\"#缺点\" class=\"headerlink\" title=\"缺点\"></a>缺点</h2><ul><li>对搜索引擎的支持比较弱</li><li>可能会影响程序中的异常处理机制</li><li>无法进行操作的后退，即不支持浏览器的页面后退</li><li>安全问题，对一些网站攻击，比如 csrf、xxs、sql 注入等不能很好地防御</li></ul><h2 id=\"请求方式\"><a href=\"#请求方式\" class=\"headerlink\" title=\"请求方式\"></a>请求方式</h2><ol><li>区别<ul><li>method：<code>GET、POST</code></li><li>请求头：POST 发送数据时必须设置</li><li>安全性：GET 请求时暴露参数数据，安全性较低</li><li>长度限制：GET 有长度限制，不适合发送大量数据</li><li>请求缓存：GET 请求可以被缓存和保存，而 POST 请求不能</li><li>参数位置：<code>url?参数=值&参数=值、xhr.send(\"参数=值&参数=值\")</code></li></ul></li><li>场景<ul><li>GET：安全性要求不高时，从服务器获取数据</li><li>POST：对于大量数据、密码数据等，提交到服务器处理</li></ul></li></ol><h2 id=\"ContentType\"><a href=\"#ContentType\" class=\"headerlink\" title=\"ContentType\"></a>ContentType</h2><blockquote><p>请求体类型，告诉服务器发送数据的格式</p></blockquote><ul><li><code>application/x-www-form-urlencoded</code>：jquery ajax 默认类型，使用查询字符串格式的数据</li><li><code>multipart/form-data</code>：常用于表单上传文件，设置 form enctype 为该类型</li><li><code>application/json</code>：axios 默认类型，使用 json 格式的数据</li></ul><h2 id=\"原生写法\"><a href=\"#原生写法\" class=\"headerlink\" title=\"原生写法\"></a>原生写法</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1、创建 XMLHttpRequest 对象 (用来和服务器交换数据的 js 内置对象)</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> xhr;</span><br><span class=\"line\"><span class=\"keyword\">if</span>(XMLHttpRequest){</span><br><span class=\"line\">    xhr = <span class=\"keyword\">new</span> XMLHttpRequest();   <span class=\"comment\">// w3c 标准</span></span><br><span class=\"line\">}<span class=\"keyword\">else</span>{</span><br><span class=\"line\">    xhr = <span class=\"keyword\">new</span> ActiveXObject(<span class=\"string\">'Microsoft.XMLHTTP'</span>)  <span class=\"comment\">// IE6、IE5</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2、连接服务器和发送请求</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// GET </span></span><br><span class=\"line\">xhr.open(<span class=\"string\">'GET'</span>, url?参数=值, <span class=\"literal\">true</span>);   <span class=\"comment\">// true 表示请求异步处理</span></span><br><span class=\"line\">xhr.send();    </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// POST 必须设置请求头</span></span><br><span class=\"line\">xhr.open(<span class=\"string\">\"POST\"</span>, url, <span class=\"literal\">true</span>);   </span><br><span class=\"line\">xhr.setRequestHeader(<span class=\"string\">\"Content-type\"</span>, <span class=\"string\">\"application/x-www-form-urlencoded\"</span>);</span><br><span class=\"line\">xhr.send(<span class=\"string\">\"参数=值\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3、监听回调函数状态和处理响应数据</span></span><br><span class=\"line\">xhr.onreadystatechange = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"comment\">// 判断响应是否接收完成、服务器是否成功处理请求</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(xhr.readyState == <span class=\"number\">4</span> && xhr.status ==<span class=\"number\">200</span>){</span><br><span class=\"line\">        show.innerHTML = xhr.responseText;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"JQuery-写法\"><a href=\"#JQuery-写法\" class=\"headerlink\" title=\"JQuery 写法\"></a>JQuery 写法</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$.<span class=\"keyword\">get</span>(url?参数=值, calback)</span><br><span class=\"line\"></span><br><span class=\"line\">$.post(url, {参数：值}, callback)</span><br><span class=\"line\"></span><br><span class=\"line\">$.ajax({</span><br><span class=\"line\">    type:       <span class=\"comment\">// 数据的提交方式：get、post</span></span><br><span class=\"line\">    url:        <span class=\"comment\">// 请求地址</span></span><br><span class=\"line\">    <span class=\"keyword\">async</span>:      <span class=\"comment\">// 是否支持异步刷新，默认 true</span></span><br><span class=\"line\">    data:       <span class=\"comment\">// 需要提交的数据</span></span><br><span class=\"line\">    dataType:   <span class=\"comment\">// 服务器返回数据的类型，html、json, jsonp 等</span></span><br><span class=\"line\">    success: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>)</span>{</span><br><span class=\"line\">    }           <span class=\"comment\">// 请求成功后的回调函数 </span></span><br><span class=\"line\">    error:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>)</span>{</span><br><span class=\"line\">    }           <span class=\"comment\">// 请求失败后的回调函数 </span></span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h2 id=\"Ajax-封装\"><a href=\"#Ajax-封装\" class=\"headerlink\" title=\"Ajax 封装\"></a>Ajax 封装</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">requestUrl</span>(<span class=\"params\">url, type, data, callback, error, async</span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> <span class=\"keyword\">async</span> = (<span class=\"keyword\">async</span> == <span class=\"literal\">null</span> || <span class=\"keyword\">async</span>.toString() == <span class=\"string\">\"\"</span> || <span class=\"keyword\">typeof</span>(<span class=\"keyword\">async</span>) == <span class=\"string\">\"undefined\"</span>) ? <span class=\"literal\">true</span> : !!<span class=\"keyword\">async</span>;</span><br><span class=\"line\">    $.ajax({</span><br><span class=\"line\">        url: url,</span><br><span class=\"line\">        method: type,</span><br><span class=\"line\">        <span class=\"keyword\">async</span>: <span class=\"keyword\">async</span>,</span><br><span class=\"line\">        data: data</span><br><span class=\"line\">    })</span><br><span class=\"line\">    .done(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> _data </span>) </span>{</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (_data.status == <span class=\"number\">200</span>) {</span><br><span class=\"line\">            callback(_data.data);</span><br><span class=\"line\">        } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span>(error) == <span class=\"string\">'function'</span>) {</span><br><span class=\"line\">                error(_data)</span><br><span class=\"line\">            } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">                alert(_data.data.errMsg)</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    })</span><br><span class=\"line\">    .fail(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> jqXHR, textStatus </span>) </span>{</span><br><span class=\"line\">        setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">            requestUrl(url, type, data, callback, error, <span class=\"keyword\">async</span>);</span><br><span class=\"line\">        }, <span class=\"number\">1000</span>);</span><br><span class=\"line\">    })</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h1 id=\"三、Ajax-跨域\"><a href=\"#三、Ajax-跨域\" class=\"headerlink\" title=\"三、Ajax 跨域\"></a>三、Ajax 跨域</h1><blockquote><p>A 网站的 js 代码试图访问 B 网站的数据</p></blockquote><h2 id=\"同源策略\"><a href=\"#同源策略\" class=\"headerlink\" title=\"同源策略\"></a>同源策略</h2><div style=\"text-indent:2em\">浏览器出于安全方面的考虑，只允许与本域下的接口交互。不同源的客户端脚本在没有明确授权的情况下，不能读写对方的资源。ajax的请求与访问同样会受到浏览器同源策略的限制，不能访问不同主域中的地址。</div><h2 id=\"JSONP-跨域\"><a href=\"#JSONP-跨域\" class=\"headerlink\" title=\"JSONP 跨域\"></a>JSONP 跨域</h2><blockquote><p>jsonp 只是一种非强制性协议而不是新技术，和 json、ajax 都没有任何关系</p></blockquote><ol><li><strong>原理</strong>：利用 script 可以引用外部文件实现跨域请求的特点，动态添加 script 调用服务器的 js 脚本</li><li><strong>json 和 jsonp</strong><ul><li>json：一种轻量级的数据交换格式</li><li>jsonp：一种借助 script 元素解决主流浏览器的跨域读取数据问题的方式</li></ul></li><li><strong>实现方式</strong><ol><li>定义数据处理函数：<code>var handler = function(data){ }</code></li><li>创建 script 标签，src 的地址设置为 <code>url?callback=handler</code></li><li>服务端在收到请求后，解析参数并返回数据，输出 fun(data) 字符串</li><li>fun(data) 会放到 script 标签中作为 js 执行，即此时会调用函数</li></ol></li></ol><h2 id=\"CORS-跨域\"><a href=\"#CORS-跨域\" class=\"headerlink\" title=\"CORS 跨域\"></a>CORS 跨域</h2><blockquote><p>一个W3C标准，全称是”跨域资源共享，它允许浏览器向跨源服务器发出 xhr 请求</p></blockquote><ol><li><strong>原理</strong>：使用自定义的 HTTP 头部让浏览器与服务器沟通，决定请求是应该成功或失败</li><li><strong>使用</strong>：发送请求时附加一个额外的 origin 头部，比如 <code>Origin:http://www.nczonline.net</code></li></ol><h2 id=\"jQuery-Ajax-跨域\"><a href=\"#jQuery-Ajax-跨域\" class=\"headerlink\" title=\"jQuery Ajax 跨域\"></a>jQuery Ajax 跨域</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$.ajax({</span><br><span class=\"line\">    type: <span class=\"string\">\"get\"</span>,</span><br><span class=\"line\">    <span class=\"keyword\">async</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    url: url,</span><br><span class=\"line\">    data: data,</span><br><span class=\"line\">    dataType: <span class=\"string\">\"jsonp\"</span>,</span><br><span class=\"line\">    jsonp: <span class=\"string\">\"callback\"</span>,         <span class=\"comment\">// 传递给请求处理程序或页面来获取回调参数 </span></span><br><span class=\"line\">    jsonpCallback: <span class=\"string\">\"handler\"</span>   <span class=\"comment\">// 自定义的 jsonp 回调函数名称  </span></span><br><span class=\"line\">    success: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>)</span>{</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(data)</span><br><span class=\"line\">    }，</span><br><span class=\"line\">    error: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{ }</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h1 id=\"四、Ajax-数据\"><a href=\"#四、Ajax-数据\" class=\"headerlink\" title=\"四、Ajax 数据\"></a>四、Ajax 数据</h1><h2 id=\"JSON\"><a href=\"#JSON\" class=\"headerlink\" title=\"JSON\"></a>JSON</h2><blockquote><p>处理大量数据的规范格式</p></blockquote><ul><li>对象：<code>var json_obj = { name: 'Alice', age: 20 }</code></li><li>字符串：<code>var json_str = “{ name: 'Alice', age: 20 }”</code></li><li>转换<ul><li>对象转字符串：<code>JSON.stringify(json_obj)</code></li><li>字符串转对象：<code>JSON.parse(json_str) / eval('('+json_str+')')</code></li><li>eval：不推荐使用，因为它会把 js 数据而不只是 json_str 都转为 json 对象</li></ul></li></ul><h2 id=\"FormData\"><a href=\"#FormData\" class=\"headerlink\" title=\"FormData\"></a>FormData</h2><blockquote><p>处理包括图片和文件的表单数据并通过 post 方式发送到服务端</p></blockquote><ul><li>html<ul><li>form：<code>form id=\"form\" method=\"post\" enctype=\"multipart/form-data\"</code></li><li>input：<code>input type=\"file\" name=\"file\"</code></li></ul></li><li>操作<figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1、实例一个空 FormData 对象之后 append 键值对</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> formdata = <span class=\"keyword\">new</span> FormData() </span><br><span class=\"line\"><span class=\"keyword\">var</span> file = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"file\"</span>).files[<span class=\"number\">0</span>]</span><br><span class=\"line\">formData.append(<span class=\"string\">'file'</span>, file)</span><br><span class=\"line\">                          </span><br><span class=\"line\"><span class=\"comment\">// 2、form元素对象 作为参数传入  </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> form = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"form\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> formdata = <span class=\"keyword\">new</span> FormData(form);                          </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3、getFormData 方法</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> formobj =  <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"form\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> formdata = formobj.getFormData()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 其它 API：has、getAll、forEach</span></span><br><span class=\"line\">formdata.delete(<span class=\"string\">\"file\"</span>)   </span><br><span class=\"line\"><span class=\"keyword\">var</span> file = formdata.get(<span class=\"string\">\"file\"</span>)</span><br></pre></td></tr></tbody></table></figure></li></ul><h1 id=\"五、websocket\"><a href=\"#五、websocket\" class=\"headerlink\" title=\"五、websocket\"></a>五、websocket</h1><blockquote><p>一种全双工通信协议(双向通信)，和 HTTP 都是基于 TCP 协议的应用层协议，两者有良好的兼容性但没有联系。它能更好的节省服务器资源和带宽，而且可以实现实时通讯</p></blockquote><h2 id=\"实时通信\"><a href=\"#实时通信\" class=\"headerlink\" title=\"实时通信\"></a>实时通信</h2><ul><li>Ajax 轮询<ul><li>原理：客户端设置 计时器，每隔一段时间就向服务器发送一次请求</li><li>缺点：只能由客户端发起请求，而且需要服务器有很快的 资源处理速度</li></ul></li><li>http 长轮询<ul><li>原理：客户端发起请求建立连接后，服务器会等到有内容更新时才去响应，否则不响应</li><li>缺点：采用阻塞模型，需要服务器有很高的并发处理能力，会占用服务器更多的资源空间。</li></ul></li><li>WebSocket：只需要经过一个握手的动作，客户端与服务端就可以互相传送数据，不需要询问和等待</li></ul><h2 id=\"区分-Socket\"><a href=\"#区分-Socket\" class=\"headerlink\" title=\"区分 Socket\"></a>区分 Socket</h2><ul><li>WebSocket 在建立握手时通过 HTTP 传输数据，但是建立之后传输真正数据时不需要 HTTP</li><li>Socket 是应用层与TCP/IP协议族通信的中间软件抽象层，它其实并非一个协议而是一组接口</li></ul><h2 id=\"连接过程\"><a href=\"#连接过程\" class=\"headerlink\" title=\"连接过程\"></a>连接过程</h2><ol><li>浏览器、服务器通过 TCP 三次握手建立连接 (通信基础)</li><li>浏览器通过向服务器发起一个包含 WebSocket 支持版本号等附加头信息的 HTTP请求</li><li>服务器同样采用HTTP协议返回应答信息</li><li>当收到连接成功的信息后通过 TCP 通道进行传输通信</li><li>客户端/服务器端 关闭连接前可以自由传输数据</li></ol><h2 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 建立连接</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> ws = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initWebSocket</span></span>{</span><br><span class=\"line\">  <span class=\"comment\">// 浏览器支持则建立连接  </span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"string\">'WebSocket'</span> <span class=\"keyword\">in</span> <span class=\"built_in\">window</span>) {</span><br><span class=\"line\">      ws = <span class=\"keyword\">new</span> WebSocket(<span class=\"string\">'ws://10.148.221.210:5000'</span>)  </span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// 连接成功则向服务器发送数据</span></span><br><span class=\"line\">      ws.onopen = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">          <span class=\"comment\">// 0、1、2、3 ：正在连接、连接成功、连接正在关闭、连接失败或已关闭</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> (socket.readyState===<span class=\"number\">1</span>) {</span><br><span class=\"line\">              ws.send(<span class=\"string\">\"connect success\"</span>)</span><br><span class=\"line\">          }</span><br><span class=\"line\">      })</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// 收到服务器数据则执行相关处理</span></span><br><span class=\"line\">      socket.onmessage = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">msg</span>)</span>{ }</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// 连接失败则重连</span></span><br><span class=\"line\">      ws.addEventListener(<span class=\"string\">'error'</span>, fn)</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 离开当前页面时断开连接</span></span><br><span class=\"line\">ws.close()</span><br></pre></td></tr></tbody></table></figure><h1 id=\"六、表单数据\"><a href=\"#六、表单数据\" class=\"headerlink\" title=\"六、表单数据\"></a>六、表单数据</h1><h2 id=\"表单提交\"><a href=\"#表单提交\" class=\"headerlink\" title=\"表单提交\"></a>表单提交</h2><ol><li>问题：点击一次按钮而执行两次 Ajax</li><li>原因：执行完 Ajax 请之求后，并没有阻止 submit 提交</li><li>解决方案<ul><li>不使用 type=”submit” 的按钮，而使用 type=”button”</li><li>点击事件的回调函数中的最后一行添加：return false</li><li>先解绑再绑定：<code>$(\"#btn\").off(\"click\").on(\"click\", fn)</code></li></ul></li></ol><h2 id=\"表单序列化\"><a href=\"#表单序列化\" class=\"headerlink\" title=\"表单序列化\"></a>表单序列化</h2><blockquote><p>普通表单元素必须设置 name，checkbox 必须设置 name、value</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> data = $(<span class=\"string\">\"form\"</span>).serialize();           <span class=\"comment\">// 字符串 </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> jsonArr = $(<span class=\"string\">\"form\"</span>).serializeArray();   <span class=\"comment\">// 数组</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> jsonObj = $(<span class=\"string\">\"form\"</span>).serializeObject();  <span class=\"comment\">// JSON</span></span><br><span class=\"line\"></span><br><span class=\"line\">$.fn.serializeObject = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> o = {};</span><br><span class=\"line\">    <span class=\"keyword\">var</span> a = <span class=\"keyword\">this</span>.serializeArray();</span><br><span class=\"line\">    $.each(a, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">        <span class=\"keyword\">var</span> val = <span class=\"keyword\">this</span>.value || <span class=\"string\">''</span>   <span class=\"comment\">// 如果是 null 则赋值为 ''  </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(o[<span class=\"keyword\">this</span>.name]) {           </span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"keyword\">this</span>.value){</span><br><span class=\"line\">                o[<span class=\"keyword\">this</span>.name] = o[<span class=\"keyword\">this</span>.name] + <span class=\"string\">\",\"</span> + val;</span><br><span class=\"line\">            }</span><br><span class=\"line\">            </span><br><span class=\"line\">        } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">            o[<span class=\"keyword\">this</span>.name] = val; </span><br><span class=\"line\">        }</span><br><span class=\"line\">    });</span><br><span class=\"line\">    <span class=\"keyword\">var</span> $radio = $(<span class=\"string\">'input[type=radio],input[type=checkbox],select[multiple=\"multiple\"]'</span>,<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    $.each($radio,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!o.hasOwnProperty(<span class=\"keyword\">this</span>.name)){</span><br><span class=\"line\">            o[<span class=\"keyword\">this</span>.name] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        }<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(o[<span class=\"keyword\">this</span>.name] == <span class=\"string\">'on'</span>){</span><br><span class=\"line\">            o[<span class=\"keyword\">this</span>.name] = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        }<span class=\"keyword\">else</span>{</span><br><span class=\"line\">            o[<span class=\"keyword\">this</span>.name] = o[<span class=\"keyword\">this</span>.name];</span><br><span class=\"line\">        }</span><br><span class=\"line\">    });</span><br><span class=\"line\">    <span class=\"keyword\">return</span> o;</span><br><span class=\"line\">};</span><br></pre></td></tr></tbody></table></figure><h1 id=\"七、页面功能\"><a href=\"#七、页面功能\" class=\"headerlink\" title=\"七、页面功能\"></a>七、页面功能</h1><h2 id=\"页面跳转\"><a href=\"#页面跳转\" class=\"headerlink\" title=\"页面跳转\"></a>页面跳转</h2><ol><li>实现方式<ul><li>关闭当前页面，打开新页面<ul><li><code>a href=\"url\"</code></li><li><code>window.location.href = url</code></li></ul></li><li>保留当前页面，打开新页面<ul><li><code>a href=\"url\" target=\"_blank\"</code></li><li><code>window.open(url, \"_blank\")</code></li></ul></li><li>模拟点击 a 标签<ul><li><code>$(\"#box\")[0].click()</code></li><li><code>document.getElementById(\"box\").click()</code></li></ul></li></ul></li><li>传递数据<ul><li>url 查询字符串</li><li>cookie 等数据储存</li><li>window.open、window.opener</li></ul></li></ol><h2 id=\"页面刷新\"><a href=\"#页面刷新\" class=\"headerlink\" title=\"页面刷新\"></a>页面刷新</h2><ul><li><code>window.location.reload()</code></li><li><code>window.location.href = url</code></li><li><code>window.location.replace(url)</code></li></ul><h2 id=\"文件下载\"><a href=\"#文件下载\" class=\"headerlink\" title=\"文件下载\"></a>文件下载</h2><blockquote><p>浏览器中的文件地址打不开时就会变为下载</p></blockquote><ul><li><code>location.href = url</code>：</li><li>借助 Blob 和 download 属性实现文本信息文件下载</li><li><p>借助 Base64 实现任意文件下载</p><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">// location 下载文件</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">dl_file</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">   <span class=\"keyword\">var</span> url = <span class=\"string\">\"http://www.baidu.com/\"</span></span><br><span class=\"line\">   location.href = url + <span class=\"string\">\"?name=mike&age=20\"</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">//借助 Blob 和 download 属性实现文本信息文件下载</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bolb_download</span>(<span class=\"params\">content, filename</span>) </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"comment\">// 创建隐藏的可下载链接</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> link = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'a'</span>);</span><br><span class=\"line\">    link.download = filename;</span><br><span class=\"line\">     link.style.display = <span class=\"string\">'none'</span>;</span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"comment\">// 字符内容转变成blob地址</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> blob = <span class=\"keyword\">new</span> Blob([content]);</span><br><span class=\"line\">     link.href = URL.createObjectURL(blob);</span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"comment\">// 模拟点击和移除</span></span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.appendChild(link);</span><br><span class=\"line\">     link.click();</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.removeChild(link);</span><br><span class=\"line\">};</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"keyword\">var</span> textarea = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'textarea'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> btn = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'input[type=\"button\"]'</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"string\">'download'</span> <span class=\"keyword\">in</span> <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'a'</span>)) {</span><br><span class=\"line\">    <span class=\"comment\">// 作为test.html文件下载</span></span><br><span class=\"line\">    btn.addEventListener(<span class=\"string\">'click'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">        bolb_download(textarea.value, <span class=\"string\">'test.html'</span>);    </span><br><span class=\"line\">    });</span><br><span class=\"line\">} <span class=\"keyword\">else</span> {</span><br><span class=\"line\">    btn.onclick = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">        alert(<span class=\"string\">'浏览器不支持'</span>);    </span><br><span class=\"line\">    };</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">// 借助 Base64 实现任意文件下载</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">di_file</span>(<span class=\"params\">domImg, filename</span>) </span>{</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">var</span> link = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'a'</span>);</span><br><span class=\"line\">    link.download = filename;</span><br><span class=\"line\">     link.style.display = <span class=\"string\">'none'</span>;</span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"comment\">// 图片转 base64 地址</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'canvas'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> context = canvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> width = domImg.width;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> height = domImg.height;</span><br><span class=\"line\">     context.drawImage(domImg, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">     link.href = context.toDataURL(<span class=\"string\">'image/png'</span>);</span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"comment\">// 模拟点击和移除</span></span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.appendChild(link);</span><br><span class=\"line\">    link.click();</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.removeChild(link);</span><br><span class=\"line\">};</span><br></pre></td></tr></tbody></table></figure></li></ul><h2 id=\"图片上传\"><a href=\"#图片上传\" class=\"headerlink\" title=\"图片上传\"></a>图片上传</h2><div align=\"center\"><br><img src=\"images/web/img_upload.png\" alt=\"图片上传流程图\"><br></div><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// html：input type=\"file\" id=\"uploadImg\"</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getBase64Img</span>(<span class=\"params\">fileObj, callback</span>)</span>{  </span><br><span class=\"line\">    <span class=\"keyword\">var</span> reader = <span class=\"keyword\">new</span> FileReader();  </span><br><span class=\"line\">    reader.readAsDataURL(fileObj);   <span class=\"comment\">// 转为 Base64 格式 </span></span><br><span class=\"line\">    reader.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>)</span>{  </span><br><span class=\"line\">        <span class=\"comment\">// 变成字符串  </span></span><br><span class=\"line\">        <span class=\"comment\">// callback(reader.result);  </span></span><br><span class=\"line\">        callback(e.target.result);</span><br><span class=\"line\">    }  </span><br><span class=\"line\"> }</span><br><span class=\"line\"> <span class=\"keyword\">var</span> imgFile = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"fileInput\"</span>).files[<span class=\"number\">0</span>];</span><br><span class=\"line\"> fileInput.addEventListener(<span class=\"string\">\"change\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>) </span>{</span><br><span class=\"line\">   <span class=\"keyword\">var</span> file = fileInput.files[<span class=\"number\">0</span>];</span><br><span class=\"line\">   getBase64Img(file, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">imgBase64</span>)</span>{</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (imgBase64.length &gt; <span class=\"number\">2100000</span>) {</span><br><span class=\"line\">            <span class=\"comment\">// 2 M = 2097152 B</span></span><br><span class=\"line\">            alert( <span class=\"string\">'请上传不大于 2M 的图片！'</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      }<span class=\"keyword\">else</span>{</span><br><span class=\"line\">          <span class=\"comment\">// 截取 data:image/png;base64 后面的纯字符串</span></span><br><span class=\"line\">          <span class=\"keyword\">var</span> upload_file = imgBase64.substring(imgBase64.indexOf(<span class=\"string\">\",\"</span>) + <span class=\"number\">1</span>);</span><br><span class=\"line\">          <span class=\"comment\">// 上传截取后的字符串</span></span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(upload_file);</span><br><span class=\"line\">      }</span><br><span class=\"line\">  })</span><br><span class=\"line\"> }, <span class=\"literal\">false</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// oss 图片上传</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> ossUpload = {</span><br><span class=\"line\">    <span class=\"comment\">// 获取上传文件后缀</span></span><br><span class=\"line\">    getSuffix: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">filename</span>) </span>{</span><br><span class=\"line\">        <span class=\"keyword\">var</span> pos = filename.lastIndexOf(<span class=\"string\">'.'</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> suffix = <span class=\"string\">''</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (pos != <span class=\"number\">-1</span>) {</span><br><span class=\"line\">            suffix = filename.substring(pos + <span class=\"number\">1</span>)</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"keyword\">return</span> suffix;</span><br><span class=\"line\">    },</span><br><span class=\"line\">    <span class=\"comment\">// 配置上传参数</span></span><br><span class=\"line\">    setUpParam: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">$target ,data</span>) </span>{</span><br><span class=\"line\">        <span class=\"keyword\">var</span> formData = <span class=\"keyword\">new</span> FormData();</span><br><span class=\"line\">        $.each(data, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">i, n</span>) </span>{</span><br><span class=\"line\">            formData.append(i, n)</span><br><span class=\"line\">        })</span><br><span class=\"line\">        formData.append(<span class=\"string\">'file'</span>, $target[<span class=\"number\">0</span>].files[<span class=\"number\">0</span>]);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> formData;</span><br><span class=\"line\">    },</span><br><span class=\"line\">    <span class=\"comment\">// 上传图片</span></span><br><span class=\"line\">    uploadImg: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">url, formData, callback</span>) </span>{</span><br><span class=\"line\">        $.ajax({</span><br><span class=\"line\">            url: url.host,</span><br><span class=\"line\">            type: <span class=\"string\">'POST'</span>,</span><br><span class=\"line\">            data: formData,</span><br><span class=\"line\">            processData: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            contentType: <span class=\"literal\">false</span></span><br><span class=\"line\">        })</span><br><span class=\"line\">        .done(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>) </span>{</span><br><span class=\"line\">            callback(data);</span><br><span class=\"line\">        })</span><br><span class=\"line\">        .fail(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">            setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">                uploadImg(url, formData, callback);</span><br><span class=\"line\">            }, <span class=\"number\">1000</span>)</span><br><span class=\"line\">        })</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h1 id=\"八、数据储存\"><a href=\"#八、数据储存\" class=\"headerlink\" title=\"八、数据储存\"></a>八、数据储存</h1><h2 id=\"cookie\"><a href=\"#cookie\" class=\"headerlink\" title=\"cookie\"></a>cookie</h2><blockquote><p>随着每次 http 请求头信息一起发送，无形中增加了网络流量，而且能存储的数据容量较小，适用于购物车、客户端登录等场景</p></blockquote><ul><li>优点<ul><li>可控制过期时间</li><li>可扩展、可用性比较好</li><li>可加密减少 cookie 被破解的可能性</li></ul></li><li>缺点<ul><li>在请求头上携带数据安全性差</li><li>数量和长度有限制，最多 20 条，最长不能超过 40k</li></ul></li><li>API<ul><li>存储：<code>document.cookie = \"键=值\"</code></li><li>读取：<code>var val = document.cookie</code></li><li>删除：<ul><li><code>var date = new Date()</code></li><li><code>document.cookie = \"key=value;expires=\" + date.toGMTString()</code></li></ul></li></ul></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> setCookie = <span class=\"function\">(<span class=\"params\">name, value, expiredays</span>) =></span> {</span><br><span class=\"line\">    <span class=\"keyword\">var</span> exdate = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();　　　　</span><br><span class=\"line\">    exdate.setDate(exdate.getDate() + expiredays);　　　　</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.cookie = name + <span class=\"string\">\"=\"</span> + <span class=\"built_in\">escape</span>(value) + ((expiredays == <span class=\"literal\">null</span>) ? <span class=\"string\">\"\"</span> : <span class=\"string\">\";expires=\"</span> + exdate.toGMTString());</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> getCookie = <span class=\"function\"><span class=\"params\">name</span> =></span> {</span><br><span class=\"line\">    <span class=\"keyword\">var</span> arr, reg = <span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(<span class=\"string\">\"(^| )\"</span> + name + <span class=\"string\">\"=([^;]*)(;|$)\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (arr = <span class=\"built_in\">document</span>.cookie.match(reg))</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (arr[<span class=\"number\">2</span>]);</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> delCookie = <span class=\"function\"><span class=\"params\">name</span> =></span> {</span><br><span class=\"line\">    <span class=\"keyword\">var</span> exp = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\">    exp.setTime(exp.getTime() - <span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> cval = <span class=\"keyword\">this</span>.getCookie(name);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cval != <span class=\"literal\">null</span>)</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.cookie = name + <span class=\"string\">\"=\"</span> + cval + <span class=\"string\">\";expires=\"</span> + exp.toGMTString();</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"localStorage\"><a href=\"#localStorage\" class=\"headerlink\" title=\"localStorage\"></a>localStorage</h2><blockquote><p>本地存储方式可以长期存储数据，没有时间限制，而且可以储存电话本等大量数据</p></blockquote><ul><li>特点：同源策略限制、只在本地存储、永久保存、同浏览器共享</li><li>优点<ul><li>扩展了 cookie 的 4k 限制</li><li>可以将请求数据直接存储到本地，节约带宽</li><li>遵循同源策略，不同网站之间不能直接共用</li></ul></li><li>缺点<ul><li>需要手动删除，否则长期存在</li><li>浏览器大小不一，版本的支持也不一样</li><li>只支持存储 string 类型的数据，JSON 对象需要转换</li><li>本质是对字符串的读取，如果存储内容多则会消耗内存空间而导致页面变卡</li></ul></li><li>应用场景<ul><li>多页面访问共同数据：可以在多个标签页中共享数据</li><li>数据比较大的临时保存方案：比如在线编辑文章时的自动保存</li></ul></li><li>API<ul><li>存储：<code>localStorage.setItem(key, value)</code></li><li>读取<ul><li>单个：<code>localStorage.getItem(key)</code></li><li>全部：<code>localStorage.valueOf()</code></li></ul></li><li>删除<ul><li>单个：<code>localStorage.removeItem(key)</code></li><li>全部：<code>localStorage.clear()</code></li></ul></li></ul></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> setStore = <span class=\"function\">(<span class=\"params\">name, content</span>) =></span> {</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!name) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> content !== <span class=\"string\">'string'</span>) {</span><br><span class=\"line\">    content = <span class=\"built_in\">JSON</span>.stringify(content);</span><br><span class=\"line\">  }</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.localStorage.setItem(name, content);</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> getStore = <span class=\"function\"><span class=\"params\">name</span> =></span> {</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!name) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">window</span>.localStorage.getItem(name);</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> removeStore = <span class=\"function\"><span class=\"params\">name</span> =></span> {</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!name) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.localStorage.removeItem(name);</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"sessionStorage\"><a href=\"#sessionStorage\" class=\"headerlink\" title=\"sessionStorage\"></a>sessionStorage</h2><blockquote><p>会话存储，关闭浏览器之后数据就会消失。非常适合单页应用程序，便于各业务模块之间的传值</p></blockquote><ul><li>特点<ul><li><strong>同源策略限制</strong></li><li><strong>单标签页限制</strong>：同一个标签页中的同源页面共享数据</li><li><strong>只在本地存储</strong>：数据只会在存储在本地，并在标签页关闭后清除</li><li><strong>存储方式</strong>：采用键值对的方式，注意 value 值必须为字符串类型</li><li><strong>存储上限限制</strong>：不同的浏览器存储的上限不同，但大多数限制在 5MB 以下</li></ul></li><li>API<ul><li>存储：<code>sessionStorage.setItem(key, value)</code></li><li>读取<ul><li>单个：<code>sessionStorage.getItem(key)</code></li><li>全部：<code>sessionStorage.valueOf()</code></li></ul></li><li>删除<ul><li>单个：<code>sessionStorage.removeItem(key)</code></li><li>全部：<code>sessionStorage.clear()</code></li></ul></li></ul></li></ul><h2 id=\"以上区别\"><a href=\"#以上区别\" class=\"headerlink\" title=\"以上区别\"></a>以上区别</h2><ul><li>传递<ul><li>cookie 数据通常经过加密，而且会在浏览器和服务器间来回传递</li><li>后两个不会自动把数据发给服务器，仅在本地保存。</li></ul></li><li>存储大小<ul><li>cookie 数据大小不能超过4k，始终在同源的 http 请求中携带</li><li>后两个虽然也有存储大小的限制但比 cookie 大得多，可以达到 5M 及以上</li></ul></li><li>生命周期<ul><li>cookie 数据只在过期时间之前一直有效</li><li>localStorage存储持久数据，不要不主动删除数据就有效有效</li><li>sessionStorage数据在当前浏览器窗口关闭后自动删除</li></ul></li><li>作用域<ul><li>sessionStorage 不在不同浏览器窗口中共享</li><li>另外两个在所有同源窗口中都共享</li></ul></li></ul><h2 id=\"临时数据\"><a href=\"#临时数据\" class=\"headerlink\" title=\"临时数据\"></a>临时数据</h2><blockquote><p>html 标签上添加自定义属性来存储和操作数据，注意 js 可以动态添加和删除，但不能删除行内添加的</p></blockquote><ul><li>html：<code>div data-name=\"值\"</code>，name 为自定义属性名</li><li>注意：<code>data-e-name：eName, data-myName：myname</code></li><li>原生 js<ul><li>获取：<code>div.dataset.name</code></li><li>设置：<code>div.dataset.name = new</code></li><li>删除：<code>div.dataset.name = null</code></li></ul></li><li>jQuery<ul><li>获取：<code>$(\"div\").data(\"name\")</code></li><li>设置：<code>$(\"div\").data(\"name\", \"new\")</code></li><li>删除：<code>$(\"div\").removeDate(\"name\")</code></li></ul></li></ul><h1 id=\"九、用户登录\"><a href=\"#九、用户登录\" class=\"headerlink\" title=\"九、用户登录\"></a>九、用户登录</h1><h2 id=\"实现逻辑\"><a href=\"#实现逻辑\" class=\"headerlink\" title=\"实现逻辑\"></a>实现逻辑</h2><div align=\"center\"><br><img src=\"images/web/login.png\" alt=\"登录注册逻辑\"><br></div><h2 id=\"实现过程\"><a href=\"#实现过程\" class=\"headerlink\" title=\"实现过程\"></a>实现过程</h2><ol><li>利用 Ajax 将用户名和密码发送到对应接口</li><li>后台接收到对应数据后，通过用户名去查询对应密码</li><li>对比查询到的密码和前台传过来的密码是否相等，如果相等返回成功，否则返回失败</li><li>前端接收到登陆成功状态，将对应登陆成功的样式显示在对应位置，并将 username、userid 保存为 cookie (登陆状态保持)</li></ol><h2 id=\"Token\"><a href=\"#Token\" class=\"headerlink\" title=\"Token\"></a>Token</h2><blockquote><p>遵从 oauth2.0 规范的授权令牌，它是一种身份/权限的认证方式</p></blockquote><ol><li>生成方式：服务端接收客户端发送的 userId，然后根据算法和编码方式生成</li><li>优势<ul><li>可以避免 CSRF 攻击</li><li>完全由应用管理，可以避开同源策略</li><li>可扩展性强(不用存储)，还可用于 APP</li><li>可以是无状态的，可以在多个服务间共享</li></ul></li></ol><!-- rebuild by neat --></body></html>","site":{"data":{"next":{"override":false,"cache":{"enable":true},"favicon":{"small":"/images/favicon-16.ico","medium":"/images/favicon-32.ico","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"rss":"/atom.xml","footer":{"since":2019,"icon":{"name":"snowflake-o","animated":false,"color":"#808080"},"copyright":"chuangge","powered":{"enable":false,"version":true},"theme":{"enable":false,"version":true},"beian":{"enable":false,"icp":null}},"creative_commons":{"license":"by-nc-sa","sidebar":false,"post":false},"canonical":true,"seo":false,"index_with_subtitle":false,"exturl":false,"menu":{"home":"/ || home  //首页","tags":"/tags/ || tags  //标签","categories":"/categories/ || th   //分类","archives":"/archives/ || archive //归档"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":{"GitHub":"https://github.com/ || github","StackOverflow":"https://stackoverflow.com/ || stack-overflow"},"social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"友情链接","links_layout":"inline","links":{"个人简历":"https://chuanggefighting.github.io/project/","印记中文":"https://www.docschina.org/","在线工具":"http://tool.lu/","Learn Anything":"https://learn-anything.xyz/"},"avatar":{"url":"/images/chuang.png","rounded":true,"opacity":1,"rotated":true},"toc":{"enable":true,"number":true,"wrap":false,"max_depth":6},"sidebar":{"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"read_more_btn":true,"post_meta":{"item_text":true,"created_at":true,"updated_at":{"enabled":true,"another_day":true},"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":true,"awl":4,"wpm":275},"codeblock":{"border_radius":null,"copy_button":{"enable":false,"show_result":false}},"reward":{"enable":false},"related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_edit":{"enable":false,"url":"https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name"},"disable_baidu_tranformation":false,"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"font":{"enable":true,"host":"//fonts.proxy.ustclug.org","global":{"external":true,"family":"Lato","size":16},"headings":{"external":true,"family":"Roboto Slab","size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":"Lobster Two","size":24},"codes":{"external":true,"family":"Roboto Mono","size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css","copy_tex":{"enable":false,"copy_tex_js":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js","copy_tex_css":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css"}}},"pdf":{"enable":false,"per_page":true,"height":"500px","pdfobject":{"cdn":"//cdn.jsdelivr.net/npm/pdfobject@2.1.1/pdfobject.min.js"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":true,"appid":"snOvapuSplYTVflf5p9Ml9JX-gzGzoHsz","appkey":"5ABGdfyEdAtu6lTXdGdo7hf9","notify":false,"verify":false,"placeholder":"ヾﾉ≧∀≦)o 来呀！吐槽一番吧！","avatar":"mm","guest_info":"nick,mail,link","pageSize":10,"visitor":false,"comment_count":true},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"gitalk":{"enable":false,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true},"needmoreshare2":{"enable":true,"postbottom":{"enable":true,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null,"security":false,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":true,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":true,"pace_theme":"pace-theme-center-simple","canvas_nest":{"enable":true,"onmobile":true,"color":"0,0,255","opacity":0.5,"zIndex":-1,"count":99},"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"canvas_nest_nomobile":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"leancloud":null,"valine":null,"gitalk_js":null,"gitalk_css":null,"md5":null},"css":"css","js":"js","images":"images","passage_end_tag":{"enabled":true},"daovoice":true,"daovoice_app_id":"2ed51855"}}},"excerpt":"","more":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><h1 id=\"一、HTTP-协议\"><a href=\"#一、HTTP-协议\" class=\"headerlink\" title=\"一、HTTP 协议\"></a>一、HTTP 协议</h1><blockquote><p>超文本传输协议，它是基于 TCP/IP 协议的一个应用层协议，用于定义客户端与服务器通信的格式，具有单向请求、无状态等特点</p></blockquote><h2 id=\"HTTP-报文\"><a href=\"#HTTP-报文\" class=\"headerlink\" title=\"HTTP 报文\"></a>HTTP 报文</h2><blockquote><p>HTTP 通信的传输单位，可分为 请求报文和响应报文，内部结构如下</p></blockquote><ul><li>请求行：用于说明请求方法、请求地址、http 版本号</li><li>响应行：用于说明服务器 http 版本号、响应状态码、状态码的原因短句</li><li>头部字段：分为 通用首部字段、请求首部字段、响应首部字段、实体首部字段</li><li>实体部分：可以用实体首部字段加以说明，常用 content-type 说明实体内容的类型</li></ul><h2 id=\"操作方式\"><a href=\"#操作方式\" class=\"headerlink\" title=\"操作方式\"></a>操作方式</h2><ul><li>浏览器的 url 地址栏</li><li>XMLHttpRequest 对象</li><li>页面有 src 属性的标签（img、script、link 等）</li><li>带有 action 属性的 form 表单</li></ul><h2 id=\"连接方式\"><a href=\"#连接方式\" class=\"headerlink\" title=\"连接方式\"></a>连接方式</h2><blockquote><p>实际上是 TCP 协议的长/短连接，区别在于数据传输后是否立即关闭连接</p></blockquote><ol><li>短连接<ul><li>HTTP1.0 默认方式。每次 HTTP 操作则建立一次连接，任务结束就立即关闭</li><li>常用于 并发量大但每个用户无需频繁操作的场景，比如浏览器网址的 http 服务</li></ul></li><li>长连接<ul><li>HTTP1.1 开始默认方式。任务结束后并不会立即关闭 TCP 连接，再次请求时继续使用</li><li>HTTP 响应头会添加 <code>Connection: keep-alive</code>，而且可以在服务器软件中设定连接时间</li></ul></li></ol><h2 id=\"工作流程\"><a href=\"#工作流程\" class=\"headerlink\" title=\"工作流程\"></a>工作流程</h2><ol><li>全部流程<div align=\"center\"><br><img src=\"images/web/http_req.png\" alt=\"HTTP 请求流程\"><br></div></li><li>域名解析过程<div align=\"center\"><br><img src=\"images/web/domain.png\" alt=\"域名解析过程\"><br></div></li><li>三次握手<div style=\"text-indent:2em\">TCP 协议中，建立 TCP 需要与百度服务器握手三次，你先告诉服务器你要给服务器发东西（SYN），服务器应答你并告诉你它也要给你发东西（SYN、ACK），然后你应答服务器（ACK），共来回3次，称为3次握手。</div></li></ol><h1 id=\"二、Ajax-请求\"><a href=\"#二、Ajax-请求\" class=\"headerlink\" title=\"二、Ajax 请求\"></a>二、Ajax 请求</h1><blockquote><p>异步网络请求，能够在页面不跳转不刷新的情况下实现局部加载的异步通信，减少了传输数据量</p></blockquote><h2 id=\"原理\"><a href=\"#原理\" class=\"headerlink\" title=\"原理\"></a>原理</h2><div style=\"text-indent:2em\">在用户和服务器之间加了―个中间层 (Ajax 引擎)，通过 XmlHttpRequest 对象来向服务器发异步请求并获取数据，然后通过 js 操作 DOM 而更新页面，这样就让用户操作与服务器响应实现了异步化，从而 js 可以及时向服务器提出请求和处理响应而不阻塞用户，达到无刷新的效果。注意如果出现乱码问题就是因为编码格式冲突，发送中文数据时通过 encodeURI() 编码，接收中文数据时通过 decodeURI() 解码即可。</div><h2 id=\"优点\"><a href=\"#优点\" class=\"headerlink\" title=\"优点\"></a>优点</h2><ul><li>使用异步方式与服务器通信，响应速度更快</li><li>基于标准化的并被广泛支持的技术，不需要下载插件或者小程序</li><li>页面无刷新，在页面内与服务器通信，减少用户等待时间，增强了用户体验</li><li>可以把一些原本服务器的工作转接到客户端，利用客户端闲置的能力来处理，减轻了服务器和带宽的负担，节约空间和宽带租用成本</li></ul><h2 id=\"缺点\"><a href=\"#缺点\" class=\"headerlink\" title=\"缺点\"></a>缺点</h2><ul><li>对搜索引擎的支持比较弱</li><li>可能会影响程序中的异常处理机制</li><li>无法进行操作的后退，即不支持浏览器的页面后退</li><li>安全问题，对一些网站攻击，比如 csrf、xxs、sql 注入等不能很好地防御</li></ul><h2 id=\"请求方式\"><a href=\"#请求方式\" class=\"headerlink\" title=\"请求方式\"></a>请求方式</h2><ol><li>区别<ul><li>method：<code>GET、POST</code></li><li>请求头：POST 发送数据时必须设置</li><li>安全性：GET 请求时暴露参数数据，安全性较低</li><li>长度限制：GET 有长度限制，不适合发送大量数据</li><li>请求缓存：GET 请求可以被缓存和保存，而 POST 请求不能</li><li>参数位置：<code>url?参数=值&amp;参数=值、xhr.send(&quot;参数=值&amp;参数=值&quot;)</code></li></ul></li><li>场景<ul><li>GET：安全性要求不高时，从服务器获取数据</li><li>POST：对于大量数据、密码数据等，提交到服务器处理</li></ul></li></ol><h2 id=\"ContentType\"><a href=\"#ContentType\" class=\"headerlink\" title=\"ContentType\"></a>ContentType</h2><blockquote><p>请求体类型，告诉服务器发送数据的格式</p></blockquote><ul><li><code>application/x-www-form-urlencoded</code>：jquery ajax 默认类型，使用查询字符串格式的数据</li><li><code>multipart/form-data</code>：常用于表单上传文件，设置 form enctype 为该类型</li><li><code>application/json</code>：axios 默认类型，使用 json 格式的数据</li></ul><h2 id=\"原生写法\"><a href=\"#原生写法\" class=\"headerlink\" title=\"原生写法\"></a>原生写法</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1、创建 XMLHttpRequest 对象 (用来和服务器交换数据的 js 内置对象)</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> xhr;</span><br><span class=\"line\"><span class=\"keyword\">if</span>(XMLHttpRequest)&#123;</span><br><span class=\"line\">    xhr = <span class=\"keyword\">new</span> XMLHttpRequest();   <span class=\"comment\">// w3c 标准</span></span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">    xhr = <span class=\"keyword\">new</span> ActiveXObject(<span class=\"string\">'Microsoft.XMLHTTP'</span>)  <span class=\"comment\">// IE6、IE5</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2、连接服务器和发送请求</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// GET </span></span><br><span class=\"line\">xhr.open(<span class=\"string\">'GET'</span>, url?参数=值, <span class=\"literal\">true</span>);   <span class=\"comment\">// true 表示请求异步处理</span></span><br><span class=\"line\">xhr.send();    </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// POST 必须设置请求头</span></span><br><span class=\"line\">xhr.open(<span class=\"string\">\"POST\"</span>, url, <span class=\"literal\">true</span>);   </span><br><span class=\"line\">xhr.setRequestHeader(<span class=\"string\">\"Content-type\"</span>, <span class=\"string\">\"application/x-www-form-urlencoded\"</span>);</span><br><span class=\"line\">xhr.send(<span class=\"string\">\"参数=值\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3、监听回调函数状态和处理响应数据</span></span><br><span class=\"line\">xhr.onreadystatechange = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 判断响应是否接收完成、服务器是否成功处理请求</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(xhr.readyState == <span class=\"number\">4</span> &amp;&amp; xhr.status ==<span class=\"number\">200</span>)&#123;</span><br><span class=\"line\">        show.innerHTML = xhr.responseText;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"JQuery-写法\"><a href=\"#JQuery-写法\" class=\"headerlink\" title=\"JQuery 写法\"></a>JQuery 写法</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$.<span class=\"keyword\">get</span>(url?参数=值, calback)</span><br><span class=\"line\"></span><br><span class=\"line\">$.post(url, &#123;参数：值&#125;, callback)</span><br><span class=\"line\"></span><br><span class=\"line\">$.ajax(&#123;</span><br><span class=\"line\">    type:       <span class=\"comment\">// 数据的提交方式：get、post</span></span><br><span class=\"line\">    url:        <span class=\"comment\">// 请求地址</span></span><br><span class=\"line\">    <span class=\"keyword\">async</span>:      <span class=\"comment\">// 是否支持异步刷新，默认 true</span></span><br><span class=\"line\">    data:       <span class=\"comment\">// 需要提交的数据</span></span><br><span class=\"line\">    dataType:   <span class=\"comment\">// 服务器返回数据的类型，html、json, jsonp 等</span></span><br><span class=\"line\">    success: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>)</span>&#123;</span><br><span class=\"line\">    &#125;           <span class=\"comment\">// 请求成功后的回调函数 </span></span><br><span class=\"line\">    error:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>)</span>&#123;</span><br><span class=\"line\">    &#125;           <span class=\"comment\">// 请求失败后的回调函数 </span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h2 id=\"Ajax-封装\"><a href=\"#Ajax-封装\" class=\"headerlink\" title=\"Ajax 封装\"></a>Ajax 封装</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">requestUrl</span>(<span class=\"params\">url, type, data, callback, error, async</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> <span class=\"keyword\">async</span> = (<span class=\"keyword\">async</span> == <span class=\"literal\">null</span> || <span class=\"keyword\">async</span>.toString() == <span class=\"string\">\"\"</span> || <span class=\"keyword\">typeof</span>(<span class=\"keyword\">async</span>) == <span class=\"string\">\"undefined\"</span>) ? <span class=\"literal\">true</span> : !!<span class=\"keyword\">async</span>;</span><br><span class=\"line\">    $.ajax(&#123;</span><br><span class=\"line\">        url: url,</span><br><span class=\"line\">        method: type,</span><br><span class=\"line\">        <span class=\"keyword\">async</span>: <span class=\"keyword\">async</span>,</span><br><span class=\"line\">        data: data</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .done(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> _data </span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (_data.status == <span class=\"number\">200</span>) &#123;</span><br><span class=\"line\">            callback(_data.data);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span>(error) == <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">                error(_data)</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                alert(_data.data.errMsg)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .fail(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> jqXHR, textStatus </span>) </span>&#123;</span><br><span class=\"line\">        setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            requestUrl(url, type, data, callback, error, <span class=\"keyword\">async</span>);</span><br><span class=\"line\">        &#125;, <span class=\"number\">1000</span>);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h1 id=\"三、Ajax-跨域\"><a href=\"#三、Ajax-跨域\" class=\"headerlink\" title=\"三、Ajax 跨域\"></a>三、Ajax 跨域</h1><blockquote><p>A 网站的 js 代码试图访问 B 网站的数据</p></blockquote><h2 id=\"同源策略\"><a href=\"#同源策略\" class=\"headerlink\" title=\"同源策略\"></a>同源策略</h2><div style=\"text-indent:2em\">浏览器出于安全方面的考虑，只允许与本域下的接口交互。不同源的客户端脚本在没有明确授权的情况下，不能读写对方的资源。ajax的请求与访问同样会受到浏览器同源策略的限制，不能访问不同主域中的地址。</div><h2 id=\"JSONP-跨域\"><a href=\"#JSONP-跨域\" class=\"headerlink\" title=\"JSONP 跨域\"></a>JSONP 跨域</h2><blockquote><p>jsonp 只是一种非强制性协议而不是新技术，和 json、ajax 都没有任何关系</p></blockquote><ol><li><strong>原理</strong>：利用 script 可以引用外部文件实现跨域请求的特点，动态添加 script 调用服务器的 js 脚本</li><li><strong>json 和 jsonp</strong><ul><li>json：一种轻量级的数据交换格式</li><li>jsonp：一种借助 script 元素解决主流浏览器的跨域读取数据问题的方式</li></ul></li><li><strong>实现方式</strong><ol><li>定义数据处理函数：<code>var handler = function(data){ }</code></li><li>创建 script 标签，src 的地址设置为 <code>url?callback=handler</code></li><li>服务端在收到请求后，解析参数并返回数据，输出 fun(data) 字符串</li><li>fun(data) 会放到 script 标签中作为 js 执行，即此时会调用函数</li></ol></li></ol><h2 id=\"CORS-跨域\"><a href=\"#CORS-跨域\" class=\"headerlink\" title=\"CORS 跨域\"></a>CORS 跨域</h2><blockquote><p>一个W3C标准，全称是”跨域资源共享，它允许浏览器向跨源服务器发出 xhr 请求</p></blockquote><ol><li><strong>原理</strong>：使用自定义的 HTTP 头部让浏览器与服务器沟通，决定请求是应该成功或失败</li><li><strong>使用</strong>：发送请求时附加一个额外的 origin 头部，比如 <code>Origin:http://www.nczonline.net</code></li></ol><h2 id=\"jQuery-Ajax-跨域\"><a href=\"#jQuery-Ajax-跨域\" class=\"headerlink\" title=\"jQuery Ajax 跨域\"></a>jQuery Ajax 跨域</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$.ajax(&#123;</span><br><span class=\"line\">    type: <span class=\"string\">\"get\"</span>,</span><br><span class=\"line\">    <span class=\"keyword\">async</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    url: url,</span><br><span class=\"line\">    data: data,</span><br><span class=\"line\">    dataType: <span class=\"string\">\"jsonp\"</span>,</span><br><span class=\"line\">    jsonp: <span class=\"string\">\"callback\"</span>,         <span class=\"comment\">// 传递给请求处理程序或页面来获取回调参数 </span></span><br><span class=\"line\">    jsonpCallback: <span class=\"string\">\"handler\"</span>   <span class=\"comment\">// 自定义的 jsonp 回调函数名称  </span></span><br><span class=\"line\">    success: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(data)</span><br><span class=\"line\">    &#125;，</span><br><span class=\"line\">    error: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h1 id=\"四、Ajax-数据\"><a href=\"#四、Ajax-数据\" class=\"headerlink\" title=\"四、Ajax 数据\"></a>四、Ajax 数据</h1><h2 id=\"JSON\"><a href=\"#JSON\" class=\"headerlink\" title=\"JSON\"></a>JSON</h2><blockquote><p>处理大量数据的规范格式</p></blockquote><ul><li>对象：<code>var json_obj = { name: &#39;Alice&#39;, age: 20 }</code></li><li>字符串：<code>var json_str = “{ name: &#39;Alice&#39;, age: 20 }”</code></li><li>转换<ul><li>对象转字符串：<code>JSON.stringify(json_obj)</code></li><li>字符串转对象：<code>JSON.parse(json_str) / eval(&#39;(&#39;+json_str+&#39;)&#39;)</code></li><li>eval：不推荐使用，因为它会把 js 数据而不只是 json_str 都转为 json 对象</li></ul></li></ul><h2 id=\"FormData\"><a href=\"#FormData\" class=\"headerlink\" title=\"FormData\"></a>FormData</h2><blockquote><p>处理包括图片和文件的表单数据并通过 post 方式发送到服务端</p></blockquote><ul><li>html<ul><li>form：<code>form id=&quot;form&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;</code></li><li>input：<code>input type=&quot;file&quot; name=&quot;file&quot;</code></li></ul></li><li>操作<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1、实例一个空 FormData 对象之后 append 键值对</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> formdata = <span class=\"keyword\">new</span> FormData() </span><br><span class=\"line\"><span class=\"keyword\">var</span> file = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"file\"</span>).files[<span class=\"number\">0</span>]</span><br><span class=\"line\">formData.append(<span class=\"string\">'file'</span>, file)</span><br><span class=\"line\">                          </span><br><span class=\"line\"><span class=\"comment\">// 2、form元素对象 作为参数传入  </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> form = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"form\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> formdata = <span class=\"keyword\">new</span> FormData(form);                          </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3、getFormData 方法</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> formobj =  <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"form\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> formdata = formobj.getFormData()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 其它 API：has、getAll、forEach</span></span><br><span class=\"line\">formdata.delete(<span class=\"string\">\"file\"</span>)   </span><br><span class=\"line\"><span class=\"keyword\">var</span> file = formdata.get(<span class=\"string\">\"file\"</span>)</span><br></pre></td></tr></table></figure></li></ul><h1 id=\"五、websocket\"><a href=\"#五、websocket\" class=\"headerlink\" title=\"五、websocket\"></a>五、websocket</h1><blockquote><p>一种全双工通信协议(双向通信)，和 HTTP 都是基于 TCP 协议的应用层协议，两者有良好的兼容性但没有联系。它能更好的节省服务器资源和带宽，而且可以实现实时通讯</p></blockquote><h2 id=\"实时通信\"><a href=\"#实时通信\" class=\"headerlink\" title=\"实时通信\"></a>实时通信</h2><ul><li>Ajax 轮询<ul><li>原理：客户端设置 计时器，每隔一段时间就向服务器发送一次请求</li><li>缺点：只能由客户端发起请求，而且需要服务器有很快的 资源处理速度</li></ul></li><li>http 长轮询<ul><li>原理：客户端发起请求建立连接后，服务器会等到有内容更新时才去响应，否则不响应</li><li>缺点：采用阻塞模型，需要服务器有很高的并发处理能力，会占用服务器更多的资源空间。</li></ul></li><li>WebSocket：只需要经过一个握手的动作，客户端与服务端就可以互相传送数据，不需要询问和等待</li></ul><h2 id=\"区分-Socket\"><a href=\"#区分-Socket\" class=\"headerlink\" title=\"区分 Socket\"></a>区分 Socket</h2><ul><li>WebSocket 在建立握手时通过 HTTP 传输数据，但是建立之后传输真正数据时不需要 HTTP</li><li>Socket 是应用层与TCP/IP协议族通信的中间软件抽象层，它其实并非一个协议而是一组接口</li></ul><h2 id=\"连接过程\"><a href=\"#连接过程\" class=\"headerlink\" title=\"连接过程\"></a>连接过程</h2><ol><li>浏览器、服务器通过 TCP 三次握手建立连接 (通信基础)</li><li>浏览器通过向服务器发起一个包含 WebSocket 支持版本号等附加头信息的 HTTP请求</li><li>服务器同样采用HTTP协议返回应答信息</li><li>当收到连接成功的信息后通过 TCP 通道进行传输通信</li><li>客户端/服务器端 关闭连接前可以自由传输数据</li></ol><h2 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 建立连接</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> ws = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initWebSocket</span></span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 浏览器支持则建立连接  </span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"string\">'WebSocket'</span> <span class=\"keyword\">in</span> <span class=\"built_in\">window</span>) &#123;</span><br><span class=\"line\">      ws = <span class=\"keyword\">new</span> WebSocket(<span class=\"string\">'ws://10.148.221.210:5000'</span>)  </span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// 连接成功则向服务器发送数据</span></span><br><span class=\"line\">      ws.onopen = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"comment\">// 0、1、2、3 ：正在连接、连接成功、连接正在关闭、连接失败或已关闭</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> (socket.readyState===<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">              ws.send(<span class=\"string\">\"connect success\"</span>)</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// 收到服务器数据则执行相关处理</span></span><br><span class=\"line\">      socket.onmessage = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">msg</span>)</span>&#123; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// 连接失败则重连</span></span><br><span class=\"line\">      ws.addEventListener(<span class=\"string\">'error'</span>, fn)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 离开当前页面时断开连接</span></span><br><span class=\"line\">ws.close()</span><br></pre></td></tr></table></figure><h1 id=\"六、表单数据\"><a href=\"#六、表单数据\" class=\"headerlink\" title=\"六、表单数据\"></a>六、表单数据</h1><h2 id=\"表单提交\"><a href=\"#表单提交\" class=\"headerlink\" title=\"表单提交\"></a>表单提交</h2><ol><li>问题：点击一次按钮而执行两次 Ajax</li><li>原因：执行完 Ajax 请之求后，并没有阻止 submit 提交</li><li>解决方案<ul><li>不使用 type=”submit” 的按钮，而使用 type=”button”</li><li>点击事件的回调函数中的最后一行添加：return false</li><li>先解绑再绑定：<code>$(&quot;#btn&quot;).off(&quot;click&quot;).on(&quot;click&quot;, fn)</code></li></ul></li></ol><h2 id=\"表单序列化\"><a href=\"#表单序列化\" class=\"headerlink\" title=\"表单序列化\"></a>表单序列化</h2><blockquote><p>普通表单元素必须设置 name，checkbox 必须设置 name、value</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> data = $(<span class=\"string\">\"form\"</span>).serialize();           <span class=\"comment\">// 字符串 </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> jsonArr = $(<span class=\"string\">\"form\"</span>).serializeArray();   <span class=\"comment\">// 数组</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> jsonObj = $(<span class=\"string\">\"form\"</span>).serializeObject();  <span class=\"comment\">// JSON</span></span><br><span class=\"line\"></span><br><span class=\"line\">$.fn.serializeObject = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> o = &#123;&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> a = <span class=\"keyword\">this</span>.serializeArray();</span><br><span class=\"line\">    $.each(a, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> val = <span class=\"keyword\">this</span>.value || <span class=\"string\">''</span>   <span class=\"comment\">// 如果是 null 则赋值为 ''  </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(o[<span class=\"keyword\">this</span>.name]) &#123;           </span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"keyword\">this</span>.value)&#123;</span><br><span class=\"line\">                o[<span class=\"keyword\">this</span>.name] = o[<span class=\"keyword\">this</span>.name] + <span class=\"string\">\",\"</span> + val;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            o[<span class=\"keyword\">this</span>.name] = val; </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> $radio = $(<span class=\"string\">'input[type=radio],input[type=checkbox],select[multiple=\"multiple\"]'</span>,<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    $.each($radio,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!o.hasOwnProperty(<span class=\"keyword\">this</span>.name))&#123;</span><br><span class=\"line\">            o[<span class=\"keyword\">this</span>.name] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(o[<span class=\"keyword\">this</span>.name] == <span class=\"string\">'on'</span>)&#123;</span><br><span class=\"line\">            o[<span class=\"keyword\">this</span>.name] = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            o[<span class=\"keyword\">this</span>.name] = o[<span class=\"keyword\">this</span>.name];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> o;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure><h1 id=\"七、页面功能\"><a href=\"#七、页面功能\" class=\"headerlink\" title=\"七、页面功能\"></a>七、页面功能</h1><h2 id=\"页面跳转\"><a href=\"#页面跳转\" class=\"headerlink\" title=\"页面跳转\"></a>页面跳转</h2><ol><li>实现方式<ul><li>关闭当前页面，打开新页面<ul><li><code>a href=&quot;url&quot;</code></li><li><code>window.location.href = url</code></li></ul></li><li>保留当前页面，打开新页面<ul><li><code>a href=&quot;url&quot; target=&quot;_blank&quot;</code></li><li><code>window.open(url, &quot;_blank&quot;)</code></li></ul></li><li>模拟点击 a 标签<ul><li><code>$(&quot;#box&quot;)[0].click()</code></li><li><code>document.getElementById(&quot;box&quot;).click()</code></li></ul></li></ul></li><li>传递数据<ul><li>url 查询字符串</li><li>cookie 等数据储存</li><li>window.open、window.opener</li></ul></li></ol><h2 id=\"页面刷新\"><a href=\"#页面刷新\" class=\"headerlink\" title=\"页面刷新\"></a>页面刷新</h2><ul><li><code>window.location.reload()</code></li><li><code>window.location.href = url</code></li><li><code>window.location.replace(url)</code></li></ul><h2 id=\"文件下载\"><a href=\"#文件下载\" class=\"headerlink\" title=\"文件下载\"></a>文件下载</h2><blockquote><p>浏览器中的文件地址打不开时就会变为下载</p></blockquote><ul><li><code>location.href = url</code>：</li><li>借助 Blob 和 download 属性实现文本信息文件下载</li><li><p>借助 Base64 实现任意文件下载</p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">// location 下载文件</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">dl_file</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">   <span class=\"keyword\">var</span> url = <span class=\"string\">\"http://www.baidu.com/\"</span></span><br><span class=\"line\">   location.href = url + <span class=\"string\">\"?name=mike&amp;age=20\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">//借助 Blob 和 download 属性实现文本信息文件下载</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bolb_download</span>(<span class=\"params\">content, filename</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"comment\">// 创建隐藏的可下载链接</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> link = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'a'</span>);</span><br><span class=\"line\">    link.download = filename;</span><br><span class=\"line\">     link.style.display = <span class=\"string\">'none'</span>;</span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"comment\">// 字符内容转变成blob地址</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> blob = <span class=\"keyword\">new</span> Blob([content]);</span><br><span class=\"line\">     link.href = URL.createObjectURL(blob);</span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"comment\">// 模拟点击和移除</span></span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.appendChild(link);</span><br><span class=\"line\">     link.click();</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.removeChild(link);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"keyword\">var</span> textarea = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'textarea'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> btn = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'input[type=\"button\"]'</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"string\">'download'</span> <span class=\"keyword\">in</span> <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'a'</span>)) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 作为test.html文件下载</span></span><br><span class=\"line\">    btn.addEventListener(<span class=\"string\">'click'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        bolb_download(textarea.value, <span class=\"string\">'test.html'</span>);    </span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    btn.onclick = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        alert(<span class=\"string\">'浏览器不支持'</span>);    </span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">// 借助 Base64 实现任意文件下载</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">di_file</span>(<span class=\"params\">domImg, filename</span>) </span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">var</span> link = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'a'</span>);</span><br><span class=\"line\">    link.download = filename;</span><br><span class=\"line\">     link.style.display = <span class=\"string\">'none'</span>;</span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"comment\">// 图片转 base64 地址</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'canvas'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> context = canvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> width = domImg.width;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> height = domImg.height;</span><br><span class=\"line\">     context.drawImage(domImg, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">     link.href = context.toDataURL(<span class=\"string\">'image/png'</span>);</span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"comment\">// 模拟点击和移除</span></span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.appendChild(link);</span><br><span class=\"line\">    link.click();</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.removeChild(link);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></li></ul><h2 id=\"图片上传\"><a href=\"#图片上传\" class=\"headerlink\" title=\"图片上传\"></a>图片上传</h2><div align=\"center\"><br><img src=\"images/web/img_upload.png\" alt=\"图片上传流程图\"><br></div><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// html：input type=\"file\" id=\"uploadImg\"</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getBase64Img</span>(<span class=\"params\">fileObj, callback</span>)</span>&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">var</span> reader = <span class=\"keyword\">new</span> FileReader();  </span><br><span class=\"line\">    reader.readAsDataURL(fileObj);   <span class=\"comment\">// 转为 Base64 格式 </span></span><br><span class=\"line\">    reader.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>)</span>&#123;  </span><br><span class=\"line\">        <span class=\"comment\">// 变成字符串  </span></span><br><span class=\"line\">        <span class=\"comment\">// callback(reader.result);  </span></span><br><span class=\"line\">        callback(e.target.result);</span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> <span class=\"keyword\">var</span> imgFile = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"fileInput\"</span>).files[<span class=\"number\">0</span>];</span><br><span class=\"line\"> fileInput.addEventListener(<span class=\"string\">\"change\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>) </span>&#123;</span><br><span class=\"line\">   <span class=\"keyword\">var</span> file = fileInput.files[<span class=\"number\">0</span>];</span><br><span class=\"line\">   getBase64Img(file, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">imgBase64</span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (imgBase64.length &amp;gt; <span class=\"number\">2100000</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 2 M = 2097152 B</span></span><br><span class=\"line\">            alert( <span class=\"string\">'请上传不大于 2M 的图片！'</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">          <span class=\"comment\">// 截取 data:image/png;base64 后面的纯字符串</span></span><br><span class=\"line\">          <span class=\"keyword\">var</span> upload_file = imgBase64.substring(imgBase64.indexOf(<span class=\"string\">\",\"</span>) + <span class=\"number\">1</span>);</span><br><span class=\"line\">          <span class=\"comment\">// 上传截取后的字符串</span></span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(upload_file);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"> &#125;, <span class=\"literal\">false</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// oss 图片上传</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> ossUpload = &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 获取上传文件后缀</span></span><br><span class=\"line\">    getSuffix: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">filename</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> pos = filename.lastIndexOf(<span class=\"string\">'.'</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> suffix = <span class=\"string\">''</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (pos != <span class=\"number\">-1</span>) &#123;</span><br><span class=\"line\">            suffix = filename.substring(pos + <span class=\"number\">1</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> suffix;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 配置上传参数</span></span><br><span class=\"line\">    setUpParam: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">$target ,data</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> formData = <span class=\"keyword\">new</span> FormData();</span><br><span class=\"line\">        $.each(data, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">i, n</span>) </span>&#123;</span><br><span class=\"line\">            formData.append(i, n)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        formData.append(<span class=\"string\">'file'</span>, $target[<span class=\"number\">0</span>].files[<span class=\"number\">0</span>]);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> formData;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 上传图片</span></span><br><span class=\"line\">    uploadImg: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">url, formData, callback</span>) </span>&#123;</span><br><span class=\"line\">        $.ajax(&#123;</span><br><span class=\"line\">            url: url.host,</span><br><span class=\"line\">            type: <span class=\"string\">'POST'</span>,</span><br><span class=\"line\">            data: formData,</span><br><span class=\"line\">            processData: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            contentType: <span class=\"literal\">false</span></span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        .done(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>) </span>&#123;</span><br><span class=\"line\">            callback(data);</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        .fail(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                uploadImg(url, formData, callback);</span><br><span class=\"line\">            &#125;, <span class=\"number\">1000</span>)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h1 id=\"八、数据储存\"><a href=\"#八、数据储存\" class=\"headerlink\" title=\"八、数据储存\"></a>八、数据储存</h1><h2 id=\"cookie\"><a href=\"#cookie\" class=\"headerlink\" title=\"cookie\"></a>cookie</h2><blockquote><p>随着每次 http 请求头信息一起发送，无形中增加了网络流量，而且能存储的数据容量较小，适用于购物车、客户端登录等场景</p></blockquote><ul><li>优点<ul><li>可控制过期时间</li><li>可扩展、可用性比较好</li><li>可加密减少 cookie 被破解的可能性</li></ul></li><li>缺点<ul><li>在请求头上携带数据安全性差</li><li>数量和长度有限制，最多 20 条，最长不能超过 40k</li></ul></li><li>API<ul><li>存储：<code>document.cookie = &quot;键=值&quot;</code></li><li>读取：<code>var val = document.cookie</code></li><li>删除：<ul><li><code>var date = new Date()</code></li><li><code>document.cookie = &quot;key=value;expires=&quot; + date.toGMTString()</code></li></ul></li></ul></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> setCookie = <span class=\"function\">(<span class=\"params\">name, value, expiredays</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> exdate = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();　　　　</span><br><span class=\"line\">    exdate.setDate(exdate.getDate() + expiredays);　　　　</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.cookie = name + <span class=\"string\">\"=\"</span> + <span class=\"built_in\">escape</span>(value) + ((expiredays == <span class=\"literal\">null</span>) ? <span class=\"string\">\"\"</span> : <span class=\"string\">\";expires=\"</span> + exdate.toGMTString());</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> getCookie = <span class=\"function\"><span class=\"params\">name</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> arr, reg = <span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(<span class=\"string\">\"(^| )\"</span> + name + <span class=\"string\">\"=([^;]*)(;|$)\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (arr = <span class=\"built_in\">document</span>.cookie.match(reg))</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (arr[<span class=\"number\">2</span>]);</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> delCookie = <span class=\"function\"><span class=\"params\">name</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> exp = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\">    exp.setTime(exp.getTime() - <span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> cval = <span class=\"keyword\">this</span>.getCookie(name);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cval != <span class=\"literal\">null</span>)</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.cookie = name + <span class=\"string\">\"=\"</span> + cval + <span class=\"string\">\";expires=\"</span> + exp.toGMTString();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"localStorage\"><a href=\"#localStorage\" class=\"headerlink\" title=\"localStorage\"></a>localStorage</h2><blockquote><p>本地存储方式可以长期存储数据，没有时间限制，而且可以储存电话本等大量数据</p></blockquote><ul><li>特点：同源策略限制、只在本地存储、永久保存、同浏览器共享</li><li>优点<ul><li>扩展了 cookie 的 4k 限制</li><li>可以将请求数据直接存储到本地，节约带宽</li><li>遵循同源策略，不同网站之间不能直接共用</li></ul></li><li>缺点<ul><li>需要手动删除，否则长期存在</li><li>浏览器大小不一，版本的支持也不一样</li><li>只支持存储 string 类型的数据，JSON 对象需要转换</li><li>本质是对字符串的读取，如果存储内容多则会消耗内存空间而导致页面变卡</li></ul></li><li>应用场景<ul><li>多页面访问共同数据：可以在多个标签页中共享数据</li><li>数据比较大的临时保存方案：比如在线编辑文章时的自动保存</li></ul></li><li>API<ul><li>存储：<code>localStorage.setItem(key, value)</code></li><li>读取<ul><li>单个：<code>localStorage.getItem(key)</code></li><li>全部：<code>localStorage.valueOf()</code></li></ul></li><li>删除<ul><li>单个：<code>localStorage.removeItem(key)</code></li><li>全部：<code>localStorage.clear()</code></li></ul></li></ul></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> setStore = <span class=\"function\">(<span class=\"params\">name, content</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!name) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> content !== <span class=\"string\">'string'</span>) &#123;</span><br><span class=\"line\">    content = <span class=\"built_in\">JSON</span>.stringify(content);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.localStorage.setItem(name, content);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> getStore = <span class=\"function\"><span class=\"params\">name</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!name) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">window</span>.localStorage.getItem(name);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> removeStore = <span class=\"function\"><span class=\"params\">name</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!name) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.localStorage.removeItem(name);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"sessionStorage\"><a href=\"#sessionStorage\" class=\"headerlink\" title=\"sessionStorage\"></a>sessionStorage</h2><blockquote><p>会话存储，关闭浏览器之后数据就会消失。非常适合单页应用程序，便于各业务模块之间的传值</p></blockquote><ul><li>特点<ul><li><strong>同源策略限制</strong></li><li><strong>单标签页限制</strong>：同一个标签页中的同源页面共享数据</li><li><strong>只在本地存储</strong>：数据只会在存储在本地，并在标签页关闭后清除</li><li><strong>存储方式</strong>：采用键值对的方式，注意 value 值必须为字符串类型</li><li><strong>存储上限限制</strong>：不同的浏览器存储的上限不同，但大多数限制在 5MB 以下</li></ul></li><li>API<ul><li>存储：<code>sessionStorage.setItem(key, value)</code></li><li>读取<ul><li>单个：<code>sessionStorage.getItem(key)</code></li><li>全部：<code>sessionStorage.valueOf()</code></li></ul></li><li>删除<ul><li>单个：<code>sessionStorage.removeItem(key)</code></li><li>全部：<code>sessionStorage.clear()</code></li></ul></li></ul></li></ul><h2 id=\"以上区别\"><a href=\"#以上区别\" class=\"headerlink\" title=\"以上区别\"></a>以上区别</h2><ul><li>传递<ul><li>cookie 数据通常经过加密，而且会在浏览器和服务器间来回传递</li><li>后两个不会自动把数据发给服务器，仅在本地保存。</li></ul></li><li>存储大小<ul><li>cookie 数据大小不能超过4k，始终在同源的 http 请求中携带</li><li>后两个虽然也有存储大小的限制但比 cookie 大得多，可以达到 5M 及以上</li></ul></li><li>生命周期<ul><li>cookie 数据只在过期时间之前一直有效</li><li>localStorage存储持久数据，不要不主动删除数据就有效有效</li><li>sessionStorage数据在当前浏览器窗口关闭后自动删除</li></ul></li><li>作用域<ul><li>sessionStorage 不在不同浏览器窗口中共享</li><li>另外两个在所有同源窗口中都共享</li></ul></li></ul><h2 id=\"临时数据\"><a href=\"#临时数据\" class=\"headerlink\" title=\"临时数据\"></a>临时数据</h2><blockquote><p>html 标签上添加自定义属性来存储和操作数据，注意 js 可以动态添加和删除，但不能删除行内添加的</p></blockquote><ul><li>html：<code>div data-name=&quot;值&quot;</code>，name 为自定义属性名</li><li>注意：<code>data-e-name：eName, data-myName：myname</code></li><li>原生 js<ul><li>获取：<code>div.dataset.name</code></li><li>设置：<code>div.dataset.name = new</code></li><li>删除：<code>div.dataset.name = null</code></li></ul></li><li>jQuery<ul><li>获取：<code>$(&quot;div&quot;).data(&quot;name&quot;)</code></li><li>设置：<code>$(&quot;div&quot;).data(&quot;name&quot;, &quot;new&quot;)</code></li><li>删除：<code>$(&quot;div&quot;).removeDate(&quot;name&quot;)</code></li></ul></li></ul><h1 id=\"九、用户登录\"><a href=\"#九、用户登录\" class=\"headerlink\" title=\"九、用户登录\"></a>九、用户登录</h1><h2 id=\"实现逻辑\"><a href=\"#实现逻辑\" class=\"headerlink\" title=\"实现逻辑\"></a>实现逻辑</h2><div align=\"center\"><br><img src=\"images/web/login.png\" alt=\"登录注册逻辑\"><br></div><h2 id=\"实现过程\"><a href=\"#实现过程\" class=\"headerlink\" title=\"实现过程\"></a>实现过程</h2><ol><li>利用 Ajax 将用户名和密码发送到对应接口</li><li>后台接收到对应数据后，通过用户名去查询对应密码</li><li>对比查询到的密码和前台传过来的密码是否相等，如果相等返回成功，否则返回失败</li><li>前端接收到登陆成功状态，将对应登陆成功的样式显示在对应位置，并将 username、userid 保存为 cookie (登陆状态保持)</li></ol><h2 id=\"Token\"><a href=\"#Token\" class=\"headerlink\" title=\"Token\"></a>Token</h2><blockquote><p>遵从 oauth2.0 规范的授权令牌，它是一种身份/权限的认证方式</p></blockquote><ol><li>生成方式：服务端接收客户端发送的 userId，然后根据算法和编码方式生成</li><li>优势<ul><li>可以避免 CSRF 攻击</li><li>完全由应用管理，可以避开同源策略</li><li>可扩展性强(不用存储)，还可用于 APP</li><li>可以是无状态的，可以在多个服务间共享</li></ul></li></ol><!-- rebuild by neat -->"},{"title":"Web 编程模式和算法","top":false,"keywords":["js","编程"],"date":"2019-04-02T13:38:29.000Z","description":"模块化编程、面向对象编程、面向切面编程、异步编程、排序和搜索算法","_content":"\n# 一、模块化编程\n\n<div style=\"text-indent: 2em\">早期引用 JS 文件时直接通过 script 即可，但是随着项目的复杂度越来越大，这种方式带来了 逻辑混乱、可维护性差等问题。为了编写可维护的代码，我们采用将代码合理拆分到不同的文件里，每一个文件就是一个模块，文件路径就是模块名，这种组织代码的方式就是模块化。</div> \n\n## 优势\n  * 开发效率高，有利于多人协同开发\n  * 解决项目中的全局变量污染的问题\n  * 功能单一，方便代码的复用和维护\n  * 解决文件依赖问题，无需关注文件引用顺序\n\n\n## JS 环境\n  * 服务器端\n    * 相同的代码需要多次执行\n    * CPU 和内存资源是瓶颈\n    * 加载时从磁盘中加载\n  * 浏览器端\n    * 代码需要从一个服务器端分发到多个客户端执行\n    * 带宽网络是瓶颈\n    * 加载时需要通过网络加载\n\n\n## 发展进程\n  1. 命名空间形式的代码封装 (函数封装)\n  2. 通过 立即执行函数(IIFE) 创建的命名空间\n  3. 服务器端运行时 Nodejs 的 CommonJS 规范\n  4. 将模块化运行在浏览器端的 AMD/CMD 规范\n  5. 兼容 AMD 和 CommonJS 的 UMD 规范\n  6. 通过语言标准支持的 ES Module\n\n  ```js\n  // 命名空间\n  function square(x) {\n      if(typeof x !== \"number\") return;\n      return x * x;\n  }\n  var utils = {\n      add: function(x, y) {\n          return x + y\n      }\n  }\n\n  // IIFE\n  var module = (function(){\n      var count = 0;\n      return {\n          inc: function(){\n              count += 1;\n          },\n          dec: function(){\n              count += -1;\n          }\n      }\n  })()\n  module.inc();\n  ```\n\n\n## CommonJS\n> 服务器端的模块化开发规范，主要特点是 同步加载模块，Nodejs 的模块规范就是参照它实现的\n\n<div style=\"text-indent: 2em\">CommonJS 会在启动时把内置模块和加载过的模块放在本地硬盘，文件读取时不受限于网络而等待时间很短，所以在 Node 环境中使用同步加载的方式不会有很大问题。但是 CommonJS 如果应用在浏览器端，同步加载的机制会使得 JS 阻塞 UI 线程，造成页面卡顿，网速不好时还会导致浏览器假死。</div> \n\n\n### 模块定义\n<div style=\"text-indent: 2em\">为了方便，NodeJs 为每个模块提供一个 exports 变量指向 module.exports，相当于在每个模块头部执行 `var exports = module.exports`。exports 默认是个空对象，可以添加属性和方法但不能被赋值，因为这样会切断了两者联系，而且不能导出需要new实例化的类。使用时建议 module.exports 导出对象和类、exports 导出普通函数和变量</div> \n\n  * 一个单独的文件就是一个模块\n  * 每个模块都是一个单独的作用域\n  * 每个模块内部都有一个 module 对象来代表当前模块\n  * 暴露模块中的内容可以通过 module.exports、exports \n    \n\n### 模块加载\n  * 本质：读取模块内部的 module.exports 变量\n  * 特点\n    * 缓存结果：模块第一次加载并执行之后就会缓存结果，再次加载时就会直接读取缓存结果，想要再次运行则必须清除缓存\n    * 同步加载：模块加载会阻塞接下来代码的执行，需要等到模块加载完成才能继续执行\n  * 方法\n    * require()：当前模块中读取其它模块并执行\n    * require.resolve()：解析模块标识符的绝对路径\n\n### 模块标识\n> require() 的参数，require 会根据其格式使用不同的路径加载原则去寻找模块文件\n\n  * 模块名：符合小驼峰命名的字符串\n    * 核心模块：系统安装目录\n    * 安装模块：node_modules 目录\n  * 绝对路径：以 \"/\" 开头\n  * 相对路径：以 \"./\" 开头\n\n\n  ```js\n  // 导出一个要实例化的类  module.exports = exports = function (){ }\n\n  // rocker.js \n  module.exports = function(name, age) {\n      this.name = name;\n      this.age = age;\n      thisl.about = function() {\n          console.log(this.name + 'is' + this.age + 'years old');\n      };\n  };\n\n  // 引用\n  var Rocker = require('./rocker.js')\n  var r = new Rocker('Ozzy', 62)\n  r.about()   // Ozzy is 62 years old\n\n\n  // 导出一个静态类 exports.funcName = function (){}\n\n  // hello.js\n  function hello() {\n      console.log('Hello, world');\n  }\n  function greet(name) {\n      console.log('Hello, ' + name + '!');\n  }\n  // 写法一\n  module.exports = {\n      hello: hello,\n      greet: greet\n  }\n  // 写法二\n  exports.hello = hello;\n  exports.greet = greet;\n  // 错误写法\n  exports = {\n      hello: hello,\n      greet: greet\n  }\n\n  // 引用\n  var hello = require('./hello.js')\n  hello.hello()  // Hello, world\n  ```\n\n\n## AMD\n> 异步模块定义，浏览器端模块化开发规范。它允许异步和按需加载模块，requireJS 是参照它实现的\n\n### 特点\n  * 异步加载方式，模块加载不影响后面语句的运行\n    * 实现方式：依赖模块的所有语句都放置在回调函数中并在模块加载完成后执行\n    * 解决问题：js 加载时浏览器会停止页面渲染，加载文件越多则页面失去的响应时间越长\n  * 管理模块之间的依赖性，便于代码的编写和维护\n    * 解决问题：js 文件需要它的被依赖文件早于它加载到浏览器 \n\n\n### 语法 \n  * 模块定义：`define(可选模块标识, 依赖模块数组, 模块初始化要执行的函数或对象)`\n  * 模块加载：`require(依赖模块数组, 模块加载成功后的回调函数)`\n\n  ```js\n  // 定义模块 myModule.js\n  define(['dependency'], function(){\n      var name = 'Byron';\n      function printName(){\n          console.log(name);\n      }\n      return {\n          printName: printName\n      };\n  });\n\n  // 加载模块\n  require(['myModule'], function (my){\n  　 my.printName();\n  });\n  ```\n\n\n## CMD \n> AMD 基础上改进的一种规范，主要区别是对依赖模块的执行时机处理不同。seaJS 是参照它实现的\n\n### 区别\n  * 依赖处理\n    * AMD 推崇依赖前置，在定义模块时就要声明其依赖的模块 \n    * CMD 推崇就近依赖，只有在用到某个模块时再去 require \n  * 方法    \n    * AMD API 默认是一个当多个用，比如模块加载分为全局的和局部的 require\n    * CMD 推崇职责单一而且简单，比如模块加载只有 seajs.use() \n\n\n### 语法\n  ```js\n  // 定义模块  index.js\n  define(function(require, exports, module) {\n\n      // 使用 exports\n      exports.name = 'index';\n      exports.hello = function() {\n          console.log('Hello index');\n      };\n\n      // 使用 module.exports\n      module.exports = {\n          name: 'index',\n          hello: function() {\n            console.log('index');\n          }\n      };\n  });\n\n  // 加载模块\n  seajs.use('index', function(my) {\n      my.hello();\n  });\n  ```\n\n\n## UMD\n> 兼容 AMD 和 commonJS，提出了跨平台的解决方案\n\n  ```js\n  // 无导入导出规范，只有如下的常规写法来检测 JS 环境\n  (function (root, factory) {\n      if (typeof define === 'function' && define.amd) {\n          // AMD\n          define(['jquery'], factory);\n      } else if (typeof exports === 'object') {\n          // CommonJS\n          module.exports = factory(require('jquery'));\n      } else {\n          // 挂载到全局：root 即 window\n          root.returnExports = factory(root.jQuery);\n      }\n  }(this, function ($) {\n      // 方法\n      function myFunc(){ };\n      // 暴露公共方法\n      return myFunc;\n  }));\n  ```\n\n\n## ES Module\n> ES6 的最新语法支持规范\n\n<div style=\"text-indent: 2em\">CommonJS 和 AMD 规范都只能在运行时确定依赖。而 ES6 在语言层面提出了模块化方案, ES6 module 模块编译时就能确定模块的依赖关系，以及输入和输出的变量。ES6 模块化这种加载称为 编译时加载(异步按需加载)、静态加载。</div> \n\n  * 导入：`import {模块名A，模块名B...} from '模块路径'`\n  * 导出：`export、export default`\n  * 异步加载：`import('模块路径').then()`\n\n  ```js\n  /* 错误写法 */\n  export 1;\n\n  var m = 1;\n  export m;\n\n  if (x === 2) {\n    import MyModual from './myModual';\n  }\n\n  /* 正确写法 */\n  export var m = 1;\n\n  var m = 1;\n  export {m};\n\n  var n = 1;\n  export {n as m};\n\n  var n = 1;\n  export default n;\n\n  import('./myModule.js')\n  .then(({export1, export2}) => { })\n\n  Promise.all([\n    import('./module1.js'),\n    import('./module2.js'),\n    import('./module3.js'),\n  ])\n  .then(([module1, module2, module3]) => { })\n  ```\n\n  \n# 二、面向对象编程 OOP\n> 用对象的思想去写代码，用来定义一个类\n\n<div style=\"text-indent: 2em\">`字面量方式 和 new Object()` 是两种最常用的对象创建方式，但是在使用同一接口创建多个对象时会产生大量重复代码，为了简化代码量并提高可维护性，项目开发时一般使用面向对象写法。</div>\n\n## 特点\n  * 抽象：抓住核心问题\n  * 封装：只能通过对象来访问方法\n  * 继承：从已有对象上继承出新的对象\n  * 多态：多对象的不同形态\n\n\n## 实现方式\n  * __工厂模式__：解决了重复实例化多个对象的问题，但是不能识别各自的实例化对象\n  * __构造函数模式__：把函数当作一个类，实例化时它会隐式创建一个空对象并最后返回\n    * 建议首字母大写以区分普通函数\n    * 实例化的对象可以通过 instanceof 判断它的实例\n  * __原型模式__：好处是可以让 `所有对象实例` 共享 `原型对象` 所包含的属性和方法\n  * __混合模式__：可变属性写入构造函数，固定属性和方法写入原型对象，这样可以节省内存 \n\n\n  ```js\n  // 工厂模式\n  function person(name, age){\n      var obj = {};     // 原料\n      obj.name = name;  // 加工\n      obj.age = age;    \n      obj.say = function(){ \n        console.log(this.name)    \n      }\n      return obj     \n  }\n  var p1 = person(\"tom\", 18);\n\n\n  // 构造函数模式\n  function Person(name, age){     // 类：模具\n      this.name = name;  \n      this.age = age;    \n      this.say = function(){ \n        console.log(this.name)    \n      }  \n  }\n  var p2 = new Person(\"tom\", 20);  // 实例化对象：产品\n  console.log(p2 instanceof Person);\n\n\n  // 原型模式\n  function Person(){  }\n  Person.prototype.name = \"tom\";\n  Person.prototype.age = 24;\n  Person.prototype.say = function(){\n      console.log(this.name) \n  }\n  var p3 = new Person()\n\n\n  // 混合模式\n  function Person(name, age){\n      this.name = name;   \n      this.age = age;   \n  }\n  Person.prototype.say = function(){\n      console.log(this.name);\n  }\n  var p4 = new Person();\n  ```\n \n\n# 三、面向切面编程 AOP\n> 无侵入地将一个函数插入到另一个函数的前面或后面\n\n<div style=\"text-indent: 2em\">主要功能是将日志统计、异常处理等一些跟核心业务逻辑模块无关的功能抽离出来并封装，然后动态插入到业务逻辑模块的指定位置。这样不仅简化了业务逻辑模块，而且方便统一管理功能模块。AOP 其实只是 OOP 的补充，OOP 从横向上区分出一个个的类，AOP 则从纵向上向对象中加入特定的代码。常用场景如下：</div>\n\n  * 防止 window.onload 被二次覆盖\n  * 给 Ajax 请求动态添加参数\n  * 统计函数的执行时间\n  * 分离表单请求和校验\n  * 职责链模式\n  * 组合替代继承\n\n\n  ```js\n  // before 切面：让一个函数在另一个函数之前执行\n  Function.prototype.before = function(fn) {\n      var _self = this;     // 保存原函数引用\n      return function(){\n        fn.apply(this, arguments)   // 执行新函数，修正 this\n        return _self.apply(this, arguments);  // 执行原函数\n      }\n  }\n\n  // after 切面：让一个函数在另一个函数之后执行\n  Function.prototype.after = function(fn) {\n    var _self = this;\n    return function(){\n      var ret = _self.apply(this, arguments);\n      fn.apply(this, arguments);\n      return ret;\n    }\n  }\n\n  var obj = {\n    name: 'tangdy',\n    getName: function(){\n      console.log(this.name);\n    }\n  }\n\n  obj.getName = obj.getName.before(function(){\n      console.log(\"before\")\n  }).after(function(){\n      console.log(\"after\")\n  });\n  obj.getName();\n\n  ```\n\n\n# 四、异步编程\n  \n## 回调函数\n  * 实现：作为参数传递到其它函数执行\n  * 优点：简单、容易理解和部署\n  * 缺点\n    * 层层嵌套，不利于代码的阅读和维护\n    * 每个任务只能指定一个回调函数\n    * 各个部分之间高度耦合，流程会很混乱\n    \n  \n  ```js\n  // 把同步操作变成异步\n  f1(f2);\n\n  function f1(callback){\n  　　setTimeout(function () {\n  　　　　　callback();\n  　　}, 1000);\n  }\n  ```\n    \n\n## 事件监听\n  * 实现：采用事件驱动模式 \n  * 优点\n    * 容易理解\n    * 可以绑定多个事件\n    * 每个事件可以指定多个回调函数\n    * 可以去耦合，有利于实现模块化\n  * 缺点：整个程序变成事件驱动型，运行流程不清晰 \n  * 监听函数：on、bind、listen、observe、addEventListener\n\n\n  ```js\n  // f1 执行完成后立即触发 done 事件从而执行 f2\n  f1.on(\"done\", f2);\n\n  function f1(){\n    setTimeout(function(){\n      //f1的代码量\n      f1.trigger(\"done\");\n    }, 1000)\n  }\n  ```\n \n\n## 观察者模式\n> 即发布订阅模式，它定义了一种一对多的关系\n\n  * 实现：让多个观察者同时对监听某个对象，对象变化会通知多个观察者对象而自动更新\n  * 优点\n    * 支持简单的广播通信，自动通知所有已经订阅过的对象\n    * 目标对象与观察者之间的抽象耦合关系能够单独扩展以及重用\n    * 页面载入后，目标对象很容易与观察者存在一种动态关联，增加灵活性\n\n\n  ```js\n  // f1 执行完成后向信号中心 jQuery 发布 done 信号，从而引发 f2 的执行\n  jQuery.subscribe(\"done\", f2);\n\n  function f1(){\n    setTimeout(function(){\n      //f1的代码\n      jQuery.publish(\"done\");\n    }, 1000)\n  } \n  ```\n\n\n## promise 对象\n> CommonJS 工作组提出的一种规范，目的是为异步编程提供统一接口\n\n  * 实现机制\n    * 代理对象：Promise 对象代表一个异步操作\n    * 对象状态：只有异步操作的结果，可以决定 Promise 对象的当前状态\n    * 回调函数：`then()` 用来注册当 promise 完成或者失败时调用的回调函数\n  * 对象状态\n    * 三种状态：等待 `pending`、已完成 `fulfilled`、已失败 `rejected`\n    * 状态改变：只能从 pending 转变为 fulfilled/rejected，而且状态一旦改变就不会再变\n  * 主要优势\n    * 解决回调地狱问题\n    * 更好地进行错误捕获 \n  * 规范图解\n    <div align=\"center\">\n      ![Promise 规范](images/web/promise.png)\n    </div>   \n\n\n  ```js\n  // 创建实例\n  var promise = new Promise((resolve, reject) => {\n      resolve()\n  })\n  promise.then(val => {   // 抛出错误\n      console.log(val)\n      console.log(1)\n  }).then(() => {         // 不会执行\n      console.log(111)\n  }).catch(error => {     // 接收错误\n      console.log(error)\n  }).then(() => {         // 继续执行\n      console.log(333)\n  })\n\n\n  // 语法糖\n  Promise.resolve(42).then(value =>{\n      console.log(value);\n  })  // 等同于\n  new Promise(resolve => {\n      resolve(42)\n  }).then(value => {\n      console.log(value)\n  })\n\n  Promise.reject(value) // 等同于\n  new Promise(function(resolve, reject){\n      reject(new Error(\"出错了\"));\n  });\n\n\n  // 合并多个实例\n  function timerPromisefy(delay) {\n      return new Promise(function (resolve) {\n          setTimeout(function () {\n              resolve(delay);\n          }, delay);\n      });\n  }\n  // 当数组中所有 Promise 对象被 resolve 之后，该方法才执行 \n  Promise.all([\n      timerPromisefy(1),\n      timerPromisefy(10)\n  ]).then(function (value) {\n      console.log(value);    \n  });\n  // 任何一个 promise 变为 resolve/reject，程序就停止运行\n  Promise.race([\n      timerPromisefy(1),\n      timerPromisefy(10)\n  ]).then(function (value) {\n      console.log(value);    \n  });\n\n\n  // 封装 AJAX 实例\n  function get(url) { \n      return new Promise(function (resolve, reject) { \n          var req = new XMLHttpRequest() || new ActiveXObject('Microsoft.XMLHTTP')\n          req.open('GET', url, true) \n          req.onload = function () {\n              if (req.readyState == 4 && req.status == 200) {\n                  resolve(req.response)\n              } else {\n                  reject(Error(req.statusText))\n              }\n          }\n\n          req.onerror = function () {\n              reject(Error(\"Network Error\"));\n          }\n\n          req.send()\n      });\n  }\n  get(\"http://something\").then(function (response) {\n      console.log(response);\n  }).catch(function (error) {\n      console.log(error);\n  })\n\n\n   // 图片加载完成后播放音乐\n  this.loadImg([img, img_1, img_2_1, img_2_2]).then(() => {\n    setTimeout(() => {\n        this.playMusic()\n    }, 500)\n  })\n  const loadImg = (img) => {  \n      const isArray = Array.isArray(img)\n      // 参数为单个字符串/数组\n      if (!isArray) {\n          const oImg = new Image()\n          oImg.src = img\n          return new Promise(resolve => {\n              oImg.onload = () => {\n                  resolve()\n              }\n          })\n      }\n      const arr = []\n      img.forEach(val => {\n          const oImg = new Image()\n          oImg.src = val\n          arr.push(new Promise(resolve => {\n              oImg.onload = () => {\n                  resolve()\n              }\n          }))\n      })\n      return Promise.all(arr)\n  }\n  ```\n\n\n## async/await 异步函数\n> 一个用同步思维解决异步问题的方案，代码简洁而且更符合编写习惯\n     \n  * async：表示函数是异步的，定义的函数会隐式返回一个 promise 对象\n  * await：表示等待后面的异步函数返回结果之后再执行，只能用于 async 函数内部\n  \n  \n  ```js\n  // async 异步 \n  async function foo() { return \"hello\" }\n  const foo = async function () {}\n  const foo = async () => {}\n\n  console.log(foo());  // promise 对象\n\n\n  // await 等待\n  let fun = function (time) {\n      return new Promise(function (resolve, reject) {\n          setTimeout(function () {\n              resolve(); \n          }, time)\n      })\n  }\n  let funAsync_1 = async function () {\n      console.log(1)\n      await fun(3000)\n      console.log(2);\n  }\n  let funAsync_2 = async function () {\n      console.log(3)\n      await funAsync_1()\n      console.log(4)\n  }\n  funAsync_2()  // 3、1、2、4\n\n\n  // 错误处理\n  let p = new Promise((resolve, reject) => {\n    reject(\"error\")\n  })\n  async function demo(params) {\n    try {\n        let result = await p;\n    } catch(e) {\n        console.log(e);\n    }\n  }\n  demo()   // error\n\n\n  // 并行处理\n  function count(num) {\n      return new Promise((res, rej) => {\n          res(num)\n      })\n  }\n  // Promise 写法\n  count(100).then(res => {\n      return count(res + 100);\n  }).then(res => {\n      return count(res + 100);\n  }).then(res => {\n      console.log(res);\n  })\n  // await 写法\n  async function demo() {\n\n      // 返回一个值\n      let res_1 = await count(100);\n      let res_2 = await count(res_1 + 100);\n      let res_3 = await count(res_2 + 100);\n      return res_3;\n\n      // 返回数组\n      return await Promise.all([count(100), count(200)])\n\n  }\n  demo().then(res => {\n      console.log(res);\n  })\n\n\n  // 循环处理\n  function count(num) {\n      return new Promise((res, rej) => {\n          console.log(num)\n          res(num);\n      })\n  }\n  (async (names) => {\n      for(let i = 0; i &lt; names.length; i++) {\n          await count(names[i])\n      }\n  })([1, 2, 3])\n  ```\n\n\n# 五、JS 算法  \n  * 排序算法\n    * __冒泡排序__：比较任何两个相邻元素，如果第一个比第二个大则交换位置。元素向上移动到正确顺序，类似气泡上升至表面而得名。\n    * __选择排序__：每次从元素中选出最小或最大值，存放在序列的起始位置，以此循环至排序完毕。\n    * __插入排序__：将一个数据插入到已经排好序的有序数据中，从而得到一个新的、个数加一的有序数据，适用于少量数据的排序。\n    * __归并排序__：将原始序列切分成较小的序列直到无法再切分，然后将小序列排序后归并成大序列，直到最后只有一个排序完毕的大序列。\n    * __快速排序__：通过一趟排序将要排序的数据分割成独立的两部分，其中一部分的所有数据都比另外一部分的所有数据都要小，然后再按此方法对这两部分数据分别进行上述递归排序，以此达到整个数据变成有序序列。\n  * 搜索算法\n    * __顺序搜索__：让目标元素与列表中的每一个元素逐个比较，直到找出与给定元素相同的元素为止，缺点是效率低下。\n    * __二分搜索__：在一个有序列表，以中间值为基准拆分为两个子列表，拿目标元素与中间值作比较从而再在目标的子列表中递归此方法，直至找到目标元素。\n  * 其他\n    * __贪心算法__：在对问题求解时，不考虑全局，总是做出局部最优解的方法。\n    * __动态规划__：在对问题求解时，由以求出的局部最优解来推导全局最优解。\n    * __复杂度__：一个方法在执行的整个生命周期所需要占用的时间、空间等资源。\n\n\n\n## 冒泡排序\n  ```js\n  Array.prototype.bubbleSort = function() {\n      for (let i = 0; i &lt; this.length; i++) {\n          for (let j = 0; j &lt; this.length - 1 - i; j++) {\n              if (this[j] &gt; this[j + 1]) {\n                  let temp = this[j]\n                  this[j] = this[j + 1]\n                  this[j + 1] = temp\n              }\n          }\n      }\n  }\n  ```\n\n\n## 选择排序\n  ```js\n  Array.prototype.selectionSort = function() {\n      let indexMin\n      for (let i = 0; i &lt; this.length - 1; i++){\n          indexMin = i\n          for (var j = i; j &lt; this.length; j++){ \n              if(this[indexMin] &gt; this[j]) {\n                  indexMin = j\n              }\n          } \n          if (i !== indexMin){\n              let aux = this[i]\n              this[i] = this[indexMin]\n              this[indexMin] = aux\n          }\n      }\n      return this\n  }\n  ```\n\n\n## 插入排序\n  ```js\n  Array.prototype.insertionSort = function() {\n      let j\n      let temp\n      for (let i = 1; i &lt; this.length; i++) {\n          j = i\n          temp = this[i]\n          while (j &gt; 0 && this[j - 1] &gt; temp) {\n              this[j] = this[j - 1]\n              j--\n          } \n          this[j] = temp\n          console.log(this.join(', '))\n      }\n      return this\n  }\n  ```\n\n\n## 归并排序\n  ```js\n  Array.prototype.mergeSort = function() {\n      const merge = (left, right) => {\n          const result = []\n          let il = 0\n          let ir = 0\n          while(il &lt; left.length && ir &lt; right.length) {\n              if(left[il] &lt; right[ir]) {\n                  result.push(left[il++])\n              } else {\n                  result.push(right[ir++])\n              }\n          }\n          while (il &lt; left.length) {\n              result.push(left[il++])\n          }\n          while (ir &lt; right.length) {\n              result.push(right[ir++])\n          }\n          return result\n      }\n      const mergeSortRec = array => {\n          if (array.length === 1) {\n              return array\n          }\n          const mid = Math.floor(array.length / 2)\n          const left = array.slice(0, mid)\n          const right = array.slice(mid, array.length)\n          return merge(mergeSortRec(left), mergeSortRec(right))\n      }\n      return mergeSortRec(this)\n  }\n  ```\n\n\n## 快速排序\n  ```js\n  Array.prototype.quickSort = function() {\n      const partition = (array, left, right) => {\n          var pivot = array[Math.floor((right + left) / 2)]\n          let i = left\n          let j = right\n          while (i &lt;= j) {\n              while (array[i] &lt; pivot) {\n                  i++\n              }\n              while (array[j] &gt; pivot) {\n                  j--\n              }\n              if (i &lt;= j) {\n                  let aux = array[i]\n                  array[i] = array[j]\n                  array[j] = aux\n                  i++\n                  j--\n              }\n          }\n          return i\n      }\n      const quick = (array, left, right) => {\n          let index\n          if (array.length &gt; 1) {\n              index = partition(array, left, right)\n              if (left &lt; index - 1) {\n                  quick(array, left, index - 1)\n              }\n              if (index &lt; right) {\n                  quick(array, index, right)\n              }\n          }\n      }\n      quick(this, 0, this.length - 1)\n      return this\n  }\n  ```\n\n\n## 顺序搜索\n  ```js\n  Array.prototype.sequentialSearch = function(item) {\n      for (let i = 0; i &lt; this.length; i++) {\n          if (item === this[i]) return i\n      }\n      return -1\n  }\n  ```\n\n\n## 二分搜索\n  ```js\n  Array.prototype.binarySearch = function(item) {\n      this.quickSort()\n      let low = 0\n      let mid = null\n      let element = null\n      let high = this.length - 1\n      while (low &lt;= high){\n          mid = Math.floor((low + high) / 2)\n          element = this[mid]\n          if (element &lt; item) {\n              low = mid + 1\n          } else if (element &gt; item) {\n              high = mid - 1\n          } else {\n              return mid\n          }\n      }\n      return -1\n  }\n  ```\n\n\n## 动态规划\n> 美国硬币：d1=1, d2=5, d3=10, d4=25，如果要找36美分的零钱，我们可以用 1个25美分、1个10美分和1个便士（ 1美分)\n最少硬币找零的解决方案是找到 n 所需的最小硬币数\n\n  ```js\n  class MinCoinChange {\n\n    constructor(coins) {\n      this.coins = coins\n      this.cache = {}\n    }\n\n    makeChange(amount) {\n      if (!amount) return []\n      if (this.cache[amount]) return this.cache[amount]\n      let min = [], newMin, newAmount\n      this.coins.forEach(coin => {\n          newAmount = amount - coin\n          if (newAmount &gt;= 0) {\n              newMin = this.makeChange(newAmount)\n          }\n          if (newAmount &gt;= 0 && \n                (newMin.length &lt; min.length - 1 || !min.length) && \n                (newMin.length || !newAmount)) {\n              min = [coin].concat(newMin)\n          }\n      })\n      return (this.cache[amount] = min)\n    }\n  }\n  const rninCoinChange = new MinCoinChange([1, 5, 10, 25])\n  console.log(minCoinChange.makeChange(36)) // [1, 10, 25]\n\n  const minCoinChange2 = new MinCoinChange([1, 3, 4])\n  console.log(minCoinChange2.makeChange(6))  // [3, 3]\n  ```\n\n\n## 贪心算法\n> 通过贪心算法得出上述解决方案\n  ```js\n  class MinCoinChange {\n\n    constructor(coins) {\n      this.coins = coins\n    }\n\n    makeChange(amount) {\n      const change = []\n      let total = 0\n      this.coins.sort((a, b) => a &lt; b).forEach(coin => {\n          while ((total + coin) &lt;= amount) {\n            change.push(coin)\n            total += coin\n          }\n      })\n      return change\n    }\n  }\n  const rninCoinChange = new MinCoinChange ( [ 1, 5, 10, 2 5])\n  console. log (rninCoinChange. rnakeChange (36))\n  ```\n\n\n\n\n\n","source":"_posts/11-web编程.md","raw":"---\ntitle: Web 编程模式和算法\ntags:\n  - Javascript\ncategories: Javascript\ntop: false\nkeywords:\n  - js\n  - 编程\ndate: 2019-04-02 21:38:29\ndescription: 模块化编程、面向对象编程、面向切面编程、异步编程、排序和搜索算法\n---\n\n# 一、模块化编程\n\n<div style=\"text-indent: 2em\">早期引用 JS 文件时直接通过 script 即可，但是随着项目的复杂度越来越大，这种方式带来了 逻辑混乱、可维护性差等问题。为了编写可维护的代码，我们采用将代码合理拆分到不同的文件里，每一个文件就是一个模块，文件路径就是模块名，这种组织代码的方式就是模块化。</div> \n\n## 优势\n  * 开发效率高，有利于多人协同开发\n  * 解决项目中的全局变量污染的问题\n  * 功能单一，方便代码的复用和维护\n  * 解决文件依赖问题，无需关注文件引用顺序\n\n\n## JS 环境\n  * 服务器端\n    * 相同的代码需要多次执行\n    * CPU 和内存资源是瓶颈\n    * 加载时从磁盘中加载\n  * 浏览器端\n    * 代码需要从一个服务器端分发到多个客户端执行\n    * 带宽网络是瓶颈\n    * 加载时需要通过网络加载\n\n\n## 发展进程\n  1. 命名空间形式的代码封装 (函数封装)\n  2. 通过 立即执行函数(IIFE) 创建的命名空间\n  3. 服务器端运行时 Nodejs 的 CommonJS 规范\n  4. 将模块化运行在浏览器端的 AMD/CMD 规范\n  5. 兼容 AMD 和 CommonJS 的 UMD 规范\n  6. 通过语言标准支持的 ES Module\n\n  ```js\n  // 命名空间\n  function square(x) {\n      if(typeof x !== \"number\") return;\n      return x * x;\n  }\n  var utils = {\n      add: function(x, y) {\n          return x + y\n      }\n  }\n\n  // IIFE\n  var module = (function(){\n      var count = 0;\n      return {\n          inc: function(){\n              count += 1;\n          },\n          dec: function(){\n              count += -1;\n          }\n      }\n  })()\n  module.inc();\n  ```\n\n\n## CommonJS\n> 服务器端的模块化开发规范，主要特点是 同步加载模块，Nodejs 的模块规范就是参照它实现的\n\n<div style=\"text-indent: 2em\">CommonJS 会在启动时把内置模块和加载过的模块放在本地硬盘，文件读取时不受限于网络而等待时间很短，所以在 Node 环境中使用同步加载的方式不会有很大问题。但是 CommonJS 如果应用在浏览器端，同步加载的机制会使得 JS 阻塞 UI 线程，造成页面卡顿，网速不好时还会导致浏览器假死。</div> \n\n\n### 模块定义\n<div style=\"text-indent: 2em\">为了方便，NodeJs 为每个模块提供一个 exports 变量指向 module.exports，相当于在每个模块头部执行 `var exports = module.exports`。exports 默认是个空对象，可以添加属性和方法但不能被赋值，因为这样会切断了两者联系，而且不能导出需要new实例化的类。使用时建议 module.exports 导出对象和类、exports 导出普通函数和变量</div> \n\n  * 一个单独的文件就是一个模块\n  * 每个模块都是一个单独的作用域\n  * 每个模块内部都有一个 module 对象来代表当前模块\n  * 暴露模块中的内容可以通过 module.exports、exports \n    \n\n### 模块加载\n  * 本质：读取模块内部的 module.exports 变量\n  * 特点\n    * 缓存结果：模块第一次加载并执行之后就会缓存结果，再次加载时就会直接读取缓存结果，想要再次运行则必须清除缓存\n    * 同步加载：模块加载会阻塞接下来代码的执行，需要等到模块加载完成才能继续执行\n  * 方法\n    * require()：当前模块中读取其它模块并执行\n    * require.resolve()：解析模块标识符的绝对路径\n\n### 模块标识\n> require() 的参数，require 会根据其格式使用不同的路径加载原则去寻找模块文件\n\n  * 模块名：符合小驼峰命名的字符串\n    * 核心模块：系统安装目录\n    * 安装模块：node_modules 目录\n  * 绝对路径：以 \"/\" 开头\n  * 相对路径：以 \"./\" 开头\n\n\n  ```js\n  // 导出一个要实例化的类  module.exports = exports = function (){ }\n\n  // rocker.js \n  module.exports = function(name, age) {\n      this.name = name;\n      this.age = age;\n      thisl.about = function() {\n          console.log(this.name + 'is' + this.age + 'years old');\n      };\n  };\n\n  // 引用\n  var Rocker = require('./rocker.js')\n  var r = new Rocker('Ozzy', 62)\n  r.about()   // Ozzy is 62 years old\n\n\n  // 导出一个静态类 exports.funcName = function (){}\n\n  // hello.js\n  function hello() {\n      console.log('Hello, world');\n  }\n  function greet(name) {\n      console.log('Hello, ' + name + '!');\n  }\n  // 写法一\n  module.exports = {\n      hello: hello,\n      greet: greet\n  }\n  // 写法二\n  exports.hello = hello;\n  exports.greet = greet;\n  // 错误写法\n  exports = {\n      hello: hello,\n      greet: greet\n  }\n\n  // 引用\n  var hello = require('./hello.js')\n  hello.hello()  // Hello, world\n  ```\n\n\n## AMD\n> 异步模块定义，浏览器端模块化开发规范。它允许异步和按需加载模块，requireJS 是参照它实现的\n\n### 特点\n  * 异步加载方式，模块加载不影响后面语句的运行\n    * 实现方式：依赖模块的所有语句都放置在回调函数中并在模块加载完成后执行\n    * 解决问题：js 加载时浏览器会停止页面渲染，加载文件越多则页面失去的响应时间越长\n  * 管理模块之间的依赖性，便于代码的编写和维护\n    * 解决问题：js 文件需要它的被依赖文件早于它加载到浏览器 \n\n\n### 语法 \n  * 模块定义：`define(可选模块标识, 依赖模块数组, 模块初始化要执行的函数或对象)`\n  * 模块加载：`require(依赖模块数组, 模块加载成功后的回调函数)`\n\n  ```js\n  // 定义模块 myModule.js\n  define(['dependency'], function(){\n      var name = 'Byron';\n      function printName(){\n          console.log(name);\n      }\n      return {\n          printName: printName\n      };\n  });\n\n  // 加载模块\n  require(['myModule'], function (my){\n  　 my.printName();\n  });\n  ```\n\n\n## CMD \n> AMD 基础上改进的一种规范，主要区别是对依赖模块的执行时机处理不同。seaJS 是参照它实现的\n\n### 区别\n  * 依赖处理\n    * AMD 推崇依赖前置，在定义模块时就要声明其依赖的模块 \n    * CMD 推崇就近依赖，只有在用到某个模块时再去 require \n  * 方法    \n    * AMD API 默认是一个当多个用，比如模块加载分为全局的和局部的 require\n    * CMD 推崇职责单一而且简单，比如模块加载只有 seajs.use() \n\n\n### 语法\n  ```js\n  // 定义模块  index.js\n  define(function(require, exports, module) {\n\n      // 使用 exports\n      exports.name = 'index';\n      exports.hello = function() {\n          console.log('Hello index');\n      };\n\n      // 使用 module.exports\n      module.exports = {\n          name: 'index',\n          hello: function() {\n            console.log('index');\n          }\n      };\n  });\n\n  // 加载模块\n  seajs.use('index', function(my) {\n      my.hello();\n  });\n  ```\n\n\n## UMD\n> 兼容 AMD 和 commonJS，提出了跨平台的解决方案\n\n  ```js\n  // 无导入导出规范，只有如下的常规写法来检测 JS 环境\n  (function (root, factory) {\n      if (typeof define === 'function' && define.amd) {\n          // AMD\n          define(['jquery'], factory);\n      } else if (typeof exports === 'object') {\n          // CommonJS\n          module.exports = factory(require('jquery'));\n      } else {\n          // 挂载到全局：root 即 window\n          root.returnExports = factory(root.jQuery);\n      }\n  }(this, function ($) {\n      // 方法\n      function myFunc(){ };\n      // 暴露公共方法\n      return myFunc;\n  }));\n  ```\n\n\n## ES Module\n> ES6 的最新语法支持规范\n\n<div style=\"text-indent: 2em\">CommonJS 和 AMD 规范都只能在运行时确定依赖。而 ES6 在语言层面提出了模块化方案, ES6 module 模块编译时就能确定模块的依赖关系，以及输入和输出的变量。ES6 模块化这种加载称为 编译时加载(异步按需加载)、静态加载。</div> \n\n  * 导入：`import {模块名A，模块名B...} from '模块路径'`\n  * 导出：`export、export default`\n  * 异步加载：`import('模块路径').then()`\n\n  ```js\n  /* 错误写法 */\n  export 1;\n\n  var m = 1;\n  export m;\n\n  if (x === 2) {\n    import MyModual from './myModual';\n  }\n\n  /* 正确写法 */\n  export var m = 1;\n\n  var m = 1;\n  export {m};\n\n  var n = 1;\n  export {n as m};\n\n  var n = 1;\n  export default n;\n\n  import('./myModule.js')\n  .then(({export1, export2}) => { })\n\n  Promise.all([\n    import('./module1.js'),\n    import('./module2.js'),\n    import('./module3.js'),\n  ])\n  .then(([module1, module2, module3]) => { })\n  ```\n\n  \n# 二、面向对象编程 OOP\n> 用对象的思想去写代码，用来定义一个类\n\n<div style=\"text-indent: 2em\">`字面量方式 和 new Object()` 是两种最常用的对象创建方式，但是在使用同一接口创建多个对象时会产生大量重复代码，为了简化代码量并提高可维护性，项目开发时一般使用面向对象写法。</div>\n\n## 特点\n  * 抽象：抓住核心问题\n  * 封装：只能通过对象来访问方法\n  * 继承：从已有对象上继承出新的对象\n  * 多态：多对象的不同形态\n\n\n## 实现方式\n  * __工厂模式__：解决了重复实例化多个对象的问题，但是不能识别各自的实例化对象\n  * __构造函数模式__：把函数当作一个类，实例化时它会隐式创建一个空对象并最后返回\n    * 建议首字母大写以区分普通函数\n    * 实例化的对象可以通过 instanceof 判断它的实例\n  * __原型模式__：好处是可以让 `所有对象实例` 共享 `原型对象` 所包含的属性和方法\n  * __混合模式__：可变属性写入构造函数，固定属性和方法写入原型对象，这样可以节省内存 \n\n\n  ```js\n  // 工厂模式\n  function person(name, age){\n      var obj = {};     // 原料\n      obj.name = name;  // 加工\n      obj.age = age;    \n      obj.say = function(){ \n        console.log(this.name)    \n      }\n      return obj     \n  }\n  var p1 = person(\"tom\", 18);\n\n\n  // 构造函数模式\n  function Person(name, age){     // 类：模具\n      this.name = name;  \n      this.age = age;    \n      this.say = function(){ \n        console.log(this.name)    \n      }  \n  }\n  var p2 = new Person(\"tom\", 20);  // 实例化对象：产品\n  console.log(p2 instanceof Person);\n\n\n  // 原型模式\n  function Person(){  }\n  Person.prototype.name = \"tom\";\n  Person.prototype.age = 24;\n  Person.prototype.say = function(){\n      console.log(this.name) \n  }\n  var p3 = new Person()\n\n\n  // 混合模式\n  function Person(name, age){\n      this.name = name;   \n      this.age = age;   \n  }\n  Person.prototype.say = function(){\n      console.log(this.name);\n  }\n  var p4 = new Person();\n  ```\n \n\n# 三、面向切面编程 AOP\n> 无侵入地将一个函数插入到另一个函数的前面或后面\n\n<div style=\"text-indent: 2em\">主要功能是将日志统计、异常处理等一些跟核心业务逻辑模块无关的功能抽离出来并封装，然后动态插入到业务逻辑模块的指定位置。这样不仅简化了业务逻辑模块，而且方便统一管理功能模块。AOP 其实只是 OOP 的补充，OOP 从横向上区分出一个个的类，AOP 则从纵向上向对象中加入特定的代码。常用场景如下：</div>\n\n  * 防止 window.onload 被二次覆盖\n  * 给 Ajax 请求动态添加参数\n  * 统计函数的执行时间\n  * 分离表单请求和校验\n  * 职责链模式\n  * 组合替代继承\n\n\n  ```js\n  // before 切面：让一个函数在另一个函数之前执行\n  Function.prototype.before = function(fn) {\n      var _self = this;     // 保存原函数引用\n      return function(){\n        fn.apply(this, arguments)   // 执行新函数，修正 this\n        return _self.apply(this, arguments);  // 执行原函数\n      }\n  }\n\n  // after 切面：让一个函数在另一个函数之后执行\n  Function.prototype.after = function(fn) {\n    var _self = this;\n    return function(){\n      var ret = _self.apply(this, arguments);\n      fn.apply(this, arguments);\n      return ret;\n    }\n  }\n\n  var obj = {\n    name: 'tangdy',\n    getName: function(){\n      console.log(this.name);\n    }\n  }\n\n  obj.getName = obj.getName.before(function(){\n      console.log(\"before\")\n  }).after(function(){\n      console.log(\"after\")\n  });\n  obj.getName();\n\n  ```\n\n\n# 四、异步编程\n  \n## 回调函数\n  * 实现：作为参数传递到其它函数执行\n  * 优点：简单、容易理解和部署\n  * 缺点\n    * 层层嵌套，不利于代码的阅读和维护\n    * 每个任务只能指定一个回调函数\n    * 各个部分之间高度耦合，流程会很混乱\n    \n  \n  ```js\n  // 把同步操作变成异步\n  f1(f2);\n\n  function f1(callback){\n  　　setTimeout(function () {\n  　　　　　callback();\n  　　}, 1000);\n  }\n  ```\n    \n\n## 事件监听\n  * 实现：采用事件驱动模式 \n  * 优点\n    * 容易理解\n    * 可以绑定多个事件\n    * 每个事件可以指定多个回调函数\n    * 可以去耦合，有利于实现模块化\n  * 缺点：整个程序变成事件驱动型，运行流程不清晰 \n  * 监听函数：on、bind、listen、observe、addEventListener\n\n\n  ```js\n  // f1 执行完成后立即触发 done 事件从而执行 f2\n  f1.on(\"done\", f2);\n\n  function f1(){\n    setTimeout(function(){\n      //f1的代码量\n      f1.trigger(\"done\");\n    }, 1000)\n  }\n  ```\n \n\n## 观察者模式\n> 即发布订阅模式，它定义了一种一对多的关系\n\n  * 实现：让多个观察者同时对监听某个对象，对象变化会通知多个观察者对象而自动更新\n  * 优点\n    * 支持简单的广播通信，自动通知所有已经订阅过的对象\n    * 目标对象与观察者之间的抽象耦合关系能够单独扩展以及重用\n    * 页面载入后，目标对象很容易与观察者存在一种动态关联，增加灵活性\n\n\n  ```js\n  // f1 执行完成后向信号中心 jQuery 发布 done 信号，从而引发 f2 的执行\n  jQuery.subscribe(\"done\", f2);\n\n  function f1(){\n    setTimeout(function(){\n      //f1的代码\n      jQuery.publish(\"done\");\n    }, 1000)\n  } \n  ```\n\n\n## promise 对象\n> CommonJS 工作组提出的一种规范，目的是为异步编程提供统一接口\n\n  * 实现机制\n    * 代理对象：Promise 对象代表一个异步操作\n    * 对象状态：只有异步操作的结果，可以决定 Promise 对象的当前状态\n    * 回调函数：`then()` 用来注册当 promise 完成或者失败时调用的回调函数\n  * 对象状态\n    * 三种状态：等待 `pending`、已完成 `fulfilled`、已失败 `rejected`\n    * 状态改变：只能从 pending 转变为 fulfilled/rejected，而且状态一旦改变就不会再变\n  * 主要优势\n    * 解决回调地狱问题\n    * 更好地进行错误捕获 \n  * 规范图解\n    <div align=\"center\">\n      ![Promise 规范](images/web/promise.png)\n    </div>   \n\n\n  ```js\n  // 创建实例\n  var promise = new Promise((resolve, reject) => {\n      resolve()\n  })\n  promise.then(val => {   // 抛出错误\n      console.log(val)\n      console.log(1)\n  }).then(() => {         // 不会执行\n      console.log(111)\n  }).catch(error => {     // 接收错误\n      console.log(error)\n  }).then(() => {         // 继续执行\n      console.log(333)\n  })\n\n\n  // 语法糖\n  Promise.resolve(42).then(value =>{\n      console.log(value);\n  })  // 等同于\n  new Promise(resolve => {\n      resolve(42)\n  }).then(value => {\n      console.log(value)\n  })\n\n  Promise.reject(value) // 等同于\n  new Promise(function(resolve, reject){\n      reject(new Error(\"出错了\"));\n  });\n\n\n  // 合并多个实例\n  function timerPromisefy(delay) {\n      return new Promise(function (resolve) {\n          setTimeout(function () {\n              resolve(delay);\n          }, delay);\n      });\n  }\n  // 当数组中所有 Promise 对象被 resolve 之后，该方法才执行 \n  Promise.all([\n      timerPromisefy(1),\n      timerPromisefy(10)\n  ]).then(function (value) {\n      console.log(value);    \n  });\n  // 任何一个 promise 变为 resolve/reject，程序就停止运行\n  Promise.race([\n      timerPromisefy(1),\n      timerPromisefy(10)\n  ]).then(function (value) {\n      console.log(value);    \n  });\n\n\n  // 封装 AJAX 实例\n  function get(url) { \n      return new Promise(function (resolve, reject) { \n          var req = new XMLHttpRequest() || new ActiveXObject('Microsoft.XMLHTTP')\n          req.open('GET', url, true) \n          req.onload = function () {\n              if (req.readyState == 4 && req.status == 200) {\n                  resolve(req.response)\n              } else {\n                  reject(Error(req.statusText))\n              }\n          }\n\n          req.onerror = function () {\n              reject(Error(\"Network Error\"));\n          }\n\n          req.send()\n      });\n  }\n  get(\"http://something\").then(function (response) {\n      console.log(response);\n  }).catch(function (error) {\n      console.log(error);\n  })\n\n\n   // 图片加载完成后播放音乐\n  this.loadImg([img, img_1, img_2_1, img_2_2]).then(() => {\n    setTimeout(() => {\n        this.playMusic()\n    }, 500)\n  })\n  const loadImg = (img) => {  \n      const isArray = Array.isArray(img)\n      // 参数为单个字符串/数组\n      if (!isArray) {\n          const oImg = new Image()\n          oImg.src = img\n          return new Promise(resolve => {\n              oImg.onload = () => {\n                  resolve()\n              }\n          })\n      }\n      const arr = []\n      img.forEach(val => {\n          const oImg = new Image()\n          oImg.src = val\n          arr.push(new Promise(resolve => {\n              oImg.onload = () => {\n                  resolve()\n              }\n          }))\n      })\n      return Promise.all(arr)\n  }\n  ```\n\n\n## async/await 异步函数\n> 一个用同步思维解决异步问题的方案，代码简洁而且更符合编写习惯\n     \n  * async：表示函数是异步的，定义的函数会隐式返回一个 promise 对象\n  * await：表示等待后面的异步函数返回结果之后再执行，只能用于 async 函数内部\n  \n  \n  ```js\n  // async 异步 \n  async function foo() { return \"hello\" }\n  const foo = async function () {}\n  const foo = async () => {}\n\n  console.log(foo());  // promise 对象\n\n\n  // await 等待\n  let fun = function (time) {\n      return new Promise(function (resolve, reject) {\n          setTimeout(function () {\n              resolve(); \n          }, time)\n      })\n  }\n  let funAsync_1 = async function () {\n      console.log(1)\n      await fun(3000)\n      console.log(2);\n  }\n  let funAsync_2 = async function () {\n      console.log(3)\n      await funAsync_1()\n      console.log(4)\n  }\n  funAsync_2()  // 3、1、2、4\n\n\n  // 错误处理\n  let p = new Promise((resolve, reject) => {\n    reject(\"error\")\n  })\n  async function demo(params) {\n    try {\n        let result = await p;\n    } catch(e) {\n        console.log(e);\n    }\n  }\n  demo()   // error\n\n\n  // 并行处理\n  function count(num) {\n      return new Promise((res, rej) => {\n          res(num)\n      })\n  }\n  // Promise 写法\n  count(100).then(res => {\n      return count(res + 100);\n  }).then(res => {\n      return count(res + 100);\n  }).then(res => {\n      console.log(res);\n  })\n  // await 写法\n  async function demo() {\n\n      // 返回一个值\n      let res_1 = await count(100);\n      let res_2 = await count(res_1 + 100);\n      let res_3 = await count(res_2 + 100);\n      return res_3;\n\n      // 返回数组\n      return await Promise.all([count(100), count(200)])\n\n  }\n  demo().then(res => {\n      console.log(res);\n  })\n\n\n  // 循环处理\n  function count(num) {\n      return new Promise((res, rej) => {\n          console.log(num)\n          res(num);\n      })\n  }\n  (async (names) => {\n      for(let i = 0; i &lt; names.length; i++) {\n          await count(names[i])\n      }\n  })([1, 2, 3])\n  ```\n\n\n# 五、JS 算法  \n  * 排序算法\n    * __冒泡排序__：比较任何两个相邻元素，如果第一个比第二个大则交换位置。元素向上移动到正确顺序，类似气泡上升至表面而得名。\n    * __选择排序__：每次从元素中选出最小或最大值，存放在序列的起始位置，以此循环至排序完毕。\n    * __插入排序__：将一个数据插入到已经排好序的有序数据中，从而得到一个新的、个数加一的有序数据，适用于少量数据的排序。\n    * __归并排序__：将原始序列切分成较小的序列直到无法再切分，然后将小序列排序后归并成大序列，直到最后只有一个排序完毕的大序列。\n    * __快速排序__：通过一趟排序将要排序的数据分割成独立的两部分，其中一部分的所有数据都比另外一部分的所有数据都要小，然后再按此方法对这两部分数据分别进行上述递归排序，以此达到整个数据变成有序序列。\n  * 搜索算法\n    * __顺序搜索__：让目标元素与列表中的每一个元素逐个比较，直到找出与给定元素相同的元素为止，缺点是效率低下。\n    * __二分搜索__：在一个有序列表，以中间值为基准拆分为两个子列表，拿目标元素与中间值作比较从而再在目标的子列表中递归此方法，直至找到目标元素。\n  * 其他\n    * __贪心算法__：在对问题求解时，不考虑全局，总是做出局部最优解的方法。\n    * __动态规划__：在对问题求解时，由以求出的局部最优解来推导全局最优解。\n    * __复杂度__：一个方法在执行的整个生命周期所需要占用的时间、空间等资源。\n\n\n\n## 冒泡排序\n  ```js\n  Array.prototype.bubbleSort = function() {\n      for (let i = 0; i &lt; this.length; i++) {\n          for (let j = 0; j &lt; this.length - 1 - i; j++) {\n              if (this[j] &gt; this[j + 1]) {\n                  let temp = this[j]\n                  this[j] = this[j + 1]\n                  this[j + 1] = temp\n              }\n          }\n      }\n  }\n  ```\n\n\n## 选择排序\n  ```js\n  Array.prototype.selectionSort = function() {\n      let indexMin\n      for (let i = 0; i &lt; this.length - 1; i++){\n          indexMin = i\n          for (var j = i; j &lt; this.length; j++){ \n              if(this[indexMin] &gt; this[j]) {\n                  indexMin = j\n              }\n          } \n          if (i !== indexMin){\n              let aux = this[i]\n              this[i] = this[indexMin]\n              this[indexMin] = aux\n          }\n      }\n      return this\n  }\n  ```\n\n\n## 插入排序\n  ```js\n  Array.prototype.insertionSort = function() {\n      let j\n      let temp\n      for (let i = 1; i &lt; this.length; i++) {\n          j = i\n          temp = this[i]\n          while (j &gt; 0 && this[j - 1] &gt; temp) {\n              this[j] = this[j - 1]\n              j--\n          } \n          this[j] = temp\n          console.log(this.join(', '))\n      }\n      return this\n  }\n  ```\n\n\n## 归并排序\n  ```js\n  Array.prototype.mergeSort = function() {\n      const merge = (left, right) => {\n          const result = []\n          let il = 0\n          let ir = 0\n          while(il &lt; left.length && ir &lt; right.length) {\n              if(left[il] &lt; right[ir]) {\n                  result.push(left[il++])\n              } else {\n                  result.push(right[ir++])\n              }\n          }\n          while (il &lt; left.length) {\n              result.push(left[il++])\n          }\n          while (ir &lt; right.length) {\n              result.push(right[ir++])\n          }\n          return result\n      }\n      const mergeSortRec = array => {\n          if (array.length === 1) {\n              return array\n          }\n          const mid = Math.floor(array.length / 2)\n          const left = array.slice(0, mid)\n          const right = array.slice(mid, array.length)\n          return merge(mergeSortRec(left), mergeSortRec(right))\n      }\n      return mergeSortRec(this)\n  }\n  ```\n\n\n## 快速排序\n  ```js\n  Array.prototype.quickSort = function() {\n      const partition = (array, left, right) => {\n          var pivot = array[Math.floor((right + left) / 2)]\n          let i = left\n          let j = right\n          while (i &lt;= j) {\n              while (array[i] &lt; pivot) {\n                  i++\n              }\n              while (array[j] &gt; pivot) {\n                  j--\n              }\n              if (i &lt;= j) {\n                  let aux = array[i]\n                  array[i] = array[j]\n                  array[j] = aux\n                  i++\n                  j--\n              }\n          }\n          return i\n      }\n      const quick = (array, left, right) => {\n          let index\n          if (array.length &gt; 1) {\n              index = partition(array, left, right)\n              if (left &lt; index - 1) {\n                  quick(array, left, index - 1)\n              }\n              if (index &lt; right) {\n                  quick(array, index, right)\n              }\n          }\n      }\n      quick(this, 0, this.length - 1)\n      return this\n  }\n  ```\n\n\n## 顺序搜索\n  ```js\n  Array.prototype.sequentialSearch = function(item) {\n      for (let i = 0; i &lt; this.length; i++) {\n          if (item === this[i]) return i\n      }\n      return -1\n  }\n  ```\n\n\n## 二分搜索\n  ```js\n  Array.prototype.binarySearch = function(item) {\n      this.quickSort()\n      let low = 0\n      let mid = null\n      let element = null\n      let high = this.length - 1\n      while (low &lt;= high){\n          mid = Math.floor((low + high) / 2)\n          element = this[mid]\n          if (element &lt; item) {\n              low = mid + 1\n          } else if (element &gt; item) {\n              high = mid - 1\n          } else {\n              return mid\n          }\n      }\n      return -1\n  }\n  ```\n\n\n## 动态规划\n> 美国硬币：d1=1, d2=5, d3=10, d4=25，如果要找36美分的零钱，我们可以用 1个25美分、1个10美分和1个便士（ 1美分)\n最少硬币找零的解决方案是找到 n 所需的最小硬币数\n\n  ```js\n  class MinCoinChange {\n\n    constructor(coins) {\n      this.coins = coins\n      this.cache = {}\n    }\n\n    makeChange(amount) {\n      if (!amount) return []\n      if (this.cache[amount]) return this.cache[amount]\n      let min = [], newMin, newAmount\n      this.coins.forEach(coin => {\n          newAmount = amount - coin\n          if (newAmount &gt;= 0) {\n              newMin = this.makeChange(newAmount)\n          }\n          if (newAmount &gt;= 0 && \n                (newMin.length &lt; min.length - 1 || !min.length) && \n                (newMin.length || !newAmount)) {\n              min = [coin].concat(newMin)\n          }\n      })\n      return (this.cache[amount] = min)\n    }\n  }\n  const rninCoinChange = new MinCoinChange([1, 5, 10, 25])\n  console.log(minCoinChange.makeChange(36)) // [1, 10, 25]\n\n  const minCoinChange2 = new MinCoinChange([1, 3, 4])\n  console.log(minCoinChange2.makeChange(6))  // [3, 3]\n  ```\n\n\n## 贪心算法\n> 通过贪心算法得出上述解决方案\n  ```js\n  class MinCoinChange {\n\n    constructor(coins) {\n      this.coins = coins\n    }\n\n    makeChange(amount) {\n      const change = []\n      let total = 0\n      this.coins.sort((a, b) => a &lt; b).forEach(coin => {\n          while ((total + coin) &lt;= amount) {\n            change.push(coin)\n            total += coin\n          }\n      })\n      return change\n    }\n  }\n  const rninCoinChange = new MinCoinChange ( [ 1, 5, 10, 2 5])\n  console. log (rninCoinChange. rnakeChange (36))\n  ```\n\n\n\n\n\n","slug":"11-web编程","published":1,"updated":"2019-05-10T17:13:47.728Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvid4pmm001v0nbxymkjrfoc","content":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><html><head></head><body><h1 id=\"一、模块化编程\"><a href=\"#一、模块化编程\" class=\"headerlink\" title=\"一、模块化编程\"></a>一、模块化编程</h1><div style=\"text-indent:2em\">早期引用 JS 文件时直接通过 script 即可，但是随着项目的复杂度越来越大，这种方式带来了 逻辑混乱、可维护性差等问题。为了编写可维护的代码，我们采用将代码合理拆分到不同的文件里，每一个文件就是一个模块，文件路径就是模块名，这种组织代码的方式就是模块化。</div><h2 id=\"优势\"><a href=\"#优势\" class=\"headerlink\" title=\"优势\"></a>优势</h2><ul><li>开发效率高，有利于多人协同开发</li><li>解决项目中的全局变量污染的问题</li><li>功能单一，方便代码的复用和维护</li><li>解决文件依赖问题，无需关注文件引用顺序</li></ul><h2 id=\"JS-环境\"><a href=\"#JS-环境\" class=\"headerlink\" title=\"JS 环境\"></a>JS 环境</h2><ul><li>服务器端<ul><li>相同的代码需要多次执行</li><li>CPU 和内存资源是瓶颈</li><li>加载时从磁盘中加载</li></ul></li><li>浏览器端<ul><li>代码需要从一个服务器端分发到多个客户端执行</li><li>带宽网络是瓶颈</li><li>加载时需要通过网络加载</li></ul></li></ul><h2 id=\"发展进程\"><a href=\"#发展进程\" class=\"headerlink\" title=\"发展进程\"></a>发展进程</h2><ol><li>命名空间形式的代码封装 (函数封装)</li><li>通过 立即执行函数(IIFE) 创建的命名空间</li><li>服务器端运行时 Nodejs 的 CommonJS 规范</li><li>将模块化运行在浏览器端的 AMD/CMD 规范</li><li>兼容 AMD 和 CommonJS 的 UMD 规范</li><li><p>通过语言标准支持的 ES Module</p><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 命名空间</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">square</span>(<span class=\"params\">x</span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> x !== <span class=\"string\">\"number\"</span>) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x * x;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">var</span> utils = {</span><br><span class=\"line\">    add: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">x, y</span>) </span>{</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x + y</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// IIFE</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"built_in\">module</span> = (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> count = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> {</span><br><span class=\"line\">        inc: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">            count += <span class=\"number\">1</span>;</span><br><span class=\"line\">        },</span><br><span class=\"line\">        dec: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">            count += <span class=\"number\">-1</span>;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">})()</span><br><span class=\"line\"><span class=\"built_in\">module</span>.inc();</span><br></pre></td></tr></tbody></table></figure></li></ol><h2 id=\"CommonJS\"><a href=\"#CommonJS\" class=\"headerlink\" title=\"CommonJS\"></a>CommonJS</h2><blockquote><p>服务器端的模块化开发规范，主要特点是 同步加载模块，Nodejs 的模块规范就是参照它实现的</p></blockquote><div style=\"text-indent:2em\">CommonJS 会在启动时把内置模块和加载过的模块放在本地硬盘，文件读取时不受限于网络而等待时间很短，所以在 Node 环境中使用同步加载的方式不会有很大问题。但是 CommonJS 如果应用在浏览器端，同步加载的机制会使得 JS 阻塞 UI 线程，造成页面卡顿，网速不好时还会导致浏览器假死。</div><h3 id=\"模块定义\"><a href=\"#模块定义\" class=\"headerlink\" title=\"模块定义\"></a>模块定义</h3><div style=\"text-indent:2em\">为了方便，NodeJs 为每个模块提供一个 exports 变量指向 module.exports，相当于在每个模块头部执行 <code>var exports = module.exports</code>。exports 默认是个空对象，可以添加属性和方法但不能被赋值，因为这样会切断了两者联系，而且不能导出需要new实例化的类。使用时建议 module.exports 导出对象和类、exports 导出普通函数和变量</div><ul><li>一个单独的文件就是一个模块</li><li>每个模块都是一个单独的作用域</li><li>每个模块内部都有一个 module 对象来代表当前模块</li><li>暴露模块中的内容可以通过 module.exports、exports</li></ul><h3 id=\"模块加载\"><a href=\"#模块加载\" class=\"headerlink\" title=\"模块加载\"></a>模块加载</h3><ul><li>本质：读取模块内部的 module.exports 变量</li><li>特点<ul><li>缓存结果：模块第一次加载并执行之后就会缓存结果，再次加载时就会直接读取缓存结果，想要再次运行则必须清除缓存</li><li>同步加载：模块加载会阻塞接下来代码的执行，需要等到模块加载完成才能继续执行</li></ul></li><li>方法<ul><li>require()：当前模块中读取其它模块并执行</li><li>require.resolve()：解析模块标识符的绝对路径</li></ul></li></ul><h3 id=\"模块标识\"><a href=\"#模块标识\" class=\"headerlink\" title=\"模块标识\"></a>模块标识</h3><blockquote><p>require() 的参数，require 会根据其格式使用不同的路径加载原则去寻找模块文件</p></blockquote><ul><li>模块名：符合小驼峰命名的字符串<ul><li>核心模块：系统安装目录</li><li>安装模块：node_modules 目录</li></ul></li><li>绝对路径：以 “/“ 开头</li><li>相对路径：以 “./“ 开头</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 导出一个要实例化的类  module.exports = exports = function (){ }</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// rocker.js </span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">name, age</span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.age = age;</span><br><span class=\"line\">    thisl.about = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name + <span class=\"string\">'is'</span> + <span class=\"keyword\">this</span>.age + <span class=\"string\">'years old'</span>);</span><br><span class=\"line\">    };</span><br><span class=\"line\">};</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 引用</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Rocker = <span class=\"built_in\">require</span>(<span class=\"string\">'./rocker.js'</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> r = <span class=\"keyword\">new</span> Rocker(<span class=\"string\">'Ozzy'</span>, <span class=\"number\">62</span>)</span><br><span class=\"line\">r.about()   <span class=\"comment\">// Ozzy is 62 years old</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 导出一个静态类 exports.funcName = function (){}</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// hello.js</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">hello</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Hello, world'</span>);</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">greet</span>(<span class=\"params\">name</span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Hello, '</span> + name + <span class=\"string\">'!'</span>);</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"comment\">// 写法一</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = {</span><br><span class=\"line\">    hello: hello,</span><br><span class=\"line\">    greet: greet</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"comment\">// 写法二</span></span><br><span class=\"line\">exports.hello = hello;</span><br><span class=\"line\">exports.greet = greet;</span><br><span class=\"line\"><span class=\"comment\">// 错误写法</span></span><br><span class=\"line\">exports = {</span><br><span class=\"line\">    hello: hello,</span><br><span class=\"line\">    greet: greet</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 引用</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> hello = <span class=\"built_in\">require</span>(<span class=\"string\">'./hello.js'</span>)</span><br><span class=\"line\">hello.hello()  <span class=\"comment\">// Hello, world</span></span><br></pre></td></tr></tbody></table></figure><h2 id=\"AMD\"><a href=\"#AMD\" class=\"headerlink\" title=\"AMD\"></a>AMD</h2><blockquote><p>异步模块定义，浏览器端模块化开发规范。它允许异步和按需加载模块，requireJS 是参照它实现的</p></blockquote><h3 id=\"特点\"><a href=\"#特点\" class=\"headerlink\" title=\"特点\"></a>特点</h3><ul><li>异步加载方式，模块加载不影响后面语句的运行<ul><li>实现方式：依赖模块的所有语句都放置在回调函数中并在模块加载完成后执行</li><li>解决问题：js 加载时浏览器会停止页面渲染，加载文件越多则页面失去的响应时间越长</li></ul></li><li>管理模块之间的依赖性，便于代码的编写和维护<ul><li>解决问题：js 文件需要它的被依赖文件早于它加载到浏览器</li></ul></li></ul><h3 id=\"语法\"><a href=\"#语法\" class=\"headerlink\" title=\"语法\"></a>语法</h3><ul><li>模块定义：<code>define(可选模块标识, 依赖模块数组, 模块初始化要执行的函数或对象)</code></li><li><p>模块加载：<code>require(依赖模块数组, 模块加载成功后的回调函数)</code></p><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 定义模块 myModule.js</span></span><br><span class=\"line\">define([<span class=\"string\">'dependency'</span>], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> name = <span class=\"string\">'Byron'</span>;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">printName</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(name);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> {</span><br><span class=\"line\">        printName: printName</span><br><span class=\"line\">    };</span><br><span class=\"line\">});</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 加载模块</span></span><br><span class=\"line\"><span class=\"built_in\">require</span>([<span class=\"string\">'myModule'</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">my</span>)</span>{</span><br><span class=\"line\">　 my.printName();</span><br><span class=\"line\">});</span><br></pre></td></tr></tbody></table></figure></li></ul><h2 id=\"CMD\"><a href=\"#CMD\" class=\"headerlink\" title=\"CMD\"></a>CMD</h2><blockquote><p>AMD 基础上改进的一种规范，主要区别是对依赖模块的执行时机处理不同。seaJS 是参照它实现的</p></blockquote><h3 id=\"区别\"><a href=\"#区别\" class=\"headerlink\" title=\"区别\"></a>区别</h3><ul><li>依赖处理<ul><li>AMD 推崇依赖前置，在定义模块时就要声明其依赖的模块</li><li>CMD 推崇就近依赖，只有在用到某个模块时再去 require</li></ul></li><li>方法<ul><li>AMD API 默认是一个当多个用，比如模块加载分为全局的和局部的 require</li><li>CMD 推崇职责单一而且简单，比如模块加载只有 seajs.use()</li></ul></li></ul><h3 id=\"语法-1\"><a href=\"#语法-1\" class=\"headerlink\" title=\"语法\"></a>语法</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 定义模块  index.js</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">require, exports, module</span>) </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 使用 exports</span></span><br><span class=\"line\">    exports.name = <span class=\"string\">'index'</span>;</span><br><span class=\"line\">    exports.hello = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'Hello index'</span>);</span><br><span class=\"line\">    };</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 使用 module.exports</span></span><br><span class=\"line\">    <span class=\"built_in\">module</span>.exports = {</span><br><span class=\"line\">        name: <span class=\"string\">'index'</span>,</span><br><span class=\"line\">        hello: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(<span class=\"string\">'index'</span>);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    };</span><br><span class=\"line\">});</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 加载模块</span></span><br><span class=\"line\">seajs.use(<span class=\"string\">'index'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">my</span>) </span>{</span><br><span class=\"line\">    my.hello();</span><br><span class=\"line\">});</span><br></pre></td></tr></tbody></table></figure><h2 id=\"UMD\"><a href=\"#UMD\" class=\"headerlink\" title=\"UMD\"></a>UMD</h2><blockquote><p>兼容 AMD 和 commonJS，提出了跨平台的解决方案</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 无导入导出规范，只有如下的常规写法来检测 JS 环境</span></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">root, factory</span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> define === <span class=\"string\">'function'</span> && define.amd) {</span><br><span class=\"line\">        <span class=\"comment\">// AMD</span></span><br><span class=\"line\">        define([<span class=\"string\">'jquery'</span>], factory);</span><br><span class=\"line\">    } <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> exports === <span class=\"string\">'object'</span>) {</span><br><span class=\"line\">        <span class=\"comment\">// CommonJS</span></span><br><span class=\"line\">        <span class=\"built_in\">module</span>.exports = factory(<span class=\"built_in\">require</span>(<span class=\"string\">'jquery'</span>));</span><br><span class=\"line\">    } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">        <span class=\"comment\">// 挂载到全局：root 即 window</span></span><br><span class=\"line\">        root.returnExports = factory(root.jQuery);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}(<span class=\"keyword\">this</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">$</span>) </span>{</span><br><span class=\"line\">    <span class=\"comment\">// 方法</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">myFunc</span>(<span class=\"params\"></span>)</span>{ };</span><br><span class=\"line\">    <span class=\"comment\">// 暴露公共方法</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> myFunc;</span><br><span class=\"line\">}));</span><br></pre></td></tr></tbody></table></figure><h2 id=\"ES-Module\"><a href=\"#ES-Module\" class=\"headerlink\" title=\"ES Module\"></a>ES Module</h2><blockquote><p>ES6 的最新语法支持规范</p></blockquote><div style=\"text-indent:2em\">CommonJS 和 AMD 规范都只能在运行时确定依赖。而 ES6 在语言层面提出了模块化方案, ES6 module 模块编译时就能确定模块的依赖关系，以及输入和输出的变量。ES6 模块化这种加载称为 编译时加载(异步按需加载)、静态加载。</div><ul><li>导入：<code>import {模块名A，模块名B...} from '模块路径'</code></li><li>导出：<code>export、export default</code></li><li><p>异步加载：<code>import('模块路径').then()</code></p><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 错误写法 */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> m = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> m;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (x === <span class=\"number\">2</span>) {</span><br><span class=\"line\">  <span class=\"keyword\">import</span> MyModual <span class=\"keyword\">from</span> <span class=\"string\">'./myModual'</span>;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 正确写法 */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">var</span> m = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> m = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> {m};</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> n = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> {n <span class=\"keyword\">as</span> m};</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> n = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> n;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span>(<span class=\"string\">'./myModule.js'</span>)</span><br><span class=\"line\">.then(<span class=\"function\">(<span class=\"params\">{export1, export2}</span>) =></span> { })</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.all([</span><br><span class=\"line\">  <span class=\"keyword\">import</span>(<span class=\"string\">'./module1.js'</span>),</span><br><span class=\"line\">  <span class=\"keyword\">import</span>(<span class=\"string\">'./module2.js'</span>),</span><br><span class=\"line\">  <span class=\"keyword\">import</span>(<span class=\"string\">'./module3.js'</span>),</span><br><span class=\"line\">])</span><br><span class=\"line\">.then(<span class=\"function\">(<span class=\"params\">[module1, module2, module3]</span>) =></span> { })</span><br></pre></td></tr></tbody></table></figure></li></ul><h1 id=\"二、面向对象编程-OOP\"><a href=\"#二、面向对象编程-OOP\" class=\"headerlink\" title=\"二、面向对象编程 OOP\"></a>二、面向对象编程 OOP</h1><blockquote><p>用对象的思想去写代码，用来定义一个类</p></blockquote><div style=\"text-indent:2em\"><code>字面量方式 和 new Object()</code> 是两种最常用的对象创建方式，但是在使用同一接口创建多个对象时会产生大量重复代码，为了简化代码量并提高可维护性，项目开发时一般使用面向对象写法。</div><h2 id=\"特点-1\"><a href=\"#特点-1\" class=\"headerlink\" title=\"特点\"></a>特点</h2><ul><li>抽象：抓住核心问题</li><li>封装：只能通过对象来访问方法</li><li>继承：从已有对象上继承出新的对象</li><li>多态：多对象的不同形态</li></ul><h2 id=\"实现方式\"><a href=\"#实现方式\" class=\"headerlink\" title=\"实现方式\"></a>实现方式</h2><ul><li><strong>工厂模式</strong>：解决了重复实例化多个对象的问题，但是不能识别各自的实例化对象</li><li><strong>构造函数模式</strong>：把函数当作一个类，实例化时它会隐式创建一个空对象并最后返回<ul><li>建议首字母大写以区分普通函数</li><li>实例化的对象可以通过 instanceof 判断它的实例</li></ul></li><li><strong>原型模式</strong>：好处是可以让 <code>所有对象实例</code> 共享 <code>原型对象</code> 所包含的属性和方法</li><li><strong>混合模式</strong>：可变属性写入构造函数，固定属性和方法写入原型对象，这样可以节省内存</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 工厂模式</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">person</span>(<span class=\"params\">name, age</span>)</span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> obj = {};     <span class=\"comment\">// 原料</span></span><br><span class=\"line\">    obj.name = name;  <span class=\"comment\">// 加工</span></span><br><span class=\"line\">    obj.age = age;    </span><br><span class=\"line\">    obj.say = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{ </span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name)    </span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> obj     </span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">var</span> p1 = person(<span class=\"string\">\"tom\"</span>, <span class=\"number\">18</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 构造函数模式</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name, age</span>)</span>{     <span class=\"comment\">// 类：模具</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;  </span><br><span class=\"line\">    <span class=\"keyword\">this</span>.age = age;    </span><br><span class=\"line\">    <span class=\"keyword\">this</span>.say = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{ </span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name)    </span><br><span class=\"line\">    }  </span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">var</span> p2 = <span class=\"keyword\">new</span> Person(<span class=\"string\">\"tom\"</span>, <span class=\"number\">20</span>);  <span class=\"comment\">// 实例化对象：产品</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(p2 <span class=\"keyword\">instanceof</span> Person);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 原型模式</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\"></span>)</span>{  }</span><br><span class=\"line\">Person.prototype.name = <span class=\"string\">\"tom\"</span>;</span><br><span class=\"line\">Person.prototype.age = <span class=\"number\">24</span>;</span><br><span class=\"line\">Person.prototype.say = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name) </span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">var</span> p3 = <span class=\"keyword\">new</span> Person()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 混合模式</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name, age</span>)</span>{</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;   </span><br><span class=\"line\">    <span class=\"keyword\">this</span>.age = age;   </span><br><span class=\"line\">}</span><br><span class=\"line\">Person.prototype.say = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">var</span> p4 = <span class=\"keyword\">new</span> Person();</span><br></pre></td></tr></tbody></table></figure><h1 id=\"三、面向切面编程-AOP\"><a href=\"#三、面向切面编程-AOP\" class=\"headerlink\" title=\"三、面向切面编程 AOP\"></a>三、面向切面编程 AOP</h1><blockquote><p>无侵入地将一个函数插入到另一个函数的前面或后面</p></blockquote><div style=\"text-indent:2em\">主要功能是将日志统计、异常处理等一些跟核心业务逻辑模块无关的功能抽离出来并封装，然后动态插入到业务逻辑模块的指定位置。这样不仅简化了业务逻辑模块，而且方便统一管理功能模块。AOP 其实只是 OOP 的补充，OOP 从横向上区分出一个个的类，AOP 则从纵向上向对象中加入特定的代码。常用场景如下：</div><ul><li>防止 window.onload 被二次覆盖</li><li>给 Ajax 请求动态添加参数</li><li>统计函数的执行时间</li><li>分离表单请求和校验</li><li>职责链模式</li><li>组合替代继承</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// before 切面：让一个函数在另一个函数之前执行</span></span><br><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.before = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">fn</span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> _self = <span class=\"keyword\">this</span>;     <span class=\"comment\">// 保存原函数引用</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">      fn.apply(<span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span>)   <span class=\"comment\">// 执行新函数，修正 this</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> _self.apply(<span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span>);  <span class=\"comment\">// 执行原函数</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// after 切面：让一个函数在另一个函数之后执行</span></span><br><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.after = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">fn</span>) </span>{</span><br><span class=\"line\">  <span class=\"keyword\">var</span> _self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ret = _self.apply(<span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">    fn.apply(<span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ret;</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = {</span><br><span class=\"line\">  name: <span class=\"string\">'tangdy'</span>,</span><br><span class=\"line\">  getName: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\">obj.getName = obj.getName.before(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"before\"</span>)</span><br><span class=\"line\">}).after(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"after\"</span>)</span><br><span class=\"line\">});</span><br><span class=\"line\">obj.getName();</span><br></pre></td></tr></tbody></table></figure><h1 id=\"四、异步编程\"><a href=\"#四、异步编程\" class=\"headerlink\" title=\"四、异步编程\"></a>四、异步编程</h1><h2 id=\"回调函数\"><a href=\"#回调函数\" class=\"headerlink\" title=\"回调函数\"></a>回调函数</h2><ul><li>实现：作为参数传递到其它函数执行</li><li>优点：简单、容易理解和部署</li><li>缺点<ul><li>层层嵌套，不利于代码的阅读和维护</li><li>每个任务只能指定一个回调函数</li><li>各个部分之间高度耦合，流程会很混乱</li></ul></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 把同步操作变成异步</span></span><br><span class=\"line\">f1(f2);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f1</span>(<span class=\"params\">callback</span>)</span>{</span><br><span class=\"line\">　　setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">　　　　　callback();</span><br><span class=\"line\">　　}, <span class=\"number\">1000</span>);</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"事件监听\"><a href=\"#事件监听\" class=\"headerlink\" title=\"事件监听\"></a>事件监听</h2><ul><li>实现：采用事件驱动模式</li><li>优点<ul><li>容易理解</li><li>可以绑定多个事件</li><li>每个事件可以指定多个回调函数</li><li>可以去耦合，有利于实现模块化</li></ul></li><li>缺点：整个程序变成事件驱动型，运行流程不清晰</li><li>监听函数：on、bind、listen、observe、addEventListener</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// f1 执行完成后立即触发 done 事件从而执行 f2</span></span><br><span class=\"line\">f1.on(<span class=\"string\">\"done\"</span>, f2);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f1</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">  setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"comment\">//f1的代码量</span></span><br><span class=\"line\">    f1.trigger(<span class=\"string\">\"done\"</span>);</span><br><span class=\"line\">  }, <span class=\"number\">1000</span>)</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"观察者模式\"><a href=\"#观察者模式\" class=\"headerlink\" title=\"观察者模式\"></a>观察者模式</h2><blockquote><p>即发布订阅模式，它定义了一种一对多的关系</p></blockquote><ul><li>实现：让多个观察者同时对监听某个对象，对象变化会通知多个观察者对象而自动更新</li><li>优点<ul><li>支持简单的广播通信，自动通知所有已经订阅过的对象</li><li>目标对象与观察者之间的抽象耦合关系能够单独扩展以及重用</li><li>页面载入后，目标对象很容易与观察者存在一种动态关联，增加灵活性</li></ul></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// f1 执行完成后向信号中心 jQuery 发布 done 信号，从而引发 f2 的执行</span></span><br><span class=\"line\">jQuery.subscribe(<span class=\"string\">\"done\"</span>, f2);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f1</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">  setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"comment\">//f1的代码</span></span><br><span class=\"line\">    jQuery.publish(<span class=\"string\">\"done\"</span>);</span><br><span class=\"line\">  }, <span class=\"number\">1000</span>)</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"promise-对象\"><a href=\"#promise-对象\" class=\"headerlink\" title=\"promise 对象\"></a>promise 对象</h2><blockquote><p>CommonJS 工作组提出的一种规范，目的是为异步编程提供统一接口</p></blockquote><ul><li>实现机制<ul><li>代理对象：Promise 对象代表一个异步操作</li><li>对象状态：只有异步操作的结果，可以决定 Promise 对象的当前状态</li><li>回调函数：<code>then()</code> 用来注册当 promise 完成或者失败时调用的回调函数</li></ul></li><li>对象状态<ul><li>三种状态：等待 <code>pending</code>、已完成 <code>fulfilled</code>、已失败 <code>rejected</code></li><li>状态改变：只能从 pending 转变为 fulfilled/rejected，而且状态一旦改变就不会再变</li></ul></li><li>主要优势<ul><li>解决回调地狱问题</li><li>更好地进行错误捕获</li></ul></li><li>规范图解<div align=\"center\"><br><img src=\"images/web/promise.png\" alt=\"Promise 规范\"><br></div></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 创建实例</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> promise = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =></span> {</span><br><span class=\"line\">    resolve()</span><br><span class=\"line\">})</span><br><span class=\"line\">promise.then(<span class=\"function\"><span class=\"params\">val</span> =></span> {   <span class=\"comment\">// 抛出错误</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(val)</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>)</span><br><span class=\"line\">}).then(<span class=\"function\"><span class=\"params\">()</span> =></span> {         <span class=\"comment\">// 不会执行</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">111</span>)</span><br><span class=\"line\">}).catch(<span class=\"function\"><span class=\"params\">error</span> =></span> {     <span class=\"comment\">// 接收错误</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(error)</span><br><span class=\"line\">}).then(<span class=\"function\"><span class=\"params\">()</span> =></span> {         <span class=\"comment\">// 继续执行</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">333</span>)</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 语法糖</span></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.resolve(<span class=\"number\">42</span>).then(<span class=\"function\"><span class=\"params\">value</span> =></span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(value);</span><br><span class=\"line\">})  <span class=\"comment\">// 等同于</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =></span> {</span><br><span class=\"line\">    resolve(<span class=\"number\">42</span>)</span><br><span class=\"line\">}).then(<span class=\"function\"><span class=\"params\">value</span> =></span> {</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(value)</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.reject(value) <span class=\"comment\">// 等同于</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>)</span>{</span><br><span class=\"line\">    reject(<span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">\"出错了\"</span>));</span><br><span class=\"line\">});</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 合并多个实例</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timerPromisefy</span>(<span class=\"params\">delay</span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve</span>) </span>{</span><br><span class=\"line\">        setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">            resolve(delay);</span><br><span class=\"line\">        }, delay);</span><br><span class=\"line\">    });</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"comment\">// 当数组中所有 Promise 对象被 resolve 之后，该方法才执行 </span></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.all([</span><br><span class=\"line\">    timerPromisefy(<span class=\"number\">1</span>),</span><br><span class=\"line\">    timerPromisefy(<span class=\"number\">10</span>)</span><br><span class=\"line\">]).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(value);    </span><br><span class=\"line\">});</span><br><span class=\"line\"><span class=\"comment\">// 任何一个 promise 变为 resolve/reject，程序就停止运行</span></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.race([</span><br><span class=\"line\">    timerPromisefy(<span class=\"number\">1</span>),</span><br><span class=\"line\">    timerPromisefy(<span class=\"number\">10</span>)</span><br><span class=\"line\">]).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(value);    </span><br><span class=\"line\">});</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 封装 AJAX 实例</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">get</span>(<span class=\"params\">url</span>) </span>{ </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) </span>{ </span><br><span class=\"line\">        <span class=\"keyword\">var</span> req = <span class=\"keyword\">new</span> XMLHttpRequest() || <span class=\"keyword\">new</span> ActiveXObject(<span class=\"string\">'Microsoft.XMLHTTP'</span>)</span><br><span class=\"line\">        req.open(<span class=\"string\">'GET'</span>, url, <span class=\"literal\">true</span>) </span><br><span class=\"line\">        req.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (req.readyState == <span class=\"number\">4</span> && req.status == <span class=\"number\">200</span>) {</span><br><span class=\"line\">                resolve(req.response)</span><br><span class=\"line\">            } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">                reject(<span class=\"built_in\">Error</span>(req.statusText))</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">        req.onerror = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">            reject(<span class=\"built_in\">Error</span>(<span class=\"string\">\"Network Error\"</span>));</span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">        req.send()</span><br><span class=\"line\">    });</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">get</span>(\"http://something\").then(function (response) {</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(response);</span><br><span class=\"line\">}).catch(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">error</span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(error);</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">// 图片加载完成后播放音乐</span></span><br><span class=\"line\"><span class=\"keyword\">this</span>.loadImg([img, img_1, img_2_1, img_2_2]).then(<span class=\"function\"><span class=\"params\">()</span> =></span> {</span><br><span class=\"line\">  setTimeout(<span class=\"function\"><span class=\"params\">()</span> =></span> {</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.playMusic()</span><br><span class=\"line\">  }, <span class=\"number\">500</span>)</span><br><span class=\"line\">})</span><br><span class=\"line\"><span class=\"keyword\">const</span> loadImg = <span class=\"function\">(<span class=\"params\">img</span>) =></span> {  </span><br><span class=\"line\">    <span class=\"keyword\">const</span> isArray = <span class=\"built_in\">Array</span>.isArray(img)</span><br><span class=\"line\">    <span class=\"comment\">// 参数为单个字符串/数组</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!isArray) {</span><br><span class=\"line\">        <span class=\"keyword\">const</span> oImg = <span class=\"keyword\">new</span> Image()</span><br><span class=\"line\">        oImg.src = img</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =></span> {</span><br><span class=\"line\">            oImg.onload = <span class=\"function\"><span class=\"params\">()</span> =></span> {</span><br><span class=\"line\">                resolve()</span><br><span class=\"line\">            }</span><br><span class=\"line\">        })</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">const</span> arr = []</span><br><span class=\"line\">    img.forEach(<span class=\"function\"><span class=\"params\">val</span> =></span> {</span><br><span class=\"line\">        <span class=\"keyword\">const</span> oImg = <span class=\"keyword\">new</span> Image()</span><br><span class=\"line\">        oImg.src = val</span><br><span class=\"line\">        arr.push(<span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =></span> {</span><br><span class=\"line\">            oImg.onload = <span class=\"function\"><span class=\"params\">()</span> =></span> {</span><br><span class=\"line\">                resolve()</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }))</span><br><span class=\"line\">    })</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.all(arr)</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"async-await-异步函数\"><a href=\"#async-await-异步函数\" class=\"headerlink\" title=\"async/await 异步函数\"></a>async/await 异步函数</h2><blockquote><p>一个用同步思维解决异步问题的方案，代码简洁而且更符合编写习惯</p></blockquote><ul><li>async：表示函数是异步的，定义的函数会隐式返回一个 promise 对象</li><li>await：表示等待后面的异步函数返回结果之后再执行，只能用于 async 函数内部</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// async 异步 </span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>{ <span class=\"keyword\">return</span> <span class=\"string\">\"hello\"</span> }</span><br><span class=\"line\"><span class=\"keyword\">const</span> foo = <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{}</span><br><span class=\"line\"><span class=\"keyword\">const</span> foo = <span class=\"keyword\">async</span> () => {}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(foo());  <span class=\"comment\">// promise 对象</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// await 等待</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> fun = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">time</span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) </span>{</span><br><span class=\"line\">        setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">            resolve(); </span><br><span class=\"line\">        }, time)</span><br><span class=\"line\">    })</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">let</span> funAsync_1 = <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> fun(<span class=\"number\">3000</span>)</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>);</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">let</span> funAsync_2 = <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> funAsync_1()</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">4</span>)</span><br><span class=\"line\">}</span><br><span class=\"line\">funAsync_2()  <span class=\"comment\">// 3、1、2、4</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 错误处理</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> p = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =></span> {</span><br><span class=\"line\">  reject(<span class=\"string\">\"error\"</span>)</span><br><span class=\"line\">})</span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">demo</span>(<span class=\"params\">params</span>) </span>{</span><br><span class=\"line\">  <span class=\"keyword\">try</span> {</span><br><span class=\"line\">      <span class=\"keyword\">let</span> result = <span class=\"keyword\">await</span> p;</span><br><span class=\"line\">  } <span class=\"keyword\">catch</span>(e) {</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(e);</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\">demo()   <span class=\"comment\">// error</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 并行处理</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">count</span>(<span class=\"params\">num</span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">res, rej</span>) =></span> {</span><br><span class=\"line\">        res(num)</span><br><span class=\"line\">    })</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"comment\">// Promise 写法</span></span><br><span class=\"line\">count(<span class=\"number\">100</span>).then(<span class=\"function\"><span class=\"params\">res</span> =></span> {</span><br><span class=\"line\">    <span class=\"keyword\">return</span> count(res + <span class=\"number\">100</span>);</span><br><span class=\"line\">}).then(<span class=\"function\"><span class=\"params\">res</span> =></span> {</span><br><span class=\"line\">    <span class=\"keyword\">return</span> count(res + <span class=\"number\">100</span>);</span><br><span class=\"line\">}).then(<span class=\"function\"><span class=\"params\">res</span> =></span> {</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">})</span><br><span class=\"line\"><span class=\"comment\">// await 写法</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">demo</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 返回一个值</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> res_1 = <span class=\"keyword\">await</span> count(<span class=\"number\">100</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> res_2 = <span class=\"keyword\">await</span> count(res_1 + <span class=\"number\">100</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> res_3 = <span class=\"keyword\">await</span> count(res_2 + <span class=\"number\">100</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res_3;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 返回数组</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">await</span> <span class=\"built_in\">Promise</span>.all([count(<span class=\"number\">100</span>), count(<span class=\"number\">200</span>)])</span><br><span class=\"line\"></span><br><span class=\"line\">}</span><br><span class=\"line\">demo().then(<span class=\"function\"><span class=\"params\">res</span> =></span> {</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 循环处理</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">count</span>(<span class=\"params\">num</span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">res, rej</span>) =></span> {</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(num)</span><br><span class=\"line\">        res(num);</span><br><span class=\"line\">    })</span><br><span class=\"line\">}</span><br><span class=\"line\">(<span class=\"keyword\">async</span> (names) => {</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; names.length; i++) {</span><br><span class=\"line\">        <span class=\"keyword\">await</span> count(names[i])</span><br><span class=\"line\">    }</span><br><span class=\"line\">})([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>])</span><br></pre></td></tr></tbody></table></figure><h1 id=\"五、JS-算法\"><a href=\"#五、JS-算法\" class=\"headerlink\" title=\"五、JS 算法\"></a>五、JS 算法</h1><ul><li>排序算法<ul><li><strong>冒泡排序</strong>：比较任何两个相邻元素，如果第一个比第二个大则交换位置。元素向上移动到正确顺序，类似气泡上升至表面而得名。</li><li><strong>选择排序</strong>：每次从元素中选出最小或最大值，存放在序列的起始位置，以此循环至排序完毕。</li><li><strong>插入排序</strong>：将一个数据插入到已经排好序的有序数据中，从而得到一个新的、个数加一的有序数据，适用于少量数据的排序。</li><li><strong>归并排序</strong>：将原始序列切分成较小的序列直到无法再切分，然后将小序列排序后归并成大序列，直到最后只有一个排序完毕的大序列。</li><li><strong>快速排序</strong>：通过一趟排序将要排序的数据分割成独立的两部分，其中一部分的所有数据都比另外一部分的所有数据都要小，然后再按此方法对这两部分数据分别进行上述递归排序，以此达到整个数据变成有序序列。</li></ul></li><li>搜索算法<ul><li><strong>顺序搜索</strong>：让目标元素与列表中的每一个元素逐个比较，直到找出与给定元素相同的元素为止，缺点是效率低下。</li><li><strong>二分搜索</strong>：在一个有序列表，以中间值为基准拆分为两个子列表，拿目标元素与中间值作比较从而再在目标的子列表中递归此方法，直至找到目标元素。</li></ul></li><li>其他<ul><li><strong>贪心算法</strong>：在对问题求解时，不考虑全局，总是做出局部最优解的方法。</li><li><strong>动态规划</strong>：在对问题求解时，由以求出的局部最优解来推导全局最优解。</li><li><strong>复杂度</strong>：一个方法在执行的整个生命周期所需要占用的时间、空间等资源。</li></ul></li></ul><h2 id=\"冒泡排序\"><a href=\"#冒泡排序\" class=\"headerlink\" title=\"冒泡排序\"></a>冒泡排序</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Array</span>.prototype.bubbleSort = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"keyword\">this</span>.length; i++) {</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> j = <span class=\"number\">0</span>; j &lt; <span class=\"keyword\">this</span>.length - <span class=\"number\">1</span> - i; j++) {</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>[j] &gt; <span class=\"keyword\">this</span>[j + <span class=\"number\">1</span>]) {</span><br><span class=\"line\">                <span class=\"keyword\">let</span> temp = <span class=\"keyword\">this</span>[j]</span><br><span class=\"line\">                <span class=\"keyword\">this</span>[j] = <span class=\"keyword\">this</span>[j + <span class=\"number\">1</span>]</span><br><span class=\"line\">                <span class=\"keyword\">this</span>[j + <span class=\"number\">1</span>] = temp</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"选择排序\"><a href=\"#选择排序\" class=\"headerlink\" title=\"选择排序\"></a>选择排序</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Array</span>.prototype.selectionSort = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">let</span> indexMin</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"keyword\">this</span>.length - <span class=\"number\">1</span>; i++){</span><br><span class=\"line\">        indexMin = i</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> j = i; j &lt; <span class=\"keyword\">this</span>.length; j++){ </span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"keyword\">this</span>[indexMin] &gt; <span class=\"keyword\">this</span>[j]) {</span><br><span class=\"line\">                indexMin = j</span><br><span class=\"line\">            }</span><br><span class=\"line\">        } </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (i !== indexMin){</span><br><span class=\"line\">            <span class=\"keyword\">let</span> aux = <span class=\"keyword\">this</span>[i]</span><br><span class=\"line\">            <span class=\"keyword\">this</span>[i] = <span class=\"keyword\">this</span>[indexMin]</span><br><span class=\"line\">            <span class=\"keyword\">this</span>[indexMin] = aux</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span></span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"插入排序\"><a href=\"#插入排序\" class=\"headerlink\" title=\"插入排序\"></a>插入排序</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Array</span>.prototype.insertionSort = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">let</span> j</span><br><span class=\"line\">    <span class=\"keyword\">let</span> temp</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt; <span class=\"keyword\">this</span>.length; i++) {</span><br><span class=\"line\">        j = i</span><br><span class=\"line\">        temp = <span class=\"keyword\">this</span>[i]</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (j &gt; <span class=\"number\">0</span> && <span class=\"keyword\">this</span>[j - <span class=\"number\">1</span>] &gt; temp) {</span><br><span class=\"line\">            <span class=\"keyword\">this</span>[j] = <span class=\"keyword\">this</span>[j - <span class=\"number\">1</span>]</span><br><span class=\"line\">            j--</span><br><span class=\"line\">        } </span><br><span class=\"line\">        <span class=\"keyword\">this</span>[j] = temp</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.join(<span class=\"string\">', '</span>))</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span></span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"归并排序\"><a href=\"#归并排序\" class=\"headerlink\" title=\"归并排序\"></a>归并排序</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Array</span>.prototype.mergeSort = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">const</span> merge = <span class=\"function\">(<span class=\"params\">left, right</span>) =></span> {</span><br><span class=\"line\">        <span class=\"keyword\">const</span> result = []</span><br><span class=\"line\">        <span class=\"keyword\">let</span> il = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> ir = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span>(il &lt; left.length && ir &lt; right.length) {</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(left[il] &lt; right[ir]) {</span><br><span class=\"line\">                result.push(left[il++])</span><br><span class=\"line\">            } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">                result.push(right[ir++])</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (il &lt; left.length) {</span><br><span class=\"line\">            result.push(left[il++])</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (ir &lt; right.length) {</span><br><span class=\"line\">            result.push(right[ir++])</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">const</span> mergeSortRec = <span class=\"function\"><span class=\"params\">array</span> =></span> {</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (array.length === <span class=\"number\">1</span>) {</span><br><span class=\"line\">            <span class=\"keyword\">return</span> array</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"keyword\">const</span> mid = <span class=\"built_in\">Math</span>.floor(array.length / <span class=\"number\">2</span>)</span><br><span class=\"line\">        <span class=\"keyword\">const</span> left = array.slice(<span class=\"number\">0</span>, mid)</span><br><span class=\"line\">        <span class=\"keyword\">const</span> right = array.slice(mid, array.length)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> merge(mergeSortRec(left), mergeSortRec(right))</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mergeSortRec(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"快速排序\"><a href=\"#快速排序\" class=\"headerlink\" title=\"快速排序\"></a>快速排序</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Array</span>.prototype.quickSort = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">const</span> partition = <span class=\"function\">(<span class=\"params\">array, left, right</span>) =></span> {</span><br><span class=\"line\">        <span class=\"keyword\">var</span> pivot = array[<span class=\"built_in\">Math</span>.floor((right + left) / <span class=\"number\">2</span>)]</span><br><span class=\"line\">        <span class=\"keyword\">let</span> i = left</span><br><span class=\"line\">        <span class=\"keyword\">let</span> j = right</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (i &lt;= j) {</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (array[i] &lt; pivot) {</span><br><span class=\"line\">                i++</span><br><span class=\"line\">            }</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (array[j] &gt; pivot) {</span><br><span class=\"line\">                j--</span><br><span class=\"line\">            }</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (i &lt;= j) {</span><br><span class=\"line\">                <span class=\"keyword\">let</span> aux = array[i]</span><br><span class=\"line\">                array[i] = array[j]</span><br><span class=\"line\">                array[j] = aux</span><br><span class=\"line\">                i++</span><br><span class=\"line\">                j--</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"keyword\">return</span> i</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">const</span> quick = <span class=\"function\">(<span class=\"params\">array, left, right</span>) =></span> {</span><br><span class=\"line\">        <span class=\"keyword\">let</span> index</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (array.length &gt; <span class=\"number\">1</span>) {</span><br><span class=\"line\">            index = partition(array, left, right)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (left &lt; index - <span class=\"number\">1</span>) {</span><br><span class=\"line\">                quick(array, left, index - <span class=\"number\">1</span>)</span><br><span class=\"line\">            }</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (index &lt; right) {</span><br><span class=\"line\">                quick(array, index, right)</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    quick(<span class=\"keyword\">this</span>, <span class=\"number\">0</span>, <span class=\"keyword\">this</span>.length - <span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span></span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"顺序搜索\"><a href=\"#顺序搜索\" class=\"headerlink\" title=\"顺序搜索\"></a>顺序搜索</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Array</span>.prototype.sequentialSearch = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">item</span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"keyword\">this</span>.length; i++) {</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (item === <span class=\"keyword\">this</span>[i]) <span class=\"keyword\">return</span> i</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span></span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"二分搜索\"><a href=\"#二分搜索\" class=\"headerlink\" title=\"二分搜索\"></a>二分搜索</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Array</span>.prototype.binarySearch = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">item</span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.quickSort()</span><br><span class=\"line\">    <span class=\"keyword\">let</span> low = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> mid = <span class=\"literal\">null</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> element = <span class=\"literal\">null</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> high = <span class=\"keyword\">this</span>.length - <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (low &lt;= high){</span><br><span class=\"line\">        mid = <span class=\"built_in\">Math</span>.floor((low + high) / <span class=\"number\">2</span>)</span><br><span class=\"line\">        element = <span class=\"keyword\">this</span>[mid]</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (element &lt; item) {</span><br><span class=\"line\">            low = mid + <span class=\"number\">1</span></span><br><span class=\"line\">        } <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (element &gt; item) {</span><br><span class=\"line\">            high = mid - <span class=\"number\">1</span></span><br><span class=\"line\">        } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">            <span class=\"keyword\">return</span> mid</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span></span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"动态规划\"><a href=\"#动态规划\" class=\"headerlink\" title=\"动态规划\"></a>动态规划</h2><blockquote><p>美国硬币：d1=1, d2=5, d3=10, d4=25，如果要找36美分的零钱，我们可以用 1个25美分、1个10美分和1个便士（ 1美分)<br>最少硬币找零的解决方案是找到 n 所需的最小硬币数</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MinCoinChange</span> </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(coins) {</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.coins = coins</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.cache = {}</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  makeChange(amount) {</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!amount) <span class=\"keyword\">return</span> []</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.cache[amount]) <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.cache[amount]</span><br><span class=\"line\">    <span class=\"keyword\">let</span> min = [], newMin, newAmount</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.coins.forEach(<span class=\"function\"><span class=\"params\">coin</span> =></span> {</span><br><span class=\"line\">        newAmount = amount - coin</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (newAmount &gt;= <span class=\"number\">0</span>) {</span><br><span class=\"line\">            newMin = <span class=\"keyword\">this</span>.makeChange(newAmount)</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (newAmount &gt;= <span class=\"number\">0</span> && </span><br><span class=\"line\">              (newMin.length &lt; min.length - <span class=\"number\">1</span> || !min.length) && </span><br><span class=\"line\">              (newMin.length || !newAmount)) {</span><br><span class=\"line\">            min = [coin].concat(newMin)</span><br><span class=\"line\">        }</span><br><span class=\"line\">    })</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (<span class=\"keyword\">this</span>.cache[amount] = min)</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">const</span> rninCoinChange = <span class=\"keyword\">new</span> MinCoinChange([<span class=\"number\">1</span>, <span class=\"number\">5</span>, <span class=\"number\">10</span>, <span class=\"number\">25</span>])</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(minCoinChange.makeChange(<span class=\"number\">36</span>)) <span class=\"comment\">// [1, 10, 25]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> minCoinChange2 = <span class=\"keyword\">new</span> MinCoinChange([<span class=\"number\">1</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>])</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(minCoinChange2.makeChange(<span class=\"number\">6</span>))  <span class=\"comment\">// [3, 3]</span></span><br></pre></td></tr></tbody></table></figure><h2 id=\"贪心算法\"><a href=\"#贪心算法\" class=\"headerlink\" title=\"贪心算法\"></a>贪心算法</h2><blockquote><p>通过贪心算法得出上述解决方案<br></p><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MinCoinChange</span> </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(coins) {</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.coins = coins</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  makeChange(amount) {</span><br><span class=\"line\">    <span class=\"keyword\">const</span> change = []</span><br><span class=\"line\">    <span class=\"keyword\">let</span> total = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.coins.sort(<span class=\"function\">(<span class=\"params\">a, b</span>) =></span> a &lt; b).forEach(<span class=\"function\"><span class=\"params\">coin</span> =></span> {</span><br><span class=\"line\">        <span class=\"keyword\">while</span> ((total + coin) &lt;= amount) {</span><br><span class=\"line\">          change.push(coin)</span><br><span class=\"line\">          total += coin</span><br><span class=\"line\">        }</span><br><span class=\"line\">    })</span><br><span class=\"line\">    <span class=\"keyword\">return</span> change</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">const</span> rninCoinChange = <span class=\"keyword\">new</span> MinCoinChange ( [ <span class=\"number\">1</span>, <span class=\"number\">5</span>, <span class=\"number\">10</span>, <span class=\"number\">2</span> <span class=\"number\">5</span>])</span><br><span class=\"line\"><span class=\"built_in\">console</span>. log (rninCoinChange. rnakeChange (<span class=\"number\">36</span>))</span><br></pre></td></tr></tbody></table></figure><p></p></blockquote><!-- rebuild by neat --></body></html>","site":{"data":{"next":{"override":false,"cache":{"enable":true},"favicon":{"small":"/images/favicon-16.ico","medium":"/images/favicon-32.ico","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"rss":"/atom.xml","footer":{"since":2019,"icon":{"name":"snowflake-o","animated":false,"color":"#808080"},"copyright":"chuangge","powered":{"enable":false,"version":true},"theme":{"enable":false,"version":true},"beian":{"enable":false,"icp":null}},"creative_commons":{"license":"by-nc-sa","sidebar":false,"post":false},"canonical":true,"seo":false,"index_with_subtitle":false,"exturl":false,"menu":{"home":"/ || home  //首页","tags":"/tags/ || tags  //标签","categories":"/categories/ || th   //分类","archives":"/archives/ || archive //归档"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":{"GitHub":"https://github.com/ || github","StackOverflow":"https://stackoverflow.com/ || stack-overflow"},"social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"友情链接","links_layout":"inline","links":{"个人简历":"https://chuanggefighting.github.io/project/","印记中文":"https://www.docschina.org/","在线工具":"http://tool.lu/","Learn Anything":"https://learn-anything.xyz/"},"avatar":{"url":"/images/chuang.png","rounded":true,"opacity":1,"rotated":true},"toc":{"enable":true,"number":true,"wrap":false,"max_depth":6},"sidebar":{"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"read_more_btn":true,"post_meta":{"item_text":true,"created_at":true,"updated_at":{"enabled":true,"another_day":true},"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":true,"awl":4,"wpm":275},"codeblock":{"border_radius":null,"copy_button":{"enable":false,"show_result":false}},"reward":{"enable":false},"related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_edit":{"enable":false,"url":"https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name"},"disable_baidu_tranformation":false,"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"font":{"enable":true,"host":"//fonts.proxy.ustclug.org","global":{"external":true,"family":"Lato","size":16},"headings":{"external":true,"family":"Roboto Slab","size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":"Lobster Two","size":24},"codes":{"external":true,"family":"Roboto Mono","size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css","copy_tex":{"enable":false,"copy_tex_js":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js","copy_tex_css":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css"}}},"pdf":{"enable":false,"per_page":true,"height":"500px","pdfobject":{"cdn":"//cdn.jsdelivr.net/npm/pdfobject@2.1.1/pdfobject.min.js"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":true,"appid":"snOvapuSplYTVflf5p9Ml9JX-gzGzoHsz","appkey":"5ABGdfyEdAtu6lTXdGdo7hf9","notify":false,"verify":false,"placeholder":"ヾﾉ≧∀≦)o 来呀！吐槽一番吧！","avatar":"mm","guest_info":"nick,mail,link","pageSize":10,"visitor":false,"comment_count":true},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"gitalk":{"enable":false,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true},"needmoreshare2":{"enable":true,"postbottom":{"enable":true,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null,"security":false,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":true,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":true,"pace_theme":"pace-theme-center-simple","canvas_nest":{"enable":true,"onmobile":true,"color":"0,0,255","opacity":0.5,"zIndex":-1,"count":99},"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"canvas_nest_nomobile":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"leancloud":null,"valine":null,"gitalk_js":null,"gitalk_css":null,"md5":null},"css":"css","js":"js","images":"images","passage_end_tag":{"enabled":true},"daovoice":true,"daovoice_app_id":"2ed51855"}}},"excerpt":"","more":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><h1 id=\"一、模块化编程\"><a href=\"#一、模块化编程\" class=\"headerlink\" title=\"一、模块化编程\"></a>一、模块化编程</h1><div style=\"text-indent:2em\">早期引用 JS 文件时直接通过 script 即可，但是随着项目的复杂度越来越大，这种方式带来了 逻辑混乱、可维护性差等问题。为了编写可维护的代码，我们采用将代码合理拆分到不同的文件里，每一个文件就是一个模块，文件路径就是模块名，这种组织代码的方式就是模块化。</div><h2 id=\"优势\"><a href=\"#优势\" class=\"headerlink\" title=\"优势\"></a>优势</h2><ul><li>开发效率高，有利于多人协同开发</li><li>解决项目中的全局变量污染的问题</li><li>功能单一，方便代码的复用和维护</li><li>解决文件依赖问题，无需关注文件引用顺序</li></ul><h2 id=\"JS-环境\"><a href=\"#JS-环境\" class=\"headerlink\" title=\"JS 环境\"></a>JS 环境</h2><ul><li>服务器端<ul><li>相同的代码需要多次执行</li><li>CPU 和内存资源是瓶颈</li><li>加载时从磁盘中加载</li></ul></li><li>浏览器端<ul><li>代码需要从一个服务器端分发到多个客户端执行</li><li>带宽网络是瓶颈</li><li>加载时需要通过网络加载</li></ul></li></ul><h2 id=\"发展进程\"><a href=\"#发展进程\" class=\"headerlink\" title=\"发展进程\"></a>发展进程</h2><ol><li>命名空间形式的代码封装 (函数封装)</li><li>通过 立即执行函数(IIFE) 创建的命名空间</li><li>服务器端运行时 Nodejs 的 CommonJS 规范</li><li>将模块化运行在浏览器端的 AMD/CMD 规范</li><li>兼容 AMD 和 CommonJS 的 UMD 规范</li><li><p>通过语言标准支持的 ES Module</p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 命名空间</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">square</span>(<span class=\"params\">x</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> x !== <span class=\"string\">\"number\"</span>) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x * x;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> utils = &#123;</span><br><span class=\"line\">    add: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x + y</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// IIFE</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"built_in\">module</span> = (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> count = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        inc: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            count += <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        dec: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            count += <span class=\"number\">-1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)()</span><br><span class=\"line\"><span class=\"built_in\">module</span>.inc();</span><br></pre></td></tr></table></figure></li></ol><h2 id=\"CommonJS\"><a href=\"#CommonJS\" class=\"headerlink\" title=\"CommonJS\"></a>CommonJS</h2><blockquote><p>服务器端的模块化开发规范，主要特点是 同步加载模块，Nodejs 的模块规范就是参照它实现的</p></blockquote><div style=\"text-indent:2em\">CommonJS 会在启动时把内置模块和加载过的模块放在本地硬盘，文件读取时不受限于网络而等待时间很短，所以在 Node 环境中使用同步加载的方式不会有很大问题。但是 CommonJS 如果应用在浏览器端，同步加载的机制会使得 JS 阻塞 UI 线程，造成页面卡顿，网速不好时还会导致浏览器假死。</div><h3 id=\"模块定义\"><a href=\"#模块定义\" class=\"headerlink\" title=\"模块定义\"></a>模块定义</h3><div style=\"text-indent:2em\">为了方便，NodeJs 为每个模块提供一个 exports 变量指向 module.exports，相当于在每个模块头部执行 <code>var exports = module.exports</code>。exports 默认是个空对象，可以添加属性和方法但不能被赋值，因为这样会切断了两者联系，而且不能导出需要new实例化的类。使用时建议 module.exports 导出对象和类、exports 导出普通函数和变量</div><ul><li>一个单独的文件就是一个模块</li><li>每个模块都是一个单独的作用域</li><li>每个模块内部都有一个 module 对象来代表当前模块</li><li>暴露模块中的内容可以通过 module.exports、exports</li></ul><h3 id=\"模块加载\"><a href=\"#模块加载\" class=\"headerlink\" title=\"模块加载\"></a>模块加载</h3><ul><li>本质：读取模块内部的 module.exports 变量</li><li>特点<ul><li>缓存结果：模块第一次加载并执行之后就会缓存结果，再次加载时就会直接读取缓存结果，想要再次运行则必须清除缓存</li><li>同步加载：模块加载会阻塞接下来代码的执行，需要等到模块加载完成才能继续执行</li></ul></li><li>方法<ul><li>require()：当前模块中读取其它模块并执行</li><li>require.resolve()：解析模块标识符的绝对路径</li></ul></li></ul><h3 id=\"模块标识\"><a href=\"#模块标识\" class=\"headerlink\" title=\"模块标识\"></a>模块标识</h3><blockquote><p>require() 的参数，require 会根据其格式使用不同的路径加载原则去寻找模块文件</p></blockquote><ul><li>模块名：符合小驼峰命名的字符串<ul><li>核心模块：系统安装目录</li><li>安装模块：node_modules 目录</li></ul></li><li>绝对路径：以 “/“ 开头</li><li>相对路径：以 “./“ 开头</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 导出一个要实例化的类  module.exports = exports = function ()&#123; &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// rocker.js </span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">name, age</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.age = age;</span><br><span class=\"line\">    thisl.about = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name + <span class=\"string\">'is'</span> + <span class=\"keyword\">this</span>.age + <span class=\"string\">'years old'</span>);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 引用</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Rocker = <span class=\"built_in\">require</span>(<span class=\"string\">'./rocker.js'</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> r = <span class=\"keyword\">new</span> Rocker(<span class=\"string\">'Ozzy'</span>, <span class=\"number\">62</span>)</span><br><span class=\"line\">r.about()   <span class=\"comment\">// Ozzy is 62 years old</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 导出一个静态类 exports.funcName = function ()&#123;&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// hello.js</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">hello</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Hello, world'</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">greet</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Hello, '</span> + name + <span class=\"string\">'!'</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 写法一</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    hello: hello,</span><br><span class=\"line\">    greet: greet</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 写法二</span></span><br><span class=\"line\">exports.hello = hello;</span><br><span class=\"line\">exports.greet = greet;</span><br><span class=\"line\"><span class=\"comment\">// 错误写法</span></span><br><span class=\"line\">exports = &#123;</span><br><span class=\"line\">    hello: hello,</span><br><span class=\"line\">    greet: greet</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 引用</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> hello = <span class=\"built_in\">require</span>(<span class=\"string\">'./hello.js'</span>)</span><br><span class=\"line\">hello.hello()  <span class=\"comment\">// Hello, world</span></span><br></pre></td></tr></table></figure><h2 id=\"AMD\"><a href=\"#AMD\" class=\"headerlink\" title=\"AMD\"></a>AMD</h2><blockquote><p>异步模块定义，浏览器端模块化开发规范。它允许异步和按需加载模块，requireJS 是参照它实现的</p></blockquote><h3 id=\"特点\"><a href=\"#特点\" class=\"headerlink\" title=\"特点\"></a>特点</h3><ul><li>异步加载方式，模块加载不影响后面语句的运行<ul><li>实现方式：依赖模块的所有语句都放置在回调函数中并在模块加载完成后执行</li><li>解决问题：js 加载时浏览器会停止页面渲染，加载文件越多则页面失去的响应时间越长</li></ul></li><li>管理模块之间的依赖性，便于代码的编写和维护<ul><li>解决问题：js 文件需要它的被依赖文件早于它加载到浏览器</li></ul></li></ul><h3 id=\"语法\"><a href=\"#语法\" class=\"headerlink\" title=\"语法\"></a>语法</h3><ul><li>模块定义：<code>define(可选模块标识, 依赖模块数组, 模块初始化要执行的函数或对象)</code></li><li><p>模块加载：<code>require(依赖模块数组, 模块加载成功后的回调函数)</code></p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 定义模块 myModule.js</span></span><br><span class=\"line\">define([<span class=\"string\">'dependency'</span>], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> name = <span class=\"string\">'Byron'</span>;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">printName</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        printName: printName</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 加载模块</span></span><br><span class=\"line\"><span class=\"built_in\">require</span>([<span class=\"string\">'myModule'</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">my</span>)</span>&#123;</span><br><span class=\"line\">　 my.printName();</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></li></ul><h2 id=\"CMD\"><a href=\"#CMD\" class=\"headerlink\" title=\"CMD\"></a>CMD</h2><blockquote><p>AMD 基础上改进的一种规范，主要区别是对依赖模块的执行时机处理不同。seaJS 是参照它实现的</p></blockquote><h3 id=\"区别\"><a href=\"#区别\" class=\"headerlink\" title=\"区别\"></a>区别</h3><ul><li>依赖处理<ul><li>AMD 推崇依赖前置，在定义模块时就要声明其依赖的模块</li><li>CMD 推崇就近依赖，只有在用到某个模块时再去 require</li></ul></li><li>方法<ul><li>AMD API 默认是一个当多个用，比如模块加载分为全局的和局部的 require</li><li>CMD 推崇职责单一而且简单，比如模块加载只有 seajs.use()</li></ul></li></ul><h3 id=\"语法-1\"><a href=\"#语法-1\" class=\"headerlink\" title=\"语法\"></a>语法</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 定义模块  index.js</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">require, exports, module</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 使用 exports</span></span><br><span class=\"line\">    exports.name = <span class=\"string\">'index'</span>;</span><br><span class=\"line\">    exports.hello = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'Hello index'</span>);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 使用 module.exports</span></span><br><span class=\"line\">    <span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'index'</span>,</span><br><span class=\"line\">        hello: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(<span class=\"string\">'index'</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 加载模块</span></span><br><span class=\"line\">seajs.use(<span class=\"string\">'index'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">my</span>) </span>&#123;</span><br><span class=\"line\">    my.hello();</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure><h2 id=\"UMD\"><a href=\"#UMD\" class=\"headerlink\" title=\"UMD\"></a>UMD</h2><blockquote><p>兼容 AMD 和 commonJS，提出了跨平台的解决方案</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 无导入导出规范，只有如下的常规写法来检测 JS 环境</span></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">root, factory</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> define === <span class=\"string\">'function'</span> &amp;&amp; define.amd) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// AMD</span></span><br><span class=\"line\">        define([<span class=\"string\">'jquery'</span>], factory);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> exports === <span class=\"string\">'object'</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// CommonJS</span></span><br><span class=\"line\">        <span class=\"built_in\">module</span>.exports = factory(<span class=\"built_in\">require</span>(<span class=\"string\">'jquery'</span>));</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 挂载到全局：root 即 window</span></span><br><span class=\"line\">        root.returnExports = factory(root.jQuery);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;(<span class=\"keyword\">this</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">$</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 方法</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">myFunc</span>(<span class=\"params\"></span>)</span>&#123; &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// 暴露公共方法</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> myFunc;</span><br><span class=\"line\">&#125;));</span><br></pre></td></tr></table></figure><h2 id=\"ES-Module\"><a href=\"#ES-Module\" class=\"headerlink\" title=\"ES Module\"></a>ES Module</h2><blockquote><p>ES6 的最新语法支持规范</p></blockquote><div style=\"text-indent:2em\">CommonJS 和 AMD 规范都只能在运行时确定依赖。而 ES6 在语言层面提出了模块化方案, ES6 module 模块编译时就能确定模块的依赖关系，以及输入和输出的变量。ES6 模块化这种加载称为 编译时加载(异步按需加载)、静态加载。</div><ul><li>导入：<code>import {模块名A，模块名B...} from &#39;模块路径&#39;</code></li><li>导出：<code>export、export default</code></li><li><p>异步加载：<code>import(&#39;模块路径&#39;).then()</code></p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 错误写法 */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> m = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> m;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (x === <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">import</span> MyModual <span class=\"keyword\">from</span> <span class=\"string\">'./myModual'</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 正确写法 */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">var</span> m = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> m = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> &#123;m&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> n = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> &#123;n <span class=\"keyword\">as</span> m&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> n = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> n;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span>(<span class=\"string\">'./myModule.js'</span>)</span><br><span class=\"line\">.then(<span class=\"function\">(<span class=\"params\">&#123;export1, export2&#125;</span>) =&gt;</span> &#123; &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.all([</span><br><span class=\"line\">  <span class=\"keyword\">import</span>(<span class=\"string\">'./module1.js'</span>),</span><br><span class=\"line\">  <span class=\"keyword\">import</span>(<span class=\"string\">'./module2.js'</span>),</span><br><span class=\"line\">  <span class=\"keyword\">import</span>(<span class=\"string\">'./module3.js'</span>),</span><br><span class=\"line\">])</span><br><span class=\"line\">.then(<span class=\"function\">(<span class=\"params\">[module1, module2, module3]</span>) =&gt;</span> &#123; &#125;)</span><br></pre></td></tr></table></figure></li></ul><h1 id=\"二、面向对象编程-OOP\"><a href=\"#二、面向对象编程-OOP\" class=\"headerlink\" title=\"二、面向对象编程 OOP\"></a>二、面向对象编程 OOP</h1><blockquote><p>用对象的思想去写代码，用来定义一个类</p></blockquote><div style=\"text-indent:2em\"><code>字面量方式 和 new Object()</code> 是两种最常用的对象创建方式，但是在使用同一接口创建多个对象时会产生大量重复代码，为了简化代码量并提高可维护性，项目开发时一般使用面向对象写法。</div><h2 id=\"特点-1\"><a href=\"#特点-1\" class=\"headerlink\" title=\"特点\"></a>特点</h2><ul><li>抽象：抓住核心问题</li><li>封装：只能通过对象来访问方法</li><li>继承：从已有对象上继承出新的对象</li><li>多态：多对象的不同形态</li></ul><h2 id=\"实现方式\"><a href=\"#实现方式\" class=\"headerlink\" title=\"实现方式\"></a>实现方式</h2><ul><li><strong>工厂模式</strong>：解决了重复实例化多个对象的问题，但是不能识别各自的实例化对象</li><li><strong>构造函数模式</strong>：把函数当作一个类，实例化时它会隐式创建一个空对象并最后返回<ul><li>建议首字母大写以区分普通函数</li><li>实例化的对象可以通过 instanceof 判断它的实例</li></ul></li><li><strong>原型模式</strong>：好处是可以让 <code>所有对象实例</code> 共享 <code>原型对象</code> 所包含的属性和方法</li><li><strong>混合模式</strong>：可变属性写入构造函数，固定属性和方法写入原型对象，这样可以节省内存</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 工厂模式</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">person</span>(<span class=\"params\">name, age</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> obj = &#123;&#125;;     <span class=\"comment\">// 原料</span></span><br><span class=\"line\">    obj.name = name;  <span class=\"comment\">// 加工</span></span><br><span class=\"line\">    obj.age = age;    </span><br><span class=\"line\">    obj.say = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; </span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name)    </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> obj     </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> p1 = person(<span class=\"string\">\"tom\"</span>, <span class=\"number\">18</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 构造函数模式</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name, age</span>)</span>&#123;     <span class=\"comment\">// 类：模具</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;  </span><br><span class=\"line\">    <span class=\"keyword\">this</span>.age = age;    </span><br><span class=\"line\">    <span class=\"keyword\">this</span>.say = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; </span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name)    </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> p2 = <span class=\"keyword\">new</span> Person(<span class=\"string\">\"tom\"</span>, <span class=\"number\">20</span>);  <span class=\"comment\">// 实例化对象：产品</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(p2 <span class=\"keyword\">instanceof</span> Person);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 原型模式</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\"></span>)</span>&#123;  &#125;</span><br><span class=\"line\">Person.prototype.name = <span class=\"string\">\"tom\"</span>;</span><br><span class=\"line\">Person.prototype.age = <span class=\"number\">24</span>;</span><br><span class=\"line\">Person.prototype.say = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name) </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> p3 = <span class=\"keyword\">new</span> Person()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 混合模式</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name, age</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;   </span><br><span class=\"line\">    <span class=\"keyword\">this</span>.age = age;   </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Person.prototype.say = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> p4 = <span class=\"keyword\">new</span> Person();</span><br></pre></td></tr></table></figure><h1 id=\"三、面向切面编程-AOP\"><a href=\"#三、面向切面编程-AOP\" class=\"headerlink\" title=\"三、面向切面编程 AOP\"></a>三、面向切面编程 AOP</h1><blockquote><p>无侵入地将一个函数插入到另一个函数的前面或后面</p></blockquote><div style=\"text-indent:2em\">主要功能是将日志统计、异常处理等一些跟核心业务逻辑模块无关的功能抽离出来并封装，然后动态插入到业务逻辑模块的指定位置。这样不仅简化了业务逻辑模块，而且方便统一管理功能模块。AOP 其实只是 OOP 的补充，OOP 从横向上区分出一个个的类，AOP 则从纵向上向对象中加入特定的代码。常用场景如下：</div><ul><li>防止 window.onload 被二次覆盖</li><li>给 Ajax 请求动态添加参数</li><li>统计函数的执行时间</li><li>分离表单请求和校验</li><li>职责链模式</li><li>组合替代继承</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// before 切面：让一个函数在另一个函数之前执行</span></span><br><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.before = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> _self = <span class=\"keyword\">this</span>;     <span class=\"comment\">// 保存原函数引用</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">      fn.apply(<span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span>)   <span class=\"comment\">// 执行新函数，修正 this</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> _self.apply(<span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span>);  <span class=\"comment\">// 执行原函数</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// after 切面：让一个函数在另一个函数之后执行</span></span><br><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.after = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> _self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ret = _self.apply(<span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">    fn.apply(<span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ret;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'tangdy'</span>,</span><br><span class=\"line\">  getName: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">obj.getName = obj.getName.before(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"before\"</span>)</span><br><span class=\"line\">&#125;).after(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"after\"</span>)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">obj.getName();</span><br></pre></td></tr></table></figure><h1 id=\"四、异步编程\"><a href=\"#四、异步编程\" class=\"headerlink\" title=\"四、异步编程\"></a>四、异步编程</h1><h2 id=\"回调函数\"><a href=\"#回调函数\" class=\"headerlink\" title=\"回调函数\"></a>回调函数</h2><ul><li>实现：作为参数传递到其它函数执行</li><li>优点：简单、容易理解和部署</li><li>缺点<ul><li>层层嵌套，不利于代码的阅读和维护</li><li>每个任务只能指定一个回调函数</li><li>各个部分之间高度耦合，流程会很混乱</li></ul></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 把同步操作变成异步</span></span><br><span class=\"line\">f1(f2);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f1</span>(<span class=\"params\">callback</span>)</span>&#123;</span><br><span class=\"line\">　　setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">　　　　　callback();</span><br><span class=\"line\">　　&#125;, <span class=\"number\">1000</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"事件监听\"><a href=\"#事件监听\" class=\"headerlink\" title=\"事件监听\"></a>事件监听</h2><ul><li>实现：采用事件驱动模式</li><li>优点<ul><li>容易理解</li><li>可以绑定多个事件</li><li>每个事件可以指定多个回调函数</li><li>可以去耦合，有利于实现模块化</li></ul></li><li>缺点：整个程序变成事件驱动型，运行流程不清晰</li><li>监听函数：on、bind、listen、observe、addEventListener</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// f1 执行完成后立即触发 done 事件从而执行 f2</span></span><br><span class=\"line\">f1.on(<span class=\"string\">\"done\"</span>, f2);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f1</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//f1的代码量</span></span><br><span class=\"line\">    f1.trigger(<span class=\"string\">\"done\"</span>);</span><br><span class=\"line\">  &#125;, <span class=\"number\">1000</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"观察者模式\"><a href=\"#观察者模式\" class=\"headerlink\" title=\"观察者模式\"></a>观察者模式</h2><blockquote><p>即发布订阅模式，它定义了一种一对多的关系</p></blockquote><ul><li>实现：让多个观察者同时对监听某个对象，对象变化会通知多个观察者对象而自动更新</li><li>优点<ul><li>支持简单的广播通信，自动通知所有已经订阅过的对象</li><li>目标对象与观察者之间的抽象耦合关系能够单独扩展以及重用</li><li>页面载入后，目标对象很容易与观察者存在一种动态关联，增加灵活性</li></ul></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// f1 执行完成后向信号中心 jQuery 发布 done 信号，从而引发 f2 的执行</span></span><br><span class=\"line\">jQuery.subscribe(<span class=\"string\">\"done\"</span>, f2);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f1</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//f1的代码</span></span><br><span class=\"line\">    jQuery.publish(<span class=\"string\">\"done\"</span>);</span><br><span class=\"line\">  &#125;, <span class=\"number\">1000</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"promise-对象\"><a href=\"#promise-对象\" class=\"headerlink\" title=\"promise 对象\"></a>promise 对象</h2><blockquote><p>CommonJS 工作组提出的一种规范，目的是为异步编程提供统一接口</p></blockquote><ul><li>实现机制<ul><li>代理对象：Promise 对象代表一个异步操作</li><li>对象状态：只有异步操作的结果，可以决定 Promise 对象的当前状态</li><li>回调函数：<code>then()</code> 用来注册当 promise 完成或者失败时调用的回调函数</li></ul></li><li>对象状态<ul><li>三种状态：等待 <code>pending</code>、已完成 <code>fulfilled</code>、已失败 <code>rejected</code></li><li>状态改变：只能从 pending 转变为 fulfilled/rejected，而且状态一旦改变就不会再变</li></ul></li><li>主要优势<ul><li>解决回调地狱问题</li><li>更好地进行错误捕获</li></ul></li><li>规范图解<div align=\"center\"><br><img src=\"images/web/promise.png\" alt=\"Promise 规范\"><br></div></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 创建实例</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> promise = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    resolve()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">promise.then(<span class=\"function\"><span class=\"params\">val</span> =&gt;</span> &#123;   <span class=\"comment\">// 抛出错误</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(val)</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>)</span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;         <span class=\"comment\">// 不会执行</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">111</span>)</span><br><span class=\"line\">&#125;).catch(<span class=\"function\"><span class=\"params\">error</span> =&gt;</span> &#123;     <span class=\"comment\">// 接收错误</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(error)</span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;         <span class=\"comment\">// 继续执行</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">333</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 语法糖</span></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.resolve(<span class=\"number\">42</span>).then(<span class=\"function\"><span class=\"params\">value</span> =&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(value);</span><br><span class=\"line\">&#125;)  <span class=\"comment\">// 等同于</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> &#123;</span><br><span class=\"line\">    resolve(<span class=\"number\">42</span>)</span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"params\">value</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(value)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.reject(value) <span class=\"comment\">// 等同于</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>)</span>&#123;</span><br><span class=\"line\">    reject(<span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">\"出错了\"</span>));</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 合并多个实例</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timerPromisefy</span>(<span class=\"params\">delay</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve</span>) </span>&#123;</span><br><span class=\"line\">        setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            resolve(delay);</span><br><span class=\"line\">        &#125;, delay);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 当数组中所有 Promise 对象被 resolve 之后，该方法才执行 </span></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.all([</span><br><span class=\"line\">    timerPromisefy(<span class=\"number\">1</span>),</span><br><span class=\"line\">    timerPromisefy(<span class=\"number\">10</span>)</span><br><span class=\"line\">]).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(value);    </span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">// 任何一个 promise 变为 resolve/reject，程序就停止运行</span></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.race([</span><br><span class=\"line\">    timerPromisefy(<span class=\"number\">1</span>),</span><br><span class=\"line\">    timerPromisefy(<span class=\"number\">10</span>)</span><br><span class=\"line\">]).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(value);    </span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 封装 AJAX 实例</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">get</span>(<span class=\"params\">url</span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) </span>&#123; </span><br><span class=\"line\">        <span class=\"keyword\">var</span> req = <span class=\"keyword\">new</span> XMLHttpRequest() || <span class=\"keyword\">new</span> ActiveXObject(<span class=\"string\">'Microsoft.XMLHTTP'</span>)</span><br><span class=\"line\">        req.open(<span class=\"string\">'GET'</span>, url, <span class=\"literal\">true</span>) </span><br><span class=\"line\">        req.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (req.readyState == <span class=\"number\">4</span> &amp;&amp; req.status == <span class=\"number\">200</span>) &#123;</span><br><span class=\"line\">                resolve(req.response)</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                reject(<span class=\"built_in\">Error</span>(req.statusText))</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        req.onerror = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            reject(<span class=\"built_in\">Error</span>(<span class=\"string\">\"Network Error\"</span>));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        req.send()</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">get</span>(\"http://something\").then(function (response) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(response);</span><br><span class=\"line\">&#125;).catch(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">error</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(error);</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">// 图片加载完成后播放音乐</span></span><br><span class=\"line\"><span class=\"keyword\">this</span>.loadImg([img, img_1, img_2_1, img_2_2]).then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">  setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.playMusic()</span><br><span class=\"line\">  &#125;, <span class=\"number\">500</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">const</span> loadImg = <span class=\"function\">(<span class=\"params\">img</span>) =&gt;</span> &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">const</span> isArray = <span class=\"built_in\">Array</span>.isArray(img)</span><br><span class=\"line\">    <span class=\"comment\">// 参数为单个字符串/数组</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!isArray) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> oImg = <span class=\"keyword\">new</span> Image()</span><br><span class=\"line\">        oImg.src = img</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> &#123;</span><br><span class=\"line\">            oImg.onload = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">                resolve()</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> arr = []</span><br><span class=\"line\">    img.forEach(<span class=\"function\"><span class=\"params\">val</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> oImg = <span class=\"keyword\">new</span> Image()</span><br><span class=\"line\">        oImg.src = val</span><br><span class=\"line\">        arr.push(<span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> &#123;</span><br><span class=\"line\">            oImg.onload = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">                resolve()</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;))</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.all(arr)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"async-await-异步函数\"><a href=\"#async-await-异步函数\" class=\"headerlink\" title=\"async/await 异步函数\"></a>async/await 异步函数</h2><blockquote><p>一个用同步思维解决异步问题的方案，代码简洁而且更符合编写习惯</p></blockquote><ul><li>async：表示函数是异步的，定义的函数会隐式返回一个 promise 对象</li><li>await：表示等待后面的异步函数返回结果之后再执行，只能用于 async 函数内部</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// async 异步 </span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123; <span class=\"keyword\">return</span> <span class=\"string\">\"hello\"</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> foo = <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> foo = <span class=\"keyword\">async</span> () =&gt; &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(foo());  <span class=\"comment\">// promise 对象</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// await 等待</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> fun = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">time</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">        setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            resolve(); </span><br><span class=\"line\">        &#125;, time)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> funAsync_1 = <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> fun(<span class=\"number\">3000</span>)</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> funAsync_2 = <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> funAsync_1()</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">4</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">funAsync_2()  <span class=\"comment\">// 3、1、2、4</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 错误处理</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> p = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  reject(<span class=\"string\">\"error\"</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">demo</span>(<span class=\"params\">params</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> result = <span class=\"keyword\">await</span> p;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span>(e) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(e);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">demo()   <span class=\"comment\">// error</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 并行处理</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">count</span>(<span class=\"params\">num</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">res, rej</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        res(num)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// Promise 写法</span></span><br><span class=\"line\">count(<span class=\"number\">100</span>).then(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> count(res + <span class=\"number\">100</span>);</span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> count(res + <span class=\"number\">100</span>);</span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"comment\">// await 写法</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">demo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 返回一个值</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> res_1 = <span class=\"keyword\">await</span> count(<span class=\"number\">100</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> res_2 = <span class=\"keyword\">await</span> count(res_1 + <span class=\"number\">100</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> res_3 = <span class=\"keyword\">await</span> count(res_2 + <span class=\"number\">100</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res_3;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 返回数组</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">await</span> <span class=\"built_in\">Promise</span>.all([count(<span class=\"number\">100</span>), count(<span class=\"number\">200</span>)])</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">demo().then(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 循环处理</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">count</span>(<span class=\"params\">num</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">res, rej</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(num)</span><br><span class=\"line\">        res(num);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">(<span class=\"keyword\">async</span> (names) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &amp;lt; names.length; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">await</span> count(names[i])</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>])</span><br></pre></td></tr></table></figure><h1 id=\"五、JS-算法\"><a href=\"#五、JS-算法\" class=\"headerlink\" title=\"五、JS 算法\"></a>五、JS 算法</h1><ul><li>排序算法<ul><li><strong>冒泡排序</strong>：比较任何两个相邻元素，如果第一个比第二个大则交换位置。元素向上移动到正确顺序，类似气泡上升至表面而得名。</li><li><strong>选择排序</strong>：每次从元素中选出最小或最大值，存放在序列的起始位置，以此循环至排序完毕。</li><li><strong>插入排序</strong>：将一个数据插入到已经排好序的有序数据中，从而得到一个新的、个数加一的有序数据，适用于少量数据的排序。</li><li><strong>归并排序</strong>：将原始序列切分成较小的序列直到无法再切分，然后将小序列排序后归并成大序列，直到最后只有一个排序完毕的大序列。</li><li><strong>快速排序</strong>：通过一趟排序将要排序的数据分割成独立的两部分，其中一部分的所有数据都比另外一部分的所有数据都要小，然后再按此方法对这两部分数据分别进行上述递归排序，以此达到整个数据变成有序序列。</li></ul></li><li>搜索算法<ul><li><strong>顺序搜索</strong>：让目标元素与列表中的每一个元素逐个比较，直到找出与给定元素相同的元素为止，缺点是效率低下。</li><li><strong>二分搜索</strong>：在一个有序列表，以中间值为基准拆分为两个子列表，拿目标元素与中间值作比较从而再在目标的子列表中递归此方法，直至找到目标元素。</li></ul></li><li>其他<ul><li><strong>贪心算法</strong>：在对问题求解时，不考虑全局，总是做出局部最优解的方法。</li><li><strong>动态规划</strong>：在对问题求解时，由以求出的局部最优解来推导全局最优解。</li><li><strong>复杂度</strong>：一个方法在执行的整个生命周期所需要占用的时间、空间等资源。</li></ul></li></ul><h2 id=\"冒泡排序\"><a href=\"#冒泡排序\" class=\"headerlink\" title=\"冒泡排序\"></a>冒泡排序</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Array</span>.prototype.bubbleSort = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &amp;lt; <span class=\"keyword\">this</span>.length; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> j = <span class=\"number\">0</span>; j &amp;lt; <span class=\"keyword\">this</span>.length - <span class=\"number\">1</span> - i; j++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>[j] &amp;gt; <span class=\"keyword\">this</span>[j + <span class=\"number\">1</span>]) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">let</span> temp = <span class=\"keyword\">this</span>[j]</span><br><span class=\"line\">                <span class=\"keyword\">this</span>[j] = <span class=\"keyword\">this</span>[j + <span class=\"number\">1</span>]</span><br><span class=\"line\">                <span class=\"keyword\">this</span>[j + <span class=\"number\">1</span>] = temp</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"选择排序\"><a href=\"#选择排序\" class=\"headerlink\" title=\"选择排序\"></a>选择排序</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Array</span>.prototype.selectionSort = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> indexMin</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &amp;lt; <span class=\"keyword\">this</span>.length - <span class=\"number\">1</span>; i++)&#123;</span><br><span class=\"line\">        indexMin = i</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> j = i; j &amp;lt; <span class=\"keyword\">this</span>.length; j++)&#123; </span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"keyword\">this</span>[indexMin] &amp;gt; <span class=\"keyword\">this</span>[j]) &#123;</span><br><span class=\"line\">                indexMin = j</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (i !== indexMin)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> aux = <span class=\"keyword\">this</span>[i]</span><br><span class=\"line\">            <span class=\"keyword\">this</span>[i] = <span class=\"keyword\">this</span>[indexMin]</span><br><span class=\"line\">            <span class=\"keyword\">this</span>[indexMin] = aux</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"插入排序\"><a href=\"#插入排序\" class=\"headerlink\" title=\"插入排序\"></a>插入排序</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Array</span>.prototype.insertionSort = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> j</span><br><span class=\"line\">    <span class=\"keyword\">let</span> temp</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &amp;lt; <span class=\"keyword\">this</span>.length; i++) &#123;</span><br><span class=\"line\">        j = i</span><br><span class=\"line\">        temp = <span class=\"keyword\">this</span>[i]</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (j &amp;gt; <span class=\"number\">0</span> &amp;&amp; <span class=\"keyword\">this</span>[j - <span class=\"number\">1</span>] &amp;gt; temp) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>[j] = <span class=\"keyword\">this</span>[j - <span class=\"number\">1</span>]</span><br><span class=\"line\">            j--</span><br><span class=\"line\">        &#125; </span><br><span class=\"line\">        <span class=\"keyword\">this</span>[j] = temp</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.join(<span class=\"string\">', '</span>))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"归并排序\"><a href=\"#归并排序\" class=\"headerlink\" title=\"归并排序\"></a>归并排序</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Array</span>.prototype.mergeSort = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> merge = <span class=\"function\">(<span class=\"params\">left, right</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> result = []</span><br><span class=\"line\">        <span class=\"keyword\">let</span> il = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> ir = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span>(il &amp;lt; left.length &amp;&amp; ir &amp;lt; right.length) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(left[il] &amp;lt; right[ir]) &#123;</span><br><span class=\"line\">                result.push(left[il++])</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                result.push(right[ir++])</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (il &amp;lt; left.length) &#123;</span><br><span class=\"line\">            result.push(left[il++])</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (ir &amp;lt; right.length) &#123;</span><br><span class=\"line\">            result.push(right[ir++])</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> mergeSortRec = <span class=\"function\"><span class=\"params\">array</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (array.length === <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> array</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> mid = <span class=\"built_in\">Math</span>.floor(array.length / <span class=\"number\">2</span>)</span><br><span class=\"line\">        <span class=\"keyword\">const</span> left = array.slice(<span class=\"number\">0</span>, mid)</span><br><span class=\"line\">        <span class=\"keyword\">const</span> right = array.slice(mid, array.length)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> merge(mergeSortRec(left), mergeSortRec(right))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mergeSortRec(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"快速排序\"><a href=\"#快速排序\" class=\"headerlink\" title=\"快速排序\"></a>快速排序</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Array</span>.prototype.quickSort = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> partition = <span class=\"function\">(<span class=\"params\">array, left, right</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> pivot = array[<span class=\"built_in\">Math</span>.floor((right + left) / <span class=\"number\">2</span>)]</span><br><span class=\"line\">        <span class=\"keyword\">let</span> i = left</span><br><span class=\"line\">        <span class=\"keyword\">let</span> j = right</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (i &amp;lt;= j) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (array[i] &amp;lt; pivot) &#123;</span><br><span class=\"line\">                i++</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (array[j] &amp;gt; pivot) &#123;</span><br><span class=\"line\">                j--</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (i &amp;lt;= j) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">let</span> aux = array[i]</span><br><span class=\"line\">                array[i] = array[j]</span><br><span class=\"line\">                array[j] = aux</span><br><span class=\"line\">                i++</span><br><span class=\"line\">                j--</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> i</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> quick = <span class=\"function\">(<span class=\"params\">array, left, right</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> index</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (array.length &amp;gt; <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            index = partition(array, left, right)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (left &amp;lt; index - <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                quick(array, left, index - <span class=\"number\">1</span>)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (index &amp;lt; right) &#123;</span><br><span class=\"line\">                quick(array, index, right)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    quick(<span class=\"keyword\">this</span>, <span class=\"number\">0</span>, <span class=\"keyword\">this</span>.length - <span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"顺序搜索\"><a href=\"#顺序搜索\" class=\"headerlink\" title=\"顺序搜索\"></a>顺序搜索</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Array</span>.prototype.sequentialSearch = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">item</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &amp;lt; <span class=\"keyword\">this</span>.length; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (item === <span class=\"keyword\">this</span>[i]) <span class=\"keyword\">return</span> i</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"二分搜索\"><a href=\"#二分搜索\" class=\"headerlink\" title=\"二分搜索\"></a>二分搜索</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Array</span>.prototype.binarySearch = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">item</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.quickSort()</span><br><span class=\"line\">    <span class=\"keyword\">let</span> low = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> mid = <span class=\"literal\">null</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> element = <span class=\"literal\">null</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> high = <span class=\"keyword\">this</span>.length - <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (low &amp;lt;= high)&#123;</span><br><span class=\"line\">        mid = <span class=\"built_in\">Math</span>.floor((low + high) / <span class=\"number\">2</span>)</span><br><span class=\"line\">        element = <span class=\"keyword\">this</span>[mid]</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (element &amp;lt; item) &#123;</span><br><span class=\"line\">            low = mid + <span class=\"number\">1</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (element &amp;gt; item) &#123;</span><br><span class=\"line\">            high = mid - <span class=\"number\">1</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> mid</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"动态规划\"><a href=\"#动态规划\" class=\"headerlink\" title=\"动态规划\"></a>动态规划</h2><blockquote><p>美国硬币：d1=1, d2=5, d3=10, d4=25，如果要找36美分的零钱，我们可以用 1个25美分、1个10美分和1个便士（ 1美分)<br>最少硬币找零的解决方案是找到 n 所需的最小硬币数</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MinCoinChange</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(coins) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.coins = coins</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.cache = &#123;&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  makeChange(amount) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!amount) <span class=\"keyword\">return</span> []</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.cache[amount]) <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.cache[amount]</span><br><span class=\"line\">    <span class=\"keyword\">let</span> min = [], newMin, newAmount</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.coins.forEach(<span class=\"function\"><span class=\"params\">coin</span> =&gt;</span> &#123;</span><br><span class=\"line\">        newAmount = amount - coin</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (newAmount &amp;gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            newMin = <span class=\"keyword\">this</span>.makeChange(newAmount)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (newAmount &amp;gt;= <span class=\"number\">0</span> &amp;&amp; </span><br><span class=\"line\">              (newMin.length &amp;lt; min.length - <span class=\"number\">1</span> || !min.length) &amp;&amp; </span><br><span class=\"line\">              (newMin.length || !newAmount)) &#123;</span><br><span class=\"line\">            min = [coin].concat(newMin)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (<span class=\"keyword\">this</span>.cache[amount] = min)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> rninCoinChange = <span class=\"keyword\">new</span> MinCoinChange([<span class=\"number\">1</span>, <span class=\"number\">5</span>, <span class=\"number\">10</span>, <span class=\"number\">25</span>])</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(minCoinChange.makeChange(<span class=\"number\">36</span>)) <span class=\"comment\">// [1, 10, 25]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> minCoinChange2 = <span class=\"keyword\">new</span> MinCoinChange([<span class=\"number\">1</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>])</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(minCoinChange2.makeChange(<span class=\"number\">6</span>))  <span class=\"comment\">// [3, 3]</span></span><br></pre></td></tr></table></figure><h2 id=\"贪心算法\"><a href=\"#贪心算法\" class=\"headerlink\" title=\"贪心算法\"></a>贪心算法</h2><blockquote><p>通过贪心算法得出上述解决方案<br></p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MinCoinChange</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(coins) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.coins = coins</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  makeChange(amount) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> change = []</span><br><span class=\"line\">    <span class=\"keyword\">let</span> total = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.coins.sort(<span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a &amp;lt; b).forEach(<span class=\"function\"><span class=\"params\">coin</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> ((total + coin) &amp;lt;= amount) &#123;</span><br><span class=\"line\">          change.push(coin)</span><br><span class=\"line\">          total += coin</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> change</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> rninCoinChange = <span class=\"keyword\">new</span> MinCoinChange ( [ <span class=\"number\">1</span>, <span class=\"number\">5</span>, <span class=\"number\">10</span>, <span class=\"number\">2</span> <span class=\"number\">5</span>])</span><br><span class=\"line\"><span class=\"built_in\">console</span>. log (rninCoinChange. rnakeChange (<span class=\"number\">36</span>))</span><br></pre></td></tr></table></figure><p></p></blockquote><!-- rebuild by neat -->"},{"title":"Vue 基础及其项目构建","top":false,"keywords":["vue"],"date":"2019-04-11T16:32:55.000Z","description":"Vue 框架、SPA、SSR、模块引用、基础配置、打包问题、静态服务","_content":"\n# 一、vue 框架\n\n  <div style=\"text-indent: 2em\">Vue 是一套构建用户界面的渐进式 js 框架，它不是一个全能框架而只聚焦于视图层，容易学习和与其它库或已有项目整合。Vue 框架是一个轻量高效的前端组件化方案，它通过简洁的 API 提供高效的数据驱动的组件系统，通过操作数据来实现页面的更新与展示。</div> \n\n  * 核心思想：`数据驱动的组件系统`\n  * 开发理念：`渐进式开发、只关注视图层、组件化、响应式`\n    * 渐进式开发：先构建基础的用户界面，然后再根据需求灵活添加功能\n    * 响应式：一个网页，根据不同的分辨率改变网页大小\n    * 适应式：多个不同的网页，根据不同的分辨率自动选择不同页面\n  * [开源项目库](https://segmentfault.com/p/1210000008583242/read?from=timeline)\n\n\n## MVVM 模式\n  * __Model__：对应 js 对象的数据部分\n  * __View__：对应 DOM 元素的视图部分\n  * __Viewmodel__：绑定数据和 DOM 的中间件\n\n  <div align=\"center\"> \n    ![Vue MVVM](images/vue/vue_bing.png) \n  </div> \n\n  <div style=\"text-indent: 2em\">DOM Listeners、Data Bindings 是实现双向绑定功能的关键，实现原理是Object.defineProperty 中的 get、set 方法 和消息订阅模式。DOM Listeners 监听页面所有 View 层 DOM 元素的变化，发生变化时 Model 层的数据随之变化。Data Bindings 监听 Model 层的数据，数据发生变化时 View 层的 DOM 元素随之变化。</div> \n\n  ```js\n  // 对数据对象的每个属性添加对应的 get、set 方法 \n  Object.defineProperty(data, key, {\n      enumerable: true,\n      configurable: true,\n      // 读取数据时调用\n      get: function() {\n\n          // do something\n\n          return val;\n      },\n      // 对数据进行赋值操作时调用\n      set: function(newVal) {\n\n          // do something\n      }\n  });\n  ```\n\n\n## 全家桶\n> vue 项目的核心构成\n\n  * __vue-cli__：快速搭建大型单页应用的脚手架工具\n    * 自动生成 Vue 项目的目录和文件，\n    * 通过热加载方式快速启动项目\n    * 利用本地 node 服务器实现页面的实时刷新效果\n  * __vue-router__：路由控制工具\n    * 用于配置路径和组件的映射关系\n    * 通过路径之间的切换而不是传统的超链接方式来实现页面切换\n  * __vuex__：状态管理工具\n    * 为了解决多个组件间的数据通信和状态管理的维护问题而产生\n    * 采用集中存储的方式统一管理项目中所有组件的状态 (组件通信的数据)\n  * __axios__：异步通信工具\n    * 基于Promise的 HTTP 请求客户端\n    * 可以同时在浏览器和 nodejs 中使用\n\n\n\n# 二、浏览器渲染 SPA\n> 将浏览器中直接生成和操作 DOM 的单页面应用程序\n\t\t\n  <div style=\"text-indent: 2em\">整个项目只有 index.html 一个完整页面，页面内容是通过不同的 vue 组件拼接后生成代码片段并添加到该页面的标签中展示出来。src/App.vue 是所有组件的父组件，所有其它组件都通过路由渲染到它的 router-view，然后再将 App.vue 渲染到 index.html。</div> \n\t\t\t\t\t\t\n\t\t\t\t\n## 单页面项目\n\n  ```js\n  // 构建流程\n  cnpm install vue webpack vue-cli -g   \n\n  cd workspace\n  vue init webpack project  // 生成目录 \n  cd project && npm i       // 安装依赖包\n\n  npm start                 // 热加载启动服务\n  npm run build             // 打包生成静态文件\n\n\n  // App.vue，兼容 pc 和移动端方案\n  export default {\n    name: \"App\",\n    created(){\n      if(document.documentElement.clientWidth > 640){\n          require('./style/pc.scss'); \n          this.plaform = 'pc';     // 父类类名为 .pc\n      }else{\n          require('./style/mobile.scss'); \n          this.plaform = 'mobile';  // 父类类名为.mobile\n      }\n    }\n  }\n\n  // 项目目录\n  ├── README.md              // 说明文档\n  ├── node_modules           // 项目依赖包\n  ├── .editorconfig          // 定义代码格式\n  ├── .babelrc 　            // ES6 语法编译配置\n  ├── .postcssrc.js          // css 代码转换配置\n  ├── .gitignore             // git 上传需要忽略的文件格式\n  ├── .eslintrc.js           // eslint 是管理和检测 js 代码风格\n  |\n  ├── index.html             // 项目入口文件\n  ├── package.json           // 项目基本信息\n  ├── package-lock.json      // 优化性能的新增文件\n  │\n  ├── build                  // webpack 编译打包配置\n  │   ├── build.js                 // 打包执行文件\n  │   ├── check-versions.js        // 检查 node、npm 等版本\n  │   ├── utils.js                 // 构建常用工具\n  │   ├── vue-loader.conf.js       // css 加载器配置\n  │   ├── webpack.base.conf.js     // 基础配置\n  │   ├── webpack.dev.conf.js      // 开发环境\n  │   └── webpack.prod.conf.js     // 生产环境\n  │\n  ├── config                // 项目配置\n  │   ├── dev.env.js               // 开发环境\n  │   ├── prod.env.js              // 生产环境\n  │   └── index.js                 // 基础配置\n  │\n  ├── src                   // 项目源码\n  │   ├── App.vue                  // 根组件\n  │   ├── main.js      \t\t\t       // 主配置文件\n  │   ├── assets                   // 需要打包的项目静态资源\n  │   │    └── img/js/css\n  │   ├── components               // 公共组件目录                 \n  │   │    └── common/page                     \n  │   │            \n  │   ├── router           // 路由配置\n  │   │    └── index.js           \n  │   │\n  │   └── vuex             // Vuex store相关\n  │        ├── index.js\n  │        ├── action.js             \n  │        ├── getter.js           \n  │        └── mutation.js \n  │\n  └── static              // 不需要打包的外部插件、公共库等资源\n      └── css/js/font           \n  ```\n\n## 多页面项目\n\n  ```js\n  // 目录调整\n  src\n  ├── assets\n  ├── components \n  └── pages\n        ├── index\n        │    ├── App.vue\n        │    ├── index.html\n        │    └── index.js\n        |\n        └── login\n            ├── Login.vue\n            ├── login.html\n            └── login.js\n\n\n  // 修改webpack配置\n  \n  // 1、utils.js 末尾添加\n  /* 添加部分 ---------------------------- 开始 */\n\n  // glob 模块用于路径匹配配置 (使用 * 等符号)，安装后引用：npm i glob -S \n  var glob = require('glob')\n  var HtmlWebpackPlugin = require('html-webpack-plugin')  // 页面模板\n  var PAGE_PATH = path.resolve(__dirname, '../src/pages')  // 页面路径\n  var merge = require('webpack-merge')    // merge处理\n\n  // 多入口配置：如果 pages 中存在 js 文件就存在就作为入口处理\n  exports.entries = function () {\n    var entryFiles = glob.sync(PAGE_PATH + '/*/*.js')\n    var map = {}\n    entryFiles.forEach((filePath) => {\n        var filename = filePath.substring(filePath.lastIndexOf('\\/') + 1, filePath.lastIndexOf('.'))\n        map[filename] = filePath\n    })\n    return map\n  }\n\n  // 多页面输出配置\n  exports.htmlPlugin = function () {\n    let entryHtml = glob.sync(PAGE_PATH + '/*/*.html')\n    let arr = []\n    entryHtml.forEach((filePath) => {\n        let filename = filePath.substring(filePath.lastIndexOf('\\/') + 1, filePath.lastIndexOf('.'))\n        let conf = {\n            template: filePath,  // 模板来源\n            filename: filename + '.html',   // 文件名称\n            // 页面模板需要添加对应的 js 脚本，不加则每个页面都会引入所有 js 脚本\n            chunks: ['manifest', 'vendor', filename],\n            inject: true\n        }\n        if (process.env.NODE_ENV === 'production') {\n            conf = merge(conf, {\n                minify: {\n                    removeComments: true,\n                    collapseWhitespace: true,\n                    removeAttributeQuotes: true\n                },\n                chunksSortMode: 'dependency'\n            })\n        }\n        arr.push(new HtmlWebpackPlugin(conf))\n    })\n    return arr\n  }\n  /* 添加部分 ---------------------------- 结束 */\n\n\n  // 2、webpack.base.conf.js 修改\n  entry: utils.entries(),  \n\n  // 3、webpack.dev.conf.js、webpack.prod.conf.js\n  plugins: [\n      /* 注释 ------------- 开始 */\n      // new HtmlWebpackPlugin({\n      //   filename: \n      // }),\n      /* 注释 ------------- 结束 */\n\n      /* 添加 ------------------ */\n  ].concat(utils.htmlPlugin())\n\n\n  // 初始化页面\n  // 1、index.js\n  import index from './App.vue'\n  new Vue({\n    el: '#app',\n    router,\n    components: { index },\n    template: '&lt;index/&gt;'\n  })\n\n  // 2、login.js\n  import LoginView from './Login.vue'\n  new Vue({\n    el: '#app',\n    render: h => h(LoginView)\n  })\n\n  // 3、index.html 页面跳转：a href='login.html'\n  ```\n\n\n## 首屏加载优化\n\n  * 首屏加载效果\n    * 页面内容加载完成前使用 loading、进度条、骨架屏 可以提升用户体验\n    * 骨架屏：vue-skeleton 使用一些空白内容的图形来展示未加载内容  \n  * 路由懒加载\n    * `const login = resolve => require(['common/Login.vue'], resolve)`\n  * 使用 v-if 减少不必要的组件加载：显示时才渲染弹窗等组件\n  * 通过 CDN 引入资源，减小服务器带宽压力\n    * 项目依赖会被全部打包到 vender.js，文件很大时首屏加载较慢\n    * 使用 cdn 文件代替就不会被打包进去，加载速度较快\n  * 将图片等一些静态资源放到云服务器，减小服务器压力\n  * 需加载三方资源：按需引入 ElementUI 等组件库\n  * 若首屏为登录页则可做成多入口\n  * webpack 开启 gzip 压缩\n\n          \n## 预渲染\n> 在构建阶段简单地生成生成匹配特定路由的静态 html 文件\n\n  * 插件安装：`npm i prerender-spa-plugin -S`\n  * 插件配置：`build/webpack.prod.conf.js`\n  * 路由配置：`route/index.js`\n\n  ```js\n  // build/webpack.prod.conf.js\n  const PrerenderSPAPlugin = require('prerender-spa-plugin')\n  const Renderer = PrerenderSPAPlugin.PuppeteerRenderer\n\n  const webpackConfig = merge(baseWebpackConfig, {\n      plugins: [\n          new PrerenderSPAPlugin({\n              // 生成文件的路径，该目录只能有一级，\n              // vue-cli3.0 时修改为 '/dist'\n              staticDir: path.join(__dirname, '../dist'),\n              \n              // 路由文件，如果有参数则比如 /index/\n              routes: ['/', '/index', '/home'],\n              \n              // 没有配置则不会进行预编译\n              renderer: new Renderer({\n                  inject: {\n                    foo: 'bar'\n                  },\n                  headless: false,\n                  renderAfterDocumentEvent: 'render-event'\n              })\n          })\n      ]\n  })\n\n  // route/index.js\n  export default new Router({\n      mode: 'history', \n      routes: []\n  })\n  ```\n\n\n# 三、服务器端渲染 SSR\n> 服务端拼接出带数据的 html 并发送到前端，前端把 html 插入到指定节点并渲染页面\n\n  <div style=\"text-indent: 2em\">Vue 是一个构建客户端应用的框架，即 vue 组件是在浏览器中进行渲染的。所谓服务端渲染，是指 Vue 服务端通过预拉取数据实现组件的初始化，然后启用虚拟 DOM 渲染为初始化的 HTML 字符串并发送到客户端，最后需要将这些静态标记\"激活\"为客户端上完全可交互的应用程序，从而实现前后端同构应用。服务器和客户端都会运行的代码为 通用代码，即 同构。</div> \n\n  * 优点\n    * 更好的SEO，搜索引擎爬虫可以抓取渲染好的页面\n    * 更快的首屏渲染时间，产生更好的用户体验，无需等待 Js 加载完成后才显示\n  * 缺点 \n    * 更多的服务器端负载（CPU 和内存资源）\n    * 更复杂的开发和部署（兼容 Node 执行环境）\n\n\n## 渲染过程\n\n  * 利用 webpack 需要分别对客户端代码和服务器端代码分别打包成两个 json 文件\n  * server-bundle 发送给服务器用于生成首屏页面 html\n  * client-bundle 发送给浏览器用于混合静态标记\n  * server.js 文件将两个打包文件和 HTML 模板混合生成 HTML 返回给浏览器渲染\n\n  <div align=\"center\"> \n    ![Vue SSR](images/vue/vue-ssr.png)\n  </div> \n\n\t\t\t\t \n## 开发约束\n> 通用代码应该兼容浏览器和服务端 Node 的执行环境\n  \n  * 不可使用全局环境变量：window、document 等只能在浏览器中运行\n  * 生命周期钩子函数只有 beforeCreate、created 能同时运行在前后端\n  * 避免状态单例\n    * Node 服务器是一个长期运行的进程，代码进入该进程时就会取值并留存在内存。如果创建一个实例对象，它将在每个传入的请求之间共享，容易导致交叉请求状态污染。所以应该暴露一个可以重复执行的工厂函数，为每个请求创建新实例\n    * 同样的规则也适用于 router、store、event bus 实例。你不应该直接从模块导出并将其导入到应用程序中。而是需要在 createApp 中创建一个新实例并从根实例注入\n    \n     \n## 模板插值\n\n### 安装模块\n\t\n  * 安装：`cnpm i vue vue-server-renderer koa koa-router -S`\n  * vue-server-renderer：获取 vue 实例并渲染成 html 结构，并配合 webpack 构建项目\n\n\n### 单个文件 \n  <div align=\"center\"> \n    ![vue-server-renderer](images/vue/vue-render-1.png)\n  </div> \n  \n\n### 目录文件\n  \n  <div align=\"center\"> \n    ![vue-render-index](images/vue/vue-render-2.png)\n  </div> \n  \n\n  ```js\n  // server.js\n  const Vue = require('vue')\n  const Koa = require('koa')\n  const Router = require('koa-router')\n  const renderer = require('vue-server-renderer').createRenderer({\n    template: require('fs').readFileSync('./index.html', 'utf-8')\n  }) \n\n  // 1、创建 koa、koa-router 实例\n  const app = new Koa()\n  const router = new Router()\n\n  // 2、路由中间件\n  router.get('*', async (ctx, next) => {\n    // 渲染上下文对象：title、meta 会插入模板中\n    const context = {\n      title: ctx.url,\n      meta: `\n        &lt; meta charset=\"UTF-8\" &gt;\n        &lt; meta name=\"description\" content=\"基于webpack、koa搭建的SSR\" &gt;\n      `\n    }\n\n    // 创建Vue实例\n    const vue_app = new Vue({\n      data: {\n        url: ctx.url\n      },\n      template: `{{ url }}`\n    })\n\n    // 有错误返回 500，无错误返回 html\n    try {\n      const html = await renderer.renderToString(vue_app, context)\n      ctx.status = 200\n      // html 结构会插入到 template 中的 !--vue-ssr-outlet-->\n      ctx.body = html\n    } catch (error) {\n      ctx.status = 500\n      ctx.body = 'Internal Server Error'\n    }\n  })\n  app.use(router.routes()).use(router.allowedMethods())\n\n  // 3、启动服务\n  app.listen(3000, () => {\n    console.log(`server started at localhost:3000`)\n  })\n  ```\n\n\n### 结果分析\n\t\t\t\t\t\t\t\t\n  * SPA：前端打包后的 html 只包含 head 部分，body 部分都是动态插入到 `div id = \"app\"`\n  * SSR：服务器提前编译 Vue 资源生成 HTML 并返回给浏览器，这样网络爬虫爬取的内容就是网站上所有可呈现的内容\n\n\n\n## 项目构建\n> vue-ssr 代码库  \n\n### 基础构建\n  * webpack 配置\n    * 新增：`webpack.server.conf.js`\n    * 修改：`vue-loader.conf.js、webpack.base/prod.conf.js`\n  * 入口配置：`main.js、entry-client.js、entry-server.js`\n  * 组件修改\n    * 修改 router 路由文件，给每个请求一个新的 router 实例\n    * 修改状态管理 vuex 文件，给每个请求一个新的 store 实例\n    * 通过 asyncData 方法获取异步数据\n  * 服务器配置\n    * 根目录新建 server.js 文件\n    * 修改 package.json 文件\n    * 修改 index.html 文件\n  * 启动项目\n    * 安装依赖：`cnpm install` \n    * 打包文件：`npm run build`\n    * 启动服务：`node server.js`   \n\n\n### 服务端预拉取数据\n\n  <div style=\"text-indent: 2em\">如果应用程序依赖于一些异步数据，那么在开始渲染过程之前，需要先预取和解析好这些数据，并将数据拼装到全局 Vuex状态中。但是需要注意：在挂载到客户端应用程序之前，需要获取到与服务器端应用程序完全相同的数据，否则 客户端应用程序会因为使用与服务器端应用程序不同的状态 导致混合失败。</div>\n  <div style=\"text-indent: 2em\">目前较好的解决方案是：给路由匹配的一级子组件一个 asyncData 方法，asyncData 是约定的函数名，表示渲染组件需要预先执行它获取初始数据，它返回一个 Promise，以便后端渲染时可以知道什么时候该操作完成。注意，由于此函数会在组件实例化之前调用，所以它无法访问 this，需要将 store 和路由信息作为参数传递进去。</div> \n\t\t\t\t\t\t\t\t\t\n\n\n# 四、模块引用\n\n## npm 安装的模块\n> 默认全局引用，局部引用就是在组件中按需引用\n\n### 常用模块\n\n  * 安装：`cnpm install axios vuex element-ui vue-awesome-swiper echarts -S`\n    * -D / --save: 生产环境还要用到的包 (package.json/dependencies )\n    * -S / --save-dev: 只在开发环境用到的包 (package.json/devDependencies)\n  * 配置\n    ```js\n    // main.js \n\n    // axios\n    import axios from 'axios'\n    Vue.prototype.$axios = axios\n\n    // 自定义配置 axios\n    import ajax from './axios/http'\n    Vue.prototype.$get = ajax.get\n    Vue.prototype.$post = ajax.post\n\n    // 组件库\n    import ElementUI from 'element-ui'\n    import 'element-ui/lib/theme-chalk/index.css'\n    Vue.use(ElementUI)\n\n    // 轮播插件\n    import VueAwesomeSwiper from 'vue-awesome-swiper'\n    import 'swiper/dist/css/swiper.css'\n    Vue.use(VueAwesomeSwiper)\n\n    // 图表插件\n    import echarts from \"echarts\"\t\t\n    Vue.prototype.$echarts = echarts \n\n    // vuex\n    import store from './vuex/index'\n    new Vue({\n      el: '#app',\n      router,\n      store,\n      data: {\n        // 根组件的空实例\n        eventHub: new Vue()\n      }\n    })\n    ```\n\n\t\t\t\t\n### Sass\t\t\t\t\t\t\n  * 安装：`cnpm install sass-loader node-sass css-loader -S`\n  * 使用：`style lang=\"scss\" scoped`\n  * 配置\n    ```js\n    // build/webpack.base.conf.js\n    module.exports = {\n      resolve: {\n        // 添加扩展名 .scss\n        extensions: ['.js', '.vue', '.json', '.scss'],\n      },\n      module: {\n        rules: {\n          // 最后添加\n          {  \n            test: /\\.scss$/,  \n            loaders: ['style', 'css', 'sass']  \n          }\n        }\n      }\n    }\n    ```\n\n\n### 对象展开运算符 \n  * 安装：`cnpm install babel-plugin-transform-object-rest-spread -S`\n  * 使用：`...mapGetters([ 'count' ])`\n  * 配置：`.babelrc 文件 -- \"plugins\": [\"transform-object-rest-spread\"]`\n\n\n### 集成 Ace 代码编辑器\n  * 安装：cnpm install ace-builds -S\n  * 配置：[Vue Ace](https://blog.csdn.net/YoshinoNanjo/article/details/82978668)\n\n\n## npm 不能安装的插件\n> 直接引入插件文件\n\n  * index.html：`script src=\"/static/bootstrap.min.js\"`\n  * main.js：`import '@/assets/css/bootstrap.min.css'`\n\n\n## 静态资源\n\n### global.scss\n  * 安装：cnpm install sass-resources-loader --save-dev\n  * 注意：如果要导入多个文件则全部导入到 global.scss：@import './reset.scss'\n  * 配置 \n\n  ```js\n  // build/utils.js -- scss: generateLoaders('sass') \n  scss: generateLoaders('sass').concat(\n    {\n      loader: 'sass-resources-loader',\n      options: {\n        resources: path.resolve(__dirname, '../src/assets/global.scss')\n      }\n    }\n  )\n  ```\n\n\n### 静态文件\n  * js：`import user from '@/components/user'`\n  * css\n    * `@import './swiper.css'`\n    * `@import '../../assets/scss/mixin.scss'`\n    * `@import url('../assets/css/reset.css')`\n  * template\n    * 绝对路径：`img src='/static/images/logo.png'`    \n    * 相对路径：`img src='../../assets/images/1.png'`  \n\t\t\t\t\t\t\t\t\t\n\n \n# 五、基础配置\n\n## 快捷键\n  ```json\n  // package.json文件\n  \"scripts\": {\n      \"build\": \"node build/build.js\",\n      \"start\": \"rimraf dist && npm run build\"\n  }\n  ```\n\n\n## 路径别名\n> 用于以后引用路径时减少复杂度：import getList from 'api/index'\n\n  ```js\n  // build/webpack.base.conf.js\n  resolve: {\n    alias: {\n      'vue$': 'vue/dist/vue.esm.js',\n      '@': resolve('src'),\n      'api': path.resolve(__dirname, '../src/api')\n    }\n  }\n  ```\n\n\t\t\n## 代码调试\n  * 开发工具：Chrome vue-devtools\n  * debugger 模式：修改 config/index.js 文件 `devtool: '#eval-source-map'`\n\n## 手机查看\n> 将手机连接到与电脑相同的 Wifi\n\n  1. config/index.js -- dev/host：当前电脑的IP地址\n  2. 重新启动服务后，在手机上直接打开地址，或者转为二维码之后使用手机扫描\n\n\t\t\n## 请求代理\n> 服务器代理网络用户去获取网络信息，可以解决开发环境中的跨域问题\n\n  ```js\n  // config/index.js\n  dev: {  \n    proxyTable: {   \n      '/ajaxUrl': {      // 请求地址\n          target: 'http://cangdu.org:8000/', // 实际映射到的目标地址\n          changeOrigin: true,                // 是否跨域\n          secure: false,                     // https 接口需要配置\n          pathRewrite: {\n              '^/ajaxUrl': ''                // target 地址的别名\n          }\n      } \n    }  \n  }\n  ```\n\n\t\t\n## 全局接口\n> 开发环境和生产环境配置不同接口\n\n  ```js\n  // config/dev.env.js \n  module.exports = merge(prodEnv, {\n      NODE_ENV: '\"development\"',\n      API_ROOT: '\"http://10.148.221.210:5000/\"',\n      WS_ROOT: '\"ws://10.148.221.210:5001\"'\n  })\n\n\n  // config/prod.env.js \n  module.exports = {\n      NODE_ENV: '\"production\"',\n      API_ROOT: '\"http://10.148.134.54:5000/\"',\n      WS_ROOT: '\"ws://10.148.134.54:5001\"'\n  }\n\n\n  // axios baseURL\n  axios.defaults.baseURL = process.env.API_ROOT\n\n  // 组件 url\n  this.websocket = new WebSocket(process.env.WS_ROOT) \n  ```\n\n\n# 六、打包问题\n> npm run build 执行打包操作后生成 dist 文件夹  \n\n## 资源路径\n> 打包后资源加载错误，因为绝对路径加载的资源打包后会报错\n\n  * static 目录\n    * 特点：文件不会被 wabpack 编译处理，会被直接复制到打包目录\n    * 使用方式\n      * HTML 使用相对路径：`../static/images/bg.png`\n      * JS 使用打包后路径：`./static/images/bg.png`\n      * CSS 使用根目录路径：`../../static/images/bg.png`\n  * assets 目录\n    * 文件会经过 webpack 打包并重新编译，一般只能使用相对路径\n    * 图片等不能用于动态绑定 因为 webpack 使用 ` commenJS ` 规范而必须使用 require\n\n\n  ```js\n  // 文件 config/index.js  \n  build: {\n    assetsSubDirectory: './static',// 解决 css 路径问题\n    assetsPublicPath: './',      // 解决 js 路径问题\n    productionSourceMap: false   // 加快编译速度\n  }\n\n  // 静态资源 build/utils.js  \n  if (options.extract) {\n    return ExtractTextPlugin.extract({\n      use: loaders,\n      publicPath:'../../',   // 打包时提取 CSS\n      fallback: 'vue-style-loader'\n    })\n  }\n  ```\n\n\n## 路由模式\n> history 路由模式的项目打包后的页面没有渲染\n\n  * 使用hash模式\n  * 设置routes里的路由name \n\n\t\t\t\n## IE 浏览器\n> 打包后在 IE 浏览器不显示\n\n* 原因：Promise在ie上的支持不是很好导致的\n* 解决\n  * 安装插件：cnpm install --save-dev babel-polyfill\n  * main.js 引入：import 'babel-polyfill'   \n  * 配置\n    ```js\n    // build/webpack.base.conf.js\n    module.exports = {\n      entry: {\n        app: [\"babel-polyfill\", \"./src/main.js\"]  \n      }\n    }\n    ```\n          \n\n## favicon.ico \n> 地址栏左边的图标文件无法加载，它是代表网站的标志 \n\n  * 问题：打印台报错，原因是图标文件不存在或路径错误\n  * index.html：`link rel=\"shortcut icon\" type=\"image/x-icon\" href=\"favicon.ico\"`\n\n\n# 七、静态服务\n> 打包后快速搭建静态服务器\n\n  * 全局安装：`npm install -g live-server / http-server`\n  * 运行项目：`live-server / http-server`\n  * 快捷命令：`\"script\":{ \"server\":\"live-server ./dist --port=8080\" }`\n \n\n","source":"_posts/13-vue基础.md","raw":"---\ntitle: Vue 基础及其项目构建\ntags:\n  - Vue.js\ncategories: Vue.js\ntop: false\nkeywords:\n  - vue\ndate: 2019-04-12 00:32:55\ndescription: Vue 框架、SPA、SSR、模块引用、基础配置、打包问题、静态服务\n---\n\n# 一、vue 框架\n\n  <div style=\"text-indent: 2em\">Vue 是一套构建用户界面的渐进式 js 框架，它不是一个全能框架而只聚焦于视图层，容易学习和与其它库或已有项目整合。Vue 框架是一个轻量高效的前端组件化方案，它通过简洁的 API 提供高效的数据驱动的组件系统，通过操作数据来实现页面的更新与展示。</div> \n\n  * 核心思想：`数据驱动的组件系统`\n  * 开发理念：`渐进式开发、只关注视图层、组件化、响应式`\n    * 渐进式开发：先构建基础的用户界面，然后再根据需求灵活添加功能\n    * 响应式：一个网页，根据不同的分辨率改变网页大小\n    * 适应式：多个不同的网页，根据不同的分辨率自动选择不同页面\n  * [开源项目库](https://segmentfault.com/p/1210000008583242/read?from=timeline)\n\n\n## MVVM 模式\n  * __Model__：对应 js 对象的数据部分\n  * __View__：对应 DOM 元素的视图部分\n  * __Viewmodel__：绑定数据和 DOM 的中间件\n\n  <div align=\"center\"> \n    ![Vue MVVM](images/vue/vue_bing.png) \n  </div> \n\n  <div style=\"text-indent: 2em\">DOM Listeners、Data Bindings 是实现双向绑定功能的关键，实现原理是Object.defineProperty 中的 get、set 方法 和消息订阅模式。DOM Listeners 监听页面所有 View 层 DOM 元素的变化，发生变化时 Model 层的数据随之变化。Data Bindings 监听 Model 层的数据，数据发生变化时 View 层的 DOM 元素随之变化。</div> \n\n  ```js\n  // 对数据对象的每个属性添加对应的 get、set 方法 \n  Object.defineProperty(data, key, {\n      enumerable: true,\n      configurable: true,\n      // 读取数据时调用\n      get: function() {\n\n          // do something\n\n          return val;\n      },\n      // 对数据进行赋值操作时调用\n      set: function(newVal) {\n\n          // do something\n      }\n  });\n  ```\n\n\n## 全家桶\n> vue 项目的核心构成\n\n  * __vue-cli__：快速搭建大型单页应用的脚手架工具\n    * 自动生成 Vue 项目的目录和文件，\n    * 通过热加载方式快速启动项目\n    * 利用本地 node 服务器实现页面的实时刷新效果\n  * __vue-router__：路由控制工具\n    * 用于配置路径和组件的映射关系\n    * 通过路径之间的切换而不是传统的超链接方式来实现页面切换\n  * __vuex__：状态管理工具\n    * 为了解决多个组件间的数据通信和状态管理的维护问题而产生\n    * 采用集中存储的方式统一管理项目中所有组件的状态 (组件通信的数据)\n  * __axios__：异步通信工具\n    * 基于Promise的 HTTP 请求客户端\n    * 可以同时在浏览器和 nodejs 中使用\n\n\n\n# 二、浏览器渲染 SPA\n> 将浏览器中直接生成和操作 DOM 的单页面应用程序\n\t\t\n  <div style=\"text-indent: 2em\">整个项目只有 index.html 一个完整页面，页面内容是通过不同的 vue 组件拼接后生成代码片段并添加到该页面的标签中展示出来。src/App.vue 是所有组件的父组件，所有其它组件都通过路由渲染到它的 router-view，然后再将 App.vue 渲染到 index.html。</div> \n\t\t\t\t\t\t\n\t\t\t\t\n## 单页面项目\n\n  ```js\n  // 构建流程\n  cnpm install vue webpack vue-cli -g   \n\n  cd workspace\n  vue init webpack project  // 生成目录 \n  cd project && npm i       // 安装依赖包\n\n  npm start                 // 热加载启动服务\n  npm run build             // 打包生成静态文件\n\n\n  // App.vue，兼容 pc 和移动端方案\n  export default {\n    name: \"App\",\n    created(){\n      if(document.documentElement.clientWidth > 640){\n          require('./style/pc.scss'); \n          this.plaform = 'pc';     // 父类类名为 .pc\n      }else{\n          require('./style/mobile.scss'); \n          this.plaform = 'mobile';  // 父类类名为.mobile\n      }\n    }\n  }\n\n  // 项目目录\n  ├── README.md              // 说明文档\n  ├── node_modules           // 项目依赖包\n  ├── .editorconfig          // 定义代码格式\n  ├── .babelrc 　            // ES6 语法编译配置\n  ├── .postcssrc.js          // css 代码转换配置\n  ├── .gitignore             // git 上传需要忽略的文件格式\n  ├── .eslintrc.js           // eslint 是管理和检测 js 代码风格\n  |\n  ├── index.html             // 项目入口文件\n  ├── package.json           // 项目基本信息\n  ├── package-lock.json      // 优化性能的新增文件\n  │\n  ├── build                  // webpack 编译打包配置\n  │   ├── build.js                 // 打包执行文件\n  │   ├── check-versions.js        // 检查 node、npm 等版本\n  │   ├── utils.js                 // 构建常用工具\n  │   ├── vue-loader.conf.js       // css 加载器配置\n  │   ├── webpack.base.conf.js     // 基础配置\n  │   ├── webpack.dev.conf.js      // 开发环境\n  │   └── webpack.prod.conf.js     // 生产环境\n  │\n  ├── config                // 项目配置\n  │   ├── dev.env.js               // 开发环境\n  │   ├── prod.env.js              // 生产环境\n  │   └── index.js                 // 基础配置\n  │\n  ├── src                   // 项目源码\n  │   ├── App.vue                  // 根组件\n  │   ├── main.js      \t\t\t       // 主配置文件\n  │   ├── assets                   // 需要打包的项目静态资源\n  │   │    └── img/js/css\n  │   ├── components               // 公共组件目录                 \n  │   │    └── common/page                     \n  │   │            \n  │   ├── router           // 路由配置\n  │   │    └── index.js           \n  │   │\n  │   └── vuex             // Vuex store相关\n  │        ├── index.js\n  │        ├── action.js             \n  │        ├── getter.js           \n  │        └── mutation.js \n  │\n  └── static              // 不需要打包的外部插件、公共库等资源\n      └── css/js/font           \n  ```\n\n## 多页面项目\n\n  ```js\n  // 目录调整\n  src\n  ├── assets\n  ├── components \n  └── pages\n        ├── index\n        │    ├── App.vue\n        │    ├── index.html\n        │    └── index.js\n        |\n        └── login\n            ├── Login.vue\n            ├── login.html\n            └── login.js\n\n\n  // 修改webpack配置\n  \n  // 1、utils.js 末尾添加\n  /* 添加部分 ---------------------------- 开始 */\n\n  // glob 模块用于路径匹配配置 (使用 * 等符号)，安装后引用：npm i glob -S \n  var glob = require('glob')\n  var HtmlWebpackPlugin = require('html-webpack-plugin')  // 页面模板\n  var PAGE_PATH = path.resolve(__dirname, '../src/pages')  // 页面路径\n  var merge = require('webpack-merge')    // merge处理\n\n  // 多入口配置：如果 pages 中存在 js 文件就存在就作为入口处理\n  exports.entries = function () {\n    var entryFiles = glob.sync(PAGE_PATH + '/*/*.js')\n    var map = {}\n    entryFiles.forEach((filePath) => {\n        var filename = filePath.substring(filePath.lastIndexOf('\\/') + 1, filePath.lastIndexOf('.'))\n        map[filename] = filePath\n    })\n    return map\n  }\n\n  // 多页面输出配置\n  exports.htmlPlugin = function () {\n    let entryHtml = glob.sync(PAGE_PATH + '/*/*.html')\n    let arr = []\n    entryHtml.forEach((filePath) => {\n        let filename = filePath.substring(filePath.lastIndexOf('\\/') + 1, filePath.lastIndexOf('.'))\n        let conf = {\n            template: filePath,  // 模板来源\n            filename: filename + '.html',   // 文件名称\n            // 页面模板需要添加对应的 js 脚本，不加则每个页面都会引入所有 js 脚本\n            chunks: ['manifest', 'vendor', filename],\n            inject: true\n        }\n        if (process.env.NODE_ENV === 'production') {\n            conf = merge(conf, {\n                minify: {\n                    removeComments: true,\n                    collapseWhitespace: true,\n                    removeAttributeQuotes: true\n                },\n                chunksSortMode: 'dependency'\n            })\n        }\n        arr.push(new HtmlWebpackPlugin(conf))\n    })\n    return arr\n  }\n  /* 添加部分 ---------------------------- 结束 */\n\n\n  // 2、webpack.base.conf.js 修改\n  entry: utils.entries(),  \n\n  // 3、webpack.dev.conf.js、webpack.prod.conf.js\n  plugins: [\n      /* 注释 ------------- 开始 */\n      // new HtmlWebpackPlugin({\n      //   filename: \n      // }),\n      /* 注释 ------------- 结束 */\n\n      /* 添加 ------------------ */\n  ].concat(utils.htmlPlugin())\n\n\n  // 初始化页面\n  // 1、index.js\n  import index from './App.vue'\n  new Vue({\n    el: '#app',\n    router,\n    components: { index },\n    template: '&lt;index/&gt;'\n  })\n\n  // 2、login.js\n  import LoginView from './Login.vue'\n  new Vue({\n    el: '#app',\n    render: h => h(LoginView)\n  })\n\n  // 3、index.html 页面跳转：a href='login.html'\n  ```\n\n\n## 首屏加载优化\n\n  * 首屏加载效果\n    * 页面内容加载完成前使用 loading、进度条、骨架屏 可以提升用户体验\n    * 骨架屏：vue-skeleton 使用一些空白内容的图形来展示未加载内容  \n  * 路由懒加载\n    * `const login = resolve => require(['common/Login.vue'], resolve)`\n  * 使用 v-if 减少不必要的组件加载：显示时才渲染弹窗等组件\n  * 通过 CDN 引入资源，减小服务器带宽压力\n    * 项目依赖会被全部打包到 vender.js，文件很大时首屏加载较慢\n    * 使用 cdn 文件代替就不会被打包进去，加载速度较快\n  * 将图片等一些静态资源放到云服务器，减小服务器压力\n  * 需加载三方资源：按需引入 ElementUI 等组件库\n  * 若首屏为登录页则可做成多入口\n  * webpack 开启 gzip 压缩\n\n          \n## 预渲染\n> 在构建阶段简单地生成生成匹配特定路由的静态 html 文件\n\n  * 插件安装：`npm i prerender-spa-plugin -S`\n  * 插件配置：`build/webpack.prod.conf.js`\n  * 路由配置：`route/index.js`\n\n  ```js\n  // build/webpack.prod.conf.js\n  const PrerenderSPAPlugin = require('prerender-spa-plugin')\n  const Renderer = PrerenderSPAPlugin.PuppeteerRenderer\n\n  const webpackConfig = merge(baseWebpackConfig, {\n      plugins: [\n          new PrerenderSPAPlugin({\n              // 生成文件的路径，该目录只能有一级，\n              // vue-cli3.0 时修改为 '/dist'\n              staticDir: path.join(__dirname, '../dist'),\n              \n              // 路由文件，如果有参数则比如 /index/\n              routes: ['/', '/index', '/home'],\n              \n              // 没有配置则不会进行预编译\n              renderer: new Renderer({\n                  inject: {\n                    foo: 'bar'\n                  },\n                  headless: false,\n                  renderAfterDocumentEvent: 'render-event'\n              })\n          })\n      ]\n  })\n\n  // route/index.js\n  export default new Router({\n      mode: 'history', \n      routes: []\n  })\n  ```\n\n\n# 三、服务器端渲染 SSR\n> 服务端拼接出带数据的 html 并发送到前端，前端把 html 插入到指定节点并渲染页面\n\n  <div style=\"text-indent: 2em\">Vue 是一个构建客户端应用的框架，即 vue 组件是在浏览器中进行渲染的。所谓服务端渲染，是指 Vue 服务端通过预拉取数据实现组件的初始化，然后启用虚拟 DOM 渲染为初始化的 HTML 字符串并发送到客户端，最后需要将这些静态标记\"激活\"为客户端上完全可交互的应用程序，从而实现前后端同构应用。服务器和客户端都会运行的代码为 通用代码，即 同构。</div> \n\n  * 优点\n    * 更好的SEO，搜索引擎爬虫可以抓取渲染好的页面\n    * 更快的首屏渲染时间，产生更好的用户体验，无需等待 Js 加载完成后才显示\n  * 缺点 \n    * 更多的服务器端负载（CPU 和内存资源）\n    * 更复杂的开发和部署（兼容 Node 执行环境）\n\n\n## 渲染过程\n\n  * 利用 webpack 需要分别对客户端代码和服务器端代码分别打包成两个 json 文件\n  * server-bundle 发送给服务器用于生成首屏页面 html\n  * client-bundle 发送给浏览器用于混合静态标记\n  * server.js 文件将两个打包文件和 HTML 模板混合生成 HTML 返回给浏览器渲染\n\n  <div align=\"center\"> \n    ![Vue SSR](images/vue/vue-ssr.png)\n  </div> \n\n\t\t\t\t \n## 开发约束\n> 通用代码应该兼容浏览器和服务端 Node 的执行环境\n  \n  * 不可使用全局环境变量：window、document 等只能在浏览器中运行\n  * 生命周期钩子函数只有 beforeCreate、created 能同时运行在前后端\n  * 避免状态单例\n    * Node 服务器是一个长期运行的进程，代码进入该进程时就会取值并留存在内存。如果创建一个实例对象，它将在每个传入的请求之间共享，容易导致交叉请求状态污染。所以应该暴露一个可以重复执行的工厂函数，为每个请求创建新实例\n    * 同样的规则也适用于 router、store、event bus 实例。你不应该直接从模块导出并将其导入到应用程序中。而是需要在 createApp 中创建一个新实例并从根实例注入\n    \n     \n## 模板插值\n\n### 安装模块\n\t\n  * 安装：`cnpm i vue vue-server-renderer koa koa-router -S`\n  * vue-server-renderer：获取 vue 实例并渲染成 html 结构，并配合 webpack 构建项目\n\n\n### 单个文件 \n  <div align=\"center\"> \n    ![vue-server-renderer](images/vue/vue-render-1.png)\n  </div> \n  \n\n### 目录文件\n  \n  <div align=\"center\"> \n    ![vue-render-index](images/vue/vue-render-2.png)\n  </div> \n  \n\n  ```js\n  // server.js\n  const Vue = require('vue')\n  const Koa = require('koa')\n  const Router = require('koa-router')\n  const renderer = require('vue-server-renderer').createRenderer({\n    template: require('fs').readFileSync('./index.html', 'utf-8')\n  }) \n\n  // 1、创建 koa、koa-router 实例\n  const app = new Koa()\n  const router = new Router()\n\n  // 2、路由中间件\n  router.get('*', async (ctx, next) => {\n    // 渲染上下文对象：title、meta 会插入模板中\n    const context = {\n      title: ctx.url,\n      meta: `\n        &lt; meta charset=\"UTF-8\" &gt;\n        &lt; meta name=\"description\" content=\"基于webpack、koa搭建的SSR\" &gt;\n      `\n    }\n\n    // 创建Vue实例\n    const vue_app = new Vue({\n      data: {\n        url: ctx.url\n      },\n      template: `{{ url }}`\n    })\n\n    // 有错误返回 500，无错误返回 html\n    try {\n      const html = await renderer.renderToString(vue_app, context)\n      ctx.status = 200\n      // html 结构会插入到 template 中的 !--vue-ssr-outlet-->\n      ctx.body = html\n    } catch (error) {\n      ctx.status = 500\n      ctx.body = 'Internal Server Error'\n    }\n  })\n  app.use(router.routes()).use(router.allowedMethods())\n\n  // 3、启动服务\n  app.listen(3000, () => {\n    console.log(`server started at localhost:3000`)\n  })\n  ```\n\n\n### 结果分析\n\t\t\t\t\t\t\t\t\n  * SPA：前端打包后的 html 只包含 head 部分，body 部分都是动态插入到 `div id = \"app\"`\n  * SSR：服务器提前编译 Vue 资源生成 HTML 并返回给浏览器，这样网络爬虫爬取的内容就是网站上所有可呈现的内容\n\n\n\n## 项目构建\n> vue-ssr 代码库  \n\n### 基础构建\n  * webpack 配置\n    * 新增：`webpack.server.conf.js`\n    * 修改：`vue-loader.conf.js、webpack.base/prod.conf.js`\n  * 入口配置：`main.js、entry-client.js、entry-server.js`\n  * 组件修改\n    * 修改 router 路由文件，给每个请求一个新的 router 实例\n    * 修改状态管理 vuex 文件，给每个请求一个新的 store 实例\n    * 通过 asyncData 方法获取异步数据\n  * 服务器配置\n    * 根目录新建 server.js 文件\n    * 修改 package.json 文件\n    * 修改 index.html 文件\n  * 启动项目\n    * 安装依赖：`cnpm install` \n    * 打包文件：`npm run build`\n    * 启动服务：`node server.js`   \n\n\n### 服务端预拉取数据\n\n  <div style=\"text-indent: 2em\">如果应用程序依赖于一些异步数据，那么在开始渲染过程之前，需要先预取和解析好这些数据，并将数据拼装到全局 Vuex状态中。但是需要注意：在挂载到客户端应用程序之前，需要获取到与服务器端应用程序完全相同的数据，否则 客户端应用程序会因为使用与服务器端应用程序不同的状态 导致混合失败。</div>\n  <div style=\"text-indent: 2em\">目前较好的解决方案是：给路由匹配的一级子组件一个 asyncData 方法，asyncData 是约定的函数名，表示渲染组件需要预先执行它获取初始数据，它返回一个 Promise，以便后端渲染时可以知道什么时候该操作完成。注意，由于此函数会在组件实例化之前调用，所以它无法访问 this，需要将 store 和路由信息作为参数传递进去。</div> \n\t\t\t\t\t\t\t\t\t\n\n\n# 四、模块引用\n\n## npm 安装的模块\n> 默认全局引用，局部引用就是在组件中按需引用\n\n### 常用模块\n\n  * 安装：`cnpm install axios vuex element-ui vue-awesome-swiper echarts -S`\n    * -D / --save: 生产环境还要用到的包 (package.json/dependencies )\n    * -S / --save-dev: 只在开发环境用到的包 (package.json/devDependencies)\n  * 配置\n    ```js\n    // main.js \n\n    // axios\n    import axios from 'axios'\n    Vue.prototype.$axios = axios\n\n    // 自定义配置 axios\n    import ajax from './axios/http'\n    Vue.prototype.$get = ajax.get\n    Vue.prototype.$post = ajax.post\n\n    // 组件库\n    import ElementUI from 'element-ui'\n    import 'element-ui/lib/theme-chalk/index.css'\n    Vue.use(ElementUI)\n\n    // 轮播插件\n    import VueAwesomeSwiper from 'vue-awesome-swiper'\n    import 'swiper/dist/css/swiper.css'\n    Vue.use(VueAwesomeSwiper)\n\n    // 图表插件\n    import echarts from \"echarts\"\t\t\n    Vue.prototype.$echarts = echarts \n\n    // vuex\n    import store from './vuex/index'\n    new Vue({\n      el: '#app',\n      router,\n      store,\n      data: {\n        // 根组件的空实例\n        eventHub: new Vue()\n      }\n    })\n    ```\n\n\t\t\t\t\n### Sass\t\t\t\t\t\t\n  * 安装：`cnpm install sass-loader node-sass css-loader -S`\n  * 使用：`style lang=\"scss\" scoped`\n  * 配置\n    ```js\n    // build/webpack.base.conf.js\n    module.exports = {\n      resolve: {\n        // 添加扩展名 .scss\n        extensions: ['.js', '.vue', '.json', '.scss'],\n      },\n      module: {\n        rules: {\n          // 最后添加\n          {  \n            test: /\\.scss$/,  \n            loaders: ['style', 'css', 'sass']  \n          }\n        }\n      }\n    }\n    ```\n\n\n### 对象展开运算符 \n  * 安装：`cnpm install babel-plugin-transform-object-rest-spread -S`\n  * 使用：`...mapGetters([ 'count' ])`\n  * 配置：`.babelrc 文件 -- \"plugins\": [\"transform-object-rest-spread\"]`\n\n\n### 集成 Ace 代码编辑器\n  * 安装：cnpm install ace-builds -S\n  * 配置：[Vue Ace](https://blog.csdn.net/YoshinoNanjo/article/details/82978668)\n\n\n## npm 不能安装的插件\n> 直接引入插件文件\n\n  * index.html：`script src=\"/static/bootstrap.min.js\"`\n  * main.js：`import '@/assets/css/bootstrap.min.css'`\n\n\n## 静态资源\n\n### global.scss\n  * 安装：cnpm install sass-resources-loader --save-dev\n  * 注意：如果要导入多个文件则全部导入到 global.scss：@import './reset.scss'\n  * 配置 \n\n  ```js\n  // build/utils.js -- scss: generateLoaders('sass') \n  scss: generateLoaders('sass').concat(\n    {\n      loader: 'sass-resources-loader',\n      options: {\n        resources: path.resolve(__dirname, '../src/assets/global.scss')\n      }\n    }\n  )\n  ```\n\n\n### 静态文件\n  * js：`import user from '@/components/user'`\n  * css\n    * `@import './swiper.css'`\n    * `@import '../../assets/scss/mixin.scss'`\n    * `@import url('../assets/css/reset.css')`\n  * template\n    * 绝对路径：`img src='/static/images/logo.png'`    \n    * 相对路径：`img src='../../assets/images/1.png'`  \n\t\t\t\t\t\t\t\t\t\n\n \n# 五、基础配置\n\n## 快捷键\n  ```json\n  // package.json文件\n  \"scripts\": {\n      \"build\": \"node build/build.js\",\n      \"start\": \"rimraf dist && npm run build\"\n  }\n  ```\n\n\n## 路径别名\n> 用于以后引用路径时减少复杂度：import getList from 'api/index'\n\n  ```js\n  // build/webpack.base.conf.js\n  resolve: {\n    alias: {\n      'vue$': 'vue/dist/vue.esm.js',\n      '@': resolve('src'),\n      'api': path.resolve(__dirname, '../src/api')\n    }\n  }\n  ```\n\n\t\t\n## 代码调试\n  * 开发工具：Chrome vue-devtools\n  * debugger 模式：修改 config/index.js 文件 `devtool: '#eval-source-map'`\n\n## 手机查看\n> 将手机连接到与电脑相同的 Wifi\n\n  1. config/index.js -- dev/host：当前电脑的IP地址\n  2. 重新启动服务后，在手机上直接打开地址，或者转为二维码之后使用手机扫描\n\n\t\t\n## 请求代理\n> 服务器代理网络用户去获取网络信息，可以解决开发环境中的跨域问题\n\n  ```js\n  // config/index.js\n  dev: {  \n    proxyTable: {   \n      '/ajaxUrl': {      // 请求地址\n          target: 'http://cangdu.org:8000/', // 实际映射到的目标地址\n          changeOrigin: true,                // 是否跨域\n          secure: false,                     // https 接口需要配置\n          pathRewrite: {\n              '^/ajaxUrl': ''                // target 地址的别名\n          }\n      } \n    }  \n  }\n  ```\n\n\t\t\n## 全局接口\n> 开发环境和生产环境配置不同接口\n\n  ```js\n  // config/dev.env.js \n  module.exports = merge(prodEnv, {\n      NODE_ENV: '\"development\"',\n      API_ROOT: '\"http://10.148.221.210:5000/\"',\n      WS_ROOT: '\"ws://10.148.221.210:5001\"'\n  })\n\n\n  // config/prod.env.js \n  module.exports = {\n      NODE_ENV: '\"production\"',\n      API_ROOT: '\"http://10.148.134.54:5000/\"',\n      WS_ROOT: '\"ws://10.148.134.54:5001\"'\n  }\n\n\n  // axios baseURL\n  axios.defaults.baseURL = process.env.API_ROOT\n\n  // 组件 url\n  this.websocket = new WebSocket(process.env.WS_ROOT) \n  ```\n\n\n# 六、打包问题\n> npm run build 执行打包操作后生成 dist 文件夹  \n\n## 资源路径\n> 打包后资源加载错误，因为绝对路径加载的资源打包后会报错\n\n  * static 目录\n    * 特点：文件不会被 wabpack 编译处理，会被直接复制到打包目录\n    * 使用方式\n      * HTML 使用相对路径：`../static/images/bg.png`\n      * JS 使用打包后路径：`./static/images/bg.png`\n      * CSS 使用根目录路径：`../../static/images/bg.png`\n  * assets 目录\n    * 文件会经过 webpack 打包并重新编译，一般只能使用相对路径\n    * 图片等不能用于动态绑定 因为 webpack 使用 ` commenJS ` 规范而必须使用 require\n\n\n  ```js\n  // 文件 config/index.js  \n  build: {\n    assetsSubDirectory: './static',// 解决 css 路径问题\n    assetsPublicPath: './',      // 解决 js 路径问题\n    productionSourceMap: false   // 加快编译速度\n  }\n\n  // 静态资源 build/utils.js  \n  if (options.extract) {\n    return ExtractTextPlugin.extract({\n      use: loaders,\n      publicPath:'../../',   // 打包时提取 CSS\n      fallback: 'vue-style-loader'\n    })\n  }\n  ```\n\n\n## 路由模式\n> history 路由模式的项目打包后的页面没有渲染\n\n  * 使用hash模式\n  * 设置routes里的路由name \n\n\t\t\t\n## IE 浏览器\n> 打包后在 IE 浏览器不显示\n\n* 原因：Promise在ie上的支持不是很好导致的\n* 解决\n  * 安装插件：cnpm install --save-dev babel-polyfill\n  * main.js 引入：import 'babel-polyfill'   \n  * 配置\n    ```js\n    // build/webpack.base.conf.js\n    module.exports = {\n      entry: {\n        app: [\"babel-polyfill\", \"./src/main.js\"]  \n      }\n    }\n    ```\n          \n\n## favicon.ico \n> 地址栏左边的图标文件无法加载，它是代表网站的标志 \n\n  * 问题：打印台报错，原因是图标文件不存在或路径错误\n  * index.html：`link rel=\"shortcut icon\" type=\"image/x-icon\" href=\"favicon.ico\"`\n\n\n# 七、静态服务\n> 打包后快速搭建静态服务器\n\n  * 全局安装：`npm install -g live-server / http-server`\n  * 运行项目：`live-server / http-server`\n  * 快捷命令：`\"script\":{ \"server\":\"live-server ./dist --port=8080\" }`\n \n\n","slug":"13-vue基础","published":1,"updated":"2019-05-10T17:19:06.879Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvid4pmn001x0nbxedxpa8j3","content":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><html><head></head><body><h1 id=\"一、vue-框架\"><a href=\"#一、vue-框架\" class=\"headerlink\" title=\"一、vue 框架\"></a>一、vue 框架</h1><div style=\"text-indent:2em\">Vue 是一套构建用户界面的渐进式 js 框架，它不是一个全能框架而只聚焦于视图层，容易学习和与其它库或已有项目整合。Vue 框架是一个轻量高效的前端组件化方案，它通过简洁的 API 提供高效的数据驱动的组件系统，通过操作数据来实现页面的更新与展示。</div><ul><li>核心思想：<code>数据驱动的组件系统</code></li><li>开发理念：<code>渐进式开发、只关注视图层、组件化、响应式</code><ul><li>渐进式开发：先构建基础的用户界面，然后再根据需求灵活添加功能</li><li>响应式：一个网页，根据不同的分辨率改变网页大小</li><li>适应式：多个不同的网页，根据不同的分辨率自动选择不同页面</li></ul></li><li><a href=\"https://segmentfault.com/p/1210000008583242/read?from=timeline\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">开源项目库</a></li></ul><h2 id=\"MVVM-模式\"><a href=\"#MVVM-模式\" class=\"headerlink\" title=\"MVVM 模式\"></a>MVVM 模式</h2><ul><li><strong>Model</strong>：对应 js 对象的数据部分</li><li><strong>View</strong>：对应 DOM 元素的视图部分</li><li><p><strong>Viewmodel</strong>：绑定数据和 DOM 的中间件</p><div align=\"center\"><br><img src=\"images/vue/vue_bing.png\" alt=\"Vue MVVM\"><br></div><div style=\"text-indent:2em\">DOM Listeners、Data Bindings 是实现双向绑定功能的关键，实现原理是Object.defineProperty 中的 get、set 方法 和消息订阅模式。DOM Listeners 监听页面所有 View 层 DOM 元素的变化，发生变化时 Model 层的数据随之变化。Data Bindings 监听 Model 层的数据，数据发生变化时 View 层的 DOM 元素随之变化。</div><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 对数据对象的每个属性添加对应的 get、set 方法 </span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(data, key, {</span><br><span class=\"line\">    enumerable: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    configurable: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 读取数据时调用</span></span><br><span class=\"line\">    <span class=\"keyword\">get</span>: function() {</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// do something</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> val;</span><br><span class=\"line\">    },</span><br><span class=\"line\">    <span class=\"comment\">// 对数据进行赋值操作时调用</span></span><br><span class=\"line\">    <span class=\"keyword\">set</span>: function(newVal) {</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// do something</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">});</span><br></pre></td></tr></tbody></table></figure></li></ul><h2 id=\"全家桶\"><a href=\"#全家桶\" class=\"headerlink\" title=\"全家桶\"></a>全家桶</h2><blockquote><p>vue 项目的核心构成</p></blockquote><ul><li><strong>vue-cli</strong>：快速搭建大型单页应用的脚手架工具<ul><li>自动生成 Vue 项目的目录和文件，</li><li>通过热加载方式快速启动项目</li><li>利用本地 node 服务器实现页面的实时刷新效果</li></ul></li><li><strong>vue-router</strong>：路由控制工具<ul><li>用于配置路径和组件的映射关系</li><li>通过路径之间的切换而不是传统的超链接方式来实现页面切换</li></ul></li><li><strong>vuex</strong>：状态管理工具<ul><li>为了解决多个组件间的数据通信和状态管理的维护问题而产生</li><li>采用集中存储的方式统一管理项目中所有组件的状态 (组件通信的数据)</li></ul></li><li><strong>axios</strong>：异步通信工具<ul><li>基于Promise的 HTTP 请求客户端</li><li>可以同时在浏览器和 nodejs 中使用</li></ul></li></ul><h1 id=\"二、浏览器渲染-SPA\"><a href=\"#二、浏览器渲染-SPA\" class=\"headerlink\" title=\"二、浏览器渲染 SPA\"></a>二、浏览器渲染 SPA</h1><blockquote><p>将浏览器中直接生成和操作 DOM 的单页面应用程序</p></blockquote><div style=\"text-indent:2em\">整个项目只有 index.html 一个完整页面，页面内容是通过不同的 vue 组件拼接后生成代码片段并添加到该页面的标签中展示出来。src/App.vue 是所有组件的父组件，所有其它组件都通过路由渲染到它的 router-view，然后再将 App.vue 渲染到 index.html。</div><h2 id=\"单页面项目\"><a href=\"#单页面项目\" class=\"headerlink\" title=\"单页面项目\"></a>单页面项目</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 构建流程</span></span><br><span class=\"line\">cnpm install vue webpack vue-cli -g   </span><br><span class=\"line\"></span><br><span class=\"line\">cd workspace</span><br><span class=\"line\">vue init webpack project  <span class=\"comment\">// 生成目录 </span></span><br><span class=\"line\">cd project && npm i       <span class=\"comment\">// 安装依赖包</span></span><br><span class=\"line\"></span><br><span class=\"line\">npm start                 <span class=\"comment\">// 热加载启动服务</span></span><br><span class=\"line\">npm run build             <span class=\"comment\">// 打包生成静态文件</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// App.vue，兼容 pc 和移动端方案</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> {</span><br><span class=\"line\">  name: <span class=\"string\">\"App\"</span>,</span><br><span class=\"line\">  created(){</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"built_in\">document</span>.documentElement.clientWidth > <span class=\"number\">640</span>){</span><br><span class=\"line\">        <span class=\"built_in\">require</span>(<span class=\"string\">'./style/pc.scss'</span>); </span><br><span class=\"line\">        <span class=\"keyword\">this</span>.plaform = <span class=\"string\">'pc'</span>;     <span class=\"comment\">// 父类类名为 .pc</span></span><br><span class=\"line\">    }<span class=\"keyword\">else</span>{</span><br><span class=\"line\">        <span class=\"built_in\">require</span>(<span class=\"string\">'./style/mobile.scss'</span>); </span><br><span class=\"line\">        <span class=\"keyword\">this</span>.plaform = <span class=\"string\">'mobile'</span>;  <span class=\"comment\">// 父类类名为.mobile</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 项目目录</span></span><br><span class=\"line\">├── README.md              <span class=\"comment\">// 说明文档</span></span><br><span class=\"line\">├── node_modules           <span class=\"comment\">// 项目依赖包</span></span><br><span class=\"line\">├── .editorconfig          <span class=\"comment\">// 定义代码格式</span></span><br><span class=\"line\">├── .babelrc 　            <span class=\"comment\">// ES6 语法编译配置</span></span><br><span class=\"line\">├── .postcssrc.js          <span class=\"comment\">// css 代码转换配置</span></span><br><span class=\"line\">├── .gitignore             <span class=\"comment\">// git 上传需要忽略的文件格式</span></span><br><span class=\"line\">├── .eslintrc.js           <span class=\"comment\">// eslint 是管理和检测 js 代码风格</span></span><br><span class=\"line\">|</span><br><span class=\"line\">├── index.html             <span class=\"comment\">// 项目入口文件</span></span><br><span class=\"line\">├── package.json           <span class=\"comment\">// 项目基本信息</span></span><br><span class=\"line\">├── package-lock.json      <span class=\"comment\">// 优化性能的新增文件</span></span><br><span class=\"line\">│</span><br><span class=\"line\">├── build                  <span class=\"comment\">// webpack 编译打包配置</span></span><br><span class=\"line\">│   ├── build.js                 <span class=\"comment\">// 打包执行文件</span></span><br><span class=\"line\">│   ├── check-versions.js        <span class=\"comment\">// 检查 node、npm 等版本</span></span><br><span class=\"line\">│   ├── utils.js                 <span class=\"comment\">// 构建常用工具</span></span><br><span class=\"line\">│   ├── vue-loader.conf.js       <span class=\"comment\">// css 加载器配置</span></span><br><span class=\"line\">│   ├── webpack.base.conf.js     <span class=\"comment\">// 基础配置</span></span><br><span class=\"line\">│   ├── webpack.dev.conf.js      <span class=\"comment\">// 开发环境</span></span><br><span class=\"line\">│   └── webpack.prod.conf.js     <span class=\"comment\">// 生产环境</span></span><br><span class=\"line\">│</span><br><span class=\"line\">├── config                <span class=\"comment\">// 项目配置</span></span><br><span class=\"line\">│   ├── dev.env.js               <span class=\"comment\">// 开发环境</span></span><br><span class=\"line\">│   ├── prod.env.js              <span class=\"comment\">// 生产环境</span></span><br><span class=\"line\">│   └── index.js                 <span class=\"comment\">// 基础配置</span></span><br><span class=\"line\">│</span><br><span class=\"line\">├── src                   <span class=\"comment\">// 项目源码</span></span><br><span class=\"line\">│   ├── App.vue                  <span class=\"comment\">// 根组件</span></span><br><span class=\"line\">│   ├── main.js      \t\t\t       <span class=\"comment\">// 主配置文件</span></span><br><span class=\"line\">│   ├── assets                   <span class=\"comment\">// 需要打包的项目静态资源</span></span><br><span class=\"line\">│   │    └── img/js/css</span><br><span class=\"line\">│   ├── components               <span class=\"comment\">// 公共组件目录                 </span></span><br><span class=\"line\">│   │    └── common/page                     </span><br><span class=\"line\">│   │            </span><br><span class=\"line\">│   ├── router           <span class=\"comment\">// 路由配置</span></span><br><span class=\"line\">│   │    └── index.js           </span><br><span class=\"line\">│   │</span><br><span class=\"line\">│   └── vuex             <span class=\"comment\">// Vuex store相关</span></span><br><span class=\"line\">│        ├── index.js</span><br><span class=\"line\">│        ├── action.js             </span><br><span class=\"line\">│        ├── getter.js           </span><br><span class=\"line\">│        └── mutation.js </span><br><span class=\"line\">│</span><br><span class=\"line\">└── <span class=\"keyword\">static</span>              <span class=\"comment\">// 不需要打包的外部插件、公共库等资源</span></span><br><span class=\"line\">    └── css/js/font</span><br></pre></td></tr></tbody></table></figure><h2 id=\"多页面项目\"><a href=\"#多页面项目\" class=\"headerlink\" title=\"多页面项目\"></a>多页面项目</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 目录调整</span></span><br><span class=\"line\">src</span><br><span class=\"line\">├── assets</span><br><span class=\"line\">├── components </span><br><span class=\"line\">└── pages</span><br><span class=\"line\">      ├── index</span><br><span class=\"line\">      │    ├── App.vue</span><br><span class=\"line\">      │    ├── index.html</span><br><span class=\"line\">      │    └── index.js</span><br><span class=\"line\">      |</span><br><span class=\"line\">      └── login</span><br><span class=\"line\">          ├── Login.vue</span><br><span class=\"line\">          ├── login.html</span><br><span class=\"line\">          └── login.js</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 修改webpack配置</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 1、utils.js 末尾添加</span></span><br><span class=\"line\"><span class=\"comment\">/* 添加部分 ---------------------------- 开始 */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// glob 模块用于路径匹配配置 (使用 * 等符号)，安装后引用：npm i glob -S </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> glob = <span class=\"built_in\">require</span>(<span class=\"string\">'glob'</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'html-webpack-plugin'</span>)  <span class=\"comment\">// 页面模板</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> PAGE_PATH = path.resolve(__dirname, <span class=\"string\">'../src/pages'</span>)  <span class=\"comment\">// 页面路径</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> merge = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack-merge'</span>)    <span class=\"comment\">// merge处理</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 多入口配置：如果 pages 中存在 js 文件就存在就作为入口处理</span></span><br><span class=\"line\">exports.entries = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">  <span class=\"keyword\">var</span> entryFiles = glob.sync(PAGE_PATH + <span class=\"string\">'/*/*.js'</span>)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> map = {}</span><br><span class=\"line\">  entryFiles.forEach(<span class=\"function\">(<span class=\"params\">filePath</span>) =></span> {</span><br><span class=\"line\">      <span class=\"keyword\">var</span> filename = filePath.substring(filePath.lastIndexOf(<span class=\"string\">'\\/'</span>) + <span class=\"number\">1</span>, filePath.lastIndexOf(<span class=\"string\">'.'</span>))</span><br><span class=\"line\">      map[filename] = filePath</span><br><span class=\"line\">  })</span><br><span class=\"line\">  <span class=\"keyword\">return</span> map</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 多页面输出配置</span></span><br><span class=\"line\">exports.htmlPlugin = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">  <span class=\"keyword\">let</span> entryHtml = glob.sync(PAGE_PATH + <span class=\"string\">'/*/*.html'</span>)</span><br><span class=\"line\">  <span class=\"keyword\">let</span> arr = []</span><br><span class=\"line\">  entryHtml.forEach(<span class=\"function\">(<span class=\"params\">filePath</span>) =></span> {</span><br><span class=\"line\">      <span class=\"keyword\">let</span> filename = filePath.substring(filePath.lastIndexOf(<span class=\"string\">'\\/'</span>) + <span class=\"number\">1</span>, filePath.lastIndexOf(<span class=\"string\">'.'</span>))</span><br><span class=\"line\">      <span class=\"keyword\">let</span> conf = {</span><br><span class=\"line\">          template: filePath,  <span class=\"comment\">// 模板来源</span></span><br><span class=\"line\">          filename: filename + <span class=\"string\">'.html'</span>,   <span class=\"comment\">// 文件名称</span></span><br><span class=\"line\">          <span class=\"comment\">// 页面模板需要添加对应的 js 脚本，不加则每个页面都会引入所有 js 脚本</span></span><br><span class=\"line\">          chunks: [<span class=\"string\">'manifest'</span>, <span class=\"string\">'vendor'</span>, filename],</span><br><span class=\"line\">          inject: <span class=\"literal\">true</span></span><br><span class=\"line\">      }</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (process.env.NODE_ENV === <span class=\"string\">'production'</span>) {</span><br><span class=\"line\">          conf = merge(conf, {</span><br><span class=\"line\">              minify: {</span><br><span class=\"line\">                  removeComments: <span class=\"literal\">true</span>,</span><br><span class=\"line\">                  collapseWhitespace: <span class=\"literal\">true</span>,</span><br><span class=\"line\">                  removeAttributeQuotes: <span class=\"literal\">true</span></span><br><span class=\"line\">              },</span><br><span class=\"line\">              chunksSortMode: <span class=\"string\">'dependency'</span></span><br><span class=\"line\">          })</span><br><span class=\"line\">      }</span><br><span class=\"line\">      arr.push(<span class=\"keyword\">new</span> HtmlWebpackPlugin(conf))</span><br><span class=\"line\">  })</span><br><span class=\"line\">  <span class=\"keyword\">return</span> arr</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"comment\">/* 添加部分 ---------------------------- 结束 */</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2、webpack.base.conf.js 修改</span></span><br><span class=\"line\">entry: utils.entries(),  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3、webpack.dev.conf.js、webpack.prod.conf.js</span></span><br><span class=\"line\">plugins: [</span><br><span class=\"line\">    <span class=\"comment\">/* 注释 ------------- 开始 */</span></span><br><span class=\"line\">    <span class=\"comment\">// new HtmlWebpackPlugin({</span></span><br><span class=\"line\">    <span class=\"comment\">//   filename: </span></span><br><span class=\"line\">    <span class=\"comment\">// }),</span></span><br><span class=\"line\">    <span class=\"comment\">/* 注释 ------------- 结束 */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* 添加 ------------------ */</span></span><br><span class=\"line\">].concat(utils.htmlPlugin())</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 初始化页面</span></span><br><span class=\"line\"><span class=\"comment\">// 1、index.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> index <span class=\"keyword\">from</span> <span class=\"string\">'./App.vue'</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> Vue({</span><br><span class=\"line\">  el: <span class=\"string\">'#app'</span>,</span><br><span class=\"line\">  router,</span><br><span class=\"line\">  components: { index },</span><br><span class=\"line\">  template: <span class=\"string\">'&lt;index/&gt;'</span></span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2、login.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> LoginView <span class=\"keyword\">from</span> <span class=\"string\">'./Login.vue'</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> Vue({</span><br><span class=\"line\">  el: <span class=\"string\">'#app'</span>,</span><br><span class=\"line\">  render: <span class=\"function\"><span class=\"params\">h</span> =></span> h(LoginView)</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3、index.html 页面跳转：a href='login.html'</span></span><br></pre></td></tr></tbody></table></figure><h2 id=\"首屏加载优化\"><a href=\"#首屏加载优化\" class=\"headerlink\" title=\"首屏加载优化\"></a>首屏加载优化</h2><ul><li>首屏加载效果<ul><li>页面内容加载完成前使用 loading、进度条、骨架屏 可以提升用户体验</li><li>骨架屏：vue-skeleton 使用一些空白内容的图形来展示未加载内容</li></ul></li><li>路由懒加载<ul><li><code>const login = resolve => require(['common/Login.vue'], resolve)</code></li></ul></li><li>使用 v-if 减少不必要的组件加载：显示时才渲染弹窗等组件</li><li>通过 CDN 引入资源，减小服务器带宽压力<ul><li>项目依赖会被全部打包到 vender.js，文件很大时首屏加载较慢</li><li>使用 cdn 文件代替就不会被打包进去，加载速度较快</li></ul></li><li>将图片等一些静态资源放到云服务器，减小服务器压力</li><li>需加载三方资源：按需引入 ElementUI 等组件库</li><li>若首屏为登录页则可做成多入口</li><li>webpack 开启 gzip 压缩</li></ul><h2 id=\"预渲染\"><a href=\"#预渲染\" class=\"headerlink\" title=\"预渲染\"></a>预渲染</h2><blockquote><p>在构建阶段简单地生成生成匹配特定路由的静态 html 文件</p></blockquote><ul><li>插件安装：<code>npm i prerender-spa-plugin -S</code></li><li>插件配置：<code>build/webpack.prod.conf.js</code></li><li><p>路由配置：<code>route/index.js</code></p><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.prod.conf.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> PrerenderSPAPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'prerender-spa-plugin'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> Renderer = PrerenderSPAPlugin.PuppeteerRenderer</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> webpackConfig = merge(baseWebpackConfig, {</span><br><span class=\"line\">    plugins: [</span><br><span class=\"line\">        <span class=\"keyword\">new</span> PrerenderSPAPlugin({</span><br><span class=\"line\">            <span class=\"comment\">// 生成文件的路径，该目录只能有一级，</span></span><br><span class=\"line\">            <span class=\"comment\">// vue-cli3.0 时修改为 '/dist'</span></span><br><span class=\"line\">            staticDir: path.join(__dirname, <span class=\"string\">'../dist'</span>),</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">// 路由文件，如果有参数则比如 /index/</span></span><br><span class=\"line\">            routes: [<span class=\"string\">'/'</span>, <span class=\"string\">'/index'</span>, <span class=\"string\">'/home'</span>],</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">// 没有配置则不会进行预编译</span></span><br><span class=\"line\">            renderer: <span class=\"keyword\">new</span> Renderer({</span><br><span class=\"line\">                inject: {</span><br><span class=\"line\">                  foo: <span class=\"string\">'bar'</span></span><br><span class=\"line\">                },</span><br><span class=\"line\">                headless: <span class=\"literal\">false</span>,</span><br><span class=\"line\">                renderAfterDocumentEvent: <span class=\"string\">'render-event'</span></span><br><span class=\"line\">            })</span><br><span class=\"line\">        })</span><br><span class=\"line\">    ]</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// route/index.js</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">new</span> Router({</span><br><span class=\"line\">    mode: <span class=\"string\">'history'</span>, </span><br><span class=\"line\">    routes: []</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure></li></ul><h1 id=\"三、服务器端渲染-SSR\"><a href=\"#三、服务器端渲染-SSR\" class=\"headerlink\" title=\"三、服务器端渲染 SSR\"></a>三、服务器端渲染 SSR</h1><blockquote><p>服务端拼接出带数据的 html 并发送到前端，前端把 html 插入到指定节点并渲染页面</p></blockquote><div style=\"text-indent:2em\">Vue 是一个构建客户端应用的框架，即 vue 组件是在浏览器中进行渲染的。所谓服务端渲染，是指 Vue 服务端通过预拉取数据实现组件的初始化，然后启用虚拟 DOM 渲染为初始化的 HTML 字符串并发送到客户端，最后需要将这些静态标记”激活”为客户端上完全可交互的应用程序，从而实现前后端同构应用。服务器和客户端都会运行的代码为 通用代码，即 同构。</div><ul><li>优点<ul><li>更好的SEO，搜索引擎爬虫可以抓取渲染好的页面</li><li>更快的首屏渲染时间，产生更好的用户体验，无需等待 Js 加载完成后才显示</li></ul></li><li>缺点<ul><li>更多的服务器端负载（CPU 和内存资源）</li><li>更复杂的开发和部署（兼容 Node 执行环境）</li></ul></li></ul><h2 id=\"渲染过程\"><a href=\"#渲染过程\" class=\"headerlink\" title=\"渲染过程\"></a>渲染过程</h2><ul><li>利用 webpack 需要分别对客户端代码和服务器端代码分别打包成两个 json 文件</li><li>server-bundle 发送给服务器用于生成首屏页面 html</li><li>client-bundle 发送给浏览器用于混合静态标记</li><li><p>server.js 文件将两个打包文件和 HTML 模板混合生成 HTML 返回给浏览器渲染</p><div align=\"center\"><br><img src=\"images/vue/vue-ssr.png\" alt=\"Vue SSR\"><br></div></li></ul><h2 id=\"开发约束\"><a href=\"#开发约束\" class=\"headerlink\" title=\"开发约束\"></a>开发约束</h2><blockquote><p>通用代码应该兼容浏览器和服务端 Node 的执行环境</p></blockquote><ul><li>不可使用全局环境变量：window、document 等只能在浏览器中运行</li><li>生命周期钩子函数只有 beforeCreate、created 能同时运行在前后端</li><li>避免状态单例<ul><li>Node 服务器是一个长期运行的进程，代码进入该进程时就会取值并留存在内存。如果创建一个实例对象，它将在每个传入的请求之间共享，容易导致交叉请求状态污染。所以应该暴露一个可以重复执行的工厂函数，为每个请求创建新实例</li><li>同样的规则也适用于 router、store、event bus 实例。你不应该直接从模块导出并将其导入到应用程序中。而是需要在 createApp 中创建一个新实例并从根实例注入</li></ul></li></ul><h2 id=\"模板插值\"><a href=\"#模板插值\" class=\"headerlink\" title=\"模板插值\"></a>模板插值</h2><h3 id=\"安装模块\"><a href=\"#安装模块\" class=\"headerlink\" title=\"安装模块\"></a>安装模块</h3><ul><li>安装：<code>cnpm i vue vue-server-renderer koa koa-router -S</code></li><li>vue-server-renderer：获取 vue 实例并渲染成 html 结构，并配合 webpack 构建项目</li></ul><h3 id=\"单个文件\"><a href=\"#单个文件\" class=\"headerlink\" title=\"单个文件\"></a>单个文件</h3><div align=\"center\"><br><img src=\"images/vue/vue-render-1.png\" alt=\"vue-server-renderer\"><br></div><h3 id=\"目录文件\"><a href=\"#目录文件\" class=\"headerlink\" title=\"目录文件\"></a>目录文件</h3><div align=\"center\"><br><img src=\"images/vue/vue-render-2.png\" alt=\"vue-render-index\"><br></div><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> Vue = <span class=\"built_in\">require</span>(<span class=\"string\">'vue'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> Koa = <span class=\"built_in\">require</span>(<span class=\"string\">'koa'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> Router = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-router'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> renderer = <span class=\"built_in\">require</span>(<span class=\"string\">'vue-server-renderer'</span>).createRenderer({</span><br><span class=\"line\">  template: <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>).readFileSync(<span class=\"string\">'./index.html'</span>, <span class=\"string\">'utf-8'</span>)</span><br><span class=\"line\">}) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 1、创建 koa、koa-router 实例</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Koa()</span><br><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"keyword\">new</span> Router()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2、路由中间件</span></span><br><span class=\"line\">router.get(<span class=\"string\">'*'</span>, <span class=\"keyword\">async</span> (ctx, next) => {</span><br><span class=\"line\">  <span class=\"comment\">// 渲染上下文对象：title、meta 会插入模板中</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> context = {</span><br><span class=\"line\">    title: ctx.url,</span><br><span class=\"line\">    meta: <span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">      &lt; meta charset=\"UTF-8\" &gt;</span></span><br><span class=\"line\"><span class=\"string\">      &lt; meta name=\"description\" content=\"基于webpack、koa搭建的SSR\" &gt;</span></span><br><span class=\"line\"><span class=\"string\">    `</span></span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 创建Vue实例</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> vue_app = <span class=\"keyword\">new</span> Vue({</span><br><span class=\"line\">    data: {</span><br><span class=\"line\">      url: ctx.url</span><br><span class=\"line\">    },</span><br><span class=\"line\">    template: <span class=\"string\">`{{ url }}`</span></span><br><span class=\"line\">  })</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 有错误返回 500，无错误返回 html</span></span><br><span class=\"line\">  <span class=\"keyword\">try</span> {</span><br><span class=\"line\">    <span class=\"keyword\">const</span> html = <span class=\"keyword\">await</span> renderer.renderToString(vue_app, context)</span><br><span class=\"line\">    ctx.status = <span class=\"number\">200</span></span><br><span class=\"line\">    <span class=\"comment\">// html 结构会插入到 template 中的 !--vue-ssr-outlet--></span></span><br><span class=\"line\">    ctx.body = html</span><br><span class=\"line\">  } <span class=\"keyword\">catch</span> (error) {</span><br><span class=\"line\">    ctx.status = <span class=\"number\">500</span></span><br><span class=\"line\">    ctx.body = <span class=\"string\">'Internal Server Error'</span></span><br><span class=\"line\">  }</span><br><span class=\"line\">})</span><br><span class=\"line\">app.use(router.routes()).use(router.allowedMethods())</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3、启动服务</span></span><br><span class=\"line\">app.listen(<span class=\"number\">3000</span>, () => {</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">`server started at localhost:3000`</span>)</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h3 id=\"结果分析\"><a href=\"#结果分析\" class=\"headerlink\" title=\"结果分析\"></a>结果分析</h3><ul><li>SPA：前端打包后的 html 只包含 head 部分，body 部分都是动态插入到 <code>div id = \"app\"</code></li><li>SSR：服务器提前编译 Vue 资源生成 HTML 并返回给浏览器，这样网络爬虫爬取的内容就是网站上所有可呈现的内容</li></ul><h2 id=\"项目构建\"><a href=\"#项目构建\" class=\"headerlink\" title=\"项目构建\"></a>项目构建</h2><blockquote><p>vue-ssr 代码库</p></blockquote><h3 id=\"基础构建\"><a href=\"#基础构建\" class=\"headerlink\" title=\"基础构建\"></a>基础构建</h3><ul><li>webpack 配置<ul><li>新增：<code>webpack.server.conf.js</code></li><li>修改：<code>vue-loader.conf.js、webpack.base/prod.conf.js</code></li></ul></li><li>入口配置：<code>main.js、entry-client.js、entry-server.js</code></li><li>组件修改<ul><li>修改 router 路由文件，给每个请求一个新的 router 实例</li><li>修改状态管理 vuex 文件，给每个请求一个新的 store 实例</li><li>通过 asyncData 方法获取异步数据</li></ul></li><li>服务器配置<ul><li>根目录新建 server.js 文件</li><li>修改 package.json 文件</li><li>修改 index.html 文件</li></ul></li><li>启动项目<ul><li>安装依赖：<code>cnpm install</code></li><li>打包文件：<code>npm run build</code></li><li>启动服务：<code>node server.js</code></li></ul></li></ul><h3 id=\"服务端预拉取数据\"><a href=\"#服务端预拉取数据\" class=\"headerlink\" title=\"服务端预拉取数据\"></a>服务端预拉取数据</h3><div style=\"text-indent:2em\">如果应用程序依赖于一些异步数据，那么在开始渲染过程之前，需要先预取和解析好这些数据，并将数据拼装到全局 Vuex状态中。但是需要注意：在挂载到客户端应用程序之前，需要获取到与服务器端应用程序完全相同的数据，否则 客户端应用程序会因为使用与服务器端应用程序不同的状态 导致混合失败。</div><br><div style=\"text-indent:2em\">目前较好的解决方案是：给路由匹配的一级子组件一个 asyncData 方法，asyncData 是约定的函数名，表示渲染组件需要预先执行它获取初始数据，它返回一个 Promise，以便后端渲染时可以知道什么时候该操作完成。注意，由于此函数会在组件实例化之前调用，所以它无法访问 this，需要将 store 和路由信息作为参数传递进去。</div><h1 id=\"四、模块引用\"><a href=\"#四、模块引用\" class=\"headerlink\" title=\"四、模块引用\"></a>四、模块引用</h1><h2 id=\"npm-安装的模块\"><a href=\"#npm-安装的模块\" class=\"headerlink\" title=\"npm 安装的模块\"></a>npm 安装的模块</h2><blockquote><p>默认全局引用，局部引用就是在组件中按需引用</p></blockquote><h3 id=\"常用模块\"><a href=\"#常用模块\" class=\"headerlink\" title=\"常用模块\"></a>常用模块</h3><ul><li>安装：<code>cnpm install axios vuex element-ui vue-awesome-swiper echarts -S</code><ul><li>-D / –save: 生产环境还要用到的包 (package.json/dependencies )</li><li>-S / –save-dev: 只在开发环境用到的包 (package.json/devDependencies)</li></ul></li><li>配置<figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// main.js </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// axios</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> axios <span class=\"keyword\">from</span> <span class=\"string\">'axios'</span></span><br><span class=\"line\">Vue.prototype.$axios = axios</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 自定义配置 axios</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> ajax <span class=\"keyword\">from</span> <span class=\"string\">'./axios/http'</span></span><br><span class=\"line\">Vue.prototype.$<span class=\"keyword\">get</span> = ajax.<span class=\"keyword\">get</span></span><br><span class=\"line\">Vue.prototype.$post = ajax.post</span><br><span class=\"line\"></span><br><span class=\"line\">// 组件库</span><br><span class=\"line\">import ElementUI from 'element-ui'</span><br><span class=\"line\">import 'element-ui/lib/theme-chalk/index.css'</span><br><span class=\"line\">Vue.use(ElementUI)</span><br><span class=\"line\"></span><br><span class=\"line\">// 轮播插件</span><br><span class=\"line\">import VueAwesomeSwiper from 'vue-awesome-swiper'</span><br><span class=\"line\">import 'swiper/dist/css/swiper.css'</span><br><span class=\"line\">Vue.use(VueAwesomeSwiper)</span><br><span class=\"line\"></span><br><span class=\"line\">// 图表插件</span><br><span class=\"line\">import echarts from \"echarts\"\t\t</span><br><span class=\"line\">Vue.prototype.$echarts = echarts </span><br><span class=\"line\"></span><br><span class=\"line\">// vuex</span><br><span class=\"line\">import store from './vuex/index'</span><br><span class=\"line\">new Vue({</span><br><span class=\"line\">  el: <span class=\"string\">'#app'</span>,</span><br><span class=\"line\">  router,</span><br><span class=\"line\">  store,</span><br><span class=\"line\">  data: {</span><br><span class=\"line\">    <span class=\"comment\">// 根组件的空实例</span></span><br><span class=\"line\">    eventHub: <span class=\"keyword\">new</span> Vue()</span><br><span class=\"line\">  }</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure></li></ul><h3 id=\"Sass\"><a href=\"#Sass\" class=\"headerlink\" title=\"Sass\"></a>Sass</h3><ul><li>安装：<code>cnpm install sass-loader node-sass css-loader -S</code></li><li>使用：<code>style lang=\"scss\" scoped</code></li><li>配置<figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.base.conf.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = {</span><br><span class=\"line\">  resolve: {</span><br><span class=\"line\">    <span class=\"comment\">// 添加扩展名 .scss</span></span><br><span class=\"line\">    extensions: [<span class=\"string\">'.js'</span>, <span class=\"string\">'.vue'</span>, <span class=\"string\">'.json'</span>, <span class=\"string\">'.scss'</span>],</span><br><span class=\"line\">  },</span><br><span class=\"line\">  <span class=\"built_in\">module</span>: {</span><br><span class=\"line\">    rules: {</span><br><span class=\"line\">      <span class=\"comment\">// 最后添加</span></span><br><span class=\"line\">      {  </span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.scss$/</span>,  </span><br><span class=\"line\">        loaders: [<span class=\"string\">'style'</span>, <span class=\"string\">'css'</span>, <span class=\"string\">'sass'</span>]  </span><br><span class=\"line\">      }</span><br><span class=\"line\">    }</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure></li></ul><h3 id=\"对象展开运算符\"><a href=\"#对象展开运算符\" class=\"headerlink\" title=\"对象展开运算符\"></a>对象展开运算符</h3><ul><li>安装：<code>cnpm install babel-plugin-transform-object-rest-spread -S</code></li><li>使用：<code>...mapGetters([ 'count' ])</code></li><li>配置：<code>.babelrc 文件 -- \"plugins\": [\"transform-object-rest-spread\"]</code></li></ul><h3 id=\"集成-Ace-代码编辑器\"><a href=\"#集成-Ace-代码编辑器\" class=\"headerlink\" title=\"集成 Ace 代码编辑器\"></a>集成 Ace 代码编辑器</h3><ul><li>安装：cnpm install ace-builds -S</li><li>配置：<a href=\"https://blog.csdn.net/YoshinoNanjo/article/details/82978668\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Vue Ace</a></li></ul><h2 id=\"npm-不能安装的插件\"><a href=\"#npm-不能安装的插件\" class=\"headerlink\" title=\"npm 不能安装的插件\"></a>npm 不能安装的插件</h2><blockquote><p>直接引入插件文件</p></blockquote><ul><li>index.html：<code>script src=\"/static/bootstrap.min.js\"</code></li><li>main.js：<code>import '@/assets/css/bootstrap.min.css'</code></li></ul><h2 id=\"静态资源\"><a href=\"#静态资源\" class=\"headerlink\" title=\"静态资源\"></a>静态资源</h2><h3 id=\"global-scss\"><a href=\"#global-scss\" class=\"headerlink\" title=\"global.scss\"></a>global.scss</h3><ul><li>安装：cnpm install sass-resources-loader –save-dev</li><li>注意：如果要导入多个文件则全部导入到 global.scss：@import ‘./reset.scss’</li><li><p>配置</p><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/utils.js -- scss: generateLoaders('sass') </span></span><br><span class=\"line\">scss: generateLoaders(<span class=\"string\">'sass'</span>).concat(</span><br><span class=\"line\">  {</span><br><span class=\"line\">    loader: <span class=\"string\">'sass-resources-loader'</span>,</span><br><span class=\"line\">    options: {</span><br><span class=\"line\">      resources: path.resolve(__dirname, <span class=\"string\">'../src/assets/global.scss'</span>)</span><br><span class=\"line\">    }</span><br><span class=\"line\">  }</span><br><span class=\"line\">)</span><br></pre></td></tr></tbody></table></figure></li></ul><h3 id=\"静态文件\"><a href=\"#静态文件\" class=\"headerlink\" title=\"静态文件\"></a>静态文件</h3><ul><li>js：<code>import user from '@/components/user'</code></li><li>css<ul><li><code>@import './swiper.css'</code></li><li><code>@import '../../assets/scss/mixin.scss'</code></li><li><code>@import url('../assets/css/reset.css')</code></li></ul></li><li>template<ul><li>绝对路径：<code>img src='/static/images/logo.png'</code></li><li>相对路径：<code>img src='../../assets/images/1.png'</code></li></ul></li></ul><h1 id=\"五、基础配置\"><a href=\"#五、基础配置\" class=\"headerlink\" title=\"五、基础配置\"></a>五、基础配置</h1><h2 id=\"快捷键\"><a href=\"#快捷键\" class=\"headerlink\" title=\"快捷键\"></a>快捷键</h2><figure class=\"highlight\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// package.json文件</span><br><span class=\"line\">\"scripts\": {</span><br><span class=\"line\">    \"build\": \"node build/build.js\",</span><br><span class=\"line\">    \"start\": \"rimraf dist && npm run build\"</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"路径别名\"><a href=\"#路径别名\" class=\"headerlink\" title=\"路径别名\"></a>路径别名</h2><blockquote><p>用于以后引用路径时减少复杂度：import getList from ‘api/index’</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.base.conf.js</span></span><br><span class=\"line\">resolve: {</span><br><span class=\"line\">  alias: {</span><br><span class=\"line\">    <span class=\"string\">'vue$'</span>: <span class=\"string\">'vue/dist/vue.esm.js'</span>,</span><br><span class=\"line\">    <span class=\"string\">'@'</span>: resolve(<span class=\"string\">'src'</span>),</span><br><span class=\"line\">    <span class=\"string\">'api'</span>: path.resolve(__dirname, <span class=\"string\">'../src/api'</span>)</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"代码调试\"><a href=\"#代码调试\" class=\"headerlink\" title=\"代码调试\"></a>代码调试</h2><ul><li>开发工具：Chrome vue-devtools</li><li>debugger 模式：修改 config/index.js 文件 <code>devtool: '#eval-source-map'</code></li></ul><h2 id=\"手机查看\"><a href=\"#手机查看\" class=\"headerlink\" title=\"手机查看\"></a>手机查看</h2><blockquote><p>将手机连接到与电脑相同的 Wifi</p></blockquote><ol><li>config/index.js – dev/host：当前电脑的IP地址</li><li>重新启动服务后，在手机上直接打开地址，或者转为二维码之后使用手机扫描</li></ol><h2 id=\"请求代理\"><a href=\"#请求代理\" class=\"headerlink\" title=\"请求代理\"></a>请求代理</h2><blockquote><p>服务器代理网络用户去获取网络信息，可以解决开发环境中的跨域问题</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\">dev: {  </span><br><span class=\"line\">  proxyTable: {   </span><br><span class=\"line\">    <span class=\"string\">'/ajaxUrl'</span>: {      <span class=\"comment\">// 请求地址</span></span><br><span class=\"line\">        target: <span class=\"string\">'http://cangdu.org:8000/'</span>, <span class=\"comment\">// 实际映射到的目标地址</span></span><br><span class=\"line\">        changeOrigin: <span class=\"literal\">true</span>,                <span class=\"comment\">// 是否跨域</span></span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,                     <span class=\"comment\">// https 接口需要配置</span></span><br><span class=\"line\">        pathRewrite: {</span><br><span class=\"line\">            <span class=\"string\">'^/ajaxUrl'</span>: <span class=\"string\">''</span>                <span class=\"comment\">// target 地址的别名</span></span><br><span class=\"line\">        }</span><br><span class=\"line\">    } </span><br><span class=\"line\">  }  </span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"全局接口\"><a href=\"#全局接口\" class=\"headerlink\" title=\"全局接口\"></a>全局接口</h2><blockquote><p>开发环境和生产环境配置不同接口</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/dev.env.js </span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = merge(prodEnv, {</span><br><span class=\"line\">    NODE_ENV: <span class=\"string\">'\"development\"'</span>,</span><br><span class=\"line\">    API_ROOT: <span class=\"string\">'\"http://10.148.221.210:5000/\"'</span>,</span><br><span class=\"line\">    WS_ROOT: <span class=\"string\">'\"ws://10.148.221.210:5001\"'</span></span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// config/prod.env.js </span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = {</span><br><span class=\"line\">    NODE_ENV: <span class=\"string\">'\"production\"'</span>,</span><br><span class=\"line\">    API_ROOT: <span class=\"string\">'\"http://10.148.134.54:5000/\"'</span>,</span><br><span class=\"line\">    WS_ROOT: <span class=\"string\">'\"ws://10.148.134.54:5001\"'</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// axios baseURL</span></span><br><span class=\"line\">axios.defaults.baseURL = process.env.API_ROOT</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 组件 url</span></span><br><span class=\"line\"><span class=\"keyword\">this</span>.websocket = <span class=\"keyword\">new</span> WebSocket(process.env.WS_ROOT)</span><br></pre></td></tr></tbody></table></figure><h1 id=\"六、打包问题\"><a href=\"#六、打包问题\" class=\"headerlink\" title=\"六、打包问题\"></a>六、打包问题</h1><blockquote><p>npm run build 执行打包操作后生成 dist 文件夹</p></blockquote><h2 id=\"资源路径\"><a href=\"#资源路径\" class=\"headerlink\" title=\"资源路径\"></a>资源路径</h2><blockquote><p>打包后资源加载错误，因为绝对路径加载的资源打包后会报错</p></blockquote><ul><li>static 目录<ul><li>特点：文件不会被 wabpack 编译处理，会被直接复制到打包目录</li><li>使用方式<ul><li>HTML 使用相对路径：<code>../static/images/bg.png</code></li><li>JS 使用打包后路径：<code>./static/images/bg.png</code></li><li>CSS 使用根目录路径：<code>../../static/images/bg.png</code></li></ul></li></ul></li><li>assets 目录<ul><li>文件会经过 webpack 打包并重新编译，一般只能使用相对路径</li><li>图片等不能用于动态绑定 因为 webpack 使用 <code>commenJS</code> 规范而必须使用 require</li></ul></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 文件 config/index.js  </span></span><br><span class=\"line\">build: {</span><br><span class=\"line\">  assetsSubDirectory: <span class=\"string\">'./static'</span>,<span class=\"comment\">// 解决 css 路径问题</span></span><br><span class=\"line\">  assetsPublicPath: <span class=\"string\">'./'</span>,      <span class=\"comment\">// 解决 js 路径问题</span></span><br><span class=\"line\">  productionSourceMap: <span class=\"literal\">false</span>   <span class=\"comment\">// 加快编译速度</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 静态资源 build/utils.js  </span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (options.extract) {</span><br><span class=\"line\">  <span class=\"keyword\">return</span> ExtractTextPlugin.extract({</span><br><span class=\"line\">    use: loaders,</span><br><span class=\"line\">    publicPath:<span class=\"string\">'../../'</span>,   <span class=\"comment\">// 打包时提取 CSS</span></span><br><span class=\"line\">    fallback: <span class=\"string\">'vue-style-loader'</span></span><br><span class=\"line\">  })</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"路由模式\"><a href=\"#路由模式\" class=\"headerlink\" title=\"路由模式\"></a>路由模式</h2><blockquote><p>history 路由模式的项目打包后的页面没有渲染</p></blockquote><ul><li>使用hash模式</li><li>设置routes里的路由name</li></ul><h2 id=\"IE-浏览器\"><a href=\"#IE-浏览器\" class=\"headerlink\" title=\"IE 浏览器\"></a>IE 浏览器</h2><blockquote><p>打包后在 IE 浏览器不显示</p></blockquote><ul><li>原因：Promise在ie上的支持不是很好导致的</li><li>解决<ul><li>安装插件：cnpm install –save-dev babel-polyfill</li><li>main.js 引入：import ‘babel-polyfill’</li><li>配置<figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.base.conf.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = {</span><br><span class=\"line\">  entry: {</span><br><span class=\"line\">    app: [<span class=\"string\">\"babel-polyfill\"</span>, <span class=\"string\">\"./src/main.js\"</span>]  </span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure></li></ul></li></ul><h2 id=\"favicon-ico\"><a href=\"#favicon-ico\" class=\"headerlink\" title=\"favicon.ico\"></a>favicon.ico</h2><blockquote><p>地址栏左边的图标文件无法加载，它是代表网站的标志</p></blockquote><ul><li>问题：打印台报错，原因是图标文件不存在或路径错误</li><li>index.html：<code>link rel=\"shortcut icon\" type=\"image/x-icon\" href=\"favicon.ico\"</code></li></ul><h1 id=\"七、静态服务\"><a href=\"#七、静态服务\" class=\"headerlink\" title=\"七、静态服务\"></a>七、静态服务</h1><blockquote><p>打包后快速搭建静态服务器</p></blockquote><ul><li>全局安装：<code>npm install -g live-server / http-server</code></li><li>运行项目：<code>live-server / http-server</code></li><li>快捷命令：<code>\"script\":{ \"server\":\"live-server ./dist --port=8080\" }</code></li></ul><!-- rebuild by neat --></body></html>","site":{"data":{"next":{"override":false,"cache":{"enable":true},"favicon":{"small":"/images/favicon-16.ico","medium":"/images/favicon-32.ico","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"rss":"/atom.xml","footer":{"since":2019,"icon":{"name":"snowflake-o","animated":false,"color":"#808080"},"copyright":"chuangge","powered":{"enable":false,"version":true},"theme":{"enable":false,"version":true},"beian":{"enable":false,"icp":null}},"creative_commons":{"license":"by-nc-sa","sidebar":false,"post":false},"canonical":true,"seo":false,"index_with_subtitle":false,"exturl":false,"menu":{"home":"/ || home  //首页","tags":"/tags/ || tags  //标签","categories":"/categories/ || th   //分类","archives":"/archives/ || archive //归档"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":{"GitHub":"https://github.com/ || github","StackOverflow":"https://stackoverflow.com/ || stack-overflow"},"social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"友情链接","links_layout":"inline","links":{"个人简历":"https://chuanggefighting.github.io/project/","印记中文":"https://www.docschina.org/","在线工具":"http://tool.lu/","Learn Anything":"https://learn-anything.xyz/"},"avatar":{"url":"/images/chuang.png","rounded":true,"opacity":1,"rotated":true},"toc":{"enable":true,"number":true,"wrap":false,"max_depth":6},"sidebar":{"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"read_more_btn":true,"post_meta":{"item_text":true,"created_at":true,"updated_at":{"enabled":true,"another_day":true},"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":true,"awl":4,"wpm":275},"codeblock":{"border_radius":null,"copy_button":{"enable":false,"show_result":false}},"reward":{"enable":false},"related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_edit":{"enable":false,"url":"https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name"},"disable_baidu_tranformation":false,"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"font":{"enable":true,"host":"//fonts.proxy.ustclug.org","global":{"external":true,"family":"Lato","size":16},"headings":{"external":true,"family":"Roboto Slab","size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":"Lobster Two","size":24},"codes":{"external":true,"family":"Roboto Mono","size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css","copy_tex":{"enable":false,"copy_tex_js":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js","copy_tex_css":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css"}}},"pdf":{"enable":false,"per_page":true,"height":"500px","pdfobject":{"cdn":"//cdn.jsdelivr.net/npm/pdfobject@2.1.1/pdfobject.min.js"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":true,"appid":"snOvapuSplYTVflf5p9Ml9JX-gzGzoHsz","appkey":"5ABGdfyEdAtu6lTXdGdo7hf9","notify":false,"verify":false,"placeholder":"ヾﾉ≧∀≦)o 来呀！吐槽一番吧！","avatar":"mm","guest_info":"nick,mail,link","pageSize":10,"visitor":false,"comment_count":true},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"gitalk":{"enable":false,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true},"needmoreshare2":{"enable":true,"postbottom":{"enable":true,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null,"security":false,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":true,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":true,"pace_theme":"pace-theme-center-simple","canvas_nest":{"enable":true,"onmobile":true,"color":"0,0,255","opacity":0.5,"zIndex":-1,"count":99},"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"canvas_nest_nomobile":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"leancloud":null,"valine":null,"gitalk_js":null,"gitalk_css":null,"md5":null},"css":"css","js":"js","images":"images","passage_end_tag":{"enabled":true},"daovoice":true,"daovoice_app_id":"2ed51855"}}},"excerpt":"","more":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><h1 id=\"一、vue-框架\"><a href=\"#一、vue-框架\" class=\"headerlink\" title=\"一、vue 框架\"></a>一、vue 框架</h1><div style=\"text-indent:2em\">Vue 是一套构建用户界面的渐进式 js 框架，它不是一个全能框架而只聚焦于视图层，容易学习和与其它库或已有项目整合。Vue 框架是一个轻量高效的前端组件化方案，它通过简洁的 API 提供高效的数据驱动的组件系统，通过操作数据来实现页面的更新与展示。</div><ul><li>核心思想：<code>数据驱动的组件系统</code></li><li>开发理念：<code>渐进式开发、只关注视图层、组件化、响应式</code><ul><li>渐进式开发：先构建基础的用户界面，然后再根据需求灵活添加功能</li><li>响应式：一个网页，根据不同的分辨率改变网页大小</li><li>适应式：多个不同的网页，根据不同的分辨率自动选择不同页面</li></ul></li><li><a href=\"https://segmentfault.com/p/1210000008583242/read?from=timeline\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">开源项目库</a></li></ul><h2 id=\"MVVM-模式\"><a href=\"#MVVM-模式\" class=\"headerlink\" title=\"MVVM 模式\"></a>MVVM 模式</h2><ul><li><strong>Model</strong>：对应 js 对象的数据部分</li><li><strong>View</strong>：对应 DOM 元素的视图部分</li><li><p><strong>Viewmodel</strong>：绑定数据和 DOM 的中间件</p><div align=\"center\"><br><img src=\"images/vue/vue_bing.png\" alt=\"Vue MVVM\"><br></div><div style=\"text-indent:2em\">DOM Listeners、Data Bindings 是实现双向绑定功能的关键，实现原理是Object.defineProperty 中的 get、set 方法 和消息订阅模式。DOM Listeners 监听页面所有 View 层 DOM 元素的变化，发生变化时 Model 层的数据随之变化。Data Bindings 监听 Model 层的数据，数据发生变化时 View 层的 DOM 元素随之变化。</div><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 对数据对象的每个属性添加对应的 get、set 方法 </span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(data, key, &#123;</span><br><span class=\"line\">    enumerable: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    configurable: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 读取数据时调用</span></span><br><span class=\"line\">    <span class=\"keyword\">get</span>: function() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// do something</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> val;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 对数据进行赋值操作时调用</span></span><br><span class=\"line\">    <span class=\"keyword\">set</span>: function(newVal) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// do something</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></li></ul><h2 id=\"全家桶\"><a href=\"#全家桶\" class=\"headerlink\" title=\"全家桶\"></a>全家桶</h2><blockquote><p>vue 项目的核心构成</p></blockquote><ul><li><strong>vue-cli</strong>：快速搭建大型单页应用的脚手架工具<ul><li>自动生成 Vue 项目的目录和文件，</li><li>通过热加载方式快速启动项目</li><li>利用本地 node 服务器实现页面的实时刷新效果</li></ul></li><li><strong>vue-router</strong>：路由控制工具<ul><li>用于配置路径和组件的映射关系</li><li>通过路径之间的切换而不是传统的超链接方式来实现页面切换</li></ul></li><li><strong>vuex</strong>：状态管理工具<ul><li>为了解决多个组件间的数据通信和状态管理的维护问题而产生</li><li>采用集中存储的方式统一管理项目中所有组件的状态 (组件通信的数据)</li></ul></li><li><strong>axios</strong>：异步通信工具<ul><li>基于Promise的 HTTP 请求客户端</li><li>可以同时在浏览器和 nodejs 中使用</li></ul></li></ul><h1 id=\"二、浏览器渲染-SPA\"><a href=\"#二、浏览器渲染-SPA\" class=\"headerlink\" title=\"二、浏览器渲染 SPA\"></a>二、浏览器渲染 SPA</h1><blockquote><p>将浏览器中直接生成和操作 DOM 的单页面应用程序</p></blockquote><div style=\"text-indent:2em\">整个项目只有 index.html 一个完整页面，页面内容是通过不同的 vue 组件拼接后生成代码片段并添加到该页面的标签中展示出来。src/App.vue 是所有组件的父组件，所有其它组件都通过路由渲染到它的 router-view，然后再将 App.vue 渲染到 index.html。</div><h2 id=\"单页面项目\"><a href=\"#单页面项目\" class=\"headerlink\" title=\"单页面项目\"></a>单页面项目</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 构建流程</span></span><br><span class=\"line\">cnpm install vue webpack vue-cli -g   </span><br><span class=\"line\"></span><br><span class=\"line\">cd workspace</span><br><span class=\"line\">vue init webpack project  <span class=\"comment\">// 生成目录 </span></span><br><span class=\"line\">cd project &amp;&amp; npm i       <span class=\"comment\">// 安装依赖包</span></span><br><span class=\"line\"></span><br><span class=\"line\">npm start                 <span class=\"comment\">// 热加载启动服务</span></span><br><span class=\"line\">npm run build             <span class=\"comment\">// 打包生成静态文件</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// App.vue，兼容 pc 和移动端方案</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  name: <span class=\"string\">\"App\"</span>,</span><br><span class=\"line\">  created()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"built_in\">document</span>.documentElement.clientWidth &gt; <span class=\"number\">640</span>)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">require</span>(<span class=\"string\">'./style/pc.scss'</span>); </span><br><span class=\"line\">        <span class=\"keyword\">this</span>.plaform = <span class=\"string\">'pc'</span>;     <span class=\"comment\">// 父类类名为 .pc</span></span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">require</span>(<span class=\"string\">'./style/mobile.scss'</span>); </span><br><span class=\"line\">        <span class=\"keyword\">this</span>.plaform = <span class=\"string\">'mobile'</span>;  <span class=\"comment\">// 父类类名为.mobile</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 项目目录</span></span><br><span class=\"line\">├── README.md              <span class=\"comment\">// 说明文档</span></span><br><span class=\"line\">├── node_modules           <span class=\"comment\">// 项目依赖包</span></span><br><span class=\"line\">├── .editorconfig          <span class=\"comment\">// 定义代码格式</span></span><br><span class=\"line\">├── .babelrc 　            <span class=\"comment\">// ES6 语法编译配置</span></span><br><span class=\"line\">├── .postcssrc.js          <span class=\"comment\">// css 代码转换配置</span></span><br><span class=\"line\">├── .gitignore             <span class=\"comment\">// git 上传需要忽略的文件格式</span></span><br><span class=\"line\">├── .eslintrc.js           <span class=\"comment\">// eslint 是管理和检测 js 代码风格</span></span><br><span class=\"line\">|</span><br><span class=\"line\">├── index.html             <span class=\"comment\">// 项目入口文件</span></span><br><span class=\"line\">├── package.json           <span class=\"comment\">// 项目基本信息</span></span><br><span class=\"line\">├── package-lock.json      <span class=\"comment\">// 优化性能的新增文件</span></span><br><span class=\"line\">│</span><br><span class=\"line\">├── build                  <span class=\"comment\">// webpack 编译打包配置</span></span><br><span class=\"line\">│   ├── build.js                 <span class=\"comment\">// 打包执行文件</span></span><br><span class=\"line\">│   ├── check-versions.js        <span class=\"comment\">// 检查 node、npm 等版本</span></span><br><span class=\"line\">│   ├── utils.js                 <span class=\"comment\">// 构建常用工具</span></span><br><span class=\"line\">│   ├── vue-loader.conf.js       <span class=\"comment\">// css 加载器配置</span></span><br><span class=\"line\">│   ├── webpack.base.conf.js     <span class=\"comment\">// 基础配置</span></span><br><span class=\"line\">│   ├── webpack.dev.conf.js      <span class=\"comment\">// 开发环境</span></span><br><span class=\"line\">│   └── webpack.prod.conf.js     <span class=\"comment\">// 生产环境</span></span><br><span class=\"line\">│</span><br><span class=\"line\">├── config                <span class=\"comment\">// 项目配置</span></span><br><span class=\"line\">│   ├── dev.env.js               <span class=\"comment\">// 开发环境</span></span><br><span class=\"line\">│   ├── prod.env.js              <span class=\"comment\">// 生产环境</span></span><br><span class=\"line\">│   └── index.js                 <span class=\"comment\">// 基础配置</span></span><br><span class=\"line\">│</span><br><span class=\"line\">├── src                   <span class=\"comment\">// 项目源码</span></span><br><span class=\"line\">│   ├── App.vue                  <span class=\"comment\">// 根组件</span></span><br><span class=\"line\">│   ├── main.js      \t\t\t       <span class=\"comment\">// 主配置文件</span></span><br><span class=\"line\">│   ├── assets                   <span class=\"comment\">// 需要打包的项目静态资源</span></span><br><span class=\"line\">│   │    └── img/js/css</span><br><span class=\"line\">│   ├── components               <span class=\"comment\">// 公共组件目录                 </span></span><br><span class=\"line\">│   │    └── common/page                     </span><br><span class=\"line\">│   │            </span><br><span class=\"line\">│   ├── router           <span class=\"comment\">// 路由配置</span></span><br><span class=\"line\">│   │    └── index.js           </span><br><span class=\"line\">│   │</span><br><span class=\"line\">│   └── vuex             <span class=\"comment\">// Vuex store相关</span></span><br><span class=\"line\">│        ├── index.js</span><br><span class=\"line\">│        ├── action.js             </span><br><span class=\"line\">│        ├── getter.js           </span><br><span class=\"line\">│        └── mutation.js </span><br><span class=\"line\">│</span><br><span class=\"line\">└── <span class=\"keyword\">static</span>              <span class=\"comment\">// 不需要打包的外部插件、公共库等资源</span></span><br><span class=\"line\">    └── css/js/font</span><br></pre></td></tr></table></figure><h2 id=\"多页面项目\"><a href=\"#多页面项目\" class=\"headerlink\" title=\"多页面项目\"></a>多页面项目</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 目录调整</span></span><br><span class=\"line\">src</span><br><span class=\"line\">├── assets</span><br><span class=\"line\">├── components </span><br><span class=\"line\">└── pages</span><br><span class=\"line\">      ├── index</span><br><span class=\"line\">      │    ├── App.vue</span><br><span class=\"line\">      │    ├── index.html</span><br><span class=\"line\">      │    └── index.js</span><br><span class=\"line\">      |</span><br><span class=\"line\">      └── login</span><br><span class=\"line\">          ├── Login.vue</span><br><span class=\"line\">          ├── login.html</span><br><span class=\"line\">          └── login.js</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 修改webpack配置</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 1、utils.js 末尾添加</span></span><br><span class=\"line\"><span class=\"comment\">/* 添加部分 ---------------------------- 开始 */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// glob 模块用于路径匹配配置 (使用 * 等符号)，安装后引用：npm i glob -S </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> glob = <span class=\"built_in\">require</span>(<span class=\"string\">'glob'</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'html-webpack-plugin'</span>)  <span class=\"comment\">// 页面模板</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> PAGE_PATH = path.resolve(__dirname, <span class=\"string\">'../src/pages'</span>)  <span class=\"comment\">// 页面路径</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> merge = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack-merge'</span>)    <span class=\"comment\">// merge处理</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 多入口配置：如果 pages 中存在 js 文件就存在就作为入口处理</span></span><br><span class=\"line\">exports.entries = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> entryFiles = glob.sync(PAGE_PATH + <span class=\"string\">'/*/*.js'</span>)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> map = &#123;&#125;</span><br><span class=\"line\">  entryFiles.forEach(<span class=\"function\">(<span class=\"params\">filePath</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> filename = filePath.substring(filePath.lastIndexOf(<span class=\"string\">'\\/'</span>) + <span class=\"number\">1</span>, filePath.lastIndexOf(<span class=\"string\">'.'</span>))</span><br><span class=\"line\">      map[filename] = filePath</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  <span class=\"keyword\">return</span> map</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 多页面输出配置</span></span><br><span class=\"line\">exports.htmlPlugin = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> entryHtml = glob.sync(PAGE_PATH + <span class=\"string\">'/*/*.html'</span>)</span><br><span class=\"line\">  <span class=\"keyword\">let</span> arr = []</span><br><span class=\"line\">  entryHtml.forEach(<span class=\"function\">(<span class=\"params\">filePath</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> filename = filePath.substring(filePath.lastIndexOf(<span class=\"string\">'\\/'</span>) + <span class=\"number\">1</span>, filePath.lastIndexOf(<span class=\"string\">'.'</span>))</span><br><span class=\"line\">      <span class=\"keyword\">let</span> conf = &#123;</span><br><span class=\"line\">          template: filePath,  <span class=\"comment\">// 模板来源</span></span><br><span class=\"line\">          filename: filename + <span class=\"string\">'.html'</span>,   <span class=\"comment\">// 文件名称</span></span><br><span class=\"line\">          <span class=\"comment\">// 页面模板需要添加对应的 js 脚本，不加则每个页面都会引入所有 js 脚本</span></span><br><span class=\"line\">          chunks: [<span class=\"string\">'manifest'</span>, <span class=\"string\">'vendor'</span>, filename],</span><br><span class=\"line\">          inject: <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (process.env.NODE_ENV === <span class=\"string\">'production'</span>) &#123;</span><br><span class=\"line\">          conf = merge(conf, &#123;</span><br><span class=\"line\">              minify: &#123;</span><br><span class=\"line\">                  removeComments: <span class=\"literal\">true</span>,</span><br><span class=\"line\">                  collapseWhitespace: <span class=\"literal\">true</span>,</span><br><span class=\"line\">                  removeAttributeQuotes: <span class=\"literal\">true</span></span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">              chunksSortMode: <span class=\"string\">'dependency'</span></span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      arr.push(<span class=\"keyword\">new</span> HtmlWebpackPlugin(conf))</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  <span class=\"keyword\">return</span> arr</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/* 添加部分 ---------------------------- 结束 */</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2、webpack.base.conf.js 修改</span></span><br><span class=\"line\">entry: utils.entries(),  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3、webpack.dev.conf.js、webpack.prod.conf.js</span></span><br><span class=\"line\">plugins: [</span><br><span class=\"line\">    <span class=\"comment\">/* 注释 ------------- 开始 */</span></span><br><span class=\"line\">    <span class=\"comment\">// new HtmlWebpackPlugin(&#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//   filename: </span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;),</span></span><br><span class=\"line\">    <span class=\"comment\">/* 注释 ------------- 结束 */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* 添加 ------------------ */</span></span><br><span class=\"line\">].concat(utils.htmlPlugin())</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 初始化页面</span></span><br><span class=\"line\"><span class=\"comment\">// 1、index.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> index <span class=\"keyword\">from</span> <span class=\"string\">'./App.vue'</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> Vue(&#123;</span><br><span class=\"line\">  el: <span class=\"string\">'#app'</span>,</span><br><span class=\"line\">  router,</span><br><span class=\"line\">  components: &#123; index &#125;,</span><br><span class=\"line\">  template: <span class=\"string\">'&amp;lt;index/&amp;gt;'</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2、login.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> LoginView <span class=\"keyword\">from</span> <span class=\"string\">'./Login.vue'</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> Vue(&#123;</span><br><span class=\"line\">  el: <span class=\"string\">'#app'</span>,</span><br><span class=\"line\">  render: <span class=\"function\"><span class=\"params\">h</span> =&gt;</span> h(LoginView)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3、index.html 页面跳转：a href='login.html'</span></span><br></pre></td></tr></table></figure><h2 id=\"首屏加载优化\"><a href=\"#首屏加载优化\" class=\"headerlink\" title=\"首屏加载优化\"></a>首屏加载优化</h2><ul><li>首屏加载效果<ul><li>页面内容加载完成前使用 loading、进度条、骨架屏 可以提升用户体验</li><li>骨架屏：vue-skeleton 使用一些空白内容的图形来展示未加载内容</li></ul></li><li>路由懒加载<ul><li><code>const login = resolve =&gt; require([&#39;common/Login.vue&#39;], resolve)</code></li></ul></li><li>使用 v-if 减少不必要的组件加载：显示时才渲染弹窗等组件</li><li>通过 CDN 引入资源，减小服务器带宽压力<ul><li>项目依赖会被全部打包到 vender.js，文件很大时首屏加载较慢</li><li>使用 cdn 文件代替就不会被打包进去，加载速度较快</li></ul></li><li>将图片等一些静态资源放到云服务器，减小服务器压力</li><li>需加载三方资源：按需引入 ElementUI 等组件库</li><li>若首屏为登录页则可做成多入口</li><li>webpack 开启 gzip 压缩</li></ul><h2 id=\"预渲染\"><a href=\"#预渲染\" class=\"headerlink\" title=\"预渲染\"></a>预渲染</h2><blockquote><p>在构建阶段简单地生成生成匹配特定路由的静态 html 文件</p></blockquote><ul><li>插件安装：<code>npm i prerender-spa-plugin -S</code></li><li>插件配置：<code>build/webpack.prod.conf.js</code></li><li><p>路由配置：<code>route/index.js</code></p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.prod.conf.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> PrerenderSPAPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'prerender-spa-plugin'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> Renderer = PrerenderSPAPlugin.PuppeteerRenderer</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> webpackConfig = merge(baseWebpackConfig, &#123;</span><br><span class=\"line\">    plugins: [</span><br><span class=\"line\">        <span class=\"keyword\">new</span> PrerenderSPAPlugin(&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 生成文件的路径，该目录只能有一级，</span></span><br><span class=\"line\">            <span class=\"comment\">// vue-cli3.0 时修改为 '/dist'</span></span><br><span class=\"line\">            staticDir: path.join(__dirname, <span class=\"string\">'../dist'</span>),</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">// 路由文件，如果有参数则比如 /index/</span></span><br><span class=\"line\">            routes: [<span class=\"string\">'/'</span>, <span class=\"string\">'/index'</span>, <span class=\"string\">'/home'</span>],</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">// 没有配置则不会进行预编译</span></span><br><span class=\"line\">            renderer: <span class=\"keyword\">new</span> Renderer(&#123;</span><br><span class=\"line\">                inject: &#123;</span><br><span class=\"line\">                  foo: <span class=\"string\">'bar'</span></span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                headless: <span class=\"literal\">false</span>,</span><br><span class=\"line\">                renderAfterDocumentEvent: <span class=\"string\">'render-event'</span></span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// route/index.js</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">new</span> Router(&#123;</span><br><span class=\"line\">    mode: <span class=\"string\">'history'</span>, </span><br><span class=\"line\">    routes: []</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></li></ul><h1 id=\"三、服务器端渲染-SSR\"><a href=\"#三、服务器端渲染-SSR\" class=\"headerlink\" title=\"三、服务器端渲染 SSR\"></a>三、服务器端渲染 SSR</h1><blockquote><p>服务端拼接出带数据的 html 并发送到前端，前端把 html 插入到指定节点并渲染页面</p></blockquote><div style=\"text-indent:2em\">Vue 是一个构建客户端应用的框架，即 vue 组件是在浏览器中进行渲染的。所谓服务端渲染，是指 Vue 服务端通过预拉取数据实现组件的初始化，然后启用虚拟 DOM 渲染为初始化的 HTML 字符串并发送到客户端，最后需要将这些静态标记”激活”为客户端上完全可交互的应用程序，从而实现前后端同构应用。服务器和客户端都会运行的代码为 通用代码，即 同构。</div><ul><li>优点<ul><li>更好的SEO，搜索引擎爬虫可以抓取渲染好的页面</li><li>更快的首屏渲染时间，产生更好的用户体验，无需等待 Js 加载完成后才显示</li></ul></li><li>缺点<ul><li>更多的服务器端负载（CPU 和内存资源）</li><li>更复杂的开发和部署（兼容 Node 执行环境）</li></ul></li></ul><h2 id=\"渲染过程\"><a href=\"#渲染过程\" class=\"headerlink\" title=\"渲染过程\"></a>渲染过程</h2><ul><li>利用 webpack 需要分别对客户端代码和服务器端代码分别打包成两个 json 文件</li><li>server-bundle 发送给服务器用于生成首屏页面 html</li><li>client-bundle 发送给浏览器用于混合静态标记</li><li><p>server.js 文件将两个打包文件和 HTML 模板混合生成 HTML 返回给浏览器渲染</p><div align=\"center\"><br><img src=\"images/vue/vue-ssr.png\" alt=\"Vue SSR\"><br></div></li></ul><h2 id=\"开发约束\"><a href=\"#开发约束\" class=\"headerlink\" title=\"开发约束\"></a>开发约束</h2><blockquote><p>通用代码应该兼容浏览器和服务端 Node 的执行环境</p></blockquote><ul><li>不可使用全局环境变量：window、document 等只能在浏览器中运行</li><li>生命周期钩子函数只有 beforeCreate、created 能同时运行在前后端</li><li>避免状态单例<ul><li>Node 服务器是一个长期运行的进程，代码进入该进程时就会取值并留存在内存。如果创建一个实例对象，它将在每个传入的请求之间共享，容易导致交叉请求状态污染。所以应该暴露一个可以重复执行的工厂函数，为每个请求创建新实例</li><li>同样的规则也适用于 router、store、event bus 实例。你不应该直接从模块导出并将其导入到应用程序中。而是需要在 createApp 中创建一个新实例并从根实例注入</li></ul></li></ul><h2 id=\"模板插值\"><a href=\"#模板插值\" class=\"headerlink\" title=\"模板插值\"></a>模板插值</h2><h3 id=\"安装模块\"><a href=\"#安装模块\" class=\"headerlink\" title=\"安装模块\"></a>安装模块</h3><ul><li>安装：<code>cnpm i vue vue-server-renderer koa koa-router -S</code></li><li>vue-server-renderer：获取 vue 实例并渲染成 html 结构，并配合 webpack 构建项目</li></ul><h3 id=\"单个文件\"><a href=\"#单个文件\" class=\"headerlink\" title=\"单个文件\"></a>单个文件</h3><div align=\"center\"><br><img src=\"images/vue/vue-render-1.png\" alt=\"vue-server-renderer\"><br></div><h3 id=\"目录文件\"><a href=\"#目录文件\" class=\"headerlink\" title=\"目录文件\"></a>目录文件</h3><div align=\"center\"><br><img src=\"images/vue/vue-render-2.png\" alt=\"vue-render-index\"><br></div><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> Vue = <span class=\"built_in\">require</span>(<span class=\"string\">'vue'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> Koa = <span class=\"built_in\">require</span>(<span class=\"string\">'koa'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> Router = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-router'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> renderer = <span class=\"built_in\">require</span>(<span class=\"string\">'vue-server-renderer'</span>).createRenderer(&#123;</span><br><span class=\"line\">  template: <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>).readFileSync(<span class=\"string\">'./index.html'</span>, <span class=\"string\">'utf-8'</span>)</span><br><span class=\"line\">&#125;) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 1、创建 koa、koa-router 实例</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Koa()</span><br><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"keyword\">new</span> Router()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2、路由中间件</span></span><br><span class=\"line\">router.get(<span class=\"string\">'*'</span>, <span class=\"keyword\">async</span> (ctx, next) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 渲染上下文对象：title、meta 会插入模板中</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> context = &#123;</span><br><span class=\"line\">    title: ctx.url,</span><br><span class=\"line\">    meta: <span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">      &amp;lt; meta charset=\"UTF-8\" &amp;gt;</span></span><br><span class=\"line\"><span class=\"string\">      &amp;lt; meta name=\"description\" content=\"基于webpack、koa搭建的SSR\" &amp;gt;</span></span><br><span class=\"line\"><span class=\"string\">    `</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 创建Vue实例</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> vue_app = <span class=\"keyword\">new</span> Vue(&#123;</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      url: ctx.url</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    template: <span class=\"string\">`&#123;&#123; url &#125;&#125;`</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 有错误返回 500，无错误返回 html</span></span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> html = <span class=\"keyword\">await</span> renderer.renderToString(vue_app, context)</span><br><span class=\"line\">    ctx.status = <span class=\"number\">200</span></span><br><span class=\"line\">    <span class=\"comment\">// html 结构会插入到 template 中的 !--vue-ssr-outlet--&gt;</span></span><br><span class=\"line\">    ctx.body = html</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">    ctx.status = <span class=\"number\">500</span></span><br><span class=\"line\">    ctx.body = <span class=\"string\">'Internal Server Error'</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">app.use(router.routes()).use(router.allowedMethods())</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3、启动服务</span></span><br><span class=\"line\">app.listen(<span class=\"number\">3000</span>, () =&gt; &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">`server started at localhost:3000`</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h3 id=\"结果分析\"><a href=\"#结果分析\" class=\"headerlink\" title=\"结果分析\"></a>结果分析</h3><ul><li>SPA：前端打包后的 html 只包含 head 部分，body 部分都是动态插入到 <code>div id = &quot;app&quot;</code></li><li>SSR：服务器提前编译 Vue 资源生成 HTML 并返回给浏览器，这样网络爬虫爬取的内容就是网站上所有可呈现的内容</li></ul><h2 id=\"项目构建\"><a href=\"#项目构建\" class=\"headerlink\" title=\"项目构建\"></a>项目构建</h2><blockquote><p>vue-ssr 代码库</p></blockquote><h3 id=\"基础构建\"><a href=\"#基础构建\" class=\"headerlink\" title=\"基础构建\"></a>基础构建</h3><ul><li>webpack 配置<ul><li>新增：<code>webpack.server.conf.js</code></li><li>修改：<code>vue-loader.conf.js、webpack.base/prod.conf.js</code></li></ul></li><li>入口配置：<code>main.js、entry-client.js、entry-server.js</code></li><li>组件修改<ul><li>修改 router 路由文件，给每个请求一个新的 router 实例</li><li>修改状态管理 vuex 文件，给每个请求一个新的 store 实例</li><li>通过 asyncData 方法获取异步数据</li></ul></li><li>服务器配置<ul><li>根目录新建 server.js 文件</li><li>修改 package.json 文件</li><li>修改 index.html 文件</li></ul></li><li>启动项目<ul><li>安装依赖：<code>cnpm install</code></li><li>打包文件：<code>npm run build</code></li><li>启动服务：<code>node server.js</code></li></ul></li></ul><h3 id=\"服务端预拉取数据\"><a href=\"#服务端预拉取数据\" class=\"headerlink\" title=\"服务端预拉取数据\"></a>服务端预拉取数据</h3><div style=\"text-indent:2em\">如果应用程序依赖于一些异步数据，那么在开始渲染过程之前，需要先预取和解析好这些数据，并将数据拼装到全局 Vuex状态中。但是需要注意：在挂载到客户端应用程序之前，需要获取到与服务器端应用程序完全相同的数据，否则 客户端应用程序会因为使用与服务器端应用程序不同的状态 导致混合失败。</div><br><div style=\"text-indent:2em\">目前较好的解决方案是：给路由匹配的一级子组件一个 asyncData 方法，asyncData 是约定的函数名，表示渲染组件需要预先执行它获取初始数据，它返回一个 Promise，以便后端渲染时可以知道什么时候该操作完成。注意，由于此函数会在组件实例化之前调用，所以它无法访问 this，需要将 store 和路由信息作为参数传递进去。</div><h1 id=\"四、模块引用\"><a href=\"#四、模块引用\" class=\"headerlink\" title=\"四、模块引用\"></a>四、模块引用</h1><h2 id=\"npm-安装的模块\"><a href=\"#npm-安装的模块\" class=\"headerlink\" title=\"npm 安装的模块\"></a>npm 安装的模块</h2><blockquote><p>默认全局引用，局部引用就是在组件中按需引用</p></blockquote><h3 id=\"常用模块\"><a href=\"#常用模块\" class=\"headerlink\" title=\"常用模块\"></a>常用模块</h3><ul><li>安装：<code>cnpm install axios vuex element-ui vue-awesome-swiper echarts -S</code><ul><li>-D / –save: 生产环境还要用到的包 (package.json/dependencies )</li><li>-S / –save-dev: 只在开发环境用到的包 (package.json/devDependencies)</li></ul></li><li>配置<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// main.js </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// axios</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> axios <span class=\"keyword\">from</span> <span class=\"string\">'axios'</span></span><br><span class=\"line\">Vue.prototype.$axios = axios</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 自定义配置 axios</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> ajax <span class=\"keyword\">from</span> <span class=\"string\">'./axios/http'</span></span><br><span class=\"line\">Vue.prototype.$<span class=\"keyword\">get</span> = ajax.<span class=\"keyword\">get</span></span><br><span class=\"line\">Vue.prototype.$post = ajax.post</span><br><span class=\"line\"></span><br><span class=\"line\">// 组件库</span><br><span class=\"line\">import ElementUI from 'element-ui'</span><br><span class=\"line\">import 'element-ui/lib/theme-chalk/index.css'</span><br><span class=\"line\">Vue.use(ElementUI)</span><br><span class=\"line\"></span><br><span class=\"line\">// 轮播插件</span><br><span class=\"line\">import VueAwesomeSwiper from 'vue-awesome-swiper'</span><br><span class=\"line\">import 'swiper/dist/css/swiper.css'</span><br><span class=\"line\">Vue.use(VueAwesomeSwiper)</span><br><span class=\"line\"></span><br><span class=\"line\">// 图表插件</span><br><span class=\"line\">import echarts from \"echarts\"\t\t</span><br><span class=\"line\">Vue.prototype.$echarts = echarts </span><br><span class=\"line\"></span><br><span class=\"line\">// vuex</span><br><span class=\"line\">import store from './vuex/index'</span><br><span class=\"line\">new Vue(&#123;</span><br><span class=\"line\">  el: <span class=\"string\">'#app'</span>,</span><br><span class=\"line\">  router,</span><br><span class=\"line\">  store,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 根组件的空实例</span></span><br><span class=\"line\">    eventHub: <span class=\"keyword\">new</span> Vue()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></li></ul><h3 id=\"Sass\"><a href=\"#Sass\" class=\"headerlink\" title=\"Sass\"></a>Sass</h3><ul><li>安装：<code>cnpm install sass-loader node-sass css-loader -S</code></li><li>使用：<code>style lang=&quot;scss&quot; scoped</code></li><li>配置<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.base.conf.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  resolve: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 添加扩展名 .scss</span></span><br><span class=\"line\">    extensions: [<span class=\"string\">'.js'</span>, <span class=\"string\">'.vue'</span>, <span class=\"string\">'.json'</span>, <span class=\"string\">'.scss'</span>],</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    rules: &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 最后添加</span></span><br><span class=\"line\">      &#123;  </span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.scss$/</span>,  </span><br><span class=\"line\">        loaders: [<span class=\"string\">'style'</span>, <span class=\"string\">'css'</span>, <span class=\"string\">'sass'</span>]  </span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id=\"对象展开运算符\"><a href=\"#对象展开运算符\" class=\"headerlink\" title=\"对象展开运算符\"></a>对象展开运算符</h3><ul><li>安装：<code>cnpm install babel-plugin-transform-object-rest-spread -S</code></li><li>使用：<code>...mapGetters([ &#39;count&#39; ])</code></li><li>配置：<code>.babelrc 文件 -- &quot;plugins&quot;: [&quot;transform-object-rest-spread&quot;]</code></li></ul><h3 id=\"集成-Ace-代码编辑器\"><a href=\"#集成-Ace-代码编辑器\" class=\"headerlink\" title=\"集成 Ace 代码编辑器\"></a>集成 Ace 代码编辑器</h3><ul><li>安装：cnpm install ace-builds -S</li><li>配置：<a href=\"https://blog.csdn.net/YoshinoNanjo/article/details/82978668\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Vue Ace</a></li></ul><h2 id=\"npm-不能安装的插件\"><a href=\"#npm-不能安装的插件\" class=\"headerlink\" title=\"npm 不能安装的插件\"></a>npm 不能安装的插件</h2><blockquote><p>直接引入插件文件</p></blockquote><ul><li>index.html：<code>script src=&quot;/static/bootstrap.min.js&quot;</code></li><li>main.js：<code>import &#39;@/assets/css/bootstrap.min.css&#39;</code></li></ul><h2 id=\"静态资源\"><a href=\"#静态资源\" class=\"headerlink\" title=\"静态资源\"></a>静态资源</h2><h3 id=\"global-scss\"><a href=\"#global-scss\" class=\"headerlink\" title=\"global.scss\"></a>global.scss</h3><ul><li>安装：cnpm install sass-resources-loader –save-dev</li><li>注意：如果要导入多个文件则全部导入到 global.scss：@import ‘./reset.scss’</li><li><p>配置</p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/utils.js -- scss: generateLoaders('sass') </span></span><br><span class=\"line\">scss: generateLoaders(<span class=\"string\">'sass'</span>).concat(</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    loader: <span class=\"string\">'sass-resources-loader'</span>,</span><br><span class=\"line\">    options: &#123;</span><br><span class=\"line\">      resources: path.resolve(__dirname, <span class=\"string\">'../src/assets/global.scss'</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure></li></ul><h3 id=\"静态文件\"><a href=\"#静态文件\" class=\"headerlink\" title=\"静态文件\"></a>静态文件</h3><ul><li>js：<code>import user from &#39;@/components/user&#39;</code></li><li>css<ul><li><code>@import &#39;./swiper.css&#39;</code></li><li><code>@import &#39;../../assets/scss/mixin.scss&#39;</code></li><li><code>@import url(&#39;../assets/css/reset.css&#39;)</code></li></ul></li><li>template<ul><li>绝对路径：<code>img src=&#39;/static/images/logo.png&#39;</code></li><li>相对路径：<code>img src=&#39;../../assets/images/1.png&#39;</code></li></ul></li></ul><h1 id=\"五、基础配置\"><a href=\"#五、基础配置\" class=\"headerlink\" title=\"五、基础配置\"></a>五、基础配置</h1><h2 id=\"快捷键\"><a href=\"#快捷键\" class=\"headerlink\" title=\"快捷键\"></a>快捷键</h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// package.json文件</span><br><span class=\"line\">\"scripts\": &#123;</span><br><span class=\"line\">    \"build\": \"node build/build.js\",</span><br><span class=\"line\">    \"start\": \"rimraf dist &amp;&amp; npm run build\"</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"路径别名\"><a href=\"#路径别名\" class=\"headerlink\" title=\"路径别名\"></a>路径别名</h2><blockquote><p>用于以后引用路径时减少复杂度：import getList from ‘api/index’</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.base.conf.js</span></span><br><span class=\"line\">resolve: &#123;</span><br><span class=\"line\">  alias: &#123;</span><br><span class=\"line\">    <span class=\"string\">'vue$'</span>: <span class=\"string\">'vue/dist/vue.esm.js'</span>,</span><br><span class=\"line\">    <span class=\"string\">'@'</span>: resolve(<span class=\"string\">'src'</span>),</span><br><span class=\"line\">    <span class=\"string\">'api'</span>: path.resolve(__dirname, <span class=\"string\">'../src/api'</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"代码调试\"><a href=\"#代码调试\" class=\"headerlink\" title=\"代码调试\"></a>代码调试</h2><ul><li>开发工具：Chrome vue-devtools</li><li>debugger 模式：修改 config/index.js 文件 <code>devtool: &#39;#eval-source-map&#39;</code></li></ul><h2 id=\"手机查看\"><a href=\"#手机查看\" class=\"headerlink\" title=\"手机查看\"></a>手机查看</h2><blockquote><p>将手机连接到与电脑相同的 Wifi</p></blockquote><ol><li>config/index.js – dev/host：当前电脑的IP地址</li><li>重新启动服务后，在手机上直接打开地址，或者转为二维码之后使用手机扫描</li></ol><h2 id=\"请求代理\"><a href=\"#请求代理\" class=\"headerlink\" title=\"请求代理\"></a>请求代理</h2><blockquote><p>服务器代理网络用户去获取网络信息，可以解决开发环境中的跨域问题</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\">dev: &#123;  </span><br><span class=\"line\">  proxyTable: &#123;   </span><br><span class=\"line\">    <span class=\"string\">'/ajaxUrl'</span>: &#123;      <span class=\"comment\">// 请求地址</span></span><br><span class=\"line\">        target: <span class=\"string\">'http://cangdu.org:8000/'</span>, <span class=\"comment\">// 实际映射到的目标地址</span></span><br><span class=\"line\">        changeOrigin: <span class=\"literal\">true</span>,                <span class=\"comment\">// 是否跨域</span></span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,                     <span class=\"comment\">// https 接口需要配置</span></span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">            <span class=\"string\">'^/ajaxUrl'</span>: <span class=\"string\">''</span>                <span class=\"comment\">// target 地址的别名</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">  &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"全局接口\"><a href=\"#全局接口\" class=\"headerlink\" title=\"全局接口\"></a>全局接口</h2><blockquote><p>开发环境和生产环境配置不同接口</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/dev.env.js </span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = merge(prodEnv, &#123;</span><br><span class=\"line\">    NODE_ENV: <span class=\"string\">'\"development\"'</span>,</span><br><span class=\"line\">    API_ROOT: <span class=\"string\">'\"http://10.148.221.210:5000/\"'</span>,</span><br><span class=\"line\">    WS_ROOT: <span class=\"string\">'\"ws://10.148.221.210:5001\"'</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// config/prod.env.js </span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    NODE_ENV: <span class=\"string\">'\"production\"'</span>,</span><br><span class=\"line\">    API_ROOT: <span class=\"string\">'\"http://10.148.134.54:5000/\"'</span>,</span><br><span class=\"line\">    WS_ROOT: <span class=\"string\">'\"ws://10.148.134.54:5001\"'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// axios baseURL</span></span><br><span class=\"line\">axios.defaults.baseURL = process.env.API_ROOT</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 组件 url</span></span><br><span class=\"line\"><span class=\"keyword\">this</span>.websocket = <span class=\"keyword\">new</span> WebSocket(process.env.WS_ROOT)</span><br></pre></td></tr></table></figure><h1 id=\"六、打包问题\"><a href=\"#六、打包问题\" class=\"headerlink\" title=\"六、打包问题\"></a>六、打包问题</h1><blockquote><p>npm run build 执行打包操作后生成 dist 文件夹</p></blockquote><h2 id=\"资源路径\"><a href=\"#资源路径\" class=\"headerlink\" title=\"资源路径\"></a>资源路径</h2><blockquote><p>打包后资源加载错误，因为绝对路径加载的资源打包后会报错</p></blockquote><ul><li>static 目录<ul><li>特点：文件不会被 wabpack 编译处理，会被直接复制到打包目录</li><li>使用方式<ul><li>HTML 使用相对路径：<code>../static/images/bg.png</code></li><li>JS 使用打包后路径：<code>./static/images/bg.png</code></li><li>CSS 使用根目录路径：<code>../../static/images/bg.png</code></li></ul></li></ul></li><li>assets 目录<ul><li>文件会经过 webpack 打包并重新编译，一般只能使用相对路径</li><li>图片等不能用于动态绑定 因为 webpack 使用 <code>commenJS</code> 规范而必须使用 require</li></ul></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 文件 config/index.js  </span></span><br><span class=\"line\">build: &#123;</span><br><span class=\"line\">  assetsSubDirectory: <span class=\"string\">'./static'</span>,<span class=\"comment\">// 解决 css 路径问题</span></span><br><span class=\"line\">  assetsPublicPath: <span class=\"string\">'./'</span>,      <span class=\"comment\">// 解决 js 路径问题</span></span><br><span class=\"line\">  productionSourceMap: <span class=\"literal\">false</span>   <span class=\"comment\">// 加快编译速度</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 静态资源 build/utils.js  </span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (options.extract) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> ExtractTextPlugin.extract(&#123;</span><br><span class=\"line\">    use: loaders,</span><br><span class=\"line\">    publicPath:<span class=\"string\">'../../'</span>,   <span class=\"comment\">// 打包时提取 CSS</span></span><br><span class=\"line\">    fallback: <span class=\"string\">'vue-style-loader'</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"路由模式\"><a href=\"#路由模式\" class=\"headerlink\" title=\"路由模式\"></a>路由模式</h2><blockquote><p>history 路由模式的项目打包后的页面没有渲染</p></blockquote><ul><li>使用hash模式</li><li>设置routes里的路由name</li></ul><h2 id=\"IE-浏览器\"><a href=\"#IE-浏览器\" class=\"headerlink\" title=\"IE 浏览器\"></a>IE 浏览器</h2><blockquote><p>打包后在 IE 浏览器不显示</p></blockquote><ul><li>原因：Promise在ie上的支持不是很好导致的</li><li>解决<ul><li>安装插件：cnpm install –save-dev babel-polyfill</li><li>main.js 引入：import ‘babel-polyfill’</li><li>配置<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.base.conf.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  entry: &#123;</span><br><span class=\"line\">    app: [<span class=\"string\">\"babel-polyfill\"</span>, <span class=\"string\">\"./src/main.js\"</span>]  </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id=\"favicon-ico\"><a href=\"#favicon-ico\" class=\"headerlink\" title=\"favicon.ico\"></a>favicon.ico</h2><blockquote><p>地址栏左边的图标文件无法加载，它是代表网站的标志</p></blockquote><ul><li>问题：打印台报错，原因是图标文件不存在或路径错误</li><li>index.html：<code>link rel=&quot;shortcut icon&quot; type=&quot;image/x-icon&quot; href=&quot;favicon.ico&quot;</code></li></ul><h1 id=\"七、静态服务\"><a href=\"#七、静态服务\" class=\"headerlink\" title=\"七、静态服务\"></a>七、静态服务</h1><blockquote><p>打包后快速搭建静态服务器</p></blockquote><ul><li>全局安装：<code>npm install -g live-server / http-server</code></li><li>运行项目：<code>live-server / http-server</code></li><li>快捷命令：<code>&quot;script&quot;:{ &quot;server&quot;:&quot;live-server ./dist --port=8080&quot; }</code></li></ul><!-- rebuild by neat -->"},{"title":"web 项目开发","top":false,"keywords":["前端开发"],"date":"2019-02-17T07:41:48.000Z","description":"常用网站、浏览器、服务器、渲染模式、框架模式、Restful 规范、JS 运行机制","_content":"\n# 一、技术栈\n> web 开发就是呈现用户可理解的界面并响应用户操作\n\n<div align=\"center\">\n![前端技能图](images/web/technology.png)\n</div> \n\n# 二、程序员网站       \n  1. __常用__\n    * [印记中文](https://www.docschina.org/)：教程中文版\n    * [站长工具](http://tool.chinaz.com/tools/openweb.aspx/)：代码整理和测试\n    * [在线工具](http://tool.lu/)：代码处理工具合集\n    * [Github](https://github.com/)：代码托管\n    * [Stack Overflow](https://stackoverflow.com/)：技术问答社区\n    * [Learn Anything](https://stackoverflow.com/)：思维导图形式学习技术\n  2. __提升__\n    * [百度脑图](http://naotu.baidu.com/)：思维导图          \n    * [ProcessOn](https://slides.com/)：脑图工具         \n    * [Slides](https://www.processon.com/)：WebPPT 编辑器        \n    * [CanIuse](https://caniuse.com/)：浏览器兼容         \n    * [Overapi](http://overapi.com/)：API速查手册  \n    * [RunJS](https://runjs.cn/)：JS在线编辑和分享         \n    * [Standardjs](https://standardjs.com/)：JS编码规范   \n    * [Faviconer](https://www.favicon-generator.org/)：图标生成器                    \n  3. __了解__\n    * [零花钱](https://github.com/easychen/howto-make-more-money)：接单网站 \n    * [Electron](https://electronjs.org/)：跨平台程序  \n    * [.gitignore](https://github.com/github/gitignore)：不同语言项目 \n    * [墨刀](https://modao.cc/)：在线制作移动应用原型 \n\n\n\n# 三、浏览器的结构和渲染\n\n## 页面判断\n> PC 端还是移动端\n\n  * 功能检测：`“touchstart” in document`\n  * 特征检测：`navigator.userAgent`\n\n\n## 分层结构\n> 浏览器的抽象分层结构图中将浏览器分成了以下子系统\n\n  * __用户界面__：用于和用户进行交互的功能组件，如地址栏、返回、前进按钮等\n  * __浏览器引擎__：用于查询和操作渲染引擎的界面\n  * __渲染引擎__：负责显示请求的内容，如果请求 HTML 则它解析 HTML 和 CSS 并显示\n  * __网络__：负责处理网络相关的事务，如 HTTP 请求等\n  * __UI 后端__：负责绘制提示框等浏览器组件，底层使用操作系统的用户接口\n  * __Js 解释器__：负责解析和执行 JavaScript 代码\n  * __数据存储__：负责持久存储 cookie 和缓存等应用数据\n\n  <div align=\"center\"> \n    ![浏览器结构](images/web/browserCom.png)\n  </div> \n\n## 渲染流程\n  1. 解析HTML结构（构建 DOM 树）\n  2. 加载外部脚本和css文件（构建 CSSOM 树）\n  3. 解析并执行脚本代码（js 代码）\n  4. DOM 树构建完成（此时触发 DOMContentLoaded 事件）\n  5. 加载外部静态文件（图标图片等）\n  6. 页面加载完成（此时会触发 load 事件）\n\n  <div align=\"center\">\n    ![浏览器渲染](images/web/browerRender.png) \n  </div> \n\n\n## 渲染问题\n  * 资源下载\n    * 图片下载不会产生阻塞\n    * css 下载时会阻塞渲染，但带有 media 属性除外\n      * css 是由单独的下载线程异步下载的\n      * css 加载不会阻塞 DOM 树解析，但会阻塞 render 树渲染（需要 css 信息）\n    * 遇到 script 标签时，DOM 构建停止直到 js 脚本下载并执行完毕，此时浏览器一般会下载其他资源但不会解析。如果 js 中有对 CSSOM 的操作，还会先确保 CSSOM 已经被下载并构建。\n  * 重绘重排导致重新进行渲染树的生成\n    * 重绘：简单外观的改变就会引起重绘，比如颜色变化等。重排一定重绘。\n    * 重排(回流)：重新计算布局，通常由元素的结构、增删、位置、尺寸变化引起。比如 img 下载成功后替换填充页面 img 元素而引起尺寸变化。也会由 js 的属性值读取引起，比如读取 offset、scroll、cilent、getComputedStyle 等信息。\n  * 优化方法\n    * 直接改变 className，如果动态改变样式则使用 cssText\n    * 让要操作的元素进行离线处理，处理完后一起更新\n      * 使用 `display: none`，只引发两次回流和重绘\n      * 使用 `DocumentFragment` 进行缓存操作，引发一次回流和重绘\n      * 使用 `cloneNode(true/false)、replaceChild`，引发一次回流和重绘\n\n\n\n## 渲染优化\n  * 简化 DOM 结构，最好不深于六层\n  * 尽量缓存 DOM 查找，查找器尽量简洁\n  * 涉及多域名的网站，可以开启域名预解析\n  * 动画尽量使用在 绝对/固定 定位 的元素上\n  * 隐藏在屏幕外 或 页面滚动时，尽量停止动画\n  * DOM 操作尽量通过缓存减少次数，避免过度触发回流\n  * js 脚本放在页面 body 底部，减少对其他过程的阻塞\n  * Js 修改元素样式操作尽量减少，使用类名修改或动画操作样式\n  * 减少首次下载的文件数量大小，使用图片懒加载、js 按需加载等方式\n  * css 尽量层次简单并放入 head，提前加载并防止 html 渲染后重新结合 css 引起页面闪烁\n\n\n# 四、Web 服务器\n\n## 服务器\n> 从硬件上来看，服务器是一台配置比较高的PC机器。但是从软件角度根据用途可分为 web 服务器、数据库服务器等，用来处理客户端请求的服务器有以下两种：\n          \n  * __web 服务器__\n    * 又称 HTTP 服务器，包括 Apache、Nginx 等\n    * 专注于处理 HTTP 协议、传递本地磁盘上的静态资源给客户端，常用于提供代理服务\n  * __应用服务器__\n    * 提供可以处理业务逻辑的方法，包括 WebLogic、Tomcat 等\n    * 常用来加载动态内容和处理响应数据并返回给客户端，但则只能访问其安装目录中的文件\n\n\n## 代理\n  * __代理服务器__\n    * 一种具有转发功能的应用程序，扮演了位于服务器和客户端之间\"中间人\"的角色\n    * 接收由客户端发送的请求并转发给服务器，同时也接收服务器返回的响应并转发给客户端\n  * __正向代理__\n    * 隐藏了真实的请求客户端，客户端请求的服务都被代理服务器代替来请求\n    * 比如翻墙的原理就是在国外搭建一台代理服务器，代理去访问国外网址并返回结果给国内客户端\n  * __反向代理__\n    * 隐藏了真实的服务端，反向代理服务器会帮客户端把请求转发到真实服务器\n    * 常用来做负载均衡，比如访问百度时会有很多服务器接收服务\n  * __应用__\n    * web 项目开发时联合使用 apache + tomcat + nginx \n    * 访问静态、动态资源时使用 apache/tomcat 解析\n    * nginx 作为反向代理服务器，同时支持高并发\n\n    \n## 运行机制\n  <div style=\"text-indent: 2em; margin-top: 15px;\">Apache 等传统 Web 服务器采用了多线程模型，它会为每个客户端请求分配一个线程来同步执行 I/O 操作，系统通过线程池进行线程切换来减少时间开销。这种方式容易造成阻塞，而且浪费 CPU 和内存，当连接达到一定数量时可能会导致服务器耗光内存而崩溃，只适用于 异步操作较少但业务逻辑较复杂的应用。这就是 `线程驱动`。</div>\n   \n\n\n# 五、Web 渲染模式\n> 客户端是上网时使用的手机、电脑等机器，而服务器是性能较强大的机器，可保持长时间运行并保证可随时访问服务器上文件\n\n## 客户端渲染\n  * 实现原理：浏览器异步请求服务器获取数据，然后浏览器拼接 数据和模板文件 得到最终的 HTML字符串，最后直接解析并渲染到页面。\n  * 优势\n    * 页面切换速度快\n      * 传统网站中的不同页面切换是通过服务器加载一个新的页面\n      * SPA 模型中是通过动态地重写部分页面实现局部刷新和懒加载\n    * 一定程度上减少了服务器的压力，浏览器负责页面逻辑和渲染\n    * 前后端分离设计，服务器只需要提供接口\n  * 问题\n    * SEO：传统的搜索引擎只会从 HTML 中抓取数据，导致前端渲染的页面无法被抓取。\n    * 首屏性能：用户首次加载页面时，需要先下载框架和应用程序的代码，然后再渲染页面。比如常用的 SPA 会把所有 JS 整体打包导致文件太大，页面加载时间较长而可能导致白屏问题，用户体验比较差。\n\n## 预渲染\n> 用来改善少数营销页面的 SEO 而无需使用 web 服务器实时动态编译 HTML\n\n  * 实现原理：即在构建阶段简单地生成匹配特定路由的静态 html 文件，可以通过 webpack 的 prerender-spa-plugin 轻松添加。\n  * 优点：设置简单，并且可以将前端页面作为一个完全静态的站点\n    缺点：搜索引擎不能抓取到 网页内容和结构，而且不能插入动态数据\n\n\n## 服务端渲染\n> 指传统的 ASP、Java 或 PHP 的渲染机制，是预渲染的升级机制\n\n  * 实现原理：浏览器发起请求后，服务端将 数据和模板拼接生成的 html 字符串返回给浏览器，浏览器只是进行解析和渲染。\n  * 优点\n    * 更好的 SEO：搜索引擎爬虫可以抓取渲染好的页面\n    * 更少的客户端电量消耗：对于电量有限的手机或平板比较重要\n    * 更快的内容到达时间：首屏加载更快而避免白屏问题，因为服务端只需要返回渲染好的 HTML\n  * 缺点\n    * 更多的服务器端负载（CPU 和内存资源）\n    * 更复杂的开发和部署（兼容 Node 执行环境）\n    * 不利于前后端分离，开发效率低\n\n\n## 同构渲染\n> 在服务器和客户端都可以运行的代码程序叫 同构，注意需要兼容 Node.js 的执行环境\n\n  * 实现原理：浏览器发起请求后，服务器将 数据和模板拼接生成的 html 字符串返回给浏览器，浏览器将其插入到指定节点后渲染页面。\n  * 优点\n    * 提高首屏性能\n    * 对搜索引擎友好，有助于 SEO\n    * 前后端共用一套 Node.js 代码，节省开发时间\n  * 缺点\n    * 内存溢出\n    * 异步操作\n    * 大量计算、个性化缓存等性能\n    * 服务器端和浏览器的环境差异\n\t* 复杂类型无法转义为字符串形式发送给前端\n\n\n## 架构选择\n  * 同构前一定要考虑到浏览器和服务器的环境差异，站在更高层面考虑\n  * 对于需要做 SEO 的项目，如果是一个后台应用，则只要首页做一些静态内容宣导即可。如果是内容型网站，那么可以考虑专门做一些页面给搜索引擎。\n  * 对于前端渲染首屏问题，我们可以采用分拆打包（路由库）、交互优化（加载动画）、部分同构（使用同构把菜单和页面骨架渲染出来） 等一些方式合理利用同构。\n\n\n\n# 六、Web 框架模式\n\n## 框架和库\n  * 类库：一个有组织的功能集合，用于提供特定功能的接口并被调用\n  * 框架：构建应用程序的整体架构，使开发者可以专注于逻辑处理而提高开发效率\n  * 联系：框架一般会集成大量库并在合适地方调用，有时也可称为库，区别在于思考角度\n\n\n## 框架模式\n\n### MVC\n  * 实现思路：所有的终端用户请求被发送到 Controller，Controller 依赖请求去选择加载哪个模型并附加到对应 View，最终 View 作为响应发送给终端用户。\n  * 缺陷：包含大量的业务逻辑后，代码就会难以阅读和维护。\n\n  <div align=\"center\"> \n    ![MVC](images/web/mvc.png) \n  </div> \n\n\n### MVP\n  * 实现思路：切断的 View 和 Model 的联系, 让 View 只和 Presenter（原Controller）交互，减少在需求变化中需要维护的对象的数量，相比 MVC 成本更低而且更容易理解。\n  * 缺陷：最接近用户的界面是需要根据需求变化而频繁更改的。\n\n  <div align=\"center\">\n    ![MVP](images/web/mvp.png) \n  </div> \n\n\n### MTV\n  * 实现思路：Model 负责业务对象和数据库的关系映射(ORM)，Template 负责如何把页面展示给用户(html)，View 负责业务逻辑并在适当时候调用 Model和Template。此外，通过一个URL分发器将一个个URL的页面请求分发给不同的View处理，View再调用相应的Model和Template。\n\n  <div align=\"center\">\n    ![MTV](images/web/mtv.png)\n  </div> \n\n\n### MVVM\n  * 实现思路：View 接收用户交互请求并发给ViewModel --> ViewModel 操作 Model 数据更新 --> Model 更新后通知 ViewModel 数据化 --> ViewModel 更新 View 数据。这样开发者只需关注业务逻辑，不需要手动操作DOM和关注数据状态的同步问题，复杂的数据状态维护完全由 MVVM 来统一管理，完美解决了复杂交互导致代码难以维护的问题。\n  * 优点\n    * 独立开发（可专注于业务逻辑和数据）\n    * 低耦合性（View 和 Model 相互独立）\n    * 可重用性（可让多个 View 重用一段视图逻辑）\n    * 方便测试（可测试 ViewModel，而 Controller 不可）\n  * 缺点\n    * 调用复杂度增加\n    * viewModel 会越来越庞大（逻辑多）\n    * 类会增多（每个VC都附带一个 viewModel）\n\n  <div align=\"center\">\n    ![MVVM](images/web/mvvm.png)\n  </div> \n\n\n## 框架分类\n  * 可视化组件：Echarts\n  * UI 框架：Bootstrap、EasyUI、ElementUI\n  * JS 框架：jQuery、Zepto.js、NodeJs、requirejs、VueJs、angularJS、reactJS\n\n\n\n# 七、Restful 架构\n  <div style=\"text-indent: 2em\">RESTful 是一种架构的规范与约束、原则而并非架构或标准，符合这种规范的架构就是 RESTful架构。基于这个风格设计的软件可以更简洁，更有层次，更容易实现缓存等机制，常用于客户端和服务器交互类的软件。</div>\n\n## 架构\n  * RESTful 架构：面向资源的架构，即针对资源设计接口。客户端操作通过资源对应的 URL 进行操作，从而访问服务器端资源。\n  * SOA 架构：面向服务的体系结构。SOA将不同的功能组件视为一种服务并分别封装，降低了组件之间的耦合程度，增加了代码的复用程度。\n\n\n## 特点\n  * 资源；作为资源的标识，比如 html / jpg / json\n  * URI：统一资源定位符，即每个 URI 对应一个特定的资源\n  * 无状态：所有资源都可以通过 URI 去定位，而不与其他资源产生耦合\n  * 统一接口：数据元操作CURD 分别对应http的 get、post、put、delete\n\n\n## URI \n  1. __区别 URL__\n    * URI：统一资源定位符，对应具体的资源。\n    * URL：统一资源标识符，对应具体的资源的地址\n    * 联系：URL 是属于 URI 的一部分 \n  2. __规范__\n    * 不用大写\n    * 用中杠 - 不用下杠 _ \n    * 参数列表要 encode\n    * 名词表示资源集合，资源集合时使用复数形式如 zoos/1/animals \n    * 每个网址代表一种资源，所以网址中不能有动词，一般只能有名词，而且所用的名词往往与数据库的表格名对应\n  3. __版本__\n   <div style=\"text-indent: 2em\">应该将API的版本号放入到URI中：/api.example.com/v1/zoos</div>\n  4. __通信__\n    * 前后端统一使用 json 数据\n    * 客户端通过url中的 `？& ,` 实现过滤、搜索等复杂操作\n    * 客户端通过标准的 HTTP 方法（`GET获取、POST新建、PUT更新、DELETE删除`）对应服务器端资源 CRUD（数据元操作，包括 `SELECT、CREATE、UPDATE、DELETE`）\n\n\n\n# 八、JS 运行机制\n\n## JS 解析引擎\n  * __js 引擎__：能够读懂 JavaScript 代码并能准确运行出结果的一段程序\n  * __V8 引擎__：为了提高 JS 的运行性能，在运行之前会将JS编译为本地的机器码，然后再去执行机器码。底层采用 C/C++ 编写。\n  * 对于 Java、C++、C 等静态语言处理上述事情的叫 `编译器`，而对于 JavaScript 这样的动态语言则叫做 `解释器`。区别：编译器是将源代码编译为另外一种代码（比如机器码或者字节码），而解释器是直接解析并将代码运行结果输出 \n\n## 进程和线程\n\n### 区分\n  * __CPU__：工厂，是执行计算任务的计算机核心 \n  * __进程__：工厂车间，是 CPU 资源分配和独立运行的最小单位，用来完成一个任务\n  * __线程__：车间工人，是可以独立运行的最小的 CPU 单位，用来协同其它线程完成一个任务\n\n\n### 模式\n> 进程里并发运行的线程会共享该进程下有限的内存地址空间，运行模式必须确保同一进程里的线程不会相互影响\n\n  * __单线程__：所有任务在主线程中排队执行\n  * __多线程__：任务在各自独立的线程中执行而互不影响，同一进程下的所有线程共享变量  \n  * __多进程__：允许多个任务同时运行，各个进程的变量互不影响，但会消耗更多的内存等资源\n  * __协调机制__：防止进程之间、线程之间产生冲突，并允许进程之间、线程之间共享资源\n\n\n## JS 的单线程\n> 单线程即 JS 引擎线程 称为 主线程，处理耗时异步任务的其它线程称为 工作线程\n\n<div style=\"text-indent: 2em\">`单线程是指浏览器中负责解释和执行 Js 代码的 JS 引擎线程只能有一个`，称为 `主线程`，所以同一时间只能执行一个任务，其他任务需要排队等待执行。之所以是单线程，是因为 JS 的主要用途是与用户互动和操作 DOM，多线程同时操作会带来复杂的同步问题。为了利用多核 CPU 的计算功能，HTML5 提出了 web worker 标准，允许 JS 脚本创建多个线程来处理耗时操作，但是 Worker 是 JS 引擎向浏览器申请开的子线程，它完全受主线程控制并且不能操作 DOM，所以这个新标准并没有改变JS单线程的本质。</div>\n \n  * __WebWorker__\n    * 特点：只属于某个页面，不会和其他页面的 Render 进程共享\n    * 创建：Chrome 会在 Render 进程中新建一个 Worker 线程来运行 js 程序\n  * __SharedWorker__\n    * 特点：浏览器的所有页面共享\n    * 创建：Chrome 会创建一个新的进程来运行 Js 程序，但是相同的 Js 只存在一个 SharedWorker 进程而不管它被创建多少次\n\n\n## 浏览器的多进程\n> 浏览器是多进程的，每打开一个 Tab 页就相当于创建了一个独立的进程。浏览器由于系统给它的进程分配了内存等资源而可以运行\n\n### 内部进程\n  * __Browser 进程__：浏览器的主进程 (负责协调和主控)，只有一个\n    * 负责浏览器界面显示，与用户交互。如前进，后退等\n    * 负责各个页面的管理，创建和销毁其他进程\n    * 将渲染进程得到的内存中的 Bitmap，绘制到用户界面上\n    * 负责网络资源的管理、下载等\n  * __第三方插件进程__：每种类型的插件对应一个进程\n  * __GPU 进程__：用于 3D 绘制等，最多一个\n  * __Render 进程__：浏览器内核，内部是多线程的\n    * 功能：负责页面渲染、脚本执行、事件处理等\n    * 特点：默认每个 Tab 页面对应一个进程并互不影响\n    \n\n### 多进程的优势\n> 如果浏览器是单进程，则某个 Tab 页或插件崩溃了就会影响整个浏览器，用户体验不好\n\n  * 避免单个page crash影响整个浏览器\n  * 避免第三方插件crash影响整个浏览器\n  * 多进程充分利用多核优势\n  * 方便使用沙盒模型隔离插件等进程，提高浏览器稳定性\n\n\n### 浏览器内核的多线程\n> 浏览器的渲染进程是多线程的\n\n<div style=\"text-indent: 2em\">由于 JavaScript 可以操作 DOM，如果在修改这些元素属性同时渲染界面（即JS线程和UI线程同时运行），那么渲染线程前后获得的元素数据就可能不一致了。因此为了防止渲染出现不可预期的结果，`浏览器设置 GUI 渲染线程与 JS 引擎线程为互斥的关系，当JS引擎执行时 GUI 线程会被挂起，GUI 更新则会被保存在一个队列中等到 JS 引擎线程空闲时立即被执行。所以 JS 如果执行时间过长就会导致页面渲染加载阻塞。`</div>\n\n  * __GUI 渲染线程__\n    * 负责渲染浏览器界面，解析 HTML、CSS，构建 DOM、RenderObject 树等\n    * 当界面需要重绘 Repaint 或由于某种操作引发回流 reflow 时，该线程就会执行 \n  * __JS 引擎线程__\n    * 即 JS 内核，负责处理 Js 脚本程序\n    * 负责解析执行 Javascript 脚本代码\n    * 一直通过事件循环机制，查看并执行任务队列中的任务\n  * __事件触发线程__\n    * 归属于浏览器而不是 JS 引擎，用来控制事件循环\n    * JS 引擎执行 setTimeOut、Ajax 等代码块时，会将对应任务添加到事件线程中\n    * 某事件符合条件被触发时，该线程把事件添加到任务队列的队尾等待处理\n    * 注意：由于 JS 的单线程，队列中的事件都需要排队等待 JS 引擎空闲时才去执行\n  * __定时触发器线程__\n    * setInterval、setTimeout 所在线程，用来计时并触发定时\n    * 计时完毕后，添加到事件队列中，等待 JS 引擎空闲时执行\n    * 注意：W3C 规定 setTimeout 中低于 4ms 的时间间隔算为 4ms\n  * __异步 http 请求线程__\n    * XMLHttpRequest 连接后是通过浏览器新开一个线程请求\n    * 检测到状态变更时，如果设置有回调函数，异步线程就产生状态变更事件，将回调函数再放入事件队列中等待 Js 引擎执行\n\n\n\n### 浏览器内核和 Browser 进程的通信\n  1. Browser 进程收到用户请求，通过网络下载或本地加载获取页面内容\n  2. Renderer 进程的接口收到 Browser 进程传递的请求，然后交给渲染线程执行\n    1. 渲染线程收到请求后，加载网页并渲染网页，\n    2. 渲染过程中可能需要 Browser 进程获取资源和需要 GPU 进程帮助渲染\n    3. 可能会有 JS 线程操作 DOM，这样可能会造成回流并重绘\n    4. Render 进程将渲染结果传递给 Browser 进程\n  3. Browser 进程接收到结果并将结果绘制出来\n\n\n## JS 异步机制\n\n### 同步和异步\n<div style=\"text-indent: 2em;\">公路上的多辆汽车按顺序运行，这时有车坏掉了。同步模式就是让故障车停在原地修理，后面的车就会被堵住无法行驶。异步模式则是把故障车辆推到应急车道修理，正常的车流不受影响，车修好之后从应急车道回到正常车道即可，唯一的影响就是过多的应急车道会打乱车流顺序。简单来说，`同步可以保证顺序一致但容易导致阻塞，异步可以解决阻塞问题但会改变顺序性。具体使用时，浏览器端的 Ajax 等耗时长的操作、服务器端的所有操作 都应该异步执行`，否则容易导致浏览器或服务器失去响应，因为执行环境是单线程的。</div> \n\n * 同步模式\n  * 所有任务在主线程的执行栈中排队等待\n  * 类似银行排队办业务，当前执行的耗时任务会阻塞后续代码的执行 \n * 异步模式\n  * 本质是事件驱动模式，返回结果后通知调用\n  * 主线程执行同步任务，工作线程执行耗时异步任务\n  * 类似餐厅点餐，当前执行的任务不会阻塞后续代码的执行\n\n\n### JS 任务\n> 所有任务都是在主线程上执行，形成一个执行栈\n\n  * 产生\n    * 执行 js 代码\n    * 对用户操作作出反应\n    * 处理异步的网络请求\n  * 分类\n    * __同步任务__：主线程的执行栈中排队执行的任务 \n    * __异步任务__：添加到任务列队中延迟执行的任务\n      * __宏任务__\n        * 特点：一次事件循环中只执行第一个，然后重新渲染页面 \n        * 场景：script 代码块、setTimeout、setInterval 等\n        * 管理：事件触发线程维护的宏任务队列\n      * __微任务__\n        * 特点：一次事件循环中全部执行，在页面渲染之前完成\n        * 场景：Promise、process.nextTick 等 \n        * 管理：JS 引擎线程维护的微任务队列\n  * __异步任务__\n    * onclick 等事件的销毁函数\n      * 当事件触发时，回调函数会被立即添加到任务队列中\n      * 由浏览器内核的 DOM Binding 模块处理\n    * setInterval 等计时器\n      * 当定时器时间到，就把该事件放到 任务队列中 等待处理\n      * 由浏览器内核的 timer 模块进行延时处理\n    * Ajax 请求\n      * 在网络请求完成返回之后，将回调函数添加到任务队列中\n      * 由浏览器内核的 network 模块处理\n\n\n  ```js\n  var test = function(){\n\n    // 同步任务\n    console.log(\"start\"); \n\n    // 异步宏任务\n    setTimeout(function(){\n        console.log(\"异步宏任务\");\n    }, 300);\n\n    // 异步微任务\n    Promise.resolve(42).then(value =>{\n        console.log(value);\n    })\n\n    // 同步任务\n    console.log(\"end\");\n  }\n  test();\n  ```\n\n\n### 任务队列\n> 一个 消息(事件) 的队列，具有先进先出的特点\n\n  * 解析异步操作后，相关的异步任务（ 事件、回调函数），就会被放到任务队列中，等待被处理\n  * 只有主线程中的任务全部执行完，任务队列中的异步任务才会被放到主线程的执行栈中开始执行\n\n\n### 事件循环 \n> Event Loop，指主线程重复从任务队列中读取事件并执行的过程 \n\n  * JS 会创建一个 类似 while(true) 的循环，每执行一次循环体的过程叫 tick\n  * 过程：查看任务队列中是都有待处理的事件，如果有：则取出，放到js主线程中执行\n  * JS 是运行在单线程上的，所以浏览器都会单独开启一个线程来处理事件消息的轮询，避免阻塞js的执行。\n\n\n### 异步过程 \n> 回调函数就是被主线程挂起来延迟执行的代码，主线程执行的异步任务就是对应的回调函数\n\n  1. 主线程执行 `异步发起函数`，将异步任务转交给相应的工作线程\n  2. 主线程继续执行后面的其它代码，同时工作线程执行异步任务\n  3. 工作线程完成异步任务后，将调用 `回调函数` 的事件添加到任务队列等待处理\n  4. 主线程空闲时，通过 `事件循环机制` 从任务队列中读取事件并放入执行栈，然后开始执行\n\n  <div align=\"center\"> \n    ![Ajax实现过程](images/web/ajax-process.png) \n  </div>\n\n  <div style=\"text-indent: 2em;\">从生产者与消费者的角度看，异步过程是这样的：工作线程是生产者，主线程是消费者(只有一个消费者)。工作线程执行异步任务，执行完成后把对应的回调函数封装成一条消息放到消息队列中。主线程不断地从消息队列中取消息并执行，当消息队列为空时主线程阻塞，直到消息队列再次非空。</div> \n\n\n\n## js 执行机制\n> 关键是事件循环机制\n\n  1. JS 引擎将所有操作分为 同步任务、异步任务\n  2. 同步任务进入主线程，然后直接按顺序执行\n  3. 异步任务进入工作线程，当满足触发条件后推入任务队列\n  4. 主线程执行完所有同步任务之后空闲时，重复去任务队列中查看是否有可执行的异步任务，有则推入主进程的执行栈\n    1. 执行一个宏任务（栈中没有就从事件队列中获取）\n    2. 执行过程中如果遇到微任务，就将它添加到微任务的任务队列中\n    3. 宏任务执行完毕后，立即执行当前微任务队列中的所有微任务（依次执行）\n    4. 当前宏任务执行完毕，开始检查渲染，然后 GUI 线程接管渲染\n    5. 渲染完毕后，JS 线程继续接管，开始下一个宏任务（从任务队列中获取）\n\n  \n  <div align=\"center\">\n    ![js 执行机制](images/web/js-run.png) \n  </div>\n\n\n  ```js\n  // 输出结果：1、7、6、8、2、4、3、5、9、11、10、12\n\n  console.log('1');\n\n  setTimeout(function() {\n      console.log('2');\n      process.nextTick(function() {\n          console.log('3');\n      })\n      new Promise(function(resolve) {\n          console.log('4');\n          resolve();\n      }).then(function() {\n          console.log('5')\n      })\n  })\n  process.nextTick(function() {\n      console.log('6');\n  })\n  new Promise(function(resolve) {\n      console.log('7');\n      resolve();\n  }).then(function() {\n      console.log('8')\n  })\n\n  setTimeout(function() {\n      console.log('9');\n      process.nextTick(function() {\n          console.log('10');\n      })\n      new Promise(function(resolve) {\n          console.log('11');\n          resolve();\n      }).then(function() {\n          console.log('12')\n      })\n  })\n  ```\n\n  1. 第一轮事件循环\n    * 整体 script 作为第一个宏任务进入主线程，执行 console.log 输出 1\n    * setTimeout，其回调函数被分发到宏任务 Event Queue，记为 setTimeout1\n    * process.nextTick()，其回调函数被分发到微任务 Event Queue，记为 process1\n    * Promise，new Promise 直接执行，输出7。then 被分发到微任务 Event Queue，记为 then1\n    * 第二个 setTimeout，其回调函数被分发到宏任务 Event Queue，记为 setTimeout2\n    * 执行两个微任务 process1、then1 输出 6、8\n    * 输出结果：1、7、6、8\n  2. 第二轮事件循环\n    * 从宏任务 setTimeout1 开始，输出 2\n    * process.nextTick()，同样将其分发到微任务Event Queue中，记为 process2\n    * new Promise 立即执行输出 4，then 也分发到微任务 Event Queue，记为 then2\n    * 执行两个微任务 process2、then2 输出 3、5\n    * 输出结果：2、4、3、5\n  3. 第三轮事件循环\n    * 此时只剩下 setTimeout2，执行输出 9\n    * process.nextTick() 分发到微任务 Event Queue，记为process3\n    * new Promise 直接执行输出 11，then 分发到微任务 Event Queue，记为 then3\n    * 执行两个微任务 process3、then3 输出 10、12\n    * 输出结果：9、11、10、12\n\n\n\n\n\n","source":"_posts/2-web开发.md","raw":"---\ntitle: web 项目开发\ntags:\n  - Skill\ncategories: Web Skills\ntop: false\nkeywords:\n  - 前端开发\ndate: 2019-02-17 15:41:48\ndescription: 常用网站、浏览器、服务器、渲染模式、框架模式、Restful 规范、JS 运行机制\n---\n\n# 一、技术栈\n> web 开发就是呈现用户可理解的界面并响应用户操作\n\n<div align=\"center\">\n![前端技能图](images/web/technology.png)\n</div> \n\n# 二、程序员网站       \n  1. __常用__\n    * [印记中文](https://www.docschina.org/)：教程中文版\n    * [站长工具](http://tool.chinaz.com/tools/openweb.aspx/)：代码整理和测试\n    * [在线工具](http://tool.lu/)：代码处理工具合集\n    * [Github](https://github.com/)：代码托管\n    * [Stack Overflow](https://stackoverflow.com/)：技术问答社区\n    * [Learn Anything](https://stackoverflow.com/)：思维导图形式学习技术\n  2. __提升__\n    * [百度脑图](http://naotu.baidu.com/)：思维导图          \n    * [ProcessOn](https://slides.com/)：脑图工具         \n    * [Slides](https://www.processon.com/)：WebPPT 编辑器        \n    * [CanIuse](https://caniuse.com/)：浏览器兼容         \n    * [Overapi](http://overapi.com/)：API速查手册  \n    * [RunJS](https://runjs.cn/)：JS在线编辑和分享         \n    * [Standardjs](https://standardjs.com/)：JS编码规范   \n    * [Faviconer](https://www.favicon-generator.org/)：图标生成器                    \n  3. __了解__\n    * [零花钱](https://github.com/easychen/howto-make-more-money)：接单网站 \n    * [Electron](https://electronjs.org/)：跨平台程序  \n    * [.gitignore](https://github.com/github/gitignore)：不同语言项目 \n    * [墨刀](https://modao.cc/)：在线制作移动应用原型 \n\n\n\n# 三、浏览器的结构和渲染\n\n## 页面判断\n> PC 端还是移动端\n\n  * 功能检测：`“touchstart” in document`\n  * 特征检测：`navigator.userAgent`\n\n\n## 分层结构\n> 浏览器的抽象分层结构图中将浏览器分成了以下子系统\n\n  * __用户界面__：用于和用户进行交互的功能组件，如地址栏、返回、前进按钮等\n  * __浏览器引擎__：用于查询和操作渲染引擎的界面\n  * __渲染引擎__：负责显示请求的内容，如果请求 HTML 则它解析 HTML 和 CSS 并显示\n  * __网络__：负责处理网络相关的事务，如 HTTP 请求等\n  * __UI 后端__：负责绘制提示框等浏览器组件，底层使用操作系统的用户接口\n  * __Js 解释器__：负责解析和执行 JavaScript 代码\n  * __数据存储__：负责持久存储 cookie 和缓存等应用数据\n\n  <div align=\"center\"> \n    ![浏览器结构](images/web/browserCom.png)\n  </div> \n\n## 渲染流程\n  1. 解析HTML结构（构建 DOM 树）\n  2. 加载外部脚本和css文件（构建 CSSOM 树）\n  3. 解析并执行脚本代码（js 代码）\n  4. DOM 树构建完成（此时触发 DOMContentLoaded 事件）\n  5. 加载外部静态文件（图标图片等）\n  6. 页面加载完成（此时会触发 load 事件）\n\n  <div align=\"center\">\n    ![浏览器渲染](images/web/browerRender.png) \n  </div> \n\n\n## 渲染问题\n  * 资源下载\n    * 图片下载不会产生阻塞\n    * css 下载时会阻塞渲染，但带有 media 属性除外\n      * css 是由单独的下载线程异步下载的\n      * css 加载不会阻塞 DOM 树解析，但会阻塞 render 树渲染（需要 css 信息）\n    * 遇到 script 标签时，DOM 构建停止直到 js 脚本下载并执行完毕，此时浏览器一般会下载其他资源但不会解析。如果 js 中有对 CSSOM 的操作，还会先确保 CSSOM 已经被下载并构建。\n  * 重绘重排导致重新进行渲染树的生成\n    * 重绘：简单外观的改变就会引起重绘，比如颜色变化等。重排一定重绘。\n    * 重排(回流)：重新计算布局，通常由元素的结构、增删、位置、尺寸变化引起。比如 img 下载成功后替换填充页面 img 元素而引起尺寸变化。也会由 js 的属性值读取引起，比如读取 offset、scroll、cilent、getComputedStyle 等信息。\n  * 优化方法\n    * 直接改变 className，如果动态改变样式则使用 cssText\n    * 让要操作的元素进行离线处理，处理完后一起更新\n      * 使用 `display: none`，只引发两次回流和重绘\n      * 使用 `DocumentFragment` 进行缓存操作，引发一次回流和重绘\n      * 使用 `cloneNode(true/false)、replaceChild`，引发一次回流和重绘\n\n\n\n## 渲染优化\n  * 简化 DOM 结构，最好不深于六层\n  * 尽量缓存 DOM 查找，查找器尽量简洁\n  * 涉及多域名的网站，可以开启域名预解析\n  * 动画尽量使用在 绝对/固定 定位 的元素上\n  * 隐藏在屏幕外 或 页面滚动时，尽量停止动画\n  * DOM 操作尽量通过缓存减少次数，避免过度触发回流\n  * js 脚本放在页面 body 底部，减少对其他过程的阻塞\n  * Js 修改元素样式操作尽量减少，使用类名修改或动画操作样式\n  * 减少首次下载的文件数量大小，使用图片懒加载、js 按需加载等方式\n  * css 尽量层次简单并放入 head，提前加载并防止 html 渲染后重新结合 css 引起页面闪烁\n\n\n# 四、Web 服务器\n\n## 服务器\n> 从硬件上来看，服务器是一台配置比较高的PC机器。但是从软件角度根据用途可分为 web 服务器、数据库服务器等，用来处理客户端请求的服务器有以下两种：\n          \n  * __web 服务器__\n    * 又称 HTTP 服务器，包括 Apache、Nginx 等\n    * 专注于处理 HTTP 协议、传递本地磁盘上的静态资源给客户端，常用于提供代理服务\n  * __应用服务器__\n    * 提供可以处理业务逻辑的方法，包括 WebLogic、Tomcat 等\n    * 常用来加载动态内容和处理响应数据并返回给客户端，但则只能访问其安装目录中的文件\n\n\n## 代理\n  * __代理服务器__\n    * 一种具有转发功能的应用程序，扮演了位于服务器和客户端之间\"中间人\"的角色\n    * 接收由客户端发送的请求并转发给服务器，同时也接收服务器返回的响应并转发给客户端\n  * __正向代理__\n    * 隐藏了真实的请求客户端，客户端请求的服务都被代理服务器代替来请求\n    * 比如翻墙的原理就是在国外搭建一台代理服务器，代理去访问国外网址并返回结果给国内客户端\n  * __反向代理__\n    * 隐藏了真实的服务端，反向代理服务器会帮客户端把请求转发到真实服务器\n    * 常用来做负载均衡，比如访问百度时会有很多服务器接收服务\n  * __应用__\n    * web 项目开发时联合使用 apache + tomcat + nginx \n    * 访问静态、动态资源时使用 apache/tomcat 解析\n    * nginx 作为反向代理服务器，同时支持高并发\n\n    \n## 运行机制\n  <div style=\"text-indent: 2em; margin-top: 15px;\">Apache 等传统 Web 服务器采用了多线程模型，它会为每个客户端请求分配一个线程来同步执行 I/O 操作，系统通过线程池进行线程切换来减少时间开销。这种方式容易造成阻塞，而且浪费 CPU 和内存，当连接达到一定数量时可能会导致服务器耗光内存而崩溃，只适用于 异步操作较少但业务逻辑较复杂的应用。这就是 `线程驱动`。</div>\n   \n\n\n# 五、Web 渲染模式\n> 客户端是上网时使用的手机、电脑等机器，而服务器是性能较强大的机器，可保持长时间运行并保证可随时访问服务器上文件\n\n## 客户端渲染\n  * 实现原理：浏览器异步请求服务器获取数据，然后浏览器拼接 数据和模板文件 得到最终的 HTML字符串，最后直接解析并渲染到页面。\n  * 优势\n    * 页面切换速度快\n      * 传统网站中的不同页面切换是通过服务器加载一个新的页面\n      * SPA 模型中是通过动态地重写部分页面实现局部刷新和懒加载\n    * 一定程度上减少了服务器的压力，浏览器负责页面逻辑和渲染\n    * 前后端分离设计，服务器只需要提供接口\n  * 问题\n    * SEO：传统的搜索引擎只会从 HTML 中抓取数据，导致前端渲染的页面无法被抓取。\n    * 首屏性能：用户首次加载页面时，需要先下载框架和应用程序的代码，然后再渲染页面。比如常用的 SPA 会把所有 JS 整体打包导致文件太大，页面加载时间较长而可能导致白屏问题，用户体验比较差。\n\n## 预渲染\n> 用来改善少数营销页面的 SEO 而无需使用 web 服务器实时动态编译 HTML\n\n  * 实现原理：即在构建阶段简单地生成匹配特定路由的静态 html 文件，可以通过 webpack 的 prerender-spa-plugin 轻松添加。\n  * 优点：设置简单，并且可以将前端页面作为一个完全静态的站点\n    缺点：搜索引擎不能抓取到 网页内容和结构，而且不能插入动态数据\n\n\n## 服务端渲染\n> 指传统的 ASP、Java 或 PHP 的渲染机制，是预渲染的升级机制\n\n  * 实现原理：浏览器发起请求后，服务端将 数据和模板拼接生成的 html 字符串返回给浏览器，浏览器只是进行解析和渲染。\n  * 优点\n    * 更好的 SEO：搜索引擎爬虫可以抓取渲染好的页面\n    * 更少的客户端电量消耗：对于电量有限的手机或平板比较重要\n    * 更快的内容到达时间：首屏加载更快而避免白屏问题，因为服务端只需要返回渲染好的 HTML\n  * 缺点\n    * 更多的服务器端负载（CPU 和内存资源）\n    * 更复杂的开发和部署（兼容 Node 执行环境）\n    * 不利于前后端分离，开发效率低\n\n\n## 同构渲染\n> 在服务器和客户端都可以运行的代码程序叫 同构，注意需要兼容 Node.js 的执行环境\n\n  * 实现原理：浏览器发起请求后，服务器将 数据和模板拼接生成的 html 字符串返回给浏览器，浏览器将其插入到指定节点后渲染页面。\n  * 优点\n    * 提高首屏性能\n    * 对搜索引擎友好，有助于 SEO\n    * 前后端共用一套 Node.js 代码，节省开发时间\n  * 缺点\n    * 内存溢出\n    * 异步操作\n    * 大量计算、个性化缓存等性能\n    * 服务器端和浏览器的环境差异\n\t* 复杂类型无法转义为字符串形式发送给前端\n\n\n## 架构选择\n  * 同构前一定要考虑到浏览器和服务器的环境差异，站在更高层面考虑\n  * 对于需要做 SEO 的项目，如果是一个后台应用，则只要首页做一些静态内容宣导即可。如果是内容型网站，那么可以考虑专门做一些页面给搜索引擎。\n  * 对于前端渲染首屏问题，我们可以采用分拆打包（路由库）、交互优化（加载动画）、部分同构（使用同构把菜单和页面骨架渲染出来） 等一些方式合理利用同构。\n\n\n\n# 六、Web 框架模式\n\n## 框架和库\n  * 类库：一个有组织的功能集合，用于提供特定功能的接口并被调用\n  * 框架：构建应用程序的整体架构，使开发者可以专注于逻辑处理而提高开发效率\n  * 联系：框架一般会集成大量库并在合适地方调用，有时也可称为库，区别在于思考角度\n\n\n## 框架模式\n\n### MVC\n  * 实现思路：所有的终端用户请求被发送到 Controller，Controller 依赖请求去选择加载哪个模型并附加到对应 View，最终 View 作为响应发送给终端用户。\n  * 缺陷：包含大量的业务逻辑后，代码就会难以阅读和维护。\n\n  <div align=\"center\"> \n    ![MVC](images/web/mvc.png) \n  </div> \n\n\n### MVP\n  * 实现思路：切断的 View 和 Model 的联系, 让 View 只和 Presenter（原Controller）交互，减少在需求变化中需要维护的对象的数量，相比 MVC 成本更低而且更容易理解。\n  * 缺陷：最接近用户的界面是需要根据需求变化而频繁更改的。\n\n  <div align=\"center\">\n    ![MVP](images/web/mvp.png) \n  </div> \n\n\n### MTV\n  * 实现思路：Model 负责业务对象和数据库的关系映射(ORM)，Template 负责如何把页面展示给用户(html)，View 负责业务逻辑并在适当时候调用 Model和Template。此外，通过一个URL分发器将一个个URL的页面请求分发给不同的View处理，View再调用相应的Model和Template。\n\n  <div align=\"center\">\n    ![MTV](images/web/mtv.png)\n  </div> \n\n\n### MVVM\n  * 实现思路：View 接收用户交互请求并发给ViewModel --> ViewModel 操作 Model 数据更新 --> Model 更新后通知 ViewModel 数据化 --> ViewModel 更新 View 数据。这样开发者只需关注业务逻辑，不需要手动操作DOM和关注数据状态的同步问题，复杂的数据状态维护完全由 MVVM 来统一管理，完美解决了复杂交互导致代码难以维护的问题。\n  * 优点\n    * 独立开发（可专注于业务逻辑和数据）\n    * 低耦合性（View 和 Model 相互独立）\n    * 可重用性（可让多个 View 重用一段视图逻辑）\n    * 方便测试（可测试 ViewModel，而 Controller 不可）\n  * 缺点\n    * 调用复杂度增加\n    * viewModel 会越来越庞大（逻辑多）\n    * 类会增多（每个VC都附带一个 viewModel）\n\n  <div align=\"center\">\n    ![MVVM](images/web/mvvm.png)\n  </div> \n\n\n## 框架分类\n  * 可视化组件：Echarts\n  * UI 框架：Bootstrap、EasyUI、ElementUI\n  * JS 框架：jQuery、Zepto.js、NodeJs、requirejs、VueJs、angularJS、reactJS\n\n\n\n# 七、Restful 架构\n  <div style=\"text-indent: 2em\">RESTful 是一种架构的规范与约束、原则而并非架构或标准，符合这种规范的架构就是 RESTful架构。基于这个风格设计的软件可以更简洁，更有层次，更容易实现缓存等机制，常用于客户端和服务器交互类的软件。</div>\n\n## 架构\n  * RESTful 架构：面向资源的架构，即针对资源设计接口。客户端操作通过资源对应的 URL 进行操作，从而访问服务器端资源。\n  * SOA 架构：面向服务的体系结构。SOA将不同的功能组件视为一种服务并分别封装，降低了组件之间的耦合程度，增加了代码的复用程度。\n\n\n## 特点\n  * 资源；作为资源的标识，比如 html / jpg / json\n  * URI：统一资源定位符，即每个 URI 对应一个特定的资源\n  * 无状态：所有资源都可以通过 URI 去定位，而不与其他资源产生耦合\n  * 统一接口：数据元操作CURD 分别对应http的 get、post、put、delete\n\n\n## URI \n  1. __区别 URL__\n    * URI：统一资源定位符，对应具体的资源。\n    * URL：统一资源标识符，对应具体的资源的地址\n    * 联系：URL 是属于 URI 的一部分 \n  2. __规范__\n    * 不用大写\n    * 用中杠 - 不用下杠 _ \n    * 参数列表要 encode\n    * 名词表示资源集合，资源集合时使用复数形式如 zoos/1/animals \n    * 每个网址代表一种资源，所以网址中不能有动词，一般只能有名词，而且所用的名词往往与数据库的表格名对应\n  3. __版本__\n   <div style=\"text-indent: 2em\">应该将API的版本号放入到URI中：/api.example.com/v1/zoos</div>\n  4. __通信__\n    * 前后端统一使用 json 数据\n    * 客户端通过url中的 `？& ,` 实现过滤、搜索等复杂操作\n    * 客户端通过标准的 HTTP 方法（`GET获取、POST新建、PUT更新、DELETE删除`）对应服务器端资源 CRUD（数据元操作，包括 `SELECT、CREATE、UPDATE、DELETE`）\n\n\n\n# 八、JS 运行机制\n\n## JS 解析引擎\n  * __js 引擎__：能够读懂 JavaScript 代码并能准确运行出结果的一段程序\n  * __V8 引擎__：为了提高 JS 的运行性能，在运行之前会将JS编译为本地的机器码，然后再去执行机器码。底层采用 C/C++ 编写。\n  * 对于 Java、C++、C 等静态语言处理上述事情的叫 `编译器`，而对于 JavaScript 这样的动态语言则叫做 `解释器`。区别：编译器是将源代码编译为另外一种代码（比如机器码或者字节码），而解释器是直接解析并将代码运行结果输出 \n\n## 进程和线程\n\n### 区分\n  * __CPU__：工厂，是执行计算任务的计算机核心 \n  * __进程__：工厂车间，是 CPU 资源分配和独立运行的最小单位，用来完成一个任务\n  * __线程__：车间工人，是可以独立运行的最小的 CPU 单位，用来协同其它线程完成一个任务\n\n\n### 模式\n> 进程里并发运行的线程会共享该进程下有限的内存地址空间，运行模式必须确保同一进程里的线程不会相互影响\n\n  * __单线程__：所有任务在主线程中排队执行\n  * __多线程__：任务在各自独立的线程中执行而互不影响，同一进程下的所有线程共享变量  \n  * __多进程__：允许多个任务同时运行，各个进程的变量互不影响，但会消耗更多的内存等资源\n  * __协调机制__：防止进程之间、线程之间产生冲突，并允许进程之间、线程之间共享资源\n\n\n## JS 的单线程\n> 单线程即 JS 引擎线程 称为 主线程，处理耗时异步任务的其它线程称为 工作线程\n\n<div style=\"text-indent: 2em\">`单线程是指浏览器中负责解释和执行 Js 代码的 JS 引擎线程只能有一个`，称为 `主线程`，所以同一时间只能执行一个任务，其他任务需要排队等待执行。之所以是单线程，是因为 JS 的主要用途是与用户互动和操作 DOM，多线程同时操作会带来复杂的同步问题。为了利用多核 CPU 的计算功能，HTML5 提出了 web worker 标准，允许 JS 脚本创建多个线程来处理耗时操作，但是 Worker 是 JS 引擎向浏览器申请开的子线程，它完全受主线程控制并且不能操作 DOM，所以这个新标准并没有改变JS单线程的本质。</div>\n \n  * __WebWorker__\n    * 特点：只属于某个页面，不会和其他页面的 Render 进程共享\n    * 创建：Chrome 会在 Render 进程中新建一个 Worker 线程来运行 js 程序\n  * __SharedWorker__\n    * 特点：浏览器的所有页面共享\n    * 创建：Chrome 会创建一个新的进程来运行 Js 程序，但是相同的 Js 只存在一个 SharedWorker 进程而不管它被创建多少次\n\n\n## 浏览器的多进程\n> 浏览器是多进程的，每打开一个 Tab 页就相当于创建了一个独立的进程。浏览器由于系统给它的进程分配了内存等资源而可以运行\n\n### 内部进程\n  * __Browser 进程__：浏览器的主进程 (负责协调和主控)，只有一个\n    * 负责浏览器界面显示，与用户交互。如前进，后退等\n    * 负责各个页面的管理，创建和销毁其他进程\n    * 将渲染进程得到的内存中的 Bitmap，绘制到用户界面上\n    * 负责网络资源的管理、下载等\n  * __第三方插件进程__：每种类型的插件对应一个进程\n  * __GPU 进程__：用于 3D 绘制等，最多一个\n  * __Render 进程__：浏览器内核，内部是多线程的\n    * 功能：负责页面渲染、脚本执行、事件处理等\n    * 特点：默认每个 Tab 页面对应一个进程并互不影响\n    \n\n### 多进程的优势\n> 如果浏览器是单进程，则某个 Tab 页或插件崩溃了就会影响整个浏览器，用户体验不好\n\n  * 避免单个page crash影响整个浏览器\n  * 避免第三方插件crash影响整个浏览器\n  * 多进程充分利用多核优势\n  * 方便使用沙盒模型隔离插件等进程，提高浏览器稳定性\n\n\n### 浏览器内核的多线程\n> 浏览器的渲染进程是多线程的\n\n<div style=\"text-indent: 2em\">由于 JavaScript 可以操作 DOM，如果在修改这些元素属性同时渲染界面（即JS线程和UI线程同时运行），那么渲染线程前后获得的元素数据就可能不一致了。因此为了防止渲染出现不可预期的结果，`浏览器设置 GUI 渲染线程与 JS 引擎线程为互斥的关系，当JS引擎执行时 GUI 线程会被挂起，GUI 更新则会被保存在一个队列中等到 JS 引擎线程空闲时立即被执行。所以 JS 如果执行时间过长就会导致页面渲染加载阻塞。`</div>\n\n  * __GUI 渲染线程__\n    * 负责渲染浏览器界面，解析 HTML、CSS，构建 DOM、RenderObject 树等\n    * 当界面需要重绘 Repaint 或由于某种操作引发回流 reflow 时，该线程就会执行 \n  * __JS 引擎线程__\n    * 即 JS 内核，负责处理 Js 脚本程序\n    * 负责解析执行 Javascript 脚本代码\n    * 一直通过事件循环机制，查看并执行任务队列中的任务\n  * __事件触发线程__\n    * 归属于浏览器而不是 JS 引擎，用来控制事件循环\n    * JS 引擎执行 setTimeOut、Ajax 等代码块时，会将对应任务添加到事件线程中\n    * 某事件符合条件被触发时，该线程把事件添加到任务队列的队尾等待处理\n    * 注意：由于 JS 的单线程，队列中的事件都需要排队等待 JS 引擎空闲时才去执行\n  * __定时触发器线程__\n    * setInterval、setTimeout 所在线程，用来计时并触发定时\n    * 计时完毕后，添加到事件队列中，等待 JS 引擎空闲时执行\n    * 注意：W3C 规定 setTimeout 中低于 4ms 的时间间隔算为 4ms\n  * __异步 http 请求线程__\n    * XMLHttpRequest 连接后是通过浏览器新开一个线程请求\n    * 检测到状态变更时，如果设置有回调函数，异步线程就产生状态变更事件，将回调函数再放入事件队列中等待 Js 引擎执行\n\n\n\n### 浏览器内核和 Browser 进程的通信\n  1. Browser 进程收到用户请求，通过网络下载或本地加载获取页面内容\n  2. Renderer 进程的接口收到 Browser 进程传递的请求，然后交给渲染线程执行\n    1. 渲染线程收到请求后，加载网页并渲染网页，\n    2. 渲染过程中可能需要 Browser 进程获取资源和需要 GPU 进程帮助渲染\n    3. 可能会有 JS 线程操作 DOM，这样可能会造成回流并重绘\n    4. Render 进程将渲染结果传递给 Browser 进程\n  3. Browser 进程接收到结果并将结果绘制出来\n\n\n## JS 异步机制\n\n### 同步和异步\n<div style=\"text-indent: 2em;\">公路上的多辆汽车按顺序运行，这时有车坏掉了。同步模式就是让故障车停在原地修理，后面的车就会被堵住无法行驶。异步模式则是把故障车辆推到应急车道修理，正常的车流不受影响，车修好之后从应急车道回到正常车道即可，唯一的影响就是过多的应急车道会打乱车流顺序。简单来说，`同步可以保证顺序一致但容易导致阻塞，异步可以解决阻塞问题但会改变顺序性。具体使用时，浏览器端的 Ajax 等耗时长的操作、服务器端的所有操作 都应该异步执行`，否则容易导致浏览器或服务器失去响应，因为执行环境是单线程的。</div> \n\n * 同步模式\n  * 所有任务在主线程的执行栈中排队等待\n  * 类似银行排队办业务，当前执行的耗时任务会阻塞后续代码的执行 \n * 异步模式\n  * 本质是事件驱动模式，返回结果后通知调用\n  * 主线程执行同步任务，工作线程执行耗时异步任务\n  * 类似餐厅点餐，当前执行的任务不会阻塞后续代码的执行\n\n\n### JS 任务\n> 所有任务都是在主线程上执行，形成一个执行栈\n\n  * 产生\n    * 执行 js 代码\n    * 对用户操作作出反应\n    * 处理异步的网络请求\n  * 分类\n    * __同步任务__：主线程的执行栈中排队执行的任务 \n    * __异步任务__：添加到任务列队中延迟执行的任务\n      * __宏任务__\n        * 特点：一次事件循环中只执行第一个，然后重新渲染页面 \n        * 场景：script 代码块、setTimeout、setInterval 等\n        * 管理：事件触发线程维护的宏任务队列\n      * __微任务__\n        * 特点：一次事件循环中全部执行，在页面渲染之前完成\n        * 场景：Promise、process.nextTick 等 \n        * 管理：JS 引擎线程维护的微任务队列\n  * __异步任务__\n    * onclick 等事件的销毁函数\n      * 当事件触发时，回调函数会被立即添加到任务队列中\n      * 由浏览器内核的 DOM Binding 模块处理\n    * setInterval 等计时器\n      * 当定时器时间到，就把该事件放到 任务队列中 等待处理\n      * 由浏览器内核的 timer 模块进行延时处理\n    * Ajax 请求\n      * 在网络请求完成返回之后，将回调函数添加到任务队列中\n      * 由浏览器内核的 network 模块处理\n\n\n  ```js\n  var test = function(){\n\n    // 同步任务\n    console.log(\"start\"); \n\n    // 异步宏任务\n    setTimeout(function(){\n        console.log(\"异步宏任务\");\n    }, 300);\n\n    // 异步微任务\n    Promise.resolve(42).then(value =>{\n        console.log(value);\n    })\n\n    // 同步任务\n    console.log(\"end\");\n  }\n  test();\n  ```\n\n\n### 任务队列\n> 一个 消息(事件) 的队列，具有先进先出的特点\n\n  * 解析异步操作后，相关的异步任务（ 事件、回调函数），就会被放到任务队列中，等待被处理\n  * 只有主线程中的任务全部执行完，任务队列中的异步任务才会被放到主线程的执行栈中开始执行\n\n\n### 事件循环 \n> Event Loop，指主线程重复从任务队列中读取事件并执行的过程 \n\n  * JS 会创建一个 类似 while(true) 的循环，每执行一次循环体的过程叫 tick\n  * 过程：查看任务队列中是都有待处理的事件，如果有：则取出，放到js主线程中执行\n  * JS 是运行在单线程上的，所以浏览器都会单独开启一个线程来处理事件消息的轮询，避免阻塞js的执行。\n\n\n### 异步过程 \n> 回调函数就是被主线程挂起来延迟执行的代码，主线程执行的异步任务就是对应的回调函数\n\n  1. 主线程执行 `异步发起函数`，将异步任务转交给相应的工作线程\n  2. 主线程继续执行后面的其它代码，同时工作线程执行异步任务\n  3. 工作线程完成异步任务后，将调用 `回调函数` 的事件添加到任务队列等待处理\n  4. 主线程空闲时，通过 `事件循环机制` 从任务队列中读取事件并放入执行栈，然后开始执行\n\n  <div align=\"center\"> \n    ![Ajax实现过程](images/web/ajax-process.png) \n  </div>\n\n  <div style=\"text-indent: 2em;\">从生产者与消费者的角度看，异步过程是这样的：工作线程是生产者，主线程是消费者(只有一个消费者)。工作线程执行异步任务，执行完成后把对应的回调函数封装成一条消息放到消息队列中。主线程不断地从消息队列中取消息并执行，当消息队列为空时主线程阻塞，直到消息队列再次非空。</div> \n\n\n\n## js 执行机制\n> 关键是事件循环机制\n\n  1. JS 引擎将所有操作分为 同步任务、异步任务\n  2. 同步任务进入主线程，然后直接按顺序执行\n  3. 异步任务进入工作线程，当满足触发条件后推入任务队列\n  4. 主线程执行完所有同步任务之后空闲时，重复去任务队列中查看是否有可执行的异步任务，有则推入主进程的执行栈\n    1. 执行一个宏任务（栈中没有就从事件队列中获取）\n    2. 执行过程中如果遇到微任务，就将它添加到微任务的任务队列中\n    3. 宏任务执行完毕后，立即执行当前微任务队列中的所有微任务（依次执行）\n    4. 当前宏任务执行完毕，开始检查渲染，然后 GUI 线程接管渲染\n    5. 渲染完毕后，JS 线程继续接管，开始下一个宏任务（从任务队列中获取）\n\n  \n  <div align=\"center\">\n    ![js 执行机制](images/web/js-run.png) \n  </div>\n\n\n  ```js\n  // 输出结果：1、7、6、8、2、4、3、5、9、11、10、12\n\n  console.log('1');\n\n  setTimeout(function() {\n      console.log('2');\n      process.nextTick(function() {\n          console.log('3');\n      })\n      new Promise(function(resolve) {\n          console.log('4');\n          resolve();\n      }).then(function() {\n          console.log('5')\n      })\n  })\n  process.nextTick(function() {\n      console.log('6');\n  })\n  new Promise(function(resolve) {\n      console.log('7');\n      resolve();\n  }).then(function() {\n      console.log('8')\n  })\n\n  setTimeout(function() {\n      console.log('9');\n      process.nextTick(function() {\n          console.log('10');\n      })\n      new Promise(function(resolve) {\n          console.log('11');\n          resolve();\n      }).then(function() {\n          console.log('12')\n      })\n  })\n  ```\n\n  1. 第一轮事件循环\n    * 整体 script 作为第一个宏任务进入主线程，执行 console.log 输出 1\n    * setTimeout，其回调函数被分发到宏任务 Event Queue，记为 setTimeout1\n    * process.nextTick()，其回调函数被分发到微任务 Event Queue，记为 process1\n    * Promise，new Promise 直接执行，输出7。then 被分发到微任务 Event Queue，记为 then1\n    * 第二个 setTimeout，其回调函数被分发到宏任务 Event Queue，记为 setTimeout2\n    * 执行两个微任务 process1、then1 输出 6、8\n    * 输出结果：1、7、6、8\n  2. 第二轮事件循环\n    * 从宏任务 setTimeout1 开始，输出 2\n    * process.nextTick()，同样将其分发到微任务Event Queue中，记为 process2\n    * new Promise 立即执行输出 4，then 也分发到微任务 Event Queue，记为 then2\n    * 执行两个微任务 process2、then2 输出 3、5\n    * 输出结果：2、4、3、5\n  3. 第三轮事件循环\n    * 此时只剩下 setTimeout2，执行输出 9\n    * process.nextTick() 分发到微任务 Event Queue，记为process3\n    * new Promise 直接执行输出 11，then 分发到微任务 Event Queue，记为 then3\n    * 执行两个微任务 process3、then3 输出 10、12\n    * 输出结果：9、11、10、12\n\n\n\n\n\n","slug":"2-web开发","published":1,"updated":"2019-05-10T17:10:48.841Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvid4pmq001z0nbxv4yerkzj","content":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><html><head></head><body><h1 id=\"一、技术栈\"><a href=\"#一、技术栈\" class=\"headerlink\" title=\"一、技术栈\"></a>一、技术栈</h1><blockquote><p>web 开发就是呈现用户可理解的界面并响应用户操作</p></blockquote><div align=\"center\"><br><img src=\"images/web/technology.png\" alt=\"前端技能图\"><br></div><h1 id=\"二、程序员网站\"><a href=\"#二、程序员网站\" class=\"headerlink\" title=\"二、程序员网站\"></a>二、程序员网站</h1><ol><li><strong>常用</strong><ul><li><a href=\"https://www.docschina.org/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">印记中文</a>：教程中文版</li><li><a href=\"http://tool.chinaz.com/tools/openweb.aspx/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">站长工具</a>：代码整理和测试</li><li><a href=\"http://tool.lu/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">在线工具</a>：代码处理工具合集</li><li><a href=\"https://github.com/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Github</a>：代码托管</li><li><a href=\"https://stackoverflow.com/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Stack Overflow</a>：技术问答社区</li><li><a href=\"https://stackoverflow.com/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Learn Anything</a>：思维导图形式学习技术</li></ul></li><li><strong>提升</strong><ul><li><a href=\"http://naotu.baidu.com/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">百度脑图</a>：思维导图</li><li><a href=\"https://slides.com/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">ProcessOn</a>：脑图工具</li><li><a href=\"https://www.processon.com/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Slides</a>：WebPPT 编辑器</li><li><a href=\"https://caniuse.com/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">CanIuse</a>：浏览器兼容</li><li><a href=\"http://overapi.com/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Overapi</a>：API速查手册</li><li><a href=\"https://runjs.cn/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">RunJS</a>：JS在线编辑和分享</li><li><a href=\"https://standardjs.com/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Standardjs</a>：JS编码规范</li><li><a href=\"https://www.favicon-generator.org/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Faviconer</a>：图标生成器</li></ul></li><li><strong>了解</strong><ul><li><a href=\"https://github.com/easychen/howto-make-more-money\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">零花钱</a>：接单网站</li><li><a href=\"https://electronjs.org/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Electron</a>：跨平台程序</li><li><a href=\"https://github.com/github/gitignore\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">.gitignore</a>：不同语言项目</li><li><a href=\"https://modao.cc/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">墨刀</a>：在线制作移动应用原型</li></ul></li></ol><h1 id=\"三、浏览器的结构和渲染\"><a href=\"#三、浏览器的结构和渲染\" class=\"headerlink\" title=\"三、浏览器的结构和渲染\"></a>三、浏览器的结构和渲染</h1><h2 id=\"页面判断\"><a href=\"#页面判断\" class=\"headerlink\" title=\"页面判断\"></a>页面判断</h2><blockquote><p>PC 端还是移动端</p></blockquote><ul><li>功能检测：<code>“touchstart” in document</code></li><li>特征检测：<code>navigator.userAgent</code></li></ul><h2 id=\"分层结构\"><a href=\"#分层结构\" class=\"headerlink\" title=\"分层结构\"></a>分层结构</h2><blockquote><p>浏览器的抽象分层结构图中将浏览器分成了以下子系统</p></blockquote><ul><li><strong>用户界面</strong>：用于和用户进行交互的功能组件，如地址栏、返回、前进按钮等</li><li><strong>浏览器引擎</strong>：用于查询和操作渲染引擎的界面</li><li><strong>渲染引擎</strong>：负责显示请求的内容，如果请求 HTML 则它解析 HTML 和 CSS 并显示</li><li><strong>网络</strong>：负责处理网络相关的事务，如 HTTP 请求等</li><li><strong>UI 后端</strong>：负责绘制提示框等浏览器组件，底层使用操作系统的用户接口</li><li><strong>Js 解释器</strong>：负责解析和执行 JavaScript 代码</li><li><p><strong>数据存储</strong>：负责持久存储 cookie 和缓存等应用数据</p><div align=\"center\"><br><img src=\"images/web/browserCom.png\" alt=\"浏览器结构\"><br></div></li></ul><h2 id=\"渲染流程\"><a href=\"#渲染流程\" class=\"headerlink\" title=\"渲染流程\"></a>渲染流程</h2><ol><li>解析HTML结构（构建 DOM 树）</li><li>加载外部脚本和css文件（构建 CSSOM 树）</li><li>解析并执行脚本代码（js 代码）</li><li>DOM 树构建完成（此时触发 DOMContentLoaded 事件）</li><li>加载外部静态文件（图标图片等）</li><li><p>页面加载完成（此时会触发 load 事件）</p><div align=\"center\"><br><img src=\"images/web/browerRender.png\" alt=\"浏览器渲染\"><br></div></li></ol><h2 id=\"渲染问题\"><a href=\"#渲染问题\" class=\"headerlink\" title=\"渲染问题\"></a>渲染问题</h2><ul><li>资源下载<ul><li>图片下载不会产生阻塞</li><li>css 下载时会阻塞渲染，但带有 media 属性除外<ul><li>css 是由单独的下载线程异步下载的</li><li>css 加载不会阻塞 DOM 树解析，但会阻塞 render 树渲染（需要 css 信息）</li></ul></li><li>遇到 script 标签时，DOM 构建停止直到 js 脚本下载并执行完毕，此时浏览器一般会下载其他资源但不会解析。如果 js 中有对 CSSOM 的操作，还会先确保 CSSOM 已经被下载并构建。</li></ul></li><li>重绘重排导致重新进行渲染树的生成<ul><li>重绘：简单外观的改变就会引起重绘，比如颜色变化等。重排一定重绘。</li><li>重排(回流)：重新计算布局，通常由元素的结构、增删、位置、尺寸变化引起。比如 img 下载成功后替换填充页面 img 元素而引起尺寸变化。也会由 js 的属性值读取引起，比如读取 offset、scroll、cilent、getComputedStyle 等信息。</li></ul></li><li>优化方法<ul><li>直接改变 className，如果动态改变样式则使用 cssText</li><li>让要操作的元素进行离线处理，处理完后一起更新<ul><li>使用 <code>display: none</code>，只引发两次回流和重绘</li><li>使用 <code>DocumentFragment</code> 进行缓存操作，引发一次回流和重绘</li><li>使用 <code>cloneNode(true/false)、replaceChild</code>，引发一次回流和重绘</li></ul></li></ul></li></ul><h2 id=\"渲染优化\"><a href=\"#渲染优化\" class=\"headerlink\" title=\"渲染优化\"></a>渲染优化</h2><ul><li>简化 DOM 结构，最好不深于六层</li><li>尽量缓存 DOM 查找，查找器尽量简洁</li><li>涉及多域名的网站，可以开启域名预解析</li><li>动画尽量使用在 绝对/固定 定位 的元素上</li><li>隐藏在屏幕外 或 页面滚动时，尽量停止动画</li><li>DOM 操作尽量通过缓存减少次数，避免过度触发回流</li><li>js 脚本放在页面 body 底部，减少对其他过程的阻塞</li><li>Js 修改元素样式操作尽量减少，使用类名修改或动画操作样式</li><li>减少首次下载的文件数量大小，使用图片懒加载、js 按需加载等方式</li><li>css 尽量层次简单并放入 head，提前加载并防止 html 渲染后重新结合 css 引起页面闪烁</li></ul><h1 id=\"四、Web-服务器\"><a href=\"#四、Web-服务器\" class=\"headerlink\" title=\"四、Web 服务器\"></a>四、Web 服务器</h1><h2 id=\"服务器\"><a href=\"#服务器\" class=\"headerlink\" title=\"服务器\"></a>服务器</h2><blockquote><p>从硬件上来看，服务器是一台配置比较高的PC机器。但是从软件角度根据用途可分为 web 服务器、数据库服务器等，用来处理客户端请求的服务器有以下两种：</p></blockquote><ul><li><strong>web 服务器</strong><ul><li>又称 HTTP 服务器，包括 Apache、Nginx 等</li><li>专注于处理 HTTP 协议、传递本地磁盘上的静态资源给客户端，常用于提供代理服务</li></ul></li><li><strong>应用服务器</strong><ul><li>提供可以处理业务逻辑的方法，包括 WebLogic、Tomcat 等</li><li>常用来加载动态内容和处理响应数据并返回给客户端，但则只能访问其安装目录中的文件</li></ul></li></ul><h2 id=\"代理\"><a href=\"#代理\" class=\"headerlink\" title=\"代理\"></a>代理</h2><ul><li><strong>代理服务器</strong><ul><li>一种具有转发功能的应用程序，扮演了位于服务器和客户端之间”中间人”的角色</li><li>接收由客户端发送的请求并转发给服务器，同时也接收服务器返回的响应并转发给客户端</li></ul></li><li><strong>正向代理</strong><ul><li>隐藏了真实的请求客户端，客户端请求的服务都被代理服务器代替来请求</li><li>比如翻墙的原理就是在国外搭建一台代理服务器，代理去访问国外网址并返回结果给国内客户端</li></ul></li><li><strong>反向代理</strong><ul><li>隐藏了真实的服务端，反向代理服务器会帮客户端把请求转发到真实服务器</li><li>常用来做负载均衡，比如访问百度时会有很多服务器接收服务</li></ul></li><li><strong>应用</strong><ul><li>web 项目开发时联合使用 apache + tomcat + nginx</li><li>访问静态、动态资源时使用 apache/tomcat 解析</li><li>nginx 作为反向代理服务器，同时支持高并发</li></ul></li></ul><h2 id=\"运行机制\"><a href=\"#运行机制\" class=\"headerlink\" title=\"运行机制\"></a>运行机制</h2><div style=\"text-indent:2em;margin-top:15px\">Apache 等传统 Web 服务器采用了多线程模型，它会为每个客户端请求分配一个线程来同步执行 I/O 操作，系统通过线程池进行线程切换来减少时间开销。这种方式容易造成阻塞，而且浪费 CPU 和内存，当连接达到一定数量时可能会导致服务器耗光内存而崩溃，只适用于 异步操作较少但业务逻辑较复杂的应用。这就是 <code>线程驱动</code>。</div><h1 id=\"五、Web-渲染模式\"><a href=\"#五、Web-渲染模式\" class=\"headerlink\" title=\"五、Web 渲染模式\"></a>五、Web 渲染模式</h1><blockquote><p>客户端是上网时使用的手机、电脑等机器，而服务器是性能较强大的机器，可保持长时间运行并保证可随时访问服务器上文件</p></blockquote><h2 id=\"客户端渲染\"><a href=\"#客户端渲染\" class=\"headerlink\" title=\"客户端渲染\"></a>客户端渲染</h2><ul><li>实现原理：浏览器异步请求服务器获取数据，然后浏览器拼接 数据和模板文件 得到最终的 HTML字符串，最后直接解析并渲染到页面。</li><li>优势<ul><li>页面切换速度快<ul><li>传统网站中的不同页面切换是通过服务器加载一个新的页面</li><li>SPA 模型中是通过动态地重写部分页面实现局部刷新和懒加载</li></ul></li><li>一定程度上减少了服务器的压力，浏览器负责页面逻辑和渲染</li><li>前后端分离设计，服务器只需要提供接口</li></ul></li><li>问题<ul><li>SEO：传统的搜索引擎只会从 HTML 中抓取数据，导致前端渲染的页面无法被抓取。</li><li>首屏性能：用户首次加载页面时，需要先下载框架和应用程序的代码，然后再渲染页面。比如常用的 SPA 会把所有 JS 整体打包导致文件太大，页面加载时间较长而可能导致白屏问题，用户体验比较差。</li></ul></li></ul><h2 id=\"预渲染\"><a href=\"#预渲染\" class=\"headerlink\" title=\"预渲染\"></a>预渲染</h2><blockquote><p>用来改善少数营销页面的 SEO 而无需使用 web 服务器实时动态编译 HTML</p></blockquote><ul><li>实现原理：即在构建阶段简单地生成匹配特定路由的静态 html 文件，可以通过 webpack 的 prerender-spa-plugin 轻松添加。</li><li>优点：设置简单，并且可以将前端页面作为一个完全静态的站点<br>缺点：搜索引擎不能抓取到 网页内容和结构，而且不能插入动态数据</li></ul><h2 id=\"服务端渲染\"><a href=\"#服务端渲染\" class=\"headerlink\" title=\"服务端渲染\"></a>服务端渲染</h2><blockquote><p>指传统的 ASP、Java 或 PHP 的渲染机制，是预渲染的升级机制</p></blockquote><ul><li>实现原理：浏览器发起请求后，服务端将 数据和模板拼接生成的 html 字符串返回给浏览器，浏览器只是进行解析和渲染。</li><li>优点<ul><li>更好的 SEO：搜索引擎爬虫可以抓取渲染好的页面</li><li>更少的客户端电量消耗：对于电量有限的手机或平板比较重要</li><li>更快的内容到达时间：首屏加载更快而避免白屏问题，因为服务端只需要返回渲染好的 HTML</li></ul></li><li>缺点<ul><li>更多的服务器端负载（CPU 和内存资源）</li><li>更复杂的开发和部署（兼容 Node 执行环境）</li><li>不利于前后端分离，开发效率低</li></ul></li></ul><h2 id=\"同构渲染\"><a href=\"#同构渲染\" class=\"headerlink\" title=\"同构渲染\"></a>同构渲染</h2><blockquote><p>在服务器和客户端都可以运行的代码程序叫 同构，注意需要兼容 Node.js 的执行环境</p></blockquote><ul><li>实现原理：浏览器发起请求后，服务器将 数据和模板拼接生成的 html 字符串返回给浏览器，浏览器将其插入到指定节点后渲染页面。</li><li>优点<ul><li>提高首屏性能</li><li>对搜索引擎友好，有助于 SEO</li><li>前后端共用一套 Node.js 代码，节省开发时间</li></ul></li><li>缺点<ul><li>内存溢出</li><li>异步操作</li><li>大量计算、个性化缓存等性能</li><li>服务器端和浏览器的环境差异</li><li>复杂类型无法转义为字符串形式发送给前端</li></ul></li></ul><h2 id=\"架构选择\"><a href=\"#架构选择\" class=\"headerlink\" title=\"架构选择\"></a>架构选择</h2><ul><li>同构前一定要考虑到浏览器和服务器的环境差异，站在更高层面考虑</li><li>对于需要做 SEO 的项目，如果是一个后台应用，则只要首页做一些静态内容宣导即可。如果是内容型网站，那么可以考虑专门做一些页面给搜索引擎。</li><li>对于前端渲染首屏问题，我们可以采用分拆打包（路由库）、交互优化（加载动画）、部分同构（使用同构把菜单和页面骨架渲染出来） 等一些方式合理利用同构。</li></ul><h1 id=\"六、Web-框架模式\"><a href=\"#六、Web-框架模式\" class=\"headerlink\" title=\"六、Web 框架模式\"></a>六、Web 框架模式</h1><h2 id=\"框架和库\"><a href=\"#框架和库\" class=\"headerlink\" title=\"框架和库\"></a>框架和库</h2><ul><li>类库：一个有组织的功能集合，用于提供特定功能的接口并被调用</li><li>框架：构建应用程序的整体架构，使开发者可以专注于逻辑处理而提高开发效率</li><li>联系：框架一般会集成大量库并在合适地方调用，有时也可称为库，区别在于思考角度</li></ul><h2 id=\"框架模式\"><a href=\"#框架模式\" class=\"headerlink\" title=\"框架模式\"></a>框架模式</h2><h3 id=\"MVC\"><a href=\"#MVC\" class=\"headerlink\" title=\"MVC\"></a>MVC</h3><ul><li>实现思路：所有的终端用户请求被发送到 Controller，Controller 依赖请求去选择加载哪个模型并附加到对应 View，最终 View 作为响应发送给终端用户。</li><li><p>缺陷：包含大量的业务逻辑后，代码就会难以阅读和维护。</p><div align=\"center\"><br><img src=\"images/web/mvc.png\" alt=\"MVC\"><br></div></li></ul><h3 id=\"MVP\"><a href=\"#MVP\" class=\"headerlink\" title=\"MVP\"></a>MVP</h3><ul><li>实现思路：切断的 View 和 Model 的联系, 让 View 只和 Presenter（原Controller）交互，减少在需求变化中需要维护的对象的数量，相比 MVC 成本更低而且更容易理解。</li><li><p>缺陷：最接近用户的界面是需要根据需求变化而频繁更改的。</p><div align=\"center\"><br><img src=\"images/web/mvp.png\" alt=\"MVP\"><br></div></li></ul><h3 id=\"MTV\"><a href=\"#MTV\" class=\"headerlink\" title=\"MTV\"></a>MTV</h3><ul><li><p>实现思路：Model 负责业务对象和数据库的关系映射(ORM)，Template 负责如何把页面展示给用户(html)，View 负责业务逻辑并在适当时候调用 Model和Template。此外，通过一个URL分发器将一个个URL的页面请求分发给不同的View处理，View再调用相应的Model和Template。</p><div align=\"center\"><br><img src=\"images/web/mtv.png\" alt=\"MTV\"><br></div></li></ul><h3 id=\"MVVM\"><a href=\"#MVVM\" class=\"headerlink\" title=\"MVVM\"></a>MVVM</h3><ul><li>实现思路：View 接收用户交互请求并发给ViewModel –> ViewModel 操作 Model 数据更新 –> Model 更新后通知 ViewModel 数据化 –> ViewModel 更新 View 数据。这样开发者只需关注业务逻辑，不需要手动操作DOM和关注数据状态的同步问题，复杂的数据状态维护完全由 MVVM 来统一管理，完美解决了复杂交互导致代码难以维护的问题。</li><li>优点<ul><li>独立开发（可专注于业务逻辑和数据）</li><li>低耦合性（View 和 Model 相互独立）</li><li>可重用性（可让多个 View 重用一段视图逻辑）</li><li>方便测试（可测试 ViewModel，而 Controller 不可）</li></ul></li><li><p>缺点</p><ul><li>调用复杂度增加</li><li>viewModel 会越来越庞大（逻辑多）</li><li>类会增多（每个VC都附带一个 viewModel）</li></ul><div align=\"center\"><br><img src=\"images/web/mvvm.png\" alt=\"MVVM\"><br></div></li></ul><h2 id=\"框架分类\"><a href=\"#框架分类\" class=\"headerlink\" title=\"框架分类\"></a>框架分类</h2><ul><li>可视化组件：Echarts</li><li>UI 框架：Bootstrap、EasyUI、ElementUI</li><li>JS 框架：jQuery、Zepto.js、NodeJs、requirejs、VueJs、angularJS、reactJS</li></ul><h1 id=\"七、Restful-架构\"><a href=\"#七、Restful-架构\" class=\"headerlink\" title=\"七、Restful 架构\"></a>七、Restful 架构</h1><div style=\"text-indent:2em\">RESTful 是一种架构的规范与约束、原则而并非架构或标准，符合这种规范的架构就是 RESTful架构。基于这个风格设计的软件可以更简洁，更有层次，更容易实现缓存等机制，常用于客户端和服务器交互类的软件。</div><h2 id=\"架构\"><a href=\"#架构\" class=\"headerlink\" title=\"架构\"></a>架构</h2><ul><li>RESTful 架构：面向资源的架构，即针对资源设计接口。客户端操作通过资源对应的 URL 进行操作，从而访问服务器端资源。</li><li>SOA 架构：面向服务的体系结构。SOA将不同的功能组件视为一种服务并分别封装，降低了组件之间的耦合程度，增加了代码的复用程度。</li></ul><h2 id=\"特点\"><a href=\"#特点\" class=\"headerlink\" title=\"特点\"></a>特点</h2><ul><li>资源；作为资源的标识，比如 html / jpg / json</li><li>URI：统一资源定位符，即每个 URI 对应一个特定的资源</li><li>无状态：所有资源都可以通过 URI 去定位，而不与其他资源产生耦合</li><li>统一接口：数据元操作CURD 分别对应http的 get、post、put、delete</li></ul><h2 id=\"URI\"><a href=\"#URI\" class=\"headerlink\" title=\"URI\"></a>URI</h2><ol><li><strong>区别 URL</strong><ul><li>URI：统一资源定位符，对应具体的资源。</li><li>URL：统一资源标识符，对应具体的资源的地址</li><li>联系：URL 是属于 URI 的一部分</li></ul></li><li><strong>规范</strong><ul><li>不用大写</li><li>用中杠 - 不用下杠 _</li><li>参数列表要 encode</li><li>名词表示资源集合，资源集合时使用复数形式如 zoos/1/animals</li><li>每个网址代表一种资源，所以网址中不能有动词，一般只能有名词，而且所用的名词往往与数据库的表格名对应</li></ul></li><li><strong>版本</strong><div style=\"text-indent:2em\">应该将API的版本号放入到URI中：/api.example.com/v1/zoos</div></li><li><strong>通信</strong><ul><li>前后端统一使用 json 数据</li><li>客户端通过url中的 <code>？& ,</code> 实现过滤、搜索等复杂操作</li><li>客户端通过标准的 HTTP 方法（<code>GET获取、POST新建、PUT更新、DELETE删除</code>）对应服务器端资源 CRUD（数据元操作，包括 <code>SELECT、CREATE、UPDATE、DELETE</code>）</li></ul></li></ol><h1 id=\"八、JS-运行机制\"><a href=\"#八、JS-运行机制\" class=\"headerlink\" title=\"八、JS 运行机制\"></a>八、JS 运行机制</h1><h2 id=\"JS-解析引擎\"><a href=\"#JS-解析引擎\" class=\"headerlink\" title=\"JS 解析引擎\"></a>JS 解析引擎</h2><ul><li><strong>js 引擎</strong>：能够读懂 JavaScript 代码并能准确运行出结果的一段程序</li><li><strong>V8 引擎</strong>：为了提高 JS 的运行性能，在运行之前会将JS编译为本地的机器码，然后再去执行机器码。底层采用 C/C++ 编写。</li><li>对于 Java、C++、C 等静态语言处理上述事情的叫 <code>编译器</code>，而对于 JavaScript 这样的动态语言则叫做 <code>解释器</code>。区别：编译器是将源代码编译为另外一种代码（比如机器码或者字节码），而解释器是直接解析并将代码运行结果输出</li></ul><h2 id=\"进程和线程\"><a href=\"#进程和线程\" class=\"headerlink\" title=\"进程和线程\"></a>进程和线程</h2><h3 id=\"区分\"><a href=\"#区分\" class=\"headerlink\" title=\"区分\"></a>区分</h3><ul><li><strong>CPU</strong>：工厂，是执行计算任务的计算机核心</li><li><strong>进程</strong>：工厂车间，是 CPU 资源分配和独立运行的最小单位，用来完成一个任务</li><li><strong>线程</strong>：车间工人，是可以独立运行的最小的 CPU 单位，用来协同其它线程完成一个任务</li></ul><h3 id=\"模式\"><a href=\"#模式\" class=\"headerlink\" title=\"模式\"></a>模式</h3><blockquote><p>进程里并发运行的线程会共享该进程下有限的内存地址空间，运行模式必须确保同一进程里的线程不会相互影响</p></blockquote><ul><li><strong>单线程</strong>：所有任务在主线程中排队执行</li><li><strong>多线程</strong>：任务在各自独立的线程中执行而互不影响，同一进程下的所有线程共享变量</li><li><strong>多进程</strong>：允许多个任务同时运行，各个进程的变量互不影响，但会消耗更多的内存等资源</li><li><strong>协调机制</strong>：防止进程之间、线程之间产生冲突，并允许进程之间、线程之间共享资源</li></ul><h2 id=\"JS-的单线程\"><a href=\"#JS-的单线程\" class=\"headerlink\" title=\"JS 的单线程\"></a>JS 的单线程</h2><blockquote><p>单线程即 JS 引擎线程 称为 主线程，处理耗时异步任务的其它线程称为 工作线程</p></blockquote><div style=\"text-indent:2em\"><code>单线程是指浏览器中负责解释和执行 Js 代码的 JS 引擎线程只能有一个</code>，称为 <code>主线程</code>，所以同一时间只能执行一个任务，其他任务需要排队等待执行。之所以是单线程，是因为 JS 的主要用途是与用户互动和操作 DOM，多线程同时操作会带来复杂的同步问题。为了利用多核 CPU 的计算功能，HTML5 提出了 web worker 标准，允许 JS 脚本创建多个线程来处理耗时操作，但是 Worker 是 JS 引擎向浏览器申请开的子线程，它完全受主线程控制并且不能操作 DOM，所以这个新标准并没有改变JS单线程的本质。</div><ul><li><strong>WebWorker</strong><ul><li>特点：只属于某个页面，不会和其他页面的 Render 进程共享</li><li>创建：Chrome 会在 Render 进程中新建一个 Worker 线程来运行 js 程序</li></ul></li><li><strong>SharedWorker</strong><ul><li>特点：浏览器的所有页面共享</li><li>创建：Chrome 会创建一个新的进程来运行 Js 程序，但是相同的 Js 只存在一个 SharedWorker 进程而不管它被创建多少次</li></ul></li></ul><h2 id=\"浏览器的多进程\"><a href=\"#浏览器的多进程\" class=\"headerlink\" title=\"浏览器的多进程\"></a>浏览器的多进程</h2><blockquote><p>浏览器是多进程的，每打开一个 Tab 页就相当于创建了一个独立的进程。浏览器由于系统给它的进程分配了内存等资源而可以运行</p></blockquote><h3 id=\"内部进程\"><a href=\"#内部进程\" class=\"headerlink\" title=\"内部进程\"></a>内部进程</h3><ul><li><strong>Browser 进程</strong>：浏览器的主进程 (负责协调和主控)，只有一个<ul><li>负责浏览器界面显示，与用户交互。如前进，后退等</li><li>负责各个页面的管理，创建和销毁其他进程</li><li>将渲染进程得到的内存中的 Bitmap，绘制到用户界面上</li><li>负责网络资源的管理、下载等</li></ul></li><li><strong>第三方插件进程</strong>：每种类型的插件对应一个进程</li><li><strong>GPU 进程</strong>：用于 3D 绘制等，最多一个</li><li><strong>Render 进程</strong>：浏览器内核，内部是多线程的<ul><li>功能：负责页面渲染、脚本执行、事件处理等</li><li>特点：默认每个 Tab 页面对应一个进程并互不影响</li></ul></li></ul><h3 id=\"多进程的优势\"><a href=\"#多进程的优势\" class=\"headerlink\" title=\"多进程的优势\"></a>多进程的优势</h3><blockquote><p>如果浏览器是单进程，则某个 Tab 页或插件崩溃了就会影响整个浏览器，用户体验不好</p></blockquote><ul><li>避免单个page crash影响整个浏览器</li><li>避免第三方插件crash影响整个浏览器</li><li>多进程充分利用多核优势</li><li>方便使用沙盒模型隔离插件等进程，提高浏览器稳定性</li></ul><h3 id=\"浏览器内核的多线程\"><a href=\"#浏览器内核的多线程\" class=\"headerlink\" title=\"浏览器内核的多线程\"></a>浏览器内核的多线程</h3><blockquote><p>浏览器的渲染进程是多线程的</p></blockquote><div style=\"text-indent:2em\">由于 JavaScript 可以操作 DOM，如果在修改这些元素属性同时渲染界面（即JS线程和UI线程同时运行），那么渲染线程前后获得的元素数据就可能不一致了。因此为了防止渲染出现不可预期的结果，<code>浏览器设置 GUI 渲染线程与 JS 引擎线程为互斥的关系，当JS引擎执行时 GUI 线程会被挂起，GUI 更新则会被保存在一个队列中等到 JS 引擎线程空闲时立即被执行。所以 JS 如果执行时间过长就会导致页面渲染加载阻塞。</code></div><ul><li><strong>GUI 渲染线程</strong><ul><li>负责渲染浏览器界面，解析 HTML、CSS，构建 DOM、RenderObject 树等</li><li>当界面需要重绘 Repaint 或由于某种操作引发回流 reflow 时，该线程就会执行</li></ul></li><li><strong>JS 引擎线程</strong><ul><li>即 JS 内核，负责处理 Js 脚本程序</li><li>负责解析执行 Javascript 脚本代码</li><li>一直通过事件循环机制，查看并执行任务队列中的任务</li></ul></li><li><strong>事件触发线程</strong><ul><li>归属于浏览器而不是 JS 引擎，用来控制事件循环</li><li>JS 引擎执行 setTimeOut、Ajax 等代码块时，会将对应任务添加到事件线程中</li><li>某事件符合条件被触发时，该线程把事件添加到任务队列的队尾等待处理</li><li>注意：由于 JS 的单线程，队列中的事件都需要排队等待 JS 引擎空闲时才去执行</li></ul></li><li><strong>定时触发器线程</strong><ul><li>setInterval、setTimeout 所在线程，用来计时并触发定时</li><li>计时完毕后，添加到事件队列中，等待 JS 引擎空闲时执行</li><li>注意：W3C 规定 setTimeout 中低于 4ms 的时间间隔算为 4ms</li></ul></li><li><strong>异步 http 请求线程</strong><ul><li>XMLHttpRequest 连接后是通过浏览器新开一个线程请求</li><li>检测到状态变更时，如果设置有回调函数，异步线程就产生状态变更事件，将回调函数再放入事件队列中等待 Js 引擎执行</li></ul></li></ul><h3 id=\"浏览器内核和-Browser-进程的通信\"><a href=\"#浏览器内核和-Browser-进程的通信\" class=\"headerlink\" title=\"浏览器内核和 Browser 进程的通信\"></a>浏览器内核和 Browser 进程的通信</h3><ol><li>Browser 进程收到用户请求，通过网络下载或本地加载获取页面内容</li><li>Renderer 进程的接口收到 Browser 进程传递的请求，然后交给渲染线程执行<ol><li>渲染线程收到请求后，加载网页并渲染网页，</li><li>渲染过程中可能需要 Browser 进程获取资源和需要 GPU 进程帮助渲染</li><li>可能会有 JS 线程操作 DOM，这样可能会造成回流并重绘</li><li>Render 进程将渲染结果传递给 Browser 进程</li></ol></li><li>Browser 进程接收到结果并将结果绘制出来</li></ol><h2 id=\"JS-异步机制\"><a href=\"#JS-异步机制\" class=\"headerlink\" title=\"JS 异步机制\"></a>JS 异步机制</h2><h3 id=\"同步和异步\"><a href=\"#同步和异步\" class=\"headerlink\" title=\"同步和异步\"></a>同步和异步</h3><div style=\"text-indent:2em\">公路上的多辆汽车按顺序运行，这时有车坏掉了。同步模式就是让故障车停在原地修理，后面的车就会被堵住无法行驶。异步模式则是把故障车辆推到应急车道修理，正常的车流不受影响，车修好之后从应急车道回到正常车道即可，唯一的影响就是过多的应急车道会打乱车流顺序。简单来说，<code>同步可以保证顺序一致但容易导致阻塞，异步可以解决阻塞问题但会改变顺序性。具体使用时，浏览器端的 Ajax 等耗时长的操作、服务器端的所有操作 都应该异步执行</code>，否则容易导致浏览器或服务器失去响应，因为执行环境是单线程的。</div><ul><li>同步模式<ul><li>所有任务在主线程的执行栈中排队等待</li><li>类似银行排队办业务，当前执行的耗时任务会阻塞后续代码的执行</li></ul></li><li>异步模式<ul><li>本质是事件驱动模式，返回结果后通知调用</li><li>主线程执行同步任务，工作线程执行耗时异步任务</li><li>类似餐厅点餐，当前执行的任务不会阻塞后续代码的执行</li></ul></li></ul><h3 id=\"JS-任务\"><a href=\"#JS-任务\" class=\"headerlink\" title=\"JS 任务\"></a>JS 任务</h3><blockquote><p>所有任务都是在主线程上执行，形成一个执行栈</p></blockquote><ul><li>产生<ul><li>执行 js 代码</li><li>对用户操作作出反应</li><li>处理异步的网络请求</li></ul></li><li>分类<ul><li><strong>同步任务</strong>：主线程的执行栈中排队执行的任务</li><li><strong>异步任务</strong>：添加到任务列队中延迟执行的任务<ul><li><strong>宏任务</strong><ul><li>特点：一次事件循环中只执行第一个，然后重新渲染页面</li><li>场景：script 代码块、setTimeout、setInterval 等</li><li>管理：事件触发线程维护的宏任务队列</li></ul></li><li><strong>微任务</strong><ul><li>特点：一次事件循环中全部执行，在页面渲染之前完成</li><li>场景：Promise、process.nextTick 等</li><li>管理：JS 引擎线程维护的微任务队列</li></ul></li></ul></li></ul></li><li><strong>异步任务</strong><ul><li>onclick 等事件的销毁函数<ul><li>当事件触发时，回调函数会被立即添加到任务队列中</li><li>由浏览器内核的 DOM Binding 模块处理</li></ul></li><li>setInterval 等计时器<ul><li>当定时器时间到，就把该事件放到 任务队列中 等待处理</li><li>由浏览器内核的 timer 模块进行延时处理</li></ul></li><li>Ajax 请求<ul><li>在网络请求完成返回之后，将回调函数添加到任务队列中</li><li>由浏览器内核的 network 模块处理</li></ul></li></ul></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> test = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 同步任务</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">\"start\"</span>); </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 异步宏任务</span></span><br><span class=\"line\">  setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">\"异步宏任务\"</span>);</span><br><span class=\"line\">  }, <span class=\"number\">300</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 异步微任务</span></span><br><span class=\"line\">  <span class=\"built_in\">Promise</span>.resolve(<span class=\"number\">42</span>).then(<span class=\"function\"><span class=\"params\">value</span> =></span>{</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(value);</span><br><span class=\"line\">  })</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 同步任务</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">\"end\"</span>);</span><br><span class=\"line\">}</span><br><span class=\"line\">test();</span><br></pre></td></tr></tbody></table></figure><h3 id=\"任务队列\"><a href=\"#任务队列\" class=\"headerlink\" title=\"任务队列\"></a>任务队列</h3><blockquote><p>一个 消息(事件) 的队列，具有先进先出的特点</p></blockquote><ul><li>解析异步操作后，相关的异步任务（ 事件、回调函数），就会被放到任务队列中，等待被处理</li><li>只有主线程中的任务全部执行完，任务队列中的异步任务才会被放到主线程的执行栈中开始执行</li></ul><h3 id=\"事件循环\"><a href=\"#事件循环\" class=\"headerlink\" title=\"事件循环\"></a>事件循环</h3><blockquote><p>Event Loop，指主线程重复从任务队列中读取事件并执行的过程</p></blockquote><ul><li>JS 会创建一个 类似 while(true) 的循环，每执行一次循环体的过程叫 tick</li><li>过程：查看任务队列中是都有待处理的事件，如果有：则取出，放到js主线程中执行</li><li>JS 是运行在单线程上的，所以浏览器都会单独开启一个线程来处理事件消息的轮询，避免阻塞js的执行。</li></ul><h3 id=\"异步过程\"><a href=\"#异步过程\" class=\"headerlink\" title=\"异步过程\"></a>异步过程</h3><blockquote><p>回调函数就是被主线程挂起来延迟执行的代码，主线程执行的异步任务就是对应的回调函数</p></blockquote><ol><li>主线程执行 <code>异步发起函数</code>，将异步任务转交给相应的工作线程</li><li>主线程继续执行后面的其它代码，同时工作线程执行异步任务</li><li>工作线程完成异步任务后，将调用 <code>回调函数</code> 的事件添加到任务队列等待处理</li><li><p>主线程空闲时，通过 <code>事件循环机制</code> 从任务队列中读取事件并放入执行栈，然后开始执行</p><div align=\"center\"><br><img src=\"images/web/ajax-process.png\" alt=\"Ajax实现过程\"><br></div><div style=\"text-indent:2em\">从生产者与消费者的角度看，异步过程是这样的：工作线程是生产者，主线程是消费者(只有一个消费者)。工作线程执行异步任务，执行完成后把对应的回调函数封装成一条消息放到消息队列中。主线程不断地从消息队列中取消息并执行，当消息队列为空时主线程阻塞，直到消息队列再次非空。</div></li></ol><h2 id=\"js-执行机制\"><a href=\"#js-执行机制\" class=\"headerlink\" title=\"js 执行机制\"></a>js 执行机制</h2><blockquote><p>关键是事件循环机制</p></blockquote><ol><li>JS 引擎将所有操作分为 同步任务、异步任务</li><li>同步任务进入主线程，然后直接按顺序执行</li><li>异步任务进入工作线程，当满足触发条件后推入任务队列</li><li>主线程执行完所有同步任务之后空闲时，重复去任务队列中查看是否有可执行的异步任务，有则推入主进程的执行栈<ol><li>执行一个宏任务（栈中没有就从事件队列中获取）</li><li>执行过程中如果遇到微任务，就将它添加到微任务的任务队列中</li><li>宏任务执行完毕后，立即执行当前微任务队列中的所有微任务（依次执行）</li><li>当前宏任务执行完毕，开始检查渲染，然后 GUI 线程接管渲染</li><li>渲染完毕后，JS 线程继续接管，开始下一个宏任务（从任务队列中获取）</li></ol></li></ol><div align=\"center\"><br><img src=\"images/web/js-run.png\" alt=\"js 执行机制\"><br></div><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 输出结果：1、7、6、8、2、4、3、5、9、11、10、12</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'1'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'2'</span>);</span><br><span class=\"line\">    process.nextTick(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'3'</span>);</span><br><span class=\"line\">    })</span><br><span class=\"line\">    <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve</span>) </span>{</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'4'</span>);</span><br><span class=\"line\">        resolve();</span><br><span class=\"line\">    }).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'5'</span>)</span><br><span class=\"line\">    })</span><br><span class=\"line\">})</span><br><span class=\"line\">process.nextTick(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'6'</span>);</span><br><span class=\"line\">})</span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve</span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'7'</span>);</span><br><span class=\"line\">    resolve();</span><br><span class=\"line\">}).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'8'</span>)</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'9'</span>);</span><br><span class=\"line\">    process.nextTick(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'10'</span>);</span><br><span class=\"line\">    })</span><br><span class=\"line\">    <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve</span>) </span>{</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'11'</span>);</span><br><span class=\"line\">        resolve();</span><br><span class=\"line\">    }).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'12'</span>)</span><br><span class=\"line\">    })</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><ol><li>第一轮事件循环<ul><li>整体 script 作为第一个宏任务进入主线程，执行 console.log 输出 1</li><li>setTimeout，其回调函数被分发到宏任务 Event Queue，记为 setTimeout1</li><li>process.nextTick()，其回调函数被分发到微任务 Event Queue，记为 process1</li><li>Promise，new Promise 直接执行，输出7。then 被分发到微任务 Event Queue，记为 then1</li><li>第二个 setTimeout，其回调函数被分发到宏任务 Event Queue，记为 setTimeout2</li><li>执行两个微任务 process1、then1 输出 6、8</li><li>输出结果：1、7、6、8</li></ul></li><li>第二轮事件循环<ul><li>从宏任务 setTimeout1 开始，输出 2</li><li>process.nextTick()，同样将其分发到微任务Event Queue中，记为 process2</li><li>new Promise 立即执行输出 4，then 也分发到微任务 Event Queue，记为 then2</li><li>执行两个微任务 process2、then2 输出 3、5</li><li>输出结果：2、4、3、5</li></ul></li><li>第三轮事件循环<ul><li>此时只剩下 setTimeout2，执行输出 9</li><li>process.nextTick() 分发到微任务 Event Queue，记为process3</li><li>new Promise 直接执行输出 11，then 分发到微任务 Event Queue，记为 then3</li><li>执行两个微任务 process3、then3 输出 10、12</li><li>输出结果：9、11、10、12</li></ul></li></ol><!-- rebuild by neat --></body></html>","site":{"data":{"next":{"override":false,"cache":{"enable":true},"favicon":{"small":"/images/favicon-16.ico","medium":"/images/favicon-32.ico","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"rss":"/atom.xml","footer":{"since":2019,"icon":{"name":"snowflake-o","animated":false,"color":"#808080"},"copyright":"chuangge","powered":{"enable":false,"version":true},"theme":{"enable":false,"version":true},"beian":{"enable":false,"icp":null}},"creative_commons":{"license":"by-nc-sa","sidebar":false,"post":false},"canonical":true,"seo":false,"index_with_subtitle":false,"exturl":false,"menu":{"home":"/ || home  //首页","tags":"/tags/ || tags  //标签","categories":"/categories/ || th   //分类","archives":"/archives/ || archive //归档"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":{"GitHub":"https://github.com/ || github","StackOverflow":"https://stackoverflow.com/ || stack-overflow"},"social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"友情链接","links_layout":"inline","links":{"个人简历":"https://chuanggefighting.github.io/project/","印记中文":"https://www.docschina.org/","在线工具":"http://tool.lu/","Learn Anything":"https://learn-anything.xyz/"},"avatar":{"url":"/images/chuang.png","rounded":true,"opacity":1,"rotated":true},"toc":{"enable":true,"number":true,"wrap":false,"max_depth":6},"sidebar":{"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"read_more_btn":true,"post_meta":{"item_text":true,"created_at":true,"updated_at":{"enabled":true,"another_day":true},"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":true,"awl":4,"wpm":275},"codeblock":{"border_radius":null,"copy_button":{"enable":false,"show_result":false}},"reward":{"enable":false},"related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_edit":{"enable":false,"url":"https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name"},"disable_baidu_tranformation":false,"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"font":{"enable":true,"host":"//fonts.proxy.ustclug.org","global":{"external":true,"family":"Lato","size":16},"headings":{"external":true,"family":"Roboto Slab","size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":"Lobster Two","size":24},"codes":{"external":true,"family":"Roboto Mono","size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css","copy_tex":{"enable":false,"copy_tex_js":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js","copy_tex_css":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css"}}},"pdf":{"enable":false,"per_page":true,"height":"500px","pdfobject":{"cdn":"//cdn.jsdelivr.net/npm/pdfobject@2.1.1/pdfobject.min.js"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":true,"appid":"snOvapuSplYTVflf5p9Ml9JX-gzGzoHsz","appkey":"5ABGdfyEdAtu6lTXdGdo7hf9","notify":false,"verify":false,"placeholder":"ヾﾉ≧∀≦)o 来呀！吐槽一番吧！","avatar":"mm","guest_info":"nick,mail,link","pageSize":10,"visitor":false,"comment_count":true},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"gitalk":{"enable":false,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true},"needmoreshare2":{"enable":true,"postbottom":{"enable":true,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null,"security":false,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":true,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":true,"pace_theme":"pace-theme-center-simple","canvas_nest":{"enable":true,"onmobile":true,"color":"0,0,255","opacity":0.5,"zIndex":-1,"count":99},"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"canvas_nest_nomobile":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"leancloud":null,"valine":null,"gitalk_js":null,"gitalk_css":null,"md5":null},"css":"css","js":"js","images":"images","passage_end_tag":{"enabled":true},"daovoice":true,"daovoice_app_id":"2ed51855"}}},"excerpt":"","more":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><h1 id=\"一、技术栈\"><a href=\"#一、技术栈\" class=\"headerlink\" title=\"一、技术栈\"></a>一、技术栈</h1><blockquote><p>web 开发就是呈现用户可理解的界面并响应用户操作</p></blockquote><div align=\"center\"><br><img src=\"images/web/technology.png\" alt=\"前端技能图\"><br></div><h1 id=\"二、程序员网站\"><a href=\"#二、程序员网站\" class=\"headerlink\" title=\"二、程序员网站\"></a>二、程序员网站</h1><ol><li><strong>常用</strong><ul><li><a href=\"https://www.docschina.org/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">印记中文</a>：教程中文版</li><li><a href=\"http://tool.chinaz.com/tools/openweb.aspx/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">站长工具</a>：代码整理和测试</li><li><a href=\"http://tool.lu/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">在线工具</a>：代码处理工具合集</li><li><a href=\"https://github.com/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Github</a>：代码托管</li><li><a href=\"https://stackoverflow.com/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Stack Overflow</a>：技术问答社区</li><li><a href=\"https://stackoverflow.com/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Learn Anything</a>：思维导图形式学习技术</li></ul></li><li><strong>提升</strong><ul><li><a href=\"http://naotu.baidu.com/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">百度脑图</a>：思维导图</li><li><a href=\"https://slides.com/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">ProcessOn</a>：脑图工具</li><li><a href=\"https://www.processon.com/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Slides</a>：WebPPT 编辑器</li><li><a href=\"https://caniuse.com/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">CanIuse</a>：浏览器兼容</li><li><a href=\"http://overapi.com/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Overapi</a>：API速查手册</li><li><a href=\"https://runjs.cn/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">RunJS</a>：JS在线编辑和分享</li><li><a href=\"https://standardjs.com/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Standardjs</a>：JS编码规范</li><li><a href=\"https://www.favicon-generator.org/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Faviconer</a>：图标生成器</li></ul></li><li><strong>了解</strong><ul><li><a href=\"https://github.com/easychen/howto-make-more-money\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">零花钱</a>：接单网站</li><li><a href=\"https://electronjs.org/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Electron</a>：跨平台程序</li><li><a href=\"https://github.com/github/gitignore\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">.gitignore</a>：不同语言项目</li><li><a href=\"https://modao.cc/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">墨刀</a>：在线制作移动应用原型</li></ul></li></ol><h1 id=\"三、浏览器的结构和渲染\"><a href=\"#三、浏览器的结构和渲染\" class=\"headerlink\" title=\"三、浏览器的结构和渲染\"></a>三、浏览器的结构和渲染</h1><h2 id=\"页面判断\"><a href=\"#页面判断\" class=\"headerlink\" title=\"页面判断\"></a>页面判断</h2><blockquote><p>PC 端还是移动端</p></blockquote><ul><li>功能检测：<code>“touchstart” in document</code></li><li>特征检测：<code>navigator.userAgent</code></li></ul><h2 id=\"分层结构\"><a href=\"#分层结构\" class=\"headerlink\" title=\"分层结构\"></a>分层结构</h2><blockquote><p>浏览器的抽象分层结构图中将浏览器分成了以下子系统</p></blockquote><ul><li><strong>用户界面</strong>：用于和用户进行交互的功能组件，如地址栏、返回、前进按钮等</li><li><strong>浏览器引擎</strong>：用于查询和操作渲染引擎的界面</li><li><strong>渲染引擎</strong>：负责显示请求的内容，如果请求 HTML 则它解析 HTML 和 CSS 并显示</li><li><strong>网络</strong>：负责处理网络相关的事务，如 HTTP 请求等</li><li><strong>UI 后端</strong>：负责绘制提示框等浏览器组件，底层使用操作系统的用户接口</li><li><strong>Js 解释器</strong>：负责解析和执行 JavaScript 代码</li><li><p><strong>数据存储</strong>：负责持久存储 cookie 和缓存等应用数据</p><div align=\"center\"><br><img src=\"images/web/browserCom.png\" alt=\"浏览器结构\"><br></div></li></ul><h2 id=\"渲染流程\"><a href=\"#渲染流程\" class=\"headerlink\" title=\"渲染流程\"></a>渲染流程</h2><ol><li>解析HTML结构（构建 DOM 树）</li><li>加载外部脚本和css文件（构建 CSSOM 树）</li><li>解析并执行脚本代码（js 代码）</li><li>DOM 树构建完成（此时触发 DOMContentLoaded 事件）</li><li>加载外部静态文件（图标图片等）</li><li><p>页面加载完成（此时会触发 load 事件）</p><div align=\"center\"><br><img src=\"images/web/browerRender.png\" alt=\"浏览器渲染\"><br></div></li></ol><h2 id=\"渲染问题\"><a href=\"#渲染问题\" class=\"headerlink\" title=\"渲染问题\"></a>渲染问题</h2><ul><li>资源下载<ul><li>图片下载不会产生阻塞</li><li>css 下载时会阻塞渲染，但带有 media 属性除外<ul><li>css 是由单独的下载线程异步下载的</li><li>css 加载不会阻塞 DOM 树解析，但会阻塞 render 树渲染（需要 css 信息）</li></ul></li><li>遇到 script 标签时，DOM 构建停止直到 js 脚本下载并执行完毕，此时浏览器一般会下载其他资源但不会解析。如果 js 中有对 CSSOM 的操作，还会先确保 CSSOM 已经被下载并构建。</li></ul></li><li>重绘重排导致重新进行渲染树的生成<ul><li>重绘：简单外观的改变就会引起重绘，比如颜色变化等。重排一定重绘。</li><li>重排(回流)：重新计算布局，通常由元素的结构、增删、位置、尺寸变化引起。比如 img 下载成功后替换填充页面 img 元素而引起尺寸变化。也会由 js 的属性值读取引起，比如读取 offset、scroll、cilent、getComputedStyle 等信息。</li></ul></li><li>优化方法<ul><li>直接改变 className，如果动态改变样式则使用 cssText</li><li>让要操作的元素进行离线处理，处理完后一起更新<ul><li>使用 <code>display: none</code>，只引发两次回流和重绘</li><li>使用 <code>DocumentFragment</code> 进行缓存操作，引发一次回流和重绘</li><li>使用 <code>cloneNode(true/false)、replaceChild</code>，引发一次回流和重绘</li></ul></li></ul></li></ul><h2 id=\"渲染优化\"><a href=\"#渲染优化\" class=\"headerlink\" title=\"渲染优化\"></a>渲染优化</h2><ul><li>简化 DOM 结构，最好不深于六层</li><li>尽量缓存 DOM 查找，查找器尽量简洁</li><li>涉及多域名的网站，可以开启域名预解析</li><li>动画尽量使用在 绝对/固定 定位 的元素上</li><li>隐藏在屏幕外 或 页面滚动时，尽量停止动画</li><li>DOM 操作尽量通过缓存减少次数，避免过度触发回流</li><li>js 脚本放在页面 body 底部，减少对其他过程的阻塞</li><li>Js 修改元素样式操作尽量减少，使用类名修改或动画操作样式</li><li>减少首次下载的文件数量大小，使用图片懒加载、js 按需加载等方式</li><li>css 尽量层次简单并放入 head，提前加载并防止 html 渲染后重新结合 css 引起页面闪烁</li></ul><h1 id=\"四、Web-服务器\"><a href=\"#四、Web-服务器\" class=\"headerlink\" title=\"四、Web 服务器\"></a>四、Web 服务器</h1><h2 id=\"服务器\"><a href=\"#服务器\" class=\"headerlink\" title=\"服务器\"></a>服务器</h2><blockquote><p>从硬件上来看，服务器是一台配置比较高的PC机器。但是从软件角度根据用途可分为 web 服务器、数据库服务器等，用来处理客户端请求的服务器有以下两种：</p></blockquote><ul><li><strong>web 服务器</strong><ul><li>又称 HTTP 服务器，包括 Apache、Nginx 等</li><li>专注于处理 HTTP 协议、传递本地磁盘上的静态资源给客户端，常用于提供代理服务</li></ul></li><li><strong>应用服务器</strong><ul><li>提供可以处理业务逻辑的方法，包括 WebLogic、Tomcat 等</li><li>常用来加载动态内容和处理响应数据并返回给客户端，但则只能访问其安装目录中的文件</li></ul></li></ul><h2 id=\"代理\"><a href=\"#代理\" class=\"headerlink\" title=\"代理\"></a>代理</h2><ul><li><strong>代理服务器</strong><ul><li>一种具有转发功能的应用程序，扮演了位于服务器和客户端之间”中间人”的角色</li><li>接收由客户端发送的请求并转发给服务器，同时也接收服务器返回的响应并转发给客户端</li></ul></li><li><strong>正向代理</strong><ul><li>隐藏了真实的请求客户端，客户端请求的服务都被代理服务器代替来请求</li><li>比如翻墙的原理就是在国外搭建一台代理服务器，代理去访问国外网址并返回结果给国内客户端</li></ul></li><li><strong>反向代理</strong><ul><li>隐藏了真实的服务端，反向代理服务器会帮客户端把请求转发到真实服务器</li><li>常用来做负载均衡，比如访问百度时会有很多服务器接收服务</li></ul></li><li><strong>应用</strong><ul><li>web 项目开发时联合使用 apache + tomcat + nginx</li><li>访问静态、动态资源时使用 apache/tomcat 解析</li><li>nginx 作为反向代理服务器，同时支持高并发</li></ul></li></ul><h2 id=\"运行机制\"><a href=\"#运行机制\" class=\"headerlink\" title=\"运行机制\"></a>运行机制</h2><div style=\"text-indent:2em;margin-top:15px\">Apache 等传统 Web 服务器采用了多线程模型，它会为每个客户端请求分配一个线程来同步执行 I/O 操作，系统通过线程池进行线程切换来减少时间开销。这种方式容易造成阻塞，而且浪费 CPU 和内存，当连接达到一定数量时可能会导致服务器耗光内存而崩溃，只适用于 异步操作较少但业务逻辑较复杂的应用。这就是 <code>线程驱动</code>。</div><h1 id=\"五、Web-渲染模式\"><a href=\"#五、Web-渲染模式\" class=\"headerlink\" title=\"五、Web 渲染模式\"></a>五、Web 渲染模式</h1><blockquote><p>客户端是上网时使用的手机、电脑等机器，而服务器是性能较强大的机器，可保持长时间运行并保证可随时访问服务器上文件</p></blockquote><h2 id=\"客户端渲染\"><a href=\"#客户端渲染\" class=\"headerlink\" title=\"客户端渲染\"></a>客户端渲染</h2><ul><li>实现原理：浏览器异步请求服务器获取数据，然后浏览器拼接 数据和模板文件 得到最终的 HTML字符串，最后直接解析并渲染到页面。</li><li>优势<ul><li>页面切换速度快<ul><li>传统网站中的不同页面切换是通过服务器加载一个新的页面</li><li>SPA 模型中是通过动态地重写部分页面实现局部刷新和懒加载</li></ul></li><li>一定程度上减少了服务器的压力，浏览器负责页面逻辑和渲染</li><li>前后端分离设计，服务器只需要提供接口</li></ul></li><li>问题<ul><li>SEO：传统的搜索引擎只会从 HTML 中抓取数据，导致前端渲染的页面无法被抓取。</li><li>首屏性能：用户首次加载页面时，需要先下载框架和应用程序的代码，然后再渲染页面。比如常用的 SPA 会把所有 JS 整体打包导致文件太大，页面加载时间较长而可能导致白屏问题，用户体验比较差。</li></ul></li></ul><h2 id=\"预渲染\"><a href=\"#预渲染\" class=\"headerlink\" title=\"预渲染\"></a>预渲染</h2><blockquote><p>用来改善少数营销页面的 SEO 而无需使用 web 服务器实时动态编译 HTML</p></blockquote><ul><li>实现原理：即在构建阶段简单地生成匹配特定路由的静态 html 文件，可以通过 webpack 的 prerender-spa-plugin 轻松添加。</li><li>优点：设置简单，并且可以将前端页面作为一个完全静态的站点<br>缺点：搜索引擎不能抓取到 网页内容和结构，而且不能插入动态数据</li></ul><h2 id=\"服务端渲染\"><a href=\"#服务端渲染\" class=\"headerlink\" title=\"服务端渲染\"></a>服务端渲染</h2><blockquote><p>指传统的 ASP、Java 或 PHP 的渲染机制，是预渲染的升级机制</p></blockquote><ul><li>实现原理：浏览器发起请求后，服务端将 数据和模板拼接生成的 html 字符串返回给浏览器，浏览器只是进行解析和渲染。</li><li>优点<ul><li>更好的 SEO：搜索引擎爬虫可以抓取渲染好的页面</li><li>更少的客户端电量消耗：对于电量有限的手机或平板比较重要</li><li>更快的内容到达时间：首屏加载更快而避免白屏问题，因为服务端只需要返回渲染好的 HTML</li></ul></li><li>缺点<ul><li>更多的服务器端负载（CPU 和内存资源）</li><li>更复杂的开发和部署（兼容 Node 执行环境）</li><li>不利于前后端分离，开发效率低</li></ul></li></ul><h2 id=\"同构渲染\"><a href=\"#同构渲染\" class=\"headerlink\" title=\"同构渲染\"></a>同构渲染</h2><blockquote><p>在服务器和客户端都可以运行的代码程序叫 同构，注意需要兼容 Node.js 的执行环境</p></blockquote><ul><li>实现原理：浏览器发起请求后，服务器将 数据和模板拼接生成的 html 字符串返回给浏览器，浏览器将其插入到指定节点后渲染页面。</li><li>优点<ul><li>提高首屏性能</li><li>对搜索引擎友好，有助于 SEO</li><li>前后端共用一套 Node.js 代码，节省开发时间</li></ul></li><li>缺点<ul><li>内存溢出</li><li>异步操作</li><li>大量计算、个性化缓存等性能</li><li>服务器端和浏览器的环境差异</li><li>复杂类型无法转义为字符串形式发送给前端</li></ul></li></ul><h2 id=\"架构选择\"><a href=\"#架构选择\" class=\"headerlink\" title=\"架构选择\"></a>架构选择</h2><ul><li>同构前一定要考虑到浏览器和服务器的环境差异，站在更高层面考虑</li><li>对于需要做 SEO 的项目，如果是一个后台应用，则只要首页做一些静态内容宣导即可。如果是内容型网站，那么可以考虑专门做一些页面给搜索引擎。</li><li>对于前端渲染首屏问题，我们可以采用分拆打包（路由库）、交互优化（加载动画）、部分同构（使用同构把菜单和页面骨架渲染出来） 等一些方式合理利用同构。</li></ul><h1 id=\"六、Web-框架模式\"><a href=\"#六、Web-框架模式\" class=\"headerlink\" title=\"六、Web 框架模式\"></a>六、Web 框架模式</h1><h2 id=\"框架和库\"><a href=\"#框架和库\" class=\"headerlink\" title=\"框架和库\"></a>框架和库</h2><ul><li>类库：一个有组织的功能集合，用于提供特定功能的接口并被调用</li><li>框架：构建应用程序的整体架构，使开发者可以专注于逻辑处理而提高开发效率</li><li>联系：框架一般会集成大量库并在合适地方调用，有时也可称为库，区别在于思考角度</li></ul><h2 id=\"框架模式\"><a href=\"#框架模式\" class=\"headerlink\" title=\"框架模式\"></a>框架模式</h2><h3 id=\"MVC\"><a href=\"#MVC\" class=\"headerlink\" title=\"MVC\"></a>MVC</h3><ul><li>实现思路：所有的终端用户请求被发送到 Controller，Controller 依赖请求去选择加载哪个模型并附加到对应 View，最终 View 作为响应发送给终端用户。</li><li><p>缺陷：包含大量的业务逻辑后，代码就会难以阅读和维护。</p><div align=\"center\"><br><img src=\"images/web/mvc.png\" alt=\"MVC\"><br></div></li></ul><h3 id=\"MVP\"><a href=\"#MVP\" class=\"headerlink\" title=\"MVP\"></a>MVP</h3><ul><li>实现思路：切断的 View 和 Model 的联系, 让 View 只和 Presenter（原Controller）交互，减少在需求变化中需要维护的对象的数量，相比 MVC 成本更低而且更容易理解。</li><li><p>缺陷：最接近用户的界面是需要根据需求变化而频繁更改的。</p><div align=\"center\"><br><img src=\"images/web/mvp.png\" alt=\"MVP\"><br></div></li></ul><h3 id=\"MTV\"><a href=\"#MTV\" class=\"headerlink\" title=\"MTV\"></a>MTV</h3><ul><li><p>实现思路：Model 负责业务对象和数据库的关系映射(ORM)，Template 负责如何把页面展示给用户(html)，View 负责业务逻辑并在适当时候调用 Model和Template。此外，通过一个URL分发器将一个个URL的页面请求分发给不同的View处理，View再调用相应的Model和Template。</p><div align=\"center\"><br><img src=\"images/web/mtv.png\" alt=\"MTV\"><br></div></li></ul><h3 id=\"MVVM\"><a href=\"#MVVM\" class=\"headerlink\" title=\"MVVM\"></a>MVVM</h3><ul><li>实现思路：View 接收用户交互请求并发给ViewModel –&gt; ViewModel 操作 Model 数据更新 –&gt; Model 更新后通知 ViewModel 数据化 –&gt; ViewModel 更新 View 数据。这样开发者只需关注业务逻辑，不需要手动操作DOM和关注数据状态的同步问题，复杂的数据状态维护完全由 MVVM 来统一管理，完美解决了复杂交互导致代码难以维护的问题。</li><li>优点<ul><li>独立开发（可专注于业务逻辑和数据）</li><li>低耦合性（View 和 Model 相互独立）</li><li>可重用性（可让多个 View 重用一段视图逻辑）</li><li>方便测试（可测试 ViewModel，而 Controller 不可）</li></ul></li><li><p>缺点</p><ul><li>调用复杂度增加</li><li>viewModel 会越来越庞大（逻辑多）</li><li>类会增多（每个VC都附带一个 viewModel）</li></ul><div align=\"center\"><br><img src=\"images/web/mvvm.png\" alt=\"MVVM\"><br></div></li></ul><h2 id=\"框架分类\"><a href=\"#框架分类\" class=\"headerlink\" title=\"框架分类\"></a>框架分类</h2><ul><li>可视化组件：Echarts</li><li>UI 框架：Bootstrap、EasyUI、ElementUI</li><li>JS 框架：jQuery、Zepto.js、NodeJs、requirejs、VueJs、angularJS、reactJS</li></ul><h1 id=\"七、Restful-架构\"><a href=\"#七、Restful-架构\" class=\"headerlink\" title=\"七、Restful 架构\"></a>七、Restful 架构</h1><div style=\"text-indent:2em\">RESTful 是一种架构的规范与约束、原则而并非架构或标准，符合这种规范的架构就是 RESTful架构。基于这个风格设计的软件可以更简洁，更有层次，更容易实现缓存等机制，常用于客户端和服务器交互类的软件。</div><h2 id=\"架构\"><a href=\"#架构\" class=\"headerlink\" title=\"架构\"></a>架构</h2><ul><li>RESTful 架构：面向资源的架构，即针对资源设计接口。客户端操作通过资源对应的 URL 进行操作，从而访问服务器端资源。</li><li>SOA 架构：面向服务的体系结构。SOA将不同的功能组件视为一种服务并分别封装，降低了组件之间的耦合程度，增加了代码的复用程度。</li></ul><h2 id=\"特点\"><a href=\"#特点\" class=\"headerlink\" title=\"特点\"></a>特点</h2><ul><li>资源；作为资源的标识，比如 html / jpg / json</li><li>URI：统一资源定位符，即每个 URI 对应一个特定的资源</li><li>无状态：所有资源都可以通过 URI 去定位，而不与其他资源产生耦合</li><li>统一接口：数据元操作CURD 分别对应http的 get、post、put、delete</li></ul><h2 id=\"URI\"><a href=\"#URI\" class=\"headerlink\" title=\"URI\"></a>URI</h2><ol><li><strong>区别 URL</strong><ul><li>URI：统一资源定位符，对应具体的资源。</li><li>URL：统一资源标识符，对应具体的资源的地址</li><li>联系：URL 是属于 URI 的一部分</li></ul></li><li><strong>规范</strong><ul><li>不用大写</li><li>用中杠 - 不用下杠 _</li><li>参数列表要 encode</li><li>名词表示资源集合，资源集合时使用复数形式如 zoos/1/animals</li><li>每个网址代表一种资源，所以网址中不能有动词，一般只能有名词，而且所用的名词往往与数据库的表格名对应</li></ul></li><li><strong>版本</strong><div style=\"text-indent:2em\">应该将API的版本号放入到URI中：/api.example.com/v1/zoos</div></li><li><strong>通信</strong><ul><li>前后端统一使用 json 数据</li><li>客户端通过url中的 <code>？&amp; ,</code> 实现过滤、搜索等复杂操作</li><li>客户端通过标准的 HTTP 方法（<code>GET获取、POST新建、PUT更新、DELETE删除</code>）对应服务器端资源 CRUD（数据元操作，包括 <code>SELECT、CREATE、UPDATE、DELETE</code>）</li></ul></li></ol><h1 id=\"八、JS-运行机制\"><a href=\"#八、JS-运行机制\" class=\"headerlink\" title=\"八、JS 运行机制\"></a>八、JS 运行机制</h1><h2 id=\"JS-解析引擎\"><a href=\"#JS-解析引擎\" class=\"headerlink\" title=\"JS 解析引擎\"></a>JS 解析引擎</h2><ul><li><strong>js 引擎</strong>：能够读懂 JavaScript 代码并能准确运行出结果的一段程序</li><li><strong>V8 引擎</strong>：为了提高 JS 的运行性能，在运行之前会将JS编译为本地的机器码，然后再去执行机器码。底层采用 C/C++ 编写。</li><li>对于 Java、C++、C 等静态语言处理上述事情的叫 <code>编译器</code>，而对于 JavaScript 这样的动态语言则叫做 <code>解释器</code>。区别：编译器是将源代码编译为另外一种代码（比如机器码或者字节码），而解释器是直接解析并将代码运行结果输出</li></ul><h2 id=\"进程和线程\"><a href=\"#进程和线程\" class=\"headerlink\" title=\"进程和线程\"></a>进程和线程</h2><h3 id=\"区分\"><a href=\"#区分\" class=\"headerlink\" title=\"区分\"></a>区分</h3><ul><li><strong>CPU</strong>：工厂，是执行计算任务的计算机核心</li><li><strong>进程</strong>：工厂车间，是 CPU 资源分配和独立运行的最小单位，用来完成一个任务</li><li><strong>线程</strong>：车间工人，是可以独立运行的最小的 CPU 单位，用来协同其它线程完成一个任务</li></ul><h3 id=\"模式\"><a href=\"#模式\" class=\"headerlink\" title=\"模式\"></a>模式</h3><blockquote><p>进程里并发运行的线程会共享该进程下有限的内存地址空间，运行模式必须确保同一进程里的线程不会相互影响</p></blockquote><ul><li><strong>单线程</strong>：所有任务在主线程中排队执行</li><li><strong>多线程</strong>：任务在各自独立的线程中执行而互不影响，同一进程下的所有线程共享变量</li><li><strong>多进程</strong>：允许多个任务同时运行，各个进程的变量互不影响，但会消耗更多的内存等资源</li><li><strong>协调机制</strong>：防止进程之间、线程之间产生冲突，并允许进程之间、线程之间共享资源</li></ul><h2 id=\"JS-的单线程\"><a href=\"#JS-的单线程\" class=\"headerlink\" title=\"JS 的单线程\"></a>JS 的单线程</h2><blockquote><p>单线程即 JS 引擎线程 称为 主线程，处理耗时异步任务的其它线程称为 工作线程</p></blockquote><div style=\"text-indent:2em\"><code>单线程是指浏览器中负责解释和执行 Js 代码的 JS 引擎线程只能有一个</code>，称为 <code>主线程</code>，所以同一时间只能执行一个任务，其他任务需要排队等待执行。之所以是单线程，是因为 JS 的主要用途是与用户互动和操作 DOM，多线程同时操作会带来复杂的同步问题。为了利用多核 CPU 的计算功能，HTML5 提出了 web worker 标准，允许 JS 脚本创建多个线程来处理耗时操作，但是 Worker 是 JS 引擎向浏览器申请开的子线程，它完全受主线程控制并且不能操作 DOM，所以这个新标准并没有改变JS单线程的本质。</div><ul><li><strong>WebWorker</strong><ul><li>特点：只属于某个页面，不会和其他页面的 Render 进程共享</li><li>创建：Chrome 会在 Render 进程中新建一个 Worker 线程来运行 js 程序</li></ul></li><li><strong>SharedWorker</strong><ul><li>特点：浏览器的所有页面共享</li><li>创建：Chrome 会创建一个新的进程来运行 Js 程序，但是相同的 Js 只存在一个 SharedWorker 进程而不管它被创建多少次</li></ul></li></ul><h2 id=\"浏览器的多进程\"><a href=\"#浏览器的多进程\" class=\"headerlink\" title=\"浏览器的多进程\"></a>浏览器的多进程</h2><blockquote><p>浏览器是多进程的，每打开一个 Tab 页就相当于创建了一个独立的进程。浏览器由于系统给它的进程分配了内存等资源而可以运行</p></blockquote><h3 id=\"内部进程\"><a href=\"#内部进程\" class=\"headerlink\" title=\"内部进程\"></a>内部进程</h3><ul><li><strong>Browser 进程</strong>：浏览器的主进程 (负责协调和主控)，只有一个<ul><li>负责浏览器界面显示，与用户交互。如前进，后退等</li><li>负责各个页面的管理，创建和销毁其他进程</li><li>将渲染进程得到的内存中的 Bitmap，绘制到用户界面上</li><li>负责网络资源的管理、下载等</li></ul></li><li><strong>第三方插件进程</strong>：每种类型的插件对应一个进程</li><li><strong>GPU 进程</strong>：用于 3D 绘制等，最多一个</li><li><strong>Render 进程</strong>：浏览器内核，内部是多线程的<ul><li>功能：负责页面渲染、脚本执行、事件处理等</li><li>特点：默认每个 Tab 页面对应一个进程并互不影响</li></ul></li></ul><h3 id=\"多进程的优势\"><a href=\"#多进程的优势\" class=\"headerlink\" title=\"多进程的优势\"></a>多进程的优势</h3><blockquote><p>如果浏览器是单进程，则某个 Tab 页或插件崩溃了就会影响整个浏览器，用户体验不好</p></blockquote><ul><li>避免单个page crash影响整个浏览器</li><li>避免第三方插件crash影响整个浏览器</li><li>多进程充分利用多核优势</li><li>方便使用沙盒模型隔离插件等进程，提高浏览器稳定性</li></ul><h3 id=\"浏览器内核的多线程\"><a href=\"#浏览器内核的多线程\" class=\"headerlink\" title=\"浏览器内核的多线程\"></a>浏览器内核的多线程</h3><blockquote><p>浏览器的渲染进程是多线程的</p></blockquote><div style=\"text-indent:2em\">由于 JavaScript 可以操作 DOM，如果在修改这些元素属性同时渲染界面（即JS线程和UI线程同时运行），那么渲染线程前后获得的元素数据就可能不一致了。因此为了防止渲染出现不可预期的结果，<code>浏览器设置 GUI 渲染线程与 JS 引擎线程为互斥的关系，当JS引擎执行时 GUI 线程会被挂起，GUI 更新则会被保存在一个队列中等到 JS 引擎线程空闲时立即被执行。所以 JS 如果执行时间过长就会导致页面渲染加载阻塞。</code></div><ul><li><strong>GUI 渲染线程</strong><ul><li>负责渲染浏览器界面，解析 HTML、CSS，构建 DOM、RenderObject 树等</li><li>当界面需要重绘 Repaint 或由于某种操作引发回流 reflow 时，该线程就会执行</li></ul></li><li><strong>JS 引擎线程</strong><ul><li>即 JS 内核，负责处理 Js 脚本程序</li><li>负责解析执行 Javascript 脚本代码</li><li>一直通过事件循环机制，查看并执行任务队列中的任务</li></ul></li><li><strong>事件触发线程</strong><ul><li>归属于浏览器而不是 JS 引擎，用来控制事件循环</li><li>JS 引擎执行 setTimeOut、Ajax 等代码块时，会将对应任务添加到事件线程中</li><li>某事件符合条件被触发时，该线程把事件添加到任务队列的队尾等待处理</li><li>注意：由于 JS 的单线程，队列中的事件都需要排队等待 JS 引擎空闲时才去执行</li></ul></li><li><strong>定时触发器线程</strong><ul><li>setInterval、setTimeout 所在线程，用来计时并触发定时</li><li>计时完毕后，添加到事件队列中，等待 JS 引擎空闲时执行</li><li>注意：W3C 规定 setTimeout 中低于 4ms 的时间间隔算为 4ms</li></ul></li><li><strong>异步 http 请求线程</strong><ul><li>XMLHttpRequest 连接后是通过浏览器新开一个线程请求</li><li>检测到状态变更时，如果设置有回调函数，异步线程就产生状态变更事件，将回调函数再放入事件队列中等待 Js 引擎执行</li></ul></li></ul><h3 id=\"浏览器内核和-Browser-进程的通信\"><a href=\"#浏览器内核和-Browser-进程的通信\" class=\"headerlink\" title=\"浏览器内核和 Browser 进程的通信\"></a>浏览器内核和 Browser 进程的通信</h3><ol><li>Browser 进程收到用户请求，通过网络下载或本地加载获取页面内容</li><li>Renderer 进程的接口收到 Browser 进程传递的请求，然后交给渲染线程执行<ol><li>渲染线程收到请求后，加载网页并渲染网页，</li><li>渲染过程中可能需要 Browser 进程获取资源和需要 GPU 进程帮助渲染</li><li>可能会有 JS 线程操作 DOM，这样可能会造成回流并重绘</li><li>Render 进程将渲染结果传递给 Browser 进程</li></ol></li><li>Browser 进程接收到结果并将结果绘制出来</li></ol><h2 id=\"JS-异步机制\"><a href=\"#JS-异步机制\" class=\"headerlink\" title=\"JS 异步机制\"></a>JS 异步机制</h2><h3 id=\"同步和异步\"><a href=\"#同步和异步\" class=\"headerlink\" title=\"同步和异步\"></a>同步和异步</h3><div style=\"text-indent:2em\">公路上的多辆汽车按顺序运行，这时有车坏掉了。同步模式就是让故障车停在原地修理，后面的车就会被堵住无法行驶。异步模式则是把故障车辆推到应急车道修理，正常的车流不受影响，车修好之后从应急车道回到正常车道即可，唯一的影响就是过多的应急车道会打乱车流顺序。简单来说，<code>同步可以保证顺序一致但容易导致阻塞，异步可以解决阻塞问题但会改变顺序性。具体使用时，浏览器端的 Ajax 等耗时长的操作、服务器端的所有操作 都应该异步执行</code>，否则容易导致浏览器或服务器失去响应，因为执行环境是单线程的。</div><ul><li>同步模式<ul><li>所有任务在主线程的执行栈中排队等待</li><li>类似银行排队办业务，当前执行的耗时任务会阻塞后续代码的执行</li></ul></li><li>异步模式<ul><li>本质是事件驱动模式，返回结果后通知调用</li><li>主线程执行同步任务，工作线程执行耗时异步任务</li><li>类似餐厅点餐，当前执行的任务不会阻塞后续代码的执行</li></ul></li></ul><h3 id=\"JS-任务\"><a href=\"#JS-任务\" class=\"headerlink\" title=\"JS 任务\"></a>JS 任务</h3><blockquote><p>所有任务都是在主线程上执行，形成一个执行栈</p></blockquote><ul><li>产生<ul><li>执行 js 代码</li><li>对用户操作作出反应</li><li>处理异步的网络请求</li></ul></li><li>分类<ul><li><strong>同步任务</strong>：主线程的执行栈中排队执行的任务</li><li><strong>异步任务</strong>：添加到任务列队中延迟执行的任务<ul><li><strong>宏任务</strong><ul><li>特点：一次事件循环中只执行第一个，然后重新渲染页面</li><li>场景：script 代码块、setTimeout、setInterval 等</li><li>管理：事件触发线程维护的宏任务队列</li></ul></li><li><strong>微任务</strong><ul><li>特点：一次事件循环中全部执行，在页面渲染之前完成</li><li>场景：Promise、process.nextTick 等</li><li>管理：JS 引擎线程维护的微任务队列</li></ul></li></ul></li></ul></li><li><strong>异步任务</strong><ul><li>onclick 等事件的销毁函数<ul><li>当事件触发时，回调函数会被立即添加到任务队列中</li><li>由浏览器内核的 DOM Binding 模块处理</li></ul></li><li>setInterval 等计时器<ul><li>当定时器时间到，就把该事件放到 任务队列中 等待处理</li><li>由浏览器内核的 timer 模块进行延时处理</li></ul></li><li>Ajax 请求<ul><li>在网络请求完成返回之后，将回调函数添加到任务队列中</li><li>由浏览器内核的 network 模块处理</li></ul></li></ul></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> test = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 同步任务</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">\"start\"</span>); </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 异步宏任务</span></span><br><span class=\"line\">  setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">\"异步宏任务\"</span>);</span><br><span class=\"line\">  &#125;, <span class=\"number\">300</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 异步微任务</span></span><br><span class=\"line\">  <span class=\"built_in\">Promise</span>.resolve(<span class=\"number\">42</span>).then(<span class=\"function\"><span class=\"params\">value</span> =&gt;</span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(value);</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 同步任务</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">\"end\"</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">test();</span><br></pre></td></tr></table></figure><h3 id=\"任务队列\"><a href=\"#任务队列\" class=\"headerlink\" title=\"任务队列\"></a>任务队列</h3><blockquote><p>一个 消息(事件) 的队列，具有先进先出的特点</p></blockquote><ul><li>解析异步操作后，相关的异步任务（ 事件、回调函数），就会被放到任务队列中，等待被处理</li><li>只有主线程中的任务全部执行完，任务队列中的异步任务才会被放到主线程的执行栈中开始执行</li></ul><h3 id=\"事件循环\"><a href=\"#事件循环\" class=\"headerlink\" title=\"事件循环\"></a>事件循环</h3><blockquote><p>Event Loop，指主线程重复从任务队列中读取事件并执行的过程</p></blockquote><ul><li>JS 会创建一个 类似 while(true) 的循环，每执行一次循环体的过程叫 tick</li><li>过程：查看任务队列中是都有待处理的事件，如果有：则取出，放到js主线程中执行</li><li>JS 是运行在单线程上的，所以浏览器都会单独开启一个线程来处理事件消息的轮询，避免阻塞js的执行。</li></ul><h3 id=\"异步过程\"><a href=\"#异步过程\" class=\"headerlink\" title=\"异步过程\"></a>异步过程</h3><blockquote><p>回调函数就是被主线程挂起来延迟执行的代码，主线程执行的异步任务就是对应的回调函数</p></blockquote><ol><li>主线程执行 <code>异步发起函数</code>，将异步任务转交给相应的工作线程</li><li>主线程继续执行后面的其它代码，同时工作线程执行异步任务</li><li>工作线程完成异步任务后，将调用 <code>回调函数</code> 的事件添加到任务队列等待处理</li><li><p>主线程空闲时，通过 <code>事件循环机制</code> 从任务队列中读取事件并放入执行栈，然后开始执行</p><div align=\"center\"><br><img src=\"images/web/ajax-process.png\" alt=\"Ajax实现过程\"><br></div><div style=\"text-indent:2em\">从生产者与消费者的角度看，异步过程是这样的：工作线程是生产者，主线程是消费者(只有一个消费者)。工作线程执行异步任务，执行完成后把对应的回调函数封装成一条消息放到消息队列中。主线程不断地从消息队列中取消息并执行，当消息队列为空时主线程阻塞，直到消息队列再次非空。</div></li></ol><h2 id=\"js-执行机制\"><a href=\"#js-执行机制\" class=\"headerlink\" title=\"js 执行机制\"></a>js 执行机制</h2><blockquote><p>关键是事件循环机制</p></blockquote><ol><li>JS 引擎将所有操作分为 同步任务、异步任务</li><li>同步任务进入主线程，然后直接按顺序执行</li><li>异步任务进入工作线程，当满足触发条件后推入任务队列</li><li>主线程执行完所有同步任务之后空闲时，重复去任务队列中查看是否有可执行的异步任务，有则推入主进程的执行栈<ol><li>执行一个宏任务（栈中没有就从事件队列中获取）</li><li>执行过程中如果遇到微任务，就将它添加到微任务的任务队列中</li><li>宏任务执行完毕后，立即执行当前微任务队列中的所有微任务（依次执行）</li><li>当前宏任务执行完毕，开始检查渲染，然后 GUI 线程接管渲染</li><li>渲染完毕后，JS 线程继续接管，开始下一个宏任务（从任务队列中获取）</li></ol></li></ol><div align=\"center\"><br><img src=\"images/web/js-run.png\" alt=\"js 执行机制\"><br></div><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 输出结果：1、7、6、8、2、4、3、5、9、11、10、12</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'1'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'2'</span>);</span><br><span class=\"line\">    process.nextTick(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'3'</span>);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'4'</span>);</span><br><span class=\"line\">        resolve();</span><br><span class=\"line\">    &#125;).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'5'</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">process.nextTick(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'6'</span>);</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'7'</span>);</span><br><span class=\"line\">    resolve();</span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'8'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'9'</span>);</span><br><span class=\"line\">    process.nextTick(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'10'</span>);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'11'</span>);</span><br><span class=\"line\">        resolve();</span><br><span class=\"line\">    &#125;).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'12'</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><ol><li>第一轮事件循环<ul><li>整体 script 作为第一个宏任务进入主线程，执行 console.log 输出 1</li><li>setTimeout，其回调函数被分发到宏任务 Event Queue，记为 setTimeout1</li><li>process.nextTick()，其回调函数被分发到微任务 Event Queue，记为 process1</li><li>Promise，new Promise 直接执行，输出7。then 被分发到微任务 Event Queue，记为 then1</li><li>第二个 setTimeout，其回调函数被分发到宏任务 Event Queue，记为 setTimeout2</li><li>执行两个微任务 process1、then1 输出 6、8</li><li>输出结果：1、7、6、8</li></ul></li><li>第二轮事件循环<ul><li>从宏任务 setTimeout1 开始，输出 2</li><li>process.nextTick()，同样将其分发到微任务Event Queue中，记为 process2</li><li>new Promise 立即执行输出 4，then 也分发到微任务 Event Queue，记为 then2</li><li>执行两个微任务 process2、then2 输出 3、5</li><li>输出结果：2、4、3、5</li></ul></li><li>第三轮事件循环<ul><li>此时只剩下 setTimeout2，执行输出 9</li><li>process.nextTick() 分发到微任务 Event Queue，记为process3</li><li>new Promise 直接执行输出 11，then 分发到微任务 Event Queue，记为 then3</li><li>执行两个微任务 process3、then3 输出 10、12</li><li>输出结果：9、11、10、12</li></ul></li></ol><!-- rebuild by neat -->"},{"title":"Node.js 主要内容","top":false,"keywords":["node"],"date":"2019-04-15T16:49:49.000Z","description":"主要特点、运行机制、安装配置、核心模块","_content":"\n# 一、NodeJS\n> 用于创建高性能的 Web 服务器\n\n  <div style=\"text-indent: 2em\">脚本语言都需要一个解析器才能运行，浏览器是html中Js代码的解析器。NodeJS 则是 一个独立运行的 js 代码解析器，它封装了 V8 引擎并引入了 commonjs 规范，分别解决了js比较慢和乱的问题，填补了 js 在服务器端的空白。</div>\n  <div style=\"text-indent: 2em\">每一种解析器都是一个运行环境，不但允许 JS 定义各种数据结构并进行各种计算，还允许JS使用运行环境提供的内置对象和方法做一些事情。例如运行在浏览器中的 JS 用于操作 DOM，浏览器就提供了 document 等内置对象。而运行在 NodeJS 中的 JS 用于操作磁盘文件或搭建 HTTP 服务器，NodeJS 就相应提供了 fs、http 等内置对象。</div>\n\n\n## 特点\n  * 轻量高效 \n  * 事件驱动模型\n  * 异步非阻塞 I/O 模型\n  * 单进程单线程应用程序\n\n\n## 不足\n  * 不适合处理复杂逻辑\n  * 不适合计算密集型应用\n  * 不适合单用户多任务的程序\n  * 代码某个环节报错则整个系统崩溃\n  * 只支持单核 CPU 而不能充分利用多核 CPU 服务器\n\n\n## 运行机制\n\n### 重点注意\n  * 同步异步：操作任务是否按顺序依次执行\n  * 阻塞非阻塞：IO 操作是否影响主进城执行其它代码\n  * NodeJs 内部通过线程池来完成异步操作，libuv 针对不同平台的差异性实现了统一调用，所以 NodeJS 程序的单线程仅仅指 Js 运行在单线程，程序本身并非单线程\n  * libuv 默认创建一个由四个线程组成的线程池来加载异步操作，但如今的操作系统已经对很多 I/O 任务提供了异步接口，所以只有不存在其他方式时，异步 I/O 才会使用线程池\n\n\n### 异步非阻塞\n> IO 操作的核心是通过事件机制实现异步执行\n\n  <div style=\"text-indent: 2em;\">采用了单线程模型，它使用一个主线程处理所有的请求，当接收到操作请求后就作为一个事件放入任务队列中，然后继续接收其他请求，如果有 I/O 操作（比较耗时）就交给 libuv 的工作线程去执行，所以主线程速度快而且不会阻塞，这就是 `单线程、异步 I/O`。将所有操作都注册为一个事件并等待触发的方式就是 `事件驱动`。</div>\n\n  <div style=\"text-indent: 2em; margin-top: 15px;\">如果 I/O 操作由于复杂的逻辑处理而发生了阻塞，但返回的结果是暂时在事件队列中等待，由事件循环自动依次取回到主程序中恢复执行，而事件队列在主程序之外存储事件，所以不会干扰主程序执行。这就是 `非阻塞 I/O`。</div>\n\n  \n### 事件循环\n  <div style=\"text-indent: 2em; margin-top: 15px;\">当主线程没有请求接入时，就开始通过事件循环机制查看任务队列来检查队列中是否有要处理的事件，如果是 I/O 任务就交给 libuv 的工作线程去执行并指定回调函数，否则就直接处理并返回结果给上层。当工作线程中的 I/O 任务完成后执行指定的回调函数，把这个完成的事件放到事件队列中等待事件循环时处理。这就是 `事件循环`。</div>\n\n\n  1. V8 引擎解析 JavaScript 脚本\n  2. 解析后的代码，调用 Node API\n  3. libuv 库负责 Node API 的执行。它将不同的任务分配给不同的线程，形成一个 Event Loop (事件循环），以异步的方式将任务的执行结果返回给 V8 引擎\n  4. V8 引擎再将结果返回给用户\n    * 除了 setTimeout、setInterval，NodeJs还提供了：process.nextTick、setImmediate\n    * process.nextTick 可以在当前“执行栈”尾部、下一次 EventLoop（主线程读取“任务队列”）之前，触发回调函数。即它指定的任务总是发生在所有异步任务之前\n    * setImmediate 则是在当前\"任务队列\"的尾部添加事件，它指定的任务总是在下一次 Event Loop 时执行\n  \n\n\n## 功能架构    \n  <div align=\"center\"> \n    ![Node Framework](images/nodejs/node-framework.png) \n  </div> \n            \n  * __顶部__：Js 编写的应用程序和模块\n  * __中间__：通过代码包装和暴露接口而实现 js 可以调用 c++ 代码\n    * __Bindings__：绑定核心库的依赖\n    * __Addons__：绑定第三方或者自定义 C/C++\n  * __底部__：C/C++ 编写的内部组件，提供了系统底层操作方法\n    * __V8__：Google 开源 js 引擎，用于将 Js 代码编译为机器码执行以便快速编译\n    * __libuv__：跨平台的底层封装，实现事件循环、文件操作等异步功能。\n            \n\n## 适用场景\n  <div style=\"text-indent: 2em\">NodeJS 处理并发的能力较强，但处理计算和逻辑的能力很弱，因此适用于 高并发、I/O 密集、少量业务逻辑 的场景，比如 RESTFUL API、实时聊天、客户端逻辑强大的单页 APP。一般由前端处理复杂逻辑，NodeJS 只提供异步 I/O，这样可以实现对高并发的高性能处理。</div>\n\n              \n# 二、安装配置\n> window 系统\n\n## 安装\n> 本质是把 NodeJS 执行程序复制到一个目录，然后保证这个目录在系统 PATH 环境变量下，以便终端下可以使用 node 命令\n\n  * 版本：Windows Installer(.msi) 64位\n  * 地址：建议不要安装在 C 盘而修改默认地址为 \"D:\\nodejs\\\"\n  * 命令\n    * 查看版本：`node -v`\n    * 交互模式：`node`\n    * 执行文件：`node hello.js`\n\n\n## 配置\n\n### 包文件\n> 统一管理通过 npm 全局安装的第三方包及其缓存\n\n  1. 新建文件夹：`node_global、node_cache`\n  2. 执行命令\n    * `npm config set cache \"D:\\nodejs\\node_cache\"`\n    * `npm config set prefix \"D:\\nodejs\\node_global\"`\n  3. 修改文件：node_modules\\npm\\npmrc\n    * `prefix = D:\\nodejs\\node_global`\n    * `cache = D:\\nodejs\\node_global`\n\n\n### 环境变量\n> 全局使用 npm、cnpm 等命令\n\n  <div style=\"text-indent: 2em;\">path 指系统默认指定到某一路径，运行命令时会先从这些路径中开始找。另一种方法是在系统变量中设置 NODE_PATH = 安装的根目录，NodeJS 允许通过变量 NODE_PATH 指定额外的模块搜索路径。所以配置方法如下：</div>\n\n  * 用户变量 PATH 末尾添加 `\";D:\\nodejs\\node_global\"`\n  * 系统变量新增 `NODE_PATH: \"D:\\nodejs\\node_global\\node_modules\"`\n\n\n## 安装 cnpm\n> npm 服务器在国外而安装速度慢，所以大多都使用淘宝对 npm 的镜像服务器 cnpm，它和 npm 命令相同\n\n  * 安装：`npm install cnpm -g --registry=https://registry.npm.taobao.org`  \n  * 查看：`cnpm -v`\n  * 安装依赖：`cnpm install`\n  * 安装失败的解决方案：`npm config set registry https://registry.npm.taobao.org`\n\n                  \n## 安装 nodemon         \n> 编写调试 Node 项目时，每次修改代码后都需要重新启动，比较麻烦。nodemon 工具可以监听代码文件的变化，并自动重启 Node 服务器和数据库服务器\n\n  ```js\n  // 安装\n  cnpm install -g  nodemon\n\n  // app.js\n  var http = require('http')\n  http.createServer((req, res) => {\n      res.end('hello node');\n  }).listen(3000);\n\n  // 启动\n  nodemon app\n  ```\n\n\n# 三、模块管理\n\n## 模块机制\n  * 根据模块(文件) 划分功能、组织和复用代码\n  * 通过 npm 工具和网站进行开源社区代码共享\n  * 通过包规范管理应用和可复用组件\n\n\n## 模块模型\n  * __核心模块__：NodeJS 提供，会被编译到二进制执行文件（加载速度快）\n    * __C/C++ 内建模块__：存放src目录下的最底层模块，会提供js调用的API\n    * __Js 核心模块__：存放在lib目录下，为C/C++内建模块提供封装和桥接\n  * __文件模块__：用户编写，动态加载（加载速度较慢）\n    * __C++ 扩展模块__：用于提高运行效率等自定义编写的底层模块\n    * __Js 文件模块__：由第三方或用户自行编写的模块\n\n\n## 模块缓存\n  * 模块会在第一次 require 后被缓存，`多次 require 不会导致模块的代码被执行多次`\n  * Node 模块的缓存不同于浏览器的 js 缓存，浏览器只缓存文件，`Node 模块缓存的是编译和执行之后的对象`\n  * require.cache 对象代表 Node 模块缓存区，缓存的模块以属性的方式加入该对象，可以通过 `require.cache['模块标识符'] 来访问具体的缓存模块`，也可以 delete 该缓存\n\n\n## 模块变量\n\n### 全局对象\n  * __global__：表示Node所在的全局环境，类似于浏览器中的window对象\n  * __process__：指向Node内置的process模块，允许开发者与当前进程互动\n  * __console__：指向Node内置的console模块，提供命令行环境中的标准输入、标准输出功能。\n\n\n### 全局函数  \n  * __模块加载函数__：require\n  * __定时器函数__：setTimeout、setInterval、clearTimeout、clearInterval\n\n\n### 全局变量\n  * ___filename__：指向当前运行脚本的文件名\n  * ___dirname__：指向当前运行脚本所在的目录\n\n\n### 模块变量\n  * __module__：表示当前模块的对象\n  * __module.exports__：模块的导出对象\n  * __module.filename__：模块解析后的文件名\n  * __exports__：指向 module.exports 对象的变量\n\n\n## 模块包规范\n> NodeJS 采用包来对一组具有相互依赖关系的模块进行统一管理，封装为独立的复用组件或单个应用。Node的包通常为一个目录，主要包括如下内容：\n\n  * __package.json__：包的描述文件\n  * __bin__：可执行文件、二进制文件\n  * __lib__：待加载的 js 文件\n  * __doc__：使用包的说明文档\n  * __test__：单元测试用例代码文件\n  * __node_modules__：本地安装包\n\n\n# 四、核心模块\n\n## HTTP\n> 处理客户端的网络请求\n\n### 作为客户端\n  * __client__：连接服务器\n    * 发起请求：`http.request(options, fn)`\n    * 简化版，不用 end：`http.get(options, fn)`\n  * __ClientRequest__：处理要发送的请求信息\n    * 收到请求：`req.on(\"response\", fn)`\n    * 收到错误：`req.on(\"error\", fn)`\n    * 写入数据：`req.write`\n    * 完成发送：`req.end`\n  * __ClientResponse__：获取服务端返回信息\n    * 传输数据：`res.on(\"data\", fn)`\n    * 传输结束：`res.on(\"end\", fn)`\n    * 请求关闭：`res.on(\"close\", fn)`\n    * 设置存储：`res.setEncoding`\n    * 暂停请求：`res.pause`\n    * 恢复请求：`res.resume`\n    * 状态码：`res.statusCode`\n    * 请求头：`res.headers`\n\n\n### 作为服务端\n  * __Server__：创建服务器\n    * 生成实例：`Server()`\n      * 接收请求：`on(\"request\", fn)`\n      * 关闭请求：`on(\"close\", fn)`\n      * 监听服务：`listen(port, fn)`\n      * 新建 TCP 流：`on(\"connection\", fn)`\n    * 直接创建：`createServer(fn).listen(port)`\n  * __IncomingMessage__：获取客户端请求信息\n    * 传输数据：`on(\"data\", fn)`\n    * 传输结束：`on(\"end\", fn)`\n    * 请求关闭：`on(\"close\", fn)`\n    * 请求方法：`method`\n    * 请求地址：`url`\n  * __ServerResponse__：处理返回给客户端的信息res\n    * 设置头信息：`setHead`\n    * 合并头信息：`writeHead`\n    * 写入数据：`write`\n    * 结束传输：`end`\n\n```js\nvar http = require('http')\nvar url = require('url')\n\nhttp.createServer((req,res)=>{\n    // 将传过来的URL转变为对象\n    var params = url.parse(req.url,true)\n    res.write(params.query.name)\n    res.end()\n    // res.end(params.query.name);\n}).listen(3000);\n\n// 客户端请求\nvar request = http.get({\n    host:'localhost',\n    path:'/user?name=tom&age=22',\n    port:3000},function(res){\n    res.setEncoding('utf-8')\n    res.on('data',function(data){\n        console.log('res_date：'+data)\n    })\n})\n```\n        \n\n## URL\n> 处理客户端请求过来的URL\n\n  * __parse__：将 url 字符串地址转为一个对象\n  * __format__：将 url 对象转为一个 url 字符串\n  * __resolve__：对传入的两个参数用 `/` 拼接\n\n\n  ```js\n  const url = require(\"url\")\n\n  url.parse(\"http://user:pass@host.com:8080/p/a/t/h?query=string#hash\")\n  url.parse(\"http://user:pass@host.com:8080/p/a/t/h?query=string#hash\", true)\n\n  url.format({\n      protocol: \"http:\",\n      host: \"182.163.0:60\",\n      port: \"60\"\n  })\n  url.resolve(\"http://whitemu.com\", \"gulu\")\n  ```\n\n\n## Querystring\n> 处理客户端 get/post 请求传递的参数\n\n  * __parse__：将一个字符串反序列化为一个对象\n  * __stringify__：将一个对象序列化成一个字符串\n  * __escape__：使传入的字符串进行编码\n  * __unescape__：对使用了 escape 编码的字符进行解码\n\n\n  ```js\n  var querystring = require('querystring')\n  \n  querystring.parse(\"name=tom&sex=man&sex=women\")\n  querystring.stringify({ name: 'tom', sex: ['man', 'women']})\n\n  querystring.escape(\"name=慕白\")\n  querystring.unescape('name%3D%E6%85%95%E7%99%BD')\n  ```\n\n\n## Path\n> 操作文件路径\n\n  * 获取路径信息\n    * __dirname__：路径\n    * __extname__：扩展名\n    * __basename__：文件名\n  * 路径拼接\n    * __join__：使用当前系统的路径分隔符拼接路径\n    * __resolve__：将相对路径拼接出绝对路径\n    * __relative__：解析出两个路径之间的相对路径\n  * 路径处理\n    * __parse__：路径分解而返回对象\n    * __format__：路径组合而返回字符串\n    * __normalize__：路径标准化\n    * __isAbsolute__：判断路径是否为绝对路径\n\n\n  ```js\n  var path = require('path')\n  path.dirname('/foo/bar/baz/asdf/a.txt')\n\n  path.join('/foo', 'bar', 'baz/asdf', '..')\n  path.resolve('www', 'js/upload', '../mod.js')\n  path.relative('C:/test/aaa', 'C:/bbb')\n\n  path.parse('/home/user/dir/file.txt')\n  path.format({\n      dir: '/tmp', \n      name: 'hello',\n      ext: '.js'\n  })\n  path.normalize('a/../user/bin')\n  path.isAbsolute('/foo/bar')\n  ```\n\n\n## Events\n> 事件处理模块\n\n  <div style=\"text-indent: 2em;\">回调函数模式让 NodeJS 可以处理异步操作，但对于无法处理多状态的异步操作则需要进行拆分而分阶段执行。为了解决这个问题，NodeJS 提供了 Event Emitter 接口，通过事件解决多状态异步操作的响应问题。events 模块对外暴露一个 EventEmitter 类，可以用来生成事件发生器的实例 emitter，然后通过实例方法处理事件，比如 on/once 监听事件、emit 触发事件、removeListener 删除事件等。</div>\n        \n  ```js\n  // 模块调用\n  var events = require(\"events\")\n  var emitter = new events.EventEmitter()\n\n  // 事件监听\n  emitter.on(\"connection\", function () {\n      console.log(\"linked Success\");\n  })\n\n  // 事件触发\n  emitter.emit(\"connection\")\n  ```\n\n\n\n## FS\n> 在服务端来操作文件。默认异步操作，同步 API 则只需添加 Sync，比如 readFileSync\n\n  * 操作文件\n    * __readFile__：文件读取\n    * __writeFile__：文件写入\n    * __appendFile__：追加写入\n    * __rename__：文件重命名\n    * __unlink__：文件删除\n  * 操作目录\n    * __mkdir__：创建\n    * __readdir__：读取\n    * __rmdir__：删除空目录\n    * __chmod__：修改权限\n  * 其它\n    * __stat__：详细信息\n    * __exists__：判断存在\n\n  \n  ```js\n  var fs = require(\"fs\");\n  fs.stat('input.txt', function (err, stats) {\n\n      // 大括号中只有一句语句时可以省略\n      if (err) return console.error(err) \n\n      stats.isFile()        // 是否为文件\n      stats.isDirectory()   // 是否为目录\n  })\n\n  // 异步写入\n  fs.writeFile('input.txt', '写入文件的内容',  function(err) {\n\n      if (err) return console.error(err) \n\n      // 异步读取\n      fs.readFile('input.txt', function (err, data) {\n\n          if (err) return console.error(err) \n\n          var data_str = data.toString()\n      })\n  })\n  ```\n\n\n\n## Stream\n> 本质是对 buffer 对象的高级封装，它操作的底层是 buffer 对象\n\n### 流\n  <div style=\"text-indent: 2em;\">操作系统采用数据块（chunk）的方式读取数据，每收到一次数据就存入缓存。NodeJS 应用程序有两种缓存的处理方式：第一种是先将数据全部读入内存，然后一次性从缓存中读取，这种方式对于视频等二进制大文件很容易使内存\"爆仓\"。第二种是采用 数据流（stream）的方式，边读取边存入。</div>\n\n  <div style=\"text-indent: 2em; margin-top: 15px;\">流表示一组有序的、有起止点的字节数据的序列，但是流的数据不能一次性读取或写入。NodeJs 将关于流的操作封装到了 Stream 模块并提供了 Stream API 通过事件来实现基于流的IO操作，比如处理普通文件、网络文件 (http、net)、设备文件 (stdin、stdout)。</div>\n            \n            \n### 流操作\n  * __流读取__：NodeJS 不断将文件一小块内容读入缓冲区，再从缓冲区中读取内容\n  * __流写入__：NodeJS 不断将流数据写入内在缓冲区，待缓冲区 满后再将缓冲区写入到文件中，重复操作直到完成\n  * __直接操作__：readFile/read、writeFile/write 一次性读取内容或写入内存\n\n\n### 流事件\n> 所有 Stream 对象 都是 EventEmitter 类的实例，读写流的不同状态时就会触发相应事件\n\n  * __data__：当有数据可读时触发\n  * __end__：数据已经全部读取完毕时触发\n  * __error__：读取或写入的过程中发生错误时触发\n  * __finish__：所有数据都已经被写入到底层系统时触发\n\n\n### 流类型\n  * __Readable__：从流中读取数据的 API，用于对外提供数据\n  * __Writable__：往流中写入数据的 API，用于写入数据\n  * __Duplex__：在流中可读写数据的 API，用于读取和写入数据\n  * __Transform__：在读写过程中可以修改和变换数据的 Duplex 流\n\n\n### 流模式\n> 根据流中传递数据的类型来区分，一般需要在创建流时指定其模式而且不再修改，但是可以通过拼接转换流来进行模式转换并得到一个新的流\n\n  * __Object Mode__：对象模式，即流中传递的是任意类型的 Js 对象（null 除外）\n  * __Buffering Mode__：Buffer 模式，即流中传递的是 Buffer 对象\n\n        \n### null 对象\n> 在流中的作用如下\n\n  * 向 Writable 流中写入 null，表示数据源的数据已经写入完成，继续写入数据则会报错\n  * 从 Readable 流中读取到 null，表示所有数据已经读取完毕，流中不会再有可读取的数据\n\n\n### 流的拼接\n  <div style=\"text-indent: 2em;\">就像可以把两个水管串成一个更长的水管一样，一个 Readable 流和一个 Writable 流串起来后，所有的数据自动从 Readable 流进入 Writable 流。Readable API 提供了 pipe 方法用于流的拼接，但注意位于中间的流必须是 Duplex 流。</div>\n\n\n```js\n// 读取数据流\nvar fs = require(\"fs\")\nvar data = ''\n// 创建可读流，即将文件内容读取为流数据\nvar readStream = fs.createReadStream('input.txt') \nreadStream.setEncoding('UTF8')  \n// 处理流事件 --> data, end, and error\nreadStream.on('data', function(chunk) {\n    data += chunk\n})\nreadStream.on('end',function(){\n    console.log(data)\n})\nreadStream.on('error', function(err){\n    console.log(err.stack)\n})\n\n\n// 写入流\nvar fs = require(\"fs\")\nvar data = '要写入的内容'\n// 创建可写流并写入到文件中\nvar writeStream = fs.createWriteStream('output.txt')\nwriteStream.write(data, 'UTF8')\nwriteStream.write(new Buffer('使用Stream写入二进制数据...\\n', 'utf-8'));\nwriteStream.end()   // 标记文件末尾\n\n// 处理流事件 --> data, end, and error\nwriteStream.on('finish', function() {\n    console.log(\"写入完成。\")\n})\nwriteStream.on('error', function(err){\n    console.log(err.stack)\n})\n\n\n// 管道流\nvar fs = require(\"fs\");\n// 创建一个可读流\nvar readStream = fs.createReadStream('input.txt', {\n        encoding:'utf8',  // 不传默认buffer，显示为字符串\n        start:3,          // 从索引为3的位置开始读\n});\n// 创建一个可写流\nvar writeStream = fs.createWriteStream('output.txt');\n// 管道读写操作：读取 input.txt 内容并将内容写入到 output.txt\nreadeStream.pipe(writeStream);\n\n\n// 链式流：链式是通过连接输出流到另外一个流并创建多个对个流操作链的机制\n// 链式流一般用于管道操作。以下是用管道和链式来压缩和解压文件\nvar fs = require(\"fs\")\nvar zlib = require('zlib')\nvar data = 'test dfddgfdgfdgfdgfd jkwu'\n// 压缩 input.txt 文件为 input.txt.gz\nfs.createReadStream('input.txt')\n    .pipe(zlib.createGzip())\n    .pipe(fs.createWriteStream('input.txt.gz'))\n// 解压 input.txt.gz 文件为 input.txt\nfs.createReadStream('input.txt.gz')\n    .pipe(zlib.createGunzip())\n    .pipe(fs.createWriteStream('input.txt'))\n        \n       \n// HTTP 对象使用 Stream 接口，实现网络数据的读写\nvar http = require('http')\nvar server = http.createServer(function (req, res) {\n    var body = ''\n    req.setEncoding('utf8')\n    req.on('data', function (chunk) {\n        body += chunk\n    });\n    req.on('end', function () {\n        try {\n            var data = JSON.parse(body);\n        } catch (er) {\n            res.statusCode = 400;\n            return res.end('error: ' + er.message);\n        }\n        res.write(typeof data);\n        res.end();\n    })\n})\nserver.listen(8080)\n\n\n// 错误处理\nhttp.createServer(function (req, res) {\n    var stream = fs.createReadStream('filename.txt')\n    stream\n    .on('error', onerror)\n    .pipe(zlib.createGzip())\n    .on('error', onerror)\n    .pipe(res)\n  \n    onFinished(res, function () {\n      stream.destroy()\n    })\n})\n```\n\n\n## util\n> 提供一系列实用方法，注意需要安装 npm install util\n\n  * 格式化字符串：`format`\n  * 数据类型验证：`isDate、isArray、isError、isRegExp`\n  * 其它：`inherits (继承)、inspect (对象转化为字符串)`\n  \n\n\n# 五、Web 开发\n\n## 搭建 web 服务器\n### 通过插件\n> http-server、live-server\n\n  ```js\n  npm install http-server -g\n  cd progect      // 进入项目目录\n  http-server     // 开启服务\n  ```\n\n\n### 通过 NodeJs\n  ```js\n  var http = require('http');\n  var url = require('url');\n  var path = require('path');\n  var fs = require('fs');\n\n  // 命令行第三个参数，用来接收目录，可为空，相对当前server.js的目录名称\n  // 比如 node server debug，则 debug 文件夹与 server.js 文件同级并以 debug 启动服务\n  var dir, arg = process.argv[2] || ''; \n\n  http.createServer(function (req, res) {\n      var pathname = __dirname + url.parse(req.url).pathname;\n      // 保存 dir (目录)\n      dir = dir ? dir : pathname; \n      // 替换文件静态路径\n      pathname = dir ? pathname.replace(dir, dir + arg + '/') : pathname; \n      if (path.extname(pathname) == \"\") {\n          pathname += \"/\";\n      }\n      if (pathname.charAt(pathname.length - 1) == \"/\") {\n          // 入口文件，此处默认index.html\n          pathname += \"index.html\"; \n      }\n\n      fs.exists(pathname, function (exists) {\n          if (exists) {\n              switch (path.extname(pathname)) {\n                case \".html\":\n                    res.writeHead(200, {\"Content-Type\": \"text/html\"});\n                    break;\n                case \".js\":\n                    res.writeHead(200, {\"Content-Type\": \"text/javascript\"});\n                    break;\n                case \".css\":\n                    res.writeHead(200, {\"Content-Type\": \"text/css\"});\n                    break;\n                case \".gif\":\n                    res.writeHead(200, {\"Content-Type\": \"image/gif\"});\n                    break;\n                case \".jpg\":\n                    res.writeHead(200, {\"Content-Type\": \"image/jpeg\"});\n                    break;\n                case \".png\":\n                    res.writeHead(200, {\"Content-Type\": \"image/png\"});\n                    break;\n                default:\n                    res.writeHead(200, {\"Content-Type\": \"application/octet-stream\"});\n              }\n\n              // res 可以自己添加信息来简单交互 比如可以修改 header 信息、修改返回数据\n              fs.readFile(pathname, function (err, data) {\n                  res.end(data);\n              });\n          }\n          else {\n              res.writeHead(404, {\"Content-Type\": \"text/html\"});\n              res.end(\"Not Found\");\n          }\n      });\n  }).listen(9090, \"127.0.0.1\"); // 服务器端口\n\n  console.log(\"server running at http://127.0.0.1:9090/\");\n  ```\n\n\n\n## 连接 mysql\n> 安装 mysql 及其驱动：npm install mysql node-mysql -g     \n\n### 直接连接\n  ```js\n  let http = require('http')\n  let mysql = require(\"mysql\")\n\n  const connection = mysql.createConnection({\n      host: \"127.0.0.1\",      // 主机\n      user: \"root\",           // 用户名\n      password: \"li1993416\",  // 用户密码\n      port: \"3306\",           // 端口号\n      database: \"mysql\"       // 数据库名\n  })\n\n  // 连接数据库\n  connection.connect(function(err){\n      if(err){\n          console.log(`mysql connect fail: ${err}!`);\n      }else{\n          console.log(\"mysql connect success!\");\n      }\n  });\n\n  // 执行查询\n  let str = \"\";\n  let sqlQuery = \"select * from students\";\n  connection.query(sqlQuery, function(err, result){\n      if(err){\n          console.log(`SQL error: ${err}!`);\n      }else{\n          str = JSON.stringify(result);\n      }\n  });\n\n  // 返回数据\n  http.createServer((req, res)=>{\n      res.end(str)\n  }).listen(3000);\n  console.log('Server running at localhost:3000')\n\n  //关闭connection  \n  connection.end(function(err){  \n      if(err){ \n          console.log(err.toString());\n          return;  \n      }  \n      console.log('[connection end] succeed!')\n  })\n  ```\n\n\n### 通过连接池\n> 数据库连接池负责分配、管理和释放数据库连接，它允许应用程序重复使用一个现有的数据库连接而不是再重新建立一个，用于对数据库操作的性能\n\n  ```js\n  let mysql = require('mysql');\n  const pool = mysql.createPool({\n      host: \"127.0.0.1\",      // 主机\n      user: \"root\",           // 用户名\n      password: \"li1993416\",  // 用户密码\n      port: \"3306\",           // 端口号\n      database: \"mysql\"       // 数据库名\n  })\n  pool.getConnection(function(err, connection) {\n      connection.query('select * from students', [], function(err, result) {\n          if (err) {\n              console.log(\"Error: \" + err.message);\n              return;\n          }\n          connection.release();\n          console.log(result);\n      })\n  })\n  ```\n\n\n## 上传文件\n\n  <div align=\"center\"> \n    ![Node UploadFile](images/nodejs/node-uploadFile.png)\n  </div> \n\n  ```js\n  // server.js\n  var express = require('express');\n  var app = express();\n  var fs = require(\"fs\");\n\n  var bodyParser = require('body-parser');\n  var multer  = require('multer');\n\n  app.use(express.static('public'));\n  app.use(bodyParser.urlencoded({ extended: false }));\n\n  // dest 定义上传目录，array 限制上传类型（即 input name）　\n  app.use(multer({ dest: './uploads'}).array('image'));\n\n  app.get('/', function (req, res) {\n      res.sendFile( __dirname + \"/\" + \"index.html\" );\n  })\n\n  app.post('/file_upload', function (req, res) {\n\n      console.log(req.files[0]);  // 上传的文件信息\n      var des_file = __dirname + \"/\" + req.files[0].originalname;\n\n      fs.readFile( req.files[0].path, function (err, data) {\n          fs.writeFile(des_file, data, function (err) {\n              if(err){\n                  console.log(err)\n              }else{\n                  response = {\n                      message: 'File uploaded successfully', \n                      filename: req.files[0].originalname\n                  }\n              }\n              console.log( response );\n              res.end( JSON.stringify( response ) );\n          })\n      })\n  })\n\n  var server = app.listen(3000, function () {\n        console.log(\"localhost:3000\")\n  })\n\n\n  // 运行命令\n  npm install multer body-parser -S\n  node server.js\n  ```\n\n\n## WebSocket\n\n### 通过 ws 模块\n\n  ```js\n  // 安装\n  cnpm i ws -S\n\n  // 客户端js\n  if(window.WebSocket != undefined) {  \n      //创建一个WebSocket，监听端口6060端口，这里必须是：ws，不能是http\n      var connection = new WebSocket('ws://localhost:6060'); \n\n      // readyState : 0：正在连接、1：连接成功、2：正在关闭、3：连接关闭\n      console.log(connection.readyState); \n\n      // 握手协议成功以后，readyState就从0变为1，并触发open事件  \n      connection.onopen = (event) => {   \n          console.log(event);\n          //连接建立后，客户端通过send方法向服务器端发送数据。   \n          connection.send('client message'); \n      };  \n\n      //监听  \n      connection.onmessage = (event) => {   \n          console.log(event);  \n      };  \n\n      //关闭WebSocket连接，会触发close事件。  \n      connection.onclose = () => {   \n          console.log(\"Closed\");  \n      };  \n\n      //出现错误  \n      connection.onerror = (event) => {   \n          console.log(\"Error: \" + event.data);  \n      }\n  }\n\n  // 服务器 server.js\n\n  // 启动 WebSocket 服务器\n  var server = require('http').createServer() , \n      WebSocketServer = require('ws').Server , \n      wss = new WebSocketServer({ server: server }) , \n      app = require('express')() , \n      port = 6060;\n\n  // 使用 express 中间件\n  app.use(function (req, res) { \n      //send用来向客户端发送信息，on用来接收/监听客户端发来的信息\n      res.send({ msg: \"hello\" });\n  });\n  // 监听事件  %s 字符串、%d 整数、%f 浮点数\n  wss.on('connection', function connection(ws) { \n      //监听 \n      ws.on('message', function incoming(message) {  \n          console.log('received: %s', message);\n      });\n      //发送 \n      ws.send('something')\n  })\n\n  server.on('request', app);\n  server.listen(port, function () { \n      console.log('http://localhost:' + server.address().port) \n  })\n  ```\n\n\n### 通过 socket.io\n\n  ```js\n  // 安装\n  cnpm i socket.io -S\n\n  // 客户端 js (需要引入 socket.io.js)\n  var socket = io.connect('http://localhost:8080')  \n  socket.on('news', function (data) {   \n      socket.emit('event', { my: 'data' })\n  })\n\n\n  // 服务器 server.js\n  var app = require('http').createServer(handler), \n      io = require('socket.io').listen(app), \n      fs = require('fs')\n\n  app.listen(8080);\n  io.set('log level', 1)  // 关闭 debug 信息\n\n  function handler (req, res) {\n    fs.readFile(__dirname + '/index.html',function (err, data) {  \n        if (err) {\n          res.writeHead(500);\n          return res.end('Error loading index.html');\n        }    \n        res.writeHead(200, {'Content-Type': 'text/html'});    \n        res.end(data);\n    })\n  }\n\n  io.sockets.on('connection', function (socket) {\n      socket.emit('news', { hello: 'world' });\n      socket.on('my other event', function (data) {\n        console.log(data);\n      })\n  })\n  ```\n\n\n## 解决跨域\n  ```js\n  cnpm install cors --save\n\n  // app.js 加入代码\n  var cors = require('cors');\n  app.use(cors({\n      origin:['http://localhost:8080'],  //指定接收的地址\n      methods:['GET','POST'],            // 指定接收的请求类型\n      alloweHeaders:['Content-Type', 'Authorization']  // 指定 header\n  }))\n  ```\n\n","source":"_posts/19-Node基础.md","raw":"---\ntitle: Node.js 主要内容\ntags:\n  - Node.js\ncategories: Node.js\ntop: false\nkeywords:\n  - node\ndate: 2019-04-16 00:49:49\ndescription: 主要特点、运行机制、安装配置、核心模块\n---\n\n# 一、NodeJS\n> 用于创建高性能的 Web 服务器\n\n  <div style=\"text-indent: 2em\">脚本语言都需要一个解析器才能运行，浏览器是html中Js代码的解析器。NodeJS 则是 一个独立运行的 js 代码解析器，它封装了 V8 引擎并引入了 commonjs 规范，分别解决了js比较慢和乱的问题，填补了 js 在服务器端的空白。</div>\n  <div style=\"text-indent: 2em\">每一种解析器都是一个运行环境，不但允许 JS 定义各种数据结构并进行各种计算，还允许JS使用运行环境提供的内置对象和方法做一些事情。例如运行在浏览器中的 JS 用于操作 DOM，浏览器就提供了 document 等内置对象。而运行在 NodeJS 中的 JS 用于操作磁盘文件或搭建 HTTP 服务器，NodeJS 就相应提供了 fs、http 等内置对象。</div>\n\n\n## 特点\n  * 轻量高效 \n  * 事件驱动模型\n  * 异步非阻塞 I/O 模型\n  * 单进程单线程应用程序\n\n\n## 不足\n  * 不适合处理复杂逻辑\n  * 不适合计算密集型应用\n  * 不适合单用户多任务的程序\n  * 代码某个环节报错则整个系统崩溃\n  * 只支持单核 CPU 而不能充分利用多核 CPU 服务器\n\n\n## 运行机制\n\n### 重点注意\n  * 同步异步：操作任务是否按顺序依次执行\n  * 阻塞非阻塞：IO 操作是否影响主进城执行其它代码\n  * NodeJs 内部通过线程池来完成异步操作，libuv 针对不同平台的差异性实现了统一调用，所以 NodeJS 程序的单线程仅仅指 Js 运行在单线程，程序本身并非单线程\n  * libuv 默认创建一个由四个线程组成的线程池来加载异步操作，但如今的操作系统已经对很多 I/O 任务提供了异步接口，所以只有不存在其他方式时，异步 I/O 才会使用线程池\n\n\n### 异步非阻塞\n> IO 操作的核心是通过事件机制实现异步执行\n\n  <div style=\"text-indent: 2em;\">采用了单线程模型，它使用一个主线程处理所有的请求，当接收到操作请求后就作为一个事件放入任务队列中，然后继续接收其他请求，如果有 I/O 操作（比较耗时）就交给 libuv 的工作线程去执行，所以主线程速度快而且不会阻塞，这就是 `单线程、异步 I/O`。将所有操作都注册为一个事件并等待触发的方式就是 `事件驱动`。</div>\n\n  <div style=\"text-indent: 2em; margin-top: 15px;\">如果 I/O 操作由于复杂的逻辑处理而发生了阻塞，但返回的结果是暂时在事件队列中等待，由事件循环自动依次取回到主程序中恢复执行，而事件队列在主程序之外存储事件，所以不会干扰主程序执行。这就是 `非阻塞 I/O`。</div>\n\n  \n### 事件循环\n  <div style=\"text-indent: 2em; margin-top: 15px;\">当主线程没有请求接入时，就开始通过事件循环机制查看任务队列来检查队列中是否有要处理的事件，如果是 I/O 任务就交给 libuv 的工作线程去执行并指定回调函数，否则就直接处理并返回结果给上层。当工作线程中的 I/O 任务完成后执行指定的回调函数，把这个完成的事件放到事件队列中等待事件循环时处理。这就是 `事件循环`。</div>\n\n\n  1. V8 引擎解析 JavaScript 脚本\n  2. 解析后的代码，调用 Node API\n  3. libuv 库负责 Node API 的执行。它将不同的任务分配给不同的线程，形成一个 Event Loop (事件循环），以异步的方式将任务的执行结果返回给 V8 引擎\n  4. V8 引擎再将结果返回给用户\n    * 除了 setTimeout、setInterval，NodeJs还提供了：process.nextTick、setImmediate\n    * process.nextTick 可以在当前“执行栈”尾部、下一次 EventLoop（主线程读取“任务队列”）之前，触发回调函数。即它指定的任务总是发生在所有异步任务之前\n    * setImmediate 则是在当前\"任务队列\"的尾部添加事件，它指定的任务总是在下一次 Event Loop 时执行\n  \n\n\n## 功能架构    \n  <div align=\"center\"> \n    ![Node Framework](images/nodejs/node-framework.png) \n  </div> \n            \n  * __顶部__：Js 编写的应用程序和模块\n  * __中间__：通过代码包装和暴露接口而实现 js 可以调用 c++ 代码\n    * __Bindings__：绑定核心库的依赖\n    * __Addons__：绑定第三方或者自定义 C/C++\n  * __底部__：C/C++ 编写的内部组件，提供了系统底层操作方法\n    * __V8__：Google 开源 js 引擎，用于将 Js 代码编译为机器码执行以便快速编译\n    * __libuv__：跨平台的底层封装，实现事件循环、文件操作等异步功能。\n            \n\n## 适用场景\n  <div style=\"text-indent: 2em\">NodeJS 处理并发的能力较强，但处理计算和逻辑的能力很弱，因此适用于 高并发、I/O 密集、少量业务逻辑 的场景，比如 RESTFUL API、实时聊天、客户端逻辑强大的单页 APP。一般由前端处理复杂逻辑，NodeJS 只提供异步 I/O，这样可以实现对高并发的高性能处理。</div>\n\n              \n# 二、安装配置\n> window 系统\n\n## 安装\n> 本质是把 NodeJS 执行程序复制到一个目录，然后保证这个目录在系统 PATH 环境变量下，以便终端下可以使用 node 命令\n\n  * 版本：Windows Installer(.msi) 64位\n  * 地址：建议不要安装在 C 盘而修改默认地址为 \"D:\\nodejs\\\"\n  * 命令\n    * 查看版本：`node -v`\n    * 交互模式：`node`\n    * 执行文件：`node hello.js`\n\n\n## 配置\n\n### 包文件\n> 统一管理通过 npm 全局安装的第三方包及其缓存\n\n  1. 新建文件夹：`node_global、node_cache`\n  2. 执行命令\n    * `npm config set cache \"D:\\nodejs\\node_cache\"`\n    * `npm config set prefix \"D:\\nodejs\\node_global\"`\n  3. 修改文件：node_modules\\npm\\npmrc\n    * `prefix = D:\\nodejs\\node_global`\n    * `cache = D:\\nodejs\\node_global`\n\n\n### 环境变量\n> 全局使用 npm、cnpm 等命令\n\n  <div style=\"text-indent: 2em;\">path 指系统默认指定到某一路径，运行命令时会先从这些路径中开始找。另一种方法是在系统变量中设置 NODE_PATH = 安装的根目录，NodeJS 允许通过变量 NODE_PATH 指定额外的模块搜索路径。所以配置方法如下：</div>\n\n  * 用户变量 PATH 末尾添加 `\";D:\\nodejs\\node_global\"`\n  * 系统变量新增 `NODE_PATH: \"D:\\nodejs\\node_global\\node_modules\"`\n\n\n## 安装 cnpm\n> npm 服务器在国外而安装速度慢，所以大多都使用淘宝对 npm 的镜像服务器 cnpm，它和 npm 命令相同\n\n  * 安装：`npm install cnpm -g --registry=https://registry.npm.taobao.org`  \n  * 查看：`cnpm -v`\n  * 安装依赖：`cnpm install`\n  * 安装失败的解决方案：`npm config set registry https://registry.npm.taobao.org`\n\n                  \n## 安装 nodemon         \n> 编写调试 Node 项目时，每次修改代码后都需要重新启动，比较麻烦。nodemon 工具可以监听代码文件的变化，并自动重启 Node 服务器和数据库服务器\n\n  ```js\n  // 安装\n  cnpm install -g  nodemon\n\n  // app.js\n  var http = require('http')\n  http.createServer((req, res) => {\n      res.end('hello node');\n  }).listen(3000);\n\n  // 启动\n  nodemon app\n  ```\n\n\n# 三、模块管理\n\n## 模块机制\n  * 根据模块(文件) 划分功能、组织和复用代码\n  * 通过 npm 工具和网站进行开源社区代码共享\n  * 通过包规范管理应用和可复用组件\n\n\n## 模块模型\n  * __核心模块__：NodeJS 提供，会被编译到二进制执行文件（加载速度快）\n    * __C/C++ 内建模块__：存放src目录下的最底层模块，会提供js调用的API\n    * __Js 核心模块__：存放在lib目录下，为C/C++内建模块提供封装和桥接\n  * __文件模块__：用户编写，动态加载（加载速度较慢）\n    * __C++ 扩展模块__：用于提高运行效率等自定义编写的底层模块\n    * __Js 文件模块__：由第三方或用户自行编写的模块\n\n\n## 模块缓存\n  * 模块会在第一次 require 后被缓存，`多次 require 不会导致模块的代码被执行多次`\n  * Node 模块的缓存不同于浏览器的 js 缓存，浏览器只缓存文件，`Node 模块缓存的是编译和执行之后的对象`\n  * require.cache 对象代表 Node 模块缓存区，缓存的模块以属性的方式加入该对象，可以通过 `require.cache['模块标识符'] 来访问具体的缓存模块`，也可以 delete 该缓存\n\n\n## 模块变量\n\n### 全局对象\n  * __global__：表示Node所在的全局环境，类似于浏览器中的window对象\n  * __process__：指向Node内置的process模块，允许开发者与当前进程互动\n  * __console__：指向Node内置的console模块，提供命令行环境中的标准输入、标准输出功能。\n\n\n### 全局函数  \n  * __模块加载函数__：require\n  * __定时器函数__：setTimeout、setInterval、clearTimeout、clearInterval\n\n\n### 全局变量\n  * ___filename__：指向当前运行脚本的文件名\n  * ___dirname__：指向当前运行脚本所在的目录\n\n\n### 模块变量\n  * __module__：表示当前模块的对象\n  * __module.exports__：模块的导出对象\n  * __module.filename__：模块解析后的文件名\n  * __exports__：指向 module.exports 对象的变量\n\n\n## 模块包规范\n> NodeJS 采用包来对一组具有相互依赖关系的模块进行统一管理，封装为独立的复用组件或单个应用。Node的包通常为一个目录，主要包括如下内容：\n\n  * __package.json__：包的描述文件\n  * __bin__：可执行文件、二进制文件\n  * __lib__：待加载的 js 文件\n  * __doc__：使用包的说明文档\n  * __test__：单元测试用例代码文件\n  * __node_modules__：本地安装包\n\n\n# 四、核心模块\n\n## HTTP\n> 处理客户端的网络请求\n\n### 作为客户端\n  * __client__：连接服务器\n    * 发起请求：`http.request(options, fn)`\n    * 简化版，不用 end：`http.get(options, fn)`\n  * __ClientRequest__：处理要发送的请求信息\n    * 收到请求：`req.on(\"response\", fn)`\n    * 收到错误：`req.on(\"error\", fn)`\n    * 写入数据：`req.write`\n    * 完成发送：`req.end`\n  * __ClientResponse__：获取服务端返回信息\n    * 传输数据：`res.on(\"data\", fn)`\n    * 传输结束：`res.on(\"end\", fn)`\n    * 请求关闭：`res.on(\"close\", fn)`\n    * 设置存储：`res.setEncoding`\n    * 暂停请求：`res.pause`\n    * 恢复请求：`res.resume`\n    * 状态码：`res.statusCode`\n    * 请求头：`res.headers`\n\n\n### 作为服务端\n  * __Server__：创建服务器\n    * 生成实例：`Server()`\n      * 接收请求：`on(\"request\", fn)`\n      * 关闭请求：`on(\"close\", fn)`\n      * 监听服务：`listen(port, fn)`\n      * 新建 TCP 流：`on(\"connection\", fn)`\n    * 直接创建：`createServer(fn).listen(port)`\n  * __IncomingMessage__：获取客户端请求信息\n    * 传输数据：`on(\"data\", fn)`\n    * 传输结束：`on(\"end\", fn)`\n    * 请求关闭：`on(\"close\", fn)`\n    * 请求方法：`method`\n    * 请求地址：`url`\n  * __ServerResponse__：处理返回给客户端的信息res\n    * 设置头信息：`setHead`\n    * 合并头信息：`writeHead`\n    * 写入数据：`write`\n    * 结束传输：`end`\n\n```js\nvar http = require('http')\nvar url = require('url')\n\nhttp.createServer((req,res)=>{\n    // 将传过来的URL转变为对象\n    var params = url.parse(req.url,true)\n    res.write(params.query.name)\n    res.end()\n    // res.end(params.query.name);\n}).listen(3000);\n\n// 客户端请求\nvar request = http.get({\n    host:'localhost',\n    path:'/user?name=tom&age=22',\n    port:3000},function(res){\n    res.setEncoding('utf-8')\n    res.on('data',function(data){\n        console.log('res_date：'+data)\n    })\n})\n```\n        \n\n## URL\n> 处理客户端请求过来的URL\n\n  * __parse__：将 url 字符串地址转为一个对象\n  * __format__：将 url 对象转为一个 url 字符串\n  * __resolve__：对传入的两个参数用 `/` 拼接\n\n\n  ```js\n  const url = require(\"url\")\n\n  url.parse(\"http://user:pass@host.com:8080/p/a/t/h?query=string#hash\")\n  url.parse(\"http://user:pass@host.com:8080/p/a/t/h?query=string#hash\", true)\n\n  url.format({\n      protocol: \"http:\",\n      host: \"182.163.0:60\",\n      port: \"60\"\n  })\n  url.resolve(\"http://whitemu.com\", \"gulu\")\n  ```\n\n\n## Querystring\n> 处理客户端 get/post 请求传递的参数\n\n  * __parse__：将一个字符串反序列化为一个对象\n  * __stringify__：将一个对象序列化成一个字符串\n  * __escape__：使传入的字符串进行编码\n  * __unescape__：对使用了 escape 编码的字符进行解码\n\n\n  ```js\n  var querystring = require('querystring')\n  \n  querystring.parse(\"name=tom&sex=man&sex=women\")\n  querystring.stringify({ name: 'tom', sex: ['man', 'women']})\n\n  querystring.escape(\"name=慕白\")\n  querystring.unescape('name%3D%E6%85%95%E7%99%BD')\n  ```\n\n\n## Path\n> 操作文件路径\n\n  * 获取路径信息\n    * __dirname__：路径\n    * __extname__：扩展名\n    * __basename__：文件名\n  * 路径拼接\n    * __join__：使用当前系统的路径分隔符拼接路径\n    * __resolve__：将相对路径拼接出绝对路径\n    * __relative__：解析出两个路径之间的相对路径\n  * 路径处理\n    * __parse__：路径分解而返回对象\n    * __format__：路径组合而返回字符串\n    * __normalize__：路径标准化\n    * __isAbsolute__：判断路径是否为绝对路径\n\n\n  ```js\n  var path = require('path')\n  path.dirname('/foo/bar/baz/asdf/a.txt')\n\n  path.join('/foo', 'bar', 'baz/asdf', '..')\n  path.resolve('www', 'js/upload', '../mod.js')\n  path.relative('C:/test/aaa', 'C:/bbb')\n\n  path.parse('/home/user/dir/file.txt')\n  path.format({\n      dir: '/tmp', \n      name: 'hello',\n      ext: '.js'\n  })\n  path.normalize('a/../user/bin')\n  path.isAbsolute('/foo/bar')\n  ```\n\n\n## Events\n> 事件处理模块\n\n  <div style=\"text-indent: 2em;\">回调函数模式让 NodeJS 可以处理异步操作，但对于无法处理多状态的异步操作则需要进行拆分而分阶段执行。为了解决这个问题，NodeJS 提供了 Event Emitter 接口，通过事件解决多状态异步操作的响应问题。events 模块对外暴露一个 EventEmitter 类，可以用来生成事件发生器的实例 emitter，然后通过实例方法处理事件，比如 on/once 监听事件、emit 触发事件、removeListener 删除事件等。</div>\n        \n  ```js\n  // 模块调用\n  var events = require(\"events\")\n  var emitter = new events.EventEmitter()\n\n  // 事件监听\n  emitter.on(\"connection\", function () {\n      console.log(\"linked Success\");\n  })\n\n  // 事件触发\n  emitter.emit(\"connection\")\n  ```\n\n\n\n## FS\n> 在服务端来操作文件。默认异步操作，同步 API 则只需添加 Sync，比如 readFileSync\n\n  * 操作文件\n    * __readFile__：文件读取\n    * __writeFile__：文件写入\n    * __appendFile__：追加写入\n    * __rename__：文件重命名\n    * __unlink__：文件删除\n  * 操作目录\n    * __mkdir__：创建\n    * __readdir__：读取\n    * __rmdir__：删除空目录\n    * __chmod__：修改权限\n  * 其它\n    * __stat__：详细信息\n    * __exists__：判断存在\n\n  \n  ```js\n  var fs = require(\"fs\");\n  fs.stat('input.txt', function (err, stats) {\n\n      // 大括号中只有一句语句时可以省略\n      if (err) return console.error(err) \n\n      stats.isFile()        // 是否为文件\n      stats.isDirectory()   // 是否为目录\n  })\n\n  // 异步写入\n  fs.writeFile('input.txt', '写入文件的内容',  function(err) {\n\n      if (err) return console.error(err) \n\n      // 异步读取\n      fs.readFile('input.txt', function (err, data) {\n\n          if (err) return console.error(err) \n\n          var data_str = data.toString()\n      })\n  })\n  ```\n\n\n\n## Stream\n> 本质是对 buffer 对象的高级封装，它操作的底层是 buffer 对象\n\n### 流\n  <div style=\"text-indent: 2em;\">操作系统采用数据块（chunk）的方式读取数据，每收到一次数据就存入缓存。NodeJS 应用程序有两种缓存的处理方式：第一种是先将数据全部读入内存，然后一次性从缓存中读取，这种方式对于视频等二进制大文件很容易使内存\"爆仓\"。第二种是采用 数据流（stream）的方式，边读取边存入。</div>\n\n  <div style=\"text-indent: 2em; margin-top: 15px;\">流表示一组有序的、有起止点的字节数据的序列，但是流的数据不能一次性读取或写入。NodeJs 将关于流的操作封装到了 Stream 模块并提供了 Stream API 通过事件来实现基于流的IO操作，比如处理普通文件、网络文件 (http、net)、设备文件 (stdin、stdout)。</div>\n            \n            \n### 流操作\n  * __流读取__：NodeJS 不断将文件一小块内容读入缓冲区，再从缓冲区中读取内容\n  * __流写入__：NodeJS 不断将流数据写入内在缓冲区，待缓冲区 满后再将缓冲区写入到文件中，重复操作直到完成\n  * __直接操作__：readFile/read、writeFile/write 一次性读取内容或写入内存\n\n\n### 流事件\n> 所有 Stream 对象 都是 EventEmitter 类的实例，读写流的不同状态时就会触发相应事件\n\n  * __data__：当有数据可读时触发\n  * __end__：数据已经全部读取完毕时触发\n  * __error__：读取或写入的过程中发生错误时触发\n  * __finish__：所有数据都已经被写入到底层系统时触发\n\n\n### 流类型\n  * __Readable__：从流中读取数据的 API，用于对外提供数据\n  * __Writable__：往流中写入数据的 API，用于写入数据\n  * __Duplex__：在流中可读写数据的 API，用于读取和写入数据\n  * __Transform__：在读写过程中可以修改和变换数据的 Duplex 流\n\n\n### 流模式\n> 根据流中传递数据的类型来区分，一般需要在创建流时指定其模式而且不再修改，但是可以通过拼接转换流来进行模式转换并得到一个新的流\n\n  * __Object Mode__：对象模式，即流中传递的是任意类型的 Js 对象（null 除外）\n  * __Buffering Mode__：Buffer 模式，即流中传递的是 Buffer 对象\n\n        \n### null 对象\n> 在流中的作用如下\n\n  * 向 Writable 流中写入 null，表示数据源的数据已经写入完成，继续写入数据则会报错\n  * 从 Readable 流中读取到 null，表示所有数据已经读取完毕，流中不会再有可读取的数据\n\n\n### 流的拼接\n  <div style=\"text-indent: 2em;\">就像可以把两个水管串成一个更长的水管一样，一个 Readable 流和一个 Writable 流串起来后，所有的数据自动从 Readable 流进入 Writable 流。Readable API 提供了 pipe 方法用于流的拼接，但注意位于中间的流必须是 Duplex 流。</div>\n\n\n```js\n// 读取数据流\nvar fs = require(\"fs\")\nvar data = ''\n// 创建可读流，即将文件内容读取为流数据\nvar readStream = fs.createReadStream('input.txt') \nreadStream.setEncoding('UTF8')  \n// 处理流事件 --> data, end, and error\nreadStream.on('data', function(chunk) {\n    data += chunk\n})\nreadStream.on('end',function(){\n    console.log(data)\n})\nreadStream.on('error', function(err){\n    console.log(err.stack)\n})\n\n\n// 写入流\nvar fs = require(\"fs\")\nvar data = '要写入的内容'\n// 创建可写流并写入到文件中\nvar writeStream = fs.createWriteStream('output.txt')\nwriteStream.write(data, 'UTF8')\nwriteStream.write(new Buffer('使用Stream写入二进制数据...\\n', 'utf-8'));\nwriteStream.end()   // 标记文件末尾\n\n// 处理流事件 --> data, end, and error\nwriteStream.on('finish', function() {\n    console.log(\"写入完成。\")\n})\nwriteStream.on('error', function(err){\n    console.log(err.stack)\n})\n\n\n// 管道流\nvar fs = require(\"fs\");\n// 创建一个可读流\nvar readStream = fs.createReadStream('input.txt', {\n        encoding:'utf8',  // 不传默认buffer，显示为字符串\n        start:3,          // 从索引为3的位置开始读\n});\n// 创建一个可写流\nvar writeStream = fs.createWriteStream('output.txt');\n// 管道读写操作：读取 input.txt 内容并将内容写入到 output.txt\nreadeStream.pipe(writeStream);\n\n\n// 链式流：链式是通过连接输出流到另外一个流并创建多个对个流操作链的机制\n// 链式流一般用于管道操作。以下是用管道和链式来压缩和解压文件\nvar fs = require(\"fs\")\nvar zlib = require('zlib')\nvar data = 'test dfddgfdgfdgfdgfd jkwu'\n// 压缩 input.txt 文件为 input.txt.gz\nfs.createReadStream('input.txt')\n    .pipe(zlib.createGzip())\n    .pipe(fs.createWriteStream('input.txt.gz'))\n// 解压 input.txt.gz 文件为 input.txt\nfs.createReadStream('input.txt.gz')\n    .pipe(zlib.createGunzip())\n    .pipe(fs.createWriteStream('input.txt'))\n        \n       \n// HTTP 对象使用 Stream 接口，实现网络数据的读写\nvar http = require('http')\nvar server = http.createServer(function (req, res) {\n    var body = ''\n    req.setEncoding('utf8')\n    req.on('data', function (chunk) {\n        body += chunk\n    });\n    req.on('end', function () {\n        try {\n            var data = JSON.parse(body);\n        } catch (er) {\n            res.statusCode = 400;\n            return res.end('error: ' + er.message);\n        }\n        res.write(typeof data);\n        res.end();\n    })\n})\nserver.listen(8080)\n\n\n// 错误处理\nhttp.createServer(function (req, res) {\n    var stream = fs.createReadStream('filename.txt')\n    stream\n    .on('error', onerror)\n    .pipe(zlib.createGzip())\n    .on('error', onerror)\n    .pipe(res)\n  \n    onFinished(res, function () {\n      stream.destroy()\n    })\n})\n```\n\n\n## util\n> 提供一系列实用方法，注意需要安装 npm install util\n\n  * 格式化字符串：`format`\n  * 数据类型验证：`isDate、isArray、isError、isRegExp`\n  * 其它：`inherits (继承)、inspect (对象转化为字符串)`\n  \n\n\n# 五、Web 开发\n\n## 搭建 web 服务器\n### 通过插件\n> http-server、live-server\n\n  ```js\n  npm install http-server -g\n  cd progect      // 进入项目目录\n  http-server     // 开启服务\n  ```\n\n\n### 通过 NodeJs\n  ```js\n  var http = require('http');\n  var url = require('url');\n  var path = require('path');\n  var fs = require('fs');\n\n  // 命令行第三个参数，用来接收目录，可为空，相对当前server.js的目录名称\n  // 比如 node server debug，则 debug 文件夹与 server.js 文件同级并以 debug 启动服务\n  var dir, arg = process.argv[2] || ''; \n\n  http.createServer(function (req, res) {\n      var pathname = __dirname + url.parse(req.url).pathname;\n      // 保存 dir (目录)\n      dir = dir ? dir : pathname; \n      // 替换文件静态路径\n      pathname = dir ? pathname.replace(dir, dir + arg + '/') : pathname; \n      if (path.extname(pathname) == \"\") {\n          pathname += \"/\";\n      }\n      if (pathname.charAt(pathname.length - 1) == \"/\") {\n          // 入口文件，此处默认index.html\n          pathname += \"index.html\"; \n      }\n\n      fs.exists(pathname, function (exists) {\n          if (exists) {\n              switch (path.extname(pathname)) {\n                case \".html\":\n                    res.writeHead(200, {\"Content-Type\": \"text/html\"});\n                    break;\n                case \".js\":\n                    res.writeHead(200, {\"Content-Type\": \"text/javascript\"});\n                    break;\n                case \".css\":\n                    res.writeHead(200, {\"Content-Type\": \"text/css\"});\n                    break;\n                case \".gif\":\n                    res.writeHead(200, {\"Content-Type\": \"image/gif\"});\n                    break;\n                case \".jpg\":\n                    res.writeHead(200, {\"Content-Type\": \"image/jpeg\"});\n                    break;\n                case \".png\":\n                    res.writeHead(200, {\"Content-Type\": \"image/png\"});\n                    break;\n                default:\n                    res.writeHead(200, {\"Content-Type\": \"application/octet-stream\"});\n              }\n\n              // res 可以自己添加信息来简单交互 比如可以修改 header 信息、修改返回数据\n              fs.readFile(pathname, function (err, data) {\n                  res.end(data);\n              });\n          }\n          else {\n              res.writeHead(404, {\"Content-Type\": \"text/html\"});\n              res.end(\"Not Found\");\n          }\n      });\n  }).listen(9090, \"127.0.0.1\"); // 服务器端口\n\n  console.log(\"server running at http://127.0.0.1:9090/\");\n  ```\n\n\n\n## 连接 mysql\n> 安装 mysql 及其驱动：npm install mysql node-mysql -g     \n\n### 直接连接\n  ```js\n  let http = require('http')\n  let mysql = require(\"mysql\")\n\n  const connection = mysql.createConnection({\n      host: \"127.0.0.1\",      // 主机\n      user: \"root\",           // 用户名\n      password: \"li1993416\",  // 用户密码\n      port: \"3306\",           // 端口号\n      database: \"mysql\"       // 数据库名\n  })\n\n  // 连接数据库\n  connection.connect(function(err){\n      if(err){\n          console.log(`mysql connect fail: ${err}!`);\n      }else{\n          console.log(\"mysql connect success!\");\n      }\n  });\n\n  // 执行查询\n  let str = \"\";\n  let sqlQuery = \"select * from students\";\n  connection.query(sqlQuery, function(err, result){\n      if(err){\n          console.log(`SQL error: ${err}!`);\n      }else{\n          str = JSON.stringify(result);\n      }\n  });\n\n  // 返回数据\n  http.createServer((req, res)=>{\n      res.end(str)\n  }).listen(3000);\n  console.log('Server running at localhost:3000')\n\n  //关闭connection  \n  connection.end(function(err){  \n      if(err){ \n          console.log(err.toString());\n          return;  \n      }  \n      console.log('[connection end] succeed!')\n  })\n  ```\n\n\n### 通过连接池\n> 数据库连接池负责分配、管理和释放数据库连接，它允许应用程序重复使用一个现有的数据库连接而不是再重新建立一个，用于对数据库操作的性能\n\n  ```js\n  let mysql = require('mysql');\n  const pool = mysql.createPool({\n      host: \"127.0.0.1\",      // 主机\n      user: \"root\",           // 用户名\n      password: \"li1993416\",  // 用户密码\n      port: \"3306\",           // 端口号\n      database: \"mysql\"       // 数据库名\n  })\n  pool.getConnection(function(err, connection) {\n      connection.query('select * from students', [], function(err, result) {\n          if (err) {\n              console.log(\"Error: \" + err.message);\n              return;\n          }\n          connection.release();\n          console.log(result);\n      })\n  })\n  ```\n\n\n## 上传文件\n\n  <div align=\"center\"> \n    ![Node UploadFile](images/nodejs/node-uploadFile.png)\n  </div> \n\n  ```js\n  // server.js\n  var express = require('express');\n  var app = express();\n  var fs = require(\"fs\");\n\n  var bodyParser = require('body-parser');\n  var multer  = require('multer');\n\n  app.use(express.static('public'));\n  app.use(bodyParser.urlencoded({ extended: false }));\n\n  // dest 定义上传目录，array 限制上传类型（即 input name）　\n  app.use(multer({ dest: './uploads'}).array('image'));\n\n  app.get('/', function (req, res) {\n      res.sendFile( __dirname + \"/\" + \"index.html\" );\n  })\n\n  app.post('/file_upload', function (req, res) {\n\n      console.log(req.files[0]);  // 上传的文件信息\n      var des_file = __dirname + \"/\" + req.files[0].originalname;\n\n      fs.readFile( req.files[0].path, function (err, data) {\n          fs.writeFile(des_file, data, function (err) {\n              if(err){\n                  console.log(err)\n              }else{\n                  response = {\n                      message: 'File uploaded successfully', \n                      filename: req.files[0].originalname\n                  }\n              }\n              console.log( response );\n              res.end( JSON.stringify( response ) );\n          })\n      })\n  })\n\n  var server = app.listen(3000, function () {\n        console.log(\"localhost:3000\")\n  })\n\n\n  // 运行命令\n  npm install multer body-parser -S\n  node server.js\n  ```\n\n\n## WebSocket\n\n### 通过 ws 模块\n\n  ```js\n  // 安装\n  cnpm i ws -S\n\n  // 客户端js\n  if(window.WebSocket != undefined) {  \n      //创建一个WebSocket，监听端口6060端口，这里必须是：ws，不能是http\n      var connection = new WebSocket('ws://localhost:6060'); \n\n      // readyState : 0：正在连接、1：连接成功、2：正在关闭、3：连接关闭\n      console.log(connection.readyState); \n\n      // 握手协议成功以后，readyState就从0变为1，并触发open事件  \n      connection.onopen = (event) => {   \n          console.log(event);\n          //连接建立后，客户端通过send方法向服务器端发送数据。   \n          connection.send('client message'); \n      };  \n\n      //监听  \n      connection.onmessage = (event) => {   \n          console.log(event);  \n      };  \n\n      //关闭WebSocket连接，会触发close事件。  \n      connection.onclose = () => {   \n          console.log(\"Closed\");  \n      };  \n\n      //出现错误  \n      connection.onerror = (event) => {   \n          console.log(\"Error: \" + event.data);  \n      }\n  }\n\n  // 服务器 server.js\n\n  // 启动 WebSocket 服务器\n  var server = require('http').createServer() , \n      WebSocketServer = require('ws').Server , \n      wss = new WebSocketServer({ server: server }) , \n      app = require('express')() , \n      port = 6060;\n\n  // 使用 express 中间件\n  app.use(function (req, res) { \n      //send用来向客户端发送信息，on用来接收/监听客户端发来的信息\n      res.send({ msg: \"hello\" });\n  });\n  // 监听事件  %s 字符串、%d 整数、%f 浮点数\n  wss.on('connection', function connection(ws) { \n      //监听 \n      ws.on('message', function incoming(message) {  \n          console.log('received: %s', message);\n      });\n      //发送 \n      ws.send('something')\n  })\n\n  server.on('request', app);\n  server.listen(port, function () { \n      console.log('http://localhost:' + server.address().port) \n  })\n  ```\n\n\n### 通过 socket.io\n\n  ```js\n  // 安装\n  cnpm i socket.io -S\n\n  // 客户端 js (需要引入 socket.io.js)\n  var socket = io.connect('http://localhost:8080')  \n  socket.on('news', function (data) {   \n      socket.emit('event', { my: 'data' })\n  })\n\n\n  // 服务器 server.js\n  var app = require('http').createServer(handler), \n      io = require('socket.io').listen(app), \n      fs = require('fs')\n\n  app.listen(8080);\n  io.set('log level', 1)  // 关闭 debug 信息\n\n  function handler (req, res) {\n    fs.readFile(__dirname + '/index.html',function (err, data) {  \n        if (err) {\n          res.writeHead(500);\n          return res.end('Error loading index.html');\n        }    \n        res.writeHead(200, {'Content-Type': 'text/html'});    \n        res.end(data);\n    })\n  }\n\n  io.sockets.on('connection', function (socket) {\n      socket.emit('news', { hello: 'world' });\n      socket.on('my other event', function (data) {\n        console.log(data);\n      })\n  })\n  ```\n\n\n## 解决跨域\n  ```js\n  cnpm install cors --save\n\n  // app.js 加入代码\n  var cors = require('cors');\n  app.use(cors({\n      origin:['http://localhost:8080'],  //指定接收的地址\n      methods:['GET','POST'],            // 指定接收的请求类型\n      alloweHeaders:['Content-Type', 'Authorization']  // 指定 header\n  }))\n  ```\n\n","slug":"19-Node基础","published":1,"updated":"2019-05-10T17:24:32.302Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvid4pms00220nbxfllmen1l","content":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><html><head></head><body><h1 id=\"一、NodeJS\"><a href=\"#一、NodeJS\" class=\"headerlink\" title=\"一、NodeJS\"></a>一、NodeJS</h1><blockquote><p>用于创建高性能的 Web 服务器</p></blockquote><div style=\"text-indent:2em\">脚本语言都需要一个解析器才能运行，浏览器是html中Js代码的解析器。NodeJS 则是 一个独立运行的 js 代码解析器，它封装了 V8 引擎并引入了 commonjs 规范，分别解决了js比较慢和乱的问题，填补了 js 在服务器端的空白。</div><br><div style=\"text-indent:2em\">每一种解析器都是一个运行环境，不但允许 JS 定义各种数据结构并进行各种计算，还允许JS使用运行环境提供的内置对象和方法做一些事情。例如运行在浏览器中的 JS 用于操作 DOM，浏览器就提供了 document 等内置对象。而运行在 NodeJS 中的 JS 用于操作磁盘文件或搭建 HTTP 服务器，NodeJS 就相应提供了 fs、http 等内置对象。</div><h2 id=\"特点\"><a href=\"#特点\" class=\"headerlink\" title=\"特点\"></a>特点</h2><ul><li>轻量高效</li><li>事件驱动模型</li><li>异步非阻塞 I/O 模型</li><li>单进程单线程应用程序</li></ul><h2 id=\"不足\"><a href=\"#不足\" class=\"headerlink\" title=\"不足\"></a>不足</h2><ul><li>不适合处理复杂逻辑</li><li>不适合计算密集型应用</li><li>不适合单用户多任务的程序</li><li>代码某个环节报错则整个系统崩溃</li><li>只支持单核 CPU 而不能充分利用多核 CPU 服务器</li></ul><h2 id=\"运行机制\"><a href=\"#运行机制\" class=\"headerlink\" title=\"运行机制\"></a>运行机制</h2><h3 id=\"重点注意\"><a href=\"#重点注意\" class=\"headerlink\" title=\"重点注意\"></a>重点注意</h3><ul><li>同步异步：操作任务是否按顺序依次执行</li><li>阻塞非阻塞：IO 操作是否影响主进城执行其它代码</li><li>NodeJs 内部通过线程池来完成异步操作，libuv 针对不同平台的差异性实现了统一调用，所以 NodeJS 程序的单线程仅仅指 Js 运行在单线程，程序本身并非单线程</li><li>libuv 默认创建一个由四个线程组成的线程池来加载异步操作，但如今的操作系统已经对很多 I/O 任务提供了异步接口，所以只有不存在其他方式时，异步 I/O 才会使用线程池</li></ul><h3 id=\"异步非阻塞\"><a href=\"#异步非阻塞\" class=\"headerlink\" title=\"异步非阻塞\"></a>异步非阻塞</h3><blockquote><p>IO 操作的核心是通过事件机制实现异步执行</p></blockquote><div style=\"text-indent:2em\">采用了单线程模型，它使用一个主线程处理所有的请求，当接收到操作请求后就作为一个事件放入任务队列中，然后继续接收其他请求，如果有 I/O 操作（比较耗时）就交给 libuv 的工作线程去执行，所以主线程速度快而且不会阻塞，这就是 <code>单线程、异步 I/O</code>。将所有操作都注册为一个事件并等待触发的方式就是 <code>事件驱动</code>。</div><div style=\"text-indent:2em;margin-top:15px\">如果 I/O 操作由于复杂的逻辑处理而发生了阻塞，但返回的结果是暂时在事件队列中等待，由事件循环自动依次取回到主程序中恢复执行，而事件队列在主程序之外存储事件，所以不会干扰主程序执行。这就是 <code>非阻塞 I/O</code>。</div><h3 id=\"事件循环\"><a href=\"#事件循环\" class=\"headerlink\" title=\"事件循环\"></a>事件循环</h3><div style=\"text-indent:2em;margin-top:15px\">当主线程没有请求接入时，就开始通过事件循环机制查看任务队列来检查队列中是否有要处理的事件，如果是 I/O 任务就交给 libuv 的工作线程去执行并指定回调函数，否则就直接处理并返回结果给上层。当工作线程中的 I/O 任务完成后执行指定的回调函数，把这个完成的事件放到事件队列中等待事件循环时处理。这就是 <code>事件循环</code>。</div><ol><li>V8 引擎解析 JavaScript 脚本</li><li>解析后的代码，调用 Node API</li><li>libuv 库负责 Node API 的执行。它将不同的任务分配给不同的线程，形成一个 Event Loop (事件循环），以异步的方式将任务的执行结果返回给 V8 引擎</li><li>V8 引擎再将结果返回给用户<ul><li>除了 setTimeout、setInterval，NodeJs还提供了：process.nextTick、setImmediate</li><li>process.nextTick 可以在当前“执行栈”尾部、下一次 EventLoop（主线程读取“任务队列”）之前，触发回调函数。即它指定的任务总是发生在所有异步任务之前</li><li>setImmediate 则是在当前”任务队列”的尾部添加事件，它指定的任务总是在下一次 Event Loop 时执行</li></ul></li></ol><h2 id=\"功能架构\"><a href=\"#功能架构\" class=\"headerlink\" title=\"功能架构\"></a>功能架构</h2><div align=\"center\"><br><img src=\"images/nodejs/node-framework.png\" alt=\"Node Framework\"><br></div><ul><li><strong>顶部</strong>：Js 编写的应用程序和模块</li><li><strong>中间</strong>：通过代码包装和暴露接口而实现 js 可以调用 c++ 代码<ul><li><strong>Bindings</strong>：绑定核心库的依赖</li><li><strong>Addons</strong>：绑定第三方或者自定义 C/C++</li></ul></li><li><strong>底部</strong>：C/C++ 编写的内部组件，提供了系统底层操作方法<ul><li><strong>V8</strong>：Google 开源 js 引擎，用于将 Js 代码编译为机器码执行以便快速编译</li><li><strong>libuv</strong>：跨平台的底层封装，实现事件循环、文件操作等异步功能。</li></ul></li></ul><h2 id=\"适用场景\"><a href=\"#适用场景\" class=\"headerlink\" title=\"适用场景\"></a>适用场景</h2><div style=\"text-indent:2em\">NodeJS 处理并发的能力较强，但处理计算和逻辑的能力很弱，因此适用于 高并发、I/O 密集、少量业务逻辑 的场景，比如 RESTFUL API、实时聊天、客户端逻辑强大的单页 APP。一般由前端处理复杂逻辑，NodeJS 只提供异步 I/O，这样可以实现对高并发的高性能处理。</div><h1 id=\"二、安装配置\"><a href=\"#二、安装配置\" class=\"headerlink\" title=\"二、安装配置\"></a>二、安装配置</h1><blockquote><p>window 系统</p></blockquote><h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><blockquote><p>本质是把 NodeJS 执行程序复制到一个目录，然后保证这个目录在系统 PATH 环境变量下，以便终端下可以使用 node 命令</p></blockquote><ul><li>版本：Windows Installer(.msi) 64位</li><li>地址：建议不要安装在 C 盘而修改默认地址为 “D:\\nodejs\\”</li><li>命令<ul><li>查看版本：<code>node -v</code></li><li>交互模式：<code>node</code></li><li>执行文件：<code>node hello.js</code></li></ul></li></ul><h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><h3 id=\"包文件\"><a href=\"#包文件\" class=\"headerlink\" title=\"包文件\"></a>包文件</h3><blockquote><p>统一管理通过 npm 全局安装的第三方包及其缓存</p></blockquote><ol><li>新建文件夹：<code>node_global、node_cache</code></li><li>执行命令<ul><li><code>npm config set cache \"D:\\nodejs\\node_cache\"</code></li><li><code>npm config set prefix \"D:\\nodejs\\node_global\"</code></li></ul></li><li>修改文件：node_modules\\npm\\npmrc<ul><li><code>prefix = D:\\nodejs\\node_global</code></li><li><code>cache = D:\\nodejs\\node_global</code></li></ul></li></ol><h3 id=\"环境变量\"><a href=\"#环境变量\" class=\"headerlink\" title=\"环境变量\"></a>环境变量</h3><blockquote><p>全局使用 npm、cnpm 等命令</p></blockquote><div style=\"text-indent:2em\">path 指系统默认指定到某一路径，运行命令时会先从这些路径中开始找。另一种方法是在系统变量中设置 NODE_PATH = 安装的根目录，NodeJS 允许通过变量 NODE_PATH 指定额外的模块搜索路径。所以配置方法如下：</div><ul><li>用户变量 PATH 末尾添加 <code>\";D:\\nodejs\\node_global\"</code></li><li>系统变量新增 <code>NODE_PATH: \"D:\\nodejs\\node_global\\node_modules\"</code></li></ul><h2 id=\"安装-cnpm\"><a href=\"#安装-cnpm\" class=\"headerlink\" title=\"安装 cnpm\"></a>安装 cnpm</h2><blockquote><p>npm 服务器在国外而安装速度慢，所以大多都使用淘宝对 npm 的镜像服务器 cnpm，它和 npm 命令相同</p></blockquote><ul><li>安装：<code>npm install cnpm -g --registry=https://registry.npm.taobao.org</code></li><li>查看：<code>cnpm -v</code></li><li>安装依赖：<code>cnpm install</code></li><li>安装失败的解决方案：<code>npm config set registry https://registry.npm.taobao.org</code></li></ul><h2 id=\"安装-nodemon\"><a href=\"#安装-nodemon\" class=\"headerlink\" title=\"安装 nodemon\"></a>安装 nodemon</h2><blockquote><p>编写调试 Node 项目时，每次修改代码后都需要重新启动，比较麻烦。nodemon 工具可以监听代码文件的变化，并自动重启 Node 服务器和数据库服务器</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 安装</span></span><br><span class=\"line\">cnpm install -g  nodemon</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// app.js</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">'http'</span>)</span><br><span class=\"line\">http.createServer(<span class=\"function\">(<span class=\"params\">req, res</span>) =></span> {</span><br><span class=\"line\">    res.end(<span class=\"string\">'hello node'</span>);</span><br><span class=\"line\">}).listen(<span class=\"number\">3000</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 启动</span></span><br><span class=\"line\">nodemon app</span><br></pre></td></tr></tbody></table></figure><h1 id=\"三、模块管理\"><a href=\"#三、模块管理\" class=\"headerlink\" title=\"三、模块管理\"></a>三、模块管理</h1><h2 id=\"模块机制\"><a href=\"#模块机制\" class=\"headerlink\" title=\"模块机制\"></a>模块机制</h2><ul><li>根据模块(文件) 划分功能、组织和复用代码</li><li>通过 npm 工具和网站进行开源社区代码共享</li><li>通过包规范管理应用和可复用组件</li></ul><h2 id=\"模块模型\"><a href=\"#模块模型\" class=\"headerlink\" title=\"模块模型\"></a>模块模型</h2><ul><li><strong>核心模块</strong>：NodeJS 提供，会被编译到二进制执行文件（加载速度快）<ul><li><strong>C/C++ 内建模块</strong>：存放src目录下的最底层模块，会提供js调用的API</li><li><strong>Js 核心模块</strong>：存放在lib目录下，为C/C++内建模块提供封装和桥接</li></ul></li><li><strong>文件模块</strong>：用户编写，动态加载（加载速度较慢）<ul><li><strong>C++ 扩展模块</strong>：用于提高运行效率等自定义编写的底层模块</li><li><strong>Js 文件模块</strong>：由第三方或用户自行编写的模块</li></ul></li></ul><h2 id=\"模块缓存\"><a href=\"#模块缓存\" class=\"headerlink\" title=\"模块缓存\"></a>模块缓存</h2><ul><li>模块会在第一次 require 后被缓存，<code>多次 require 不会导致模块的代码被执行多次</code></li><li>Node 模块的缓存不同于浏览器的 js 缓存，浏览器只缓存文件，<code>Node 模块缓存的是编译和执行之后的对象</code></li><li>require.cache 对象代表 Node 模块缓存区，缓存的模块以属性的方式加入该对象，可以通过 <code>require.cache['模块标识符'] 来访问具体的缓存模块</code>，也可以 delete 该缓存</li></ul><h2 id=\"模块变量\"><a href=\"#模块变量\" class=\"headerlink\" title=\"模块变量\"></a>模块变量</h2><h3 id=\"全局对象\"><a href=\"#全局对象\" class=\"headerlink\" title=\"全局对象\"></a>全局对象</h3><ul><li><strong>global</strong>：表示Node所在的全局环境，类似于浏览器中的window对象</li><li><strong>process</strong>：指向Node内置的process模块，允许开发者与当前进程互动</li><li><strong>console</strong>：指向Node内置的console模块，提供命令行环境中的标准输入、标准输出功能。</li></ul><h3 id=\"全局函数\"><a href=\"#全局函数\" class=\"headerlink\" title=\"全局函数\"></a>全局函数</h3><ul><li><strong>模块加载函数</strong>：require</li><li><strong>定时器函数</strong>：setTimeout、setInterval、clearTimeout、clearInterval</li></ul><h3 id=\"全局变量\"><a href=\"#全局变量\" class=\"headerlink\" title=\"全局变量\"></a>全局变量</h3><ul><li><strong>_filename</strong>：指向当前运行脚本的文件名</li><li><strong>_dirname</strong>：指向当前运行脚本所在的目录</li></ul><h3 id=\"模块变量-1\"><a href=\"#模块变量-1\" class=\"headerlink\" title=\"模块变量\"></a>模块变量</h3><ul><li><strong>module</strong>：表示当前模块的对象</li><li><strong>module.exports</strong>：模块的导出对象</li><li><strong>module.filename</strong>：模块解析后的文件名</li><li><strong>exports</strong>：指向 module.exports 对象的变量</li></ul><h2 id=\"模块包规范\"><a href=\"#模块包规范\" class=\"headerlink\" title=\"模块包规范\"></a>模块包规范</h2><blockquote><p>NodeJS 采用包来对一组具有相互依赖关系的模块进行统一管理，封装为独立的复用组件或单个应用。Node的包通常为一个目录，主要包括如下内容：</p></blockquote><ul><li><strong>package.json</strong>：包的描述文件</li><li><strong>bin</strong>：可执行文件、二进制文件</li><li><strong>lib</strong>：待加载的 js 文件</li><li><strong>doc</strong>：使用包的说明文档</li><li><strong>test</strong>：单元测试用例代码文件</li><li><strong>node_modules</strong>：本地安装包</li></ul><h1 id=\"四、核心模块\"><a href=\"#四、核心模块\" class=\"headerlink\" title=\"四、核心模块\"></a>四、核心模块</h1><h2 id=\"HTTP\"><a href=\"#HTTP\" class=\"headerlink\" title=\"HTTP\"></a>HTTP</h2><blockquote><p>处理客户端的网络请求</p></blockquote><h3 id=\"作为客户端\"><a href=\"#作为客户端\" class=\"headerlink\" title=\"作为客户端\"></a>作为客户端</h3><ul><li><strong>client</strong>：连接服务器<ul><li>发起请求：<code>http.request(options, fn)</code></li><li>简化版，不用 end：<code>http.get(options, fn)</code></li></ul></li><li><strong>ClientRequest</strong>：处理要发送的请求信息<ul><li>收到请求：<code>req.on(\"response\", fn)</code></li><li>收到错误：<code>req.on(\"error\", fn)</code></li><li>写入数据：<code>req.write</code></li><li>完成发送：<code>req.end</code></li></ul></li><li><strong>ClientResponse</strong>：获取服务端返回信息<ul><li>传输数据：<code>res.on(\"data\", fn)</code></li><li>传输结束：<code>res.on(\"end\", fn)</code></li><li>请求关闭：<code>res.on(\"close\", fn)</code></li><li>设置存储：<code>res.setEncoding</code></li><li>暂停请求：<code>res.pause</code></li><li>恢复请求：<code>res.resume</code></li><li>状态码：<code>res.statusCode</code></li><li>请求头：<code>res.headers</code></li></ul></li></ul><h3 id=\"作为服务端\"><a href=\"#作为服务端\" class=\"headerlink\" title=\"作为服务端\"></a>作为服务端</h3><ul><li><strong>Server</strong>：创建服务器<ul><li>生成实例：<code>Server()</code><ul><li>接收请求：<code>on(\"request\", fn)</code></li><li>关闭请求：<code>on(\"close\", fn)</code></li><li>监听服务：<code>listen(port, fn)</code></li><li>新建 TCP 流：<code>on(\"connection\", fn)</code></li></ul></li><li>直接创建：<code>createServer(fn).listen(port)</code></li></ul></li><li><strong>IncomingMessage</strong>：获取客户端请求信息<ul><li>传输数据：<code>on(\"data\", fn)</code></li><li>传输结束：<code>on(\"end\", fn)</code></li><li>请求关闭：<code>on(\"close\", fn)</code></li><li>请求方法：<code>method</code></li><li>请求地址：<code>url</code></li></ul></li><li><strong>ServerResponse</strong>：处理返回给客户端的信息res<ul><li>设置头信息：<code>setHead</code></li><li>合并头信息：<code>writeHead</code></li><li>写入数据：<code>write</code></li><li>结束传输：<code>end</code></li></ul></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">'http'</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> url = <span class=\"built_in\">require</span>(<span class=\"string\">'url'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">http.createServer(<span class=\"function\">(<span class=\"params\">req,res</span>)=></span>{</span><br><span class=\"line\">    <span class=\"comment\">// 将传过来的URL转变为对象</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> params = url.parse(req.url,<span class=\"literal\">true</span>)</span><br><span class=\"line\">    res.write(params.query.name)</span><br><span class=\"line\">    res.end()</span><br><span class=\"line\">    <span class=\"comment\">// res.end(params.query.name);</span></span><br><span class=\"line\">}).listen(<span class=\"number\">3000</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 客户端请求</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> request = http.get({</span><br><span class=\"line\">    host:<span class=\"string\">'localhost'</span>,</span><br><span class=\"line\">    path:<span class=\"string\">'/user?name=tom&age=22'</span>,</span><br><span class=\"line\">    port:<span class=\"number\">3000</span>},<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>)</span>{</span><br><span class=\"line\">    res.setEncoding(<span class=\"string\">'utf-8'</span>)</span><br><span class=\"line\">    res.on(<span class=\"string\">'data'</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>)</span>{</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'res_date：'</span>+data)</span><br><span class=\"line\">    })</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h2 id=\"URL\"><a href=\"#URL\" class=\"headerlink\" title=\"URL\"></a>URL</h2><blockquote><p>处理客户端请求过来的URL</p></blockquote><ul><li><strong>parse</strong>：将 url 字符串地址转为一个对象</li><li><strong>format</strong>：将 url 对象转为一个 url 字符串</li><li><strong>resolve</strong>：对传入的两个参数用 <code>/</code> 拼接</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> url = <span class=\"built_in\">require</span>(<span class=\"string\">\"url\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">url.parse(<span class=\"string\">\"http://user:pass@host.com:8080/p/a/t/h?query=string#hash\"</span>)</span><br><span class=\"line\">url.parse(<span class=\"string\">\"http://user:pass@host.com:8080/p/a/t/h?query=string#hash\"</span>, <span class=\"literal\">true</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">url.format({</span><br><span class=\"line\">    protocol: <span class=\"string\">\"http:\"</span>,</span><br><span class=\"line\">    host: <span class=\"string\">\"182.163.0:60\"</span>,</span><br><span class=\"line\">    port: <span class=\"string\">\"60\"</span></span><br><span class=\"line\">})</span><br><span class=\"line\">url.resolve(<span class=\"string\">\"http://whitemu.com\"</span>, <span class=\"string\">\"gulu\"</span>)</span><br></pre></td></tr></tbody></table></figure><h2 id=\"Querystring\"><a href=\"#Querystring\" class=\"headerlink\" title=\"Querystring\"></a>Querystring</h2><blockquote><p>处理客户端 get/post 请求传递的参数</p></blockquote><ul><li><strong>parse</strong>：将一个字符串反序列化为一个对象</li><li><strong>stringify</strong>：将一个对象序列化成一个字符串</li><li><strong>escape</strong>：使传入的字符串进行编码</li><li><strong>unescape</strong>：对使用了 escape 编码的字符进行解码</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> querystring = <span class=\"built_in\">require</span>(<span class=\"string\">'querystring'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">querystring.parse(<span class=\"string\">\"name=tom&sex=man&sex=women\"</span>)</span><br><span class=\"line\">querystring.stringify({ <span class=\"attr\">name</span>: <span class=\"string\">'tom'</span>, <span class=\"attr\">sex</span>: [<span class=\"string\">'man'</span>, <span class=\"string\">'women'</span>]})</span><br><span class=\"line\"></span><br><span class=\"line\">querystring.escape(<span class=\"string\">\"name=慕白\"</span>)</span><br><span class=\"line\">querystring.unescape(<span class=\"string\">'name%3D%E6%85%95%E7%99%BD'</span>)</span><br></pre></td></tr></tbody></table></figure><h2 id=\"Path\"><a href=\"#Path\" class=\"headerlink\" title=\"Path\"></a>Path</h2><blockquote><p>操作文件路径</p></blockquote><ul><li>获取路径信息<ul><li><strong>dirname</strong>：路径</li><li><strong>extname</strong>：扩展名</li><li><strong>basename</strong>：文件名</li></ul></li><li>路径拼接<ul><li><strong>join</strong>：使用当前系统的路径分隔符拼接路径</li><li><strong>resolve</strong>：将相对路径拼接出绝对路径</li><li><strong>relative</strong>：解析出两个路径之间的相对路径</li></ul></li><li>路径处理<ul><li><strong>parse</strong>：路径分解而返回对象</li><li><strong>format</strong>：路径组合而返回字符串</li><li><strong>normalize</strong>：路径标准化</li><li><strong>isAbsolute</strong>：判断路径是否为绝对路径</li></ul></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>)</span><br><span class=\"line\">path.dirname(<span class=\"string\">'/foo/bar/baz/asdf/a.txt'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">path.join(<span class=\"string\">'/foo'</span>, <span class=\"string\">'bar'</span>, <span class=\"string\">'baz/asdf'</span>, <span class=\"string\">'..'</span>)</span><br><span class=\"line\">path.resolve(<span class=\"string\">'www'</span>, <span class=\"string\">'js/upload'</span>, <span class=\"string\">'../mod.js'</span>)</span><br><span class=\"line\">path.relative(<span class=\"string\">'C:/test/aaa'</span>, <span class=\"string\">'C:/bbb'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">path.parse(<span class=\"string\">'/home/user/dir/file.txt'</span>)</span><br><span class=\"line\">path.format({</span><br><span class=\"line\">    dir: <span class=\"string\">'/tmp'</span>, </span><br><span class=\"line\">    name: <span class=\"string\">'hello'</span>,</span><br><span class=\"line\">    ext: <span class=\"string\">'.js'</span></span><br><span class=\"line\">})</span><br><span class=\"line\">path.normalize(<span class=\"string\">'a/../user/bin'</span>)</span><br><span class=\"line\">path.isAbsolute(<span class=\"string\">'/foo/bar'</span>)</span><br></pre></td></tr></tbody></table></figure><h2 id=\"Events\"><a href=\"#Events\" class=\"headerlink\" title=\"Events\"></a>Events</h2><blockquote><p>事件处理模块</p></blockquote><div style=\"text-indent:2em\">回调函数模式让 NodeJS 可以处理异步操作，但对于无法处理多状态的异步操作则需要进行拆分而分阶段执行。为了解决这个问题，NodeJS 提供了 Event Emitter 接口，通过事件解决多状态异步操作的响应问题。events 模块对外暴露一个 EventEmitter 类，可以用来生成事件发生器的实例 emitter，然后通过实例方法处理事件，比如 on/once 监听事件、emit 触发事件、removeListener 删除事件等。</div><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 模块调用</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> events = <span class=\"built_in\">require</span>(<span class=\"string\">\"events\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> emitter = <span class=\"keyword\">new</span> events.EventEmitter()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 事件监听</span></span><br><span class=\"line\">emitter.on(<span class=\"string\">\"connection\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"linked Success\"</span>);</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 事件触发</span></span><br><span class=\"line\">emitter.emit(<span class=\"string\">\"connection\"</span>)</span><br></pre></td></tr></tbody></table></figure><h2 id=\"FS\"><a href=\"#FS\" class=\"headerlink\" title=\"FS\"></a>FS</h2><blockquote><p>在服务端来操作文件。默认异步操作，同步 API 则只需添加 Sync，比如 readFileSync</p></blockquote><ul><li>操作文件<ul><li><strong>readFile</strong>：文件读取</li><li><strong>writeFile</strong>：文件写入</li><li><strong>appendFile</strong>：追加写入</li><li><strong>rename</strong>：文件重命名</li><li><strong>unlink</strong>：文件删除</li></ul></li><li>操作目录<ul><li><strong>mkdir</strong>：创建</li><li><strong>readdir</strong>：读取</li><li><strong>rmdir</strong>：删除空目录</li><li><strong>chmod</strong>：修改权限</li></ul></li><li>其它<ul><li><strong>stat</strong>：详细信息</li><li><strong>exists</strong>：判断存在</li></ul></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">\"fs\"</span>);</span><br><span class=\"line\">fs.stat(<span class=\"string\">'input.txt'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err, stats</span>) </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 大括号中只有一句语句时可以省略</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (err) <span class=\"keyword\">return</span> <span class=\"built_in\">console</span>.error(err) </span><br><span class=\"line\"></span><br><span class=\"line\">    stats.isFile()        <span class=\"comment\">// 是否为文件</span></span><br><span class=\"line\">    stats.isDirectory()   <span class=\"comment\">// 是否为目录</span></span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 异步写入</span></span><br><span class=\"line\">fs.writeFile(<span class=\"string\">'input.txt'</span>, <span class=\"string\">'写入文件的内容'</span>,  <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (err) <span class=\"keyword\">return</span> <span class=\"built_in\">console</span>.error(err) </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 异步读取</span></span><br><span class=\"line\">    fs.readFile(<span class=\"string\">'input.txt'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err, data</span>) </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (err) <span class=\"keyword\">return</span> <span class=\"built_in\">console</span>.error(err) </span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">var</span> data_str = data.toString()</span><br><span class=\"line\">    })</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h2 id=\"Stream\"><a href=\"#Stream\" class=\"headerlink\" title=\"Stream\"></a>Stream</h2><blockquote><p>本质是对 buffer 对象的高级封装，它操作的底层是 buffer 对象</p></blockquote><h3 id=\"流\"><a href=\"#流\" class=\"headerlink\" title=\"流\"></a>流</h3><div style=\"text-indent:2em\">操作系统采用数据块（chunk）的方式读取数据，每收到一次数据就存入缓存。NodeJS 应用程序有两种缓存的处理方式：第一种是先将数据全部读入内存，然后一次性从缓存中读取，这种方式对于视频等二进制大文件很容易使内存”爆仓”。第二种是采用 数据流（stream）的方式，边读取边存入。</div><div style=\"text-indent:2em;margin-top:15px\">流表示一组有序的、有起止点的字节数据的序列，但是流的数据不能一次性读取或写入。NodeJs 将关于流的操作封装到了 Stream 模块并提供了 Stream API 通过事件来实现基于流的IO操作，比如处理普通文件、网络文件 (http、net)、设备文件 (stdin、stdout)。</div><h3 id=\"流操作\"><a href=\"#流操作\" class=\"headerlink\" title=\"流操作\"></a>流操作</h3><ul><li><strong>流读取</strong>：NodeJS 不断将文件一小块内容读入缓冲区，再从缓冲区中读取内容</li><li><strong>流写入</strong>：NodeJS 不断将流数据写入内在缓冲区，待缓冲区 满后再将缓冲区写入到文件中，重复操作直到完成</li><li><strong>直接操作</strong>：readFile/read、writeFile/write 一次性读取内容或写入内存</li></ul><h3 id=\"流事件\"><a href=\"#流事件\" class=\"headerlink\" title=\"流事件\"></a>流事件</h3><blockquote><p>所有 Stream 对象 都是 EventEmitter 类的实例，读写流的不同状态时就会触发相应事件</p></blockquote><ul><li><strong>data</strong>：当有数据可读时触发</li><li><strong>end</strong>：数据已经全部读取完毕时触发</li><li><strong>error</strong>：读取或写入的过程中发生错误时触发</li><li><strong>finish</strong>：所有数据都已经被写入到底层系统时触发</li></ul><h3 id=\"流类型\"><a href=\"#流类型\" class=\"headerlink\" title=\"流类型\"></a>流类型</h3><ul><li><strong>Readable</strong>：从流中读取数据的 API，用于对外提供数据</li><li><strong>Writable</strong>：往流中写入数据的 API，用于写入数据</li><li><strong>Duplex</strong>：在流中可读写数据的 API，用于读取和写入数据</li><li><strong>Transform</strong>：在读写过程中可以修改和变换数据的 Duplex 流</li></ul><h3 id=\"流模式\"><a href=\"#流模式\" class=\"headerlink\" title=\"流模式\"></a>流模式</h3><blockquote><p>根据流中传递数据的类型来区分，一般需要在创建流时指定其模式而且不再修改，但是可以通过拼接转换流来进行模式转换并得到一个新的流</p></blockquote><ul><li><strong>Object Mode</strong>：对象模式，即流中传递的是任意类型的 Js 对象（null 除外）</li><li><strong>Buffering Mode</strong>：Buffer 模式，即流中传递的是 Buffer 对象</li></ul><h3 id=\"null-对象\"><a href=\"#null-对象\" class=\"headerlink\" title=\"null 对象\"></a>null 对象</h3><blockquote><p>在流中的作用如下</p></blockquote><ul><li>向 Writable 流中写入 null，表示数据源的数据已经写入完成，继续写入数据则会报错</li><li>从 Readable 流中读取到 null，表示所有数据已经读取完毕，流中不会再有可读取的数据</li></ul><h3 id=\"流的拼接\"><a href=\"#流的拼接\" class=\"headerlink\" title=\"流的拼接\"></a>流的拼接</h3><div style=\"text-indent:2em\">就像可以把两个水管串成一个更长的水管一样，一个 Readable 流和一个 Writable 流串起来后，所有的数据自动从 Readable 流进入 Writable 流。Readable API 提供了 pipe 方法用于流的拼接，但注意位于中间的流必须是 Duplex 流。</div><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 读取数据流</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">\"fs\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> data = <span class=\"string\">''</span></span><br><span class=\"line\"><span class=\"comment\">// 创建可读流，即将文件内容读取为流数据</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> readStream = fs.createReadStream(<span class=\"string\">'input.txt'</span>) </span><br><span class=\"line\">readStream.setEncoding(<span class=\"string\">'UTF8'</span>)  </span><br><span class=\"line\"><span class=\"comment\">// 处理流事件 --> data, end, and error</span></span><br><span class=\"line\">readStream.on(<span class=\"string\">'data'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">chunk</span>) </span>{</span><br><span class=\"line\">    data += chunk</span><br><span class=\"line\">})</span><br><span class=\"line\">readStream.on(<span class=\"string\">'end'</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(data)</span><br><span class=\"line\">})</span><br><span class=\"line\">readStream.on(<span class=\"string\">'error'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>)</span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(err.stack)</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 写入流</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">\"fs\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> data = <span class=\"string\">'要写入的内容'</span></span><br><span class=\"line\"><span class=\"comment\">// 创建可写流并写入到文件中</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> writeStream = fs.createWriteStream(<span class=\"string\">'output.txt'</span>)</span><br><span class=\"line\">writeStream.write(data, <span class=\"string\">'UTF8'</span>)</span><br><span class=\"line\">writeStream.write(<span class=\"keyword\">new</span> Buffer(<span class=\"string\">'使用Stream写入二进制数据...\\n'</span>, <span class=\"string\">'utf-8'</span>));</span><br><span class=\"line\">writeStream.end()   <span class=\"comment\">// 标记文件末尾</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 处理流事件 --> data, end, and error</span></span><br><span class=\"line\">writeStream.on(<span class=\"string\">'finish'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"写入完成。\"</span>)</span><br><span class=\"line\">})</span><br><span class=\"line\">writeStream.on(<span class=\"string\">'error'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>)</span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(err.stack)</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 管道流</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">\"fs\"</span>);</span><br><span class=\"line\"><span class=\"comment\">// 创建一个可读流</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> readStream = fs.createReadStream(<span class=\"string\">'input.txt'</span>, {</span><br><span class=\"line\">        encoding:<span class=\"string\">'utf8'</span>,  <span class=\"comment\">// 不传默认buffer，显示为字符串</span></span><br><span class=\"line\">        start:<span class=\"number\">3</span>,          <span class=\"comment\">// 从索引为3的位置开始读</span></span><br><span class=\"line\">});</span><br><span class=\"line\"><span class=\"comment\">// 创建一个可写流</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> writeStream = fs.createWriteStream(<span class=\"string\">'output.txt'</span>);</span><br><span class=\"line\"><span class=\"comment\">// 管道读写操作：读取 input.txt 内容并将内容写入到 output.txt</span></span><br><span class=\"line\">readeStream.pipe(writeStream);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 链式流：链式是通过连接输出流到另外一个流并创建多个对个流操作链的机制</span></span><br><span class=\"line\"><span class=\"comment\">// 链式流一般用于管道操作。以下是用管道和链式来压缩和解压文件</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">\"fs\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> zlib = <span class=\"built_in\">require</span>(<span class=\"string\">'zlib'</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> data = <span class=\"string\">'test dfddgfdgfdgfdgfd jkwu'</span></span><br><span class=\"line\"><span class=\"comment\">// 压缩 input.txt 文件为 input.txt.gz</span></span><br><span class=\"line\">fs.createReadStream(<span class=\"string\">'input.txt'</span>)</span><br><span class=\"line\">    .pipe(zlib.createGzip())</span><br><span class=\"line\">    .pipe(fs.createWriteStream(<span class=\"string\">'input.txt.gz'</span>))</span><br><span class=\"line\"><span class=\"comment\">// 解压 input.txt.gz 文件为 input.txt</span></span><br><span class=\"line\">fs.createReadStream(<span class=\"string\">'input.txt.gz'</span>)</span><br><span class=\"line\">    .pipe(zlib.createGunzip())</span><br><span class=\"line\">    .pipe(fs.createWriteStream(<span class=\"string\">'input.txt'</span>))</span><br><span class=\"line\">        </span><br><span class=\"line\">       </span><br><span class=\"line\"><span class=\"comment\">// HTTP 对象使用 Stream 接口，实现网络数据的读写</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">'http'</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> server = http.createServer(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> body = <span class=\"string\">''</span></span><br><span class=\"line\">    req.setEncoding(<span class=\"string\">'utf8'</span>)</span><br><span class=\"line\">    req.on(<span class=\"string\">'data'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">chunk</span>) </span>{</span><br><span class=\"line\">        body += chunk</span><br><span class=\"line\">    });</span><br><span class=\"line\">    req.on(<span class=\"string\">'end'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">        <span class=\"keyword\">try</span> {</span><br><span class=\"line\">            <span class=\"keyword\">var</span> data = <span class=\"built_in\">JSON</span>.parse(body);</span><br><span class=\"line\">        } <span class=\"keyword\">catch</span> (er) {</span><br><span class=\"line\">            res.statusCode = <span class=\"number\">400</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> res.end(<span class=\"string\">'error: '</span> + er.message);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        res.write(<span class=\"keyword\">typeof</span> data);</span><br><span class=\"line\">        res.end();</span><br><span class=\"line\">    })</span><br><span class=\"line\">})</span><br><span class=\"line\">server.listen(<span class=\"number\">8080</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 错误处理</span></span><br><span class=\"line\">http.createServer(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> stream = fs.createReadStream(<span class=\"string\">'filename.txt'</span>)</span><br><span class=\"line\">    stream</span><br><span class=\"line\">    .on(<span class=\"string\">'error'</span>, onerror)</span><br><span class=\"line\">    .pipe(zlib.createGzip())</span><br><span class=\"line\">    .on(<span class=\"string\">'error'</span>, onerror)</span><br><span class=\"line\">    .pipe(res)</span><br><span class=\"line\">  </span><br><span class=\"line\">    onFinished(res, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">      stream.destroy()</span><br><span class=\"line\">    })</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h2 id=\"util\"><a href=\"#util\" class=\"headerlink\" title=\"util\"></a>util</h2><blockquote><p>提供一系列实用方法，注意需要安装 npm install util</p></blockquote><ul><li>格式化字符串：<code>format</code></li><li>数据类型验证：<code>isDate、isArray、isError、isRegExp</code></li><li>其它：<code>inherits (继承)、inspect (对象转化为字符串)</code></li></ul><h1 id=\"五、Web-开发\"><a href=\"#五、Web-开发\" class=\"headerlink\" title=\"五、Web 开发\"></a>五、Web 开发</h1><h2 id=\"搭建-web-服务器\"><a href=\"#搭建-web-服务器\" class=\"headerlink\" title=\"搭建 web 服务器\"></a>搭建 web 服务器</h2><h3 id=\"通过插件\"><a href=\"#通过插件\" class=\"headerlink\" title=\"通过插件\"></a>通过插件</h3><blockquote><p>http-server、live-server</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install http-server -g</span><br><span class=\"line\">cd progect      <span class=\"comment\">// 进入项目目录</span></span><br><span class=\"line\">http-server     <span class=\"comment\">// 开启服务</span></span><br></pre></td></tr></tbody></table></figure><h3 id=\"通过-NodeJs\"><a href=\"#通过-NodeJs\" class=\"headerlink\" title=\"通过 NodeJs\"></a>通过 NodeJs</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">'http'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> url = <span class=\"built_in\">require</span>(<span class=\"string\">'url'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 命令行第三个参数，用来接收目录，可为空，相对当前server.js的目录名称</span></span><br><span class=\"line\"><span class=\"comment\">// 比如 node server debug，则 debug 文件夹与 server.js 文件同级并以 debug 启动服务</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> dir, arg = process.argv[<span class=\"number\">2</span>] || <span class=\"string\">''</span>; </span><br><span class=\"line\"></span><br><span class=\"line\">http.createServer(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> pathname = __dirname + url.parse(req.url).pathname;</span><br><span class=\"line\">    <span class=\"comment\">// 保存 dir (目录)</span></span><br><span class=\"line\">    dir = dir ? dir : pathname; </span><br><span class=\"line\">    <span class=\"comment\">// 替换文件静态路径</span></span><br><span class=\"line\">    pathname = dir ? pathname.replace(dir, dir + arg + <span class=\"string\">'/'</span>) : pathname; </span><br><span class=\"line\">    <span class=\"keyword\">if</span> (path.extname(pathname) == <span class=\"string\">\"\"</span>) {</span><br><span class=\"line\">        pathname += <span class=\"string\">\"/\"</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (pathname.charAt(pathname.length - <span class=\"number\">1</span>) == <span class=\"string\">\"/\"</span>) {</span><br><span class=\"line\">        <span class=\"comment\">// 入口文件，此处默认index.html</span></span><br><span class=\"line\">        pathname += <span class=\"string\">\"index.html\"</span>; </span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    fs.exists(pathname, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">exists</span>) </span>{</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (exists) {</span><br><span class=\"line\">            <span class=\"keyword\">switch</span> (path.extname(pathname)) {</span><br><span class=\"line\">              <span class=\"keyword\">case</span> <span class=\"string\">\".html\"</span>:</span><br><span class=\"line\">                  res.writeHead(<span class=\"number\">200</span>, {<span class=\"string\">\"Content-Type\"</span>: <span class=\"string\">\"text/html\"</span>});</span><br><span class=\"line\">                  <span class=\"keyword\">break</span>;</span><br><span class=\"line\">              <span class=\"keyword\">case</span> <span class=\"string\">\".js\"</span>:</span><br><span class=\"line\">                  res.writeHead(<span class=\"number\">200</span>, {<span class=\"string\">\"Content-Type\"</span>: <span class=\"string\">\"text/javascript\"</span>});</span><br><span class=\"line\">                  <span class=\"keyword\">break</span>;</span><br><span class=\"line\">              <span class=\"keyword\">case</span> <span class=\"string\">\".css\"</span>:</span><br><span class=\"line\">                  res.writeHead(<span class=\"number\">200</span>, {<span class=\"string\">\"Content-Type\"</span>: <span class=\"string\">\"text/css\"</span>});</span><br><span class=\"line\">                  <span class=\"keyword\">break</span>;</span><br><span class=\"line\">              <span class=\"keyword\">case</span> <span class=\"string\">\".gif\"</span>:</span><br><span class=\"line\">                  res.writeHead(<span class=\"number\">200</span>, {<span class=\"string\">\"Content-Type\"</span>: <span class=\"string\">\"image/gif\"</span>});</span><br><span class=\"line\">                  <span class=\"keyword\">break</span>;</span><br><span class=\"line\">              <span class=\"keyword\">case</span> <span class=\"string\">\".jpg\"</span>:</span><br><span class=\"line\">                  res.writeHead(<span class=\"number\">200</span>, {<span class=\"string\">\"Content-Type\"</span>: <span class=\"string\">\"image/jpeg\"</span>});</span><br><span class=\"line\">                  <span class=\"keyword\">break</span>;</span><br><span class=\"line\">              <span class=\"keyword\">case</span> <span class=\"string\">\".png\"</span>:</span><br><span class=\"line\">                  res.writeHead(<span class=\"number\">200</span>, {<span class=\"string\">\"Content-Type\"</span>: <span class=\"string\">\"image/png\"</span>});</span><br><span class=\"line\">                  <span class=\"keyword\">break</span>;</span><br><span class=\"line\">              <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                  res.writeHead(<span class=\"number\">200</span>, {<span class=\"string\">\"Content-Type\"</span>: <span class=\"string\">\"application/octet-stream\"</span>});</span><br><span class=\"line\">            }</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// res 可以自己添加信息来简单交互 比如可以修改 header 信息、修改返回数据</span></span><br><span class=\"line\">            fs.readFile(pathname, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err, data</span>) </span>{</span><br><span class=\"line\">                res.end(data);</span><br><span class=\"line\">            });</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"keyword\">else</span> {</span><br><span class=\"line\">            res.writeHead(<span class=\"number\">404</span>, {<span class=\"string\">\"Content-Type\"</span>: <span class=\"string\">\"text/html\"</span>});</span><br><span class=\"line\">            res.end(<span class=\"string\">\"Not Found\"</span>);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    });</span><br><span class=\"line\">}).listen(<span class=\"number\">9090</span>, <span class=\"string\">\"127.0.0.1\"</span>); <span class=\"comment\">// 服务器端口</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">\"server running at http://127.0.0.1:9090/\"</span>);</span><br></pre></td></tr></tbody></table></figure><h2 id=\"连接-mysql\"><a href=\"#连接-mysql\" class=\"headerlink\" title=\"连接 mysql\"></a>连接 mysql</h2><blockquote><p>安装 mysql 及其驱动：npm install mysql node-mysql -g</p></blockquote><h3 id=\"直接连接\"><a href=\"#直接连接\" class=\"headerlink\" title=\"直接连接\"></a>直接连接</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">'http'</span>)</span><br><span class=\"line\"><span class=\"keyword\">let</span> mysql = <span class=\"built_in\">require</span>(<span class=\"string\">\"mysql\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> connection = mysql.createConnection({</span><br><span class=\"line\">    host: <span class=\"string\">\"127.0.0.1\"</span>,      <span class=\"comment\">// 主机</span></span><br><span class=\"line\">    user: <span class=\"string\">\"root\"</span>,           <span class=\"comment\">// 用户名</span></span><br><span class=\"line\">    password: <span class=\"string\">\"li1993416\"</span>,  <span class=\"comment\">// 用户密码</span></span><br><span class=\"line\">    port: <span class=\"string\">\"3306\"</span>,           <span class=\"comment\">// 端口号</span></span><br><span class=\"line\">    database: <span class=\"string\">\"mysql\"</span>       <span class=\"comment\">// 数据库名</span></span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 连接数据库</span></span><br><span class=\"line\">connection.connect(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>)</span>{</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(err){</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">`mysql connect fail: <span class=\"subst\">${err}</span>!`</span>);</span><br><span class=\"line\">    }<span class=\"keyword\">else</span>{</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"mysql connect success!\"</span>);</span><br><span class=\"line\">    }</span><br><span class=\"line\">});</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 执行查询</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> str = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> sqlQuery = <span class=\"string\">\"select * from students\"</span>;</span><br><span class=\"line\">connection.query(sqlQuery, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, result</span>)</span>{</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(err){</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">`SQL error: <span class=\"subst\">${err}</span>!`</span>);</span><br><span class=\"line\">    }<span class=\"keyword\">else</span>{</span><br><span class=\"line\">        str = <span class=\"built_in\">JSON</span>.stringify(result);</span><br><span class=\"line\">    }</span><br><span class=\"line\">});</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 返回数据</span></span><br><span class=\"line\">http.createServer(<span class=\"function\">(<span class=\"params\">req, res</span>)=></span>{</span><br><span class=\"line\">    res.end(str)</span><br><span class=\"line\">}).listen(<span class=\"number\">3000</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'Server running at localhost:3000'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//关闭connection  </span></span><br><span class=\"line\">connection.end(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>)</span>{  </span><br><span class=\"line\">    <span class=\"keyword\">if</span>(err){ </span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(err.toString());</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;  </span><br><span class=\"line\">    }  </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'[connection end] succeed!'</span>)</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h3 id=\"通过连接池\"><a href=\"#通过连接池\" class=\"headerlink\" title=\"通过连接池\"></a>通过连接池</h3><blockquote><p>数据库连接池负责分配、管理和释放数据库连接，它允许应用程序重复使用一个现有的数据库连接而不是再重新建立一个，用于对数据库操作的性能</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> mysql = <span class=\"built_in\">require</span>(<span class=\"string\">'mysql'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> pool = mysql.createPool({</span><br><span class=\"line\">    host: <span class=\"string\">\"127.0.0.1\"</span>,      <span class=\"comment\">// 主机</span></span><br><span class=\"line\">    user: <span class=\"string\">\"root\"</span>,           <span class=\"comment\">// 用户名</span></span><br><span class=\"line\">    password: <span class=\"string\">\"li1993416\"</span>,  <span class=\"comment\">// 用户密码</span></span><br><span class=\"line\">    port: <span class=\"string\">\"3306\"</span>,           <span class=\"comment\">// 端口号</span></span><br><span class=\"line\">    database: <span class=\"string\">\"mysql\"</span>       <span class=\"comment\">// 数据库名</span></span><br><span class=\"line\">})</span><br><span class=\"line\">pool.getConnection(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, connection</span>) </span>{</span><br><span class=\"line\">    connection.query(<span class=\"string\">'select * from students'</span>, [], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, result</span>) </span>{</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (err) {</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Error: \"</span> + err.message);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        connection.release();</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(result);</span><br><span class=\"line\">    })</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h2 id=\"上传文件\"><a href=\"#上传文件\" class=\"headerlink\" title=\"上传文件\"></a>上传文件</h2><div align=\"center\"><br><img src=\"images/nodejs/node-uploadFile.png\" alt=\"Node UploadFile\"><br></div><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// server.js</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> app = express();</span><br><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">\"fs\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> bodyParser = <span class=\"built_in\">require</span>(<span class=\"string\">'body-parser'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> multer  = <span class=\"built_in\">require</span>(<span class=\"string\">'multer'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(express.static(<span class=\"string\">'public'</span>));</span><br><span class=\"line\">app.use(bodyParser.urlencoded({ <span class=\"attr\">extended</span>: <span class=\"literal\">false</span> }));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// dest 定义上传目录，array 限制上传类型（即 input name）　</span></span><br><span class=\"line\">app.use(multer({ <span class=\"attr\">dest</span>: <span class=\"string\">'./uploads'</span>}).array(<span class=\"string\">'image'</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">    res.sendFile( __dirname + <span class=\"string\">\"/\"</span> + <span class=\"string\">\"index.html\"</span> );</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\">app.post(<span class=\"string\">'/file_upload'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(req.files[<span class=\"number\">0</span>]);  <span class=\"comment\">// 上传的文件信息</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> des_file = __dirname + <span class=\"string\">\"/\"</span> + req.files[<span class=\"number\">0</span>].originalname;</span><br><span class=\"line\"></span><br><span class=\"line\">    fs.readFile( req.files[<span class=\"number\">0</span>].path, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err, data</span>) </span>{</span><br><span class=\"line\">        fs.writeFile(des_file, data, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err</span>) </span>{</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(err){</span><br><span class=\"line\">                <span class=\"built_in\">console</span>.log(err)</span><br><span class=\"line\">            }<span class=\"keyword\">else</span>{</span><br><span class=\"line\">                response = {</span><br><span class=\"line\">                    message: <span class=\"string\">'File uploaded successfully'</span>, </span><br><span class=\"line\">                    filename: req.files[<span class=\"number\">0</span>].originalname</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log( response );</span><br><span class=\"line\">            res.end( <span class=\"built_in\">JSON</span>.stringify( response ) );</span><br><span class=\"line\">        })</span><br><span class=\"line\">    })</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> server = app.listen(<span class=\"number\">3000</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">\"localhost:3000\"</span>)</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 运行命令</span></span><br><span class=\"line\">npm install multer body-parser -S</span><br><span class=\"line\">node server.js</span><br></pre></td></tr></tbody></table></figure><h2 id=\"WebSocket\"><a href=\"#WebSocket\" class=\"headerlink\" title=\"WebSocket\"></a>WebSocket</h2><h3 id=\"通过-ws-模块\"><a href=\"#通过-ws-模块\" class=\"headerlink\" title=\"通过 ws 模块\"></a>通过 ws 模块</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 安装</span></span><br><span class=\"line\">cnpm i ws -S</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 客户端js</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"built_in\">window</span>.WebSocket != <span class=\"literal\">undefined</span>) {  </span><br><span class=\"line\">    <span class=\"comment\">//创建一个WebSocket，监听端口6060端口，这里必须是：ws，不能是http</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> connection = <span class=\"keyword\">new</span> WebSocket(<span class=\"string\">'ws://localhost:6060'</span>); </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// readyState : 0：正在连接、1：连接成功、2：正在关闭、3：连接关闭</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(connection.readyState); </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 握手协议成功以后，readyState就从0变为1，并触发open事件  </span></span><br><span class=\"line\">    connection.onopen = <span class=\"function\">(<span class=\"params\">event</span>) =></span> {   </span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(event);</span><br><span class=\"line\">        <span class=\"comment\">//连接建立后，客户端通过send方法向服务器端发送数据。   </span></span><br><span class=\"line\">        connection.send(<span class=\"string\">'client message'</span>); </span><br><span class=\"line\">    };  </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//监听  </span></span><br><span class=\"line\">    connection.onmessage = <span class=\"function\">(<span class=\"params\">event</span>) =></span> {   </span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(event);  </span><br><span class=\"line\">    };  </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//关闭WebSocket连接，会触发close事件。  </span></span><br><span class=\"line\">    connection.onclose = <span class=\"function\"><span class=\"params\">()</span> =></span> {   </span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Closed\"</span>);  </span><br><span class=\"line\">    };  </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//出现错误  </span></span><br><span class=\"line\">    connection.onerror = <span class=\"function\">(<span class=\"params\">event</span>) =></span> {   </span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Error: \"</span> + event.data);  </span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 服务器 server.js</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 启动 WebSocket 服务器</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> server = <span class=\"built_in\">require</span>(<span class=\"string\">'http'</span>).createServer() , </span><br><span class=\"line\">    WebSocketServer = <span class=\"built_in\">require</span>(<span class=\"string\">'ws'</span>).Server , </span><br><span class=\"line\">    wss = <span class=\"keyword\">new</span> WebSocketServer({ <span class=\"attr\">server</span>: server }) , </span><br><span class=\"line\">    app = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>)() , </span><br><span class=\"line\">    port = <span class=\"number\">6060</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用 express 中间件</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>{ </span><br><span class=\"line\">    <span class=\"comment\">//send用来向客户端发送信息，on用来接收/监听客户端发来的信息</span></span><br><span class=\"line\">    res.send({ <span class=\"attr\">msg</span>: <span class=\"string\">\"hello\"</span> });</span><br><span class=\"line\">});</span><br><span class=\"line\"><span class=\"comment\">// 监听事件  %s 字符串、%d 整数、%f 浮点数</span></span><br><span class=\"line\">wss.on(<span class=\"string\">'connection'</span>, <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">connection</span>(<span class=\"params\">ws</span>) </span>{ </span><br><span class=\"line\">    <span class=\"comment\">//监听 </span></span><br><span class=\"line\">    ws.on(<span class=\"string\">'message'</span>, <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">incoming</span>(<span class=\"params\">message</span>) </span>{  </span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'received: %s'</span>, message);</span><br><span class=\"line\">    });</span><br><span class=\"line\">    <span class=\"comment\">//发送 </span></span><br><span class=\"line\">    ws.send(<span class=\"string\">'something'</span>)</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\">server.on(<span class=\"string\">'request'</span>, app);</span><br><span class=\"line\">server.listen(port, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{ </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'http://localhost:'</span> + server.address().port) </span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h3 id=\"通过-socket-io\"><a href=\"#通过-socket-io\" class=\"headerlink\" title=\"通过 socket.io\"></a>通过 socket.io</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 安装</span></span><br><span class=\"line\">cnpm i socket.io -S</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 客户端 js (需要引入 socket.io.js)</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> socket = io.connect(<span class=\"string\">'http://localhost:8080'</span>)  </span><br><span class=\"line\">socket.on(<span class=\"string\">'news'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">data</span>) </span>{   </span><br><span class=\"line\">    socket.emit(<span class=\"string\">'event'</span>, { <span class=\"attr\">my</span>: <span class=\"string\">'data'</span> })</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 服务器 server.js</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"built_in\">require</span>(<span class=\"string\">'http'</span>).createServer(handler), </span><br><span class=\"line\">    io = <span class=\"built_in\">require</span>(<span class=\"string\">'socket.io'</span>).listen(app), </span><br><span class=\"line\">    fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8080</span>);</span><br><span class=\"line\">io.set(<span class=\"string\">'log level'</span>, <span class=\"number\">1</span>)  <span class=\"comment\">// 关闭 debug 信息</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handler</span> (<span class=\"params\">req, res</span>) </span>{</span><br><span class=\"line\">  fs.readFile(__dirname + <span class=\"string\">'/index.html'</span>,<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err, data</span>) </span>{  </span><br><span class=\"line\">      <span class=\"keyword\">if</span> (err) {</span><br><span class=\"line\">        res.writeHead(<span class=\"number\">500</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> res.end(<span class=\"string\">'Error loading index.html'</span>);</span><br><span class=\"line\">      }    </span><br><span class=\"line\">      res.writeHead(<span class=\"number\">200</span>, {<span class=\"string\">'Content-Type'</span>: <span class=\"string\">'text/html'</span>});    </span><br><span class=\"line\">      res.end(data);</span><br><span class=\"line\">  })</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\">io.sockets.on(<span class=\"string\">'connection'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">socket</span>) </span>{</span><br><span class=\"line\">    socket.emit(<span class=\"string\">'news'</span>, { <span class=\"attr\">hello</span>: <span class=\"string\">'world'</span> });</span><br><span class=\"line\">    socket.on(<span class=\"string\">'my other event'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">data</span>) </span>{</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(data);</span><br><span class=\"line\">    })</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h2 id=\"解决跨域\"><a href=\"#解决跨域\" class=\"headerlink\" title=\"解决跨域\"></a>解决跨域</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cnpm install cors --save</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// app.js 加入代码</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> cors = <span class=\"built_in\">require</span>(<span class=\"string\">'cors'</span>);</span><br><span class=\"line\">app.use(cors({</span><br><span class=\"line\">    origin:[<span class=\"string\">'http://localhost:8080'</span>],  <span class=\"comment\">//指定接收的地址</span></span><br><span class=\"line\">    methods:[<span class=\"string\">'GET'</span>,<span class=\"string\">'POST'</span>],            <span class=\"comment\">// 指定接收的请求类型</span></span><br><span class=\"line\">    alloweHeaders:[<span class=\"string\">'Content-Type'</span>, <span class=\"string\">'Authorization'</span>]  <span class=\"comment\">// 指定 header</span></span><br><span class=\"line\">}))</span><br></pre></td></tr></tbody></table></figure><!-- rebuild by neat --></body></html>","site":{"data":{"next":{"override":false,"cache":{"enable":true},"favicon":{"small":"/images/favicon-16.ico","medium":"/images/favicon-32.ico","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"rss":"/atom.xml","footer":{"since":2019,"icon":{"name":"snowflake-o","animated":false,"color":"#808080"},"copyright":"chuangge","powered":{"enable":false,"version":true},"theme":{"enable":false,"version":true},"beian":{"enable":false,"icp":null}},"creative_commons":{"license":"by-nc-sa","sidebar":false,"post":false},"canonical":true,"seo":false,"index_with_subtitle":false,"exturl":false,"menu":{"home":"/ || home  //首页","tags":"/tags/ || tags  //标签","categories":"/categories/ || th   //分类","archives":"/archives/ || archive //归档"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":{"GitHub":"https://github.com/ || github","StackOverflow":"https://stackoverflow.com/ || stack-overflow"},"social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"友情链接","links_layout":"inline","links":{"个人简历":"https://chuanggefighting.github.io/project/","印记中文":"https://www.docschina.org/","在线工具":"http://tool.lu/","Learn Anything":"https://learn-anything.xyz/"},"avatar":{"url":"/images/chuang.png","rounded":true,"opacity":1,"rotated":true},"toc":{"enable":true,"number":true,"wrap":false,"max_depth":6},"sidebar":{"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"read_more_btn":true,"post_meta":{"item_text":true,"created_at":true,"updated_at":{"enabled":true,"another_day":true},"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":true,"awl":4,"wpm":275},"codeblock":{"border_radius":null,"copy_button":{"enable":false,"show_result":false}},"reward":{"enable":false},"related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_edit":{"enable":false,"url":"https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name"},"disable_baidu_tranformation":false,"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"font":{"enable":true,"host":"//fonts.proxy.ustclug.org","global":{"external":true,"family":"Lato","size":16},"headings":{"external":true,"family":"Roboto Slab","size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":"Lobster Two","size":24},"codes":{"external":true,"family":"Roboto Mono","size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css","copy_tex":{"enable":false,"copy_tex_js":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js","copy_tex_css":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css"}}},"pdf":{"enable":false,"per_page":true,"height":"500px","pdfobject":{"cdn":"//cdn.jsdelivr.net/npm/pdfobject@2.1.1/pdfobject.min.js"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":true,"appid":"snOvapuSplYTVflf5p9Ml9JX-gzGzoHsz","appkey":"5ABGdfyEdAtu6lTXdGdo7hf9","notify":false,"verify":false,"placeholder":"ヾﾉ≧∀≦)o 来呀！吐槽一番吧！","avatar":"mm","guest_info":"nick,mail,link","pageSize":10,"visitor":false,"comment_count":true},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"gitalk":{"enable":false,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true},"needmoreshare2":{"enable":true,"postbottom":{"enable":true,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null,"security":false,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":true,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":true,"pace_theme":"pace-theme-center-simple","canvas_nest":{"enable":true,"onmobile":true,"color":"0,0,255","opacity":0.5,"zIndex":-1,"count":99},"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"canvas_nest_nomobile":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"leancloud":null,"valine":null,"gitalk_js":null,"gitalk_css":null,"md5":null},"css":"css","js":"js","images":"images","passage_end_tag":{"enabled":true},"daovoice":true,"daovoice_app_id":"2ed51855"}}},"excerpt":"","more":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><h1 id=\"一、NodeJS\"><a href=\"#一、NodeJS\" class=\"headerlink\" title=\"一、NodeJS\"></a>一、NodeJS</h1><blockquote><p>用于创建高性能的 Web 服务器</p></blockquote><div style=\"text-indent:2em\">脚本语言都需要一个解析器才能运行，浏览器是html中Js代码的解析器。NodeJS 则是 一个独立运行的 js 代码解析器，它封装了 V8 引擎并引入了 commonjs 规范，分别解决了js比较慢和乱的问题，填补了 js 在服务器端的空白。</div><br><div style=\"text-indent:2em\">每一种解析器都是一个运行环境，不但允许 JS 定义各种数据结构并进行各种计算，还允许JS使用运行环境提供的内置对象和方法做一些事情。例如运行在浏览器中的 JS 用于操作 DOM，浏览器就提供了 document 等内置对象。而运行在 NodeJS 中的 JS 用于操作磁盘文件或搭建 HTTP 服务器，NodeJS 就相应提供了 fs、http 等内置对象。</div><h2 id=\"特点\"><a href=\"#特点\" class=\"headerlink\" title=\"特点\"></a>特点</h2><ul><li>轻量高效</li><li>事件驱动模型</li><li>异步非阻塞 I/O 模型</li><li>单进程单线程应用程序</li></ul><h2 id=\"不足\"><a href=\"#不足\" class=\"headerlink\" title=\"不足\"></a>不足</h2><ul><li>不适合处理复杂逻辑</li><li>不适合计算密集型应用</li><li>不适合单用户多任务的程序</li><li>代码某个环节报错则整个系统崩溃</li><li>只支持单核 CPU 而不能充分利用多核 CPU 服务器</li></ul><h2 id=\"运行机制\"><a href=\"#运行机制\" class=\"headerlink\" title=\"运行机制\"></a>运行机制</h2><h3 id=\"重点注意\"><a href=\"#重点注意\" class=\"headerlink\" title=\"重点注意\"></a>重点注意</h3><ul><li>同步异步：操作任务是否按顺序依次执行</li><li>阻塞非阻塞：IO 操作是否影响主进城执行其它代码</li><li>NodeJs 内部通过线程池来完成异步操作，libuv 针对不同平台的差异性实现了统一调用，所以 NodeJS 程序的单线程仅仅指 Js 运行在单线程，程序本身并非单线程</li><li>libuv 默认创建一个由四个线程组成的线程池来加载异步操作，但如今的操作系统已经对很多 I/O 任务提供了异步接口，所以只有不存在其他方式时，异步 I/O 才会使用线程池</li></ul><h3 id=\"异步非阻塞\"><a href=\"#异步非阻塞\" class=\"headerlink\" title=\"异步非阻塞\"></a>异步非阻塞</h3><blockquote><p>IO 操作的核心是通过事件机制实现异步执行</p></blockquote><div style=\"text-indent:2em\">采用了单线程模型，它使用一个主线程处理所有的请求，当接收到操作请求后就作为一个事件放入任务队列中，然后继续接收其他请求，如果有 I/O 操作（比较耗时）就交给 libuv 的工作线程去执行，所以主线程速度快而且不会阻塞，这就是 <code>单线程、异步 I/O</code>。将所有操作都注册为一个事件并等待触发的方式就是 <code>事件驱动</code>。</div><div style=\"text-indent:2em;margin-top:15px\">如果 I/O 操作由于复杂的逻辑处理而发生了阻塞，但返回的结果是暂时在事件队列中等待，由事件循环自动依次取回到主程序中恢复执行，而事件队列在主程序之外存储事件，所以不会干扰主程序执行。这就是 <code>非阻塞 I/O</code>。</div><h3 id=\"事件循环\"><a href=\"#事件循环\" class=\"headerlink\" title=\"事件循环\"></a>事件循环</h3><div style=\"text-indent:2em;margin-top:15px\">当主线程没有请求接入时，就开始通过事件循环机制查看任务队列来检查队列中是否有要处理的事件，如果是 I/O 任务就交给 libuv 的工作线程去执行并指定回调函数，否则就直接处理并返回结果给上层。当工作线程中的 I/O 任务完成后执行指定的回调函数，把这个完成的事件放到事件队列中等待事件循环时处理。这就是 <code>事件循环</code>。</div><ol><li>V8 引擎解析 JavaScript 脚本</li><li>解析后的代码，调用 Node API</li><li>libuv 库负责 Node API 的执行。它将不同的任务分配给不同的线程，形成一个 Event Loop (事件循环），以异步的方式将任务的执行结果返回给 V8 引擎</li><li>V8 引擎再将结果返回给用户<ul><li>除了 setTimeout、setInterval，NodeJs还提供了：process.nextTick、setImmediate</li><li>process.nextTick 可以在当前“执行栈”尾部、下一次 EventLoop（主线程读取“任务队列”）之前，触发回调函数。即它指定的任务总是发生在所有异步任务之前</li><li>setImmediate 则是在当前”任务队列”的尾部添加事件，它指定的任务总是在下一次 Event Loop 时执行</li></ul></li></ol><h2 id=\"功能架构\"><a href=\"#功能架构\" class=\"headerlink\" title=\"功能架构\"></a>功能架构</h2><div align=\"center\"><br><img src=\"images/nodejs/node-framework.png\" alt=\"Node Framework\"><br></div><ul><li><strong>顶部</strong>：Js 编写的应用程序和模块</li><li><strong>中间</strong>：通过代码包装和暴露接口而实现 js 可以调用 c++ 代码<ul><li><strong>Bindings</strong>：绑定核心库的依赖</li><li><strong>Addons</strong>：绑定第三方或者自定义 C/C++</li></ul></li><li><strong>底部</strong>：C/C++ 编写的内部组件，提供了系统底层操作方法<ul><li><strong>V8</strong>：Google 开源 js 引擎，用于将 Js 代码编译为机器码执行以便快速编译</li><li><strong>libuv</strong>：跨平台的底层封装，实现事件循环、文件操作等异步功能。</li></ul></li></ul><h2 id=\"适用场景\"><a href=\"#适用场景\" class=\"headerlink\" title=\"适用场景\"></a>适用场景</h2><div style=\"text-indent:2em\">NodeJS 处理并发的能力较强，但处理计算和逻辑的能力很弱，因此适用于 高并发、I/O 密集、少量业务逻辑 的场景，比如 RESTFUL API、实时聊天、客户端逻辑强大的单页 APP。一般由前端处理复杂逻辑，NodeJS 只提供异步 I/O，这样可以实现对高并发的高性能处理。</div><h1 id=\"二、安装配置\"><a href=\"#二、安装配置\" class=\"headerlink\" title=\"二、安装配置\"></a>二、安装配置</h1><blockquote><p>window 系统</p></blockquote><h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><blockquote><p>本质是把 NodeJS 执行程序复制到一个目录，然后保证这个目录在系统 PATH 环境变量下，以便终端下可以使用 node 命令</p></blockquote><ul><li>版本：Windows Installer(.msi) 64位</li><li>地址：建议不要安装在 C 盘而修改默认地址为 “D:\\nodejs\\”</li><li>命令<ul><li>查看版本：<code>node -v</code></li><li>交互模式：<code>node</code></li><li>执行文件：<code>node hello.js</code></li></ul></li></ul><h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><h3 id=\"包文件\"><a href=\"#包文件\" class=\"headerlink\" title=\"包文件\"></a>包文件</h3><blockquote><p>统一管理通过 npm 全局安装的第三方包及其缓存</p></blockquote><ol><li>新建文件夹：<code>node_global、node_cache</code></li><li>执行命令<ul><li><code>npm config set cache &quot;D:\\nodejs\\node_cache&quot;</code></li><li><code>npm config set prefix &quot;D:\\nodejs\\node_global&quot;</code></li></ul></li><li>修改文件：node_modules\\npm\\npmrc<ul><li><code>prefix = D:\\nodejs\\node_global</code></li><li><code>cache = D:\\nodejs\\node_global</code></li></ul></li></ol><h3 id=\"环境变量\"><a href=\"#环境变量\" class=\"headerlink\" title=\"环境变量\"></a>环境变量</h3><blockquote><p>全局使用 npm、cnpm 等命令</p></blockquote><div style=\"text-indent:2em\">path 指系统默认指定到某一路径，运行命令时会先从这些路径中开始找。另一种方法是在系统变量中设置 NODE_PATH = 安装的根目录，NodeJS 允许通过变量 NODE_PATH 指定额外的模块搜索路径。所以配置方法如下：</div><ul><li>用户变量 PATH 末尾添加 <code>&quot;;D:\\nodejs\\node_global&quot;</code></li><li>系统变量新增 <code>NODE_PATH: &quot;D:\\nodejs\\node_global\\node_modules&quot;</code></li></ul><h2 id=\"安装-cnpm\"><a href=\"#安装-cnpm\" class=\"headerlink\" title=\"安装 cnpm\"></a>安装 cnpm</h2><blockquote><p>npm 服务器在国外而安装速度慢，所以大多都使用淘宝对 npm 的镜像服务器 cnpm，它和 npm 命令相同</p></blockquote><ul><li>安装：<code>npm install cnpm -g --registry=https://registry.npm.taobao.org</code></li><li>查看：<code>cnpm -v</code></li><li>安装依赖：<code>cnpm install</code></li><li>安装失败的解决方案：<code>npm config set registry https://registry.npm.taobao.org</code></li></ul><h2 id=\"安装-nodemon\"><a href=\"#安装-nodemon\" class=\"headerlink\" title=\"安装 nodemon\"></a>安装 nodemon</h2><blockquote><p>编写调试 Node 项目时，每次修改代码后都需要重新启动，比较麻烦。nodemon 工具可以监听代码文件的变化，并自动重启 Node 服务器和数据库服务器</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 安装</span></span><br><span class=\"line\">cnpm install -g  nodemon</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// app.js</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">'http'</span>)</span><br><span class=\"line\">http.createServer(<span class=\"function\">(<span class=\"params\">req, res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    res.end(<span class=\"string\">'hello node'</span>);</span><br><span class=\"line\">&#125;).listen(<span class=\"number\">3000</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 启动</span></span><br><span class=\"line\">nodemon app</span><br></pre></td></tr></table></figure><h1 id=\"三、模块管理\"><a href=\"#三、模块管理\" class=\"headerlink\" title=\"三、模块管理\"></a>三、模块管理</h1><h2 id=\"模块机制\"><a href=\"#模块机制\" class=\"headerlink\" title=\"模块机制\"></a>模块机制</h2><ul><li>根据模块(文件) 划分功能、组织和复用代码</li><li>通过 npm 工具和网站进行开源社区代码共享</li><li>通过包规范管理应用和可复用组件</li></ul><h2 id=\"模块模型\"><a href=\"#模块模型\" class=\"headerlink\" title=\"模块模型\"></a>模块模型</h2><ul><li><strong>核心模块</strong>：NodeJS 提供，会被编译到二进制执行文件（加载速度快）<ul><li><strong>C/C++ 内建模块</strong>：存放src目录下的最底层模块，会提供js调用的API</li><li><strong>Js 核心模块</strong>：存放在lib目录下，为C/C++内建模块提供封装和桥接</li></ul></li><li><strong>文件模块</strong>：用户编写，动态加载（加载速度较慢）<ul><li><strong>C++ 扩展模块</strong>：用于提高运行效率等自定义编写的底层模块</li><li><strong>Js 文件模块</strong>：由第三方或用户自行编写的模块</li></ul></li></ul><h2 id=\"模块缓存\"><a href=\"#模块缓存\" class=\"headerlink\" title=\"模块缓存\"></a>模块缓存</h2><ul><li>模块会在第一次 require 后被缓存，<code>多次 require 不会导致模块的代码被执行多次</code></li><li>Node 模块的缓存不同于浏览器的 js 缓存，浏览器只缓存文件，<code>Node 模块缓存的是编译和执行之后的对象</code></li><li>require.cache 对象代表 Node 模块缓存区，缓存的模块以属性的方式加入该对象，可以通过 <code>require.cache[&#39;模块标识符&#39;] 来访问具体的缓存模块</code>，也可以 delete 该缓存</li></ul><h2 id=\"模块变量\"><a href=\"#模块变量\" class=\"headerlink\" title=\"模块变量\"></a>模块变量</h2><h3 id=\"全局对象\"><a href=\"#全局对象\" class=\"headerlink\" title=\"全局对象\"></a>全局对象</h3><ul><li><strong>global</strong>：表示Node所在的全局环境，类似于浏览器中的window对象</li><li><strong>process</strong>：指向Node内置的process模块，允许开发者与当前进程互动</li><li><strong>console</strong>：指向Node内置的console模块，提供命令行环境中的标准输入、标准输出功能。</li></ul><h3 id=\"全局函数\"><a href=\"#全局函数\" class=\"headerlink\" title=\"全局函数\"></a>全局函数</h3><ul><li><strong>模块加载函数</strong>：require</li><li><strong>定时器函数</strong>：setTimeout、setInterval、clearTimeout、clearInterval</li></ul><h3 id=\"全局变量\"><a href=\"#全局变量\" class=\"headerlink\" title=\"全局变量\"></a>全局变量</h3><ul><li><strong>_filename</strong>：指向当前运行脚本的文件名</li><li><strong>_dirname</strong>：指向当前运行脚本所在的目录</li></ul><h3 id=\"模块变量-1\"><a href=\"#模块变量-1\" class=\"headerlink\" title=\"模块变量\"></a>模块变量</h3><ul><li><strong>module</strong>：表示当前模块的对象</li><li><strong>module.exports</strong>：模块的导出对象</li><li><strong>module.filename</strong>：模块解析后的文件名</li><li><strong>exports</strong>：指向 module.exports 对象的变量</li></ul><h2 id=\"模块包规范\"><a href=\"#模块包规范\" class=\"headerlink\" title=\"模块包规范\"></a>模块包规范</h2><blockquote><p>NodeJS 采用包来对一组具有相互依赖关系的模块进行统一管理，封装为独立的复用组件或单个应用。Node的包通常为一个目录，主要包括如下内容：</p></blockquote><ul><li><strong>package.json</strong>：包的描述文件</li><li><strong>bin</strong>：可执行文件、二进制文件</li><li><strong>lib</strong>：待加载的 js 文件</li><li><strong>doc</strong>：使用包的说明文档</li><li><strong>test</strong>：单元测试用例代码文件</li><li><strong>node_modules</strong>：本地安装包</li></ul><h1 id=\"四、核心模块\"><a href=\"#四、核心模块\" class=\"headerlink\" title=\"四、核心模块\"></a>四、核心模块</h1><h2 id=\"HTTP\"><a href=\"#HTTP\" class=\"headerlink\" title=\"HTTP\"></a>HTTP</h2><blockquote><p>处理客户端的网络请求</p></blockquote><h3 id=\"作为客户端\"><a href=\"#作为客户端\" class=\"headerlink\" title=\"作为客户端\"></a>作为客户端</h3><ul><li><strong>client</strong>：连接服务器<ul><li>发起请求：<code>http.request(options, fn)</code></li><li>简化版，不用 end：<code>http.get(options, fn)</code></li></ul></li><li><strong>ClientRequest</strong>：处理要发送的请求信息<ul><li>收到请求：<code>req.on(&quot;response&quot;, fn)</code></li><li>收到错误：<code>req.on(&quot;error&quot;, fn)</code></li><li>写入数据：<code>req.write</code></li><li>完成发送：<code>req.end</code></li></ul></li><li><strong>ClientResponse</strong>：获取服务端返回信息<ul><li>传输数据：<code>res.on(&quot;data&quot;, fn)</code></li><li>传输结束：<code>res.on(&quot;end&quot;, fn)</code></li><li>请求关闭：<code>res.on(&quot;close&quot;, fn)</code></li><li>设置存储：<code>res.setEncoding</code></li><li>暂停请求：<code>res.pause</code></li><li>恢复请求：<code>res.resume</code></li><li>状态码：<code>res.statusCode</code></li><li>请求头：<code>res.headers</code></li></ul></li></ul><h3 id=\"作为服务端\"><a href=\"#作为服务端\" class=\"headerlink\" title=\"作为服务端\"></a>作为服务端</h3><ul><li><strong>Server</strong>：创建服务器<ul><li>生成实例：<code>Server()</code><ul><li>接收请求：<code>on(&quot;request&quot;, fn)</code></li><li>关闭请求：<code>on(&quot;close&quot;, fn)</code></li><li>监听服务：<code>listen(port, fn)</code></li><li>新建 TCP 流：<code>on(&quot;connection&quot;, fn)</code></li></ul></li><li>直接创建：<code>createServer(fn).listen(port)</code></li></ul></li><li><strong>IncomingMessage</strong>：获取客户端请求信息<ul><li>传输数据：<code>on(&quot;data&quot;, fn)</code></li><li>传输结束：<code>on(&quot;end&quot;, fn)</code></li><li>请求关闭：<code>on(&quot;close&quot;, fn)</code></li><li>请求方法：<code>method</code></li><li>请求地址：<code>url</code></li></ul></li><li><strong>ServerResponse</strong>：处理返回给客户端的信息res<ul><li>设置头信息：<code>setHead</code></li><li>合并头信息：<code>writeHead</code></li><li>写入数据：<code>write</code></li><li>结束传输：<code>end</code></li></ul></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">'http'</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> url = <span class=\"built_in\">require</span>(<span class=\"string\">'url'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">http.createServer(<span class=\"function\">(<span class=\"params\">req,res</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 将传过来的URL转变为对象</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> params = url.parse(req.url,<span class=\"literal\">true</span>)</span><br><span class=\"line\">    res.write(params.query.name)</span><br><span class=\"line\">    res.end()</span><br><span class=\"line\">    <span class=\"comment\">// res.end(params.query.name);</span></span><br><span class=\"line\">&#125;).listen(<span class=\"number\">3000</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 客户端请求</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> request = http.get(&#123;</span><br><span class=\"line\">    host:<span class=\"string\">'localhost'</span>,</span><br><span class=\"line\">    path:<span class=\"string\">'/user?name=tom&amp;age=22'</span>,</span><br><span class=\"line\">    port:<span class=\"number\">3000</span>&#125;,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>)</span>&#123;</span><br><span class=\"line\">    res.setEncoding(<span class=\"string\">'utf-8'</span>)</span><br><span class=\"line\">    res.on(<span class=\"string\">'data'</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'res_date：'</span>+data)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h2 id=\"URL\"><a href=\"#URL\" class=\"headerlink\" title=\"URL\"></a>URL</h2><blockquote><p>处理客户端请求过来的URL</p></blockquote><ul><li><strong>parse</strong>：将 url 字符串地址转为一个对象</li><li><strong>format</strong>：将 url 对象转为一个 url 字符串</li><li><strong>resolve</strong>：对传入的两个参数用 <code>/</code> 拼接</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> url = <span class=\"built_in\">require</span>(<span class=\"string\">\"url\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">url.parse(<span class=\"string\">\"http://user:pass@host.com:8080/p/a/t/h?query=string#hash\"</span>)</span><br><span class=\"line\">url.parse(<span class=\"string\">\"http://user:pass@host.com:8080/p/a/t/h?query=string#hash\"</span>, <span class=\"literal\">true</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">url.format(&#123;</span><br><span class=\"line\">    protocol: <span class=\"string\">\"http:\"</span>,</span><br><span class=\"line\">    host: <span class=\"string\">\"182.163.0:60\"</span>,</span><br><span class=\"line\">    port: <span class=\"string\">\"60\"</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">url.resolve(<span class=\"string\">\"http://whitemu.com\"</span>, <span class=\"string\">\"gulu\"</span>)</span><br></pre></td></tr></table></figure><h2 id=\"Querystring\"><a href=\"#Querystring\" class=\"headerlink\" title=\"Querystring\"></a>Querystring</h2><blockquote><p>处理客户端 get/post 请求传递的参数</p></blockquote><ul><li><strong>parse</strong>：将一个字符串反序列化为一个对象</li><li><strong>stringify</strong>：将一个对象序列化成一个字符串</li><li><strong>escape</strong>：使传入的字符串进行编码</li><li><strong>unescape</strong>：对使用了 escape 编码的字符进行解码</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> querystring = <span class=\"built_in\">require</span>(<span class=\"string\">'querystring'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">querystring.parse(<span class=\"string\">\"name=tom&amp;sex=man&amp;sex=women\"</span>)</span><br><span class=\"line\">querystring.stringify(&#123; <span class=\"attr\">name</span>: <span class=\"string\">'tom'</span>, <span class=\"attr\">sex</span>: [<span class=\"string\">'man'</span>, <span class=\"string\">'women'</span>]&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">querystring.escape(<span class=\"string\">\"name=慕白\"</span>)</span><br><span class=\"line\">querystring.unescape(<span class=\"string\">'name%3D%E6%85%95%E7%99%BD'</span>)</span><br></pre></td></tr></table></figure><h2 id=\"Path\"><a href=\"#Path\" class=\"headerlink\" title=\"Path\"></a>Path</h2><blockquote><p>操作文件路径</p></blockquote><ul><li>获取路径信息<ul><li><strong>dirname</strong>：路径</li><li><strong>extname</strong>：扩展名</li><li><strong>basename</strong>：文件名</li></ul></li><li>路径拼接<ul><li><strong>join</strong>：使用当前系统的路径分隔符拼接路径</li><li><strong>resolve</strong>：将相对路径拼接出绝对路径</li><li><strong>relative</strong>：解析出两个路径之间的相对路径</li></ul></li><li>路径处理<ul><li><strong>parse</strong>：路径分解而返回对象</li><li><strong>format</strong>：路径组合而返回字符串</li><li><strong>normalize</strong>：路径标准化</li><li><strong>isAbsolute</strong>：判断路径是否为绝对路径</li></ul></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>)</span><br><span class=\"line\">path.dirname(<span class=\"string\">'/foo/bar/baz/asdf/a.txt'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">path.join(<span class=\"string\">'/foo'</span>, <span class=\"string\">'bar'</span>, <span class=\"string\">'baz/asdf'</span>, <span class=\"string\">'..'</span>)</span><br><span class=\"line\">path.resolve(<span class=\"string\">'www'</span>, <span class=\"string\">'js/upload'</span>, <span class=\"string\">'../mod.js'</span>)</span><br><span class=\"line\">path.relative(<span class=\"string\">'C:/test/aaa'</span>, <span class=\"string\">'C:/bbb'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">path.parse(<span class=\"string\">'/home/user/dir/file.txt'</span>)</span><br><span class=\"line\">path.format(&#123;</span><br><span class=\"line\">    dir: <span class=\"string\">'/tmp'</span>, </span><br><span class=\"line\">    name: <span class=\"string\">'hello'</span>,</span><br><span class=\"line\">    ext: <span class=\"string\">'.js'</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">path.normalize(<span class=\"string\">'a/../user/bin'</span>)</span><br><span class=\"line\">path.isAbsolute(<span class=\"string\">'/foo/bar'</span>)</span><br></pre></td></tr></table></figure><h2 id=\"Events\"><a href=\"#Events\" class=\"headerlink\" title=\"Events\"></a>Events</h2><blockquote><p>事件处理模块</p></blockquote><div style=\"text-indent:2em\">回调函数模式让 NodeJS 可以处理异步操作，但对于无法处理多状态的异步操作则需要进行拆分而分阶段执行。为了解决这个问题，NodeJS 提供了 Event Emitter 接口，通过事件解决多状态异步操作的响应问题。events 模块对外暴露一个 EventEmitter 类，可以用来生成事件发生器的实例 emitter，然后通过实例方法处理事件，比如 on/once 监听事件、emit 触发事件、removeListener 删除事件等。</div><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 模块调用</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> events = <span class=\"built_in\">require</span>(<span class=\"string\">\"events\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> emitter = <span class=\"keyword\">new</span> events.EventEmitter()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 事件监听</span></span><br><span class=\"line\">emitter.on(<span class=\"string\">\"connection\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"linked Success\"</span>);</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 事件触发</span></span><br><span class=\"line\">emitter.emit(<span class=\"string\">\"connection\"</span>)</span><br></pre></td></tr></table></figure><h2 id=\"FS\"><a href=\"#FS\" class=\"headerlink\" title=\"FS\"></a>FS</h2><blockquote><p>在服务端来操作文件。默认异步操作，同步 API 则只需添加 Sync，比如 readFileSync</p></blockquote><ul><li>操作文件<ul><li><strong>readFile</strong>：文件读取</li><li><strong>writeFile</strong>：文件写入</li><li><strong>appendFile</strong>：追加写入</li><li><strong>rename</strong>：文件重命名</li><li><strong>unlink</strong>：文件删除</li></ul></li><li>操作目录<ul><li><strong>mkdir</strong>：创建</li><li><strong>readdir</strong>：读取</li><li><strong>rmdir</strong>：删除空目录</li><li><strong>chmod</strong>：修改权限</li></ul></li><li>其它<ul><li><strong>stat</strong>：详细信息</li><li><strong>exists</strong>：判断存在</li></ul></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">\"fs\"</span>);</span><br><span class=\"line\">fs.stat(<span class=\"string\">'input.txt'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err, stats</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 大括号中只有一句语句时可以省略</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (err) <span class=\"keyword\">return</span> <span class=\"built_in\">console</span>.error(err) </span><br><span class=\"line\"></span><br><span class=\"line\">    stats.isFile()        <span class=\"comment\">// 是否为文件</span></span><br><span class=\"line\">    stats.isDirectory()   <span class=\"comment\">// 是否为目录</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 异步写入</span></span><br><span class=\"line\">fs.writeFile(<span class=\"string\">'input.txt'</span>, <span class=\"string\">'写入文件的内容'</span>,  <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (err) <span class=\"keyword\">return</span> <span class=\"built_in\">console</span>.error(err) </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 异步读取</span></span><br><span class=\"line\">    fs.readFile(<span class=\"string\">'input.txt'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err, data</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (err) <span class=\"keyword\">return</span> <span class=\"built_in\">console</span>.error(err) </span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">var</span> data_str = data.toString()</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h2 id=\"Stream\"><a href=\"#Stream\" class=\"headerlink\" title=\"Stream\"></a>Stream</h2><blockquote><p>本质是对 buffer 对象的高级封装，它操作的底层是 buffer 对象</p></blockquote><h3 id=\"流\"><a href=\"#流\" class=\"headerlink\" title=\"流\"></a>流</h3><div style=\"text-indent:2em\">操作系统采用数据块（chunk）的方式读取数据，每收到一次数据就存入缓存。NodeJS 应用程序有两种缓存的处理方式：第一种是先将数据全部读入内存，然后一次性从缓存中读取，这种方式对于视频等二进制大文件很容易使内存”爆仓”。第二种是采用 数据流（stream）的方式，边读取边存入。</div><div style=\"text-indent:2em;margin-top:15px\">流表示一组有序的、有起止点的字节数据的序列，但是流的数据不能一次性读取或写入。NodeJs 将关于流的操作封装到了 Stream 模块并提供了 Stream API 通过事件来实现基于流的IO操作，比如处理普通文件、网络文件 (http、net)、设备文件 (stdin、stdout)。</div><h3 id=\"流操作\"><a href=\"#流操作\" class=\"headerlink\" title=\"流操作\"></a>流操作</h3><ul><li><strong>流读取</strong>：NodeJS 不断将文件一小块内容读入缓冲区，再从缓冲区中读取内容</li><li><strong>流写入</strong>：NodeJS 不断将流数据写入内在缓冲区，待缓冲区 满后再将缓冲区写入到文件中，重复操作直到完成</li><li><strong>直接操作</strong>：readFile/read、writeFile/write 一次性读取内容或写入内存</li></ul><h3 id=\"流事件\"><a href=\"#流事件\" class=\"headerlink\" title=\"流事件\"></a>流事件</h3><blockquote><p>所有 Stream 对象 都是 EventEmitter 类的实例，读写流的不同状态时就会触发相应事件</p></blockquote><ul><li><strong>data</strong>：当有数据可读时触发</li><li><strong>end</strong>：数据已经全部读取完毕时触发</li><li><strong>error</strong>：读取或写入的过程中发生错误时触发</li><li><strong>finish</strong>：所有数据都已经被写入到底层系统时触发</li></ul><h3 id=\"流类型\"><a href=\"#流类型\" class=\"headerlink\" title=\"流类型\"></a>流类型</h3><ul><li><strong>Readable</strong>：从流中读取数据的 API，用于对外提供数据</li><li><strong>Writable</strong>：往流中写入数据的 API，用于写入数据</li><li><strong>Duplex</strong>：在流中可读写数据的 API，用于读取和写入数据</li><li><strong>Transform</strong>：在读写过程中可以修改和变换数据的 Duplex 流</li></ul><h3 id=\"流模式\"><a href=\"#流模式\" class=\"headerlink\" title=\"流模式\"></a>流模式</h3><blockquote><p>根据流中传递数据的类型来区分，一般需要在创建流时指定其模式而且不再修改，但是可以通过拼接转换流来进行模式转换并得到一个新的流</p></blockquote><ul><li><strong>Object Mode</strong>：对象模式，即流中传递的是任意类型的 Js 对象（null 除外）</li><li><strong>Buffering Mode</strong>：Buffer 模式，即流中传递的是 Buffer 对象</li></ul><h3 id=\"null-对象\"><a href=\"#null-对象\" class=\"headerlink\" title=\"null 对象\"></a>null 对象</h3><blockquote><p>在流中的作用如下</p></blockquote><ul><li>向 Writable 流中写入 null，表示数据源的数据已经写入完成，继续写入数据则会报错</li><li>从 Readable 流中读取到 null，表示所有数据已经读取完毕，流中不会再有可读取的数据</li></ul><h3 id=\"流的拼接\"><a href=\"#流的拼接\" class=\"headerlink\" title=\"流的拼接\"></a>流的拼接</h3><div style=\"text-indent:2em\">就像可以把两个水管串成一个更长的水管一样，一个 Readable 流和一个 Writable 流串起来后，所有的数据自动从 Readable 流进入 Writable 流。Readable API 提供了 pipe 方法用于流的拼接，但注意位于中间的流必须是 Duplex 流。</div><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 读取数据流</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">\"fs\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> data = <span class=\"string\">''</span></span><br><span class=\"line\"><span class=\"comment\">// 创建可读流，即将文件内容读取为流数据</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> readStream = fs.createReadStream(<span class=\"string\">'input.txt'</span>) </span><br><span class=\"line\">readStream.setEncoding(<span class=\"string\">'UTF8'</span>)  </span><br><span class=\"line\"><span class=\"comment\">// 处理流事件 --&gt; data, end, and error</span></span><br><span class=\"line\">readStream.on(<span class=\"string\">'data'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">chunk</span>) </span>&#123;</span><br><span class=\"line\">    data += chunk</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">readStream.on(<span class=\"string\">'end'</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(data)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">readStream.on(<span class=\"string\">'error'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(err.stack)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 写入流</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">\"fs\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> data = <span class=\"string\">'要写入的内容'</span></span><br><span class=\"line\"><span class=\"comment\">// 创建可写流并写入到文件中</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> writeStream = fs.createWriteStream(<span class=\"string\">'output.txt'</span>)</span><br><span class=\"line\">writeStream.write(data, <span class=\"string\">'UTF8'</span>)</span><br><span class=\"line\">writeStream.write(<span class=\"keyword\">new</span> Buffer(<span class=\"string\">'使用Stream写入二进制数据...\\n'</span>, <span class=\"string\">'utf-8'</span>));</span><br><span class=\"line\">writeStream.end()   <span class=\"comment\">// 标记文件末尾</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 处理流事件 --&gt; data, end, and error</span></span><br><span class=\"line\">writeStream.on(<span class=\"string\">'finish'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"写入完成。\"</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">writeStream.on(<span class=\"string\">'error'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(err.stack)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 管道流</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">\"fs\"</span>);</span><br><span class=\"line\"><span class=\"comment\">// 创建一个可读流</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> readStream = fs.createReadStream(<span class=\"string\">'input.txt'</span>, &#123;</span><br><span class=\"line\">        encoding:<span class=\"string\">'utf8'</span>,  <span class=\"comment\">// 不传默认buffer，显示为字符串</span></span><br><span class=\"line\">        start:<span class=\"number\">3</span>,          <span class=\"comment\">// 从索引为3的位置开始读</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">// 创建一个可写流</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> writeStream = fs.createWriteStream(<span class=\"string\">'output.txt'</span>);</span><br><span class=\"line\"><span class=\"comment\">// 管道读写操作：读取 input.txt 内容并将内容写入到 output.txt</span></span><br><span class=\"line\">readeStream.pipe(writeStream);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 链式流：链式是通过连接输出流到另外一个流并创建多个对个流操作链的机制</span></span><br><span class=\"line\"><span class=\"comment\">// 链式流一般用于管道操作。以下是用管道和链式来压缩和解压文件</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">\"fs\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> zlib = <span class=\"built_in\">require</span>(<span class=\"string\">'zlib'</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> data = <span class=\"string\">'test dfddgfdgfdgfdgfd jkwu'</span></span><br><span class=\"line\"><span class=\"comment\">// 压缩 input.txt 文件为 input.txt.gz</span></span><br><span class=\"line\">fs.createReadStream(<span class=\"string\">'input.txt'</span>)</span><br><span class=\"line\">    .pipe(zlib.createGzip())</span><br><span class=\"line\">    .pipe(fs.createWriteStream(<span class=\"string\">'input.txt.gz'</span>))</span><br><span class=\"line\"><span class=\"comment\">// 解压 input.txt.gz 文件为 input.txt</span></span><br><span class=\"line\">fs.createReadStream(<span class=\"string\">'input.txt.gz'</span>)</span><br><span class=\"line\">    .pipe(zlib.createGunzip())</span><br><span class=\"line\">    .pipe(fs.createWriteStream(<span class=\"string\">'input.txt'</span>))</span><br><span class=\"line\">        </span><br><span class=\"line\">       </span><br><span class=\"line\"><span class=\"comment\">// HTTP 对象使用 Stream 接口，实现网络数据的读写</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">'http'</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> server = http.createServer(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> body = <span class=\"string\">''</span></span><br><span class=\"line\">    req.setEncoding(<span class=\"string\">'utf8'</span>)</span><br><span class=\"line\">    req.on(<span class=\"string\">'data'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">chunk</span>) </span>&#123;</span><br><span class=\"line\">        body += chunk</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    req.on(<span class=\"string\">'end'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> data = <span class=\"built_in\">JSON</span>.parse(body);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (er) &#123;</span><br><span class=\"line\">            res.statusCode = <span class=\"number\">400</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> res.end(<span class=\"string\">'error: '</span> + er.message);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        res.write(<span class=\"keyword\">typeof</span> data);</span><br><span class=\"line\">        res.end();</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">server.listen(<span class=\"number\">8080</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 错误处理</span></span><br><span class=\"line\">http.createServer(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> stream = fs.createReadStream(<span class=\"string\">'filename.txt'</span>)</span><br><span class=\"line\">    stream</span><br><span class=\"line\">    .on(<span class=\"string\">'error'</span>, onerror)</span><br><span class=\"line\">    .pipe(zlib.createGzip())</span><br><span class=\"line\">    .on(<span class=\"string\">'error'</span>, onerror)</span><br><span class=\"line\">    .pipe(res)</span><br><span class=\"line\">  </span><br><span class=\"line\">    onFinished(res, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      stream.destroy()</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h2 id=\"util\"><a href=\"#util\" class=\"headerlink\" title=\"util\"></a>util</h2><blockquote><p>提供一系列实用方法，注意需要安装 npm install util</p></blockquote><ul><li>格式化字符串：<code>format</code></li><li>数据类型验证：<code>isDate、isArray、isError、isRegExp</code></li><li>其它：<code>inherits (继承)、inspect (对象转化为字符串)</code></li></ul><h1 id=\"五、Web-开发\"><a href=\"#五、Web-开发\" class=\"headerlink\" title=\"五、Web 开发\"></a>五、Web 开发</h1><h2 id=\"搭建-web-服务器\"><a href=\"#搭建-web-服务器\" class=\"headerlink\" title=\"搭建 web 服务器\"></a>搭建 web 服务器</h2><h3 id=\"通过插件\"><a href=\"#通过插件\" class=\"headerlink\" title=\"通过插件\"></a>通过插件</h3><blockquote><p>http-server、live-server</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install http-server -g</span><br><span class=\"line\">cd progect      <span class=\"comment\">// 进入项目目录</span></span><br><span class=\"line\">http-server     <span class=\"comment\">// 开启服务</span></span><br></pre></td></tr></table></figure><h3 id=\"通过-NodeJs\"><a href=\"#通过-NodeJs\" class=\"headerlink\" title=\"通过 NodeJs\"></a>通过 NodeJs</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">'http'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> url = <span class=\"built_in\">require</span>(<span class=\"string\">'url'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 命令行第三个参数，用来接收目录，可为空，相对当前server.js的目录名称</span></span><br><span class=\"line\"><span class=\"comment\">// 比如 node server debug，则 debug 文件夹与 server.js 文件同级并以 debug 启动服务</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> dir, arg = process.argv[<span class=\"number\">2</span>] || <span class=\"string\">''</span>; </span><br><span class=\"line\"></span><br><span class=\"line\">http.createServer(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> pathname = __dirname + url.parse(req.url).pathname;</span><br><span class=\"line\">    <span class=\"comment\">// 保存 dir (目录)</span></span><br><span class=\"line\">    dir = dir ? dir : pathname; </span><br><span class=\"line\">    <span class=\"comment\">// 替换文件静态路径</span></span><br><span class=\"line\">    pathname = dir ? pathname.replace(dir, dir + arg + <span class=\"string\">'/'</span>) : pathname; </span><br><span class=\"line\">    <span class=\"keyword\">if</span> (path.extname(pathname) == <span class=\"string\">\"\"</span>) &#123;</span><br><span class=\"line\">        pathname += <span class=\"string\">\"/\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (pathname.charAt(pathname.length - <span class=\"number\">1</span>) == <span class=\"string\">\"/\"</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 入口文件，此处默认index.html</span></span><br><span class=\"line\">        pathname += <span class=\"string\">\"index.html\"</span>; </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    fs.exists(pathname, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">exists</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (exists) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">switch</span> (path.extname(pathname)) &#123;</span><br><span class=\"line\">              <span class=\"keyword\">case</span> <span class=\"string\">\".html\"</span>:</span><br><span class=\"line\">                  res.writeHead(<span class=\"number\">200</span>, &#123;<span class=\"string\">\"Content-Type\"</span>: <span class=\"string\">\"text/html\"</span>&#125;);</span><br><span class=\"line\">                  <span class=\"keyword\">break</span>;</span><br><span class=\"line\">              <span class=\"keyword\">case</span> <span class=\"string\">\".js\"</span>:</span><br><span class=\"line\">                  res.writeHead(<span class=\"number\">200</span>, &#123;<span class=\"string\">\"Content-Type\"</span>: <span class=\"string\">\"text/javascript\"</span>&#125;);</span><br><span class=\"line\">                  <span class=\"keyword\">break</span>;</span><br><span class=\"line\">              <span class=\"keyword\">case</span> <span class=\"string\">\".css\"</span>:</span><br><span class=\"line\">                  res.writeHead(<span class=\"number\">200</span>, &#123;<span class=\"string\">\"Content-Type\"</span>: <span class=\"string\">\"text/css\"</span>&#125;);</span><br><span class=\"line\">                  <span class=\"keyword\">break</span>;</span><br><span class=\"line\">              <span class=\"keyword\">case</span> <span class=\"string\">\".gif\"</span>:</span><br><span class=\"line\">                  res.writeHead(<span class=\"number\">200</span>, &#123;<span class=\"string\">\"Content-Type\"</span>: <span class=\"string\">\"image/gif\"</span>&#125;);</span><br><span class=\"line\">                  <span class=\"keyword\">break</span>;</span><br><span class=\"line\">              <span class=\"keyword\">case</span> <span class=\"string\">\".jpg\"</span>:</span><br><span class=\"line\">                  res.writeHead(<span class=\"number\">200</span>, &#123;<span class=\"string\">\"Content-Type\"</span>: <span class=\"string\">\"image/jpeg\"</span>&#125;);</span><br><span class=\"line\">                  <span class=\"keyword\">break</span>;</span><br><span class=\"line\">              <span class=\"keyword\">case</span> <span class=\"string\">\".png\"</span>:</span><br><span class=\"line\">                  res.writeHead(<span class=\"number\">200</span>, &#123;<span class=\"string\">\"Content-Type\"</span>: <span class=\"string\">\"image/png\"</span>&#125;);</span><br><span class=\"line\">                  <span class=\"keyword\">break</span>;</span><br><span class=\"line\">              <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                  res.writeHead(<span class=\"number\">200</span>, &#123;<span class=\"string\">\"Content-Type\"</span>: <span class=\"string\">\"application/octet-stream\"</span>&#125;);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// res 可以自己添加信息来简单交互 比如可以修改 header 信息、修改返回数据</span></span><br><span class=\"line\">            fs.readFile(pathname, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err, data</span>) </span>&#123;</span><br><span class=\"line\">                res.end(data);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            res.writeHead(<span class=\"number\">404</span>, &#123;<span class=\"string\">\"Content-Type\"</span>: <span class=\"string\">\"text/html\"</span>&#125;);</span><br><span class=\"line\">            res.end(<span class=\"string\">\"Not Found\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;).listen(<span class=\"number\">9090</span>, <span class=\"string\">\"127.0.0.1\"</span>); <span class=\"comment\">// 服务器端口</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">\"server running at http://127.0.0.1:9090/\"</span>);</span><br></pre></td></tr></table></figure><h2 id=\"连接-mysql\"><a href=\"#连接-mysql\" class=\"headerlink\" title=\"连接 mysql\"></a>连接 mysql</h2><blockquote><p>安装 mysql 及其驱动：npm install mysql node-mysql -g</p></blockquote><h3 id=\"直接连接\"><a href=\"#直接连接\" class=\"headerlink\" title=\"直接连接\"></a>直接连接</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">'http'</span>)</span><br><span class=\"line\"><span class=\"keyword\">let</span> mysql = <span class=\"built_in\">require</span>(<span class=\"string\">\"mysql\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> connection = mysql.createConnection(&#123;</span><br><span class=\"line\">    host: <span class=\"string\">\"127.0.0.1\"</span>,      <span class=\"comment\">// 主机</span></span><br><span class=\"line\">    user: <span class=\"string\">\"root\"</span>,           <span class=\"comment\">// 用户名</span></span><br><span class=\"line\">    password: <span class=\"string\">\"li1993416\"</span>,  <span class=\"comment\">// 用户密码</span></span><br><span class=\"line\">    port: <span class=\"string\">\"3306\"</span>,           <span class=\"comment\">// 端口号</span></span><br><span class=\"line\">    database: <span class=\"string\">\"mysql\"</span>       <span class=\"comment\">// 数据库名</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 连接数据库</span></span><br><span class=\"line\">connection.connect(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(err)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">`mysql connect fail: <span class=\"subst\">$&#123;err&#125;</span>!`</span>);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"mysql connect success!\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 执行查询</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> str = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> sqlQuery = <span class=\"string\">\"select * from students\"</span>;</span><br><span class=\"line\">connection.query(sqlQuery, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, result</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(err)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">`SQL error: <span class=\"subst\">$&#123;err&#125;</span>!`</span>);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        str = <span class=\"built_in\">JSON</span>.stringify(result);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 返回数据</span></span><br><span class=\"line\">http.createServer(<span class=\"function\">(<span class=\"params\">req, res</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    res.end(str)</span><br><span class=\"line\">&#125;).listen(<span class=\"number\">3000</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'Server running at localhost:3000'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//关闭connection  </span></span><br><span class=\"line\">connection.end(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>)</span>&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">if</span>(err)&#123; </span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(err.toString());</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'[connection end] succeed!'</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h3 id=\"通过连接池\"><a href=\"#通过连接池\" class=\"headerlink\" title=\"通过连接池\"></a>通过连接池</h3><blockquote><p>数据库连接池负责分配、管理和释放数据库连接，它允许应用程序重复使用一个现有的数据库连接而不是再重新建立一个，用于对数据库操作的性能</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> mysql = <span class=\"built_in\">require</span>(<span class=\"string\">'mysql'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> pool = mysql.createPool(&#123;</span><br><span class=\"line\">    host: <span class=\"string\">\"127.0.0.1\"</span>,      <span class=\"comment\">// 主机</span></span><br><span class=\"line\">    user: <span class=\"string\">\"root\"</span>,           <span class=\"comment\">// 用户名</span></span><br><span class=\"line\">    password: <span class=\"string\">\"li1993416\"</span>,  <span class=\"comment\">// 用户密码</span></span><br><span class=\"line\">    port: <span class=\"string\">\"3306\"</span>,           <span class=\"comment\">// 端口号</span></span><br><span class=\"line\">    database: <span class=\"string\">\"mysql\"</span>       <span class=\"comment\">// 数据库名</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">pool.getConnection(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, connection</span>) </span>&#123;</span><br><span class=\"line\">    connection.query(<span class=\"string\">'select * from students'</span>, [], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, result</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Error: \"</span> + err.message);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        connection.release();</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(result);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h2 id=\"上传文件\"><a href=\"#上传文件\" class=\"headerlink\" title=\"上传文件\"></a>上传文件</h2><div align=\"center\"><br><img src=\"images/nodejs/node-uploadFile.png\" alt=\"Node UploadFile\"><br></div><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// server.js</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> app = express();</span><br><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">\"fs\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> bodyParser = <span class=\"built_in\">require</span>(<span class=\"string\">'body-parser'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> multer  = <span class=\"built_in\">require</span>(<span class=\"string\">'multer'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(express.static(<span class=\"string\">'public'</span>));</span><br><span class=\"line\">app.use(bodyParser.urlencoded(&#123; <span class=\"attr\">extended</span>: <span class=\"literal\">false</span> &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// dest 定义上传目录，array 限制上传类型（即 input name）　</span></span><br><span class=\"line\">app.use(multer(&#123; <span class=\"attr\">dest</span>: <span class=\"string\">'./uploads'</span>&#125;).array(<span class=\"string\">'image'</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    res.sendFile( __dirname + <span class=\"string\">\"/\"</span> + <span class=\"string\">\"index.html\"</span> );</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.post(<span class=\"string\">'/file_upload'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(req.files[<span class=\"number\">0</span>]);  <span class=\"comment\">// 上传的文件信息</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> des_file = __dirname + <span class=\"string\">\"/\"</span> + req.files[<span class=\"number\">0</span>].originalname;</span><br><span class=\"line\"></span><br><span class=\"line\">    fs.readFile( req.files[<span class=\"number\">0</span>].path, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err, data</span>) </span>&#123;</span><br><span class=\"line\">        fs.writeFile(des_file, data, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(err)&#123;</span><br><span class=\"line\">                <span class=\"built_in\">console</span>.log(err)</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                response = &#123;</span><br><span class=\"line\">                    message: <span class=\"string\">'File uploaded successfully'</span>, </span><br><span class=\"line\">                    filename: req.files[<span class=\"number\">0</span>].originalname</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log( response );</span><br><span class=\"line\">            res.end( <span class=\"built_in\">JSON</span>.stringify( response ) );</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> server = app.listen(<span class=\"number\">3000</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">\"localhost:3000\"</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 运行命令</span></span><br><span class=\"line\">npm install multer body-parser -S</span><br><span class=\"line\">node server.js</span><br></pre></td></tr></table></figure><h2 id=\"WebSocket\"><a href=\"#WebSocket\" class=\"headerlink\" title=\"WebSocket\"></a>WebSocket</h2><h3 id=\"通过-ws-模块\"><a href=\"#通过-ws-模块\" class=\"headerlink\" title=\"通过 ws 模块\"></a>通过 ws 模块</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 安装</span></span><br><span class=\"line\">cnpm i ws -S</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 客户端js</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"built_in\">window</span>.WebSocket != <span class=\"literal\">undefined</span>) &#123;  </span><br><span class=\"line\">    <span class=\"comment\">//创建一个WebSocket，监听端口6060端口，这里必须是：ws，不能是http</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> connection = <span class=\"keyword\">new</span> WebSocket(<span class=\"string\">'ws://localhost:6060'</span>); </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// readyState : 0：正在连接、1：连接成功、2：正在关闭、3：连接关闭</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(connection.readyState); </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 握手协议成功以后，readyState就从0变为1，并触发open事件  </span></span><br><span class=\"line\">    connection.onopen = <span class=\"function\">(<span class=\"params\">event</span>) =&gt;</span> &#123;   </span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(event);</span><br><span class=\"line\">        <span class=\"comment\">//连接建立后，客户端通过send方法向服务器端发送数据。   </span></span><br><span class=\"line\">        connection.send(<span class=\"string\">'client message'</span>); </span><br><span class=\"line\">    &#125;;  </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//监听  </span></span><br><span class=\"line\">    connection.onmessage = <span class=\"function\">(<span class=\"params\">event</span>) =&gt;</span> &#123;   </span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(event);  </span><br><span class=\"line\">    &#125;;  </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//关闭WebSocket连接，会触发close事件。  </span></span><br><span class=\"line\">    connection.onclose = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;   </span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Closed\"</span>);  </span><br><span class=\"line\">    &#125;;  </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//出现错误  </span></span><br><span class=\"line\">    connection.onerror = <span class=\"function\">(<span class=\"params\">event</span>) =&gt;</span> &#123;   </span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Error: \"</span> + event.data);  </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 服务器 server.js</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 启动 WebSocket 服务器</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> server = <span class=\"built_in\">require</span>(<span class=\"string\">'http'</span>).createServer() , </span><br><span class=\"line\">    WebSocketServer = <span class=\"built_in\">require</span>(<span class=\"string\">'ws'</span>).Server , </span><br><span class=\"line\">    wss = <span class=\"keyword\">new</span> WebSocketServer(&#123; <span class=\"attr\">server</span>: server &#125;) , </span><br><span class=\"line\">    app = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>)() , </span><br><span class=\"line\">    port = <span class=\"number\">6060</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用 express 中间件</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"comment\">//send用来向客户端发送信息，on用来接收/监听客户端发来的信息</span></span><br><span class=\"line\">    res.send(&#123; <span class=\"attr\">msg</span>: <span class=\"string\">\"hello\"</span> &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">// 监听事件  %s 字符串、%d 整数、%f 浮点数</span></span><br><span class=\"line\">wss.on(<span class=\"string\">'connection'</span>, <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">connection</span>(<span class=\"params\">ws</span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"comment\">//监听 </span></span><br><span class=\"line\">    ws.on(<span class=\"string\">'message'</span>, <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">incoming</span>(<span class=\"params\">message</span>) </span>&#123;  </span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'received: %s'</span>, message);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"comment\">//发送 </span></span><br><span class=\"line\">    ws.send(<span class=\"string\">'something'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">server.on(<span class=\"string\">'request'</span>, app);</span><br><span class=\"line\">server.listen(port, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'http://localhost:'</span> + server.address().port) </span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h3 id=\"通过-socket-io\"><a href=\"#通过-socket-io\" class=\"headerlink\" title=\"通过 socket.io\"></a>通过 socket.io</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 安装</span></span><br><span class=\"line\">cnpm i socket.io -S</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 客户端 js (需要引入 socket.io.js)</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> socket = io.connect(<span class=\"string\">'http://localhost:8080'</span>)  </span><br><span class=\"line\">socket.on(<span class=\"string\">'news'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">data</span>) </span>&#123;   </span><br><span class=\"line\">    socket.emit(<span class=\"string\">'event'</span>, &#123; <span class=\"attr\">my</span>: <span class=\"string\">'data'</span> &#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 服务器 server.js</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"built_in\">require</span>(<span class=\"string\">'http'</span>).createServer(handler), </span><br><span class=\"line\">    io = <span class=\"built_in\">require</span>(<span class=\"string\">'socket.io'</span>).listen(app), </span><br><span class=\"line\">    fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8080</span>);</span><br><span class=\"line\">io.set(<span class=\"string\">'log level'</span>, <span class=\"number\">1</span>)  <span class=\"comment\">// 关闭 debug 信息</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handler</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  fs.readFile(__dirname + <span class=\"string\">'/index.html'</span>,<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err, data</span>) </span>&#123;  </span><br><span class=\"line\">      <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">        res.writeHead(<span class=\"number\">500</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> res.end(<span class=\"string\">'Error loading index.html'</span>);</span><br><span class=\"line\">      &#125;    </span><br><span class=\"line\">      res.writeHead(<span class=\"number\">200</span>, &#123;<span class=\"string\">'Content-Type'</span>: <span class=\"string\">'text/html'</span>&#125;);    </span><br><span class=\"line\">      res.end(data);</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">io.sockets.on(<span class=\"string\">'connection'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">socket</span>) </span>&#123;</span><br><span class=\"line\">    socket.emit(<span class=\"string\">'news'</span>, &#123; <span class=\"attr\">hello</span>: <span class=\"string\">'world'</span> &#125;);</span><br><span class=\"line\">    socket.on(<span class=\"string\">'my other event'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">data</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(data);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h2 id=\"解决跨域\"><a href=\"#解决跨域\" class=\"headerlink\" title=\"解决跨域\"></a>解决跨域</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cnpm install cors --save</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// app.js 加入代码</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> cors = <span class=\"built_in\">require</span>(<span class=\"string\">'cors'</span>);</span><br><span class=\"line\">app.use(cors(&#123;</span><br><span class=\"line\">    origin:[<span class=\"string\">'http://localhost:8080'</span>],  <span class=\"comment\">//指定接收的地址</span></span><br><span class=\"line\">    methods:[<span class=\"string\">'GET'</span>,<span class=\"string\">'POST'</span>],            <span class=\"comment\">// 指定接收的请求类型</span></span><br><span class=\"line\">    alloweHeaders:[<span class=\"string\">'Content-Type'</span>, <span class=\"string\">'Authorization'</span>]  <span class=\"comment\">// 指定 header</span></span><br><span class=\"line\">&#125;))</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->"},{"title":"web 开发工具","top":false,"keywords":["开发工具"],"date":"2019-02-20T07:41:48.000Z","description":"电脑、浏览器、代码编辑器、前端构建工具 (Npm、Gulp、WebPack)、版本管理工具 Git","_content":"\n# 一、电脑系统 Mac\n\n## 操作系统\n  1. __Windows__\n    * 人妻，什么都有，还常附带不想要的东西。\n    * 微软的系统，基于Basic开发，是最普及的桌面系统，主要特点是功能强大但安全堪忧，适用于正常办公以及游戏。\n  2. __Mac OS/OSX__\n    * 女友，带着有面子但必须按照它的规则。\n    * 苹果系统，基于linux开发，主要特点是应用软件较少和较安全，适用于办公的高端移动化处理。\n  3. __Linux__\n    * 小萝莉，你让它干嘛就干嘛。\n    * 一种自由和开放源码的类Unix操作系统，可安装在手机电脑等各种计算机硬件设备中，主要特点是网络功能强大且对内存等硬件的消耗小，多用于网络服务器中，优点是其易用性和丰富的应用软件。\n          \n\n## 操作接口\n  1. __终端 terminal__ \n    * 用于人与计算机进行交互的输入输出接口\n    * 本质是通过电缆、网络等连接主机的外部附加设备，一台计算机可以连接个终端\n  2. __控制台 console__ \n    * 用于管理主机的特殊终端，只允许管理员使用\n    * 本质是直接和计算机相连接的原生设备，一台计算机一般只能有一个控制台\n  3. __命令解释器 shell__\n    * 提供用户界面的程序，用于与计算机内核交互\n    * 本质是 接受用户指令后，调用其他程序与内核交互完成指令\n    * 一般分为 命令行shell 和 图形shell，分别提供 命令行界面 CLI 和 图形用户界面 GUI\n    * 批处理：将一系列命令按照一定顺序集合为一个可执行的文本文件，在window系统的扩展名为 bat/cmd，双击文件即可运行\n  4. __终端与 shell 的分工__\n    * 终端从用户接受 鼠标键盘等设备的输入信息，然后发送给 shell\n    * shell 从终端获取用户指令，解析后发给计算机内核执行，并返回结果给终端\n\n\n## mac \n  1. __应用软件安装__\n    * 通过 App Stroe 安装\n    * 将浏览器中下载好的 dmg 安装包拖到\"应用程序\"目录\n  2. __系统软件安装__\n    * brew 即 Homebrew，是 Mac OSX 上的软件包管理工具，用来安装、更新、卸载软件\n    * 命令行配置环境变量：vi ~/.bash_profile - 编辑文件 - esc键退出编辑 - :wq回车保存\n  3. __实现翻墙__\n    * 配置 VPN：VPN 即虚拟专用网络，可用来保护隐私和自由访问外国网站\n    * 配置 proxy：即配置代理地址\n\n\n# 二、浏览器 chrome \n  1. __搜索__（Google输入框中所有空格都被理解为加号）\n    * 完整匹配: \"mysql foreign key\"（引号）\n    * 筛选: \"mysql key\" - \"nodejs\"（加减号）\n    * 返回所有: \"mysql connect error *\"（加通配符）\n    * 站内搜索: \"mysql foreign key\" site:stackoverflow.com\n    * 加速: 输入网址后点击Tab，这样可直接使用该站点的站内搜索\n  2. __调试js代码__\n    * Alert, Console等\n    * 断点调试\n      * 步骤：F12开发者工具 ——> 点击Sources菜单 ——> 左侧树中找到相应文件 ——> 点击行号列(右键为条件断点) ——> 刷新页面 ——> JS执行到断点位置停住，此时可以跟随鼠标查看功能按钮\n      * [相关技巧](http://blog.csdn.net/crper/article/details/50722753) \n    * debug断点\n      * 在触发文件中添加 \"debugger;\" 语句后触发，当代码执行到该语句时就会自动断点, 接下去的操作和在Sources面板添加断点调试几乎一模一样，唯一区别在于调试后需要删除该语句。\n      * 由于有时会遇到异步加载html片段的情况，其JS代码在Sources中无法找到，因此无法直接在开发工具中直接添加断点时可用debug断点（F10一步一步执行，F8一下执行完成）\n  3. __高阶调试功能__\n    * [内置抓包工具等](https://www.cnblogs.com/guaidianqiao/p/7615430.html) \n  4. __扩展插件__\n    * 谷歌访问助手\n      * 安装：[下载安装包](http://www.ggfwzs.com/) ——> 更多工具 ——> 扩展程序 ——> 直接拖拽 ——> 添加扩展程序\n      * 扩展其它插件：谷歌访问助手 ——> 谷歌网上商店 ——> 搜索插件 ——> 点击添加扩展\n    * 常用插件推荐\n      * 掘金\n      * Google翻译         \n      * FeHelper \n      * JSONView   \n      * What runs         \n      * Clear Cache\n      * Code Plunker    \n      * Vue.js devtools         \n      * AngularJS Batarang      \n      * React Developer Tools  \n  5. __Chrome黑科技__\n    * 实现翻墙\n      * 配置proxy代理：setting  system ——> proxy settings ——> LAN setting ——> proxy server ——> 配置 Address 和 Port\n      * 配置Chrome扩展：下载[Hoxx VPN Proxy](https://www.crx4chrome.com/crx/39922/) ——> 注册登录\n    * 解析VIP视频 \n      * 打开网站 [Greasy Fork](https://greasyfork.org/zh-CN) ——> 搜索VIP视频解析 ——> 安装脚本\n    * 其它：视频广告过滤、电脑管家上网防护等\n\n\n\n# 三、代码编辑器 vscode\n> 常用扩展插件\n\n  * 显示效果类\n    * Dracula Official ：高亮主题\n    * Beautify ：代码高亮\n    * vscode-icon ：让资源树目录加上图标\n    * Bracket Pair Colorizer ：每一对括号用不同颜色区别\n    * Open-In-Browser ：直接在浏览器中打开文件的快捷菜单 alt + b\n  * 辅助编辑类\n    * ESlint ：检测js\n    * Prettier ：代码格式化 alt + shift + F \n    * CSS Peek ：追踪至定义处（右键选择前两个选项）\n    * Path Intellisense ：自动补全路径\n    * Auto Close Tag ：自动闭合HTML标签\n    * Auto Rename Tag ：自动修改匹配的标签\n    * HTML CSS Support ：CSS的智能补全\n    * JavaScript (ES6) code snippets ：JS语法提示\n  * Vue插件类\n    * Vetur ：语法高亮\n    * VueHelper ：vue代码提示插件\n    * Vue 2 Snippets ：语法高亮 + 代码补全\n    * HTML Snippets ：在.vue文件中使用html代码补全功能\n  *  其它类\n    * npm ：运行npm命令\n    * npm Intellisense ：导入时提示已安装模块\n    * Python ：添加对.py文件的支持\n    * GitLens ：简单实现git提交代码\n    * Debugger for chrome ：调试Debug\n    \n\n  ```js\n  // vscode 基础配置\n\n  // 配置中文：ctrl + shift + p --> Display Language\n      \"locale\":\"zh-CN\"\n\n  // 用户配置：文件 --> 首选项 --> 设置 --> User Settings\n      // 指定工作台中使用的颜色主题。    \n      \"workbench.colorTheme\": \"Monokai\",    \n      // 指定在工作台中使用的图标主题    \n      \"workbench.iconTheme\": \"vscode-icons\",    \n      // 窗口失去焦点自动保存    \n      \"files.autoSave\": \"off\",    \n      // 如果设置为 \"true\"，将不再显示扩展建议的通知。   \n      \"extensions.ignoreRecommendations\": true,    \n      // 如果设置成 true，关于新的版本消息将不再显示    \n      \"vsicons.dontShowNewVersionMessage\": true,    \n      // 控制是否将打开的编辑器显示为预览。    \n      \"workbench.editor.enablePreview\": false,   \n      // 字体字号\n      \"editor.fontSize\": 18, \n      //代码缩进风格4个字符    \n      \"editor.tabSize\": 4,    \n      // 控制编辑器是否应在键入后自动设置行的格式    \n      \"editor.formatOnType\": false,    \n      // 保存时取消自动格式化    \n      \"editor.formatOnSave\": false,    \n      // 编辑粘贴取消自动格式化    \n      \"editor.formatOnPaste\": false,    \n      // 控制编辑器中呈现空白字符的方式为“边界”，不会在单词之间呈现单空格。    \n      \"editor.renderWhitespace\": \"boundary\",    \n      // 控制光标动画样式    \n      \"editor.cursorBlinking\": \"smooth\",    \n      //设置Eslint需要验证的语言    \n      \"eslint.validate\": [        \n          \"javascript\",        \n          \"javascriptreact\",        \n          \"html\",        \n          \"vue\",        \n          {            \n              \"language\": \"vue\",            \n              \"autoFix\": true        \n          }\n      ],\n      //每列显示内容长多，超出时控制编辑器列的换行。\n      \"editor.wordWrap\": \"wordWrapColumn\",\n      \"editor.wordWrapColumn\": 150,\n      //创建人，修改人    \n      \"fileheader.Author\": \"klierbyck\",    \n      \"fileheader.LastModifiedBy\": \"klierbyck\",    \n      // 在函数参数括号前定义空格处理。需要 TypeScript >= 2.1.5。    \n      \"typescript.format.insertSpaceBeforeFunctionParenthesis\": true,    \n      // 在函数参数括号前定义空格处理。需要 TypeScript >= 2.1.5。    \n      \"javascript.format.insertSpaceBeforeFunctionParenthesis\": true,\n      // HTML Snippets 插件配置\n      \"emmet.triggerExpansionOnTab\": true,\n      \"emmet.includeLanguages\": {\n          \"vue-html\": \"html\",\n          \"vue\": \"html\"\n      },\n  ```\n      \n\n\n# 四、前端自动化构建\n\n## 构建需求\n\n  1. __预处理__\n    <div style=\"text-indent: 2em\">低层语言的更换或升级都因兼容性问题而面临着巨大困难，这催生了各种中间语言的预处理器，例如 通过 Babel 将 ES6 转换成可以在浏览器中运行的 js代码，通过 Sass/Less/Stylus 可以在线编程并转换成 css代码。</div> \n\n  2. __风格与测试__\n    <div style=\"text-indent: 2em\">在一个典型的工作流中，每次Push主分支或npm发布都应首先运行代码风格检查和单元测试。我们需要这些操作能够在合适的时候自动执行。</div> \n\n  3. __资源压缩__\n    <div style=\"text-indent: 2em\">在开发网站代码时，我们希望模块化地进行编码，即每个业务逻辑、通用工具或者架构元素都需要组织在单独的文件中。但是如果用户浏览网页时也载入这么多源文件则会影响页面打开速度，因此在网站发布时需要将源码合并压缩，js可能还需要模块化，CSS文件可能还需要合并、添加兼容性前缀等，这些重复性工作我们也希望写成脚本。   </div> \n\n  4. __静态资源的URL替换__\n    <div style=\"text-indent: 2em\">该需求最复杂, 因为生产环境中的资源地址可能和开发环境中很不同，可能是由于JS合并、CSS合并，也可能是由于应用了CDN加速。我们需要在部署时更改所有HTML文件中的静态资源地址。</div> \n\n\n## 构建工具\n<div style=\"text-indent: 2em\">\"自动化构建\"是指通过工具实现构建系统、编译和转换代码、压缩资源、部署配置等功能，优化\"从源码到网页\"的开发流程，这有利于提高开发效率并改善代码质量。</div>\n<div style=\"text-indent: 2em\">所有的开发工具都是为了使大量低技术含量任务完成自动化从而减轻工作，它们的组合使用完全看个人选择。开发过程一般会以Node和npm为核心，然后搭配 Gulp + Bower 或者 Webpack。</div>\n\n  1. __执行通用任务__\n    * NPM / Bower：基于NodeJS的包管理和分发工具，用来下载、安装、上传以及管理已经安装的包\n    * Gulp / Grunt：基于NodeJS的自动化构建工具，用来自动化完成一些常见的、重复的Web开发任务，如网页自动刷新和预处理等。两者最大区别是Gulp采取流式接口。\n  2. __模块绑定__\n    * Webpack：前端资源模块化管理和打包工具，用来配置各种模块所需要的处理方式，常见配置有 scss 代码预处理、ES6 代码转换、模块打包的规则和地址等\n    * Browserify：打包工具，常用于将 Node 项目模块打包成浏览器支持形式\n    * RequireJS：Js模块加载器，常用于 NodeJS 中加载模块\n  3. __代码分析__\n    * ESLint / JSLint：检测工具，常用于分析代码中潜在错误。\n  4. __单元测试__\n    * Jasmine：测试工具，常用于测试自己的代码\n\n\n  \n# 五、安装工具 NPM\n## 使用场景\n  * 从NPM服务器下载别人编写的三方包到本地使用\n  * 从NPM服务器下载并安装别人编写的命令行程序到本地使用\n  * 将自己编写的包或命令行程序上传到NPM服务器供别人使用\n\n\n## 常用命令\n  ```js\n  npm -v                    //查看npm版本\n  npm list                  //当前目录已安装插件\n  npm init                  //生成package.json文件\n\n  npm i <name> -g           //安装包\n  npm uninstall <name>      //卸载包\n  npm update <name>         //更新包   \n  /**\n    * 可添加的修饰符\n    *     -g                 全局(不加则为本地安装)\n    *     -S / --save        需要发布到生产环境的依赖(默认)\n    *     -D / --save-dev    只用于开发环境的依赖\n    *     --no-save          不写入package.json的依赖\n    */\n\n  npm run script-key        // 执行package.json中 \"scripts\" 选项对应的js \n  npm start                 // 比较特殊\n  ```\n\n## 发布npm包\n\n  ```js\n  cd test                 // 选择目标文件夹\n  npm init                // 配置包的相关信息\n  module.exports = 1      // 编辑包 test/index.js\n\n  npm adduser             // 注册，第一次发布包\n  npm login               // 登录，非第一次发布包\n\n  npm publish            // 发布/更新包\n  npm install 包名        // npm官网搜索后验证下载\n\n  // 撤销发布的包要用force强制删除。超过24小时就不能删除了\n  npm --force unpublish 包名    \n  ```\n\n\n# 六、构建工具 Gulp\n\n## 常用插件\n  * gulp-minify-html：压缩html\n  * gulp-minify-css：压缩css\n  * gulp-uglify：压缩js\n  * gulp-smushit：压缩图片\n  * gulp-concat：文件合并\n  * gulp-rename：重命名\n  * gulp-babel：编译ES6\n  * gulp-sass/less：css预处理\n  * gulp-autoprefixer：自动添加css前缀\n  * browser-sync：自动刷新页面(非gulp插件)\n\n\n## API\n  * task：创建任务\n  * run：运行任务\n  * watch：监听任务\n  * src：设置需处理的文件路径(正则/数组)\n  * dest：设置生成文件的路径，一个任务可有多个生成路径\n\n\n## 设置任务\n  1. __服务器__\n    ```js\n    var gulp = require('gulp'),\n        browserSync = require('browser-sync');\n    // 1.搭建静态服务器\n    gulp.task('browser-sync', function () {\n        browserSync.init({\n            files:['**'],\n            server:{\n                baseDir:'./',             // 服务器的根目录\n                index:'blink/blink.html'  // 默认打开的文件\n            },\n            port:8050  // 指定访问服务器的端口号\n        });\n    });\n    // 2.使用代理（注意本地服务器必须自己搭建的）\n    gulp.task('browser-sync', function () {\n        browserSync.init({\n            files:['**'],\n            proxy:'localhost',  // 本地服务器的地址\n            port:8080           // 访问的端口号\n        });\n    });\n    ```\n  \n  2. __默认任务__\n    ```js\n    gulp.task('default',['serve']);  \n    gulp.task('server',['sass','mihtml','minijs'],function(){\n        bs.init({\n            open:'external',\n            server:'./build'  //服务根目录\n        })\n        // 监听html\n        gulp.watch('./html/*.html',['mihtml'])\n        gulp.watch('./build/html/*.html').on('change',reload)\n    }) \n      \n\n    gulp.task('default', function(){\n        gulp.run('lint', 'sass', 'scripts');\n          // 监听sass文件变化\n        gulp.watch('src/sass/*.sass', function(){\n            gulp.run('lint', 'sass', 'scripts');\n        });\n    });\n    ```\n\n## 基础使用\n  1. __初始化目录__\n    ```js\n    ├── app              // 工作目录：源文件\n    │   ├── js\n    │   ├── Sass\n    │   └── index.html\n    │\n    ├── dist            // 目标目录：编译、压缩后的文件\n    └── release         // 可以发布到服务器的文件目录\n\n\n    cnpm install gulp -g  // 全局安装，执行gulp任务\n    cd GulpTest \n    cnpm init      // 生成package.json文件\n    cnpm install gulp -S  // 本地安装，使用gulp插件并避免版本冲突\n    gulp -v       // 查看版本\n    ```\n  \n  2. __编写配置文件 gulpfile.js__\n    ```js\n    var gulp = require('gulp');\n\n    var sass = require('gulp-sass');        //编译sass\n    var maps = require('gulp-sourcemaps');  //在浏览器显示scss样式以便调试\n    var autoprefixer = require('gulp-autoprefixer');  //自动添加前后缀\n\n    var htmlmin = require('gulp-htmlmin');  //html压缩\n    var uglify = require('gulp-uglify');    //压缩js文件\n    var smushit = require('gulp-smushit');  //图片压缩\n\n    var concat = require('gulp-concat');    //文件合并\n    var babel = require('gulp-babel');      //将ES6代码编译成ES5\n\n    var bs = require('browser-sync').create();  //页面同步\n    var reload = bs.reload;\n\n\n    // 默认任务\n    gulp.task('default', ['server'])\n\n    // 打包任务\n    // gulp.task('build', ['html', 'css', 'less', 'js'])\n\n    // sass 任务\n    gulp.task('sass', function(){\n      return gulp.src('./src/scss/*.scss')  // 导入文件\n        .pipe(maps.init())        // 将页面样式定义到scss\n          // 转译scss到css,报错时输出错误信息,不终止程序运行 \n        .pipe(sass({\"outputStyle\": \"compressed\"}).on('error', sass.logError))\n                                    \n        .pipe(autoprefixer())       // 自动添加前后缀\n        .pipe(maps.write('./'))     // 生成map文件（和css文件放在一起）\n        .pipe(gulp.dest('./dist/css'))    // 将生成的文件放到css文件夹中\n        .pipe(reload({stream:true}))       \n        // 任务完成后（监听关闭后），再有修改时重新启动监听时会重新执行以防报错\n    })\n\n    // 压缩 html \n    gulp.task('mihtml', function(){\n      var options = {\n            removeComments: true,     // 清除HTML注释\n            collapseWhitespace: true, // 压缩HTML\n            minfyJS: true,     // 压缩JS\n            minfyCss: true,    // 压缩CSS\n        };\n        return gulp.src('./src/html/*.html')  \n            .pipe(htmlmin(options))  \n            .pipe(gulp.dest('./dist/html/'))\n    })\n\n    // 压缩 js \n    gulp.task('minijs', function() {   \n        gulp.src('!./src/js/*.js')       // !表示除了...之外 \n        .pipe(babel())\n        .pipe(uglify())//压缩  \n        // .pipe(concat('all.min.js'))   //合并到all.min.js中  \n        .pipe(gulp.dest('./dist/js/'));  //指定目录  \n    }); \n\n    // 压缩 img \n    gulp.task('img', function () {\n        return gulp.src('./src/img/*.*')\n            .pipe(smushit({\n                verbose: true\n            }))\n            .pipe(gulp.dest('./dist/img/'));\n    });\n    //生成服务并自动化监听项目\n    gulp.task('server', ['sass','mihtml','minijs'], function(){\n        bs.init({\n          open: 'external',  //启动时自动打开的网址(local打开本地主机网址)\n          server: './dist/html' //设置根目录dist(默认打开其中index.html)\n          /*\n            默认打开 test.html\n            baseDir: \"./\",\n            index: \"test.html\"\n          */\n        })\n        // 监听html\n        gulp.watch('./src/html/*.html', ['mihtml'])\n        gulp.watch('./dist/html/*.html').on('change', reload)\n        //监听scss\n        gulp.watch('./src/scss/*.scss',['sass']);\n        gulp.watch('./dist/css/*.css').on('change', reload)\n        //监听js\n        gulp.watch('./src/js/*.js', ['minijs'])\n        gulp.watch('./dist/js/*js').on('change', reload)\n    })\n    ```\n\n  3. __运行gulp__\n    ```json\n    // 定义 package.json 文件中的 scripts\n    \"scripts\": {\n      \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\",\n      \"start\": \"gulp dev\",                   //执行gulp dev命令\n      \"clean\": \"rimraf dist\",                // 清空删除dist中所有文件\n      \"build\": \"rimraf dist && gulp build\"   // 执行两个命令，先清空dist再重新打包\n    },\n    //注意先全局安装rimraf: npm install rimraf -g\n    ```\n\n\n# 七、打包工具 Webpack\n\n## 模块打包工具\n<div style=\"text-indent: 2em\">分析项目结构，找到Js模块和浏览器不能直接运行的拓展语言（Scss、TypeScript 等），并将其转换和打包为合适的格式供浏览器使用。在很多场景下可以替代Gulp/Grunt类的工具，工作流程如下：</div>  \n\n  * Gulp/Grunt：在一个配置文件中，指定对某些文件进行编译、组合、压缩等任务的具体步骤，工具会自动替你完成这些任务。\n  * Webpack：把项目当做一个整体，从一个给定主文件(如index.js)开始找到项目的所有依赖文件，使用loaders处理它们，把所有的非js资源(css/img等)都转换成 js，然后用 CommonJS 的机制管理起来。\n\n\n## 核心概念\n  * 入口（entry）：即要编译的文件。指定后webpack会自行寻找依赖的文件打包编译\n  * 输出（output）：编译转换好之后的文件写入位置\n  * 加载器（loader）：转换scss、ES6等不同类型的文件，从而可以在浏览器中运行\n  * 插件（plugin）：完成压缩文件等loader无法解决的功能\n\n\n## 基础使用\n  1. __初始化目录__\n    ```js\n    WebTest\n      ├── app              // 工作目录：源文件\n      │   ├── main.js\n      │   └── hello.js\n      │\n      ├── dist            // 目标目录：打包生成的 js 文件\n      │   └── index.html\n      │\n      ├── node_moudles\n      └── package.json \n\n    // index.html\n    div id=\"app\"         \n    script src=\"bundle.js\"\n\n    // hello.js\n    moudle.exports = \"hello world\"\n\n    // main.js\n    const str = require(\"./hello.js\")\n    document.querySelector(\"#app\").appendChild(str)\n\n    // 打包执行\n    webpack app/main.js dist/bundle.js\n\n\n    cd WebTest                          \n    cnpm install -g webpack   // 全局安装\n    cnpm install -S webpack   // 本地安装\n    cnpm init                 // 新建package.json\n  ```\n\n  2. __基础配置__\n  <div style=\"text-indent: 2em\">在项目根目录下新建 webpack.config.js 文件并配置选项，配置后在终端里执行 webpack 就会被自动引用。项目开发时可以创建多个配置文件：webpack.dev.config.js 和 webpack.pub.config.js 分别用于开发和生产环境，不过运行时需要使用命令 webpack --config webpack.dev.config.js</div>  \n\n  ```js\n  // webpack.config.js\n  module.exports = {\n    entry: __dirname + '/app/main.js', // 唯一入口文件\n    output: {\n        filename: 'bundle.js',         // 输出文件名\n        path: __dirname + \"/dist\",     // 输出文件存放地址\n        // path: path.resolve(__dirname, 'dist') \n      }\n  }\n  ```\n\n  ```json\n  // package.json文件中的scripts选项配置快捷执行方法\n  \"scripts\": {\n    \"dev\":\"webpack --config webpack.dev.config.js\",\n    \"pub\":\"webpack --config webpack.pub.config.js\",\n    \"start\": \"webpack\",\n    \"server\": \"webpack-dev-server --inline\" \n  }\n  ```\n\n\n## 高级配置\n\n### 配置 Babel\n  * 功能：将 ES6、jsx等语法编译为浏览器能够运行的js\n  * 配置：webpack.config.js 或单独的 .babelrc 文件（webpack会自动调用）\n\n  \n### 生成 Source Maps\n<div style=\"text-indent: 2em\">有时打包后文件出错了，却不容易找到对应代码的位置，而通过配置 devtool 选项后，webpack 就可以在打包时生成 source maps，这为我们提供了一种对应编译文件和源文件的方法，使得编译后的代码可读性更高，也更容易调试。可选的四种配置如下：</div>  \n\n  * source-map：完整且功能完全的单独文件，但会减慢打包速度\n  * cheap-module-source-map：不带列映射，只能对应到具体的行\n  * eval-source-map：不影响速度且完整，但有隐患，可开发不可生产阶段\n  * cheap-module-eval-source-map：生成Source Map最快且和js同行，不利于调试，推荐在大型项目考虑时间成本时使用\n\n\n### 构建本地服务器\n<div style=\"text-indent: 2em\">Webpack 提供一个可选的本地开发服务器 webpack-dev-server，它基于 Node.js 构建而且可以实现浏览器监听代码修改并自动刷新等效果，配置前需要通过 npm 安装它作为项目依赖。</div> \n\n```js\nmodule.exports = {\n    entry: __dirname + '/app/main.js',\n    output: {\n        path: path.resolve(__dirname, 'dist'),\n        filename: 'bundle.js'\n    },\n    devServer: {\n        contentBase: \"./dist\",    // 加载页面的所在目录\n        historyApiFallback: true, // 不跳转\n        inline: true,   // 实时刷新\n        hot: true  // 热更新，即不刷新浏览器的前提下刷新页面\n    }\n}\n\n// 配置后执行 npm run server \n```\n\n\n\n# 八、版本管理工具 Git\n\n## Git 和 Svn\n  1. Svn：集中式管理工具。所有版本文件都集中存放到一个服务器上，所有开发者都从该服务器上更新或上传修改代码，注意需要连网。\n  2. Git：分布式管理工具，分布式指每台电脑都是一个版本仓库，但在实际工作中一般会有一个集中的服务中心 Github。与集中式的最大区别在于开发者可以离线在本地提交, 只需在连网时push到相应的服务器或其他用户, 而且每个开发者通过克隆(git clone)可以在本地机器上拷贝一个完整的Git仓库。</div>\n\n\n## Git 和 Github的关系\n  1. Git：指定了remote链接和用户信息（用户名+邮箱）之后，git可以帮你将提交过到你本地分支的代码push到远程的git仓库（任意提供了git托管服务的服务器上都可以，包括你自己建的服务器 或者 GitHub等网站提供的服务器）或者将远程仓库的代码 fetch 到本地。</div>\n  2. Github：只是一个提供存储空间的服务器，用来存储git仓库。当然现在Github已经由一个存放git仓库的网站空间发展为了一个开源社区（不只具有存储git仓库的功能了），你可以参与别人的开源项目，也可以让别人参与你的开源项目。</div>\n\n\n## 工作流程\n<div style=\"text-indent: 2em\">开发者在自己的机器上更新服务器上的最新代码，然后根据需要创建分支，在该分支上提交本地修改的代码到远程仓库并通知主开发者合并代码。如果主开发者发现代码有冲突则让开发者修改后重新提交，没有冲突则合并代码。注意本地的 .git文件是指本地仓库，.git目录下存放着所有文件的版本和关联信息但默认隐藏。开发流程图如下</div>\n<div align=\"center\">\n  ![工作流程图](images/web/git_work.png)\n</div> \n\n## 常用命令\n<div align=\"center\">\n<!-- git_order.png -->\n![常用命令图](images/web/git_order.png)\n</div> \n\n## 基础配置\n```js\ngit config --global --list         //查看全局配置\ngit config --global user.name \"chuanggefighting\"    //设置用户名\ngit config --global user.email \"17621538916@163.com\"    //设置邮箱\n```\n\n## ssh密钥配置\n<div style=\"text-indent: 2em\">Git使用https协议，每次pull/push都要输入密码比较麻烦，而使用git协议后使用ssh密钥，这样可以省去每次都输密码。配置步骤如下：</div>\n\n  1. 检测SSH keys是否存在：cd ~/.ssh\n  2. 创建ssh key(生成密钥对)：ssh-keygen -t rsa -C \"17621538916@163.com\"\n    * 此时会提示自定义名称和push时的密码 (不是git登录密码), 一般推荐略过(直接三个回车), 如果看到成功保存信息则说明如果创建成功\n\n  3. 添加公钥到github等个人的远程仓库\n    1. 查看生成的公钥：cat ~/.ssh/id_rsa.pub \n    2. 登陆github：点击头像 --> Settings --> 左栏点击SSH and GPG keys --> 点击 New SSH key --> 复制上面的公钥内容，粘贴进\"Key\"，title自定义 --> 点击 Add key \n    3. 测试SSH的连接：ssh -T git@github.com   \n    4. 输入yes后可看到信息\n              \n\n## 工作提交代码\n  ```js\n    /**\n      *  远程分支   -->  本地分支\n      *  orgin/master --> master\n      *  orgin/dev/t_lishi/xx --> dev/t_lishi/xx\n      */\n\n    git fetch --all        //更新远程修改但不会merge\n    git reset --hard orgin/master  //强制更新(慎用)\n\n    git pull orgin master  // 拉取代码到本地并合并到本地\n\n\n    git branch            // 查看本地分支\n    git checkout master   //切换到主分支分支\n\n    git branch -D BranchName    // 删除本地分支(--delete/-d)\n    git branch -r -D origin/BranchName  // 删除远程分支\n    git push origin :BranchName   // 删除远程分支简单方法\n\n    git checkout -b dev/t_lishi/Navigation  // 创建并切换到该分支          \n    // 相当于以下两个命令的合并\n    git branch branchName     新建    \n    git checkout branchName   切换\n\n    git push origin dev/t_lishi/Navigation  // 推送到远端\n    git branch -a      // 查看远程分支\n\n    // 修改某个文件后操作\n    git status  查看状态\n    git add TaskDoc/t_lishi.log  // 指定需要提交到本地仓库的文件\n    git status \n    git commit -m \"create Navigation\"      提交代码到本地\n    git push origin dev/t_lishi/Navigation    推送到远程仓库\n  ```\n\n\n## 把个人网页挂到 Github\n  1. __Github 上建立仓库，比如 resume__\n  2. __进入新建仓库并选择 “settings” 进行仓库设置，滚动到页面底部 “Github Pages” 部分__\n    * Source -- master branch，保存后就会自动生成网址\n    * 生成网址拼接文件路径后访问：chuanggefighting.github.io/resume/dist/index.html\n  3. __将仓库代码克隆到本地__\n    * 删除除了 .git 以外的其他文件，然后通过以下命令测试\n    ```js\n    git add *               // 添加到暂存区\n    git commit -m 'del'     // 上传到本地仓库\n    git push origin master  // 上传到远程仓库\n    ```\n  4. __更新个人代码到远程仓库__\n\n","source":"_posts/3-web工具.md","raw":"---\ntitle: web 开发工具\ntags:\n  - Skill\ncategories: Web Skills\ntop: false\nkeywords:\n  - 开发工具\ndate: 2019-02-20 15:41:48\ndescription: 电脑、浏览器、代码编辑器、前端构建工具 (Npm、Gulp、WebPack)、版本管理工具 Git\n---\n\n# 一、电脑系统 Mac\n\n## 操作系统\n  1. __Windows__\n    * 人妻，什么都有，还常附带不想要的东西。\n    * 微软的系统，基于Basic开发，是最普及的桌面系统，主要特点是功能强大但安全堪忧，适用于正常办公以及游戏。\n  2. __Mac OS/OSX__\n    * 女友，带着有面子但必须按照它的规则。\n    * 苹果系统，基于linux开发，主要特点是应用软件较少和较安全，适用于办公的高端移动化处理。\n  3. __Linux__\n    * 小萝莉，你让它干嘛就干嘛。\n    * 一种自由和开放源码的类Unix操作系统，可安装在手机电脑等各种计算机硬件设备中，主要特点是网络功能强大且对内存等硬件的消耗小，多用于网络服务器中，优点是其易用性和丰富的应用软件。\n          \n\n## 操作接口\n  1. __终端 terminal__ \n    * 用于人与计算机进行交互的输入输出接口\n    * 本质是通过电缆、网络等连接主机的外部附加设备，一台计算机可以连接个终端\n  2. __控制台 console__ \n    * 用于管理主机的特殊终端，只允许管理员使用\n    * 本质是直接和计算机相连接的原生设备，一台计算机一般只能有一个控制台\n  3. __命令解释器 shell__\n    * 提供用户界面的程序，用于与计算机内核交互\n    * 本质是 接受用户指令后，调用其他程序与内核交互完成指令\n    * 一般分为 命令行shell 和 图形shell，分别提供 命令行界面 CLI 和 图形用户界面 GUI\n    * 批处理：将一系列命令按照一定顺序集合为一个可执行的文本文件，在window系统的扩展名为 bat/cmd，双击文件即可运行\n  4. __终端与 shell 的分工__\n    * 终端从用户接受 鼠标键盘等设备的输入信息，然后发送给 shell\n    * shell 从终端获取用户指令，解析后发给计算机内核执行，并返回结果给终端\n\n\n## mac \n  1. __应用软件安装__\n    * 通过 App Stroe 安装\n    * 将浏览器中下载好的 dmg 安装包拖到\"应用程序\"目录\n  2. __系统软件安装__\n    * brew 即 Homebrew，是 Mac OSX 上的软件包管理工具，用来安装、更新、卸载软件\n    * 命令行配置环境变量：vi ~/.bash_profile - 编辑文件 - esc键退出编辑 - :wq回车保存\n  3. __实现翻墙__\n    * 配置 VPN：VPN 即虚拟专用网络，可用来保护隐私和自由访问外国网站\n    * 配置 proxy：即配置代理地址\n\n\n# 二、浏览器 chrome \n  1. __搜索__（Google输入框中所有空格都被理解为加号）\n    * 完整匹配: \"mysql foreign key\"（引号）\n    * 筛选: \"mysql key\" - \"nodejs\"（加减号）\n    * 返回所有: \"mysql connect error *\"（加通配符）\n    * 站内搜索: \"mysql foreign key\" site:stackoverflow.com\n    * 加速: 输入网址后点击Tab，这样可直接使用该站点的站内搜索\n  2. __调试js代码__\n    * Alert, Console等\n    * 断点调试\n      * 步骤：F12开发者工具 ——> 点击Sources菜单 ——> 左侧树中找到相应文件 ——> 点击行号列(右键为条件断点) ——> 刷新页面 ——> JS执行到断点位置停住，此时可以跟随鼠标查看功能按钮\n      * [相关技巧](http://blog.csdn.net/crper/article/details/50722753) \n    * debug断点\n      * 在触发文件中添加 \"debugger;\" 语句后触发，当代码执行到该语句时就会自动断点, 接下去的操作和在Sources面板添加断点调试几乎一模一样，唯一区别在于调试后需要删除该语句。\n      * 由于有时会遇到异步加载html片段的情况，其JS代码在Sources中无法找到，因此无法直接在开发工具中直接添加断点时可用debug断点（F10一步一步执行，F8一下执行完成）\n  3. __高阶调试功能__\n    * [内置抓包工具等](https://www.cnblogs.com/guaidianqiao/p/7615430.html) \n  4. __扩展插件__\n    * 谷歌访问助手\n      * 安装：[下载安装包](http://www.ggfwzs.com/) ——> 更多工具 ——> 扩展程序 ——> 直接拖拽 ——> 添加扩展程序\n      * 扩展其它插件：谷歌访问助手 ——> 谷歌网上商店 ——> 搜索插件 ——> 点击添加扩展\n    * 常用插件推荐\n      * 掘金\n      * Google翻译         \n      * FeHelper \n      * JSONView   \n      * What runs         \n      * Clear Cache\n      * Code Plunker    \n      * Vue.js devtools         \n      * AngularJS Batarang      \n      * React Developer Tools  \n  5. __Chrome黑科技__\n    * 实现翻墙\n      * 配置proxy代理：setting  system ——> proxy settings ——> LAN setting ——> proxy server ——> 配置 Address 和 Port\n      * 配置Chrome扩展：下载[Hoxx VPN Proxy](https://www.crx4chrome.com/crx/39922/) ——> 注册登录\n    * 解析VIP视频 \n      * 打开网站 [Greasy Fork](https://greasyfork.org/zh-CN) ——> 搜索VIP视频解析 ——> 安装脚本\n    * 其它：视频广告过滤、电脑管家上网防护等\n\n\n\n# 三、代码编辑器 vscode\n> 常用扩展插件\n\n  * 显示效果类\n    * Dracula Official ：高亮主题\n    * Beautify ：代码高亮\n    * vscode-icon ：让资源树目录加上图标\n    * Bracket Pair Colorizer ：每一对括号用不同颜色区别\n    * Open-In-Browser ：直接在浏览器中打开文件的快捷菜单 alt + b\n  * 辅助编辑类\n    * ESlint ：检测js\n    * Prettier ：代码格式化 alt + shift + F \n    * CSS Peek ：追踪至定义处（右键选择前两个选项）\n    * Path Intellisense ：自动补全路径\n    * Auto Close Tag ：自动闭合HTML标签\n    * Auto Rename Tag ：自动修改匹配的标签\n    * HTML CSS Support ：CSS的智能补全\n    * JavaScript (ES6) code snippets ：JS语法提示\n  * Vue插件类\n    * Vetur ：语法高亮\n    * VueHelper ：vue代码提示插件\n    * Vue 2 Snippets ：语法高亮 + 代码补全\n    * HTML Snippets ：在.vue文件中使用html代码补全功能\n  *  其它类\n    * npm ：运行npm命令\n    * npm Intellisense ：导入时提示已安装模块\n    * Python ：添加对.py文件的支持\n    * GitLens ：简单实现git提交代码\n    * Debugger for chrome ：调试Debug\n    \n\n  ```js\n  // vscode 基础配置\n\n  // 配置中文：ctrl + shift + p --> Display Language\n      \"locale\":\"zh-CN\"\n\n  // 用户配置：文件 --> 首选项 --> 设置 --> User Settings\n      // 指定工作台中使用的颜色主题。    \n      \"workbench.colorTheme\": \"Monokai\",    \n      // 指定在工作台中使用的图标主题    \n      \"workbench.iconTheme\": \"vscode-icons\",    \n      // 窗口失去焦点自动保存    \n      \"files.autoSave\": \"off\",    \n      // 如果设置为 \"true\"，将不再显示扩展建议的通知。   \n      \"extensions.ignoreRecommendations\": true,    \n      // 如果设置成 true，关于新的版本消息将不再显示    \n      \"vsicons.dontShowNewVersionMessage\": true,    \n      // 控制是否将打开的编辑器显示为预览。    \n      \"workbench.editor.enablePreview\": false,   \n      // 字体字号\n      \"editor.fontSize\": 18, \n      //代码缩进风格4个字符    \n      \"editor.tabSize\": 4,    \n      // 控制编辑器是否应在键入后自动设置行的格式    \n      \"editor.formatOnType\": false,    \n      // 保存时取消自动格式化    \n      \"editor.formatOnSave\": false,    \n      // 编辑粘贴取消自动格式化    \n      \"editor.formatOnPaste\": false,    \n      // 控制编辑器中呈现空白字符的方式为“边界”，不会在单词之间呈现单空格。    \n      \"editor.renderWhitespace\": \"boundary\",    \n      // 控制光标动画样式    \n      \"editor.cursorBlinking\": \"smooth\",    \n      //设置Eslint需要验证的语言    \n      \"eslint.validate\": [        \n          \"javascript\",        \n          \"javascriptreact\",        \n          \"html\",        \n          \"vue\",        \n          {            \n              \"language\": \"vue\",            \n              \"autoFix\": true        \n          }\n      ],\n      //每列显示内容长多，超出时控制编辑器列的换行。\n      \"editor.wordWrap\": \"wordWrapColumn\",\n      \"editor.wordWrapColumn\": 150,\n      //创建人，修改人    \n      \"fileheader.Author\": \"klierbyck\",    \n      \"fileheader.LastModifiedBy\": \"klierbyck\",    \n      // 在函数参数括号前定义空格处理。需要 TypeScript >= 2.1.5。    \n      \"typescript.format.insertSpaceBeforeFunctionParenthesis\": true,    \n      // 在函数参数括号前定义空格处理。需要 TypeScript >= 2.1.5。    \n      \"javascript.format.insertSpaceBeforeFunctionParenthesis\": true,\n      // HTML Snippets 插件配置\n      \"emmet.triggerExpansionOnTab\": true,\n      \"emmet.includeLanguages\": {\n          \"vue-html\": \"html\",\n          \"vue\": \"html\"\n      },\n  ```\n      \n\n\n# 四、前端自动化构建\n\n## 构建需求\n\n  1. __预处理__\n    <div style=\"text-indent: 2em\">低层语言的更换或升级都因兼容性问题而面临着巨大困难，这催生了各种中间语言的预处理器，例如 通过 Babel 将 ES6 转换成可以在浏览器中运行的 js代码，通过 Sass/Less/Stylus 可以在线编程并转换成 css代码。</div> \n\n  2. __风格与测试__\n    <div style=\"text-indent: 2em\">在一个典型的工作流中，每次Push主分支或npm发布都应首先运行代码风格检查和单元测试。我们需要这些操作能够在合适的时候自动执行。</div> \n\n  3. __资源压缩__\n    <div style=\"text-indent: 2em\">在开发网站代码时，我们希望模块化地进行编码，即每个业务逻辑、通用工具或者架构元素都需要组织在单独的文件中。但是如果用户浏览网页时也载入这么多源文件则会影响页面打开速度，因此在网站发布时需要将源码合并压缩，js可能还需要模块化，CSS文件可能还需要合并、添加兼容性前缀等，这些重复性工作我们也希望写成脚本。   </div> \n\n  4. __静态资源的URL替换__\n    <div style=\"text-indent: 2em\">该需求最复杂, 因为生产环境中的资源地址可能和开发环境中很不同，可能是由于JS合并、CSS合并，也可能是由于应用了CDN加速。我们需要在部署时更改所有HTML文件中的静态资源地址。</div> \n\n\n## 构建工具\n<div style=\"text-indent: 2em\">\"自动化构建\"是指通过工具实现构建系统、编译和转换代码、压缩资源、部署配置等功能，优化\"从源码到网页\"的开发流程，这有利于提高开发效率并改善代码质量。</div>\n<div style=\"text-indent: 2em\">所有的开发工具都是为了使大量低技术含量任务完成自动化从而减轻工作，它们的组合使用完全看个人选择。开发过程一般会以Node和npm为核心，然后搭配 Gulp + Bower 或者 Webpack。</div>\n\n  1. __执行通用任务__\n    * NPM / Bower：基于NodeJS的包管理和分发工具，用来下载、安装、上传以及管理已经安装的包\n    * Gulp / Grunt：基于NodeJS的自动化构建工具，用来自动化完成一些常见的、重复的Web开发任务，如网页自动刷新和预处理等。两者最大区别是Gulp采取流式接口。\n  2. __模块绑定__\n    * Webpack：前端资源模块化管理和打包工具，用来配置各种模块所需要的处理方式，常见配置有 scss 代码预处理、ES6 代码转换、模块打包的规则和地址等\n    * Browserify：打包工具，常用于将 Node 项目模块打包成浏览器支持形式\n    * RequireJS：Js模块加载器，常用于 NodeJS 中加载模块\n  3. __代码分析__\n    * ESLint / JSLint：检测工具，常用于分析代码中潜在错误。\n  4. __单元测试__\n    * Jasmine：测试工具，常用于测试自己的代码\n\n\n  \n# 五、安装工具 NPM\n## 使用场景\n  * 从NPM服务器下载别人编写的三方包到本地使用\n  * 从NPM服务器下载并安装别人编写的命令行程序到本地使用\n  * 将自己编写的包或命令行程序上传到NPM服务器供别人使用\n\n\n## 常用命令\n  ```js\n  npm -v                    //查看npm版本\n  npm list                  //当前目录已安装插件\n  npm init                  //生成package.json文件\n\n  npm i <name> -g           //安装包\n  npm uninstall <name>      //卸载包\n  npm update <name>         //更新包   \n  /**\n    * 可添加的修饰符\n    *     -g                 全局(不加则为本地安装)\n    *     -S / --save        需要发布到生产环境的依赖(默认)\n    *     -D / --save-dev    只用于开发环境的依赖\n    *     --no-save          不写入package.json的依赖\n    */\n\n  npm run script-key        // 执行package.json中 \"scripts\" 选项对应的js \n  npm start                 // 比较特殊\n  ```\n\n## 发布npm包\n\n  ```js\n  cd test                 // 选择目标文件夹\n  npm init                // 配置包的相关信息\n  module.exports = 1      // 编辑包 test/index.js\n\n  npm adduser             // 注册，第一次发布包\n  npm login               // 登录，非第一次发布包\n\n  npm publish            // 发布/更新包\n  npm install 包名        // npm官网搜索后验证下载\n\n  // 撤销发布的包要用force强制删除。超过24小时就不能删除了\n  npm --force unpublish 包名    \n  ```\n\n\n# 六、构建工具 Gulp\n\n## 常用插件\n  * gulp-minify-html：压缩html\n  * gulp-minify-css：压缩css\n  * gulp-uglify：压缩js\n  * gulp-smushit：压缩图片\n  * gulp-concat：文件合并\n  * gulp-rename：重命名\n  * gulp-babel：编译ES6\n  * gulp-sass/less：css预处理\n  * gulp-autoprefixer：自动添加css前缀\n  * browser-sync：自动刷新页面(非gulp插件)\n\n\n## API\n  * task：创建任务\n  * run：运行任务\n  * watch：监听任务\n  * src：设置需处理的文件路径(正则/数组)\n  * dest：设置生成文件的路径，一个任务可有多个生成路径\n\n\n## 设置任务\n  1. __服务器__\n    ```js\n    var gulp = require('gulp'),\n        browserSync = require('browser-sync');\n    // 1.搭建静态服务器\n    gulp.task('browser-sync', function () {\n        browserSync.init({\n            files:['**'],\n            server:{\n                baseDir:'./',             // 服务器的根目录\n                index:'blink/blink.html'  // 默认打开的文件\n            },\n            port:8050  // 指定访问服务器的端口号\n        });\n    });\n    // 2.使用代理（注意本地服务器必须自己搭建的）\n    gulp.task('browser-sync', function () {\n        browserSync.init({\n            files:['**'],\n            proxy:'localhost',  // 本地服务器的地址\n            port:8080           // 访问的端口号\n        });\n    });\n    ```\n  \n  2. __默认任务__\n    ```js\n    gulp.task('default',['serve']);  \n    gulp.task('server',['sass','mihtml','minijs'],function(){\n        bs.init({\n            open:'external',\n            server:'./build'  //服务根目录\n        })\n        // 监听html\n        gulp.watch('./html/*.html',['mihtml'])\n        gulp.watch('./build/html/*.html').on('change',reload)\n    }) \n      \n\n    gulp.task('default', function(){\n        gulp.run('lint', 'sass', 'scripts');\n          // 监听sass文件变化\n        gulp.watch('src/sass/*.sass', function(){\n            gulp.run('lint', 'sass', 'scripts');\n        });\n    });\n    ```\n\n## 基础使用\n  1. __初始化目录__\n    ```js\n    ├── app              // 工作目录：源文件\n    │   ├── js\n    │   ├── Sass\n    │   └── index.html\n    │\n    ├── dist            // 目标目录：编译、压缩后的文件\n    └── release         // 可以发布到服务器的文件目录\n\n\n    cnpm install gulp -g  // 全局安装，执行gulp任务\n    cd GulpTest \n    cnpm init      // 生成package.json文件\n    cnpm install gulp -S  // 本地安装，使用gulp插件并避免版本冲突\n    gulp -v       // 查看版本\n    ```\n  \n  2. __编写配置文件 gulpfile.js__\n    ```js\n    var gulp = require('gulp');\n\n    var sass = require('gulp-sass');        //编译sass\n    var maps = require('gulp-sourcemaps');  //在浏览器显示scss样式以便调试\n    var autoprefixer = require('gulp-autoprefixer');  //自动添加前后缀\n\n    var htmlmin = require('gulp-htmlmin');  //html压缩\n    var uglify = require('gulp-uglify');    //压缩js文件\n    var smushit = require('gulp-smushit');  //图片压缩\n\n    var concat = require('gulp-concat');    //文件合并\n    var babel = require('gulp-babel');      //将ES6代码编译成ES5\n\n    var bs = require('browser-sync').create();  //页面同步\n    var reload = bs.reload;\n\n\n    // 默认任务\n    gulp.task('default', ['server'])\n\n    // 打包任务\n    // gulp.task('build', ['html', 'css', 'less', 'js'])\n\n    // sass 任务\n    gulp.task('sass', function(){\n      return gulp.src('./src/scss/*.scss')  // 导入文件\n        .pipe(maps.init())        // 将页面样式定义到scss\n          // 转译scss到css,报错时输出错误信息,不终止程序运行 \n        .pipe(sass({\"outputStyle\": \"compressed\"}).on('error', sass.logError))\n                                    \n        .pipe(autoprefixer())       // 自动添加前后缀\n        .pipe(maps.write('./'))     // 生成map文件（和css文件放在一起）\n        .pipe(gulp.dest('./dist/css'))    // 将生成的文件放到css文件夹中\n        .pipe(reload({stream:true}))       \n        // 任务完成后（监听关闭后），再有修改时重新启动监听时会重新执行以防报错\n    })\n\n    // 压缩 html \n    gulp.task('mihtml', function(){\n      var options = {\n            removeComments: true,     // 清除HTML注释\n            collapseWhitespace: true, // 压缩HTML\n            minfyJS: true,     // 压缩JS\n            minfyCss: true,    // 压缩CSS\n        };\n        return gulp.src('./src/html/*.html')  \n            .pipe(htmlmin(options))  \n            .pipe(gulp.dest('./dist/html/'))\n    })\n\n    // 压缩 js \n    gulp.task('minijs', function() {   \n        gulp.src('!./src/js/*.js')       // !表示除了...之外 \n        .pipe(babel())\n        .pipe(uglify())//压缩  \n        // .pipe(concat('all.min.js'))   //合并到all.min.js中  \n        .pipe(gulp.dest('./dist/js/'));  //指定目录  \n    }); \n\n    // 压缩 img \n    gulp.task('img', function () {\n        return gulp.src('./src/img/*.*')\n            .pipe(smushit({\n                verbose: true\n            }))\n            .pipe(gulp.dest('./dist/img/'));\n    });\n    //生成服务并自动化监听项目\n    gulp.task('server', ['sass','mihtml','minijs'], function(){\n        bs.init({\n          open: 'external',  //启动时自动打开的网址(local打开本地主机网址)\n          server: './dist/html' //设置根目录dist(默认打开其中index.html)\n          /*\n            默认打开 test.html\n            baseDir: \"./\",\n            index: \"test.html\"\n          */\n        })\n        // 监听html\n        gulp.watch('./src/html/*.html', ['mihtml'])\n        gulp.watch('./dist/html/*.html').on('change', reload)\n        //监听scss\n        gulp.watch('./src/scss/*.scss',['sass']);\n        gulp.watch('./dist/css/*.css').on('change', reload)\n        //监听js\n        gulp.watch('./src/js/*.js', ['minijs'])\n        gulp.watch('./dist/js/*js').on('change', reload)\n    })\n    ```\n\n  3. __运行gulp__\n    ```json\n    // 定义 package.json 文件中的 scripts\n    \"scripts\": {\n      \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\",\n      \"start\": \"gulp dev\",                   //执行gulp dev命令\n      \"clean\": \"rimraf dist\",                // 清空删除dist中所有文件\n      \"build\": \"rimraf dist && gulp build\"   // 执行两个命令，先清空dist再重新打包\n    },\n    //注意先全局安装rimraf: npm install rimraf -g\n    ```\n\n\n# 七、打包工具 Webpack\n\n## 模块打包工具\n<div style=\"text-indent: 2em\">分析项目结构，找到Js模块和浏览器不能直接运行的拓展语言（Scss、TypeScript 等），并将其转换和打包为合适的格式供浏览器使用。在很多场景下可以替代Gulp/Grunt类的工具，工作流程如下：</div>  \n\n  * Gulp/Grunt：在一个配置文件中，指定对某些文件进行编译、组合、压缩等任务的具体步骤，工具会自动替你完成这些任务。\n  * Webpack：把项目当做一个整体，从一个给定主文件(如index.js)开始找到项目的所有依赖文件，使用loaders处理它们，把所有的非js资源(css/img等)都转换成 js，然后用 CommonJS 的机制管理起来。\n\n\n## 核心概念\n  * 入口（entry）：即要编译的文件。指定后webpack会自行寻找依赖的文件打包编译\n  * 输出（output）：编译转换好之后的文件写入位置\n  * 加载器（loader）：转换scss、ES6等不同类型的文件，从而可以在浏览器中运行\n  * 插件（plugin）：完成压缩文件等loader无法解决的功能\n\n\n## 基础使用\n  1. __初始化目录__\n    ```js\n    WebTest\n      ├── app              // 工作目录：源文件\n      │   ├── main.js\n      │   └── hello.js\n      │\n      ├── dist            // 目标目录：打包生成的 js 文件\n      │   └── index.html\n      │\n      ├── node_moudles\n      └── package.json \n\n    // index.html\n    div id=\"app\"         \n    script src=\"bundle.js\"\n\n    // hello.js\n    moudle.exports = \"hello world\"\n\n    // main.js\n    const str = require(\"./hello.js\")\n    document.querySelector(\"#app\").appendChild(str)\n\n    // 打包执行\n    webpack app/main.js dist/bundle.js\n\n\n    cd WebTest                          \n    cnpm install -g webpack   // 全局安装\n    cnpm install -S webpack   // 本地安装\n    cnpm init                 // 新建package.json\n  ```\n\n  2. __基础配置__\n  <div style=\"text-indent: 2em\">在项目根目录下新建 webpack.config.js 文件并配置选项，配置后在终端里执行 webpack 就会被自动引用。项目开发时可以创建多个配置文件：webpack.dev.config.js 和 webpack.pub.config.js 分别用于开发和生产环境，不过运行时需要使用命令 webpack --config webpack.dev.config.js</div>  \n\n  ```js\n  // webpack.config.js\n  module.exports = {\n    entry: __dirname + '/app/main.js', // 唯一入口文件\n    output: {\n        filename: 'bundle.js',         // 输出文件名\n        path: __dirname + \"/dist\",     // 输出文件存放地址\n        // path: path.resolve(__dirname, 'dist') \n      }\n  }\n  ```\n\n  ```json\n  // package.json文件中的scripts选项配置快捷执行方法\n  \"scripts\": {\n    \"dev\":\"webpack --config webpack.dev.config.js\",\n    \"pub\":\"webpack --config webpack.pub.config.js\",\n    \"start\": \"webpack\",\n    \"server\": \"webpack-dev-server --inline\" \n  }\n  ```\n\n\n## 高级配置\n\n### 配置 Babel\n  * 功能：将 ES6、jsx等语法编译为浏览器能够运行的js\n  * 配置：webpack.config.js 或单独的 .babelrc 文件（webpack会自动调用）\n\n  \n### 生成 Source Maps\n<div style=\"text-indent: 2em\">有时打包后文件出错了，却不容易找到对应代码的位置，而通过配置 devtool 选项后，webpack 就可以在打包时生成 source maps，这为我们提供了一种对应编译文件和源文件的方法，使得编译后的代码可读性更高，也更容易调试。可选的四种配置如下：</div>  \n\n  * source-map：完整且功能完全的单独文件，但会减慢打包速度\n  * cheap-module-source-map：不带列映射，只能对应到具体的行\n  * eval-source-map：不影响速度且完整，但有隐患，可开发不可生产阶段\n  * cheap-module-eval-source-map：生成Source Map最快且和js同行，不利于调试，推荐在大型项目考虑时间成本时使用\n\n\n### 构建本地服务器\n<div style=\"text-indent: 2em\">Webpack 提供一个可选的本地开发服务器 webpack-dev-server，它基于 Node.js 构建而且可以实现浏览器监听代码修改并自动刷新等效果，配置前需要通过 npm 安装它作为项目依赖。</div> \n\n```js\nmodule.exports = {\n    entry: __dirname + '/app/main.js',\n    output: {\n        path: path.resolve(__dirname, 'dist'),\n        filename: 'bundle.js'\n    },\n    devServer: {\n        contentBase: \"./dist\",    // 加载页面的所在目录\n        historyApiFallback: true, // 不跳转\n        inline: true,   // 实时刷新\n        hot: true  // 热更新，即不刷新浏览器的前提下刷新页面\n    }\n}\n\n// 配置后执行 npm run server \n```\n\n\n\n# 八、版本管理工具 Git\n\n## Git 和 Svn\n  1. Svn：集中式管理工具。所有版本文件都集中存放到一个服务器上，所有开发者都从该服务器上更新或上传修改代码，注意需要连网。\n  2. Git：分布式管理工具，分布式指每台电脑都是一个版本仓库，但在实际工作中一般会有一个集中的服务中心 Github。与集中式的最大区别在于开发者可以离线在本地提交, 只需在连网时push到相应的服务器或其他用户, 而且每个开发者通过克隆(git clone)可以在本地机器上拷贝一个完整的Git仓库。</div>\n\n\n## Git 和 Github的关系\n  1. Git：指定了remote链接和用户信息（用户名+邮箱）之后，git可以帮你将提交过到你本地分支的代码push到远程的git仓库（任意提供了git托管服务的服务器上都可以，包括你自己建的服务器 或者 GitHub等网站提供的服务器）或者将远程仓库的代码 fetch 到本地。</div>\n  2. Github：只是一个提供存储空间的服务器，用来存储git仓库。当然现在Github已经由一个存放git仓库的网站空间发展为了一个开源社区（不只具有存储git仓库的功能了），你可以参与别人的开源项目，也可以让别人参与你的开源项目。</div>\n\n\n## 工作流程\n<div style=\"text-indent: 2em\">开发者在自己的机器上更新服务器上的最新代码，然后根据需要创建分支，在该分支上提交本地修改的代码到远程仓库并通知主开发者合并代码。如果主开发者发现代码有冲突则让开发者修改后重新提交，没有冲突则合并代码。注意本地的 .git文件是指本地仓库，.git目录下存放着所有文件的版本和关联信息但默认隐藏。开发流程图如下</div>\n<div align=\"center\">\n  ![工作流程图](images/web/git_work.png)\n</div> \n\n## 常用命令\n<div align=\"center\">\n<!-- git_order.png -->\n![常用命令图](images/web/git_order.png)\n</div> \n\n## 基础配置\n```js\ngit config --global --list         //查看全局配置\ngit config --global user.name \"chuanggefighting\"    //设置用户名\ngit config --global user.email \"17621538916@163.com\"    //设置邮箱\n```\n\n## ssh密钥配置\n<div style=\"text-indent: 2em\">Git使用https协议，每次pull/push都要输入密码比较麻烦，而使用git协议后使用ssh密钥，这样可以省去每次都输密码。配置步骤如下：</div>\n\n  1. 检测SSH keys是否存在：cd ~/.ssh\n  2. 创建ssh key(生成密钥对)：ssh-keygen -t rsa -C \"17621538916@163.com\"\n    * 此时会提示自定义名称和push时的密码 (不是git登录密码), 一般推荐略过(直接三个回车), 如果看到成功保存信息则说明如果创建成功\n\n  3. 添加公钥到github等个人的远程仓库\n    1. 查看生成的公钥：cat ~/.ssh/id_rsa.pub \n    2. 登陆github：点击头像 --> Settings --> 左栏点击SSH and GPG keys --> 点击 New SSH key --> 复制上面的公钥内容，粘贴进\"Key\"，title自定义 --> 点击 Add key \n    3. 测试SSH的连接：ssh -T git@github.com   \n    4. 输入yes后可看到信息\n              \n\n## 工作提交代码\n  ```js\n    /**\n      *  远程分支   -->  本地分支\n      *  orgin/master --> master\n      *  orgin/dev/t_lishi/xx --> dev/t_lishi/xx\n      */\n\n    git fetch --all        //更新远程修改但不会merge\n    git reset --hard orgin/master  //强制更新(慎用)\n\n    git pull orgin master  // 拉取代码到本地并合并到本地\n\n\n    git branch            // 查看本地分支\n    git checkout master   //切换到主分支分支\n\n    git branch -D BranchName    // 删除本地分支(--delete/-d)\n    git branch -r -D origin/BranchName  // 删除远程分支\n    git push origin :BranchName   // 删除远程分支简单方法\n\n    git checkout -b dev/t_lishi/Navigation  // 创建并切换到该分支          \n    // 相当于以下两个命令的合并\n    git branch branchName     新建    \n    git checkout branchName   切换\n\n    git push origin dev/t_lishi/Navigation  // 推送到远端\n    git branch -a      // 查看远程分支\n\n    // 修改某个文件后操作\n    git status  查看状态\n    git add TaskDoc/t_lishi.log  // 指定需要提交到本地仓库的文件\n    git status \n    git commit -m \"create Navigation\"      提交代码到本地\n    git push origin dev/t_lishi/Navigation    推送到远程仓库\n  ```\n\n\n## 把个人网页挂到 Github\n  1. __Github 上建立仓库，比如 resume__\n  2. __进入新建仓库并选择 “settings” 进行仓库设置，滚动到页面底部 “Github Pages” 部分__\n    * Source -- master branch，保存后就会自动生成网址\n    * 生成网址拼接文件路径后访问：chuanggefighting.github.io/resume/dist/index.html\n  3. __将仓库代码克隆到本地__\n    * 删除除了 .git 以外的其他文件，然后通过以下命令测试\n    ```js\n    git add *               // 添加到暂存区\n    git commit -m 'del'     // 上传到本地仓库\n    git push origin master  // 上传到远程仓库\n    ```\n  4. __更新个人代码到远程仓库__\n\n","slug":"3-web工具","published":1,"updated":"2019-05-10T17:11:12.001Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvid4pmu00250nbx23s140bq","content":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><html><head></head><body><h1 id=\"一、电脑系统-Mac\"><a href=\"#一、电脑系统-Mac\" class=\"headerlink\" title=\"一、电脑系统 Mac\"></a>一、电脑系统 Mac</h1><h2 id=\"操作系统\"><a href=\"#操作系统\" class=\"headerlink\" title=\"操作系统\"></a>操作系统</h2><ol><li><strong>Windows</strong><ul><li>人妻，什么都有，还常附带不想要的东西。</li><li>微软的系统，基于Basic开发，是最普及的桌面系统，主要特点是功能强大但安全堪忧，适用于正常办公以及游戏。</li></ul></li><li><strong>Mac OS/OSX</strong><ul><li>女友，带着有面子但必须按照它的规则。</li><li>苹果系统，基于linux开发，主要特点是应用软件较少和较安全，适用于办公的高端移动化处理。</li></ul></li><li><strong>Linux</strong><ul><li>小萝莉，你让它干嘛就干嘛。</li><li>一种自由和开放源码的类Unix操作系统，可安装在手机电脑等各种计算机硬件设备中，主要特点是网络功能强大且对内存等硬件的消耗小，多用于网络服务器中，优点是其易用性和丰富的应用软件。</li></ul></li></ol><h2 id=\"操作接口\"><a href=\"#操作接口\" class=\"headerlink\" title=\"操作接口\"></a>操作接口</h2><ol><li><strong>终端 terminal</strong><ul><li>用于人与计算机进行交互的输入输出接口</li><li>本质是通过电缆、网络等连接主机的外部附加设备，一台计算机可以连接个终端</li></ul></li><li><strong>控制台 console</strong><ul><li>用于管理主机的特殊终端，只允许管理员使用</li><li>本质是直接和计算机相连接的原生设备，一台计算机一般只能有一个控制台</li></ul></li><li><strong>命令解释器 shell</strong><ul><li>提供用户界面的程序，用于与计算机内核交互</li><li>本质是 接受用户指令后，调用其他程序与内核交互完成指令</li><li>一般分为 命令行shell 和 图形shell，分别提供 命令行界面 CLI 和 图形用户界面 GUI</li><li>批处理：将一系列命令按照一定顺序集合为一个可执行的文本文件，在window系统的扩展名为 bat/cmd，双击文件即可运行</li></ul></li><li><strong>终端与 shell 的分工</strong><ul><li>终端从用户接受 鼠标键盘等设备的输入信息，然后发送给 shell</li><li>shell 从终端获取用户指令，解析后发给计算机内核执行，并返回结果给终端</li></ul></li></ol><h2 id=\"mac\"><a href=\"#mac\" class=\"headerlink\" title=\"mac\"></a>mac</h2><ol><li><strong>应用软件安装</strong><ul><li>通过 App Stroe 安装</li><li>将浏览器中下载好的 dmg 安装包拖到”应用程序”目录</li></ul></li><li><strong>系统软件安装</strong><ul><li>brew 即 Homebrew，是 Mac OSX 上的软件包管理工具，用来安装、更新、卸载软件</li><li>命令行配置环境变量：vi ~/.bash_profile - 编辑文件 - esc键退出编辑 - :wq回车保存</li></ul></li><li><strong>实现翻墙</strong><ul><li>配置 VPN：VPN 即虚拟专用网络，可用来保护隐私和自由访问外国网站</li><li>配置 proxy：即配置代理地址</li></ul></li></ol><h1 id=\"二、浏览器-chrome\"><a href=\"#二、浏览器-chrome\" class=\"headerlink\" title=\"二、浏览器 chrome\"></a>二、浏览器 chrome</h1><ol><li><strong>搜索</strong>（Google输入框中所有空格都被理解为加号）<ul><li>完整匹配: “mysql foreign key”（引号）</li><li>筛选: “mysql key” - “nodejs”（加减号）</li><li>返回所有: “mysql connect error *”（加通配符）</li><li>站内搜索: “mysql foreign key” site:stackoverflow.com</li><li>加速: 输入网址后点击Tab，这样可直接使用该站点的站内搜索</li></ul></li><li><strong>调试js代码</strong><ul><li>Alert, Console等</li><li>断点调试<ul><li>步骤：F12开发者工具 ——> 点击Sources菜单 ——> 左侧树中找到相应文件 ——> 点击行号列(右键为条件断点) ——> 刷新页面 ——> JS执行到断点位置停住，此时可以跟随鼠标查看功能按钮</li><li><a href=\"http://blog.csdn.net/crper/article/details/50722753\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">相关技巧</a></li></ul></li><li>debug断点<ul><li>在触发文件中添加 “debugger;” 语句后触发，当代码执行到该语句时就会自动断点, 接下去的操作和在Sources面板添加断点调试几乎一模一样，唯一区别在于调试后需要删除该语句。</li><li>由于有时会遇到异步加载html片段的情况，其JS代码在Sources中无法找到，因此无法直接在开发工具中直接添加断点时可用debug断点（F10一步一步执行，F8一下执行完成）</li></ul></li></ul></li><li><strong>高阶调试功能</strong><ul><li><a href=\"https://www.cnblogs.com/guaidianqiao/p/7615430.html\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">内置抓包工具等</a></li></ul></li><li><strong>扩展插件</strong><ul><li>谷歌访问助手<ul><li>安装：<a href=\"http://www.ggfwzs.com/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">下载安装包</a> ——> 更多工具 ——> 扩展程序 ——> 直接拖拽 ——> 添加扩展程序</li><li>扩展其它插件：谷歌访问助手 ——> 谷歌网上商店 ——> 搜索插件 ——> 点击添加扩展</li></ul></li><li>常用插件推荐<ul><li>掘金</li><li>Google翻译</li><li>FeHelper</li><li>JSONView</li><li>What runs</li><li>Clear Cache</li><li>Code Plunker</li><li>Vue.js devtools</li><li>AngularJS Batarang</li><li>React Developer Tools</li></ul></li></ul></li><li><strong>Chrome黑科技</strong><ul><li>实现翻墙<ul><li>配置proxy代理：setting system ——> proxy settings ——> LAN setting ——> proxy server ——> 配置 Address 和 Port</li><li>配置Chrome扩展：下载<a href=\"https://www.crx4chrome.com/crx/39922/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Hoxx VPN Proxy</a> ——> 注册登录</li></ul></li><li>解析VIP视频<ul><li>打开网站 <a href=\"https://greasyfork.org/zh-CN\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Greasy Fork</a> ——> 搜索VIP视频解析 ——> 安装脚本</li></ul></li><li>其它：视频广告过滤、电脑管家上网防护等</li></ul></li></ol><h1 id=\"三、代码编辑器-vscode\"><a href=\"#三、代码编辑器-vscode\" class=\"headerlink\" title=\"三、代码编辑器 vscode\"></a>三、代码编辑器 vscode</h1><blockquote><p>常用扩展插件</p></blockquote><ul><li>显示效果类<ul><li>Dracula Official ：高亮主题</li><li>Beautify ：代码高亮</li><li>vscode-icon ：让资源树目录加上图标</li><li>Bracket Pair Colorizer ：每一对括号用不同颜色区别</li><li>Open-In-Browser ：直接在浏览器中打开文件的快捷菜单 alt + b</li></ul></li><li>辅助编辑类<ul><li>ESlint ：检测js</li><li>Prettier ：代码格式化 alt + shift + F</li><li>CSS Peek ：追踪至定义处（右键选择前两个选项）</li><li>Path Intellisense ：自动补全路径</li><li>Auto Close Tag ：自动闭合HTML标签</li><li>Auto Rename Tag ：自动修改匹配的标签</li><li>HTML CSS Support ：CSS的智能补全</li><li>JavaScript (ES6) code snippets ：JS语法提示</li></ul></li><li>Vue插件类<ul><li>Vetur ：语法高亮</li><li>VueHelper ：vue代码提示插件</li><li>Vue 2 Snippets ：语法高亮 + 代码补全</li><li>HTML Snippets ：在.vue文件中使用html代码补全功能</li></ul></li><li>其它类<ul><li>npm ：运行npm命令</li><li>npm Intellisense ：导入时提示已安装模块</li><li>Python ：添加对.py文件的支持</li><li>GitLens ：简单实现git提交代码</li><li>Debugger for chrome ：调试Debug</li></ul></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// vscode 基础配置</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 配置中文：ctrl + shift + p --> Display Language</span></span><br><span class=\"line\">    <span class=\"string\">\"locale\"</span>:<span class=\"string\">\"zh-CN\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 用户配置：文件 --> 首选项 --> 设置 --> User Settings</span></span><br><span class=\"line\">    <span class=\"comment\">// 指定工作台中使用的颜色主题。    </span></span><br><span class=\"line\">    <span class=\"string\">\"workbench.colorTheme\"</span>: <span class=\"string\">\"Monokai\"</span>,    </span><br><span class=\"line\">    <span class=\"comment\">// 指定在工作台中使用的图标主题    </span></span><br><span class=\"line\">    <span class=\"string\">\"workbench.iconTheme\"</span>: <span class=\"string\">\"vscode-icons\"</span>,    </span><br><span class=\"line\">    <span class=\"comment\">// 窗口失去焦点自动保存    </span></span><br><span class=\"line\">    <span class=\"string\">\"files.autoSave\"</span>: <span class=\"string\">\"off\"</span>,    </span><br><span class=\"line\">    <span class=\"comment\">// 如果设置为 \"true\"，将不再显示扩展建议的通知。   </span></span><br><span class=\"line\">    <span class=\"string\">\"extensions.ignoreRecommendations\"</span>: <span class=\"literal\">true</span>,    </span><br><span class=\"line\">    <span class=\"comment\">// 如果设置成 true，关于新的版本消息将不再显示    </span></span><br><span class=\"line\">    <span class=\"string\">\"vsicons.dontShowNewVersionMessage\"</span>: <span class=\"literal\">true</span>,    </span><br><span class=\"line\">    <span class=\"comment\">// 控制是否将打开的编辑器显示为预览。    </span></span><br><span class=\"line\">    <span class=\"string\">\"workbench.editor.enablePreview\"</span>: <span class=\"literal\">false</span>,   </span><br><span class=\"line\">    <span class=\"comment\">// 字体字号</span></span><br><span class=\"line\">    <span class=\"string\">\"editor.fontSize\"</span>: <span class=\"number\">18</span>, </span><br><span class=\"line\">    <span class=\"comment\">//代码缩进风格4个字符    </span></span><br><span class=\"line\">    <span class=\"string\">\"editor.tabSize\"</span>: <span class=\"number\">4</span>,    </span><br><span class=\"line\">    <span class=\"comment\">// 控制编辑器是否应在键入后自动设置行的格式    </span></span><br><span class=\"line\">    <span class=\"string\">\"editor.formatOnType\"</span>: <span class=\"literal\">false</span>,    </span><br><span class=\"line\">    <span class=\"comment\">// 保存时取消自动格式化    </span></span><br><span class=\"line\">    <span class=\"string\">\"editor.formatOnSave\"</span>: <span class=\"literal\">false</span>,    </span><br><span class=\"line\">    <span class=\"comment\">// 编辑粘贴取消自动格式化    </span></span><br><span class=\"line\">    <span class=\"string\">\"editor.formatOnPaste\"</span>: <span class=\"literal\">false</span>,    </span><br><span class=\"line\">    <span class=\"comment\">// 控制编辑器中呈现空白字符的方式为“边界”，不会在单词之间呈现单空格。    </span></span><br><span class=\"line\">    <span class=\"string\">\"editor.renderWhitespace\"</span>: <span class=\"string\">\"boundary\"</span>,    </span><br><span class=\"line\">    <span class=\"comment\">// 控制光标动画样式    </span></span><br><span class=\"line\">    <span class=\"string\">\"editor.cursorBlinking\"</span>: <span class=\"string\">\"smooth\"</span>,    </span><br><span class=\"line\">    <span class=\"comment\">//设置Eslint需要验证的语言    </span></span><br><span class=\"line\">    <span class=\"string\">\"eslint.validate\"</span>: [        </span><br><span class=\"line\">        <span class=\"string\">\"javascript\"</span>,        </span><br><span class=\"line\">        <span class=\"string\">\"javascriptreact\"</span>,        </span><br><span class=\"line\">        <span class=\"string\">\"html\"</span>,        </span><br><span class=\"line\">        <span class=\"string\">\"vue\"</span>,        </span><br><span class=\"line\">        {            </span><br><span class=\"line\">            <span class=\"string\">\"language\"</span>: <span class=\"string\">\"vue\"</span>,            </span><br><span class=\"line\">            <span class=\"string\">\"autoFix\"</span>: <span class=\"literal\">true</span>        </span><br><span class=\"line\">        }</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"comment\">//每列显示内容长多，超出时控制编辑器列的换行。</span></span><br><span class=\"line\">    <span class=\"string\">\"editor.wordWrap\"</span>: <span class=\"string\">\"wordWrapColumn\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"editor.wordWrapColumn\"</span>: <span class=\"number\">150</span>,</span><br><span class=\"line\">    <span class=\"comment\">//创建人，修改人    </span></span><br><span class=\"line\">    <span class=\"string\">\"fileheader.Author\"</span>: <span class=\"string\">\"klierbyck\"</span>,    </span><br><span class=\"line\">    <span class=\"string\">\"fileheader.LastModifiedBy\"</span>: <span class=\"string\">\"klierbyck\"</span>,    </span><br><span class=\"line\">    <span class=\"comment\">// 在函数参数括号前定义空格处理。需要 TypeScript >= 2.1.5。    </span></span><br><span class=\"line\">    <span class=\"string\">\"typescript.format.insertSpaceBeforeFunctionParenthesis\"</span>: <span class=\"literal\">true</span>,    </span><br><span class=\"line\">    <span class=\"comment\">// 在函数参数括号前定义空格处理。需要 TypeScript >= 2.1.5。    </span></span><br><span class=\"line\">    <span class=\"string\">\"javascript.format.insertSpaceBeforeFunctionParenthesis\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"comment\">// HTML Snippets 插件配置</span></span><br><span class=\"line\">    <span class=\"string\">\"emmet.triggerExpansionOnTab\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"string\">\"emmet.includeLanguages\"</span>: {</span><br><span class=\"line\">        <span class=\"string\">\"vue-html\"</span>: <span class=\"string\">\"html\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"vue\"</span>: <span class=\"string\">\"html\"</span></span><br><span class=\"line\">    },</span><br></pre></td></tr></tbody></table></figure><h1 id=\"四、前端自动化构建\"><a href=\"#四、前端自动化构建\" class=\"headerlink\" title=\"四、前端自动化构建\"></a>四、前端自动化构建</h1><h2 id=\"构建需求\"><a href=\"#构建需求\" class=\"headerlink\" title=\"构建需求\"></a>构建需求</h2><ol><li><p><strong>预处理</strong></p><div style=\"text-indent:2em\">低层语言的更换或升级都因兼容性问题而面临着巨大困难，这催生了各种中间语言的预处理器，例如 通过 Babel 将 ES6 转换成可以在浏览器中运行的 js代码，通过 Sass/Less/Stylus 可以在线编程并转换成 css代码。</div></li><li><p><strong>风格与测试</strong></p><div style=\"text-indent:2em\">在一个典型的工作流中，每次Push主分支或npm发布都应首先运行代码风格检查和单元测试。我们需要这些操作能够在合适的时候自动执行。</div></li><li><p><strong>资源压缩</strong></p><div style=\"text-indent:2em\">在开发网站代码时，我们希望模块化地进行编码，即每个业务逻辑、通用工具或者架构元素都需要组织在单独的文件中。但是如果用户浏览网页时也载入这么多源文件则会影响页面打开速度，因此在网站发布时需要将源码合并压缩，js可能还需要模块化，CSS文件可能还需要合并、添加兼容性前缀等，这些重复性工作我们也希望写成脚本。</div></li><li><p><strong>静态资源的URL替换</strong></p><div style=\"text-indent:2em\">该需求最复杂, 因为生产环境中的资源地址可能和开发环境中很不同，可能是由于JS合并、CSS合并，也可能是由于应用了CDN加速。我们需要在部署时更改所有HTML文件中的静态资源地址。</div></li></ol><h2 id=\"构建工具\"><a href=\"#构建工具\" class=\"headerlink\" title=\"构建工具\"></a>构建工具</h2><div style=\"text-indent:2em\">“自动化构建”是指通过工具实现构建系统、编译和转换代码、压缩资源、部署配置等功能，优化”从源码到网页”的开发流程，这有利于提高开发效率并改善代码质量。</div><br><div style=\"text-indent:2em\">所有的开发工具都是为了使大量低技术含量任务完成自动化从而减轻工作，它们的组合使用完全看个人选择。开发过程一般会以Node和npm为核心，然后搭配 Gulp + Bower 或者 Webpack。</div><ol><li><strong>执行通用任务</strong><ul><li>NPM / Bower：基于NodeJS的包管理和分发工具，用来下载、安装、上传以及管理已经安装的包</li><li>Gulp / Grunt：基于NodeJS的自动化构建工具，用来自动化完成一些常见的、重复的Web开发任务，如网页自动刷新和预处理等。两者最大区别是Gulp采取流式接口。</li></ul></li><li><strong>模块绑定</strong><ul><li>Webpack：前端资源模块化管理和打包工具，用来配置各种模块所需要的处理方式，常见配置有 scss 代码预处理、ES6 代码转换、模块打包的规则和地址等</li><li>Browserify：打包工具，常用于将 Node 项目模块打包成浏览器支持形式</li><li>RequireJS：Js模块加载器，常用于 NodeJS 中加载模块</li></ul></li><li><strong>代码分析</strong><ul><li>ESLint / JSLint：检测工具，常用于分析代码中潜在错误。</li></ul></li><li><strong>单元测试</strong><ul><li>Jasmine：测试工具，常用于测试自己的代码</li></ul></li></ol><h1 id=\"五、安装工具-NPM\"><a href=\"#五、安装工具-NPM\" class=\"headerlink\" title=\"五、安装工具 NPM\"></a>五、安装工具 NPM</h1><h2 id=\"使用场景\"><a href=\"#使用场景\" class=\"headerlink\" title=\"使用场景\"></a>使用场景</h2><ul><li>从NPM服务器下载别人编写的三方包到本地使用</li><li>从NPM服务器下载并安装别人编写的命令行程序到本地使用</li><li>将自己编写的包或命令行程序上传到NPM服务器供别人使用</li></ul><h2 id=\"常用命令\"><a href=\"#常用命令\" class=\"headerlink\" title=\"常用命令\"></a>常用命令</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm -v                    <span class=\"comment\">//查看npm版本</span></span><br><span class=\"line\">npm list                  <span class=\"comment\">//当前目录已安装插件</span></span><br><span class=\"line\">npm init                  <span class=\"comment\">//生成package.json文件</span></span><br><span class=\"line\"></span><br><span class=\"line\">npm i <name> -g           <span class=\"comment\">//安装包</span></span><br><span class=\"line\">npm uninstall <name>      <span class=\"comment\">//卸载包</span></span><br><span class=\"line\">npm update <name>         <span class=\"comment\">//更新包   </span></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * 可添加的修饰符</span></span><br><span class=\"line\"><span class=\"comment\">  *     -g                 全局(不加则为本地安装)</span></span><br><span class=\"line\"><span class=\"comment\">  *     -S / --save        需要发布到生产环境的依赖(默认)</span></span><br><span class=\"line\"><span class=\"comment\">  *     -D / --save-dev    只用于开发环境的依赖</span></span><br><span class=\"line\"><span class=\"comment\">  *     --no-save          不写入package.json的依赖</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"></span><br><span class=\"line\">npm run script-key        <span class=\"comment\">// 执行package.json中 \"scripts\" 选项对应的js </span></span><br><span class=\"line\">npm start                 <span class=\"comment\">// 比较特殊</span></span><br></pre></td></tr></tbody></table></figure><h2 id=\"发布npm包\"><a href=\"#发布npm包\" class=\"headerlink\" title=\"发布npm包\"></a>发布npm包</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd test                 <span class=\"comment\">// 选择目标文件夹</span></span><br><span class=\"line\">npm init                <span class=\"comment\">// 配置包的相关信息</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"number\">1</span>      <span class=\"comment\">// 编辑包 test/index.js</span></span><br><span class=\"line\"></span><br><span class=\"line\">npm adduser             <span class=\"comment\">// 注册，第一次发布包</span></span><br><span class=\"line\">npm login               <span class=\"comment\">// 登录，非第一次发布包</span></span><br><span class=\"line\"></span><br><span class=\"line\">npm publish            <span class=\"comment\">// 发布/更新包</span></span><br><span class=\"line\">npm install 包名        <span class=\"comment\">// npm官网搜索后验证下载</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 撤销发布的包要用force强制删除。超过24小时就不能删除了</span></span><br><span class=\"line\">npm --force unpublish 包名</span><br></pre></td></tr></tbody></table></figure><h1 id=\"六、构建工具-Gulp\"><a href=\"#六、构建工具-Gulp\" class=\"headerlink\" title=\"六、构建工具 Gulp\"></a>六、构建工具 Gulp</h1><h2 id=\"常用插件\"><a href=\"#常用插件\" class=\"headerlink\" title=\"常用插件\"></a>常用插件</h2><ul><li>gulp-minify-html：压缩html</li><li>gulp-minify-css：压缩css</li><li>gulp-uglify：压缩js</li><li>gulp-smushit：压缩图片</li><li>gulp-concat：文件合并</li><li>gulp-rename：重命名</li><li>gulp-babel：编译ES6</li><li>gulp-sass/less：css预处理</li><li>gulp-autoprefixer：自动添加css前缀</li><li>browser-sync：自动刷新页面(非gulp插件)</li></ul><h2 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h2><ul><li>task：创建任务</li><li>run：运行任务</li><li>watch：监听任务</li><li>src：设置需处理的文件路径(正则/数组)</li><li>dest：设置生成文件的路径，一个任务可有多个生成路径</li></ul><h2 id=\"设置任务\"><a href=\"#设置任务\" class=\"headerlink\" title=\"设置任务\"></a>设置任务</h2><ol><li><strong>服务器</strong><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> gulp = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp'</span>),</span><br><span class=\"line\">    browserSync = <span class=\"built_in\">require</span>(<span class=\"string\">'browser-sync'</span>);</span><br><span class=\"line\"><span class=\"comment\">// 1.搭建静态服务器</span></span><br><span class=\"line\">gulp.task(<span class=\"string\">'browser-sync'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    browserSync.init({</span><br><span class=\"line\">        files:[<span class=\"string\">'**'</span>],</span><br><span class=\"line\">        server:{</span><br><span class=\"line\">            baseDir:<span class=\"string\">'./'</span>,             <span class=\"comment\">// 服务器的根目录</span></span><br><span class=\"line\">            index:<span class=\"string\">'blink/blink.html'</span>  <span class=\"comment\">// 默认打开的文件</span></span><br><span class=\"line\">        },</span><br><span class=\"line\">        port:<span class=\"number\">8050</span>  <span class=\"comment\">// 指定访问服务器的端口号</span></span><br><span class=\"line\">    });</span><br><span class=\"line\">});</span><br><span class=\"line\"><span class=\"comment\">// 2.使用代理（注意本地服务器必须自己搭建的）</span></span><br><span class=\"line\">gulp.task(<span class=\"string\">'browser-sync'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    browserSync.init({</span><br><span class=\"line\">        files:[<span class=\"string\">'**'</span>],</span><br><span class=\"line\">        proxy:<span class=\"string\">'localhost'</span>,  <span class=\"comment\">// 本地服务器的地址</span></span><br><span class=\"line\">        port:<span class=\"number\">8080</span>           <span class=\"comment\">// 访问的端口号</span></span><br><span class=\"line\">    });</span><br><span class=\"line\">});</span><br></pre></td></tr></tbody></table></figure></li></ol><ol start=\"2\"><li><strong>默认任务</strong><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gulp.task(<span class=\"string\">'default'</span>,[<span class=\"string\">'serve'</span>]);  </span><br><span class=\"line\">gulp.task(<span class=\"string\">'server'</span>,[<span class=\"string\">'sass'</span>,<span class=\"string\">'mihtml'</span>,<span class=\"string\">'minijs'</span>],<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    bs.init({</span><br><span class=\"line\">        open:<span class=\"string\">'external'</span>,</span><br><span class=\"line\">        server:<span class=\"string\">'./build'</span>  <span class=\"comment\">//服务根目录</span></span><br><span class=\"line\">    })</span><br><span class=\"line\">    <span class=\"comment\">// 监听html</span></span><br><span class=\"line\">    gulp.watch(<span class=\"string\">'./html/*.html'</span>,[<span class=\"string\">'mihtml'</span>])</span><br><span class=\"line\">    gulp.watch(<span class=\"string\">'./build/html/*.html'</span>).on(<span class=\"string\">'change'</span>,reload)</span><br><span class=\"line\">}) </span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\">gulp.task(<span class=\"string\">'default'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    gulp.run(<span class=\"string\">'lint'</span>, <span class=\"string\">'sass'</span>, <span class=\"string\">'scripts'</span>);</span><br><span class=\"line\">      <span class=\"comment\">// 监听sass文件变化</span></span><br><span class=\"line\">    gulp.watch(<span class=\"string\">'src/sass/*.sass'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">        gulp.run(<span class=\"string\">'lint'</span>, <span class=\"string\">'sass'</span>, <span class=\"string\">'scripts'</span>);</span><br><span class=\"line\">    });</span><br><span class=\"line\">});</span><br></pre></td></tr></tbody></table></figure></li></ol><h2 id=\"基础使用\"><a href=\"#基础使用\" class=\"headerlink\" title=\"基础使用\"></a>基础使用</h2><ol><li><strong>初始化目录</strong><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">├── app              <span class=\"comment\">// 工作目录：源文件</span></span><br><span class=\"line\">│   ├── js</span><br><span class=\"line\">│   ├── Sass</span><br><span class=\"line\">│   └── index.html</span><br><span class=\"line\">│</span><br><span class=\"line\">├── dist            <span class=\"comment\">// 目标目录：编译、压缩后的文件</span></span><br><span class=\"line\">└── release         <span class=\"comment\">// 可以发布到服务器的文件目录</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">cnpm install gulp -g  <span class=\"comment\">// 全局安装，执行gulp任务</span></span><br><span class=\"line\">cd GulpTest </span><br><span class=\"line\">cnpm init      <span class=\"comment\">// 生成package.json文件</span></span><br><span class=\"line\">cnpm install gulp -S  <span class=\"comment\">// 本地安装，使用gulp插件并避免版本冲突</span></span><br><span class=\"line\">gulp -v       <span class=\"comment\">// 查看版本</span></span><br></pre></td></tr></tbody></table></figure></li></ol><ol start=\"2\"><li><p><strong>编写配置文件 gulpfile.js</strong></p><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> gulp = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> sass = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp-sass'</span>);        <span class=\"comment\">//编译sass</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> maps = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp-sourcemaps'</span>);  <span class=\"comment\">//在浏览器显示scss样式以便调试</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> autoprefixer = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp-autoprefixer'</span>);  <span class=\"comment\">//自动添加前后缀</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> htmlmin = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp-htmlmin'</span>);  <span class=\"comment\">//html压缩</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> uglify = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp-uglify'</span>);    <span class=\"comment\">//压缩js文件</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> smushit = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp-smushit'</span>);  <span class=\"comment\">//图片压缩</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> concat = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp-concat'</span>);    <span class=\"comment\">//文件合并</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> babel = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp-babel'</span>);      <span class=\"comment\">//将ES6代码编译成ES5</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> bs = <span class=\"built_in\">require</span>(<span class=\"string\">'browser-sync'</span>).create();  <span class=\"comment\">//页面同步</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> reload = bs.reload;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 默认任务</span></span><br><span class=\"line\">gulp.task(<span class=\"string\">'default'</span>, [<span class=\"string\">'server'</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 打包任务</span></span><br><span class=\"line\"><span class=\"comment\">// gulp.task('build', ['html', 'css', 'less', 'js'])</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// sass 任务</span></span><br><span class=\"line\">gulp.task(<span class=\"string\">'sass'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">  <span class=\"keyword\">return</span> gulp.src(<span class=\"string\">'./src/scss/*.scss'</span>)  <span class=\"comment\">// 导入文件</span></span><br><span class=\"line\">    .pipe(maps.init())        <span class=\"comment\">// 将页面样式定义到scss</span></span><br><span class=\"line\">      <span class=\"comment\">// 转译scss到css,报错时输出错误信息,不终止程序运行 </span></span><br><span class=\"line\">    .pipe(sass({<span class=\"string\">\"outputStyle\"</span>: <span class=\"string\">\"compressed\"</span>}).on(<span class=\"string\">'error'</span>, sass.logError))</span><br><span class=\"line\">                                </span><br><span class=\"line\">    .pipe(autoprefixer())       <span class=\"comment\">// 自动添加前后缀</span></span><br><span class=\"line\">    .pipe(maps.write(<span class=\"string\">'./'</span>))     <span class=\"comment\">// 生成map文件（和css文件放在一起）</span></span><br><span class=\"line\">    .pipe(gulp.dest(<span class=\"string\">'./dist/css'</span>))    <span class=\"comment\">// 将生成的文件放到css文件夹中</span></span><br><span class=\"line\">    .pipe(reload({<span class=\"attr\">stream</span>:<span class=\"literal\">true</span>}))       </span><br><span class=\"line\">    <span class=\"comment\">// 任务完成后（监听关闭后），再有修改时重新启动监听时会重新执行以防报错</span></span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 压缩 html </span></span><br><span class=\"line\">gulp.task(<span class=\"string\">'mihtml'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">  <span class=\"keyword\">var</span> options = {</span><br><span class=\"line\">        removeComments: <span class=\"literal\">true</span>,     <span class=\"comment\">// 清除HTML注释</span></span><br><span class=\"line\">        collapseWhitespace: <span class=\"literal\">true</span>, <span class=\"comment\">// 压缩HTML</span></span><br><span class=\"line\">        minfyJS: <span class=\"literal\">true</span>,     <span class=\"comment\">// 压缩JS</span></span><br><span class=\"line\">        minfyCss: <span class=\"literal\">true</span>,    <span class=\"comment\">// 压缩CSS</span></span><br><span class=\"line\">    };</span><br><span class=\"line\">    <span class=\"keyword\">return</span> gulp.src(<span class=\"string\">'./src/html/*.html'</span>)  </span><br><span class=\"line\">        .pipe(htmlmin(options))  </span><br><span class=\"line\">        .pipe(gulp.dest(<span class=\"string\">'./dist/html/'</span>))</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 压缩 js </span></span><br><span class=\"line\">gulp.task(<span class=\"string\">'minijs'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{   </span><br><span class=\"line\">    gulp.src(<span class=\"string\">'!./src/js/*.js'</span>)       <span class=\"comment\">// !表示除了...之外 </span></span><br><span class=\"line\">    .pipe(babel())</span><br><span class=\"line\">    .pipe(uglify())<span class=\"comment\">//压缩  </span></span><br><span class=\"line\">    <span class=\"comment\">// .pipe(concat('all.min.js'))   //合并到all.min.js中  </span></span><br><span class=\"line\">    .pipe(gulp.dest(<span class=\"string\">'./dist/js/'</span>));  <span class=\"comment\">//指定目录  </span></span><br><span class=\"line\">}); </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 压缩 img </span></span><br><span class=\"line\">gulp.task(<span class=\"string\">'img'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">return</span> gulp.src(<span class=\"string\">'./src/img/*.*'</span>)</span><br><span class=\"line\">        .pipe(smushit({</span><br><span class=\"line\">            verbose: <span class=\"literal\">true</span></span><br><span class=\"line\">        }))</span><br><span class=\"line\">        .pipe(gulp.dest(<span class=\"string\">'./dist/img/'</span>));</span><br><span class=\"line\">});</span><br><span class=\"line\"><span class=\"comment\">//生成服务并自动化监听项目</span></span><br><span class=\"line\">gulp.task(<span class=\"string\">'server'</span>, [<span class=\"string\">'sass'</span>,<span class=\"string\">'mihtml'</span>,<span class=\"string\">'minijs'</span>], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    bs.init({</span><br><span class=\"line\">      open: <span class=\"string\">'external'</span>,  <span class=\"comment\">//启动时自动打开的网址(local打开本地主机网址)</span></span><br><span class=\"line\">      server: <span class=\"string\">'./dist/html'</span> <span class=\"comment\">//设置根目录dist(默认打开其中index.html)</span></span><br><span class=\"line\">      <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        默认打开 test.html</span></span><br><span class=\"line\"><span class=\"comment\">        baseDir: \"./\",</span></span><br><span class=\"line\"><span class=\"comment\">        index: \"test.html\"</span></span><br><span class=\"line\"><span class=\"comment\">      */</span></span><br><span class=\"line\">    })</span><br><span class=\"line\">    <span class=\"comment\">// 监听html</span></span><br><span class=\"line\">    gulp.watch(<span class=\"string\">'./src/html/*.html'</span>, [<span class=\"string\">'mihtml'</span>])</span><br><span class=\"line\">    gulp.watch(<span class=\"string\">'./dist/html/*.html'</span>).on(<span class=\"string\">'change'</span>, reload)</span><br><span class=\"line\">    <span class=\"comment\">//监听scss</span></span><br><span class=\"line\">    gulp.watch(<span class=\"string\">'./src/scss/*.scss'</span>,[<span class=\"string\">'sass'</span>]);</span><br><span class=\"line\">    gulp.watch(<span class=\"string\">'./dist/css/*.css'</span>).on(<span class=\"string\">'change'</span>, reload)</span><br><span class=\"line\">    <span class=\"comment\">//监听js</span></span><br><span class=\"line\">    gulp.watch(<span class=\"string\">'./src/js/*.js'</span>, [<span class=\"string\">'minijs'</span>])</span><br><span class=\"line\">    gulp.watch(<span class=\"string\">'./dist/js/*js'</span>).on(<span class=\"string\">'change'</span>, reload)</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure></li><li><p><strong>运行gulp</strong></p><figure class=\"highlight\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 定义 package.json 文件中的 scripts</span><br><span class=\"line\">\"scripts\": {</span><br><span class=\"line\">  \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\",</span><br><span class=\"line\">  \"start\": \"gulp dev\",                   //执行gulp dev命令</span><br><span class=\"line\">  \"clean\": \"rimraf dist\",                // 清空删除dist中所有文件</span><br><span class=\"line\">  \"build\": \"rimraf dist && gulp build\"   // 执行两个命令，先清空dist再重新打包</span><br><span class=\"line\">},</span><br><span class=\"line\">//注意先全局安装rimraf: npm install rimraf -g</span><br></pre></td></tr></tbody></table></figure></li></ol><h1 id=\"七、打包工具-Webpack\"><a href=\"#七、打包工具-Webpack\" class=\"headerlink\" title=\"七、打包工具 Webpack\"></a>七、打包工具 Webpack</h1><h2 id=\"模块打包工具\"><a href=\"#模块打包工具\" class=\"headerlink\" title=\"模块打包工具\"></a>模块打包工具</h2><div style=\"text-indent:2em\">分析项目结构，找到Js模块和浏览器不能直接运行的拓展语言（Scss、TypeScript 等），并将其转换和打包为合适的格式供浏览器使用。在很多场景下可以替代Gulp/Grunt类的工具，工作流程如下：</div><ul><li>Gulp/Grunt：在一个配置文件中，指定对某些文件进行编译、组合、压缩等任务的具体步骤，工具会自动替你完成这些任务。</li><li>Webpack：把项目当做一个整体，从一个给定主文件(如index.js)开始找到项目的所有依赖文件，使用loaders处理它们，把所有的非js资源(css/img等)都转换成 js，然后用 CommonJS 的机制管理起来。</li></ul><h2 id=\"核心概念\"><a href=\"#核心概念\" class=\"headerlink\" title=\"核心概念\"></a>核心概念</h2><ul><li>入口（entry）：即要编译的文件。指定后webpack会自行寻找依赖的文件打包编译</li><li>输出（output）：编译转换好之后的文件写入位置</li><li>加载器（loader）：转换scss、ES6等不同类型的文件，从而可以在浏览器中运行</li><li>插件（plugin）：完成压缩文件等loader无法解决的功能</li></ul><h2 id=\"基础使用-1\"><a href=\"#基础使用-1\" class=\"headerlink\" title=\"基础使用\"></a>基础使用</h2><ol><li><p><strong>初始化目录</strong></p><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">WebTest</span><br><span class=\"line\">  ├── app              <span class=\"comment\">// 工作目录：源文件</span></span><br><span class=\"line\">  │   ├── main.js</span><br><span class=\"line\">  │   └── hello.js</span><br><span class=\"line\">  │</span><br><span class=\"line\">  ├── dist            <span class=\"comment\">// 目标目录：打包生成的 js 文件</span></span><br><span class=\"line\">  │   └── index.html</span><br><span class=\"line\">  │</span><br><span class=\"line\">  ├── node_moudles</span><br><span class=\"line\">  └── package.json </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// index.html</span></span><br><span class=\"line\">div id=<span class=\"string\">\"app\"</span>         </span><br><span class=\"line\">script src=<span class=\"string\">\"bundle.js\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// hello.js</span></span><br><span class=\"line\">moudle.exports = <span class=\"string\">\"hello world\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// main.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> str = <span class=\"built_in\">require</span>(<span class=\"string\">\"./hello.js\"</span>)</span><br><span class=\"line\"><span class=\"built_in\">document</span>.querySelector(<span class=\"string\">\"#app\"</span>).appendChild(str)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 打包执行</span></span><br><span class=\"line\">webpack app/main.js dist/bundle.js</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">cd WebTest                          </span><br><span class=\"line\">cnpm install -g webpack   <span class=\"comment\">// 全局安装</span></span><br><span class=\"line\">cnpm install -S webpack   <span class=\"comment\">// 本地安装</span></span><br><span class=\"line\">cnpm init                 <span class=\"comment\">// 新建package.json</span></span><br></pre></td></tr></tbody></table></figure></li><li><p><strong>基础配置</strong></p><div style=\"text-indent:2em\">在项目根目录下新建 webpack.config.js 文件并配置选项，配置后在终端里执行 webpack 就会被自动引用。项目开发时可以创建多个配置文件：webpack.dev.config.js 和 webpack.pub.config.js 分别用于开发和生产环境，不过运行时需要使用命令 webpack –config webpack.dev.config.js</div><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// webpack.config.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = {</span><br><span class=\"line\">  entry: __dirname + <span class=\"string\">'/app/main.js'</span>, <span class=\"comment\">// 唯一入口文件</span></span><br><span class=\"line\">  output: {</span><br><span class=\"line\">      filename: <span class=\"string\">'bundle.js'</span>,         <span class=\"comment\">// 输出文件名</span></span><br><span class=\"line\">      path: __dirname + <span class=\"string\">\"/dist\"</span>,     <span class=\"comment\">// 输出文件存放地址</span></span><br><span class=\"line\">      <span class=\"comment\">// path: path.resolve(__dirname, 'dist') </span></span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><figure class=\"highlight\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// package.json文件中的scripts选项配置快捷执行方法</span><br><span class=\"line\">\"scripts\": {</span><br><span class=\"line\">  \"dev\":\"webpack --config webpack.dev.config.js\",</span><br><span class=\"line\">  \"pub\":\"webpack --config webpack.pub.config.js\",</span><br><span class=\"line\">  \"start\": \"webpack\",</span><br><span class=\"line\">  \"server\": \"webpack-dev-server --inline\" </span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure></li></ol><h2 id=\"高级配置\"><a href=\"#高级配置\" class=\"headerlink\" title=\"高级配置\"></a>高级配置</h2><h3 id=\"配置-Babel\"><a href=\"#配置-Babel\" class=\"headerlink\" title=\"配置 Babel\"></a>配置 Babel</h3><ul><li>功能：将 ES6、jsx等语法编译为浏览器能够运行的js</li><li>配置：webpack.config.js 或单独的 .babelrc 文件（webpack会自动调用）</li></ul><h3 id=\"生成-Source-Maps\"><a href=\"#生成-Source-Maps\" class=\"headerlink\" title=\"生成 Source Maps\"></a>生成 Source Maps</h3><div style=\"text-indent:2em\">有时打包后文件出错了，却不容易找到对应代码的位置，而通过配置 devtool 选项后，webpack 就可以在打包时生成 source maps，这为我们提供了一种对应编译文件和源文件的方法，使得编译后的代码可读性更高，也更容易调试。可选的四种配置如下：</div><ul><li>source-map：完整且功能完全的单独文件，但会减慢打包速度</li><li>cheap-module-source-map：不带列映射，只能对应到具体的行</li><li>eval-source-map：不影响速度且完整，但有隐患，可开发不可生产阶段</li><li>cheap-module-eval-source-map：生成Source Map最快且和js同行，不利于调试，推荐在大型项目考虑时间成本时使用</li></ul><h3 id=\"构建本地服务器\"><a href=\"#构建本地服务器\" class=\"headerlink\" title=\"构建本地服务器\"></a>构建本地服务器</h3><div style=\"text-indent:2em\">Webpack 提供一个可选的本地开发服务器 webpack-dev-server，它基于 Node.js 构建而且可以实现浏览器监听代码修改并自动刷新等效果，配置前需要通过 npm 安装它作为项目依赖。</div><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = {</span><br><span class=\"line\">    entry: __dirname + <span class=\"string\">'/app/main.js'</span>,</span><br><span class=\"line\">    output: {</span><br><span class=\"line\">        path: path.resolve(__dirname, <span class=\"string\">'dist'</span>),</span><br><span class=\"line\">        filename: <span class=\"string\">'bundle.js'</span></span><br><span class=\"line\">    },</span><br><span class=\"line\">    devServer: {</span><br><span class=\"line\">        contentBase: <span class=\"string\">\"./dist\"</span>,    <span class=\"comment\">// 加载页面的所在目录</span></span><br><span class=\"line\">        historyApiFallback: <span class=\"literal\">true</span>, <span class=\"comment\">// 不跳转</span></span><br><span class=\"line\">        inline: <span class=\"literal\">true</span>,   <span class=\"comment\">// 实时刷新</span></span><br><span class=\"line\">        hot: <span class=\"literal\">true</span>  <span class=\"comment\">// 热更新，即不刷新浏览器的前提下刷新页面</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 配置后执行 npm run server</span></span><br></pre></td></tr></tbody></table></figure><h1 id=\"八、版本管理工具-Git\"><a href=\"#八、版本管理工具-Git\" class=\"headerlink\" title=\"八、版本管理工具 Git\"></a>八、版本管理工具 Git</h1><h2 id=\"Git-和-Svn\"><a href=\"#Git-和-Svn\" class=\"headerlink\" title=\"Git 和 Svn\"></a>Git 和 Svn</h2><ol><li>Svn：集中式管理工具。所有版本文件都集中存放到一个服务器上，所有开发者都从该服务器上更新或上传修改代码，注意需要连网。</li><li>Git：分布式管理工具，分布式指每台电脑都是一个版本仓库，但在实际工作中一般会有一个集中的服务中心 Github。与集中式的最大区别在于开发者可以离线在本地提交, 只需在连网时push到相应的服务器或其他用户, 而且每个开发者通过克隆(git clone)可以在本地机器上拷贝一个完整的Git仓库。</li></ol><h2 id=\"Git-和-Github的关系\"><a href=\"#Git-和-Github的关系\" class=\"headerlink\" title=\"Git 和 Github的关系\"></a>Git 和 Github的关系</h2><ol><li>Git：指定了remote链接和用户信息（用户名+邮箱）之后，git可以帮你将提交过到你本地分支的代码push到远程的git仓库（任意提供了git托管服务的服务器上都可以，包括你自己建的服务器 或者 GitHub等网站提供的服务器）或者将远程仓库的代码 fetch 到本地。</li><li>Github：只是一个提供存储空间的服务器，用来存储git仓库。当然现在Github已经由一个存放git仓库的网站空间发展为了一个开源社区（不只具有存储git仓库的功能了），你可以参与别人的开源项目，也可以让别人参与你的开源项目。</li></ol><h2 id=\"工作流程\"><a href=\"#工作流程\" class=\"headerlink\" title=\"工作流程\"></a>工作流程</h2><div style=\"text-indent:2em\">开发者在自己的机器上更新服务器上的最新代码，然后根据需要创建分支，在该分支上提交本地修改的代码到远程仓库并通知主开发者合并代码。如果主开发者发现代码有冲突则让开发者修改后重新提交，没有冲突则合并代码。注意本地的 .git文件是指本地仓库，.git目录下存放着所有文件的版本和关联信息但默认隐藏。开发流程图如下</div><br><div align=\"center\"><br><img src=\"images/web/git_work.png\" alt=\"工作流程图\"><br></div><h2 id=\"常用命令-1\"><a href=\"#常用命令-1\" class=\"headerlink\" title=\"常用命令\"></a>常用命令</h2><div align=\"center\"><br><br><img src=\"images/web/git_order.png\" alt=\"常用命令图\"><br></div><h2 id=\"基础配置\"><a href=\"#基础配置\" class=\"headerlink\" title=\"基础配置\"></a>基础配置</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config --global --list         <span class=\"comment\">//查看全局配置</span></span><br><span class=\"line\">git config --global user.name <span class=\"string\">\"chuanggefighting\"</span>    <span class=\"comment\">//设置用户名</span></span><br><span class=\"line\">git config --global user.email <span class=\"string\">\"17621538916@163.com\"</span>    <span class=\"comment\">//设置邮箱</span></span><br></pre></td></tr></tbody></table></figure><h2 id=\"ssh密钥配置\"><a href=\"#ssh密钥配置\" class=\"headerlink\" title=\"ssh密钥配置\"></a>ssh密钥配置</h2><div style=\"text-indent:2em\">Git使用https协议，每次pull/push都要输入密码比较麻烦，而使用git协议后使用ssh密钥，这样可以省去每次都输密码。配置步骤如下：</div><ol><li>检测SSH keys是否存在：cd ~/.ssh</li><li><p>创建ssh key(生成密钥对)：ssh-keygen -t rsa -C “<a href=\"mailto:17621538916@163.com\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">17621538916@163.com</a>“</p><ul><li>此时会提示自定义名称和push时的密码 (不是git登录密码), 一般推荐略过(直接三个回车), 如果看到成功保存信息则说明如果创建成功</li></ul></li><li><p>添加公钥到github等个人的远程仓库</p><ol><li>查看生成的公钥：cat ~/.ssh/id_rsa.pub</li><li>登陆github：点击头像 –> Settings –> 左栏点击SSH and GPG keys –> 点击 New SSH key –> 复制上面的公钥内容，粘贴进”Key”，title自定义 –> 点击 Add key</li><li>测试SSH的连接：ssh -T <a href=\"mailto:git@github.com\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">git@github.com</a></li><li>输入yes后可看到信息</li></ol></li></ol><h2 id=\"工作提交代码\"><a href=\"#工作提交代码\" class=\"headerlink\" title=\"工作提交代码\"></a>工作提交代码</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  *  远程分支   -->  本地分支</span></span><br><span class=\"line\"><span class=\"comment\">  *  orgin/master --> master</span></span><br><span class=\"line\"><span class=\"comment\">  *  orgin/dev/t_lishi/xx --> dev/t_lishi/xx</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"></span><br><span class=\"line\">git fetch --all        <span class=\"comment\">//更新远程修改但不会merge</span></span><br><span class=\"line\">git reset --hard orgin/master  <span class=\"comment\">//强制更新(慎用)</span></span><br><span class=\"line\"></span><br><span class=\"line\">git pull orgin master  <span class=\"comment\">// 拉取代码到本地并合并到本地</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">git branch            <span class=\"comment\">// 查看本地分支</span></span><br><span class=\"line\">git checkout master   <span class=\"comment\">//切换到主分支分支</span></span><br><span class=\"line\"></span><br><span class=\"line\">git branch -D BranchName    <span class=\"comment\">// 删除本地分支(--delete/-d)</span></span><br><span class=\"line\">git branch -r -D origin/BranchName  <span class=\"comment\">// 删除远程分支</span></span><br><span class=\"line\">git push origin :BranchName   <span class=\"comment\">// 删除远程分支简单方法</span></span><br><span class=\"line\"></span><br><span class=\"line\">git checkout -b dev/t_lishi/Navigation  <span class=\"comment\">// 创建并切换到该分支          </span></span><br><span class=\"line\"><span class=\"comment\">// 相当于以下两个命令的合并</span></span><br><span class=\"line\">git branch branchName     新建    </span><br><span class=\"line\">git checkout branchName   切换</span><br><span class=\"line\"></span><br><span class=\"line\">git push origin dev/t_lishi/Navigation  <span class=\"comment\">// 推送到远端</span></span><br><span class=\"line\">git branch -a      <span class=\"comment\">// 查看远程分支</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 修改某个文件后操作</span></span><br><span class=\"line\">git status  查看状态</span><br><span class=\"line\">git add TaskDoc/t_lishi.log  <span class=\"comment\">// 指定需要提交到本地仓库的文件</span></span><br><span class=\"line\">git status </span><br><span class=\"line\">git commit -m <span class=\"string\">\"create Navigation\"</span>      提交代码到本地</span><br><span class=\"line\">git push origin dev/t_lishi/Navigation    推送到远程仓库</span><br></pre></td></tr></tbody></table></figure><h2 id=\"把个人网页挂到-Github\"><a href=\"#把个人网页挂到-Github\" class=\"headerlink\" title=\"把个人网页挂到 Github\"></a>把个人网页挂到 Github</h2><ol><li><strong>Github 上建立仓库，比如 resume</strong></li><li><strong>进入新建仓库并选择 “settings” 进行仓库设置，滚动到页面底部 “Github Pages” 部分</strong><ul><li>Source – master branch，保存后就会自动生成网址</li><li>生成网址拼接文件路径后访问：chuanggefighting.github.io/resume/dist/index.html</li></ul></li><li><p><strong>将仓库代码克隆到本地</strong></p><ul><li>删除除了 .git 以外的其他文件，然后通过以下命令测试<figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add *               <span class=\"comment\">// 添加到暂存区</span></span><br><span class=\"line\">git commit -m <span class=\"string\">'del'</span>     <span class=\"comment\">// 上传到本地仓库</span></span><br><span class=\"line\">git push origin master  <span class=\"comment\">// 上传到远程仓库</span></span><br></pre></td></tr></tbody></table></figure></li></ul></li><li><p><strong>更新个人代码到远程仓库</strong></p></li></ol><!-- rebuild by neat --></body></html>","site":{"data":{"next":{"override":false,"cache":{"enable":true},"favicon":{"small":"/images/favicon-16.ico","medium":"/images/favicon-32.ico","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"rss":"/atom.xml","footer":{"since":2019,"icon":{"name":"snowflake-o","animated":false,"color":"#808080"},"copyright":"chuangge","powered":{"enable":false,"version":true},"theme":{"enable":false,"version":true},"beian":{"enable":false,"icp":null}},"creative_commons":{"license":"by-nc-sa","sidebar":false,"post":false},"canonical":true,"seo":false,"index_with_subtitle":false,"exturl":false,"menu":{"home":"/ || home  //首页","tags":"/tags/ || tags  //标签","categories":"/categories/ || th   //分类","archives":"/archives/ || archive //归档"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":{"GitHub":"https://github.com/ || github","StackOverflow":"https://stackoverflow.com/ || stack-overflow"},"social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"友情链接","links_layout":"inline","links":{"个人简历":"https://chuanggefighting.github.io/project/","印记中文":"https://www.docschina.org/","在线工具":"http://tool.lu/","Learn Anything":"https://learn-anything.xyz/"},"avatar":{"url":"/images/chuang.png","rounded":true,"opacity":1,"rotated":true},"toc":{"enable":true,"number":true,"wrap":false,"max_depth":6},"sidebar":{"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"read_more_btn":true,"post_meta":{"item_text":true,"created_at":true,"updated_at":{"enabled":true,"another_day":true},"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":true,"awl":4,"wpm":275},"codeblock":{"border_radius":null,"copy_button":{"enable":false,"show_result":false}},"reward":{"enable":false},"related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_edit":{"enable":false,"url":"https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name"},"disable_baidu_tranformation":false,"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"font":{"enable":true,"host":"//fonts.proxy.ustclug.org","global":{"external":true,"family":"Lato","size":16},"headings":{"external":true,"family":"Roboto Slab","size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":"Lobster Two","size":24},"codes":{"external":true,"family":"Roboto Mono","size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css","copy_tex":{"enable":false,"copy_tex_js":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js","copy_tex_css":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css"}}},"pdf":{"enable":false,"per_page":true,"height":"500px","pdfobject":{"cdn":"//cdn.jsdelivr.net/npm/pdfobject@2.1.1/pdfobject.min.js"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":true,"appid":"snOvapuSplYTVflf5p9Ml9JX-gzGzoHsz","appkey":"5ABGdfyEdAtu6lTXdGdo7hf9","notify":false,"verify":false,"placeholder":"ヾﾉ≧∀≦)o 来呀！吐槽一番吧！","avatar":"mm","guest_info":"nick,mail,link","pageSize":10,"visitor":false,"comment_count":true},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"gitalk":{"enable":false,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true},"needmoreshare2":{"enable":true,"postbottom":{"enable":true,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null,"security":false,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":true,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":true,"pace_theme":"pace-theme-center-simple","canvas_nest":{"enable":true,"onmobile":true,"color":"0,0,255","opacity":0.5,"zIndex":-1,"count":99},"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"canvas_nest_nomobile":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"leancloud":null,"valine":null,"gitalk_js":null,"gitalk_css":null,"md5":null},"css":"css","js":"js","images":"images","passage_end_tag":{"enabled":true},"daovoice":true,"daovoice_app_id":"2ed51855"}}},"excerpt":"","more":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><h1 id=\"一、电脑系统-Mac\"><a href=\"#一、电脑系统-Mac\" class=\"headerlink\" title=\"一、电脑系统 Mac\"></a>一、电脑系统 Mac</h1><h2 id=\"操作系统\"><a href=\"#操作系统\" class=\"headerlink\" title=\"操作系统\"></a>操作系统</h2><ol><li><strong>Windows</strong><ul><li>人妻，什么都有，还常附带不想要的东西。</li><li>微软的系统，基于Basic开发，是最普及的桌面系统，主要特点是功能强大但安全堪忧，适用于正常办公以及游戏。</li></ul></li><li><strong>Mac OS/OSX</strong><ul><li>女友，带着有面子但必须按照它的规则。</li><li>苹果系统，基于linux开发，主要特点是应用软件较少和较安全，适用于办公的高端移动化处理。</li></ul></li><li><strong>Linux</strong><ul><li>小萝莉，你让它干嘛就干嘛。</li><li>一种自由和开放源码的类Unix操作系统，可安装在手机电脑等各种计算机硬件设备中，主要特点是网络功能强大且对内存等硬件的消耗小，多用于网络服务器中，优点是其易用性和丰富的应用软件。</li></ul></li></ol><h2 id=\"操作接口\"><a href=\"#操作接口\" class=\"headerlink\" title=\"操作接口\"></a>操作接口</h2><ol><li><strong>终端 terminal</strong><ul><li>用于人与计算机进行交互的输入输出接口</li><li>本质是通过电缆、网络等连接主机的外部附加设备，一台计算机可以连接个终端</li></ul></li><li><strong>控制台 console</strong><ul><li>用于管理主机的特殊终端，只允许管理员使用</li><li>本质是直接和计算机相连接的原生设备，一台计算机一般只能有一个控制台</li></ul></li><li><strong>命令解释器 shell</strong><ul><li>提供用户界面的程序，用于与计算机内核交互</li><li>本质是 接受用户指令后，调用其他程序与内核交互完成指令</li><li>一般分为 命令行shell 和 图形shell，分别提供 命令行界面 CLI 和 图形用户界面 GUI</li><li>批处理：将一系列命令按照一定顺序集合为一个可执行的文本文件，在window系统的扩展名为 bat/cmd，双击文件即可运行</li></ul></li><li><strong>终端与 shell 的分工</strong><ul><li>终端从用户接受 鼠标键盘等设备的输入信息，然后发送给 shell</li><li>shell 从终端获取用户指令，解析后发给计算机内核执行，并返回结果给终端</li></ul></li></ol><h2 id=\"mac\"><a href=\"#mac\" class=\"headerlink\" title=\"mac\"></a>mac</h2><ol><li><strong>应用软件安装</strong><ul><li>通过 App Stroe 安装</li><li>将浏览器中下载好的 dmg 安装包拖到”应用程序”目录</li></ul></li><li><strong>系统软件安装</strong><ul><li>brew 即 Homebrew，是 Mac OSX 上的软件包管理工具，用来安装、更新、卸载软件</li><li>命令行配置环境变量：vi ~/.bash_profile - 编辑文件 - esc键退出编辑 - :wq回车保存</li></ul></li><li><strong>实现翻墙</strong><ul><li>配置 VPN：VPN 即虚拟专用网络，可用来保护隐私和自由访问外国网站</li><li>配置 proxy：即配置代理地址</li></ul></li></ol><h1 id=\"二、浏览器-chrome\"><a href=\"#二、浏览器-chrome\" class=\"headerlink\" title=\"二、浏览器 chrome\"></a>二、浏览器 chrome</h1><ol><li><strong>搜索</strong>（Google输入框中所有空格都被理解为加号）<ul><li>完整匹配: “mysql foreign key”（引号）</li><li>筛选: “mysql key” - “nodejs”（加减号）</li><li>返回所有: “mysql connect error *”（加通配符）</li><li>站内搜索: “mysql foreign key” site:stackoverflow.com</li><li>加速: 输入网址后点击Tab，这样可直接使用该站点的站内搜索</li></ul></li><li><strong>调试js代码</strong><ul><li>Alert, Console等</li><li>断点调试<ul><li>步骤：F12开发者工具 ——&gt; 点击Sources菜单 ——&gt; 左侧树中找到相应文件 ——&gt; 点击行号列(右键为条件断点) ——&gt; 刷新页面 ——&gt; JS执行到断点位置停住，此时可以跟随鼠标查看功能按钮</li><li><a href=\"http://blog.csdn.net/crper/article/details/50722753\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">相关技巧</a></li></ul></li><li>debug断点<ul><li>在触发文件中添加 “debugger;” 语句后触发，当代码执行到该语句时就会自动断点, 接下去的操作和在Sources面板添加断点调试几乎一模一样，唯一区别在于调试后需要删除该语句。</li><li>由于有时会遇到异步加载html片段的情况，其JS代码在Sources中无法找到，因此无法直接在开发工具中直接添加断点时可用debug断点（F10一步一步执行，F8一下执行完成）</li></ul></li></ul></li><li><strong>高阶调试功能</strong><ul><li><a href=\"https://www.cnblogs.com/guaidianqiao/p/7615430.html\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">内置抓包工具等</a></li></ul></li><li><strong>扩展插件</strong><ul><li>谷歌访问助手<ul><li>安装：<a href=\"http://www.ggfwzs.com/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">下载安装包</a> ——&gt; 更多工具 ——&gt; 扩展程序 ——&gt; 直接拖拽 ——&gt; 添加扩展程序</li><li>扩展其它插件：谷歌访问助手 ——&gt; 谷歌网上商店 ——&gt; 搜索插件 ——&gt; 点击添加扩展</li></ul></li><li>常用插件推荐<ul><li>掘金</li><li>Google翻译</li><li>FeHelper</li><li>JSONView</li><li>What runs</li><li>Clear Cache</li><li>Code Plunker</li><li>Vue.js devtools</li><li>AngularJS Batarang</li><li>React Developer Tools</li></ul></li></ul></li><li><strong>Chrome黑科技</strong><ul><li>实现翻墙<ul><li>配置proxy代理：setting system ——&gt; proxy settings ——&gt; LAN setting ——&gt; proxy server ——&gt; 配置 Address 和 Port</li><li>配置Chrome扩展：下载<a href=\"https://www.crx4chrome.com/crx/39922/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Hoxx VPN Proxy</a> ——&gt; 注册登录</li></ul></li><li>解析VIP视频<ul><li>打开网站 <a href=\"https://greasyfork.org/zh-CN\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Greasy Fork</a> ——&gt; 搜索VIP视频解析 ——&gt; 安装脚本</li></ul></li><li>其它：视频广告过滤、电脑管家上网防护等</li></ul></li></ol><h1 id=\"三、代码编辑器-vscode\"><a href=\"#三、代码编辑器-vscode\" class=\"headerlink\" title=\"三、代码编辑器 vscode\"></a>三、代码编辑器 vscode</h1><blockquote><p>常用扩展插件</p></blockquote><ul><li>显示效果类<ul><li>Dracula Official ：高亮主题</li><li>Beautify ：代码高亮</li><li>vscode-icon ：让资源树目录加上图标</li><li>Bracket Pair Colorizer ：每一对括号用不同颜色区别</li><li>Open-In-Browser ：直接在浏览器中打开文件的快捷菜单 alt + b</li></ul></li><li>辅助编辑类<ul><li>ESlint ：检测js</li><li>Prettier ：代码格式化 alt + shift + F</li><li>CSS Peek ：追踪至定义处（右键选择前两个选项）</li><li>Path Intellisense ：自动补全路径</li><li>Auto Close Tag ：自动闭合HTML标签</li><li>Auto Rename Tag ：自动修改匹配的标签</li><li>HTML CSS Support ：CSS的智能补全</li><li>JavaScript (ES6) code snippets ：JS语法提示</li></ul></li><li>Vue插件类<ul><li>Vetur ：语法高亮</li><li>VueHelper ：vue代码提示插件</li><li>Vue 2 Snippets ：语法高亮 + 代码补全</li><li>HTML Snippets ：在.vue文件中使用html代码补全功能</li></ul></li><li>其它类<ul><li>npm ：运行npm命令</li><li>npm Intellisense ：导入时提示已安装模块</li><li>Python ：添加对.py文件的支持</li><li>GitLens ：简单实现git提交代码</li><li>Debugger for chrome ：调试Debug</li></ul></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// vscode 基础配置</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 配置中文：ctrl + shift + p --&gt; Display Language</span></span><br><span class=\"line\">    <span class=\"string\">\"locale\"</span>:<span class=\"string\">\"zh-CN\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 用户配置：文件 --&gt; 首选项 --&gt; 设置 --&gt; User Settings</span></span><br><span class=\"line\">    <span class=\"comment\">// 指定工作台中使用的颜色主题。    </span></span><br><span class=\"line\">    <span class=\"string\">\"workbench.colorTheme\"</span>: <span class=\"string\">\"Monokai\"</span>,    </span><br><span class=\"line\">    <span class=\"comment\">// 指定在工作台中使用的图标主题    </span></span><br><span class=\"line\">    <span class=\"string\">\"workbench.iconTheme\"</span>: <span class=\"string\">\"vscode-icons\"</span>,    </span><br><span class=\"line\">    <span class=\"comment\">// 窗口失去焦点自动保存    </span></span><br><span class=\"line\">    <span class=\"string\">\"files.autoSave\"</span>: <span class=\"string\">\"off\"</span>,    </span><br><span class=\"line\">    <span class=\"comment\">// 如果设置为 \"true\"，将不再显示扩展建议的通知。   </span></span><br><span class=\"line\">    <span class=\"string\">\"extensions.ignoreRecommendations\"</span>: <span class=\"literal\">true</span>,    </span><br><span class=\"line\">    <span class=\"comment\">// 如果设置成 true，关于新的版本消息将不再显示    </span></span><br><span class=\"line\">    <span class=\"string\">\"vsicons.dontShowNewVersionMessage\"</span>: <span class=\"literal\">true</span>,    </span><br><span class=\"line\">    <span class=\"comment\">// 控制是否将打开的编辑器显示为预览。    </span></span><br><span class=\"line\">    <span class=\"string\">\"workbench.editor.enablePreview\"</span>: <span class=\"literal\">false</span>,   </span><br><span class=\"line\">    <span class=\"comment\">// 字体字号</span></span><br><span class=\"line\">    <span class=\"string\">\"editor.fontSize\"</span>: <span class=\"number\">18</span>, </span><br><span class=\"line\">    <span class=\"comment\">//代码缩进风格4个字符    </span></span><br><span class=\"line\">    <span class=\"string\">\"editor.tabSize\"</span>: <span class=\"number\">4</span>,    </span><br><span class=\"line\">    <span class=\"comment\">// 控制编辑器是否应在键入后自动设置行的格式    </span></span><br><span class=\"line\">    <span class=\"string\">\"editor.formatOnType\"</span>: <span class=\"literal\">false</span>,    </span><br><span class=\"line\">    <span class=\"comment\">// 保存时取消自动格式化    </span></span><br><span class=\"line\">    <span class=\"string\">\"editor.formatOnSave\"</span>: <span class=\"literal\">false</span>,    </span><br><span class=\"line\">    <span class=\"comment\">// 编辑粘贴取消自动格式化    </span></span><br><span class=\"line\">    <span class=\"string\">\"editor.formatOnPaste\"</span>: <span class=\"literal\">false</span>,    </span><br><span class=\"line\">    <span class=\"comment\">// 控制编辑器中呈现空白字符的方式为“边界”，不会在单词之间呈现单空格。    </span></span><br><span class=\"line\">    <span class=\"string\">\"editor.renderWhitespace\"</span>: <span class=\"string\">\"boundary\"</span>,    </span><br><span class=\"line\">    <span class=\"comment\">// 控制光标动画样式    </span></span><br><span class=\"line\">    <span class=\"string\">\"editor.cursorBlinking\"</span>: <span class=\"string\">\"smooth\"</span>,    </span><br><span class=\"line\">    <span class=\"comment\">//设置Eslint需要验证的语言    </span></span><br><span class=\"line\">    <span class=\"string\">\"eslint.validate\"</span>: [        </span><br><span class=\"line\">        <span class=\"string\">\"javascript\"</span>,        </span><br><span class=\"line\">        <span class=\"string\">\"javascriptreact\"</span>,        </span><br><span class=\"line\">        <span class=\"string\">\"html\"</span>,        </span><br><span class=\"line\">        <span class=\"string\">\"vue\"</span>,        </span><br><span class=\"line\">        &#123;            </span><br><span class=\"line\">            <span class=\"string\">\"language\"</span>: <span class=\"string\">\"vue\"</span>,            </span><br><span class=\"line\">            <span class=\"string\">\"autoFix\"</span>: <span class=\"literal\">true</span>        </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"comment\">//每列显示内容长多，超出时控制编辑器列的换行。</span></span><br><span class=\"line\">    <span class=\"string\">\"editor.wordWrap\"</span>: <span class=\"string\">\"wordWrapColumn\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"editor.wordWrapColumn\"</span>: <span class=\"number\">150</span>,</span><br><span class=\"line\">    <span class=\"comment\">//创建人，修改人    </span></span><br><span class=\"line\">    <span class=\"string\">\"fileheader.Author\"</span>: <span class=\"string\">\"klierbyck\"</span>,    </span><br><span class=\"line\">    <span class=\"string\">\"fileheader.LastModifiedBy\"</span>: <span class=\"string\">\"klierbyck\"</span>,    </span><br><span class=\"line\">    <span class=\"comment\">// 在函数参数括号前定义空格处理。需要 TypeScript &gt;= 2.1.5。    </span></span><br><span class=\"line\">    <span class=\"string\">\"typescript.format.insertSpaceBeforeFunctionParenthesis\"</span>: <span class=\"literal\">true</span>,    </span><br><span class=\"line\">    <span class=\"comment\">// 在函数参数括号前定义空格处理。需要 TypeScript &gt;= 2.1.5。    </span></span><br><span class=\"line\">    <span class=\"string\">\"javascript.format.insertSpaceBeforeFunctionParenthesis\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"comment\">// HTML Snippets 插件配置</span></span><br><span class=\"line\">    <span class=\"string\">\"emmet.triggerExpansionOnTab\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"string\">\"emmet.includeLanguages\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">\"vue-html\"</span>: <span class=\"string\">\"html\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"vue\"</span>: <span class=\"string\">\"html\"</span></span><br><span class=\"line\">    &#125;,</span><br></pre></td></tr></table></figure><h1 id=\"四、前端自动化构建\"><a href=\"#四、前端自动化构建\" class=\"headerlink\" title=\"四、前端自动化构建\"></a>四、前端自动化构建</h1><h2 id=\"构建需求\"><a href=\"#构建需求\" class=\"headerlink\" title=\"构建需求\"></a>构建需求</h2><ol><li><p><strong>预处理</strong></p><div style=\"text-indent:2em\">低层语言的更换或升级都因兼容性问题而面临着巨大困难，这催生了各种中间语言的预处理器，例如 通过 Babel 将 ES6 转换成可以在浏览器中运行的 js代码，通过 Sass/Less/Stylus 可以在线编程并转换成 css代码。</div></li><li><p><strong>风格与测试</strong></p><div style=\"text-indent:2em\">在一个典型的工作流中，每次Push主分支或npm发布都应首先运行代码风格检查和单元测试。我们需要这些操作能够在合适的时候自动执行。</div></li><li><p><strong>资源压缩</strong></p><div style=\"text-indent:2em\">在开发网站代码时，我们希望模块化地进行编码，即每个业务逻辑、通用工具或者架构元素都需要组织在单独的文件中。但是如果用户浏览网页时也载入这么多源文件则会影响页面打开速度，因此在网站发布时需要将源码合并压缩，js可能还需要模块化，CSS文件可能还需要合并、添加兼容性前缀等，这些重复性工作我们也希望写成脚本。</div></li><li><p><strong>静态资源的URL替换</strong></p><div style=\"text-indent:2em\">该需求最复杂, 因为生产环境中的资源地址可能和开发环境中很不同，可能是由于JS合并、CSS合并，也可能是由于应用了CDN加速。我们需要在部署时更改所有HTML文件中的静态资源地址。</div></li></ol><h2 id=\"构建工具\"><a href=\"#构建工具\" class=\"headerlink\" title=\"构建工具\"></a>构建工具</h2><div style=\"text-indent:2em\">“自动化构建”是指通过工具实现构建系统、编译和转换代码、压缩资源、部署配置等功能，优化”从源码到网页”的开发流程，这有利于提高开发效率并改善代码质量。</div><br><div style=\"text-indent:2em\">所有的开发工具都是为了使大量低技术含量任务完成自动化从而减轻工作，它们的组合使用完全看个人选择。开发过程一般会以Node和npm为核心，然后搭配 Gulp + Bower 或者 Webpack。</div><ol><li><strong>执行通用任务</strong><ul><li>NPM / Bower：基于NodeJS的包管理和分发工具，用来下载、安装、上传以及管理已经安装的包</li><li>Gulp / Grunt：基于NodeJS的自动化构建工具，用来自动化完成一些常见的、重复的Web开发任务，如网页自动刷新和预处理等。两者最大区别是Gulp采取流式接口。</li></ul></li><li><strong>模块绑定</strong><ul><li>Webpack：前端资源模块化管理和打包工具，用来配置各种模块所需要的处理方式，常见配置有 scss 代码预处理、ES6 代码转换、模块打包的规则和地址等</li><li>Browserify：打包工具，常用于将 Node 项目模块打包成浏览器支持形式</li><li>RequireJS：Js模块加载器，常用于 NodeJS 中加载模块</li></ul></li><li><strong>代码分析</strong><ul><li>ESLint / JSLint：检测工具，常用于分析代码中潜在错误。</li></ul></li><li><strong>单元测试</strong><ul><li>Jasmine：测试工具，常用于测试自己的代码</li></ul></li></ol><h1 id=\"五、安装工具-NPM\"><a href=\"#五、安装工具-NPM\" class=\"headerlink\" title=\"五、安装工具 NPM\"></a>五、安装工具 NPM</h1><h2 id=\"使用场景\"><a href=\"#使用场景\" class=\"headerlink\" title=\"使用场景\"></a>使用场景</h2><ul><li>从NPM服务器下载别人编写的三方包到本地使用</li><li>从NPM服务器下载并安装别人编写的命令行程序到本地使用</li><li>将自己编写的包或命令行程序上传到NPM服务器供别人使用</li></ul><h2 id=\"常用命令\"><a href=\"#常用命令\" class=\"headerlink\" title=\"常用命令\"></a>常用命令</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm -v                    <span class=\"comment\">//查看npm版本</span></span><br><span class=\"line\">npm list                  <span class=\"comment\">//当前目录已安装插件</span></span><br><span class=\"line\">npm init                  <span class=\"comment\">//生成package.json文件</span></span><br><span class=\"line\"></span><br><span class=\"line\">npm i &lt;name&gt; -g           <span class=\"comment\">//安装包</span></span><br><span class=\"line\">npm uninstall &lt;name&gt;      <span class=\"comment\">//卸载包</span></span><br><span class=\"line\">npm update &lt;name&gt;         <span class=\"comment\">//更新包   </span></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * 可添加的修饰符</span></span><br><span class=\"line\"><span class=\"comment\">  *     -g                 全局(不加则为本地安装)</span></span><br><span class=\"line\"><span class=\"comment\">  *     -S / --save        需要发布到生产环境的依赖(默认)</span></span><br><span class=\"line\"><span class=\"comment\">  *     -D / --save-dev    只用于开发环境的依赖</span></span><br><span class=\"line\"><span class=\"comment\">  *     --no-save          不写入package.json的依赖</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"></span><br><span class=\"line\">npm run script-key        <span class=\"comment\">// 执行package.json中 \"scripts\" 选项对应的js </span></span><br><span class=\"line\">npm start                 <span class=\"comment\">// 比较特殊</span></span><br></pre></td></tr></table></figure><h2 id=\"发布npm包\"><a href=\"#发布npm包\" class=\"headerlink\" title=\"发布npm包\"></a>发布npm包</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd test                 <span class=\"comment\">// 选择目标文件夹</span></span><br><span class=\"line\">npm init                <span class=\"comment\">// 配置包的相关信息</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"number\">1</span>      <span class=\"comment\">// 编辑包 test/index.js</span></span><br><span class=\"line\"></span><br><span class=\"line\">npm adduser             <span class=\"comment\">// 注册，第一次发布包</span></span><br><span class=\"line\">npm login               <span class=\"comment\">// 登录，非第一次发布包</span></span><br><span class=\"line\"></span><br><span class=\"line\">npm publish            <span class=\"comment\">// 发布/更新包</span></span><br><span class=\"line\">npm install 包名        <span class=\"comment\">// npm官网搜索后验证下载</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 撤销发布的包要用force强制删除。超过24小时就不能删除了</span></span><br><span class=\"line\">npm --force unpublish 包名</span><br></pre></td></tr></table></figure><h1 id=\"六、构建工具-Gulp\"><a href=\"#六、构建工具-Gulp\" class=\"headerlink\" title=\"六、构建工具 Gulp\"></a>六、构建工具 Gulp</h1><h2 id=\"常用插件\"><a href=\"#常用插件\" class=\"headerlink\" title=\"常用插件\"></a>常用插件</h2><ul><li>gulp-minify-html：压缩html</li><li>gulp-minify-css：压缩css</li><li>gulp-uglify：压缩js</li><li>gulp-smushit：压缩图片</li><li>gulp-concat：文件合并</li><li>gulp-rename：重命名</li><li>gulp-babel：编译ES6</li><li>gulp-sass/less：css预处理</li><li>gulp-autoprefixer：自动添加css前缀</li><li>browser-sync：自动刷新页面(非gulp插件)</li></ul><h2 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h2><ul><li>task：创建任务</li><li>run：运行任务</li><li>watch：监听任务</li><li>src：设置需处理的文件路径(正则/数组)</li><li>dest：设置生成文件的路径，一个任务可有多个生成路径</li></ul><h2 id=\"设置任务\"><a href=\"#设置任务\" class=\"headerlink\" title=\"设置任务\"></a>设置任务</h2><ol><li><strong>服务器</strong><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> gulp = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp'</span>),</span><br><span class=\"line\">    browserSync = <span class=\"built_in\">require</span>(<span class=\"string\">'browser-sync'</span>);</span><br><span class=\"line\"><span class=\"comment\">// 1.搭建静态服务器</span></span><br><span class=\"line\">gulp.task(<span class=\"string\">'browser-sync'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    browserSync.init(&#123;</span><br><span class=\"line\">        files:[<span class=\"string\">'**'</span>],</span><br><span class=\"line\">        server:&#123;</span><br><span class=\"line\">            baseDir:<span class=\"string\">'./'</span>,             <span class=\"comment\">// 服务器的根目录</span></span><br><span class=\"line\">            index:<span class=\"string\">'blink/blink.html'</span>  <span class=\"comment\">// 默认打开的文件</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        port:<span class=\"number\">8050</span>  <span class=\"comment\">// 指定访问服务器的端口号</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">// 2.使用代理（注意本地服务器必须自己搭建的）</span></span><br><span class=\"line\">gulp.task(<span class=\"string\">'browser-sync'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    browserSync.init(&#123;</span><br><span class=\"line\">        files:[<span class=\"string\">'**'</span>],</span><br><span class=\"line\">        proxy:<span class=\"string\">'localhost'</span>,  <span class=\"comment\">// 本地服务器的地址</span></span><br><span class=\"line\">        port:<span class=\"number\">8080</span>           <span class=\"comment\">// 访问的端口号</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></li></ol><ol start=\"2\"><li><strong>默认任务</strong><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gulp.task(<span class=\"string\">'default'</span>,[<span class=\"string\">'serve'</span>]);  </span><br><span class=\"line\">gulp.task(<span class=\"string\">'server'</span>,[<span class=\"string\">'sass'</span>,<span class=\"string\">'mihtml'</span>,<span class=\"string\">'minijs'</span>],<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    bs.init(&#123;</span><br><span class=\"line\">        open:<span class=\"string\">'external'</span>,</span><br><span class=\"line\">        server:<span class=\"string\">'./build'</span>  <span class=\"comment\">//服务根目录</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"comment\">// 监听html</span></span><br><span class=\"line\">    gulp.watch(<span class=\"string\">'./html/*.html'</span>,[<span class=\"string\">'mihtml'</span>])</span><br><span class=\"line\">    gulp.watch(<span class=\"string\">'./build/html/*.html'</span>).on(<span class=\"string\">'change'</span>,reload)</span><br><span class=\"line\">&#125;) </span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\">gulp.task(<span class=\"string\">'default'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    gulp.run(<span class=\"string\">'lint'</span>, <span class=\"string\">'sass'</span>, <span class=\"string\">'scripts'</span>);</span><br><span class=\"line\">      <span class=\"comment\">// 监听sass文件变化</span></span><br><span class=\"line\">    gulp.watch(<span class=\"string\">'src/sass/*.sass'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        gulp.run(<span class=\"string\">'lint'</span>, <span class=\"string\">'sass'</span>, <span class=\"string\">'scripts'</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></li></ol><h2 id=\"基础使用\"><a href=\"#基础使用\" class=\"headerlink\" title=\"基础使用\"></a>基础使用</h2><ol><li><strong>初始化目录</strong><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">├── app              <span class=\"comment\">// 工作目录：源文件</span></span><br><span class=\"line\">│   ├── js</span><br><span class=\"line\">│   ├── Sass</span><br><span class=\"line\">│   └── index.html</span><br><span class=\"line\">│</span><br><span class=\"line\">├── dist            <span class=\"comment\">// 目标目录：编译、压缩后的文件</span></span><br><span class=\"line\">└── release         <span class=\"comment\">// 可以发布到服务器的文件目录</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">cnpm install gulp -g  <span class=\"comment\">// 全局安装，执行gulp任务</span></span><br><span class=\"line\">cd GulpTest </span><br><span class=\"line\">cnpm init      <span class=\"comment\">// 生成package.json文件</span></span><br><span class=\"line\">cnpm install gulp -S  <span class=\"comment\">// 本地安装，使用gulp插件并避免版本冲突</span></span><br><span class=\"line\">gulp -v       <span class=\"comment\">// 查看版本</span></span><br></pre></td></tr></table></figure></li></ol><ol start=\"2\"><li><p><strong>编写配置文件 gulpfile.js</strong></p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> gulp = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> sass = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp-sass'</span>);        <span class=\"comment\">//编译sass</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> maps = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp-sourcemaps'</span>);  <span class=\"comment\">//在浏览器显示scss样式以便调试</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> autoprefixer = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp-autoprefixer'</span>);  <span class=\"comment\">//自动添加前后缀</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> htmlmin = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp-htmlmin'</span>);  <span class=\"comment\">//html压缩</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> uglify = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp-uglify'</span>);    <span class=\"comment\">//压缩js文件</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> smushit = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp-smushit'</span>);  <span class=\"comment\">//图片压缩</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> concat = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp-concat'</span>);    <span class=\"comment\">//文件合并</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> babel = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp-babel'</span>);      <span class=\"comment\">//将ES6代码编译成ES5</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> bs = <span class=\"built_in\">require</span>(<span class=\"string\">'browser-sync'</span>).create();  <span class=\"comment\">//页面同步</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> reload = bs.reload;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 默认任务</span></span><br><span class=\"line\">gulp.task(<span class=\"string\">'default'</span>, [<span class=\"string\">'server'</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 打包任务</span></span><br><span class=\"line\"><span class=\"comment\">// gulp.task('build', ['html', 'css', 'less', 'js'])</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// sass 任务</span></span><br><span class=\"line\">gulp.task(<span class=\"string\">'sass'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> gulp.src(<span class=\"string\">'./src/scss/*.scss'</span>)  <span class=\"comment\">// 导入文件</span></span><br><span class=\"line\">    .pipe(maps.init())        <span class=\"comment\">// 将页面样式定义到scss</span></span><br><span class=\"line\">      <span class=\"comment\">// 转译scss到css,报错时输出错误信息,不终止程序运行 </span></span><br><span class=\"line\">    .pipe(sass(&#123;<span class=\"string\">\"outputStyle\"</span>: <span class=\"string\">\"compressed\"</span>&#125;).on(<span class=\"string\">'error'</span>, sass.logError))</span><br><span class=\"line\">                                </span><br><span class=\"line\">    .pipe(autoprefixer())       <span class=\"comment\">// 自动添加前后缀</span></span><br><span class=\"line\">    .pipe(maps.write(<span class=\"string\">'./'</span>))     <span class=\"comment\">// 生成map文件（和css文件放在一起）</span></span><br><span class=\"line\">    .pipe(gulp.dest(<span class=\"string\">'./dist/css'</span>))    <span class=\"comment\">// 将生成的文件放到css文件夹中</span></span><br><span class=\"line\">    .pipe(reload(&#123;<span class=\"attr\">stream</span>:<span class=\"literal\">true</span>&#125;))       </span><br><span class=\"line\">    <span class=\"comment\">// 任务完成后（监听关闭后），再有修改时重新启动监听时会重新执行以防报错</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 压缩 html </span></span><br><span class=\"line\">gulp.task(<span class=\"string\">'mihtml'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> options = &#123;</span><br><span class=\"line\">        removeComments: <span class=\"literal\">true</span>,     <span class=\"comment\">// 清除HTML注释</span></span><br><span class=\"line\">        collapseWhitespace: <span class=\"literal\">true</span>, <span class=\"comment\">// 压缩HTML</span></span><br><span class=\"line\">        minfyJS: <span class=\"literal\">true</span>,     <span class=\"comment\">// 压缩JS</span></span><br><span class=\"line\">        minfyCss: <span class=\"literal\">true</span>,    <span class=\"comment\">// 压缩CSS</span></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> gulp.src(<span class=\"string\">'./src/html/*.html'</span>)  </span><br><span class=\"line\">        .pipe(htmlmin(options))  </span><br><span class=\"line\">        .pipe(gulp.dest(<span class=\"string\">'./dist/html/'</span>))</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 压缩 js </span></span><br><span class=\"line\">gulp.task(<span class=\"string\">'minijs'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;   </span><br><span class=\"line\">    gulp.src(<span class=\"string\">'!./src/js/*.js'</span>)       <span class=\"comment\">// !表示除了...之外 </span></span><br><span class=\"line\">    .pipe(babel())</span><br><span class=\"line\">    .pipe(uglify())<span class=\"comment\">//压缩  </span></span><br><span class=\"line\">    <span class=\"comment\">// .pipe(concat('all.min.js'))   //合并到all.min.js中  </span></span><br><span class=\"line\">    .pipe(gulp.dest(<span class=\"string\">'./dist/js/'</span>));  <span class=\"comment\">//指定目录  </span></span><br><span class=\"line\">&#125;); </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 压缩 img </span></span><br><span class=\"line\">gulp.task(<span class=\"string\">'img'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> gulp.src(<span class=\"string\">'./src/img/*.*'</span>)</span><br><span class=\"line\">        .pipe(smushit(&#123;</span><br><span class=\"line\">            verbose: <span class=\"literal\">true</span></span><br><span class=\"line\">        &#125;))</span><br><span class=\"line\">        .pipe(gulp.dest(<span class=\"string\">'./dist/img/'</span>));</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">//生成服务并自动化监听项目</span></span><br><span class=\"line\">gulp.task(<span class=\"string\">'server'</span>, [<span class=\"string\">'sass'</span>,<span class=\"string\">'mihtml'</span>,<span class=\"string\">'minijs'</span>], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    bs.init(&#123;</span><br><span class=\"line\">      open: <span class=\"string\">'external'</span>,  <span class=\"comment\">//启动时自动打开的网址(local打开本地主机网址)</span></span><br><span class=\"line\">      server: <span class=\"string\">'./dist/html'</span> <span class=\"comment\">//设置根目录dist(默认打开其中index.html)</span></span><br><span class=\"line\">      <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        默认打开 test.html</span></span><br><span class=\"line\"><span class=\"comment\">        baseDir: \"./\",</span></span><br><span class=\"line\"><span class=\"comment\">        index: \"test.html\"</span></span><br><span class=\"line\"><span class=\"comment\">      */</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"comment\">// 监听html</span></span><br><span class=\"line\">    gulp.watch(<span class=\"string\">'./src/html/*.html'</span>, [<span class=\"string\">'mihtml'</span>])</span><br><span class=\"line\">    gulp.watch(<span class=\"string\">'./dist/html/*.html'</span>).on(<span class=\"string\">'change'</span>, reload)</span><br><span class=\"line\">    <span class=\"comment\">//监听scss</span></span><br><span class=\"line\">    gulp.watch(<span class=\"string\">'./src/scss/*.scss'</span>,[<span class=\"string\">'sass'</span>]);</span><br><span class=\"line\">    gulp.watch(<span class=\"string\">'./dist/css/*.css'</span>).on(<span class=\"string\">'change'</span>, reload)</span><br><span class=\"line\">    <span class=\"comment\">//监听js</span></span><br><span class=\"line\">    gulp.watch(<span class=\"string\">'./src/js/*.js'</span>, [<span class=\"string\">'minijs'</span>])</span><br><span class=\"line\">    gulp.watch(<span class=\"string\">'./dist/js/*js'</span>).on(<span class=\"string\">'change'</span>, reload)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><strong>运行gulp</strong></p><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 定义 package.json 文件中的 scripts</span><br><span class=\"line\">\"scripts\": &#123;</span><br><span class=\"line\">  \"test\": \"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\",</span><br><span class=\"line\">  \"start\": \"gulp dev\",                   //执行gulp dev命令</span><br><span class=\"line\">  \"clean\": \"rimraf dist\",                // 清空删除dist中所有文件</span><br><span class=\"line\">  \"build\": \"rimraf dist &amp;&amp; gulp build\"   // 执行两个命令，先清空dist再重新打包</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">//注意先全局安装rimraf: npm install rimraf -g</span><br></pre></td></tr></table></figure></li></ol><h1 id=\"七、打包工具-Webpack\"><a href=\"#七、打包工具-Webpack\" class=\"headerlink\" title=\"七、打包工具 Webpack\"></a>七、打包工具 Webpack</h1><h2 id=\"模块打包工具\"><a href=\"#模块打包工具\" class=\"headerlink\" title=\"模块打包工具\"></a>模块打包工具</h2><div style=\"text-indent:2em\">分析项目结构，找到Js模块和浏览器不能直接运行的拓展语言（Scss、TypeScript 等），并将其转换和打包为合适的格式供浏览器使用。在很多场景下可以替代Gulp/Grunt类的工具，工作流程如下：</div><ul><li>Gulp/Grunt：在一个配置文件中，指定对某些文件进行编译、组合、压缩等任务的具体步骤，工具会自动替你完成这些任务。</li><li>Webpack：把项目当做一个整体，从一个给定主文件(如index.js)开始找到项目的所有依赖文件，使用loaders处理它们，把所有的非js资源(css/img等)都转换成 js，然后用 CommonJS 的机制管理起来。</li></ul><h2 id=\"核心概念\"><a href=\"#核心概念\" class=\"headerlink\" title=\"核心概念\"></a>核心概念</h2><ul><li>入口（entry）：即要编译的文件。指定后webpack会自行寻找依赖的文件打包编译</li><li>输出（output）：编译转换好之后的文件写入位置</li><li>加载器（loader）：转换scss、ES6等不同类型的文件，从而可以在浏览器中运行</li><li>插件（plugin）：完成压缩文件等loader无法解决的功能</li></ul><h2 id=\"基础使用-1\"><a href=\"#基础使用-1\" class=\"headerlink\" title=\"基础使用\"></a>基础使用</h2><ol><li><p><strong>初始化目录</strong></p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">WebTest</span><br><span class=\"line\">  ├── app              <span class=\"comment\">// 工作目录：源文件</span></span><br><span class=\"line\">  │   ├── main.js</span><br><span class=\"line\">  │   └── hello.js</span><br><span class=\"line\">  │</span><br><span class=\"line\">  ├── dist            <span class=\"comment\">// 目标目录：打包生成的 js 文件</span></span><br><span class=\"line\">  │   └── index.html</span><br><span class=\"line\">  │</span><br><span class=\"line\">  ├── node_moudles</span><br><span class=\"line\">  └── package.json </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// index.html</span></span><br><span class=\"line\">div id=<span class=\"string\">\"app\"</span>         </span><br><span class=\"line\">script src=<span class=\"string\">\"bundle.js\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// hello.js</span></span><br><span class=\"line\">moudle.exports = <span class=\"string\">\"hello world\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// main.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> str = <span class=\"built_in\">require</span>(<span class=\"string\">\"./hello.js\"</span>)</span><br><span class=\"line\"><span class=\"built_in\">document</span>.querySelector(<span class=\"string\">\"#app\"</span>).appendChild(str)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 打包执行</span></span><br><span class=\"line\">webpack app/main.js dist/bundle.js</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">cd WebTest                          </span><br><span class=\"line\">cnpm install -g webpack   <span class=\"comment\">// 全局安装</span></span><br><span class=\"line\">cnpm install -S webpack   <span class=\"comment\">// 本地安装</span></span><br><span class=\"line\">cnpm init                 <span class=\"comment\">// 新建package.json</span></span><br></pre></td></tr></table></figure></li><li><p><strong>基础配置</strong></p><div style=\"text-indent:2em\">在项目根目录下新建 webpack.config.js 文件并配置选项，配置后在终端里执行 webpack 就会被自动引用。项目开发时可以创建多个配置文件：webpack.dev.config.js 和 webpack.pub.config.js 分别用于开发和生产环境，不过运行时需要使用命令 webpack –config webpack.dev.config.js</div><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// webpack.config.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  entry: __dirname + <span class=\"string\">'/app/main.js'</span>, <span class=\"comment\">// 唯一入口文件</span></span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'bundle.js'</span>,         <span class=\"comment\">// 输出文件名</span></span><br><span class=\"line\">      path: __dirname + <span class=\"string\">\"/dist\"</span>,     <span class=\"comment\">// 输出文件存放地址</span></span><br><span class=\"line\">      <span class=\"comment\">// path: path.resolve(__dirname, 'dist') </span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// package.json文件中的scripts选项配置快捷执行方法</span><br><span class=\"line\">\"scripts\": &#123;</span><br><span class=\"line\">  \"dev\":\"webpack --config webpack.dev.config.js\",</span><br><span class=\"line\">  \"pub\":\"webpack --config webpack.pub.config.js\",</span><br><span class=\"line\">  \"start\": \"webpack\",</span><br><span class=\"line\">  \"server\": \"webpack-dev-server --inline\" </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id=\"高级配置\"><a href=\"#高级配置\" class=\"headerlink\" title=\"高级配置\"></a>高级配置</h2><h3 id=\"配置-Babel\"><a href=\"#配置-Babel\" class=\"headerlink\" title=\"配置 Babel\"></a>配置 Babel</h3><ul><li>功能：将 ES6、jsx等语法编译为浏览器能够运行的js</li><li>配置：webpack.config.js 或单独的 .babelrc 文件（webpack会自动调用）</li></ul><h3 id=\"生成-Source-Maps\"><a href=\"#生成-Source-Maps\" class=\"headerlink\" title=\"生成 Source Maps\"></a>生成 Source Maps</h3><div style=\"text-indent:2em\">有时打包后文件出错了，却不容易找到对应代码的位置，而通过配置 devtool 选项后，webpack 就可以在打包时生成 source maps，这为我们提供了一种对应编译文件和源文件的方法，使得编译后的代码可读性更高，也更容易调试。可选的四种配置如下：</div><ul><li>source-map：完整且功能完全的单独文件，但会减慢打包速度</li><li>cheap-module-source-map：不带列映射，只能对应到具体的行</li><li>eval-source-map：不影响速度且完整，但有隐患，可开发不可生产阶段</li><li>cheap-module-eval-source-map：生成Source Map最快且和js同行，不利于调试，推荐在大型项目考虑时间成本时使用</li></ul><h3 id=\"构建本地服务器\"><a href=\"#构建本地服务器\" class=\"headerlink\" title=\"构建本地服务器\"></a>构建本地服务器</h3><div style=\"text-indent:2em\">Webpack 提供一个可选的本地开发服务器 webpack-dev-server，它基于 Node.js 构建而且可以实现浏览器监听代码修改并自动刷新等效果，配置前需要通过 npm 安装它作为项目依赖。</div><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    entry: __dirname + <span class=\"string\">'/app/main.js'</span>,</span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">        path: path.resolve(__dirname, <span class=\"string\">'dist'</span>),</span><br><span class=\"line\">        filename: <span class=\"string\">'bundle.js'</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    devServer: &#123;</span><br><span class=\"line\">        contentBase: <span class=\"string\">\"./dist\"</span>,    <span class=\"comment\">// 加载页面的所在目录</span></span><br><span class=\"line\">        historyApiFallback: <span class=\"literal\">true</span>, <span class=\"comment\">// 不跳转</span></span><br><span class=\"line\">        inline: <span class=\"literal\">true</span>,   <span class=\"comment\">// 实时刷新</span></span><br><span class=\"line\">        hot: <span class=\"literal\">true</span>  <span class=\"comment\">// 热更新，即不刷新浏览器的前提下刷新页面</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 配置后执行 npm run server</span></span><br></pre></td></tr></table></figure><h1 id=\"八、版本管理工具-Git\"><a href=\"#八、版本管理工具-Git\" class=\"headerlink\" title=\"八、版本管理工具 Git\"></a>八、版本管理工具 Git</h1><h2 id=\"Git-和-Svn\"><a href=\"#Git-和-Svn\" class=\"headerlink\" title=\"Git 和 Svn\"></a>Git 和 Svn</h2><ol><li>Svn：集中式管理工具。所有版本文件都集中存放到一个服务器上，所有开发者都从该服务器上更新或上传修改代码，注意需要连网。</li><li>Git：分布式管理工具，分布式指每台电脑都是一个版本仓库，但在实际工作中一般会有一个集中的服务中心 Github。与集中式的最大区别在于开发者可以离线在本地提交, 只需在连网时push到相应的服务器或其他用户, 而且每个开发者通过克隆(git clone)可以在本地机器上拷贝一个完整的Git仓库。</li></ol><h2 id=\"Git-和-Github的关系\"><a href=\"#Git-和-Github的关系\" class=\"headerlink\" title=\"Git 和 Github的关系\"></a>Git 和 Github的关系</h2><ol><li>Git：指定了remote链接和用户信息（用户名+邮箱）之后，git可以帮你将提交过到你本地分支的代码push到远程的git仓库（任意提供了git托管服务的服务器上都可以，包括你自己建的服务器 或者 GitHub等网站提供的服务器）或者将远程仓库的代码 fetch 到本地。</li><li>Github：只是一个提供存储空间的服务器，用来存储git仓库。当然现在Github已经由一个存放git仓库的网站空间发展为了一个开源社区（不只具有存储git仓库的功能了），你可以参与别人的开源项目，也可以让别人参与你的开源项目。</li></ol><h2 id=\"工作流程\"><a href=\"#工作流程\" class=\"headerlink\" title=\"工作流程\"></a>工作流程</h2><div style=\"text-indent:2em\">开发者在自己的机器上更新服务器上的最新代码，然后根据需要创建分支，在该分支上提交本地修改的代码到远程仓库并通知主开发者合并代码。如果主开发者发现代码有冲突则让开发者修改后重新提交，没有冲突则合并代码。注意本地的 .git文件是指本地仓库，.git目录下存放着所有文件的版本和关联信息但默认隐藏。开发流程图如下</div><br><div align=\"center\"><br><img src=\"images/web/git_work.png\" alt=\"工作流程图\"><br></div><h2 id=\"常用命令-1\"><a href=\"#常用命令-1\" class=\"headerlink\" title=\"常用命令\"></a>常用命令</h2><div align=\"center\"><br><br><img src=\"images/web/git_order.png\" alt=\"常用命令图\"><br></div><h2 id=\"基础配置\"><a href=\"#基础配置\" class=\"headerlink\" title=\"基础配置\"></a>基础配置</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config --global --list         <span class=\"comment\">//查看全局配置</span></span><br><span class=\"line\">git config --global user.name <span class=\"string\">\"chuanggefighting\"</span>    <span class=\"comment\">//设置用户名</span></span><br><span class=\"line\">git config --global user.email <span class=\"string\">\"17621538916@163.com\"</span>    <span class=\"comment\">//设置邮箱</span></span><br></pre></td></tr></table></figure><h2 id=\"ssh密钥配置\"><a href=\"#ssh密钥配置\" class=\"headerlink\" title=\"ssh密钥配置\"></a>ssh密钥配置</h2><div style=\"text-indent:2em\">Git使用https协议，每次pull/push都要输入密码比较麻烦，而使用git协议后使用ssh密钥，这样可以省去每次都输密码。配置步骤如下：</div><ol><li>检测SSH keys是否存在：cd ~/.ssh</li><li><p>创建ssh key(生成密钥对)：ssh-keygen -t rsa -C “<a href=\"mailto:17621538916@163.com\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">17621538916@163.com</a>“</p><ul><li>此时会提示自定义名称和push时的密码 (不是git登录密码), 一般推荐略过(直接三个回车), 如果看到成功保存信息则说明如果创建成功</li></ul></li><li><p>添加公钥到github等个人的远程仓库</p><ol><li>查看生成的公钥：cat ~/.ssh/id_rsa.pub</li><li>登陆github：点击头像 –&gt; Settings –&gt; 左栏点击SSH and GPG keys –&gt; 点击 New SSH key –&gt; 复制上面的公钥内容，粘贴进”Key”，title自定义 –&gt; 点击 Add key</li><li>测试SSH的连接：ssh -T <a href=\"mailto:git@github.com\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">git@github.com</a></li><li>输入yes后可看到信息</li></ol></li></ol><h2 id=\"工作提交代码\"><a href=\"#工作提交代码\" class=\"headerlink\" title=\"工作提交代码\"></a>工作提交代码</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  *  远程分支   --&gt;  本地分支</span></span><br><span class=\"line\"><span class=\"comment\">  *  orgin/master --&gt; master</span></span><br><span class=\"line\"><span class=\"comment\">  *  orgin/dev/t_lishi/xx --&gt; dev/t_lishi/xx</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"></span><br><span class=\"line\">git fetch --all        <span class=\"comment\">//更新远程修改但不会merge</span></span><br><span class=\"line\">git reset --hard orgin/master  <span class=\"comment\">//强制更新(慎用)</span></span><br><span class=\"line\"></span><br><span class=\"line\">git pull orgin master  <span class=\"comment\">// 拉取代码到本地并合并到本地</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">git branch            <span class=\"comment\">// 查看本地分支</span></span><br><span class=\"line\">git checkout master   <span class=\"comment\">//切换到主分支分支</span></span><br><span class=\"line\"></span><br><span class=\"line\">git branch -D BranchName    <span class=\"comment\">// 删除本地分支(--delete/-d)</span></span><br><span class=\"line\">git branch -r -D origin/BranchName  <span class=\"comment\">// 删除远程分支</span></span><br><span class=\"line\">git push origin :BranchName   <span class=\"comment\">// 删除远程分支简单方法</span></span><br><span class=\"line\"></span><br><span class=\"line\">git checkout -b dev/t_lishi/Navigation  <span class=\"comment\">// 创建并切换到该分支          </span></span><br><span class=\"line\"><span class=\"comment\">// 相当于以下两个命令的合并</span></span><br><span class=\"line\">git branch branchName     新建    </span><br><span class=\"line\">git checkout branchName   切换</span><br><span class=\"line\"></span><br><span class=\"line\">git push origin dev/t_lishi/Navigation  <span class=\"comment\">// 推送到远端</span></span><br><span class=\"line\">git branch -a      <span class=\"comment\">// 查看远程分支</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 修改某个文件后操作</span></span><br><span class=\"line\">git status  查看状态</span><br><span class=\"line\">git add TaskDoc/t_lishi.log  <span class=\"comment\">// 指定需要提交到本地仓库的文件</span></span><br><span class=\"line\">git status </span><br><span class=\"line\">git commit -m <span class=\"string\">\"create Navigation\"</span>      提交代码到本地</span><br><span class=\"line\">git push origin dev/t_lishi/Navigation    推送到远程仓库</span><br></pre></td></tr></table></figure><h2 id=\"把个人网页挂到-Github\"><a href=\"#把个人网页挂到-Github\" class=\"headerlink\" title=\"把个人网页挂到 Github\"></a>把个人网页挂到 Github</h2><ol><li><strong>Github 上建立仓库，比如 resume</strong></li><li><strong>进入新建仓库并选择 “settings” 进行仓库设置，滚动到页面底部 “Github Pages” 部分</strong><ul><li>Source – master branch，保存后就会自动生成网址</li><li>生成网址拼接文件路径后访问：chuanggefighting.github.io/resume/dist/index.html</li></ul></li><li><p><strong>将仓库代码克隆到本地</strong></p><ul><li>删除除了 .git 以外的其他文件，然后通过以下命令测试<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add *               <span class=\"comment\">// 添加到暂存区</span></span><br><span class=\"line\">git commit -m <span class=\"string\">'del'</span>     <span class=\"comment\">// 上传到本地仓库</span></span><br><span class=\"line\">git push origin master  <span class=\"comment\">// 上传到远程仓库</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>更新个人代码到远程仓库</strong></p></li></ol><!-- rebuild by neat -->"},{"title":"Javascript 数据结构","top":false,"keywords":["js","数据结构"],"date":"2019-03-20T13:40:45.000Z","description":"栈、队列、链表、集合、字典、散列表、树、图","_content":"\n# 数据结构\n> 计算机存储、组织数据的方式\n\n## 逻辑结构\n> 数据组织方式\n\n  * __集合结构__\n    * 操作：并集、交集、补集\n    * 特点\n      * 集合由一组无序且唯一的项组成\n      * 单个数据元素之间没有任何关系\n  * __线性结构__\n    * 类型：线性表，包括 堆、栈、队列、一维数组\n    * 特点\n      * 数据元素是有序的\n      * 数据元素之间存在 一对一 的层次关系\n  * __树形结构__\n    * 类型：树\n    * 数据元素之间存在 一对多 的层次关系\n  * __图形结构__\n    * 类型：图\n    * 数据元素之间是 多对多 的层次关系\n\n\n## 物理结构\n> 数据存储方式\n\n  * __顺序存储__\n    * 内存：元素连续放置，基于位置关系访问\n    * 优点：随机访问\n    * 缺点：插入删除效率低，大小固定\n  * __链式存储__\n    * 内存：元素并不连续放置，基于引用指针关系访问\n    * 优点：大小动态扩展，插入删除效率高\n    * 缺点：访问链表元素需要循环查找，不能随机访问\n  * __索引存储__\n    * 内存：整体无序但索引块之间有序\n    * 优点：对顺序查找的一种改进，查找效率高\n    * 缺点：需要额外空间存储索引表\n  * __散列存储__\n    * 内存：数据元素根据函数计算存储位置\n    * 优点：基于数据本身查找，查找和存取效率高\n    * 缺点：存取随机而不利于顺序查找，存储位置可能相同而冲突\n\n\n# 一、栈\n  * 一种遵循先进后出原则的特殊线性表\n  * 它基于数组或链表实现，只能在栈顶增删元素\n  * 新元素靠近栈顶，旧元素靠近栈底，类似叠起来的书\n\n  ```js\n  // 定义栈类\n  class Stack {\n\n    // 底层数据结构是数组\n    constructor() {\n      this.items = []\n    }\n\n    // 入栈\n    push(element) {\n      this.items.push(element)\n    }\n\n    // 出栈\n    pop() {\n      return this.items.pop()\n    }\n\n    // 末位\n    get peek() {\n      return this.items[this.items.length - 1]\n    }\n\n    // 是否为空栈\n    get isEmpty() {\n      return !this.items.length\n    }\n\n    // 尺寸\n    get size() {\n      return this.items.length\n    }\n    \n    // 清空栈\n    clear() {\n      this.items = []\n    }\n  }\n\n  // 使用栈类\n  const stack = new Stack()\n  console.log(stack.isEmpty)  // true\n\n  stack.push(5)\n  stack.push(8)\n  console.log(stack.peek)     // 8\n  console.log(stack.size)     // 2\n  ```\n\n\n# 二、队列\n  * 一种遵循先进先出原则的特殊线性表\n  * 只能队尾添加、队首删除元素，类似排队人群\n\n  ```js\n  class Queue {\n\n    constructor(items) {\n      this.items = items || []\n    }\n\n    // 循环队列\n    enqueue(element){\n      this.items.push(element)\n    }\n    // 优先队列：根据优先级增删\n    enqueue(element, priority){\n      const queueElement = { element, priority }\n      if (this.isEmpty) {\n          this.items.push(queueElement)\n      } else {\n          const preIndex = this.items.findIndex((item) => queueElement.priority &lt; item.priority)\n          if (preIndex &gt; -1) {\n              this.items.splice(preIndex, 0, queueElement)\n          } else {\n              this.items.push(queueElement)\n          }\n      }\n    }\n\n    dequeue(){\n      return this.items.shift()\n    }\n\n    front(){\n      return this.items[0]\n    }\n\n    clear(){\n      this.items = []\n    }\n\n    get size(){\n      return this.items.length\n    }\n\n    get isEmpty(){\n      return !this.items.length\n    }\n\n    print() {\n      console.log(this.items)\n    }\n  }\n\n  // 实例化\n  const queue = new Queue()\n\n  // 普通队列\n  queue.enqueue('John')\n  queue.enqueue('Jack')\n  console.log(queue.size)     // 2\n  console.log(queue.isEmpty)  // false\n\n  // 优先队列\n  queue.enqueue('Surmon', 3)\n  queue.enqueue('John', 2)\n  queue.enqueue('Jack', 1)\n  queue.print()\n\n  // 循环队列\n  class LoopQueue extends Queue {\n\n    constructor(items) {\n        super(items)\n    }\n\n    getIndex(index) {\n        const length = this.items.length\n        return index &gt; length ? (index % length) : index\n    }\n\n    find(index) {\n        return !this.isEmpty ? this.items[this.getIndex(index)] : null\n    }\n  }\n  const loopQueue = new LoopQueue(['Surmon'])\n  loopQueue.enqueue('SkyRover')\n  loopQueue.enqueue('Even')\n  console.log(loopQueue.size)      // 3\n  console.log(loopQueue.find(26))  // 'Evan'\n  ```\n\n\n# 三、链表\n> 链接方式存储数据的线性表。链表的每个数据单元就是一个节点，包含节点信息、指向后一个节点的引用地址 (称为\"链\") \n\n  <div style=\"text-indent: 2em\">数组是存储多个元素时最常用的数据结构，但是在很多编程语言中，数组的长度固定，当数组填满后再添加元素比较困难，删除和添加元素时需要将数组中的所有元素变换位置，操作成本较高。JS 数组并不存在上述问题，主要是因为它们被作为对象实现，不过效率较低。线性表的顺序存储结构由于存储元素不连续都会有以上问题，链表就是针对它的优化结果。</div>\n        \n\n## 链表类型\n  * 单链表：单一的向下传递，每个节点只记录下一个节点的信息\n  * 静态链表：基于数组实现的链表，每个节点包含了数据和指向地址\n  * 循环链表：由于单链表到达尾部时回溯到头部很麻烦，所以首尾相连形成循环\n  * 双向链表：基于单链表增加前指针，每个节点都保存两个分别指向前后节点的地址 \n\n\n## 单链表\n### 结构  \n  <div align=\"center\"> \n    ![单链表结构](images/js/link-list.png)\n  </div>\n  \n  * data中保存着数据，next保存着下一个链表的引用\n  * 我们将链表的尾元素指向了 null 节点，表示链接结束的位置\n  * 可以说 data2 跟在 data1 后面，但不能说 data2 是链表中的第二个元素\n\n### 节点操作  \n  <div align=\"center\"> \n    ![单链表节点操作](images/js/link-opration.png)\n  </div>\n\n  * 插入：修改前驱节点而使其指向新节点，并将新节点指向原前驱节点指向的节点\n  * 删除：将待删节点的前驱节点指向待删节点的，同时将待删节点指向 null\n    \n  ```js\n  // 链表节点\n  class Node {\n    constructor(element) {\n      this.element = element  // 数据\n      this.next = null        // 指针 \n    } \n  }\n\n  // 链表\n  class LinkedList {\n\n    constructor() {\n      this.head = null\n      this.length = 0\n    }\n\n    // 追加元素\n    append(element) {\n      const node = new Node(element)\n      let current = null\n      if (this.head === null) {\n          this.head = node\n      } else {\n          current = this.head\n          while(current.next) {\n              current = current.next\n          }\n          current.next = node\n      }\n      this.length++\n    }\n\n    // 任意位置插入元素\n    insert(position, element) {\n      if (position &gt;= 0 && position &lt;= this.length) {\n        const node = new Node(element)\n        let current = this.head\n        let previous = null\n        let index = 0\n        if (position === 0) {\n            this.head = node\n        } else {\n            while (index++ &lt; position) {\n              previous = current\n              current = current.next\n            }\n            node.next = current\n            previous.next = node\n        }\n        this.length++\n        return true\n      }\n      return false\n    }\n\n    // 移除指定位置元素\n    removeAt(position) {\n\n      // 检查越界值\n      if (position &gt; -1 && position &lt; length) {\n          let current = this.head\n          let previous = null\n          let index = 0\n          if (position === 0) {\n              this.head = current.next\n          } else {\n              while (index++ &lt; position) {\n                  previous = current\n                  current = current.next\n              }\n              previous.next = current.next\n          }\n          this.length--\n          return current.element\n      }\n      return null\n    }\n\n    // 寻找元素下标\n    findIndex(element) {\n      let current = this.head\n      let index = -1\n      while (current) {\n        if (element === current.element) {\n          return index + 1\n        }\n        index++\n        current = current.next\n      }\n      return -1\n    }\n\n    // 删除指定文档\n    remove(element) {\n      const index = this.indexOf(element)\n      return this.removeAt(index)\n    }\n\n    isEmpty() {\n      return !this.length\n    }\n\n    size() {\n      return this.length\n    }\n\n    // 转为字符串\n    toString() {\n      let current = this.head\n      let string = ''\n      while (current) {\n        string += ` ${current.element}`\n        current = current.next\n      }\n      return string\n    }\n  }\n\n  const linkedList = new LinkedList()\n  console.log(linkedList)\n\n  linkedList.append(2)\n  linkedList.append(6)\n  linkedList.insert(3, 18)\n  console.log(linkedList)\n  console.log(linkedList.findIndex(24))\n  ```\n\n\n## 双向链表\n  ```js\n  // 链表节点\n  class Node {\n    constructor(element) {\n      this.element = element\n      this.prev = null\n      this.next = null\n    }\n  }\n\n  // 双向链表\n  class DoublyLinkedList {\n\n    constructor() {\n      this.head = null\n      this.tail = null\n      this.length = 0\n    }\n\n    // 任意位置插入元素\n    insert(position, element) {\n      if (position &gt;= 0 && position &lt;= this.length){\n          const node = new Node(element)\n          let current = this.head\n          let previous = null\n          let index = 0\n          // 首位\n          if (position === 0) {\n              if (!head){\n                  this.head = node\n                  this.tail = node\n              } else {\n                  node.next = current\n                  this.head = node\n                  current.prev = node\n              }\n          // 末位\n          } else if (position === this.length) {\n              current = this.tail\n              current.next = node\n              node.prev = current\n              this.tail = node\n          // 中位\n          } else {\n              while (index++ &lt; position) {\n                previous = current\n                current = current.next\n              }\n              node.next = current\n              previous.next = node\n              current.prev = node\n              node.prev = previous\n          }\n          this.length++\n          return true\n      }\n      return false\n    }\n\n    // 移除指定位置元素\n    removeAt(position) {\n      if (position &gt; -1 && position &lt; this.length) {\n          let current = this.head\n          let previous = null\n          let index = 0\n\n          // 首位\n          if (position === 0) {\n              this.head = this.head.next\n              this.head.prev = null\n              if (this.length === 1) {\n                  this.tail = null\n              }\n\n          // 末位\n          } else if (position === this.length - 1) {\n              this.tail = this.tail.prev\n              this.tail.next = null\n\n          // 中位\n          } else {\n              while (index++ &lt; position) {\n                previous = current\n                current = current.next\n              }\n              previous.next = current.next\n              current.next.prev = previous\n      }\n      this.length--\n      return current.element\n      } else {\n          return null\n      }\n    }\n  }\n  ```\n\n\n# 四、集合\n> 由一组无序且唯一的项组成，操作方法可分为 并集、交集、差集。集合、字典、散列表都可以存储不重复的数据\n\n  ```js\n  // 定义\n  class Set {\n\n    constructor() {\n      this.items = {}\n    }\n\n    has(value) {\n      return this.items.hasOwnProperty(value)\n    }\n\n    add(value) {\n      if (!this.has(value)) {\n          this.items[value] = value\n          return true\n      }     \n      return false\n    }\n\n    remove(value) {\n      if (this.has(value)) {\n          delete this.items[value]\n          return true\n      }\n      return false\n    }\n\n    get size() {\n      return Object.keys(this.items).length\n    }\n\n    get values() {\n      return Object.keys(this.items)\n    }\n\n    // 并集\n    union(otherSet) {\n      const unionSet = new Set()\n      this.values.forEach((v, i) => unionSet.add(this.values[i]))\n      otherSet.values.forEach((v, i) => unionSet.add(otherSet.values[i]))\n      return unionSet\n    }\n\n    // 交集\n    intersection(otherSet) {\n      const intersectionSet = new Set()\n      this.values.forEach((v, i) => {\n          if (otherSet.has(v)) {\n              intersectionSet.add(v)\n          }\n      })\n      return intersectionSet\n    }\n    \n    // 差集\n    difference(otherSet) {\n      const differenceSet = new Set()\n      this.values.forEach((v, i) => {\n          if (!otherSet.has(v)) {\n              differenceSet.add(v)\n          }\n      })\n      return differenceSet\n    }\n\n    // 子集\n    subset(otherSet) {\n      if (this.size &gt; otherSet.size) {\n          return false\n      } else {\n          return !this.values.some(v => !otherSet.has(v))\n      } \n    }\n  }\n\n  var set1 = new Set();\n  set1.add(1);\n\n  var set2 = new Set();\n  set2.add(1);\n  set2.add(2);\n\n  // 数据\n  console.log(set1.values)   \n  console.log(set1.has(1))  \n\n  // 并集\n  let set11 = set1.union(set2);\n  console.log(set11.values);  // [1,2]\n  \n  // 交集\n  let set12  = set1.intersection(set2);\n  console.log(set12.values);  // [1]\n\n  // 差集\n  let set13 = set2.difference(set1);\n  console.log(set13.values); // [2]\n  \n  // 判断子集\n  console.log(set1.subset(set2)); // true\n  ```\n\n\n# 五、字典\n> 即映射，以键值对 { key: value } 的形式存储不重复的数据，Object 对象是字典在 Js 中的实现\n\n  ```js\n  class Dictionary {\n\n    constructor() {\n      this.items = {}\n    }\n\n    set(key, value) {\n      this.items[key] = value\n    }\n\n    get(key) {\n      return this.items[key]\n    }\n\n    remove(key) {\n      delete this.items[key]\n    }\n\n    get keys() {\n      return Object.keys(this.items)\n    }\n\n    get values() {\n\n      // 使用 ES7 values\n      // return Object.values(this.items)\n      \n      // 通过循环生成一个数组并输出\n      return Object.keys(this.items).reduce((r, c, i) => {\n          r.push(this.items[c])\n          return r\n      }, [])\n    }\n  }\n\n  const dictionary = new Dictionary()\n  dictionary.set('Gandalf', 'gandalf@email.com')\n  dictionary.set('John', 'johnsnow@email.com') \n\n  console.log(dictionary)\n  console.log(dictionary.keys) \n  ```\n\n\n# 六、散列表\n> 又称哈希表，是根据关键字而直接访问内存存储位置的数据结构。\n\n  <div style=\"text-indent: 2em\">通过计算一个数据关键字的函数，将所需查询的数据内容映射到表中的一个存放位置来访问记录，这加快了查找速度。这个映射函数称做散列函数，存放记录的数组称做散列表。简单来说，通过散列函数将要检索的项与索引（散列值）关联起来，生成一种便于搜索的数据结构（散列表）。</div>\n        \n  * 散列函数\n    * 原则：函数本身便于计算、计算出来的地址分布均匀\n    * 方法：数字分析法、平方取中法、分段叠加法、除留余数法\n  * 处理冲突\n    * 原因：键值不同的元素可能会映射到散列表的同一地址，称为 hash 冲突\n    * 方法\n      * 拉链法/分离链接：将所有散列地址相同的记录都放入一个线性链表\n      * 开放定址法：冲突时寻找散列表中的空地址     \n        * 线性探测：顺序查看表中下一单元\n        * 二次探测：在表的左右进行跳跃式探测\n        * 随机探测：建立一个伪随机数发生器\n      * 再散列法：冲突时通过其它散列函数计算地址\n      * 建立公共溢出区：将所有和散列表冲突的元素都放入溢出表\n    \n  ```js\n  class HashTable {\n\n    constructor() {\n      this.table = []\n    }\n\n    // 散列函数\n    static loseloseHashCode(key) {\n      let hash = 0\n      for (let codePoint of key) {\n        hash += codePoint.charCodeAt()\n      }\n      return hash % 37\n    }\n\n    // 不考虑冲突\n    put(key, value) {\n      const position = HashTable.loseloseHashCode(key)\n      console.log(`${position} - ${key}`)\n      this.table[position] = value\n    }\n    get(key) {\n      return this.table[HashTable.loseloseHashCode(key)]\n    }\n    remove(key) {\n      this.table[HashTable.loseloseHashCode(key)] = undefined\n    }\n\n    // 分离链接处理冲突：需要一个辅助类 LinkedList 表示要加入的元素\n    put(key, value) {\n      const position = HashTable.loseloseHashCode(key)\n      if (this.table[position] === undefined) {\n         this.table[position] = new LinkedList()\n      }\n      this.table[position].append({ key, value })\n    }\n    get(key) {\n      const position = HashTable.loseloseHashCode(key)\n      if (this.table[position] === undefined) return undefined\n      const getElementValue = node => {\n        if (!node && !node.element) return undefined\n        if (Object.is(node.element.key, key)) {\n            return node.element.value\n        } else {\n            return getElementValue(node.next)\n        }\n      }\n      return getElementValue(this.table[position].head)\n    }\n    remove(key) {\n      const position = HashTable.loseloseHashCode(key)\n      if (this.table[position] === undefined) return undefined\n      const getElementValue = node => {\n        if (!node && !node.element) return false\n        if (Object.is(node.element.key, key)) {\n            this.table[position].remove(node.element)\n            if (this.table[position].isEmpty) {\n                this.table[position] = undefined\n            }\n            return true\n        } else {\n            return getElementValue(node.next)\n        }\n      }\n      return getElementValue(this.table[position].head)\n    }\n\n    // 线性探查\n    put(key, value) {\n      const position = HashTable.loseloseHashCode(key)\n      if (this.table[position] === undefined) {\n          this.table[position] = { key, value }\n      } else {\n          let index = ++position\n          while (this.table[index] !== undefined) {\n            index++\n          }\n          this.table[index] = { key, value }\n      }\n      this.table[position].append({ key, value })\n    }\n    get(key) {\n      const position = HashTable.loseloseHashCode(key)\n      const getElementValue = index => {\n        if (this.table[index] === undefined) return undefined\n        if (Object.is(this.table[index].key, key)) {\n            return this.table[index].value\n        } else {\n            return getElementValue(index + 1)\n        }\n      }\n      return getElementValue(position)\n    }\n    remove(key) {\n      const position = HashTable.loseloseHashCode(key)\n      const removeElementValue = index => {\n        if (this.table[index] === undefined) return false\n        if (Object.is(this.table[index].key, key)) {\n            this.table[index] = undefined\n            return true\n        } else {\n            return removeElementValue(index + 1)\n        }\n      }\n      return removeElementValue(position)\n    }\n  }\n\n  const hash = new HashTable()\n  hash.put('Surmon', 'surmon.me@email.com')  // 19 - Surmon\n  hash.put('John', 'johnsnow@email.com')     // 29 - John\n\n  console.log(hash.get('Surmon'))  // surmon.me@email.com\n  console.log(hash.get('Loiane'))  // undefined\n  console.log(hash)\n  ```\n\n\n# 七、树\n> 一对多的非线性结构、分层数据的抽象模型。树状结构分为树和二叉树，树的操作比较复杂但可以转换为二叉树处理\n\n\n## 树\n  * 定义：n 个相同类型的数据元素的有限集合，树的集合为森林\n  * 属性\n    * 节点：树中的数据元素\n      * 根节点：没有父节点\n      * 分支节点：有子节点\n      * 叶子节点：没有子节点\n    * 子树：节点组成的树\n    * 层级：可以按照节点级别分层\n    * 深度：节点到根节点的节点数量\n    * 高度：所有节点深度中的最大值\n    * 权值：\n  * 分类\n    * 无序树：子节点之间没有顺序关系，又称自由树\n    * 有序树：子节点之间有顺序关系\n      * 二叉树：每个节点最多含有两个子树\n        * 完全二叉树：最后一层右边可能满或不满，左边和其余层都是满的。堆就是一个完全二叉树\n        * 满二叉树：所有叶节点都在最底层的完全二叉树\n        * 排序二叉树：有序二叉树、二叉查找树、二叉搜索树\n        * 平衡二叉树：AVL树，任何节点的左右子树的高度差不超过 1\n      * 哈夫曼树：最优二叉树，带权路径最短的二叉树\n        * 路径长度：两个节点之间所经过的分支数目\n        * 树带权路径长度：所有叶子节点的带权路径长度之和\n        * 节点带权路径长度：节点到根节点的分支数目和该节点权值的乘积\n      * B 树：一种对读写操作进行优化的自平衡的二叉查找树，能够保持数据有序，拥有多余两个子树。\n\n\n## 二叉树\n\n### 遍历方式\n  * 中序遍历\n    * 顺序：左侧子节点、节点本身、右侧子节点\n    * 应用：排序操作\n  * 前序遍历\n    * 顺序：节点本身、左侧子节点、右侧子节点\n    * 应用：打印一个结构化的文档\n  * 后序遍历\n    * 顺序：左侧子节点、节点本身、右侧子节点\n    * 应用：计算目录及其子目录的文件空间\n\n\n### 存储结构\n\n  <div align=\"center\">\n    ![二叉树顺序存储结构](images/js/binary-order.png)\n  </div>\n  <div align=\"center\">\n    ![二叉树链式存储结构](images/js/binary-link.png)\n  </div>\n\n  ```js\n  // 顺序存储结构\n  var tree = [1, 2, 3, 4, 5, , 6, , , 7];\n\n  // 链式存储结构\n  class BinaryNode {\n    constructor(key, left = null, right = null) {\n      this.key = key\n      this.left = left\n      this.right = right\n    }\n  }\n  ```\n\n\n### 基础定义\n\n  ```js\n  class Node {\n    constructor(key) {\n      // 数据元素\n      this.key = key \n      // 指向左右节点的指针\n      this.left = null    \n      this.right = null\n    }\n  }\n\n  class BinarySearchTree {\n\n    constructor() {\n      this.root = null\n    }\n\n    insert(key) {\n      const newNode = new Node(key)\n      const insertNode = (node, newNode) => {\n          if (newNode.key &lt; node.key) {\n              if (node.left === null) {\n                  node.left = newNode\n              } else {\n                  insertNode(node.left, newNode)\n              }\n          } else {\n              if (node.right === null) {\n                  node.right = newNode\n              } else {\n                  insertNode(node.right, newNode)\n              }\n          }\n      }\n      if (!this.root) {\n          this.root = newNode\n      } else {\n          insertNode(this.root, newNode)\n      }\n    }\n\n    // 中序遍历\n    inOrderTraverse(callback) {\n      const inOrderTraverseNode = (node, callback) => {\n          if (node !== null) {\n              inOrderTraverseNode(node.left, callback)\n              callback(node.key)\n              inOrderTraverseNode(node.right, callback)\n          }\n      }\n      inOrderTraverseNode(this.root, callback)\n    }\n\n    // 先序遍历\n    preOrderTraverse(callback) {\n      const preOrderTraverseNode = (node, callback) => {\n        if (node !== null) {\n            callback(node.key)\n            preOrderTraverseNode(node.left, callback)\n            preOrderTraverseNode(node.right, callback)\n        }\n      }\n      preOrderTraverseNode(this.root, callback)\n    }\n\n    // 后序遍历\n    postOrderTraverse(callback) {\n      const postOrderTraverseNode = (node, callback) => {\n        if (node !== null) {\n            postOrderTraverseNode(node.left, callback)\n            postOrderTraverseNode(node.right, callback)\n            callback(node.key)\n        }\n      }\n      postOrderTraverseNode(this.root, callback)\n    }\n\n    min(node) {\n      const minNode = node => {\n        return node ? (node.left ? minNode(node.left) : node) : null\n      }\n      return minNode(node || this.root)\n    }\n\n    max(node) {\n      const maxNode = node => {\n        return node ? (node.right ? maxNode(node.right) : node) : null\n      }\n      return maxNode(node || this.root)\n    }\n\n    search(key) {\n      const searchNode = (node, key) => {\n        if (node === null) return false\n        if (node.key === key) return node\n        return searchNode((key &lt; node.key) ? node.left : node.right, key)\n      }\n      return searchNode(root, key)\n    }\n\n    remove(key) {\n      return this._removeNode(this.root, key)\n    }\n\n    _removeNode(node, key) {\n      if (node === null) return false\n\n      if (key &lt; node.key) {\n          node.left = this._removeNode(node.left, key)\n          return node\n      } else if (key &gt; node.key) {\n          node.right = this._removeNode(node.right, key)\n          return node\n      } else {\n          if (node.left === null && node.right === null) {\n              return null\n          }\n          if (node.left === null) {\n              return node.right\n          } else if (node.right === null) {\n              return node.left\n          } else {\n              const minNode = this._findMinNode(node.right)\n              node.key = minNode.key\n              node.right = this._removeNode(node.right, minNode.key)\n              return node\n          }\n      }\n    }\n  }\n\n  const tree = new BinarySearchTree()\n  tree.insert(11)\n  tree.insert(7)\n  tree.insert(5)\n  console.log(tree)\n  tree.inOrderTraverse(value => { console.log(value) })\n  ```\n\n\n# 八、图\n> 由一系列顶点和连接顶点的边组成的一种非线性数据结构，可以用来表示任何二元关系\n\n## 图的表示\n> 没有绝对正确的表示方式，采用哪种方式取决于图的类型和待解决的问题\n\n### 邻接矩阵    \n  * 使用一个二维数组来表示图中顶点之间的连接\n  * 如果索引为 i、j 的两个节点连接，则 arr[i][j] === 1，否则为 0\n  * 缺点：只有一个相邻顶点的顶点也需要一整行来表示连接，浪费内存\n\n  <div align=\"center\"> \n    ![邻接矩阵](images/js/near-matrix.png)\n  </div>\n\n\n### 邻接表  \n  * 由图中每个顶点的相邻顶点列表所组成\n  * 只要能表示一对多的数据结构都可以用来描述邻接表，比如多维数组、链表、散列表、字典等\n\n  <div align=\"center\"> \n    ![邻接表](images/js/near-table.png)\n  </div>\n\n### 关联矩阵  \n  * 矩阵的行列分别表示顶点和边，使用二维数组表示两者之间的连通性\n  * 如果顶点A 是边 E 的入射点，则 array[A][E] === 1，否则为 0\n  * 通常用于边的数量比顶点少的情况，以节省空间和内存。\n\n  <div align=\"center\">\n    ![关联矩阵](images/js/near-table.png)\n  </div>\n\n    \n## 图的遍历\n> 可以用来寻找特定的顶点或寻找两个顶点之间的路径，检查图是否连通，检查图是否含有环等。思路是追踪每个第一次访问的节点，并且追踪有哪些节点还没有被完全探索。\n\n  * 广度优先搜索：一层一层的遍历顶点\n  * 深度优先搜索：选择一个路径一直深入遍历直到尽头，再递归回去选择未访问的顶点\n        \n\n## 创建图类\n\n  ```js\n  class Graph {\n\n    constructor() {\n      this.vertices = []\n      this.adjList = new Dictionary()\n    }\n\n    // 添加顶点\n    addVertex(v) {\n      this.vertices.push(v)\n      this.adjList.set(v, [])\n    }\n\n    // 添加线\n    addEdge(v, w) {\n      this.adjList.get(v).push(w)\n      this.adjList.get(w).push(v)\n    }\n\n    toString() {\n      return this.vertices.reduce((r, v, i) => {\n          return this.adjList.get(v).reduce((r, w, i) => {\n              return r + `${w} `\n          }, `${r}\\n${v} => `)\n      }, '')\n    }\n\n    // 构建顶点之间的路径\n    distance(fromVertex) {\n      const vertices = this.vertices\n      const { distances, predecessors } = this.bfs(fromVertex)\n      vertices.forEach(toVertex => {\n          if (!!distances[toVertex]) {\n              let preVertex = predecessors[toVertex]\n              let slug = ''\n              while (fromVertex !== preVertex) {\n                  slug = `${preVertex} - ${slug}`\n                  preVertex = predecessors[preVertex]\n              }\n              slug = `${fromVertex} - ${slug}${toVertex}`\n              console.log(slug)\n          }\n      })\n    }\n\n    // 广度优先搜索算法\n    bfs(v, callback) {\n        const read = []\n        const distances = []\n        const predecessors = []\n        const adjList = this.adjList\n        const pending = [v || this.vertices[0]]\n        const readVertices = vertices => {\n          vertices.forEach(key => {\n              read.push(key)\n              pending.shift()\n              distances[key] = distances[key] || 0\n              predecessors[key] = predecessors[key] || null\n              adjList.get(key).forEach(v => {\n                  if (!pending.includes(v) && !read.includes(v)) {\n                      pending.push(v)\n                      distances[v] = distances[key] + 1\n                      predecessors[v] = key\n                  }\n              })\n              if (callback) callback(key)\n              if (pending.length) readVertices(pending)\n          })\n        }\n        readVertices(pending)\n        return { distances, predecessors }\n    }\n\n    // 深度优先搜索算法\n    dfs(callback) {\n        let readTimer = 0\n        const read = []\n        const readTimes = []\n        const finishedTimes = []\n        const predecessors = []\n        const adjList = this.adjList\n        const readVertices = (vertices, predecessor) => {\n          vertices.forEach(key => {\n              readTimer++\n              if (adjList.get(key).every(v => read.includes(v)) && !finishedTimes[key]) {\n                  finishedTimes[key] = readTimer\n              }\n              if (read.includes(key)) return false\n              readTimes[key] = readTimer\n              read.push(key)\n              if (callback) callback(key)\n              predecessors[key] = predecessors[key] || predecessor || null\n              if (read.length !== this.vertices.length) {\n                  readVertices(adjList.get(key), key)\n              }\n          })\n        }\n        readVertices(adjList.keys)\n        return { readTimes, finishedTimes, predecessors }\n    }\n  }\n\n\n  const graph = new Graph()\n  const vertices = ['A','B','C','D'];\n  vertices.forEach(v => graph.addVertex(v))\n\n  graph.addEdge('A', 'B')\n  graph.addEdge('A', 'C')\n  graph.addEdge('A', 'D')\n  graph.addEdge('C', 'D')\n\n  console.log(graph.toString())  \n  graph.bfs(graph.vertices[0], value => console.log('Visited: ' + value))\n  ```\n\n\n\n","source":"_posts/9-js数据结构.md","raw":"---\ntitle: Javascript 数据结构\ntags:\n  - Javascript\n  - js 数据\ncategories: Javascript\ntop: false\nkeywords:\n  - js\n  - 数据结构\ndate: 2019-03-20 21:40:45\ndescription: 栈、队列、链表、集合、字典、散列表、树、图\n---\n\n# 数据结构\n> 计算机存储、组织数据的方式\n\n## 逻辑结构\n> 数据组织方式\n\n  * __集合结构__\n    * 操作：并集、交集、补集\n    * 特点\n      * 集合由一组无序且唯一的项组成\n      * 单个数据元素之间没有任何关系\n  * __线性结构__\n    * 类型：线性表，包括 堆、栈、队列、一维数组\n    * 特点\n      * 数据元素是有序的\n      * 数据元素之间存在 一对一 的层次关系\n  * __树形结构__\n    * 类型：树\n    * 数据元素之间存在 一对多 的层次关系\n  * __图形结构__\n    * 类型：图\n    * 数据元素之间是 多对多 的层次关系\n\n\n## 物理结构\n> 数据存储方式\n\n  * __顺序存储__\n    * 内存：元素连续放置，基于位置关系访问\n    * 优点：随机访问\n    * 缺点：插入删除效率低，大小固定\n  * __链式存储__\n    * 内存：元素并不连续放置，基于引用指针关系访问\n    * 优点：大小动态扩展，插入删除效率高\n    * 缺点：访问链表元素需要循环查找，不能随机访问\n  * __索引存储__\n    * 内存：整体无序但索引块之间有序\n    * 优点：对顺序查找的一种改进，查找效率高\n    * 缺点：需要额外空间存储索引表\n  * __散列存储__\n    * 内存：数据元素根据函数计算存储位置\n    * 优点：基于数据本身查找，查找和存取效率高\n    * 缺点：存取随机而不利于顺序查找，存储位置可能相同而冲突\n\n\n# 一、栈\n  * 一种遵循先进后出原则的特殊线性表\n  * 它基于数组或链表实现，只能在栈顶增删元素\n  * 新元素靠近栈顶，旧元素靠近栈底，类似叠起来的书\n\n  ```js\n  // 定义栈类\n  class Stack {\n\n    // 底层数据结构是数组\n    constructor() {\n      this.items = []\n    }\n\n    // 入栈\n    push(element) {\n      this.items.push(element)\n    }\n\n    // 出栈\n    pop() {\n      return this.items.pop()\n    }\n\n    // 末位\n    get peek() {\n      return this.items[this.items.length - 1]\n    }\n\n    // 是否为空栈\n    get isEmpty() {\n      return !this.items.length\n    }\n\n    // 尺寸\n    get size() {\n      return this.items.length\n    }\n    \n    // 清空栈\n    clear() {\n      this.items = []\n    }\n  }\n\n  // 使用栈类\n  const stack = new Stack()\n  console.log(stack.isEmpty)  // true\n\n  stack.push(5)\n  stack.push(8)\n  console.log(stack.peek)     // 8\n  console.log(stack.size)     // 2\n  ```\n\n\n# 二、队列\n  * 一种遵循先进先出原则的特殊线性表\n  * 只能队尾添加、队首删除元素，类似排队人群\n\n  ```js\n  class Queue {\n\n    constructor(items) {\n      this.items = items || []\n    }\n\n    // 循环队列\n    enqueue(element){\n      this.items.push(element)\n    }\n    // 优先队列：根据优先级增删\n    enqueue(element, priority){\n      const queueElement = { element, priority }\n      if (this.isEmpty) {\n          this.items.push(queueElement)\n      } else {\n          const preIndex = this.items.findIndex((item) => queueElement.priority &lt; item.priority)\n          if (preIndex &gt; -1) {\n              this.items.splice(preIndex, 0, queueElement)\n          } else {\n              this.items.push(queueElement)\n          }\n      }\n    }\n\n    dequeue(){\n      return this.items.shift()\n    }\n\n    front(){\n      return this.items[0]\n    }\n\n    clear(){\n      this.items = []\n    }\n\n    get size(){\n      return this.items.length\n    }\n\n    get isEmpty(){\n      return !this.items.length\n    }\n\n    print() {\n      console.log(this.items)\n    }\n  }\n\n  // 实例化\n  const queue = new Queue()\n\n  // 普通队列\n  queue.enqueue('John')\n  queue.enqueue('Jack')\n  console.log(queue.size)     // 2\n  console.log(queue.isEmpty)  // false\n\n  // 优先队列\n  queue.enqueue('Surmon', 3)\n  queue.enqueue('John', 2)\n  queue.enqueue('Jack', 1)\n  queue.print()\n\n  // 循环队列\n  class LoopQueue extends Queue {\n\n    constructor(items) {\n        super(items)\n    }\n\n    getIndex(index) {\n        const length = this.items.length\n        return index &gt; length ? (index % length) : index\n    }\n\n    find(index) {\n        return !this.isEmpty ? this.items[this.getIndex(index)] : null\n    }\n  }\n  const loopQueue = new LoopQueue(['Surmon'])\n  loopQueue.enqueue('SkyRover')\n  loopQueue.enqueue('Even')\n  console.log(loopQueue.size)      // 3\n  console.log(loopQueue.find(26))  // 'Evan'\n  ```\n\n\n# 三、链表\n> 链接方式存储数据的线性表。链表的每个数据单元就是一个节点，包含节点信息、指向后一个节点的引用地址 (称为\"链\") \n\n  <div style=\"text-indent: 2em\">数组是存储多个元素时最常用的数据结构，但是在很多编程语言中，数组的长度固定，当数组填满后再添加元素比较困难，删除和添加元素时需要将数组中的所有元素变换位置，操作成本较高。JS 数组并不存在上述问题，主要是因为它们被作为对象实现，不过效率较低。线性表的顺序存储结构由于存储元素不连续都会有以上问题，链表就是针对它的优化结果。</div>\n        \n\n## 链表类型\n  * 单链表：单一的向下传递，每个节点只记录下一个节点的信息\n  * 静态链表：基于数组实现的链表，每个节点包含了数据和指向地址\n  * 循环链表：由于单链表到达尾部时回溯到头部很麻烦，所以首尾相连形成循环\n  * 双向链表：基于单链表增加前指针，每个节点都保存两个分别指向前后节点的地址 \n\n\n## 单链表\n### 结构  \n  <div align=\"center\"> \n    ![单链表结构](images/js/link-list.png)\n  </div>\n  \n  * data中保存着数据，next保存着下一个链表的引用\n  * 我们将链表的尾元素指向了 null 节点，表示链接结束的位置\n  * 可以说 data2 跟在 data1 后面，但不能说 data2 是链表中的第二个元素\n\n### 节点操作  \n  <div align=\"center\"> \n    ![单链表节点操作](images/js/link-opration.png)\n  </div>\n\n  * 插入：修改前驱节点而使其指向新节点，并将新节点指向原前驱节点指向的节点\n  * 删除：将待删节点的前驱节点指向待删节点的，同时将待删节点指向 null\n    \n  ```js\n  // 链表节点\n  class Node {\n    constructor(element) {\n      this.element = element  // 数据\n      this.next = null        // 指针 \n    } \n  }\n\n  // 链表\n  class LinkedList {\n\n    constructor() {\n      this.head = null\n      this.length = 0\n    }\n\n    // 追加元素\n    append(element) {\n      const node = new Node(element)\n      let current = null\n      if (this.head === null) {\n          this.head = node\n      } else {\n          current = this.head\n          while(current.next) {\n              current = current.next\n          }\n          current.next = node\n      }\n      this.length++\n    }\n\n    // 任意位置插入元素\n    insert(position, element) {\n      if (position &gt;= 0 && position &lt;= this.length) {\n        const node = new Node(element)\n        let current = this.head\n        let previous = null\n        let index = 0\n        if (position === 0) {\n            this.head = node\n        } else {\n            while (index++ &lt; position) {\n              previous = current\n              current = current.next\n            }\n            node.next = current\n            previous.next = node\n        }\n        this.length++\n        return true\n      }\n      return false\n    }\n\n    // 移除指定位置元素\n    removeAt(position) {\n\n      // 检查越界值\n      if (position &gt; -1 && position &lt; length) {\n          let current = this.head\n          let previous = null\n          let index = 0\n          if (position === 0) {\n              this.head = current.next\n          } else {\n              while (index++ &lt; position) {\n                  previous = current\n                  current = current.next\n              }\n              previous.next = current.next\n          }\n          this.length--\n          return current.element\n      }\n      return null\n    }\n\n    // 寻找元素下标\n    findIndex(element) {\n      let current = this.head\n      let index = -1\n      while (current) {\n        if (element === current.element) {\n          return index + 1\n        }\n        index++\n        current = current.next\n      }\n      return -1\n    }\n\n    // 删除指定文档\n    remove(element) {\n      const index = this.indexOf(element)\n      return this.removeAt(index)\n    }\n\n    isEmpty() {\n      return !this.length\n    }\n\n    size() {\n      return this.length\n    }\n\n    // 转为字符串\n    toString() {\n      let current = this.head\n      let string = ''\n      while (current) {\n        string += ` ${current.element}`\n        current = current.next\n      }\n      return string\n    }\n  }\n\n  const linkedList = new LinkedList()\n  console.log(linkedList)\n\n  linkedList.append(2)\n  linkedList.append(6)\n  linkedList.insert(3, 18)\n  console.log(linkedList)\n  console.log(linkedList.findIndex(24))\n  ```\n\n\n## 双向链表\n  ```js\n  // 链表节点\n  class Node {\n    constructor(element) {\n      this.element = element\n      this.prev = null\n      this.next = null\n    }\n  }\n\n  // 双向链表\n  class DoublyLinkedList {\n\n    constructor() {\n      this.head = null\n      this.tail = null\n      this.length = 0\n    }\n\n    // 任意位置插入元素\n    insert(position, element) {\n      if (position &gt;= 0 && position &lt;= this.length){\n          const node = new Node(element)\n          let current = this.head\n          let previous = null\n          let index = 0\n          // 首位\n          if (position === 0) {\n              if (!head){\n                  this.head = node\n                  this.tail = node\n              } else {\n                  node.next = current\n                  this.head = node\n                  current.prev = node\n              }\n          // 末位\n          } else if (position === this.length) {\n              current = this.tail\n              current.next = node\n              node.prev = current\n              this.tail = node\n          // 中位\n          } else {\n              while (index++ &lt; position) {\n                previous = current\n                current = current.next\n              }\n              node.next = current\n              previous.next = node\n              current.prev = node\n              node.prev = previous\n          }\n          this.length++\n          return true\n      }\n      return false\n    }\n\n    // 移除指定位置元素\n    removeAt(position) {\n      if (position &gt; -1 && position &lt; this.length) {\n          let current = this.head\n          let previous = null\n          let index = 0\n\n          // 首位\n          if (position === 0) {\n              this.head = this.head.next\n              this.head.prev = null\n              if (this.length === 1) {\n                  this.tail = null\n              }\n\n          // 末位\n          } else if (position === this.length - 1) {\n              this.tail = this.tail.prev\n              this.tail.next = null\n\n          // 中位\n          } else {\n              while (index++ &lt; position) {\n                previous = current\n                current = current.next\n              }\n              previous.next = current.next\n              current.next.prev = previous\n      }\n      this.length--\n      return current.element\n      } else {\n          return null\n      }\n    }\n  }\n  ```\n\n\n# 四、集合\n> 由一组无序且唯一的项组成，操作方法可分为 并集、交集、差集。集合、字典、散列表都可以存储不重复的数据\n\n  ```js\n  // 定义\n  class Set {\n\n    constructor() {\n      this.items = {}\n    }\n\n    has(value) {\n      return this.items.hasOwnProperty(value)\n    }\n\n    add(value) {\n      if (!this.has(value)) {\n          this.items[value] = value\n          return true\n      }     \n      return false\n    }\n\n    remove(value) {\n      if (this.has(value)) {\n          delete this.items[value]\n          return true\n      }\n      return false\n    }\n\n    get size() {\n      return Object.keys(this.items).length\n    }\n\n    get values() {\n      return Object.keys(this.items)\n    }\n\n    // 并集\n    union(otherSet) {\n      const unionSet = new Set()\n      this.values.forEach((v, i) => unionSet.add(this.values[i]))\n      otherSet.values.forEach((v, i) => unionSet.add(otherSet.values[i]))\n      return unionSet\n    }\n\n    // 交集\n    intersection(otherSet) {\n      const intersectionSet = new Set()\n      this.values.forEach((v, i) => {\n          if (otherSet.has(v)) {\n              intersectionSet.add(v)\n          }\n      })\n      return intersectionSet\n    }\n    \n    // 差集\n    difference(otherSet) {\n      const differenceSet = new Set()\n      this.values.forEach((v, i) => {\n          if (!otherSet.has(v)) {\n              differenceSet.add(v)\n          }\n      })\n      return differenceSet\n    }\n\n    // 子集\n    subset(otherSet) {\n      if (this.size &gt; otherSet.size) {\n          return false\n      } else {\n          return !this.values.some(v => !otherSet.has(v))\n      } \n    }\n  }\n\n  var set1 = new Set();\n  set1.add(1);\n\n  var set2 = new Set();\n  set2.add(1);\n  set2.add(2);\n\n  // 数据\n  console.log(set1.values)   \n  console.log(set1.has(1))  \n\n  // 并集\n  let set11 = set1.union(set2);\n  console.log(set11.values);  // [1,2]\n  \n  // 交集\n  let set12  = set1.intersection(set2);\n  console.log(set12.values);  // [1]\n\n  // 差集\n  let set13 = set2.difference(set1);\n  console.log(set13.values); // [2]\n  \n  // 判断子集\n  console.log(set1.subset(set2)); // true\n  ```\n\n\n# 五、字典\n> 即映射，以键值对 { key: value } 的形式存储不重复的数据，Object 对象是字典在 Js 中的实现\n\n  ```js\n  class Dictionary {\n\n    constructor() {\n      this.items = {}\n    }\n\n    set(key, value) {\n      this.items[key] = value\n    }\n\n    get(key) {\n      return this.items[key]\n    }\n\n    remove(key) {\n      delete this.items[key]\n    }\n\n    get keys() {\n      return Object.keys(this.items)\n    }\n\n    get values() {\n\n      // 使用 ES7 values\n      // return Object.values(this.items)\n      \n      // 通过循环生成一个数组并输出\n      return Object.keys(this.items).reduce((r, c, i) => {\n          r.push(this.items[c])\n          return r\n      }, [])\n    }\n  }\n\n  const dictionary = new Dictionary()\n  dictionary.set('Gandalf', 'gandalf@email.com')\n  dictionary.set('John', 'johnsnow@email.com') \n\n  console.log(dictionary)\n  console.log(dictionary.keys) \n  ```\n\n\n# 六、散列表\n> 又称哈希表，是根据关键字而直接访问内存存储位置的数据结构。\n\n  <div style=\"text-indent: 2em\">通过计算一个数据关键字的函数，将所需查询的数据内容映射到表中的一个存放位置来访问记录，这加快了查找速度。这个映射函数称做散列函数，存放记录的数组称做散列表。简单来说，通过散列函数将要检索的项与索引（散列值）关联起来，生成一种便于搜索的数据结构（散列表）。</div>\n        \n  * 散列函数\n    * 原则：函数本身便于计算、计算出来的地址分布均匀\n    * 方法：数字分析法、平方取中法、分段叠加法、除留余数法\n  * 处理冲突\n    * 原因：键值不同的元素可能会映射到散列表的同一地址，称为 hash 冲突\n    * 方法\n      * 拉链法/分离链接：将所有散列地址相同的记录都放入一个线性链表\n      * 开放定址法：冲突时寻找散列表中的空地址     \n        * 线性探测：顺序查看表中下一单元\n        * 二次探测：在表的左右进行跳跃式探测\n        * 随机探测：建立一个伪随机数发生器\n      * 再散列法：冲突时通过其它散列函数计算地址\n      * 建立公共溢出区：将所有和散列表冲突的元素都放入溢出表\n    \n  ```js\n  class HashTable {\n\n    constructor() {\n      this.table = []\n    }\n\n    // 散列函数\n    static loseloseHashCode(key) {\n      let hash = 0\n      for (let codePoint of key) {\n        hash += codePoint.charCodeAt()\n      }\n      return hash % 37\n    }\n\n    // 不考虑冲突\n    put(key, value) {\n      const position = HashTable.loseloseHashCode(key)\n      console.log(`${position} - ${key}`)\n      this.table[position] = value\n    }\n    get(key) {\n      return this.table[HashTable.loseloseHashCode(key)]\n    }\n    remove(key) {\n      this.table[HashTable.loseloseHashCode(key)] = undefined\n    }\n\n    // 分离链接处理冲突：需要一个辅助类 LinkedList 表示要加入的元素\n    put(key, value) {\n      const position = HashTable.loseloseHashCode(key)\n      if (this.table[position] === undefined) {\n         this.table[position] = new LinkedList()\n      }\n      this.table[position].append({ key, value })\n    }\n    get(key) {\n      const position = HashTable.loseloseHashCode(key)\n      if (this.table[position] === undefined) return undefined\n      const getElementValue = node => {\n        if (!node && !node.element) return undefined\n        if (Object.is(node.element.key, key)) {\n            return node.element.value\n        } else {\n            return getElementValue(node.next)\n        }\n      }\n      return getElementValue(this.table[position].head)\n    }\n    remove(key) {\n      const position = HashTable.loseloseHashCode(key)\n      if (this.table[position] === undefined) return undefined\n      const getElementValue = node => {\n        if (!node && !node.element) return false\n        if (Object.is(node.element.key, key)) {\n            this.table[position].remove(node.element)\n            if (this.table[position].isEmpty) {\n                this.table[position] = undefined\n            }\n            return true\n        } else {\n            return getElementValue(node.next)\n        }\n      }\n      return getElementValue(this.table[position].head)\n    }\n\n    // 线性探查\n    put(key, value) {\n      const position = HashTable.loseloseHashCode(key)\n      if (this.table[position] === undefined) {\n          this.table[position] = { key, value }\n      } else {\n          let index = ++position\n          while (this.table[index] !== undefined) {\n            index++\n          }\n          this.table[index] = { key, value }\n      }\n      this.table[position].append({ key, value })\n    }\n    get(key) {\n      const position = HashTable.loseloseHashCode(key)\n      const getElementValue = index => {\n        if (this.table[index] === undefined) return undefined\n        if (Object.is(this.table[index].key, key)) {\n            return this.table[index].value\n        } else {\n            return getElementValue(index + 1)\n        }\n      }\n      return getElementValue(position)\n    }\n    remove(key) {\n      const position = HashTable.loseloseHashCode(key)\n      const removeElementValue = index => {\n        if (this.table[index] === undefined) return false\n        if (Object.is(this.table[index].key, key)) {\n            this.table[index] = undefined\n            return true\n        } else {\n            return removeElementValue(index + 1)\n        }\n      }\n      return removeElementValue(position)\n    }\n  }\n\n  const hash = new HashTable()\n  hash.put('Surmon', 'surmon.me@email.com')  // 19 - Surmon\n  hash.put('John', 'johnsnow@email.com')     // 29 - John\n\n  console.log(hash.get('Surmon'))  // surmon.me@email.com\n  console.log(hash.get('Loiane'))  // undefined\n  console.log(hash)\n  ```\n\n\n# 七、树\n> 一对多的非线性结构、分层数据的抽象模型。树状结构分为树和二叉树，树的操作比较复杂但可以转换为二叉树处理\n\n\n## 树\n  * 定义：n 个相同类型的数据元素的有限集合，树的集合为森林\n  * 属性\n    * 节点：树中的数据元素\n      * 根节点：没有父节点\n      * 分支节点：有子节点\n      * 叶子节点：没有子节点\n    * 子树：节点组成的树\n    * 层级：可以按照节点级别分层\n    * 深度：节点到根节点的节点数量\n    * 高度：所有节点深度中的最大值\n    * 权值：\n  * 分类\n    * 无序树：子节点之间没有顺序关系，又称自由树\n    * 有序树：子节点之间有顺序关系\n      * 二叉树：每个节点最多含有两个子树\n        * 完全二叉树：最后一层右边可能满或不满，左边和其余层都是满的。堆就是一个完全二叉树\n        * 满二叉树：所有叶节点都在最底层的完全二叉树\n        * 排序二叉树：有序二叉树、二叉查找树、二叉搜索树\n        * 平衡二叉树：AVL树，任何节点的左右子树的高度差不超过 1\n      * 哈夫曼树：最优二叉树，带权路径最短的二叉树\n        * 路径长度：两个节点之间所经过的分支数目\n        * 树带权路径长度：所有叶子节点的带权路径长度之和\n        * 节点带权路径长度：节点到根节点的分支数目和该节点权值的乘积\n      * B 树：一种对读写操作进行优化的自平衡的二叉查找树，能够保持数据有序，拥有多余两个子树。\n\n\n## 二叉树\n\n### 遍历方式\n  * 中序遍历\n    * 顺序：左侧子节点、节点本身、右侧子节点\n    * 应用：排序操作\n  * 前序遍历\n    * 顺序：节点本身、左侧子节点、右侧子节点\n    * 应用：打印一个结构化的文档\n  * 后序遍历\n    * 顺序：左侧子节点、节点本身、右侧子节点\n    * 应用：计算目录及其子目录的文件空间\n\n\n### 存储结构\n\n  <div align=\"center\">\n    ![二叉树顺序存储结构](images/js/binary-order.png)\n  </div>\n  <div align=\"center\">\n    ![二叉树链式存储结构](images/js/binary-link.png)\n  </div>\n\n  ```js\n  // 顺序存储结构\n  var tree = [1, 2, 3, 4, 5, , 6, , , 7];\n\n  // 链式存储结构\n  class BinaryNode {\n    constructor(key, left = null, right = null) {\n      this.key = key\n      this.left = left\n      this.right = right\n    }\n  }\n  ```\n\n\n### 基础定义\n\n  ```js\n  class Node {\n    constructor(key) {\n      // 数据元素\n      this.key = key \n      // 指向左右节点的指针\n      this.left = null    \n      this.right = null\n    }\n  }\n\n  class BinarySearchTree {\n\n    constructor() {\n      this.root = null\n    }\n\n    insert(key) {\n      const newNode = new Node(key)\n      const insertNode = (node, newNode) => {\n          if (newNode.key &lt; node.key) {\n              if (node.left === null) {\n                  node.left = newNode\n              } else {\n                  insertNode(node.left, newNode)\n              }\n          } else {\n              if (node.right === null) {\n                  node.right = newNode\n              } else {\n                  insertNode(node.right, newNode)\n              }\n          }\n      }\n      if (!this.root) {\n          this.root = newNode\n      } else {\n          insertNode(this.root, newNode)\n      }\n    }\n\n    // 中序遍历\n    inOrderTraverse(callback) {\n      const inOrderTraverseNode = (node, callback) => {\n          if (node !== null) {\n              inOrderTraverseNode(node.left, callback)\n              callback(node.key)\n              inOrderTraverseNode(node.right, callback)\n          }\n      }\n      inOrderTraverseNode(this.root, callback)\n    }\n\n    // 先序遍历\n    preOrderTraverse(callback) {\n      const preOrderTraverseNode = (node, callback) => {\n        if (node !== null) {\n            callback(node.key)\n            preOrderTraverseNode(node.left, callback)\n            preOrderTraverseNode(node.right, callback)\n        }\n      }\n      preOrderTraverseNode(this.root, callback)\n    }\n\n    // 后序遍历\n    postOrderTraverse(callback) {\n      const postOrderTraverseNode = (node, callback) => {\n        if (node !== null) {\n            postOrderTraverseNode(node.left, callback)\n            postOrderTraverseNode(node.right, callback)\n            callback(node.key)\n        }\n      }\n      postOrderTraverseNode(this.root, callback)\n    }\n\n    min(node) {\n      const minNode = node => {\n        return node ? (node.left ? minNode(node.left) : node) : null\n      }\n      return minNode(node || this.root)\n    }\n\n    max(node) {\n      const maxNode = node => {\n        return node ? (node.right ? maxNode(node.right) : node) : null\n      }\n      return maxNode(node || this.root)\n    }\n\n    search(key) {\n      const searchNode = (node, key) => {\n        if (node === null) return false\n        if (node.key === key) return node\n        return searchNode((key &lt; node.key) ? node.left : node.right, key)\n      }\n      return searchNode(root, key)\n    }\n\n    remove(key) {\n      return this._removeNode(this.root, key)\n    }\n\n    _removeNode(node, key) {\n      if (node === null) return false\n\n      if (key &lt; node.key) {\n          node.left = this._removeNode(node.left, key)\n          return node\n      } else if (key &gt; node.key) {\n          node.right = this._removeNode(node.right, key)\n          return node\n      } else {\n          if (node.left === null && node.right === null) {\n              return null\n          }\n          if (node.left === null) {\n              return node.right\n          } else if (node.right === null) {\n              return node.left\n          } else {\n              const minNode = this._findMinNode(node.right)\n              node.key = minNode.key\n              node.right = this._removeNode(node.right, minNode.key)\n              return node\n          }\n      }\n    }\n  }\n\n  const tree = new BinarySearchTree()\n  tree.insert(11)\n  tree.insert(7)\n  tree.insert(5)\n  console.log(tree)\n  tree.inOrderTraverse(value => { console.log(value) })\n  ```\n\n\n# 八、图\n> 由一系列顶点和连接顶点的边组成的一种非线性数据结构，可以用来表示任何二元关系\n\n## 图的表示\n> 没有绝对正确的表示方式，采用哪种方式取决于图的类型和待解决的问题\n\n### 邻接矩阵    \n  * 使用一个二维数组来表示图中顶点之间的连接\n  * 如果索引为 i、j 的两个节点连接，则 arr[i][j] === 1，否则为 0\n  * 缺点：只有一个相邻顶点的顶点也需要一整行来表示连接，浪费内存\n\n  <div align=\"center\"> \n    ![邻接矩阵](images/js/near-matrix.png)\n  </div>\n\n\n### 邻接表  \n  * 由图中每个顶点的相邻顶点列表所组成\n  * 只要能表示一对多的数据结构都可以用来描述邻接表，比如多维数组、链表、散列表、字典等\n\n  <div align=\"center\"> \n    ![邻接表](images/js/near-table.png)\n  </div>\n\n### 关联矩阵  \n  * 矩阵的行列分别表示顶点和边，使用二维数组表示两者之间的连通性\n  * 如果顶点A 是边 E 的入射点，则 array[A][E] === 1，否则为 0\n  * 通常用于边的数量比顶点少的情况，以节省空间和内存。\n\n  <div align=\"center\">\n    ![关联矩阵](images/js/near-table.png)\n  </div>\n\n    \n## 图的遍历\n> 可以用来寻找特定的顶点或寻找两个顶点之间的路径，检查图是否连通，检查图是否含有环等。思路是追踪每个第一次访问的节点，并且追踪有哪些节点还没有被完全探索。\n\n  * 广度优先搜索：一层一层的遍历顶点\n  * 深度优先搜索：选择一个路径一直深入遍历直到尽头，再递归回去选择未访问的顶点\n        \n\n## 创建图类\n\n  ```js\n  class Graph {\n\n    constructor() {\n      this.vertices = []\n      this.adjList = new Dictionary()\n    }\n\n    // 添加顶点\n    addVertex(v) {\n      this.vertices.push(v)\n      this.adjList.set(v, [])\n    }\n\n    // 添加线\n    addEdge(v, w) {\n      this.adjList.get(v).push(w)\n      this.adjList.get(w).push(v)\n    }\n\n    toString() {\n      return this.vertices.reduce((r, v, i) => {\n          return this.adjList.get(v).reduce((r, w, i) => {\n              return r + `${w} `\n          }, `${r}\\n${v} => `)\n      }, '')\n    }\n\n    // 构建顶点之间的路径\n    distance(fromVertex) {\n      const vertices = this.vertices\n      const { distances, predecessors } = this.bfs(fromVertex)\n      vertices.forEach(toVertex => {\n          if (!!distances[toVertex]) {\n              let preVertex = predecessors[toVertex]\n              let slug = ''\n              while (fromVertex !== preVertex) {\n                  slug = `${preVertex} - ${slug}`\n                  preVertex = predecessors[preVertex]\n              }\n              slug = `${fromVertex} - ${slug}${toVertex}`\n              console.log(slug)\n          }\n      })\n    }\n\n    // 广度优先搜索算法\n    bfs(v, callback) {\n        const read = []\n        const distances = []\n        const predecessors = []\n        const adjList = this.adjList\n        const pending = [v || this.vertices[0]]\n        const readVertices = vertices => {\n          vertices.forEach(key => {\n              read.push(key)\n              pending.shift()\n              distances[key] = distances[key] || 0\n              predecessors[key] = predecessors[key] || null\n              adjList.get(key).forEach(v => {\n                  if (!pending.includes(v) && !read.includes(v)) {\n                      pending.push(v)\n                      distances[v] = distances[key] + 1\n                      predecessors[v] = key\n                  }\n              })\n              if (callback) callback(key)\n              if (pending.length) readVertices(pending)\n          })\n        }\n        readVertices(pending)\n        return { distances, predecessors }\n    }\n\n    // 深度优先搜索算法\n    dfs(callback) {\n        let readTimer = 0\n        const read = []\n        const readTimes = []\n        const finishedTimes = []\n        const predecessors = []\n        const adjList = this.adjList\n        const readVertices = (vertices, predecessor) => {\n          vertices.forEach(key => {\n              readTimer++\n              if (adjList.get(key).every(v => read.includes(v)) && !finishedTimes[key]) {\n                  finishedTimes[key] = readTimer\n              }\n              if (read.includes(key)) return false\n              readTimes[key] = readTimer\n              read.push(key)\n              if (callback) callback(key)\n              predecessors[key] = predecessors[key] || predecessor || null\n              if (read.length !== this.vertices.length) {\n                  readVertices(adjList.get(key), key)\n              }\n          })\n        }\n        readVertices(adjList.keys)\n        return { readTimes, finishedTimes, predecessors }\n    }\n  }\n\n\n  const graph = new Graph()\n  const vertices = ['A','B','C','D'];\n  vertices.forEach(v => graph.addVertex(v))\n\n  graph.addEdge('A', 'B')\n  graph.addEdge('A', 'C')\n  graph.addEdge('A', 'D')\n  graph.addEdge('C', 'D')\n\n  console.log(graph.toString())  \n  graph.bfs(graph.vertices[0], value => console.log('Visited: ' + value))\n  ```\n\n\n\n","slug":"9-js数据结构","published":1,"updated":"2019-05-10T17:15:16.101Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvid4pmy00280nbxc19tbwtc","content":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><html><head></head><body><h1 id=\"数据结构\"><a href=\"#数据结构\" class=\"headerlink\" title=\"数据结构\"></a>数据结构</h1><blockquote><p>计算机存储、组织数据的方式</p></blockquote><h2 id=\"逻辑结构\"><a href=\"#逻辑结构\" class=\"headerlink\" title=\"逻辑结构\"></a>逻辑结构</h2><blockquote><p>数据组织方式</p></blockquote><ul><li><strong>集合结构</strong><ul><li>操作：并集、交集、补集</li><li>特点<ul><li>集合由一组无序且唯一的项组成</li><li>单个数据元素之间没有任何关系</li></ul></li></ul></li><li><strong>线性结构</strong><ul><li>类型：线性表，包括 堆、栈、队列、一维数组</li><li>特点<ul><li>数据元素是有序的</li><li>数据元素之间存在 一对一 的层次关系</li></ul></li></ul></li><li><strong>树形结构</strong><ul><li>类型：树</li><li>数据元素之间存在 一对多 的层次关系</li></ul></li><li><strong>图形结构</strong><ul><li>类型：图</li><li>数据元素之间是 多对多 的层次关系</li></ul></li></ul><h2 id=\"物理结构\"><a href=\"#物理结构\" class=\"headerlink\" title=\"物理结构\"></a>物理结构</h2><blockquote><p>数据存储方式</p></blockquote><ul><li><strong>顺序存储</strong><ul><li>内存：元素连续放置，基于位置关系访问</li><li>优点：随机访问</li><li>缺点：插入删除效率低，大小固定</li></ul></li><li><strong>链式存储</strong><ul><li>内存：元素并不连续放置，基于引用指针关系访问</li><li>优点：大小动态扩展，插入删除效率高</li><li>缺点：访问链表元素需要循环查找，不能随机访问</li></ul></li><li><strong>索引存储</strong><ul><li>内存：整体无序但索引块之间有序</li><li>优点：对顺序查找的一种改进，查找效率高</li><li>缺点：需要额外空间存储索引表</li></ul></li><li><strong>散列存储</strong><ul><li>内存：数据元素根据函数计算存储位置</li><li>优点：基于数据本身查找，查找和存取效率高</li><li>缺点：存取随机而不利于顺序查找，存储位置可能相同而冲突</li></ul></li></ul><h1 id=\"一、栈\"><a href=\"#一、栈\" class=\"headerlink\" title=\"一、栈\"></a>一、栈</h1><ul><li>一种遵循先进后出原则的特殊线性表</li><li>它基于数组或链表实现，只能在栈顶增删元素</li><li><p>新元素靠近栈顶，旧元素靠近栈底，类似叠起来的书</p><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 定义栈类</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Stack</span> </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 底层数据结构是数组</span></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() {</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.items = []</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 入栈</span></span><br><span class=\"line\">  push(element) {</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.items.push(element)</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 出栈</span></span><br><span class=\"line\">  pop() {</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.items.pop()</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 末位</span></span><br><span class=\"line\">  <span class=\"keyword\">get</span> peek() {</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.items[<span class=\"keyword\">this</span>.items.length - <span class=\"number\">1</span>]</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 是否为空栈</span></span><br><span class=\"line\">  <span class=\"keyword\">get</span> isEmpty() {</span><br><span class=\"line\">    <span class=\"keyword\">return</span> !<span class=\"keyword\">this</span>.items.length</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 尺寸</span></span><br><span class=\"line\">  <span class=\"keyword\">get</span> size() {</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.items.length</span><br><span class=\"line\">  }</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// 清空栈</span></span><br><span class=\"line\">  clear() {</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.items = []</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用栈类</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> stack = <span class=\"keyword\">new</span> Stack()</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(stack.isEmpty)  <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br><span class=\"line\">stack.push(<span class=\"number\">5</span>)</span><br><span class=\"line\">stack.push(<span class=\"number\">8</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(stack.peek)     <span class=\"comment\">// 8</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(stack.size)     <span class=\"comment\">// 2</span></span><br></pre></td></tr></tbody></table></figure></li></ul><h1 id=\"二、队列\"><a href=\"#二、队列\" class=\"headerlink\" title=\"二、队列\"></a>二、队列</h1><ul><li>一种遵循先进先出原则的特殊线性表</li><li><p>只能队尾添加、队首删除元素，类似排队人群</p><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Queue</span> </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(items) {</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.items = items || []</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 循环队列</span></span><br><span class=\"line\">  enqueue(element){</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.items.push(element)</span><br><span class=\"line\">  }</span><br><span class=\"line\">  <span class=\"comment\">// 优先队列：根据优先级增删</span></span><br><span class=\"line\">  enqueue(element, priority){</span><br><span class=\"line\">    <span class=\"keyword\">const</span> queueElement = { element, priority }</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.isEmpty) {</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.items.push(queueElement)</span><br><span class=\"line\">    } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">        <span class=\"keyword\">const</span> preIndex = <span class=\"keyword\">this</span>.items.findIndex(<span class=\"function\">(<span class=\"params\">item</span>) =></span> queueElement.priority &lt; item.priority)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (preIndex &gt; <span class=\"number\">-1</span>) {</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.items.splice(preIndex, <span class=\"number\">0</span>, queueElement)</span><br><span class=\"line\">        } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.items.push(queueElement)</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  dequeue(){</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.items.shift()</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  front(){</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.items[<span class=\"number\">0</span>]</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  clear(){</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.items = []</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">get</span> size(){</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.items.length</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">get</span> isEmpty(){</span><br><span class=\"line\">    <span class=\"keyword\">return</span> !<span class=\"keyword\">this</span>.items.length</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  print() {</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.items)</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 实例化</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> queue = <span class=\"keyword\">new</span> Queue()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 普通队列</span></span><br><span class=\"line\">queue.enqueue(<span class=\"string\">'John'</span>)</span><br><span class=\"line\">queue.enqueue(<span class=\"string\">'Jack'</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(queue.size)     <span class=\"comment\">// 2</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(queue.isEmpty)  <span class=\"comment\">// false</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 优先队列</span></span><br><span class=\"line\">queue.enqueue(<span class=\"string\">'Surmon'</span>, <span class=\"number\">3</span>)</span><br><span class=\"line\">queue.enqueue(<span class=\"string\">'John'</span>, <span class=\"number\">2</span>)</span><br><span class=\"line\">queue.enqueue(<span class=\"string\">'Jack'</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">queue.print()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 循环队列</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LoopQueue</span> <span class=\"keyword\">extends</span> <span class=\"title\">Queue</span> </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(items) {</span><br><span class=\"line\">      <span class=\"keyword\">super</span>(items)</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  getIndex(index) {</span><br><span class=\"line\">      <span class=\"keyword\">const</span> length = <span class=\"keyword\">this</span>.items.length</span><br><span class=\"line\">      <span class=\"keyword\">return</span> index &gt; length ? (index % length) : index</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  find(index) {</span><br><span class=\"line\">      <span class=\"keyword\">return</span> !<span class=\"keyword\">this</span>.isEmpty ? <span class=\"keyword\">this</span>.items[<span class=\"keyword\">this</span>.getIndex(index)] : <span class=\"literal\">null</span></span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">const</span> loopQueue = <span class=\"keyword\">new</span> LoopQueue([<span class=\"string\">'Surmon'</span>])</span><br><span class=\"line\">loopQueue.enqueue(<span class=\"string\">'SkyRover'</span>)</span><br><span class=\"line\">loopQueue.enqueue(<span class=\"string\">'Even'</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(loopQueue.size)      <span class=\"comment\">// 3</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(loopQueue.find(<span class=\"number\">26</span>))  <span class=\"comment\">// 'Evan'</span></span><br></pre></td></tr></tbody></table></figure></li></ul><h1 id=\"三、链表\"><a href=\"#三、链表\" class=\"headerlink\" title=\"三、链表\"></a>三、链表</h1><blockquote><p>链接方式存储数据的线性表。链表的每个数据单元就是一个节点，包含节点信息、指向后一个节点的引用地址 (称为”链”)</p></blockquote><div style=\"text-indent:2em\">数组是存储多个元素时最常用的数据结构，但是在很多编程语言中，数组的长度固定，当数组填满后再添加元素比较困难，删除和添加元素时需要将数组中的所有元素变换位置，操作成本较高。JS 数组并不存在上述问题，主要是因为它们被作为对象实现，不过效率较低。线性表的顺序存储结构由于存储元素不连续都会有以上问题，链表就是针对它的优化结果。</div><h2 id=\"链表类型\"><a href=\"#链表类型\" class=\"headerlink\" title=\"链表类型\"></a>链表类型</h2><ul><li>单链表：单一的向下传递，每个节点只记录下一个节点的信息</li><li>静态链表：基于数组实现的链表，每个节点包含了数据和指向地址</li><li>循环链表：由于单链表到达尾部时回溯到头部很麻烦，所以首尾相连形成循环</li><li>双向链表：基于单链表增加前指针，每个节点都保存两个分别指向前后节点的地址</li></ul><h2 id=\"单链表\"><a href=\"#单链表\" class=\"headerlink\" title=\"单链表\"></a>单链表</h2><h3 id=\"结构\"><a href=\"#结构\" class=\"headerlink\" title=\"结构\"></a>结构</h3><div align=\"center\"><br><img src=\"images/js/link-list.png\" alt=\"单链表结构\"><br></div><ul><li>data中保存着数据，next保存着下一个链表的引用</li><li>我们将链表的尾元素指向了 null 节点，表示链接结束的位置</li><li>可以说 data2 跟在 data1 后面，但不能说 data2 是链表中的第二个元素</li></ul><h3 id=\"节点操作\"><a href=\"#节点操作\" class=\"headerlink\" title=\"节点操作\"></a>节点操作</h3><div align=\"center\"><br><img src=\"images/js/link-opration.png\" alt=\"单链表节点操作\"><br></div><ul><li>插入：修改前驱节点而使其指向新节点，并将新节点指向原前驱节点指向的节点</li><li><p>删除：将待删节点的前驱节点指向待删节点的，同时将待删节点指向 null</p><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 链表节点</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Node</span> </span>{</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(element) {</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.element = element  <span class=\"comment\">// 数据</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.next = <span class=\"literal\">null</span>        <span class=\"comment\">// 指针 </span></span><br><span class=\"line\">  } </span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 链表</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LinkedList</span> </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() {</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.head = <span class=\"literal\">null</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.length = <span class=\"number\">0</span></span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 追加元素</span></span><br><span class=\"line\">  append(element) {</span><br><span class=\"line\">    <span class=\"keyword\">const</span> node = <span class=\"keyword\">new</span> Node(element)</span><br><span class=\"line\">    <span class=\"keyword\">let</span> current = <span class=\"literal\">null</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.head === <span class=\"literal\">null</span>) {</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.head = node</span><br><span class=\"line\">    } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">        current = <span class=\"keyword\">this</span>.head</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(current.next) {</span><br><span class=\"line\">            current = current.next</span><br><span class=\"line\">        }</span><br><span class=\"line\">        current.next = node</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.length++</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 任意位置插入元素</span></span><br><span class=\"line\">  insert(position, element) {</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (position &gt;= <span class=\"number\">0</span> && position &lt;= <span class=\"keyword\">this</span>.length) {</span><br><span class=\"line\">      <span class=\"keyword\">const</span> node = <span class=\"keyword\">new</span> Node(element)</span><br><span class=\"line\">      <span class=\"keyword\">let</span> current = <span class=\"keyword\">this</span>.head</span><br><span class=\"line\">      <span class=\"keyword\">let</span> previous = <span class=\"literal\">null</span></span><br><span class=\"line\">      <span class=\"keyword\">let</span> index = <span class=\"number\">0</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (position === <span class=\"number\">0</span>) {</span><br><span class=\"line\">          <span class=\"keyword\">this</span>.head = node</span><br><span class=\"line\">      } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">          <span class=\"keyword\">while</span> (index++ &lt; position) {</span><br><span class=\"line\">            previous = current</span><br><span class=\"line\">            current = current.next</span><br><span class=\"line\">          }</span><br><span class=\"line\">          node.next = current</span><br><span class=\"line\">          previous.next = node</span><br><span class=\"line\">      }</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.length++</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 移除指定位置元素</span></span><br><span class=\"line\">  removeAt(position) {</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 检查越界值</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (position &gt; <span class=\"number\">-1</span> && position &lt; length) {</span><br><span class=\"line\">        <span class=\"keyword\">let</span> current = <span class=\"keyword\">this</span>.head</span><br><span class=\"line\">        <span class=\"keyword\">let</span> previous = <span class=\"literal\">null</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> index = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (position === <span class=\"number\">0</span>) {</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.head = current.next</span><br><span class=\"line\">        } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (index++ &lt; position) {</span><br><span class=\"line\">                previous = current</span><br><span class=\"line\">                current = current.next</span><br><span class=\"line\">            }</span><br><span class=\"line\">            previous.next = current.next</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.length--</span><br><span class=\"line\">        <span class=\"keyword\">return</span> current.element</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span></span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 寻找元素下标</span></span><br><span class=\"line\">  findIndex(element) {</span><br><span class=\"line\">    <span class=\"keyword\">let</span> current = <span class=\"keyword\">this</span>.head</span><br><span class=\"line\">    <span class=\"keyword\">let</span> index = <span class=\"number\">-1</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (current) {</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (element === current.element) {</span><br><span class=\"line\">        <span class=\"keyword\">return</span> index + <span class=\"number\">1</span></span><br><span class=\"line\">      }</span><br><span class=\"line\">      index++</span><br><span class=\"line\">      current = current.next</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span></span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 删除指定文档</span></span><br><span class=\"line\">  remove(element) {</span><br><span class=\"line\">    <span class=\"keyword\">const</span> index = <span class=\"keyword\">this</span>.indexOf(element)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.removeAt(index)</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  isEmpty() {</span><br><span class=\"line\">    <span class=\"keyword\">return</span> !<span class=\"keyword\">this</span>.length</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  size() {</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.length</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 转为字符串</span></span><br><span class=\"line\">  toString() {</span><br><span class=\"line\">    <span class=\"keyword\">let</span> current = <span class=\"keyword\">this</span>.head</span><br><span class=\"line\">    <span class=\"keyword\">let</span> string = <span class=\"string\">''</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (current) {</span><br><span class=\"line\">      string += <span class=\"string\">` <span class=\"subst\">${current.element}</span>`</span></span><br><span class=\"line\">      current = current.next</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> string</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> linkedList = <span class=\"keyword\">new</span> LinkedList()</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(linkedList)</span><br><span class=\"line\"></span><br><span class=\"line\">linkedList.append(<span class=\"number\">2</span>)</span><br><span class=\"line\">linkedList.append(<span class=\"number\">6</span>)</span><br><span class=\"line\">linkedList.insert(<span class=\"number\">3</span>, <span class=\"number\">18</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(linkedList)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(linkedList.findIndex(<span class=\"number\">24</span>))</span><br></pre></td></tr></tbody></table></figure></li></ul><h2 id=\"双向链表\"><a href=\"#双向链表\" class=\"headerlink\" title=\"双向链表\"></a>双向链表</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 链表节点</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Node</span> </span>{</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(element) {</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.element = element</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.prev = <span class=\"literal\">null</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.next = <span class=\"literal\">null</span></span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 双向链表</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DoublyLinkedList</span> </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() {</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.head = <span class=\"literal\">null</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.tail = <span class=\"literal\">null</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.length = <span class=\"number\">0</span></span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 任意位置插入元素</span></span><br><span class=\"line\">  insert(position, element) {</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (position &gt;= <span class=\"number\">0</span> && position &lt;= <span class=\"keyword\">this</span>.length){</span><br><span class=\"line\">        <span class=\"keyword\">const</span> node = <span class=\"keyword\">new</span> Node(element)</span><br><span class=\"line\">        <span class=\"keyword\">let</span> current = <span class=\"keyword\">this</span>.head</span><br><span class=\"line\">        <span class=\"keyword\">let</span> previous = <span class=\"literal\">null</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> index = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"comment\">// 首位</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (position === <span class=\"number\">0</span>) {</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!head){</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.head = node</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.tail = node</span><br><span class=\"line\">            } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">                node.next = current</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.head = node</span><br><span class=\"line\">                current.prev = node</span><br><span class=\"line\">            }</span><br><span class=\"line\">        <span class=\"comment\">// 末位</span></span><br><span class=\"line\">        } <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (position === <span class=\"keyword\">this</span>.length) {</span><br><span class=\"line\">            current = <span class=\"keyword\">this</span>.tail</span><br><span class=\"line\">            current.next = node</span><br><span class=\"line\">            node.prev = current</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.tail = node</span><br><span class=\"line\">        <span class=\"comment\">// 中位</span></span><br><span class=\"line\">        } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (index++ &lt; position) {</span><br><span class=\"line\">              previous = current</span><br><span class=\"line\">              current = current.next</span><br><span class=\"line\">            }</span><br><span class=\"line\">            node.next = current</span><br><span class=\"line\">            previous.next = node</span><br><span class=\"line\">            current.prev = node</span><br><span class=\"line\">            node.prev = previous</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.length++</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 移除指定位置元素</span></span><br><span class=\"line\">  removeAt(position) {</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (position &gt; <span class=\"number\">-1</span> && position &lt; <span class=\"keyword\">this</span>.length) {</span><br><span class=\"line\">        <span class=\"keyword\">let</span> current = <span class=\"keyword\">this</span>.head</span><br><span class=\"line\">        <span class=\"keyword\">let</span> previous = <span class=\"literal\">null</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> index = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 首位</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (position === <span class=\"number\">0</span>) {</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.head = <span class=\"keyword\">this</span>.head.next</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.head.prev = <span class=\"literal\">null</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.length === <span class=\"number\">1</span>) {</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.tail = <span class=\"literal\">null</span></span><br><span class=\"line\">            }</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 末位</span></span><br><span class=\"line\">        } <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (position === <span class=\"keyword\">this</span>.length - <span class=\"number\">1</span>) {</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.tail = <span class=\"keyword\">this</span>.tail.prev</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.tail.next = <span class=\"literal\">null</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 中位</span></span><br><span class=\"line\">        } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (index++ &lt; position) {</span><br><span class=\"line\">              previous = current</span><br><span class=\"line\">              current = current.next</span><br><span class=\"line\">            }</span><br><span class=\"line\">            previous.next = current.next</span><br><span class=\"line\">            current.next.prev = previous</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.length--</span><br><span class=\"line\">    <span class=\"keyword\">return</span> current.element</span><br><span class=\"line\">    } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">null</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h1 id=\"四、集合\"><a href=\"#四、集合\" class=\"headerlink\" title=\"四、集合\"></a>四、集合</h1><blockquote><p>由一组无序且唯一的项组成，操作方法可分为 并集、交集、差集。集合、字典、散列表都可以存储不重复的数据</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 定义</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Set</span> </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() {</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.items = {}</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  has(value) {</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.items.hasOwnProperty(value)</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  add(value) {</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.has(value)) {</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.items[value] = value</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    }     </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  remove(value) {</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.has(value)) {</span><br><span class=\"line\">        <span class=\"keyword\">delete</span> <span class=\"keyword\">this</span>.items[value]</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">get</span> size() {</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.keys(<span class=\"keyword\">this</span>.items).length</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">get</span> values() {</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.keys(<span class=\"keyword\">this</span>.items)</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 并集</span></span><br><span class=\"line\">  union(otherSet) {</span><br><span class=\"line\">    <span class=\"keyword\">const</span> unionSet = <span class=\"keyword\">new</span> <span class=\"built_in\">Set</span>()</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.values.forEach(<span class=\"function\">(<span class=\"params\">v, i</span>) =></span> unionSet.add(<span class=\"keyword\">this</span>.values[i]))</span><br><span class=\"line\">    otherSet.values.forEach(<span class=\"function\">(<span class=\"params\">v, i</span>) =></span> unionSet.add(otherSet.values[i]))</span><br><span class=\"line\">    <span class=\"keyword\">return</span> unionSet</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 交集</span></span><br><span class=\"line\">  intersection(otherSet) {</span><br><span class=\"line\">    <span class=\"keyword\">const</span> intersectionSet = <span class=\"keyword\">new</span> <span class=\"built_in\">Set</span>()</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.values.forEach(<span class=\"function\">(<span class=\"params\">v, i</span>) =></span> {</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (otherSet.has(v)) {</span><br><span class=\"line\">            intersectionSet.add(v)</span><br><span class=\"line\">        }</span><br><span class=\"line\">    })</span><br><span class=\"line\">    <span class=\"keyword\">return</span> intersectionSet</span><br><span class=\"line\">  }</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// 差集</span></span><br><span class=\"line\">  difference(otherSet) {</span><br><span class=\"line\">    <span class=\"keyword\">const</span> differenceSet = <span class=\"keyword\">new</span> <span class=\"built_in\">Set</span>()</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.values.forEach(<span class=\"function\">(<span class=\"params\">v, i</span>) =></span> {</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!otherSet.has(v)) {</span><br><span class=\"line\">            differenceSet.add(v)</span><br><span class=\"line\">        }</span><br><span class=\"line\">    })</span><br><span class=\"line\">    <span class=\"keyword\">return</span> differenceSet</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 子集</span></span><br><span class=\"line\">  subset(otherSet) {</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.size &gt; otherSet.size) {</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">        <span class=\"keyword\">return</span> !<span class=\"keyword\">this</span>.values.some(<span class=\"function\"><span class=\"params\">v</span> =></span> !otherSet.has(v))</span><br><span class=\"line\">    } </span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> set1 = <span class=\"keyword\">new</span> <span class=\"built_in\">Set</span>();</span><br><span class=\"line\">set1.add(<span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> set2 = <span class=\"keyword\">new</span> <span class=\"built_in\">Set</span>();</span><br><span class=\"line\">set2.add(<span class=\"number\">1</span>);</span><br><span class=\"line\">set2.add(<span class=\"number\">2</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 数据</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(set1.values)   </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(set1.has(<span class=\"number\">1</span>))  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 并集</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> set11 = set1.union(set2);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(set11.values);  <span class=\"comment\">// [1,2]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 交集</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> set12  = set1.intersection(set2);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(set12.values);  <span class=\"comment\">// [1]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 差集</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> set13 = set2.difference(set1);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(set13.values); <span class=\"comment\">// [2]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 判断子集</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(set1.subset(set2)); <span class=\"comment\">// true</span></span><br></pre></td></tr></tbody></table></figure><h1 id=\"五、字典\"><a href=\"#五、字典\" class=\"headerlink\" title=\"五、字典\"></a>五、字典</h1><blockquote><p>即映射，以键值对 { key: value } 的形式存储不重复的数据，Object 对象是字典在 Js 中的实现</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Dictionary</span> </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() {</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.items = {}</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">set</span>(key, value) {</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.items[key] = value</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">get</span>(key) {</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.items[key]</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  remove(key) {</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"keyword\">this</span>.items[key]</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">get</span> keys() {</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.keys(<span class=\"keyword\">this</span>.items)</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">get</span> values() {</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 使用 ES7 values</span></span><br><span class=\"line\">    <span class=\"comment\">// return Object.values(this.items)</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 通过循环生成一个数组并输出</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.keys(<span class=\"keyword\">this</span>.items).reduce(<span class=\"function\">(<span class=\"params\">r, c, i</span>) =></span> {</span><br><span class=\"line\">        r.push(<span class=\"keyword\">this</span>.items[c])</span><br><span class=\"line\">        <span class=\"keyword\">return</span> r</span><br><span class=\"line\">    }, [])</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> dictionary = <span class=\"keyword\">new</span> Dictionary()</span><br><span class=\"line\">dictionary.set(<span class=\"string\">'Gandalf'</span>, <span class=\"string\">'gandalf@email.com'</span>)</span><br><span class=\"line\">dictionary.set(<span class=\"string\">'John'</span>, <span class=\"string\">'johnsnow@email.com'</span>) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(dictionary)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(dictionary.keys)</span><br></pre></td></tr></tbody></table></figure><h1 id=\"六、散列表\"><a href=\"#六、散列表\" class=\"headerlink\" title=\"六、散列表\"></a>六、散列表</h1><blockquote><p>又称哈希表，是根据关键字而直接访问内存存储位置的数据结构。</p></blockquote><div style=\"text-indent:2em\">通过计算一个数据关键字的函数，将所需查询的数据内容映射到表中的一个存放位置来访问记录，这加快了查找速度。这个映射函数称做散列函数，存放记录的数组称做散列表。简单来说，通过散列函数将要检索的项与索引（散列值）关联起来，生成一种便于搜索的数据结构（散列表）。</div><ul><li>散列函数<ul><li>原则：函数本身便于计算、计算出来的地址分布均匀</li><li>方法：数字分析法、平方取中法、分段叠加法、除留余数法</li></ul></li><li><p>处理冲突</p><ul><li>原因：键值不同的元素可能会映射到散列表的同一地址，称为 hash 冲突</li><li>方法<ul><li>拉链法/分离链接：将所有散列地址相同的记录都放入一个线性链表</li><li>开放定址法：冲突时寻找散列表中的空地址<ul><li>线性探测：顺序查看表中下一单元</li><li>二次探测：在表的左右进行跳跃式探测</li><li>随机探测：建立一个伪随机数发生器</li></ul></li><li>再散列法：冲突时通过其它散列函数计算地址</li><li>建立公共溢出区：将所有和散列表冲突的元素都放入溢出表</li></ul></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HashTable</span> </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() {</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.table = []</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 散列函数</span></span><br><span class=\"line\">  <span class=\"keyword\">static</span> loseloseHashCode(key) {</span><br><span class=\"line\">    <span class=\"keyword\">let</span> hash = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> codePoint <span class=\"keyword\">of</span> key) {</span><br><span class=\"line\">      hash += codePoint.charCodeAt()</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> hash % <span class=\"number\">37</span></span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 不考虑冲突</span></span><br><span class=\"line\">  put(key, value) {</span><br><span class=\"line\">    <span class=\"keyword\">const</span> position = HashTable.loseloseHashCode(key)</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">`<span class=\"subst\">${position}</span> - <span class=\"subst\">${key}</span>`</span>)</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.table[position] = value</span><br><span class=\"line\">  }</span><br><span class=\"line\">  <span class=\"keyword\">get</span>(key) {</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.table[HashTable.loseloseHashCode(key)]</span><br><span class=\"line\">  }</span><br><span class=\"line\">  remove(key) {</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.table[HashTable.loseloseHashCode(key)] = <span class=\"literal\">undefined</span></span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 分离链接处理冲突：需要一个辅助类 LinkedList 表示要加入的元素</span></span><br><span class=\"line\">  put(key, value) {</span><br><span class=\"line\">    <span class=\"keyword\">const</span> position = HashTable.loseloseHashCode(key)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.table[position] === <span class=\"literal\">undefined</span>) {</span><br><span class=\"line\">       <span class=\"keyword\">this</span>.table[position] = <span class=\"keyword\">new</span> LinkedList()</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.table[position].append({ key, value })</span><br><span class=\"line\">  }</span><br><span class=\"line\">  <span class=\"keyword\">get</span>(key) {</span><br><span class=\"line\">    <span class=\"keyword\">const</span> position = HashTable.loseloseHashCode(key)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.table[position] === <span class=\"literal\">undefined</span>) <span class=\"keyword\">return</span> <span class=\"literal\">undefined</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> getElementValue = <span class=\"function\"><span class=\"params\">node</span> =></span> {</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!node && !node.element) <span class=\"keyword\">return</span> <span class=\"literal\">undefined</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">Object</span>.is(node.element.key, key)) {</span><br><span class=\"line\">          <span class=\"keyword\">return</span> node.element.value</span><br><span class=\"line\">      } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">          <span class=\"keyword\">return</span> getElementValue(node.next)</span><br><span class=\"line\">      }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> getElementValue(<span class=\"keyword\">this</span>.table[position].head)</span><br><span class=\"line\">  }</span><br><span class=\"line\">  remove(key) {</span><br><span class=\"line\">    <span class=\"keyword\">const</span> position = HashTable.loseloseHashCode(key)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.table[position] === <span class=\"literal\">undefined</span>) <span class=\"keyword\">return</span> <span class=\"literal\">undefined</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> getElementValue = <span class=\"function\"><span class=\"params\">node</span> =></span> {</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!node && !node.element) <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">Object</span>.is(node.element.key, key)) {</span><br><span class=\"line\">          <span class=\"keyword\">this</span>.table[position].remove(node.element)</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.table[position].isEmpty) {</span><br><span class=\"line\">              <span class=\"keyword\">this</span>.table[position] = <span class=\"literal\">undefined</span></span><br><span class=\"line\">          }</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">          <span class=\"keyword\">return</span> getElementValue(node.next)</span><br><span class=\"line\">      }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> getElementValue(<span class=\"keyword\">this</span>.table[position].head)</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 线性探查</span></span><br><span class=\"line\">  put(key, value) {</span><br><span class=\"line\">    <span class=\"keyword\">const</span> position = HashTable.loseloseHashCode(key)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.table[position] === <span class=\"literal\">undefined</span>) {</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.table[position] = { key, value }</span><br><span class=\"line\">    } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">        <span class=\"keyword\">let</span> index = ++position</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (<span class=\"keyword\">this</span>.table[index] !== <span class=\"literal\">undefined</span>) {</span><br><span class=\"line\">          index++</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.table[index] = { key, value }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.table[position].append({ key, value })</span><br><span class=\"line\">  }</span><br><span class=\"line\">  <span class=\"keyword\">get</span>(key) {</span><br><span class=\"line\">    <span class=\"keyword\">const</span> position = HashTable.loseloseHashCode(key)</span><br><span class=\"line\">    <span class=\"keyword\">const</span> getElementValue = <span class=\"function\"><span class=\"params\">index</span> =></span> {</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.table[index] === <span class=\"literal\">undefined</span>) <span class=\"keyword\">return</span> <span class=\"literal\">undefined</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">Object</span>.is(<span class=\"keyword\">this</span>.table[index].key, key)) {</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.table[index].value</span><br><span class=\"line\">      } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">          <span class=\"keyword\">return</span> getElementValue(index + <span class=\"number\">1</span>)</span><br><span class=\"line\">      }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> getElementValue(position)</span><br><span class=\"line\">  }</span><br><span class=\"line\">  remove(key) {</span><br><span class=\"line\">    <span class=\"keyword\">const</span> position = HashTable.loseloseHashCode(key)</span><br><span class=\"line\">    <span class=\"keyword\">const</span> removeElementValue = <span class=\"function\"><span class=\"params\">index</span> =></span> {</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.table[index] === <span class=\"literal\">undefined</span>) <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">Object</span>.is(<span class=\"keyword\">this</span>.table[index].key, key)) {</span><br><span class=\"line\">          <span class=\"keyword\">this</span>.table[index] = <span class=\"literal\">undefined</span></span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">          <span class=\"keyword\">return</span> removeElementValue(index + <span class=\"number\">1</span>)</span><br><span class=\"line\">      }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> removeElementValue(position)</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> hash = <span class=\"keyword\">new</span> HashTable()</span><br><span class=\"line\">hash.put(<span class=\"string\">'Surmon'</span>, <span class=\"string\">'surmon.me@email.com'</span>)  <span class=\"comment\">// 19 - Surmon</span></span><br><span class=\"line\">hash.put(<span class=\"string\">'John'</span>, <span class=\"string\">'johnsnow@email.com'</span>)     <span class=\"comment\">// 29 - John</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(hash.get(<span class=\"string\">'Surmon'</span>))  <span class=\"comment\">// surmon.me@email.com</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(hash.get(<span class=\"string\">'Loiane'</span>))  <span class=\"comment\">// undefined</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(hash)</span><br></pre></td></tr></tbody></table></figure></li></ul><h1 id=\"七、树\"><a href=\"#七、树\" class=\"headerlink\" title=\"七、树\"></a>七、树</h1><blockquote><p>一对多的非线性结构、分层数据的抽象模型。树状结构分为树和二叉树，树的操作比较复杂但可以转换为二叉树处理</p></blockquote><h2 id=\"树\"><a href=\"#树\" class=\"headerlink\" title=\"树\"></a>树</h2><ul><li>定义：n 个相同类型的数据元素的有限集合，树的集合为森林</li><li>属性<ul><li>节点：树中的数据元素<ul><li>根节点：没有父节点</li><li>分支节点：有子节点</li><li>叶子节点：没有子节点</li></ul></li><li>子树：节点组成的树</li><li>层级：可以按照节点级别分层</li><li>深度：节点到根节点的节点数量</li><li>高度：所有节点深度中的最大值</li><li>权值：</li></ul></li><li>分类<ul><li>无序树：子节点之间没有顺序关系，又称自由树</li><li>有序树：子节点之间有顺序关系<ul><li>二叉树：每个节点最多含有两个子树<ul><li>完全二叉树：最后一层右边可能满或不满，左边和其余层都是满的。堆就是一个完全二叉树</li><li>满二叉树：所有叶节点都在最底层的完全二叉树</li><li>排序二叉树：有序二叉树、二叉查找树、二叉搜索树</li><li>平衡二叉树：AVL树，任何节点的左右子树的高度差不超过 1</li></ul></li><li>哈夫曼树：最优二叉树，带权路径最短的二叉树<ul><li>路径长度：两个节点之间所经过的分支数目</li><li>树带权路径长度：所有叶子节点的带权路径长度之和</li><li>节点带权路径长度：节点到根节点的分支数目和该节点权值的乘积</li></ul></li><li>B 树：一种对读写操作进行优化的自平衡的二叉查找树，能够保持数据有序，拥有多余两个子树。</li></ul></li></ul></li></ul><h2 id=\"二叉树\"><a href=\"#二叉树\" class=\"headerlink\" title=\"二叉树\"></a>二叉树</h2><h3 id=\"遍历方式\"><a href=\"#遍历方式\" class=\"headerlink\" title=\"遍历方式\"></a>遍历方式</h3><ul><li>中序遍历<ul><li>顺序：左侧子节点、节点本身、右侧子节点</li><li>应用：排序操作</li></ul></li><li>前序遍历<ul><li>顺序：节点本身、左侧子节点、右侧子节点</li><li>应用：打印一个结构化的文档</li></ul></li><li>后序遍历<ul><li>顺序：左侧子节点、节点本身、右侧子节点</li><li>应用：计算目录及其子目录的文件空间</li></ul></li></ul><h3 id=\"存储结构\"><a href=\"#存储结构\" class=\"headerlink\" title=\"存储结构\"></a>存储结构</h3><div align=\"center\"><br><img src=\"images/js/binary-order.png\" alt=\"二叉树顺序存储结构\"><br></div><br><div align=\"center\"><br><img src=\"images/js/binary-link.png\" alt=\"二叉树链式存储结构\"><br></div><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 顺序存储结构</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> tree = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, , <span class=\"number\">6</span>, , , <span class=\"number\">7</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 链式存储结构</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BinaryNode</span> </span>{</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(key, left = null, right = null) {</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.key = key</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.left = left</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.right = right</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h3 id=\"基础定义\"><a href=\"#基础定义\" class=\"headerlink\" title=\"基础定义\"></a>基础定义</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Node</span> </span>{</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(key) {</span><br><span class=\"line\">    <span class=\"comment\">// 数据元素</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.key = key </span><br><span class=\"line\">    <span class=\"comment\">// 指向左右节点的指针</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.left = <span class=\"literal\">null</span>    </span><br><span class=\"line\">    <span class=\"keyword\">this</span>.right = <span class=\"literal\">null</span></span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BinarySearchTree</span> </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() {</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.root = <span class=\"literal\">null</span></span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  insert(key) {</span><br><span class=\"line\">    <span class=\"keyword\">const</span> newNode = <span class=\"keyword\">new</span> Node(key)</span><br><span class=\"line\">    <span class=\"keyword\">const</span> insertNode = <span class=\"function\">(<span class=\"params\">node, newNode</span>) =></span> {</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (newNode.key &lt; node.key) {</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (node.left === <span class=\"literal\">null</span>) {</span><br><span class=\"line\">                node.left = newNode</span><br><span class=\"line\">            } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">                insertNode(node.left, newNode)</span><br><span class=\"line\">            }</span><br><span class=\"line\">        } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (node.right === <span class=\"literal\">null</span>) {</span><br><span class=\"line\">                node.right = newNode</span><br><span class=\"line\">            } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">                insertNode(node.right, newNode)</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.root) {</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.root = newNode</span><br><span class=\"line\">    } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">        insertNode(<span class=\"keyword\">this</span>.root, newNode)</span><br><span class=\"line\">    }</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 中序遍历</span></span><br><span class=\"line\">  inOrderTraverse(callback) {</span><br><span class=\"line\">    <span class=\"keyword\">const</span> inOrderTraverseNode = <span class=\"function\">(<span class=\"params\">node, callback</span>) =></span> {</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (node !== <span class=\"literal\">null</span>) {</span><br><span class=\"line\">            inOrderTraverseNode(node.left, callback)</span><br><span class=\"line\">            callback(node.key)</span><br><span class=\"line\">            inOrderTraverseNode(node.right, callback)</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    inOrderTraverseNode(<span class=\"keyword\">this</span>.root, callback)</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 先序遍历</span></span><br><span class=\"line\">  preOrderTraverse(callback) {</span><br><span class=\"line\">    <span class=\"keyword\">const</span> preOrderTraverseNode = <span class=\"function\">(<span class=\"params\">node, callback</span>) =></span> {</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (node !== <span class=\"literal\">null</span>) {</span><br><span class=\"line\">          callback(node.key)</span><br><span class=\"line\">          preOrderTraverseNode(node.left, callback)</span><br><span class=\"line\">          preOrderTraverseNode(node.right, callback)</span><br><span class=\"line\">      }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    preOrderTraverseNode(<span class=\"keyword\">this</span>.root, callback)</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 后序遍历</span></span><br><span class=\"line\">  postOrderTraverse(callback) {</span><br><span class=\"line\">    <span class=\"keyword\">const</span> postOrderTraverseNode = <span class=\"function\">(<span class=\"params\">node, callback</span>) =></span> {</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (node !== <span class=\"literal\">null</span>) {</span><br><span class=\"line\">          postOrderTraverseNode(node.left, callback)</span><br><span class=\"line\">          postOrderTraverseNode(node.right, callback)</span><br><span class=\"line\">          callback(node.key)</span><br><span class=\"line\">      }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    postOrderTraverseNode(<span class=\"keyword\">this</span>.root, callback)</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  min(node) {</span><br><span class=\"line\">    <span class=\"keyword\">const</span> minNode = <span class=\"function\"><span class=\"params\">node</span> =></span> {</span><br><span class=\"line\">      <span class=\"keyword\">return</span> node ? (node.left ? minNode(node.left) : node) : <span class=\"literal\">null</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> minNode(node || <span class=\"keyword\">this</span>.root)</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  max(node) {</span><br><span class=\"line\">    <span class=\"keyword\">const</span> maxNode = <span class=\"function\"><span class=\"params\">node</span> =></span> {</span><br><span class=\"line\">      <span class=\"keyword\">return</span> node ? (node.right ? maxNode(node.right) : node) : <span class=\"literal\">null</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> maxNode(node || <span class=\"keyword\">this</span>.root)</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  search(key) {</span><br><span class=\"line\">    <span class=\"keyword\">const</span> searchNode = <span class=\"function\">(<span class=\"params\">node, key</span>) =></span> {</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (node === <span class=\"literal\">null</span>) <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (node.key === key) <span class=\"keyword\">return</span> node</span><br><span class=\"line\">      <span class=\"keyword\">return</span> searchNode((key &lt; node.key) ? node.left : node.right, key)</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> searchNode(root, key)</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  remove(key) {</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>._removeNode(<span class=\"keyword\">this</span>.root, key)</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  _removeNode(node, key) {</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (node === <span class=\"literal\">null</span>) <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (key &lt; node.key) {</span><br><span class=\"line\">        node.left = <span class=\"keyword\">this</span>._removeNode(node.left, key)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> node</span><br><span class=\"line\">    } <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (key &gt; node.key) {</span><br><span class=\"line\">        node.right = <span class=\"keyword\">this</span>._removeNode(node.right, key)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> node</span><br><span class=\"line\">    } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (node.left === <span class=\"literal\">null</span> && node.right === <span class=\"literal\">null</span>) {</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span></span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (node.left === <span class=\"literal\">null</span>) {</span><br><span class=\"line\">            <span class=\"keyword\">return</span> node.right</span><br><span class=\"line\">        } <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (node.right === <span class=\"literal\">null</span>) {</span><br><span class=\"line\">            <span class=\"keyword\">return</span> node.left</span><br><span class=\"line\">        } <span class=\"keyword\">else</span> {</span><br><span class=\"line\">            <span class=\"keyword\">const</span> minNode = <span class=\"keyword\">this</span>._findMinNode(node.right)</span><br><span class=\"line\">            node.key = minNode.key</span><br><span class=\"line\">            node.right = <span class=\"keyword\">this</span>._removeNode(node.right, minNode.key)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> node</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> tree = <span class=\"keyword\">new</span> BinarySearchTree()</span><br><span class=\"line\">tree.insert(<span class=\"number\">11</span>)</span><br><span class=\"line\">tree.insert(<span class=\"number\">7</span>)</span><br><span class=\"line\">tree.insert(<span class=\"number\">5</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(tree)</span><br><span class=\"line\">tree.inOrderTraverse(<span class=\"function\"><span class=\"params\">value</span> =></span> { <span class=\"built_in\">console</span>.log(value) })</span><br></pre></td></tr></tbody></table></figure><h1 id=\"八、图\"><a href=\"#八、图\" class=\"headerlink\" title=\"八、图\"></a>八、图</h1><blockquote><p>由一系列顶点和连接顶点的边组成的一种非线性数据结构，可以用来表示任何二元关系</p></blockquote><h2 id=\"图的表示\"><a href=\"#图的表示\" class=\"headerlink\" title=\"图的表示\"></a>图的表示</h2><blockquote><p>没有绝对正确的表示方式，采用哪种方式取决于图的类型和待解决的问题</p></blockquote><h3 id=\"邻接矩阵\"><a href=\"#邻接矩阵\" class=\"headerlink\" title=\"邻接矩阵\"></a>邻接矩阵</h3><ul><li>使用一个二维数组来表示图中顶点之间的连接</li><li>如果索引为 i、j 的两个节点连接，则 arr[i][j] === 1，否则为 0</li><li><p>缺点：只有一个相邻顶点的顶点也需要一整行来表示连接，浪费内存</p><div align=\"center\"><br><img src=\"images/js/near-matrix.png\" alt=\"邻接矩阵\"><br></div></li></ul><h3 id=\"邻接表\"><a href=\"#邻接表\" class=\"headerlink\" title=\"邻接表\"></a>邻接表</h3><ul><li>由图中每个顶点的相邻顶点列表所组成</li><li><p>只要能表示一对多的数据结构都可以用来描述邻接表，比如多维数组、链表、散列表、字典等</p><div align=\"center\"><br><img src=\"images/js/near-table.png\" alt=\"邻接表\"><br></div></li></ul><h3 id=\"关联矩阵\"><a href=\"#关联矩阵\" class=\"headerlink\" title=\"关联矩阵\"></a>关联矩阵</h3><ul><li>矩阵的行列分别表示顶点和边，使用二维数组表示两者之间的连通性</li><li>如果顶点A 是边 E 的入射点，则 array[A][E] === 1，否则为 0</li><li><p>通常用于边的数量比顶点少的情况，以节省空间和内存。</p><div align=\"center\"><br><img src=\"images/js/near-table.png\" alt=\"关联矩阵\"><br></div></li></ul><h2 id=\"图的遍历\"><a href=\"#图的遍历\" class=\"headerlink\" title=\"图的遍历\"></a>图的遍历</h2><blockquote><p>可以用来寻找特定的顶点或寻找两个顶点之间的路径，检查图是否连通，检查图是否含有环等。思路是追踪每个第一次访问的节点，并且追踪有哪些节点还没有被完全探索。</p></blockquote><ul><li>广度优先搜索：一层一层的遍历顶点</li><li>深度优先搜索：选择一个路径一直深入遍历直到尽头，再递归回去选择未访问的顶点</li></ul><h2 id=\"创建图类\"><a href=\"#创建图类\" class=\"headerlink\" title=\"创建图类\"></a>创建图类</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Graph</span> </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() {</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.vertices = []</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.adjList = <span class=\"keyword\">new</span> Dictionary()</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 添加顶点</span></span><br><span class=\"line\">  addVertex(v) {</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.vertices.push(v)</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.adjList.set(v, [])</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 添加线</span></span><br><span class=\"line\">  addEdge(v, w) {</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.adjList.get(v).push(w)</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.adjList.get(w).push(v)</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  toString() {</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.vertices.reduce(<span class=\"function\">(<span class=\"params\">r, v, i</span>) =></span> {</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.adjList.get(v).reduce(<span class=\"function\">(<span class=\"params\">r, w, i</span>) =></span> {</span><br><span class=\"line\">            <span class=\"keyword\">return</span> r + <span class=\"string\">`<span class=\"subst\">${w}</span> `</span></span><br><span class=\"line\">        }, <span class=\"string\">`<span class=\"subst\">${r}</span>\\n<span class=\"subst\">${v}</span> => `</span>)</span><br><span class=\"line\">    }, <span class=\"string\">''</span>)</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 构建顶点之间的路径</span></span><br><span class=\"line\">  distance(fromVertex) {</span><br><span class=\"line\">    <span class=\"keyword\">const</span> vertices = <span class=\"keyword\">this</span>.vertices</span><br><span class=\"line\">    <span class=\"keyword\">const</span> { distances, predecessors } = <span class=\"keyword\">this</span>.bfs(fromVertex)</span><br><span class=\"line\">    vertices.forEach(<span class=\"function\"><span class=\"params\">toVertex</span> =></span> {</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!!distances[toVertex]) {</span><br><span class=\"line\">            <span class=\"keyword\">let</span> preVertex = predecessors[toVertex]</span><br><span class=\"line\">            <span class=\"keyword\">let</span> slug = <span class=\"string\">''</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span> (fromVertex !== preVertex) {</span><br><span class=\"line\">                slug = <span class=\"string\">`<span class=\"subst\">${preVertex}</span> - <span class=\"subst\">${slug}</span>`</span></span><br><span class=\"line\">                preVertex = predecessors[preVertex]</span><br><span class=\"line\">            }</span><br><span class=\"line\">            slug = <span class=\"string\">`<span class=\"subst\">${fromVertex}</span> - <span class=\"subst\">${slug}</span><span class=\"subst\">${toVertex}</span>`</span></span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(slug)</span><br><span class=\"line\">        }</span><br><span class=\"line\">    })</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 广度优先搜索算法</span></span><br><span class=\"line\">  bfs(v, callback) {</span><br><span class=\"line\">      <span class=\"keyword\">const</span> read = []</span><br><span class=\"line\">      <span class=\"keyword\">const</span> distances = []</span><br><span class=\"line\">      <span class=\"keyword\">const</span> predecessors = []</span><br><span class=\"line\">      <span class=\"keyword\">const</span> adjList = <span class=\"keyword\">this</span>.adjList</span><br><span class=\"line\">      <span class=\"keyword\">const</span> pending = [v || <span class=\"keyword\">this</span>.vertices[<span class=\"number\">0</span>]]</span><br><span class=\"line\">      <span class=\"keyword\">const</span> readVertices = <span class=\"function\"><span class=\"params\">vertices</span> =></span> {</span><br><span class=\"line\">        vertices.forEach(<span class=\"function\"><span class=\"params\">key</span> =></span> {</span><br><span class=\"line\">            read.push(key)</span><br><span class=\"line\">            pending.shift()</span><br><span class=\"line\">            distances[key] = distances[key] || <span class=\"number\">0</span></span><br><span class=\"line\">            predecessors[key] = predecessors[key] || <span class=\"literal\">null</span></span><br><span class=\"line\">            adjList.get(key).forEach(<span class=\"function\"><span class=\"params\">v</span> =></span> {</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!pending.includes(v) && !read.includes(v)) {</span><br><span class=\"line\">                    pending.push(v)</span><br><span class=\"line\">                    distances[v] = distances[key] + <span class=\"number\">1</span></span><br><span class=\"line\">                    predecessors[v] = key</span><br><span class=\"line\">                }</span><br><span class=\"line\">            })</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (callback) callback(key)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (pending.length) readVertices(pending)</span><br><span class=\"line\">        })</span><br><span class=\"line\">      }</span><br><span class=\"line\">      readVertices(pending)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> { distances, predecessors }</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 深度优先搜索算法</span></span><br><span class=\"line\">  dfs(callback) {</span><br><span class=\"line\">      <span class=\"keyword\">let</span> readTimer = <span class=\"number\">0</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> read = []</span><br><span class=\"line\">      <span class=\"keyword\">const</span> readTimes = []</span><br><span class=\"line\">      <span class=\"keyword\">const</span> finishedTimes = []</span><br><span class=\"line\">      <span class=\"keyword\">const</span> predecessors = []</span><br><span class=\"line\">      <span class=\"keyword\">const</span> adjList = <span class=\"keyword\">this</span>.adjList</span><br><span class=\"line\">      <span class=\"keyword\">const</span> readVertices = <span class=\"function\">(<span class=\"params\">vertices, predecessor</span>) =></span> {</span><br><span class=\"line\">        vertices.forEach(<span class=\"function\"><span class=\"params\">key</span> =></span> {</span><br><span class=\"line\">            readTimer++</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (adjList.get(key).every(<span class=\"function\"><span class=\"params\">v</span> =></span> read.includes(v)) && !finishedTimes[key]) {</span><br><span class=\"line\">                finishedTimes[key] = readTimer</span><br><span class=\"line\">            }</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (read.includes(key)) <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">            readTimes[key] = readTimer</span><br><span class=\"line\">            read.push(key)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (callback) callback(key)</span><br><span class=\"line\">            predecessors[key] = predecessors[key] || predecessor || <span class=\"literal\">null</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (read.length !== <span class=\"keyword\">this</span>.vertices.length) {</span><br><span class=\"line\">                readVertices(adjList.get(key), key)</span><br><span class=\"line\">            }</span><br><span class=\"line\">        })</span><br><span class=\"line\">      }</span><br><span class=\"line\">      readVertices(adjList.keys)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> { readTimes, finishedTimes, predecessors }</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> graph = <span class=\"keyword\">new</span> Graph()</span><br><span class=\"line\"><span class=\"keyword\">const</span> vertices = [<span class=\"string\">'A'</span>,<span class=\"string\">'B'</span>,<span class=\"string\">'C'</span>,<span class=\"string\">'D'</span>];</span><br><span class=\"line\">vertices.forEach(<span class=\"function\"><span class=\"params\">v</span> =></span> graph.addVertex(v))</span><br><span class=\"line\"></span><br><span class=\"line\">graph.addEdge(<span class=\"string\">'A'</span>, <span class=\"string\">'B'</span>)</span><br><span class=\"line\">graph.addEdge(<span class=\"string\">'A'</span>, <span class=\"string\">'C'</span>)</span><br><span class=\"line\">graph.addEdge(<span class=\"string\">'A'</span>, <span class=\"string\">'D'</span>)</span><br><span class=\"line\">graph.addEdge(<span class=\"string\">'C'</span>, <span class=\"string\">'D'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(graph.toString())  </span><br><span class=\"line\">graph.bfs(graph.vertices[<span class=\"number\">0</span>], value => <span class=\"built_in\">console</span>.log(<span class=\"string\">'Visited: '</span> + value))</span><br></pre></td></tr></tbody></table></figure><!-- rebuild by neat --></body></html>","site":{"data":{"next":{"override":false,"cache":{"enable":true},"favicon":{"small":"/images/favicon-16.ico","medium":"/images/favicon-32.ico","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"rss":"/atom.xml","footer":{"since":2019,"icon":{"name":"snowflake-o","animated":false,"color":"#808080"},"copyright":"chuangge","powered":{"enable":false,"version":true},"theme":{"enable":false,"version":true},"beian":{"enable":false,"icp":null}},"creative_commons":{"license":"by-nc-sa","sidebar":false,"post":false},"canonical":true,"seo":false,"index_with_subtitle":false,"exturl":false,"menu":{"home":"/ || home  //首页","tags":"/tags/ || tags  //标签","categories":"/categories/ || th   //分类","archives":"/archives/ || archive //归档"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":{"GitHub":"https://github.com/ || github","StackOverflow":"https://stackoverflow.com/ || stack-overflow"},"social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"友情链接","links_layout":"inline","links":{"个人简历":"https://chuanggefighting.github.io/project/","印记中文":"https://www.docschina.org/","在线工具":"http://tool.lu/","Learn Anything":"https://learn-anything.xyz/"},"avatar":{"url":"/images/chuang.png","rounded":true,"opacity":1,"rotated":true},"toc":{"enable":true,"number":true,"wrap":false,"max_depth":6},"sidebar":{"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"read_more_btn":true,"post_meta":{"item_text":true,"created_at":true,"updated_at":{"enabled":true,"another_day":true},"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":true,"awl":4,"wpm":275},"codeblock":{"border_radius":null,"copy_button":{"enable":false,"show_result":false}},"reward":{"enable":false},"related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_edit":{"enable":false,"url":"https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name"},"disable_baidu_tranformation":false,"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"font":{"enable":true,"host":"//fonts.proxy.ustclug.org","global":{"external":true,"family":"Lato","size":16},"headings":{"external":true,"family":"Roboto Slab","size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":"Lobster Two","size":24},"codes":{"external":true,"family":"Roboto Mono","size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css","copy_tex":{"enable":false,"copy_tex_js":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js","copy_tex_css":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css"}}},"pdf":{"enable":false,"per_page":true,"height":"500px","pdfobject":{"cdn":"//cdn.jsdelivr.net/npm/pdfobject@2.1.1/pdfobject.min.js"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":true,"appid":"snOvapuSplYTVflf5p9Ml9JX-gzGzoHsz","appkey":"5ABGdfyEdAtu6lTXdGdo7hf9","notify":false,"verify":false,"placeholder":"ヾﾉ≧∀≦)o 来呀！吐槽一番吧！","avatar":"mm","guest_info":"nick,mail,link","pageSize":10,"visitor":false,"comment_count":true},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"gitalk":{"enable":false,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true},"needmoreshare2":{"enable":true,"postbottom":{"enable":true,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null,"security":false,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":true,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":true,"pace_theme":"pace-theme-center-simple","canvas_nest":{"enable":true,"onmobile":true,"color":"0,0,255","opacity":0.5,"zIndex":-1,"count":99},"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"canvas_nest_nomobile":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"leancloud":null,"valine":null,"gitalk_js":null,"gitalk_css":null,"md5":null},"css":"css","js":"js","images":"images","passage_end_tag":{"enabled":true},"daovoice":true,"daovoice_app_id":"2ed51855"}}},"excerpt":"","more":"<!-- build time:Sat May 11 2019 01:36:58 GMT+0800 (中国标准时间) --><h1 id=\"数据结构\"><a href=\"#数据结构\" class=\"headerlink\" title=\"数据结构\"></a>数据结构</h1><blockquote><p>计算机存储、组织数据的方式</p></blockquote><h2 id=\"逻辑结构\"><a href=\"#逻辑结构\" class=\"headerlink\" title=\"逻辑结构\"></a>逻辑结构</h2><blockquote><p>数据组织方式</p></blockquote><ul><li><strong>集合结构</strong><ul><li>操作：并集、交集、补集</li><li>特点<ul><li>集合由一组无序且唯一的项组成</li><li>单个数据元素之间没有任何关系</li></ul></li></ul></li><li><strong>线性结构</strong><ul><li>类型：线性表，包括 堆、栈、队列、一维数组</li><li>特点<ul><li>数据元素是有序的</li><li>数据元素之间存在 一对一 的层次关系</li></ul></li></ul></li><li><strong>树形结构</strong><ul><li>类型：树</li><li>数据元素之间存在 一对多 的层次关系</li></ul></li><li><strong>图形结构</strong><ul><li>类型：图</li><li>数据元素之间是 多对多 的层次关系</li></ul></li></ul><h2 id=\"物理结构\"><a href=\"#物理结构\" class=\"headerlink\" title=\"物理结构\"></a>物理结构</h2><blockquote><p>数据存储方式</p></blockquote><ul><li><strong>顺序存储</strong><ul><li>内存：元素连续放置，基于位置关系访问</li><li>优点：随机访问</li><li>缺点：插入删除效率低，大小固定</li></ul></li><li><strong>链式存储</strong><ul><li>内存：元素并不连续放置，基于引用指针关系访问</li><li>优点：大小动态扩展，插入删除效率高</li><li>缺点：访问链表元素需要循环查找，不能随机访问</li></ul></li><li><strong>索引存储</strong><ul><li>内存：整体无序但索引块之间有序</li><li>优点：对顺序查找的一种改进，查找效率高</li><li>缺点：需要额外空间存储索引表</li></ul></li><li><strong>散列存储</strong><ul><li>内存：数据元素根据函数计算存储位置</li><li>优点：基于数据本身查找，查找和存取效率高</li><li>缺点：存取随机而不利于顺序查找，存储位置可能相同而冲突</li></ul></li></ul><h1 id=\"一、栈\"><a href=\"#一、栈\" class=\"headerlink\" title=\"一、栈\"></a>一、栈</h1><ul><li>一种遵循先进后出原则的特殊线性表</li><li>它基于数组或链表实现，只能在栈顶增删元素</li><li><p>新元素靠近栈顶，旧元素靠近栈底，类似叠起来的书</p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 定义栈类</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Stack</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 底层数据结构是数组</span></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.items = []</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 入栈</span></span><br><span class=\"line\">  push(element) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.items.push(element)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 出栈</span></span><br><span class=\"line\">  pop() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.items.pop()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 末位</span></span><br><span class=\"line\">  <span class=\"keyword\">get</span> peek() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.items[<span class=\"keyword\">this</span>.items.length - <span class=\"number\">1</span>]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 是否为空栈</span></span><br><span class=\"line\">  <span class=\"keyword\">get</span> isEmpty() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> !<span class=\"keyword\">this</span>.items.length</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 尺寸</span></span><br><span class=\"line\">  <span class=\"keyword\">get</span> size() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.items.length</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// 清空栈</span></span><br><span class=\"line\">  clear() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.items = []</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用栈类</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> stack = <span class=\"keyword\">new</span> Stack()</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(stack.isEmpty)  <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br><span class=\"line\">stack.push(<span class=\"number\">5</span>)</span><br><span class=\"line\">stack.push(<span class=\"number\">8</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(stack.peek)     <span class=\"comment\">// 8</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(stack.size)     <span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure></li></ul><h1 id=\"二、队列\"><a href=\"#二、队列\" class=\"headerlink\" title=\"二、队列\"></a>二、队列</h1><ul><li>一种遵循先进先出原则的特殊线性表</li><li><p>只能队尾添加、队首删除元素，类似排队人群</p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Queue</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(items) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.items = items || []</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 循环队列</span></span><br><span class=\"line\">  enqueue(element)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.items.push(element)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 优先队列：根据优先级增删</span></span><br><span class=\"line\">  enqueue(element, priority)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> queueElement = &#123; element, priority &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.isEmpty) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.items.push(queueElement)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> preIndex = <span class=\"keyword\">this</span>.items.findIndex(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> queueElement.priority &amp;lt; item.priority)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (preIndex &amp;gt; <span class=\"number\">-1</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.items.splice(preIndex, <span class=\"number\">0</span>, queueElement)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.items.push(queueElement)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  dequeue()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.items.shift()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  front()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.items[<span class=\"number\">0</span>]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  clear()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.items = []</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">get</span> size()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.items.length</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">get</span> isEmpty()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> !<span class=\"keyword\">this</span>.items.length</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  print() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.items)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 实例化</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> queue = <span class=\"keyword\">new</span> Queue()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 普通队列</span></span><br><span class=\"line\">queue.enqueue(<span class=\"string\">'John'</span>)</span><br><span class=\"line\">queue.enqueue(<span class=\"string\">'Jack'</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(queue.size)     <span class=\"comment\">// 2</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(queue.isEmpty)  <span class=\"comment\">// false</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 优先队列</span></span><br><span class=\"line\">queue.enqueue(<span class=\"string\">'Surmon'</span>, <span class=\"number\">3</span>)</span><br><span class=\"line\">queue.enqueue(<span class=\"string\">'John'</span>, <span class=\"number\">2</span>)</span><br><span class=\"line\">queue.enqueue(<span class=\"string\">'Jack'</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">queue.print()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 循环队列</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LoopQueue</span> <span class=\"keyword\">extends</span> <span class=\"title\">Queue</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(items) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">super</span>(items)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  getIndex(index) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> length = <span class=\"keyword\">this</span>.items.length</span><br><span class=\"line\">      <span class=\"keyword\">return</span> index &amp;gt; length ? (index % length) : index</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  find(index) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> !<span class=\"keyword\">this</span>.isEmpty ? <span class=\"keyword\">this</span>.items[<span class=\"keyword\">this</span>.getIndex(index)] : <span class=\"literal\">null</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> loopQueue = <span class=\"keyword\">new</span> LoopQueue([<span class=\"string\">'Surmon'</span>])</span><br><span class=\"line\">loopQueue.enqueue(<span class=\"string\">'SkyRover'</span>)</span><br><span class=\"line\">loopQueue.enqueue(<span class=\"string\">'Even'</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(loopQueue.size)      <span class=\"comment\">// 3</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(loopQueue.find(<span class=\"number\">26</span>))  <span class=\"comment\">// 'Evan'</span></span><br></pre></td></tr></table></figure></li></ul><h1 id=\"三、链表\"><a href=\"#三、链表\" class=\"headerlink\" title=\"三、链表\"></a>三、链表</h1><blockquote><p>链接方式存储数据的线性表。链表的每个数据单元就是一个节点，包含节点信息、指向后一个节点的引用地址 (称为”链”)</p></blockquote><div style=\"text-indent:2em\">数组是存储多个元素时最常用的数据结构，但是在很多编程语言中，数组的长度固定，当数组填满后再添加元素比较困难，删除和添加元素时需要将数组中的所有元素变换位置，操作成本较高。JS 数组并不存在上述问题，主要是因为它们被作为对象实现，不过效率较低。线性表的顺序存储结构由于存储元素不连续都会有以上问题，链表就是针对它的优化结果。</div><h2 id=\"链表类型\"><a href=\"#链表类型\" class=\"headerlink\" title=\"链表类型\"></a>链表类型</h2><ul><li>单链表：单一的向下传递，每个节点只记录下一个节点的信息</li><li>静态链表：基于数组实现的链表，每个节点包含了数据和指向地址</li><li>循环链表：由于单链表到达尾部时回溯到头部很麻烦，所以首尾相连形成循环</li><li>双向链表：基于单链表增加前指针，每个节点都保存两个分别指向前后节点的地址</li></ul><h2 id=\"单链表\"><a href=\"#单链表\" class=\"headerlink\" title=\"单链表\"></a>单链表</h2><h3 id=\"结构\"><a href=\"#结构\" class=\"headerlink\" title=\"结构\"></a>结构</h3><div align=\"center\"><br><img src=\"images/js/link-list.png\" alt=\"单链表结构\"><br></div><ul><li>data中保存着数据，next保存着下一个链表的引用</li><li>我们将链表的尾元素指向了 null 节点，表示链接结束的位置</li><li>可以说 data2 跟在 data1 后面，但不能说 data2 是链表中的第二个元素</li></ul><h3 id=\"节点操作\"><a href=\"#节点操作\" class=\"headerlink\" title=\"节点操作\"></a>节点操作</h3><div align=\"center\"><br><img src=\"images/js/link-opration.png\" alt=\"单链表节点操作\"><br></div><ul><li>插入：修改前驱节点而使其指向新节点，并将新节点指向原前驱节点指向的节点</li><li><p>删除：将待删节点的前驱节点指向待删节点的，同时将待删节点指向 null</p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 链表节点</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Node</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(element) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.element = element  <span class=\"comment\">// 数据</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.next = <span class=\"literal\">null</span>        <span class=\"comment\">// 指针 </span></span><br><span class=\"line\">  &#125; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 链表</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LinkedList</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.head = <span class=\"literal\">null</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.length = <span class=\"number\">0</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 追加元素</span></span><br><span class=\"line\">  append(element) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> node = <span class=\"keyword\">new</span> Node(element)</span><br><span class=\"line\">    <span class=\"keyword\">let</span> current = <span class=\"literal\">null</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.head === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.head = node</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        current = <span class=\"keyword\">this</span>.head</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(current.next) &#123;</span><br><span class=\"line\">            current = current.next</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        current.next = node</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.length++</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 任意位置插入元素</span></span><br><span class=\"line\">  insert(position, element) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (position &amp;gt;= <span class=\"number\">0</span> &amp;&amp; position &amp;lt;= <span class=\"keyword\">this</span>.length) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> node = <span class=\"keyword\">new</span> Node(element)</span><br><span class=\"line\">      <span class=\"keyword\">let</span> current = <span class=\"keyword\">this</span>.head</span><br><span class=\"line\">      <span class=\"keyword\">let</span> previous = <span class=\"literal\">null</span></span><br><span class=\"line\">      <span class=\"keyword\">let</span> index = <span class=\"number\">0</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (position === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">this</span>.head = node</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">while</span> (index++ &amp;lt; position) &#123;</span><br><span class=\"line\">            previous = current</span><br><span class=\"line\">            current = current.next</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          node.next = current</span><br><span class=\"line\">          previous.next = node</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.length++</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 移除指定位置元素</span></span><br><span class=\"line\">  removeAt(position) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 检查越界值</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (position &amp;gt; <span class=\"number\">-1</span> &amp;&amp; position &amp;lt; length) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> current = <span class=\"keyword\">this</span>.head</span><br><span class=\"line\">        <span class=\"keyword\">let</span> previous = <span class=\"literal\">null</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> index = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (position === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.head = current.next</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (index++ &amp;lt; position) &#123;</span><br><span class=\"line\">                previous = current</span><br><span class=\"line\">                current = current.next</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            previous.next = current.next</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.length--</span><br><span class=\"line\">        <span class=\"keyword\">return</span> current.element</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 寻找元素下标</span></span><br><span class=\"line\">  findIndex(element) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> current = <span class=\"keyword\">this</span>.head</span><br><span class=\"line\">    <span class=\"keyword\">let</span> index = <span class=\"number\">-1</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (current) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (element === current.element) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> index + <span class=\"number\">1</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      index++</span><br><span class=\"line\">      current = current.next</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 删除指定文档</span></span><br><span class=\"line\">  remove(element) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> index = <span class=\"keyword\">this</span>.indexOf(element)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.removeAt(index)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  isEmpty() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> !<span class=\"keyword\">this</span>.length</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  size() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.length</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 转为字符串</span></span><br><span class=\"line\">  toString() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> current = <span class=\"keyword\">this</span>.head</span><br><span class=\"line\">    <span class=\"keyword\">let</span> string = <span class=\"string\">''</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (current) &#123;</span><br><span class=\"line\">      string += <span class=\"string\">` <span class=\"subst\">$&#123;current.element&#125;</span>`</span></span><br><span class=\"line\">      current = current.next</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> string</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> linkedList = <span class=\"keyword\">new</span> LinkedList()</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(linkedList)</span><br><span class=\"line\"></span><br><span class=\"line\">linkedList.append(<span class=\"number\">2</span>)</span><br><span class=\"line\">linkedList.append(<span class=\"number\">6</span>)</span><br><span class=\"line\">linkedList.insert(<span class=\"number\">3</span>, <span class=\"number\">18</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(linkedList)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(linkedList.findIndex(<span class=\"number\">24</span>))</span><br></pre></td></tr></table></figure></li></ul><h2 id=\"双向链表\"><a href=\"#双向链表\" class=\"headerlink\" title=\"双向链表\"></a>双向链表</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 链表节点</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Node</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(element) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.element = element</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.prev = <span class=\"literal\">null</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.next = <span class=\"literal\">null</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 双向链表</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DoublyLinkedList</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.head = <span class=\"literal\">null</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.tail = <span class=\"literal\">null</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.length = <span class=\"number\">0</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 任意位置插入元素</span></span><br><span class=\"line\">  insert(position, element) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (position &amp;gt;= <span class=\"number\">0</span> &amp;&amp; position &amp;lt;= <span class=\"keyword\">this</span>.length)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> node = <span class=\"keyword\">new</span> Node(element)</span><br><span class=\"line\">        <span class=\"keyword\">let</span> current = <span class=\"keyword\">this</span>.head</span><br><span class=\"line\">        <span class=\"keyword\">let</span> previous = <span class=\"literal\">null</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> index = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"comment\">// 首位</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (position === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!head)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.head = node</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.tail = node</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                node.next = current</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.head = node</span><br><span class=\"line\">                current.prev = node</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 末位</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (position === <span class=\"keyword\">this</span>.length) &#123;</span><br><span class=\"line\">            current = <span class=\"keyword\">this</span>.tail</span><br><span class=\"line\">            current.next = node</span><br><span class=\"line\">            node.prev = current</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.tail = node</span><br><span class=\"line\">        <span class=\"comment\">// 中位</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (index++ &amp;lt; position) &#123;</span><br><span class=\"line\">              previous = current</span><br><span class=\"line\">              current = current.next</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            node.next = current</span><br><span class=\"line\">            previous.next = node</span><br><span class=\"line\">            current.prev = node</span><br><span class=\"line\">            node.prev = previous</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.length++</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 移除指定位置元素</span></span><br><span class=\"line\">  removeAt(position) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (position &amp;gt; <span class=\"number\">-1</span> &amp;&amp; position &amp;lt; <span class=\"keyword\">this</span>.length) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> current = <span class=\"keyword\">this</span>.head</span><br><span class=\"line\">        <span class=\"keyword\">let</span> previous = <span class=\"literal\">null</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> index = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 首位</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (position === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.head = <span class=\"keyword\">this</span>.head.next</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.head.prev = <span class=\"literal\">null</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.length === <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.tail = <span class=\"literal\">null</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 末位</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (position === <span class=\"keyword\">this</span>.length - <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.tail = <span class=\"keyword\">this</span>.tail.prev</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.tail.next = <span class=\"literal\">null</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 中位</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (index++ &amp;lt; position) &#123;</span><br><span class=\"line\">              previous = current</span><br><span class=\"line\">              current = current.next</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            previous.next = current.next</span><br><span class=\"line\">            current.next.prev = previous</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.length--</span><br><span class=\"line\">    <span class=\"keyword\">return</span> current.element</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">null</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h1 id=\"四、集合\"><a href=\"#四、集合\" class=\"headerlink\" title=\"四、集合\"></a>四、集合</h1><blockquote><p>由一组无序且唯一的项组成，操作方法可分为 并集、交集、差集。集合、字典、散列表都可以存储不重复的数据</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 定义</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Set</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.items = &#123;&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  has(value) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.items.hasOwnProperty(value)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  add(value) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.has(value)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.items[value] = value</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;     </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  remove(value) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.has(value)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">delete</span> <span class=\"keyword\">this</span>.items[value]</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">get</span> size() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.keys(<span class=\"keyword\">this</span>.items).length</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">get</span> values() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.keys(<span class=\"keyword\">this</span>.items)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 并集</span></span><br><span class=\"line\">  union(otherSet) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> unionSet = <span class=\"keyword\">new</span> <span class=\"built_in\">Set</span>()</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.values.forEach(<span class=\"function\">(<span class=\"params\">v, i</span>) =&gt;</span> unionSet.add(<span class=\"keyword\">this</span>.values[i]))</span><br><span class=\"line\">    otherSet.values.forEach(<span class=\"function\">(<span class=\"params\">v, i</span>) =&gt;</span> unionSet.add(otherSet.values[i]))</span><br><span class=\"line\">    <span class=\"keyword\">return</span> unionSet</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 交集</span></span><br><span class=\"line\">  intersection(otherSet) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> intersectionSet = <span class=\"keyword\">new</span> <span class=\"built_in\">Set</span>()</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.values.forEach(<span class=\"function\">(<span class=\"params\">v, i</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (otherSet.has(v)) &#123;</span><br><span class=\"line\">            intersectionSet.add(v)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> intersectionSet</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// 差集</span></span><br><span class=\"line\">  difference(otherSet) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> differenceSet = <span class=\"keyword\">new</span> <span class=\"built_in\">Set</span>()</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.values.forEach(<span class=\"function\">(<span class=\"params\">v, i</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!otherSet.has(v)) &#123;</span><br><span class=\"line\">            differenceSet.add(v)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> differenceSet</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 子集</span></span><br><span class=\"line\">  subset(otherSet) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.size &amp;gt; otherSet.size) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> !<span class=\"keyword\">this</span>.values.some(<span class=\"function\"><span class=\"params\">v</span> =&gt;</span> !otherSet.has(v))</span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> set1 = <span class=\"keyword\">new</span> <span class=\"built_in\">Set</span>();</span><br><span class=\"line\">set1.add(<span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> set2 = <span class=\"keyword\">new</span> <span class=\"built_in\">Set</span>();</span><br><span class=\"line\">set2.add(<span class=\"number\">1</span>);</span><br><span class=\"line\">set2.add(<span class=\"number\">2</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 数据</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(set1.values)   </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(set1.has(<span class=\"number\">1</span>))  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 并集</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> set11 = set1.union(set2);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(set11.values);  <span class=\"comment\">// [1,2]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 交集</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> set12  = set1.intersection(set2);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(set12.values);  <span class=\"comment\">// [1]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 差集</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> set13 = set2.difference(set1);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(set13.values); <span class=\"comment\">// [2]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 判断子集</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(set1.subset(set2)); <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure><h1 id=\"五、字典\"><a href=\"#五、字典\" class=\"headerlink\" title=\"五、字典\"></a>五、字典</h1><blockquote><p>即映射，以键值对 { key: value } 的形式存储不重复的数据，Object 对象是字典在 Js 中的实现</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Dictionary</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.items = &#123;&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">set</span>(key, value) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.items[key] = value</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">get</span>(key) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.items[key]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  remove(key) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"keyword\">this</span>.items[key]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">get</span> keys() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.keys(<span class=\"keyword\">this</span>.items)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">get</span> values() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 使用 ES7 values</span></span><br><span class=\"line\">    <span class=\"comment\">// return Object.values(this.items)</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 通过循环生成一个数组并输出</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.keys(<span class=\"keyword\">this</span>.items).reduce(<span class=\"function\">(<span class=\"params\">r, c, i</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        r.push(<span class=\"keyword\">this</span>.items[c])</span><br><span class=\"line\">        <span class=\"keyword\">return</span> r</span><br><span class=\"line\">    &#125;, [])</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> dictionary = <span class=\"keyword\">new</span> Dictionary()</span><br><span class=\"line\">dictionary.set(<span class=\"string\">'Gandalf'</span>, <span class=\"string\">'gandalf@email.com'</span>)</span><br><span class=\"line\">dictionary.set(<span class=\"string\">'John'</span>, <span class=\"string\">'johnsnow@email.com'</span>) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(dictionary)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(dictionary.keys)</span><br></pre></td></tr></table></figure><h1 id=\"六、散列表\"><a href=\"#六、散列表\" class=\"headerlink\" title=\"六、散列表\"></a>六、散列表</h1><blockquote><p>又称哈希表，是根据关键字而直接访问内存存储位置的数据结构。</p></blockquote><div style=\"text-indent:2em\">通过计算一个数据关键字的函数，将所需查询的数据内容映射到表中的一个存放位置来访问记录，这加快了查找速度。这个映射函数称做散列函数，存放记录的数组称做散列表。简单来说，通过散列函数将要检索的项与索引（散列值）关联起来，生成一种便于搜索的数据结构（散列表）。</div><ul><li>散列函数<ul><li>原则：函数本身便于计算、计算出来的地址分布均匀</li><li>方法：数字分析法、平方取中法、分段叠加法、除留余数法</li></ul></li><li><p>处理冲突</p><ul><li>原因：键值不同的元素可能会映射到散列表的同一地址，称为 hash 冲突</li><li>方法<ul><li>拉链法/分离链接：将所有散列地址相同的记录都放入一个线性链表</li><li>开放定址法：冲突时寻找散列表中的空地址<ul><li>线性探测：顺序查看表中下一单元</li><li>二次探测：在表的左右进行跳跃式探测</li><li>随机探测：建立一个伪随机数发生器</li></ul></li><li>再散列法：冲突时通过其它散列函数计算地址</li><li>建立公共溢出区：将所有和散列表冲突的元素都放入溢出表</li></ul></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HashTable</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.table = []</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 散列函数</span></span><br><span class=\"line\">  <span class=\"keyword\">static</span> loseloseHashCode(key) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> hash = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> codePoint <span class=\"keyword\">of</span> key) &#123;</span><br><span class=\"line\">      hash += codePoint.charCodeAt()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> hash % <span class=\"number\">37</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 不考虑冲突</span></span><br><span class=\"line\">  put(key, value) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> position = HashTable.loseloseHashCode(key)</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">`<span class=\"subst\">$&#123;position&#125;</span> - <span class=\"subst\">$&#123;key&#125;</span>`</span>)</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.table[position] = value</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">get</span>(key) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.table[HashTable.loseloseHashCode(key)]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  remove(key) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.table[HashTable.loseloseHashCode(key)] = <span class=\"literal\">undefined</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 分离链接处理冲突：需要一个辅助类 LinkedList 表示要加入的元素</span></span><br><span class=\"line\">  put(key, value) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> position = HashTable.loseloseHashCode(key)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.table[position] === <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">       <span class=\"keyword\">this</span>.table[position] = <span class=\"keyword\">new</span> LinkedList()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.table[position].append(&#123; key, value &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">get</span>(key) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> position = HashTable.loseloseHashCode(key)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.table[position] === <span class=\"literal\">undefined</span>) <span class=\"keyword\">return</span> <span class=\"literal\">undefined</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> getElementValue = <span class=\"function\"><span class=\"params\">node</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!node &amp;&amp; !node.element) <span class=\"keyword\">return</span> <span class=\"literal\">undefined</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">Object</span>.is(node.element.key, key)) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> node.element.value</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> getElementValue(node.next)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> getElementValue(<span class=\"keyword\">this</span>.table[position].head)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  remove(key) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> position = HashTable.loseloseHashCode(key)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.table[position] === <span class=\"literal\">undefined</span>) <span class=\"keyword\">return</span> <span class=\"literal\">undefined</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> getElementValue = <span class=\"function\"><span class=\"params\">node</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!node &amp;&amp; !node.element) <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">Object</span>.is(node.element.key, key)) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">this</span>.table[position].remove(node.element)</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.table[position].isEmpty) &#123;</span><br><span class=\"line\">              <span class=\"keyword\">this</span>.table[position] = <span class=\"literal\">undefined</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> getElementValue(node.next)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> getElementValue(<span class=\"keyword\">this</span>.table[position].head)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 线性探查</span></span><br><span class=\"line\">  put(key, value) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> position = HashTable.loseloseHashCode(key)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.table[position] === <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.table[position] = &#123; key, value &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> index = ++position</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (<span class=\"keyword\">this</span>.table[index] !== <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">          index++</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.table[index] = &#123; key, value &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.table[position].append(&#123; key, value &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">get</span>(key) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> position = HashTable.loseloseHashCode(key)</span><br><span class=\"line\">    <span class=\"keyword\">const</span> getElementValue = <span class=\"function\"><span class=\"params\">index</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.table[index] === <span class=\"literal\">undefined</span>) <span class=\"keyword\">return</span> <span class=\"literal\">undefined</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">Object</span>.is(<span class=\"keyword\">this</span>.table[index].key, key)) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.table[index].value</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> getElementValue(index + <span class=\"number\">1</span>)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> getElementValue(position)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  remove(key) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> position = HashTable.loseloseHashCode(key)</span><br><span class=\"line\">    <span class=\"keyword\">const</span> removeElementValue = <span class=\"function\"><span class=\"params\">index</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.table[index] === <span class=\"literal\">undefined</span>) <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">Object</span>.is(<span class=\"keyword\">this</span>.table[index].key, key)) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">this</span>.table[index] = <span class=\"literal\">undefined</span></span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> removeElementValue(index + <span class=\"number\">1</span>)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> removeElementValue(position)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> hash = <span class=\"keyword\">new</span> HashTable()</span><br><span class=\"line\">hash.put(<span class=\"string\">'Surmon'</span>, <span class=\"string\">'surmon.me@email.com'</span>)  <span class=\"comment\">// 19 - Surmon</span></span><br><span class=\"line\">hash.put(<span class=\"string\">'John'</span>, <span class=\"string\">'johnsnow@email.com'</span>)     <span class=\"comment\">// 29 - John</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(hash.get(<span class=\"string\">'Surmon'</span>))  <span class=\"comment\">// surmon.me@email.com</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(hash.get(<span class=\"string\">'Loiane'</span>))  <span class=\"comment\">// undefined</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(hash)</span><br></pre></td></tr></table></figure></li></ul><h1 id=\"七、树\"><a href=\"#七、树\" class=\"headerlink\" title=\"七、树\"></a>七、树</h1><blockquote><p>一对多的非线性结构、分层数据的抽象模型。树状结构分为树和二叉树，树的操作比较复杂但可以转换为二叉树处理</p></blockquote><h2 id=\"树\"><a href=\"#树\" class=\"headerlink\" title=\"树\"></a>树</h2><ul><li>定义：n 个相同类型的数据元素的有限集合，树的集合为森林</li><li>属性<ul><li>节点：树中的数据元素<ul><li>根节点：没有父节点</li><li>分支节点：有子节点</li><li>叶子节点：没有子节点</li></ul></li><li>子树：节点组成的树</li><li>层级：可以按照节点级别分层</li><li>深度：节点到根节点的节点数量</li><li>高度：所有节点深度中的最大值</li><li>权值：</li></ul></li><li>分类<ul><li>无序树：子节点之间没有顺序关系，又称自由树</li><li>有序树：子节点之间有顺序关系<ul><li>二叉树：每个节点最多含有两个子树<ul><li>完全二叉树：最后一层右边可能满或不满，左边和其余层都是满的。堆就是一个完全二叉树</li><li>满二叉树：所有叶节点都在最底层的完全二叉树</li><li>排序二叉树：有序二叉树、二叉查找树、二叉搜索树</li><li>平衡二叉树：AVL树，任何节点的左右子树的高度差不超过 1</li></ul></li><li>哈夫曼树：最优二叉树，带权路径最短的二叉树<ul><li>路径长度：两个节点之间所经过的分支数目</li><li>树带权路径长度：所有叶子节点的带权路径长度之和</li><li>节点带权路径长度：节点到根节点的分支数目和该节点权值的乘积</li></ul></li><li>B 树：一种对读写操作进行优化的自平衡的二叉查找树，能够保持数据有序，拥有多余两个子树。</li></ul></li></ul></li></ul><h2 id=\"二叉树\"><a href=\"#二叉树\" class=\"headerlink\" title=\"二叉树\"></a>二叉树</h2><h3 id=\"遍历方式\"><a href=\"#遍历方式\" class=\"headerlink\" title=\"遍历方式\"></a>遍历方式</h3><ul><li>中序遍历<ul><li>顺序：左侧子节点、节点本身、右侧子节点</li><li>应用：排序操作</li></ul></li><li>前序遍历<ul><li>顺序：节点本身、左侧子节点、右侧子节点</li><li>应用：打印一个结构化的文档</li></ul></li><li>后序遍历<ul><li>顺序：左侧子节点、节点本身、右侧子节点</li><li>应用：计算目录及其子目录的文件空间</li></ul></li></ul><h3 id=\"存储结构\"><a href=\"#存储结构\" class=\"headerlink\" title=\"存储结构\"></a>存储结构</h3><div align=\"center\"><br><img src=\"images/js/binary-order.png\" alt=\"二叉树顺序存储结构\"><br></div><br><div align=\"center\"><br><img src=\"images/js/binary-link.png\" alt=\"二叉树链式存储结构\"><br></div><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 顺序存储结构</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> tree = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, , <span class=\"number\">6</span>, , , <span class=\"number\">7</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 链式存储结构</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BinaryNode</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(key, left = null, right = null) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.key = key</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.left = left</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.right = right</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h3 id=\"基础定义\"><a href=\"#基础定义\" class=\"headerlink\" title=\"基础定义\"></a>基础定义</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Node</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(key) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 数据元素</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.key = key </span><br><span class=\"line\">    <span class=\"comment\">// 指向左右节点的指针</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.left = <span class=\"literal\">null</span>    </span><br><span class=\"line\">    <span class=\"keyword\">this</span>.right = <span class=\"literal\">null</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BinarySearchTree</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.root = <span class=\"literal\">null</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  insert(key) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> newNode = <span class=\"keyword\">new</span> Node(key)</span><br><span class=\"line\">    <span class=\"keyword\">const</span> insertNode = <span class=\"function\">(<span class=\"params\">node, newNode</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (newNode.key &amp;lt; node.key) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (node.left === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                node.left = newNode</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                insertNode(node.left, newNode)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (node.right === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                node.right = newNode</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                insertNode(node.right, newNode)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.root) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.root = newNode</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        insertNode(<span class=\"keyword\">this</span>.root, newNode)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 中序遍历</span></span><br><span class=\"line\">  inOrderTraverse(callback) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> inOrderTraverseNode = <span class=\"function\">(<span class=\"params\">node, callback</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (node !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            inOrderTraverseNode(node.left, callback)</span><br><span class=\"line\">            callback(node.key)</span><br><span class=\"line\">            inOrderTraverseNode(node.right, callback)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    inOrderTraverseNode(<span class=\"keyword\">this</span>.root, callback)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 先序遍历</span></span><br><span class=\"line\">  preOrderTraverse(callback) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> preOrderTraverseNode = <span class=\"function\">(<span class=\"params\">node, callback</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (node !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">          callback(node.key)</span><br><span class=\"line\">          preOrderTraverseNode(node.left, callback)</span><br><span class=\"line\">          preOrderTraverseNode(node.right, callback)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    preOrderTraverseNode(<span class=\"keyword\">this</span>.root, callback)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 后序遍历</span></span><br><span class=\"line\">  postOrderTraverse(callback) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> postOrderTraverseNode = <span class=\"function\">(<span class=\"params\">node, callback</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (node !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">          postOrderTraverseNode(node.left, callback)</span><br><span class=\"line\">          postOrderTraverseNode(node.right, callback)</span><br><span class=\"line\">          callback(node.key)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    postOrderTraverseNode(<span class=\"keyword\">this</span>.root, callback)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  min(node) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> minNode = <span class=\"function\"><span class=\"params\">node</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> node ? (node.left ? minNode(node.left) : node) : <span class=\"literal\">null</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> minNode(node || <span class=\"keyword\">this</span>.root)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  max(node) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> maxNode = <span class=\"function\"><span class=\"params\">node</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> node ? (node.right ? maxNode(node.right) : node) : <span class=\"literal\">null</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> maxNode(node || <span class=\"keyword\">this</span>.root)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  search(key) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> searchNode = <span class=\"function\">(<span class=\"params\">node, key</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (node === <span class=\"literal\">null</span>) <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (node.key === key) <span class=\"keyword\">return</span> node</span><br><span class=\"line\">      <span class=\"keyword\">return</span> searchNode((key &amp;lt; node.key) ? node.left : node.right, key)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> searchNode(root, key)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  remove(key) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>._removeNode(<span class=\"keyword\">this</span>.root, key)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  _removeNode(node, key) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (node === <span class=\"literal\">null</span>) <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (key &amp;lt; node.key) &#123;</span><br><span class=\"line\">        node.left = <span class=\"keyword\">this</span>._removeNode(node.left, key)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> node</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (key &amp;gt; node.key) &#123;</span><br><span class=\"line\">        node.right = <span class=\"keyword\">this</span>._removeNode(node.right, key)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> node</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (node.left === <span class=\"literal\">null</span> &amp;&amp; node.right === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (node.left === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> node.right</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (node.right === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> node.left</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> minNode = <span class=\"keyword\">this</span>._findMinNode(node.right)</span><br><span class=\"line\">            node.key = minNode.key</span><br><span class=\"line\">            node.right = <span class=\"keyword\">this</span>._removeNode(node.right, minNode.key)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> node</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> tree = <span class=\"keyword\">new</span> BinarySearchTree()</span><br><span class=\"line\">tree.insert(<span class=\"number\">11</span>)</span><br><span class=\"line\">tree.insert(<span class=\"number\">7</span>)</span><br><span class=\"line\">tree.insert(<span class=\"number\">5</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(tree)</span><br><span class=\"line\">tree.inOrderTraverse(<span class=\"function\"><span class=\"params\">value</span> =&gt;</span> &#123; <span class=\"built_in\">console</span>.log(value) &#125;)</span><br></pre></td></tr></table></figure><h1 id=\"八、图\"><a href=\"#八、图\" class=\"headerlink\" title=\"八、图\"></a>八、图</h1><blockquote><p>由一系列顶点和连接顶点的边组成的一种非线性数据结构，可以用来表示任何二元关系</p></blockquote><h2 id=\"图的表示\"><a href=\"#图的表示\" class=\"headerlink\" title=\"图的表示\"></a>图的表示</h2><blockquote><p>没有绝对正确的表示方式，采用哪种方式取决于图的类型和待解决的问题</p></blockquote><h3 id=\"邻接矩阵\"><a href=\"#邻接矩阵\" class=\"headerlink\" title=\"邻接矩阵\"></a>邻接矩阵</h3><ul><li>使用一个二维数组来表示图中顶点之间的连接</li><li>如果索引为 i、j 的两个节点连接，则 arr[i][j] === 1，否则为 0</li><li><p>缺点：只有一个相邻顶点的顶点也需要一整行来表示连接，浪费内存</p><div align=\"center\"><br><img src=\"images/js/near-matrix.png\" alt=\"邻接矩阵\"><br></div></li></ul><h3 id=\"邻接表\"><a href=\"#邻接表\" class=\"headerlink\" title=\"邻接表\"></a>邻接表</h3><ul><li>由图中每个顶点的相邻顶点列表所组成</li><li><p>只要能表示一对多的数据结构都可以用来描述邻接表，比如多维数组、链表、散列表、字典等</p><div align=\"center\"><br><img src=\"images/js/near-table.png\" alt=\"邻接表\"><br></div></li></ul><h3 id=\"关联矩阵\"><a href=\"#关联矩阵\" class=\"headerlink\" title=\"关联矩阵\"></a>关联矩阵</h3><ul><li>矩阵的行列分别表示顶点和边，使用二维数组表示两者之间的连通性</li><li>如果顶点A 是边 E 的入射点，则 array[A][E] === 1，否则为 0</li><li><p>通常用于边的数量比顶点少的情况，以节省空间和内存。</p><div align=\"center\"><br><img src=\"images/js/near-table.png\" alt=\"关联矩阵\"><br></div></li></ul><h2 id=\"图的遍历\"><a href=\"#图的遍历\" class=\"headerlink\" title=\"图的遍历\"></a>图的遍历</h2><blockquote><p>可以用来寻找特定的顶点或寻找两个顶点之间的路径，检查图是否连通，检查图是否含有环等。思路是追踪每个第一次访问的节点，并且追踪有哪些节点还没有被完全探索。</p></blockquote><ul><li>广度优先搜索：一层一层的遍历顶点</li><li>深度优先搜索：选择一个路径一直深入遍历直到尽头，再递归回去选择未访问的顶点</li></ul><h2 id=\"创建图类\"><a href=\"#创建图类\" class=\"headerlink\" title=\"创建图类\"></a>创建图类</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Graph</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.vertices = []</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.adjList = <span class=\"keyword\">new</span> Dictionary()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 添加顶点</span></span><br><span class=\"line\">  addVertex(v) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.vertices.push(v)</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.adjList.set(v, [])</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 添加线</span></span><br><span class=\"line\">  addEdge(v, w) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.adjList.get(v).push(w)</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.adjList.get(w).push(v)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  toString() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.vertices.reduce(<span class=\"function\">(<span class=\"params\">r, v, i</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.adjList.get(v).reduce(<span class=\"function\">(<span class=\"params\">r, w, i</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> r + <span class=\"string\">`<span class=\"subst\">$&#123;w&#125;</span> `</span></span><br><span class=\"line\">        &#125;, <span class=\"string\">`<span class=\"subst\">$&#123;r&#125;</span>\\n<span class=\"subst\">$&#123;v&#125;</span> =&gt; `</span>)</span><br><span class=\"line\">    &#125;, <span class=\"string\">''</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 构建顶点之间的路径</span></span><br><span class=\"line\">  distance(fromVertex) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> vertices = <span class=\"keyword\">this</span>.vertices</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; distances, predecessors &#125; = <span class=\"keyword\">this</span>.bfs(fromVertex)</span><br><span class=\"line\">    vertices.forEach(<span class=\"function\"><span class=\"params\">toVertex</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!!distances[toVertex]) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> preVertex = predecessors[toVertex]</span><br><span class=\"line\">            <span class=\"keyword\">let</span> slug = <span class=\"string\">''</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span> (fromVertex !== preVertex) &#123;</span><br><span class=\"line\">                slug = <span class=\"string\">`<span class=\"subst\">$&#123;preVertex&#125;</span> - <span class=\"subst\">$&#123;slug&#125;</span>`</span></span><br><span class=\"line\">                preVertex = predecessors[preVertex]</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            slug = <span class=\"string\">`<span class=\"subst\">$&#123;fromVertex&#125;</span> - <span class=\"subst\">$&#123;slug&#125;</span><span class=\"subst\">$&#123;toVertex&#125;</span>`</span></span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(slug)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 广度优先搜索算法</span></span><br><span class=\"line\">  bfs(v, callback) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> read = []</span><br><span class=\"line\">      <span class=\"keyword\">const</span> distances = []</span><br><span class=\"line\">      <span class=\"keyword\">const</span> predecessors = []</span><br><span class=\"line\">      <span class=\"keyword\">const</span> adjList = <span class=\"keyword\">this</span>.adjList</span><br><span class=\"line\">      <span class=\"keyword\">const</span> pending = [v || <span class=\"keyword\">this</span>.vertices[<span class=\"number\">0</span>]]</span><br><span class=\"line\">      <span class=\"keyword\">const</span> readVertices = <span class=\"function\"><span class=\"params\">vertices</span> =&gt;</span> &#123;</span><br><span class=\"line\">        vertices.forEach(<span class=\"function\"><span class=\"params\">key</span> =&gt;</span> &#123;</span><br><span class=\"line\">            read.push(key)</span><br><span class=\"line\">            pending.shift()</span><br><span class=\"line\">            distances[key] = distances[key] || <span class=\"number\">0</span></span><br><span class=\"line\">            predecessors[key] = predecessors[key] || <span class=\"literal\">null</span></span><br><span class=\"line\">            adjList.get(key).forEach(<span class=\"function\"><span class=\"params\">v</span> =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!pending.includes(v) &amp;&amp; !read.includes(v)) &#123;</span><br><span class=\"line\">                    pending.push(v)</span><br><span class=\"line\">                    distances[v] = distances[key] + <span class=\"number\">1</span></span><br><span class=\"line\">                    predecessors[v] = key</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (callback) callback(key)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (pending.length) readVertices(pending)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      readVertices(pending)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> &#123; distances, predecessors &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 深度优先搜索算法</span></span><br><span class=\"line\">  dfs(callback) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> readTimer = <span class=\"number\">0</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> read = []</span><br><span class=\"line\">      <span class=\"keyword\">const</span> readTimes = []</span><br><span class=\"line\">      <span class=\"keyword\">const</span> finishedTimes = []</span><br><span class=\"line\">      <span class=\"keyword\">const</span> predecessors = []</span><br><span class=\"line\">      <span class=\"keyword\">const</span> adjList = <span class=\"keyword\">this</span>.adjList</span><br><span class=\"line\">      <span class=\"keyword\">const</span> readVertices = <span class=\"function\">(<span class=\"params\">vertices, predecessor</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        vertices.forEach(<span class=\"function\"><span class=\"params\">key</span> =&gt;</span> &#123;</span><br><span class=\"line\">            readTimer++</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (adjList.get(key).every(<span class=\"function\"><span class=\"params\">v</span> =&gt;</span> read.includes(v)) &amp;&amp; !finishedTimes[key]) &#123;</span><br><span class=\"line\">                finishedTimes[key] = readTimer</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (read.includes(key)) <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">            readTimes[key] = readTimer</span><br><span class=\"line\">            read.push(key)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (callback) callback(key)</span><br><span class=\"line\">            predecessors[key] = predecessors[key] || predecessor || <span class=\"literal\">null</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (read.length !== <span class=\"keyword\">this</span>.vertices.length) &#123;</span><br><span class=\"line\">                readVertices(adjList.get(key), key)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      readVertices(adjList.keys)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> &#123; readTimes, finishedTimes, predecessors &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> graph = <span class=\"keyword\">new</span> Graph()</span><br><span class=\"line\"><span class=\"keyword\">const</span> vertices = [<span class=\"string\">'A'</span>,<span class=\"string\">'B'</span>,<span class=\"string\">'C'</span>,<span class=\"string\">'D'</span>];</span><br><span class=\"line\">vertices.forEach(<span class=\"function\"><span class=\"params\">v</span> =&gt;</span> graph.addVertex(v))</span><br><span class=\"line\"></span><br><span class=\"line\">graph.addEdge(<span class=\"string\">'A'</span>, <span class=\"string\">'B'</span>)</span><br><span class=\"line\">graph.addEdge(<span class=\"string\">'A'</span>, <span class=\"string\">'C'</span>)</span><br><span class=\"line\">graph.addEdge(<span class=\"string\">'A'</span>, <span class=\"string\">'D'</span>)</span><br><span class=\"line\">graph.addEdge(<span class=\"string\">'C'</span>, <span class=\"string\">'D'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(graph.toString())  </span><br><span class=\"line\">graph.bfs(graph.vertices[<span class=\"number\">0</span>], value =&gt; <span class=\"built_in\">console</span>.log(<span class=\"string\">'Visited: '</span> + value))</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->"},{"title":"Javascript 常用的数据类型","top":false,"keywords":["js","数据类型"],"date":"2019-03-19T15:11:12.000Z","description":"字符串、对象、数组、base64、二进制对象","_content":"\n# 一、字符串\n> 用于存储和处理文本，可看作类数组\n\n## 创建\n  ```js\n  var str_1 = 'hello'\n  var str_2 = String('123')\n  var str_3 = new String('hello str')\n  ```\n\n## 属性\n  * length：长度\n  * prototype：原型属性，保存当前对象的原型对象\n  * constructor：引用属性，保存当前对象的构造函数\n\n## 常用方法\n  * 字符索引：`charAt、indexOf`\n  * 正则匹配：`match、search、replace`\n  * 分割为数组：`split`\n  * 字符串连接：`concat`\n  * 裁剪字符串：`slice、substr、substring`\n\n\n## 扩展方法\n  ```js\n  // 调用方式\n  var eg1 = \" ab \".trim();\n\n  // 去除左边的空格\n  String.prototype.LTrim = function(){\n      return this.replace(/(^\\s*)/g, \"\");\n  }\n\n  // 去除右边的空格\n  String.prototype.Rtrim = function(){\n      return this.replace(/(\\s*$)/g, \"\");\n  }\n\n  //去除前后空格\n  String.prototype.Trim = function(){\n      return this.replace(/(^\\s*)|(\\s*$)/g, \"\");\n  }\n  ```\n\n　\n# 二、对象\n> 由方法和属性作为键值对组成的一个无序集合。可看作是一个黑盒子，使用时只关注它的对外接口而不需要了解内部结构\n\n## 分类\n  1. 内部对象\n    <div style=\"text-indent: 2em\">包括`Array、Boolean、Date、Function、Global、Math、Number、Object、RegExp、String以及 Error、ReferenceError等各种错误类对象`。其中 `Global 和 Math` 这两个对象又被称为“内置对象”，这两个对象在脚本程序初始化时被创建，不必实例化这两个对象。</div>\n  2. 宿主对象\n    <div style=\"text-indent: 2em\">执行JS脚本的环境提供的对象。对于嵌入到网页中的JS来说，其宿主对象就是浏览器提供的对象，所以又称为浏览器对象，如`Window、Documen、Element、form、image`等。不同的浏览器提供的宿主对象可能不同，即使提供的对象相同，其实现方式也大相径庭，这也带来了浏览器兼容问题，增加开发难度。</div>\n  3. 自定义对象\n    <div style=\"text-indent: 2em\">开发人员自己定义的对象，用于扩展 JS 应用和功能。</div>\n \n\n## 创建\n  ```js\n  // 1、字面量创建\n  var p1 = {\n          name: \"lisa\",\n          say: function(){\n              console.log(this.name);\n          }\n      }\n  // 报错, null / \"\" 都可以\n  var obj = { \"name\": None }  \n\n\n  // 2、Object.create 将对象继承到 __proto__ 属性上\n  var p2 = Object.create({ x: 1 })\n  console.log(p2.__proto__)   \n\n\n  // 3、new 继承构造函数的属性\n\n  // 创建系统内置对象\n  var p3 = new Object({ x: 1 })  \n  console.log(p3) \n\n  var arr = new Array();\n  var date = new Date();\n  var exp = new RegExp(\"ys\");\n\n  // 创建自定义对象 \n  function Person(name, age){\n      this.name = name;\n  }\n  var p4 = new Person(\"tom\");\n  ```\n\n\n## 拷贝\n  * __赋值__\n    * `=、new Object` \n    * 原始对象和目标对象指向同一内存地址，任何修改都会相互影响\n  * __浅拷贝__\n    * `Object.assign / $.extend (target, [objN])` \n    * 只有目标对象的内层对象修改时才会影响原始对象\n  * __深拷贝__\n    * `for in / JSON.parse(JSON.stringify(obj)) / $.extend(true, target, [objN])`\n    * 目标对象的任何修改都不会影响到原始对象\n\n  ```js\n  // 赋值\n  var obj = { age: 18 };\n  var _obj = obj;\n  _obj.age = 20;\n  console.log(obj.age, _obj.age); // 20 20\n\n  // 浅拷贝\n  var boy = {\n    age: 18,\n    address: { home: '北京' }\n  }\n  var _boy = Object.assign({}, boy);\n  _boy.age = 20;\n  _boy.address.home = \"上海\";\n  console.log(boy.age, _boy.age);   // 18 20\n  console.log(boy.address.home, _boy.address.home); // 上海 上海\n  ```\n \n\n## 属性\n  * __数据属性__：包含一个数据值的位置，用于读取和写入值\n    * Configurable：配置，表示能否删除\n    * Enumerable：枚举，表示能否通过 for-in 循环\n    * Writable：可写，表示能否修改属性值\n    * Value：属性的数据值，表示读写属性值的位置\n  * __访问器属性__\n    * 即存取器属性，是一组获取和设置值的函数\n    * 设置 get/set 特性之后，属性就会变成访问器属性\n    * 不能直接定义，必须使用 Object.defineProperty() 来定义\n    * 分类：Configurable、Enumerable、Get、Set\n \n  ```js\n  const cat = { \n    name: \"Jine\", \n    _year: 2020    // 私有属性\n  }\n\n  // 查看属性\n  var prop = Object.getOwnPropertyDescriptor(cat, \"name\")\n\n  // 设置数据属性\n  Object.defineProperty(cat, 'name', {\n    writable: false,\n    value: 'Trump'\n  })\n\n  // 设置访问器属性\n  Object.defineProperty(dog, 'year', {\n    get: function () {\n        return this._year\n    },\n    set: function (newVal) {\n        this._year = newVal\n    }\n  })\n\n  // 初始化对象属性值\n  var person = {\n    _name: 'Jack',\n    get name() { \n      return this._name + \"_s\"\n    },\n    set name(n) { \n      this._name = n \n    }\n  }\n  person.name = 'Lisa';\n  console.log(person.name);  // Lisa_s\n  ```\n\n\n## 操作\n  ```js\n  var obj = { name: \"tom\", age: 20 }\n\n  // 获取\n  // 点操作后只能是属性名，有横杠时须去掉并把后面的首字母大写\n  var name = obj.name   \n   // 中括号中可放属性名或变量名  \n  var age = obj['age']  \n\n  // 修改\n  obj.name = \"新属性值\"  \n\n  // 方法\n  obj.say = function(){ console.log(1) }    \n\n  // 删除\n  delete obj.age          \n\n  // 判断类型\n  obj instanceof Object  \n\n  // 判断对象实例是否包含某个属性\n  obj.hasOwnProperty(\"name\")\n\n  // 判断对象实例及其原型中是否包含某个属性\n  \"name\" in obj\n\n  //判断`obj`是否为空\n  function isEmptyObject(obj){  \n    if(!obj || typeof obj !== 'object' || Array.isArray(obj)){\n        return false\n    }\n    return ! Object.keys(obj).length\n  }\n  ```\n\n\n## 原型链\n\n<div style=\"text-indent: 2em\">每个对象都会在其内部初始化一个属性，就是 prototype (原型)，当我们访问一个对象的属性时，如果这个对象内部没有这个属性则去 prototype 里找这个属性，这个 prototype 又会有自己的 prototype，直到 null 结束，如果没有则返回undefined，这就是原型链的运行原理，即查找顺序：`实例对象 obj --> 原型对象 fn.prototype --> Object.prototype -->  null`</div>\n\n  1. 相互关系：`obj.constructor.prototype = obj.__proto__`\n  2. 函数对象：通过 new Function() 创建都是函数对象，其他的都是普通对象。每个对象都有 `__proto__` 属性指向原型对象，但只有函数对象才有 `prototype` 属性\n  3. 原型对象：一个普通对象。所有的原型对象都会自动获得一个指向其构造函数的指针 `constructor`，构造函数通过 `prototype` 属性指向它的原型对象，可以说 原型对象 `Person.prototype` 就是构造函数 `Person` 的一个实例\n  3. 原型链继承：利用原型让一个引用类型继承另一个引用类型的属性和方法，即让原型对象等于另一个类型的实例，这样就可以通过 `__proto__` 属性构成实例与原型的链条, 从而实现继承。\n\n \n  ```js\n  function Person(name){\n      this.name = name;   \n  }\n  Person.prototype.say = function(){\n      console.log(1);\n  }\n  function Son(name){\n      Person.call(this, name);\n  }\n  var s1 = new Son(\"son1\");\n  var s2 = new Son(\"son2\");\n  console.log(s1.__proto__ == s2.__proto__)\n  ```\n\n\n## 序列化\n<div style=\"text-indent: 2em\">JSON 是一种轻量级的数据交互方式，可以存储和传输数据而显示更丰富的信息，一般作为前后端交互的数据格式。</div>\n\n  ```js\n  // json 对象转为字符串\n  var json_1 = { name: \"tom\", age: 18 }\n  var strJson = JSON.stringify(json)\n\n\n  // json 字符串转为对象\n  var strJson = '{ name: \"tom\", age: 18 }'\n  var json_2 = eval('(' +strJson+ ')');   // 不建议使用\n  var json_3 = JSON.parse(strJson)        // 接近 W3C 标准\n  ```\n\n\n## 类数组对象\n<div style=\"text-indent: 2em\">拥有一个length属性和若干索引属性的对象，常见的有 `arguments、document.forms、document.getElementsByClassName`。arguments 是函数中自动创建的一种类数组对象，用来模拟函数重载效果（根据传入参数个数执行不同函数）。</div>\n\n  ```js\n  // 转换为数组\n  var arrayLike = { '0' : 'a','1' : 'b', length : 3 };\n  var arr1 = Array.prototype.slice.call(arrayLike);\n  var arr2 = [].slice.call(arrayLike);\n  var arr3 = Array.from(arrayLike);\n\n  // arguments 重载\n  var checkout = function(){\n    　　if(arguments.length==0){\n    　　　　console.log(\"微信\");\n    　　}else if(arguments.length==1){\n    　　　　console.log(\"现金\");\n    　　}else{\n    　　　　console.log(\"刷卡\");\n    　　}\n  }\n  checkout();      // 微信\n  checkout(100);   // 现金\n  checkout(1, 2);  // 刷卡\n  ```\n\n\n\n# 三、数组\n> 一组数据的有序集合，表现形式是内存中的一段连续的内存地址\n\n## 创建\n  ```js\n  // 直接创建 \n  var arr = []            // 空数组\n  var arr2 = [1, 2, 3]    // 三个元素\n\n  // 通过构造函数\n  var arr1 = new Array()    // 空数组\n  var arr2 = new Array(10)    // 长度为10 \n  var arr3 =  new Array(1, 2)   // 两个元素\n\n  // 数组中是否存在下标为 1 的元素\n  1 in arr \n  ```\n\n## 拷贝\n  * 浅拷贝\n    * `arr.slice(0)、arr.concat()`\n    * 如果数组元素都是基本类型，原始数组和目标数组的修改互不影响\n    * 如果数组元素是对象或数组，这样会只拷贝引用而导致修改时相互影响\n  * 深拷贝\n    * `JSON.parse(JSON.stringify(arr))`\n    * 不论数组元素是什么类型，原始数组和目标数组的修改都会互不影响\n\n\n  ```js\n  // 浅拷贝\n  var shallowCopy = function (obj) { \n    if (typeof obj !== 'object') return; \n    var newObj = obj instanceof Array ? [] : {}; \n    for (var key in obj) {\n      if (obj.hasOwnProperty(key)) {\n        newObj[key] = obj[key];\n      }\n    }\n    return newObj;\n  }\n\n  // 深拷贝\n  var deepCopy = function(obj) {\n    if (typeof obj !== 'object') return;\n    var newObj = obj instanceof Array ? [] : {};\n    for (var key in obj) {\n      if (obj.hasOwnProperty(key)) {\n        newObj[key] = typeof obj[key] === 'object' ? deepCopy(obj[key]) : obj[key];\n      }\n    }\n    return newObj;\n  }\n  ```\n\n\n## 特殊数组\n  * 多维数组：元素是数组\n  * 稀疏数组：索引不连续，length值大于实际元素个数\n\n\n  ```js\n  // 二维数组\n  var arr = [ [1, 2], [1, ‘good’] ]\n  console.log(arr[0][0])\n\n  // 稀疏数组\n  var arr = [];\n  arr[20] = \"hello\";\n  ```\n\n\n## 操作方法\n  1. 基础\n    * 读写：`索引/属性`\n    * 添加：`arr[index] = new`\n    * 删除：`delete arr[index]`\n    * 遍历：`for`\n  2. ES3\n    * 添加：`push、unshift、concat`\n    * 删除：`pop、shift`\n    * 裁剪：`slice、splice`\n    * 排序：`sort、reverse`\n    * 转换：`join、toString`\n  3. ES5\n    * 位置：`indexOf、lastIndexOf`\n    * 迭代：`every、some、filter、forEach、map`\n    * 累计：`reduce`\n\n\n  ```js\n  // 元素读写\n  var arr = [2, 1, 3]\n  consloe.log(arr.length)\n  consloe.log(arr[0])\n\n  arr[1] = 1\n  arr[-1.23] = true  // 超出范围时就不是索引，而是属性\n\n\n  // 判断是否数组\n  Array.isArray(arr)   \n  arr instanceof Array\n  arr.constructor === Array\n  arr.prototype.toString.apply([Array])\n\n  // 判断元素         \n  arr.every(function(item){\n      return item &gt; 5\n  }) \n\n  // 排序\n\tarr.sort(function(a, b){ \n      return a-b\n  })\n\n  // 遍历\n  arr.forEach(function(value, index, arr){ })\n\n  // 映射返回新数组，原数组不改变\n  arr.map(function(value, index, arr){ \n      return value * 2    \n  })\n  arr.map(item => item + 10)\n\n  // 过滤不符合条件的元素\n  arr.filter(function(value, index){ \n      return value % 2 !== 0\n  })          \n  \n  // 累计\n  arr.reduce(function(x, y){ \n      return x + y\n  })\n  ```\n\n\n## 扩展方法\n\n### 求最值\n  ```js\n  // 最大值\n  Math.max(...arr)\n  Math.max.apply(null, arr)\n\n  // 最小值\n  Math.min(...arr)\n  Math.min.apply(null, arr)\n  ```\n\n### 数组去重\n  ```js\n  // ES6 Set 有元素唯一的特性\n  [...new Set(arr)]  \n  Array.from(new Set(arr))\n\n  // 添加原型方法\n  Array.prototype.distinct = function (){\n      var arr = this,\n          result = [],\n          len = arr.length;\n\n      arr.forEach(function(v, i ,arr){   \n          var bool = arr.indexOf(v, i+1);   \n          if(bool === -1){\n              result.push(v);\n          }\n      })\n      return result;\n  };\n  arr.distinct()\n\n  // 普通封装\n  function arry_unique(array){\n      var res = [];\n      var json = {};\n      for(var i = 0; i &lt; array.length; i++){\n          if(!json[array[i]]){\n              res.push(array[i]);\n              json[array[i]] = 1;\n          }\n      }\n      return res;\n  }\n  ```\n\n\n### 数据过滤\n  ```js\n  export const filterArr = items => {\n      return items.filter(function (item) {\n          // 遍历 item 对象里面的键值是否符合回调函数的测试\n          return Object.keys(item).some(function (key) {\n              return String(item[key]).toLowerCase().match(searchVal)\n          })\n      })\n  }\n  ```\n \n\n# 四、Base64\n> 基于 64 个可打印字符 `A-Z、a-z、0-9、+、/` 来表示二进制数据的一种方法\n\n## 产生\n  * 需求\n    * 网络传输中文时容易出现乱码情况\n    * 网络传输图片等文件的字符并不全是可打印的字符\n    * 电子邮件早期只能传输英文，中文字符不能被服务器处理\n  * 适用场景\n    * 当访问外部资源很麻烦或受限时\n    * 当图片的体积太小，占用一个 HTTP 会话不是很值得时\n    * 当图片是在服务器端用程序动态生成，各个访问用户显示不同时\n  * 图片应用\n    * 主流浏览器都支持基于 Base64 编码的 dataURL 字符串 作为图片地址，[图片在线转码](http://imgbase64.duoshitong.com/) \n    * 图片上传服务器时需要纯字符串形式，截取 data:image/png;base64, 后面的字符串即可上传\n\n\n## 编码\n> 一种将二进制序列的数据转换为字符串的编码算法，只是无法直接看到明文但并非加密\n\n  * 理解\n    * 字节 byte 是存储二进制数据的基本单位\n    * 中文有 utf-8、gbk 等多种编码，不同编码对应的结果都不一样\n    * 对于图片、文本和音视频等数据，只有转换为 二进制序列 之后才能进行 Base64 编码\n    * 编码后的数据体积一般会变大，而且 base64Url 形式的图片不会被浏览器缓存，每次访问这样页面时都被下载一次，所以不适合被大量使用\n  * 规则\n    1. 将每三个字节作为一组，一共是 24 个二进制位\n    2. 将 24 个二进制位分为四组，每个组有 6 个二进制位\n    3. 在每组前面加两个00，扩展为 32 个二进制位，即 4 个字节\n    4. 根据 base64 编码对照表转换为扩展后的每个字节的对应字符\n\n\n## API\n\n### 浏览器原生实现\n  ```js \n  // 编码\n  window.btoa('xiaomabuhei')  \n  // 解码\n  window.atob('eGlhb21hYnVoZWk=')          \n\n\n  // 中文编码时需要先进行 URI 组件编码\n  window.btoa(window.encodeURIComponent('小马不黑'))\n  window.decodeURIComponent(window.atob(baseStr))\n  ```\n\n### js 实现\n  ```js\n  var Base64 = {\n    _keyStr: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",\n\n    encode: function(input) {\n      var output = \"\";  \n      var chr1, chr2, chr3, enc1, enc2, enc3, enc4;  \n      var i = 0;  \n      input = Base64._utf8_encode(input);  \n      while (i &lt; input.length) {  \n          chr1 = input.charCodeAt(i++);  \n          chr2 = input.charCodeAt(i++);  \n          chr3 = input.charCodeAt(i++);  \n          enc1 = chr1 &gt;&gt; 2;  \n          enc2 = ((chr1 & 3) &lt;&lt; 4) | (chr2 &gt;&gt; 4);  \n          enc3 = ((chr2 & 15) &lt;&lt; 2) | (chr3 &gt;&gt; 6);  \n          enc4 = chr3 & 63;  \n          if (isNaN(chr2)) {  \n              enc3 = enc4 = 64;  \n          } else if (isNaN(chr3)) {  \n              enc4 = 64;  \n          }  \n          output = output +  \n          _keyStr.charAt(enc1) + _keyStr.charAt(enc2) +  \n          _keyStr.charAt(enc3) + _keyStr.charAt(enc4);  \n      }  \n      return output; \n    },\n\n    decode: function(input) {\n      var output = \"\";  \n      var chr1, chr2, chr3;  \n      var enc1, enc2, enc3, enc4;  \n      var i = 0;  \n      input = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");  \n      while (i &lt; input.length) {  \n          enc1 = _keyStr.indexOf(input.charAt(i++));  \n          enc2 = _keyStr.indexOf(input.charAt(i++));  \n          enc3 = _keyStr.indexOf(input.charAt(i++));  \n          enc4 = _keyStr.indexOf(input.charAt(i++));  \n          chr1 = (enc1 &lt;&lt; 2) | (enc2 &gt;&gt; 4);  \n          chr2 = ((enc2 & 15) &lt;&lt; 4) | (enc3 &gt;&gt; 2);  \n          chr3 = ((enc3 & 3) &lt;&lt; 6) | enc4;  \n          output = output + String.fromCharCode(chr1);  \n          if (enc3 != 64) {  \n              output = output + String.fromCharCode(chr2);  \n          }  \n          if (enc4 != 64) {  \n              output = output + String.fromCharCode(chr3);  \n          }  \n      }  \n      output = Base64._utf8_decode(output);  \n      return output;  \n    },\n\n    _utf8_encode: function(string) {\n      string = string.replace(/\\r\\n/g, \"\\n\");  \n      var utftext = \"\";  \n      for (var n = 0; n &lt; string.length; n++) {  \n          var c = string.charCodeAt(n);  \n          if (c &lt; 128) {  \n              utftext += String.fromCharCode(c);  \n          } else if((c &gt; 127) && (c &lt; 2048)) {  \n              utftext += String.fromCharCode((c &gt;&gt; 6) | 192);  \n              utftext += String.fromCharCode((c & 63) | 128);  \n          } else {  \n              utftext += String.fromCharCode((c &gt;&gt; 12) | 224);  \n              utftext += String.fromCharCode(((c &gt;&gt; 6) & 63) | 128);  \n              utftext += String.fromCharCode((c & 63) | 128);  \n          }  \n  \n      }  \n      return utftext; \n    },\n\n    _utf8_decode: function(e) {\n      var string = \"\";  \n      var i = 0;  \n      var c = c1 = c2 = 0;  \n      while ( i &lt; utftext.length ) {  \n          c = utftext.charCodeAt(i);  \n          if (c &lt; 128) {  \n              string += String.fromCharCode(c);  \n              i++;  \n          } else if((c &gt; 191) && (c &lt; 224)) {  \n              c2 = utftext.charCodeAt(i+1);  \n              string += String.fromCharCode(((c & 31) &lt;&lt; 6) | (c2 & 63));  \n              i += 2;  \n          } else {  \n              c2 = utftext.charCodeAt(i+1);  \n              c3 = utftext.charCodeAt(i+2);  \n              string += String.fromCharCode(((c & 15) &lt;&lt; 12) | ((c2 & 63) &lt;&lt; 6) | (c3 & 63));  \n              i += 3;  \n          }  \n      }  \n      return string;\n    }\n  }\n  ```\n\n\n## 图片转换\n> 将网络或本地图片的地址转为 base64 格式\n\n### canvas\n\n  ```js\n  function getBase64Img(img) {\n      var canvas = document.createElement(\"canvas\");\n      canvas.width = img.width;\n      canvas.height = img.height;\n      var ctx = canvas.getContext(\"2d\");\n      ctx.drawImage(img, 0, 0, img.width, img.height);\n      var ext = img.src.substring(img.src.lastIndexOf(\".\") + 1).toLowerCase();\n      var dataURL = canvas.toDataURL(\"image/\" + ext);\n      return dataURL;\n  }\n  // Base64 字符串转二进制\n  function base64ToBlob(dataurl) {\n\n      // 去头并转为 byte\n      var arr = dataurl.split(',');\n\n      // 处理异常：将 ASCII 码小于0的转换为大于0\n      var mime = arr[0].match(/:(.*?);/)[1];\n\n      // 解码\n      var bytes = window.atob(arr[1]);\n      var n = bytes.length;\n\n      // 生成视图（直接针对内存）：8位无符号整数，长度1个字节\n      var u8arr = new Uint8Array(n);\n\n      while (n--) {\n          u8arr[n] = bytes.charCodeAt(n);\n      }\n      return new Blob([u8arr], { type: mime });\n  }\n  \n  var image = new Image();\n  image.src = \"img_url\";\n  image.onload = function() {\n      var base64 = getBase64Img(image);\n      var file = base64ToBlob(base64);\n  }\n\n\n  function getBase64Image(url, quality = 0.5) {\n      const img = new Image();\n      img.src = url\n      \n      return new Promise(resolve => {\n          img.onload = () => {\n              const canvas = document.createElement(\"canvas\");\n              canvas.width = img.width;\n              canvas.height = img.height;\n              const ctx = canvas.getContext(\"2d\");\n\n              ctx.drawImage(img, 0, 0, img.width, img.height);\n              dataURL = canvas.toDataURL('image/jpeg', quality);\n              resolve(dataURL)\n          }\n      })\n  }\n  getBase64Image(\"./pic.png\", 0.8).then(dataURL => {\n      console.log(dataURL)\n      document.querySelector('img').src = dataURL\n  })\n  ```\n\n\n### html2canvas\n> 截图功能：将 html 页面转化为图片\n\n  ```js\n  html2canvas(document.querySelector('img'), {useCORS: true}).then(canvas => {\n      var base64 = canvas.toDataURL(\"image/jpeg\", 0.1);\n      document.body.appendChild(canvas);\n      // downloadImg(base64, \"meme.png\")  // 下载图片\n  })\n  function downloadImg(base64, imgName) {\n      var a = document.createElement(\"a\");\n      a.href = base64;\n      a.download = imgName;\n      a.click();\n  }\n  ```\n\n\n### Node.js\n  ```js\n  // 通过 fs.readFile\n  const fs = require('fs');\n  fs.readFile('./a.png', 'base64', (err, data) => {\n      // 图片需要在 data 前添加 'data:image/png;base64,'\n      console.log(data)\n  })\n\n\n  // 通过 fs.createReadStream\n  var fs = require('fs');\n  var readStream = fs.createReadStream('./pic.png');\n\n  readStream.on('data', function (chunk) {\n      console.log(chunk.toString('base64')) \n  })\n  ```\n\n\n### Buffer\n  ```js\n  let base64 = Buffer.from('把我转化为base64').toString('base64')\n  console.log(base64)\n  ```\n\n\n\n# 五、二进制对象\n<div style=\"text-indent: 2em\">js 最初无法处理文件、网络流等二进制 (编码格式的) 数据，只能先使用 charCodeAt() 逐字节读取 或者 转换为 Base64 格式，但是处理速度慢而且容易出错。js 后来通过引入 API 逐渐可以处理二进制数据，但是标准库里没有相关内容，所以 NodeJs 就自己搞了一套，现在 Web 自己也搞起来了，这就导致了 Web 环境和 Node 环境里的二进制内容处理方式有些不同。</div> \n\n## 通用\n<div style=\"text-indent: 2em\">`ArrayBuffer 对象` 表示内存中存储了一段二进制数据的原始缓冲区，它不能直接读写，只能通过 `TypedArray/DataView 视图` 转换为类型化数组之后来读写。同一段内存的不同数据有不同的读取方式，对应不同的视图。视图的作用是以指定格式读写二进制数据但本身并不存储，本质是二进制数据的抽象数据结构，两种视图的区别在于字节序，TypedArray 视图的数组成员都是同一个数据类型，DataView 视图的数组成员可以是不同的数据类型。。</div> \n\n### ArrayBuffer\n> 用于存储二进制数据，本质是一串数字组成的乱码但没有格式，不能直接被访问\n\n  ```js\n  // 创建一个 8 字节的缓冲区对象\n  let buffer = new ArrayBuffer(8);\n\n  // 字节长度 8\n  console.log(buffer.byteLength);   \n\n  // 参数是否为视图实例\n  ArrayBuffer.isView(buffer) \n\n  // 裁剪缓冲区\n  let buffer1 = buffer.slice(0, 1)  \n  ```\n\n\n### TypedArray\n> 成员为相同的数据类型\n\n  * 本质：一组类的统称，它们的实例都是类数组对象\n  * 语法：和普通数组语法相同，但是其元素的数据类型相同而且没有空位\n  * API：\n    * 有符号整数：Int8Array、Int16Array、Int32Array\n    * 无符号整数：Uint8Array、Uint16Array、Uint32Array\n    * 浮点数：Float32Array、Float64Array\n \n  ```js\n  // 直接生成视图，默认生成底层 ArrayBuffer 实例并赋值\n  var f = new Float64Array(8)\n\n  // 通过 buffer 生成视图，默认全部内容，参数为 buffer、开始索引、长度\n  let buffer = new ArrayBuffer(4);\n  let a = new Int8Array(buffer)   \n  var b = new Uint32Array(buffer, 0, 1)\n  var c = new Uint8Array(buffer, 1, 1)\n\n  // 操作视图元素\n  for (var i=0; i &lt; f.byteLength; i++){ }\n  f[1] = 10        // [0, 10]\n\n  // 与普通数组互转\n  var arr = Array.from(f) \n  arr_2 = Array.apply([], t)\n  var u = new Uint8Array([ 1, 2, 3 ])\n\n  // 与字符串互转\n  var str = String.fromCharCode.apply(null, buffer)\n  function strToBuf (str) {\n    // 每个字符占用2个字节\n    var buf = new ArrayBuffer(str.length*2)\n    var bufView = new Uint16Array(buf)\n    for(var i=0; i &lt; str.length; i++){\n        bufView[i] = str.charCodeAt(i)\n    }\n      return bufView;\n  }\n  ```\n\n### DataView \n> TypedArray 的强化版，成员可以是不同的数据类型，而且读写时可以自行设定 大/小 端字节序\n \n  ```js\n  let buffer = new ArrayBuffer(4)\n  let dataView = new DataView(buffer)\n\n  // 独有方法，写入参数是 开始位置、写入数据、大/小端读取\n  dataView.getInt8(0)\n  dataView.setInt8(0, 10)\n  dataView.setInt32(0, 25, false) \n  ```\n\n## web 环境特有\n\n### Blob \n> 表示一个不可变的文件对象，它提供了一系列操作文件的接口\n\n  1. 创建方式\n    * 构造函数：`new Blob(dataArr, options)`\n      * dataArr：必选数组，数组成员可以是二进制对象或字符串\n      * options：可选对象，用于设置数组中数据的 MIME 类型\n    * slice 方法：`blob.slice(start, end, contentType)` \n      * 从已有的 Blob 对象调用 slice 接口切出一个新的 Blob 对象\n      * contentType：可选，规定新 Blob 对象的类型\n    * canvas 对象：`canvas.toBlob(callback, type, options)`\n      * 把当前绘制信息转为一个 Blob 对象\n  2. 属性与方法\n    * 属性\n      * size：对象的字节长度\n      * type：对象的数据类型 \n      * isClosed: 该对象是否调用过 close()\n    * 方法\n      * close：释放对象\n      * slice：裁剪并返回新对象\n  \n  ```js\n  // String 转为 Blob\n  var blob = new Blob([\"Hello World\"], {type:\"text/plain\"});\n\n  // ArrayBuffer 转为 Blob\n  var buffer = new ArrayBuffer(8)\n  var blob = new Blob([buffer], {type:\"text/plain\"});\n\n  // TypeArray 转为 Blob\n  var uArr = new Uint16Array([97, 32, 72, 100]);\n  var blob = new Blob([uArr]);\n\n  let blob = blob_2.slice(1, 5);\n\n  var canvas = document.getElementById(\"canvas\");\n  canvas.toBlob(function(blob){\n     console.log(blob);\n  })\n  ```\n\n\n### Blob 派生对象\n> blob 对象是它们的底层对象，它们都是继承 blob 对象并进行了扩展，但其内容一样无法修改\n\n#### File 对象\n  * 功能：保存文件的相关信息并允许 Js 访问\n  * 分类\n    * input 元素上选择文件后返回的 FileList 对象 \n    * 普通元素被自由拖拽时返回的 DataTransfer 对象\n    * HTMLCanvasElement 上执行 mozGetAsFile() 方法后返回的结果\n\n#### FileReader 对象 \n  * 功能：提供异步读取文件内容或二进制数据的接口\n  * 保存：读取的文件内容会被保存到 result 属性中\n  * 异步读取\n    * readAsText(file, encoding)：返回 纯文本。encoding 指定编码格式（默认 'UTF-8'）\n    * readAsDataURL(file)：返回 基于 Base64 编码的 dataURL 字符串（读取图像时常用）\n    * readAsBinaryString(file)：返回 文件的原始二进制字符串（每个字符表示一字节）\n    * readAsArrayBuffer(file)：返回 包含文件内容的 ArrayBuffer 对象\n  * 中止读取：abort() \n  * 回调函数\n    * onload：成功时\n    * onerror：出错时\n    * onprogress：更新时\n    * onloadstart：开始时\n    * onloadend：完成时\n    * onabort：中止时\n\n#### URL 对象\n  * 功能：通过内存文件创建出一个临时指向 File/Blob 对象的 url\n  * 静态方法\n    * createObjectURL：生成\n    * revokeObjectURL：释放\n  * 注意事项\n    * 网页一旦刷新或关闭，已生成的 url 就会失效\n    * 同样的 blob 在不同的事件调用中会得到不同 url\n\n\n  ```js\n  // 选择文件后获取文件信息\n  var fileInput = document.querySelector(\"#fileInput\");\n\n  fileInput.addEventListener(\"change\", function (event) {\n      var fileList = fileInput.files\n      var file = fileList[0];\n      console.log(file.name, file.size)\n  }, false)\n\n  // 拖动结束时获取被拖动的数据\n  var box = document.getElementById(\"#box\");\n  box.ondrop = function(event){\n      // 拖动的默认处理方式是在新窗口打开\n      event.preventDefault()    \n\n      console.log(event.dataTransfer.files)\n  }\n\n  // 获取文件二进制数据\n  var reader = new FileReader();\n  reader.readAsArrayBuffer(file);\n\n  reder.onprogress = function(e){ \n    console.log(reader.result)  \n    console.log(e.target.result)\n  }\n  reader.onload = function (e) { \n    console.log(reader.result)  \n    console.log(e.target.result)\n  }\n\n  // 在网页插入图片\n  var img = document.createElement(\"img\");\n  img.src = window.URL.createObjectURL(file);\n  img.width = 60;\n  img.onload = function(e) {\n      window.URL.revokeObjectURL(this.src);\n  }\n  document.body.appendChild(img);\n  ```\n\n \n## Node 环境特有\n\n### Buffer   \n  <div style=\"text-indent: 2em;\">Buffer 表示 V8 堆内存之外的一块原始内存，并不会占用 NodeJS 进程内存，常用来存储需要占用大量内存的数据。它继承于 Uint8Array 并实现了更多的接口，对象中的每个元素储存着 2 位 16 进制的数据，代表内存的一个字节。注意一个 Buffer 对象的大小在创建时就会固定下来，即创建之后不可改变。</div>\n\n  * 创建\n    * new Buffer：已经弃用\n    * __Buffer.from__：参数可为 string、buffer、array、object\n    * __Buffer.alloc__：指定大小并已经初始化数据\n    * __Buffer.allocUnsafe__：指定大小但并不初始化数据\n  * 读写\n    * __buf.writexxx__：写入缓冲区\n    * __buf.readxxx__：读取数据\n  * 转换\n    * __buf.toString__：转为字符串\n    * __buf.toJSON__：转为 json\n  * 判断\n    * __Buffer.isEncoding__：编码格式\n    * __Buffer.isBuffer__：对象是否为 Buffer\n  * 其它 \n    * __buf.length__：返回字节数\n    * __buf.indexOf__：返回位置\n    * __buf.compare__：对象比较\n    * __buf.fill__：填充数据\n    * __buf.slice__：裁剪\n    * __buf.copy__：拷贝\n    \n\n  ```js\n  // 创建 \n  const buf_1 = Buffer.from([0x62, 0x75, 0x66, 0x66]);\n  const buf = Buffer.from(\"hello\")   // 编码格式默认 utf8 \n  console.log(buf.length)\n\n  const buf_2 = Buffer.alloc(5);       // 不做任何处理就是 0 填充\n  const buf = Buffer.alloc(5, 'a');  // 以 a 填充\n  const buf = Buffer.alloc(10, 'aGVsbG8gd29ybGQ=', 'base64');  // 以 base64 格式填充\n\n  const buf = Buffer.allocUnsafe(10);  // 只有一个参数\n\n  // 拼接\n  let buf_3 = Buffer.concat([buf_1, buf_2])\n\n  // 裁剪\n  var buf_2 = buf_1.slice(0, 5);\n\n  // 拷贝\n  buf_2.copy(buf_1, 2);\n\n  // 比较\n  var result = buf_1.compare(buf_2);\n\n  // 读写\n  var value = buf.readInt32LE(0)\n  buf.writeFloatLE(3. 16, 0)\n\n  // buffer 转字符串\n  const buf = Buffer.from('test')\n  buf.toString('utf8')             // test\n  buf.toString('utf8', 0, 2)       // te\n\n  // buffer 转 json\n  buf.toJSON()\n\n  // stream 转 buffer\n  function streamToBuffer(stream) {  \n      return new Promise((resolve, reject) => {\n          let buffers = [];\n          stream.on('error', reject);\n          stream.on('data', (data) => buffers.push(data))\n          stream.on('end', () => resolve(Buffer.concat(buffers))\n      })\n  }\n\n  // buffer 转 stream\n  let Duplex = require('stream').Duplex;\n\n  function bufferToStream(buffer) {  \n      let stream = new Duplex();\n      stream.push(buffer);\n      stream.push(null);\n      return stream;\n  }\n  ```\n \n        \n        \n","source":"_posts/8-js数据.md","raw":"---\ntitle: Javascript 常用的数据类型\ntags:\n  - Javascript\n  - js 数据\ncategories: Javascript\ntop: false\nkeywords:\n  - js\n  - 数据类型\ndate: 2019-03-19 23:11:12\ndescription: 字符串、对象、数组、base64、二进制对象 \n---\n\n# 一、字符串\n> 用于存储和处理文本，可看作类数组\n\n## 创建\n  ```js\n  var str_1 = 'hello'\n  var str_2 = String('123')\n  var str_3 = new String('hello str')\n  ```\n\n## 属性\n  * length：长度\n  * prototype：原型属性，保存当前对象的原型对象\n  * constructor：引用属性，保存当前对象的构造函数\n\n## 常用方法\n  * 字符索引：`charAt、indexOf`\n  * 正则匹配：`match、search、replace`\n  * 分割为数组：`split`\n  * 字符串连接：`concat`\n  * 裁剪字符串：`slice、substr、substring`\n\n\n## 扩展方法\n  ```js\n  // 调用方式\n  var eg1 = \" ab \".trim();\n\n  // 去除左边的空格\n  String.prototype.LTrim = function(){\n      return this.replace(/(^\\s*)/g, \"\");\n  }\n\n  // 去除右边的空格\n  String.prototype.Rtrim = function(){\n      return this.replace(/(\\s*$)/g, \"\");\n  }\n\n  //去除前后空格\n  String.prototype.Trim = function(){\n      return this.replace(/(^\\s*)|(\\s*$)/g, \"\");\n  }\n  ```\n\n　\n# 二、对象\n> 由方法和属性作为键值对组成的一个无序集合。可看作是一个黑盒子，使用时只关注它的对外接口而不需要了解内部结构\n\n## 分类\n  1. 内部对象\n    <div style=\"text-indent: 2em\">包括`Array、Boolean、Date、Function、Global、Math、Number、Object、RegExp、String以及 Error、ReferenceError等各种错误类对象`。其中 `Global 和 Math` 这两个对象又被称为“内置对象”，这两个对象在脚本程序初始化时被创建，不必实例化这两个对象。</div>\n  2. 宿主对象\n    <div style=\"text-indent: 2em\">执行JS脚本的环境提供的对象。对于嵌入到网页中的JS来说，其宿主对象就是浏览器提供的对象，所以又称为浏览器对象，如`Window、Documen、Element、form、image`等。不同的浏览器提供的宿主对象可能不同，即使提供的对象相同，其实现方式也大相径庭，这也带来了浏览器兼容问题，增加开发难度。</div>\n  3. 自定义对象\n    <div style=\"text-indent: 2em\">开发人员自己定义的对象，用于扩展 JS 应用和功能。</div>\n \n\n## 创建\n  ```js\n  // 1、字面量创建\n  var p1 = {\n          name: \"lisa\",\n          say: function(){\n              console.log(this.name);\n          }\n      }\n  // 报错, null / \"\" 都可以\n  var obj = { \"name\": None }  \n\n\n  // 2、Object.create 将对象继承到 __proto__ 属性上\n  var p2 = Object.create({ x: 1 })\n  console.log(p2.__proto__)   \n\n\n  // 3、new 继承构造函数的属性\n\n  // 创建系统内置对象\n  var p3 = new Object({ x: 1 })  \n  console.log(p3) \n\n  var arr = new Array();\n  var date = new Date();\n  var exp = new RegExp(\"ys\");\n\n  // 创建自定义对象 \n  function Person(name, age){\n      this.name = name;\n  }\n  var p4 = new Person(\"tom\");\n  ```\n\n\n## 拷贝\n  * __赋值__\n    * `=、new Object` \n    * 原始对象和目标对象指向同一内存地址，任何修改都会相互影响\n  * __浅拷贝__\n    * `Object.assign / $.extend (target, [objN])` \n    * 只有目标对象的内层对象修改时才会影响原始对象\n  * __深拷贝__\n    * `for in / JSON.parse(JSON.stringify(obj)) / $.extend(true, target, [objN])`\n    * 目标对象的任何修改都不会影响到原始对象\n\n  ```js\n  // 赋值\n  var obj = { age: 18 };\n  var _obj = obj;\n  _obj.age = 20;\n  console.log(obj.age, _obj.age); // 20 20\n\n  // 浅拷贝\n  var boy = {\n    age: 18,\n    address: { home: '北京' }\n  }\n  var _boy = Object.assign({}, boy);\n  _boy.age = 20;\n  _boy.address.home = \"上海\";\n  console.log(boy.age, _boy.age);   // 18 20\n  console.log(boy.address.home, _boy.address.home); // 上海 上海\n  ```\n \n\n## 属性\n  * __数据属性__：包含一个数据值的位置，用于读取和写入值\n    * Configurable：配置，表示能否删除\n    * Enumerable：枚举，表示能否通过 for-in 循环\n    * Writable：可写，表示能否修改属性值\n    * Value：属性的数据值，表示读写属性值的位置\n  * __访问器属性__\n    * 即存取器属性，是一组获取和设置值的函数\n    * 设置 get/set 特性之后，属性就会变成访问器属性\n    * 不能直接定义，必须使用 Object.defineProperty() 来定义\n    * 分类：Configurable、Enumerable、Get、Set\n \n  ```js\n  const cat = { \n    name: \"Jine\", \n    _year: 2020    // 私有属性\n  }\n\n  // 查看属性\n  var prop = Object.getOwnPropertyDescriptor(cat, \"name\")\n\n  // 设置数据属性\n  Object.defineProperty(cat, 'name', {\n    writable: false,\n    value: 'Trump'\n  })\n\n  // 设置访问器属性\n  Object.defineProperty(dog, 'year', {\n    get: function () {\n        return this._year\n    },\n    set: function (newVal) {\n        this._year = newVal\n    }\n  })\n\n  // 初始化对象属性值\n  var person = {\n    _name: 'Jack',\n    get name() { \n      return this._name + \"_s\"\n    },\n    set name(n) { \n      this._name = n \n    }\n  }\n  person.name = 'Lisa';\n  console.log(person.name);  // Lisa_s\n  ```\n\n\n## 操作\n  ```js\n  var obj = { name: \"tom\", age: 20 }\n\n  // 获取\n  // 点操作后只能是属性名，有横杠时须去掉并把后面的首字母大写\n  var name = obj.name   \n   // 中括号中可放属性名或变量名  \n  var age = obj['age']  \n\n  // 修改\n  obj.name = \"新属性值\"  \n\n  // 方法\n  obj.say = function(){ console.log(1) }    \n\n  // 删除\n  delete obj.age          \n\n  // 判断类型\n  obj instanceof Object  \n\n  // 判断对象实例是否包含某个属性\n  obj.hasOwnProperty(\"name\")\n\n  // 判断对象实例及其原型中是否包含某个属性\n  \"name\" in obj\n\n  //判断`obj`是否为空\n  function isEmptyObject(obj){  \n    if(!obj || typeof obj !== 'object' || Array.isArray(obj)){\n        return false\n    }\n    return ! Object.keys(obj).length\n  }\n  ```\n\n\n## 原型链\n\n<div style=\"text-indent: 2em\">每个对象都会在其内部初始化一个属性，就是 prototype (原型)，当我们访问一个对象的属性时，如果这个对象内部没有这个属性则去 prototype 里找这个属性，这个 prototype 又会有自己的 prototype，直到 null 结束，如果没有则返回undefined，这就是原型链的运行原理，即查找顺序：`实例对象 obj --> 原型对象 fn.prototype --> Object.prototype -->  null`</div>\n\n  1. 相互关系：`obj.constructor.prototype = obj.__proto__`\n  2. 函数对象：通过 new Function() 创建都是函数对象，其他的都是普通对象。每个对象都有 `__proto__` 属性指向原型对象，但只有函数对象才有 `prototype` 属性\n  3. 原型对象：一个普通对象。所有的原型对象都会自动获得一个指向其构造函数的指针 `constructor`，构造函数通过 `prototype` 属性指向它的原型对象，可以说 原型对象 `Person.prototype` 就是构造函数 `Person` 的一个实例\n  3. 原型链继承：利用原型让一个引用类型继承另一个引用类型的属性和方法，即让原型对象等于另一个类型的实例，这样就可以通过 `__proto__` 属性构成实例与原型的链条, 从而实现继承。\n\n \n  ```js\n  function Person(name){\n      this.name = name;   \n  }\n  Person.prototype.say = function(){\n      console.log(1);\n  }\n  function Son(name){\n      Person.call(this, name);\n  }\n  var s1 = new Son(\"son1\");\n  var s2 = new Son(\"son2\");\n  console.log(s1.__proto__ == s2.__proto__)\n  ```\n\n\n## 序列化\n<div style=\"text-indent: 2em\">JSON 是一种轻量级的数据交互方式，可以存储和传输数据而显示更丰富的信息，一般作为前后端交互的数据格式。</div>\n\n  ```js\n  // json 对象转为字符串\n  var json_1 = { name: \"tom\", age: 18 }\n  var strJson = JSON.stringify(json)\n\n\n  // json 字符串转为对象\n  var strJson = '{ name: \"tom\", age: 18 }'\n  var json_2 = eval('(' +strJson+ ')');   // 不建议使用\n  var json_3 = JSON.parse(strJson)        // 接近 W3C 标准\n  ```\n\n\n## 类数组对象\n<div style=\"text-indent: 2em\">拥有一个length属性和若干索引属性的对象，常见的有 `arguments、document.forms、document.getElementsByClassName`。arguments 是函数中自动创建的一种类数组对象，用来模拟函数重载效果（根据传入参数个数执行不同函数）。</div>\n\n  ```js\n  // 转换为数组\n  var arrayLike = { '0' : 'a','1' : 'b', length : 3 };\n  var arr1 = Array.prototype.slice.call(arrayLike);\n  var arr2 = [].slice.call(arrayLike);\n  var arr3 = Array.from(arrayLike);\n\n  // arguments 重载\n  var checkout = function(){\n    　　if(arguments.length==0){\n    　　　　console.log(\"微信\");\n    　　}else if(arguments.length==1){\n    　　　　console.log(\"现金\");\n    　　}else{\n    　　　　console.log(\"刷卡\");\n    　　}\n  }\n  checkout();      // 微信\n  checkout(100);   // 现金\n  checkout(1, 2);  // 刷卡\n  ```\n\n\n\n# 三、数组\n> 一组数据的有序集合，表现形式是内存中的一段连续的内存地址\n\n## 创建\n  ```js\n  // 直接创建 \n  var arr = []            // 空数组\n  var arr2 = [1, 2, 3]    // 三个元素\n\n  // 通过构造函数\n  var arr1 = new Array()    // 空数组\n  var arr2 = new Array(10)    // 长度为10 \n  var arr3 =  new Array(1, 2)   // 两个元素\n\n  // 数组中是否存在下标为 1 的元素\n  1 in arr \n  ```\n\n## 拷贝\n  * 浅拷贝\n    * `arr.slice(0)、arr.concat()`\n    * 如果数组元素都是基本类型，原始数组和目标数组的修改互不影响\n    * 如果数组元素是对象或数组，这样会只拷贝引用而导致修改时相互影响\n  * 深拷贝\n    * `JSON.parse(JSON.stringify(arr))`\n    * 不论数组元素是什么类型，原始数组和目标数组的修改都会互不影响\n\n\n  ```js\n  // 浅拷贝\n  var shallowCopy = function (obj) { \n    if (typeof obj !== 'object') return; \n    var newObj = obj instanceof Array ? [] : {}; \n    for (var key in obj) {\n      if (obj.hasOwnProperty(key)) {\n        newObj[key] = obj[key];\n      }\n    }\n    return newObj;\n  }\n\n  // 深拷贝\n  var deepCopy = function(obj) {\n    if (typeof obj !== 'object') return;\n    var newObj = obj instanceof Array ? [] : {};\n    for (var key in obj) {\n      if (obj.hasOwnProperty(key)) {\n        newObj[key] = typeof obj[key] === 'object' ? deepCopy(obj[key]) : obj[key];\n      }\n    }\n    return newObj;\n  }\n  ```\n\n\n## 特殊数组\n  * 多维数组：元素是数组\n  * 稀疏数组：索引不连续，length值大于实际元素个数\n\n\n  ```js\n  // 二维数组\n  var arr = [ [1, 2], [1, ‘good’] ]\n  console.log(arr[0][0])\n\n  // 稀疏数组\n  var arr = [];\n  arr[20] = \"hello\";\n  ```\n\n\n## 操作方法\n  1. 基础\n    * 读写：`索引/属性`\n    * 添加：`arr[index] = new`\n    * 删除：`delete arr[index]`\n    * 遍历：`for`\n  2. ES3\n    * 添加：`push、unshift、concat`\n    * 删除：`pop、shift`\n    * 裁剪：`slice、splice`\n    * 排序：`sort、reverse`\n    * 转换：`join、toString`\n  3. ES5\n    * 位置：`indexOf、lastIndexOf`\n    * 迭代：`every、some、filter、forEach、map`\n    * 累计：`reduce`\n\n\n  ```js\n  // 元素读写\n  var arr = [2, 1, 3]\n  consloe.log(arr.length)\n  consloe.log(arr[0])\n\n  arr[1] = 1\n  arr[-1.23] = true  // 超出范围时就不是索引，而是属性\n\n\n  // 判断是否数组\n  Array.isArray(arr)   \n  arr instanceof Array\n  arr.constructor === Array\n  arr.prototype.toString.apply([Array])\n\n  // 判断元素         \n  arr.every(function(item){\n      return item &gt; 5\n  }) \n\n  // 排序\n\tarr.sort(function(a, b){ \n      return a-b\n  })\n\n  // 遍历\n  arr.forEach(function(value, index, arr){ })\n\n  // 映射返回新数组，原数组不改变\n  arr.map(function(value, index, arr){ \n      return value * 2    \n  })\n  arr.map(item => item + 10)\n\n  // 过滤不符合条件的元素\n  arr.filter(function(value, index){ \n      return value % 2 !== 0\n  })          \n  \n  // 累计\n  arr.reduce(function(x, y){ \n      return x + y\n  })\n  ```\n\n\n## 扩展方法\n\n### 求最值\n  ```js\n  // 最大值\n  Math.max(...arr)\n  Math.max.apply(null, arr)\n\n  // 最小值\n  Math.min(...arr)\n  Math.min.apply(null, arr)\n  ```\n\n### 数组去重\n  ```js\n  // ES6 Set 有元素唯一的特性\n  [...new Set(arr)]  \n  Array.from(new Set(arr))\n\n  // 添加原型方法\n  Array.prototype.distinct = function (){\n      var arr = this,\n          result = [],\n          len = arr.length;\n\n      arr.forEach(function(v, i ,arr){   \n          var bool = arr.indexOf(v, i+1);   \n          if(bool === -1){\n              result.push(v);\n          }\n      })\n      return result;\n  };\n  arr.distinct()\n\n  // 普通封装\n  function arry_unique(array){\n      var res = [];\n      var json = {};\n      for(var i = 0; i &lt; array.length; i++){\n          if(!json[array[i]]){\n              res.push(array[i]);\n              json[array[i]] = 1;\n          }\n      }\n      return res;\n  }\n  ```\n\n\n### 数据过滤\n  ```js\n  export const filterArr = items => {\n      return items.filter(function (item) {\n          // 遍历 item 对象里面的键值是否符合回调函数的测试\n          return Object.keys(item).some(function (key) {\n              return String(item[key]).toLowerCase().match(searchVal)\n          })\n      })\n  }\n  ```\n \n\n# 四、Base64\n> 基于 64 个可打印字符 `A-Z、a-z、0-9、+、/` 来表示二进制数据的一种方法\n\n## 产生\n  * 需求\n    * 网络传输中文时容易出现乱码情况\n    * 网络传输图片等文件的字符并不全是可打印的字符\n    * 电子邮件早期只能传输英文，中文字符不能被服务器处理\n  * 适用场景\n    * 当访问外部资源很麻烦或受限时\n    * 当图片的体积太小，占用一个 HTTP 会话不是很值得时\n    * 当图片是在服务器端用程序动态生成，各个访问用户显示不同时\n  * 图片应用\n    * 主流浏览器都支持基于 Base64 编码的 dataURL 字符串 作为图片地址，[图片在线转码](http://imgbase64.duoshitong.com/) \n    * 图片上传服务器时需要纯字符串形式，截取 data:image/png;base64, 后面的字符串即可上传\n\n\n## 编码\n> 一种将二进制序列的数据转换为字符串的编码算法，只是无法直接看到明文但并非加密\n\n  * 理解\n    * 字节 byte 是存储二进制数据的基本单位\n    * 中文有 utf-8、gbk 等多种编码，不同编码对应的结果都不一样\n    * 对于图片、文本和音视频等数据，只有转换为 二进制序列 之后才能进行 Base64 编码\n    * 编码后的数据体积一般会变大，而且 base64Url 形式的图片不会被浏览器缓存，每次访问这样页面时都被下载一次，所以不适合被大量使用\n  * 规则\n    1. 将每三个字节作为一组，一共是 24 个二进制位\n    2. 将 24 个二进制位分为四组，每个组有 6 个二进制位\n    3. 在每组前面加两个00，扩展为 32 个二进制位，即 4 个字节\n    4. 根据 base64 编码对照表转换为扩展后的每个字节的对应字符\n\n\n## API\n\n### 浏览器原生实现\n  ```js \n  // 编码\n  window.btoa('xiaomabuhei')  \n  // 解码\n  window.atob('eGlhb21hYnVoZWk=')          \n\n\n  // 中文编码时需要先进行 URI 组件编码\n  window.btoa(window.encodeURIComponent('小马不黑'))\n  window.decodeURIComponent(window.atob(baseStr))\n  ```\n\n### js 实现\n  ```js\n  var Base64 = {\n    _keyStr: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",\n\n    encode: function(input) {\n      var output = \"\";  \n      var chr1, chr2, chr3, enc1, enc2, enc3, enc4;  \n      var i = 0;  \n      input = Base64._utf8_encode(input);  \n      while (i &lt; input.length) {  \n          chr1 = input.charCodeAt(i++);  \n          chr2 = input.charCodeAt(i++);  \n          chr3 = input.charCodeAt(i++);  \n          enc1 = chr1 &gt;&gt; 2;  \n          enc2 = ((chr1 & 3) &lt;&lt; 4) | (chr2 &gt;&gt; 4);  \n          enc3 = ((chr2 & 15) &lt;&lt; 2) | (chr3 &gt;&gt; 6);  \n          enc4 = chr3 & 63;  \n          if (isNaN(chr2)) {  \n              enc3 = enc4 = 64;  \n          } else if (isNaN(chr3)) {  \n              enc4 = 64;  \n          }  \n          output = output +  \n          _keyStr.charAt(enc1) + _keyStr.charAt(enc2) +  \n          _keyStr.charAt(enc3) + _keyStr.charAt(enc4);  \n      }  \n      return output; \n    },\n\n    decode: function(input) {\n      var output = \"\";  \n      var chr1, chr2, chr3;  \n      var enc1, enc2, enc3, enc4;  \n      var i = 0;  \n      input = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");  \n      while (i &lt; input.length) {  \n          enc1 = _keyStr.indexOf(input.charAt(i++));  \n          enc2 = _keyStr.indexOf(input.charAt(i++));  \n          enc3 = _keyStr.indexOf(input.charAt(i++));  \n          enc4 = _keyStr.indexOf(input.charAt(i++));  \n          chr1 = (enc1 &lt;&lt; 2) | (enc2 &gt;&gt; 4);  \n          chr2 = ((enc2 & 15) &lt;&lt; 4) | (enc3 &gt;&gt; 2);  \n          chr3 = ((enc3 & 3) &lt;&lt; 6) | enc4;  \n          output = output + String.fromCharCode(chr1);  \n          if (enc3 != 64) {  \n              output = output + String.fromCharCode(chr2);  \n          }  \n          if (enc4 != 64) {  \n              output = output + String.fromCharCode(chr3);  \n          }  \n      }  \n      output = Base64._utf8_decode(output);  \n      return output;  \n    },\n\n    _utf8_encode: function(string) {\n      string = string.replace(/\\r\\n/g, \"\\n\");  \n      var utftext = \"\";  \n      for (var n = 0; n &lt; string.length; n++) {  \n          var c = string.charCodeAt(n);  \n          if (c &lt; 128) {  \n              utftext += String.fromCharCode(c);  \n          } else if((c &gt; 127) && (c &lt; 2048)) {  \n              utftext += String.fromCharCode((c &gt;&gt; 6) | 192);  \n              utftext += String.fromCharCode((c & 63) | 128);  \n          } else {  \n              utftext += String.fromCharCode((c &gt;&gt; 12) | 224);  \n              utftext += String.fromCharCode(((c &gt;&gt; 6) & 63) | 128);  \n              utftext += String.fromCharCode((c & 63) | 128);  \n          }  \n  \n      }  \n      return utftext; \n    },\n\n    _utf8_decode: function(e) {\n      var string = \"\";  \n      var i = 0;  \n      var c = c1 = c2 = 0;  \n      while ( i &lt; utftext.length ) {  \n          c = utftext.charCodeAt(i);  \n          if (c &lt; 128) {  \n              string += String.fromCharCode(c);  \n              i++;  \n          } else if((c &gt; 191) && (c &lt; 224)) {  \n              c2 = utftext.charCodeAt(i+1);  \n              string += String.fromCharCode(((c & 31) &lt;&lt; 6) | (c2 & 63));  \n              i += 2;  \n          } else {  \n              c2 = utftext.charCodeAt(i+1);  \n              c3 = utftext.charCodeAt(i+2);  \n              string += String.fromCharCode(((c & 15) &lt;&lt; 12) | ((c2 & 63) &lt;&lt; 6) | (c3 & 63));  \n              i += 3;  \n          }  \n      }  \n      return string;\n    }\n  }\n  ```\n\n\n## 图片转换\n> 将网络或本地图片的地址转为 base64 格式\n\n### canvas\n\n  ```js\n  function getBase64Img(img) {\n      var canvas = document.createElement(\"canvas\");\n      canvas.width = img.width;\n      canvas.height = img.height;\n      var ctx = canvas.getContext(\"2d\");\n      ctx.drawImage(img, 0, 0, img.width, img.height);\n      var ext = img.src.substring(img.src.lastIndexOf(\".\") + 1).toLowerCase();\n      var dataURL = canvas.toDataURL(\"image/\" + ext);\n      return dataURL;\n  }\n  // Base64 字符串转二进制\n  function base64ToBlob(dataurl) {\n\n      // 去头并转为 byte\n      var arr = dataurl.split(',');\n\n      // 处理异常：将 ASCII 码小于0的转换为大于0\n      var mime = arr[0].match(/:(.*?);/)[1];\n\n      // 解码\n      var bytes = window.atob(arr[1]);\n      var n = bytes.length;\n\n      // 生成视图（直接针对内存）：8位无符号整数，长度1个字节\n      var u8arr = new Uint8Array(n);\n\n      while (n--) {\n          u8arr[n] = bytes.charCodeAt(n);\n      }\n      return new Blob([u8arr], { type: mime });\n  }\n  \n  var image = new Image();\n  image.src = \"img_url\";\n  image.onload = function() {\n      var base64 = getBase64Img(image);\n      var file = base64ToBlob(base64);\n  }\n\n\n  function getBase64Image(url, quality = 0.5) {\n      const img = new Image();\n      img.src = url\n      \n      return new Promise(resolve => {\n          img.onload = () => {\n              const canvas = document.createElement(\"canvas\");\n              canvas.width = img.width;\n              canvas.height = img.height;\n              const ctx = canvas.getContext(\"2d\");\n\n              ctx.drawImage(img, 0, 0, img.width, img.height);\n              dataURL = canvas.toDataURL('image/jpeg', quality);\n              resolve(dataURL)\n          }\n      })\n  }\n  getBase64Image(\"./pic.png\", 0.8).then(dataURL => {\n      console.log(dataURL)\n      document.querySelector('img').src = dataURL\n  })\n  ```\n\n\n### html2canvas\n> 截图功能：将 html 页面转化为图片\n\n  ```js\n  html2canvas(document.querySelector('img'), {useCORS: true}).then(canvas => {\n      var base64 = canvas.toDataURL(\"image/jpeg\", 0.1);\n      document.body.appendChild(canvas);\n      // downloadImg(base64, \"meme.png\")  // 下载图片\n  })\n  function downloadImg(base64, imgName) {\n      var a = document.createElement(\"a\");\n      a.href = base64;\n      a.download = imgName;\n      a.click();\n  }\n  ```\n\n\n### Node.js\n  ```js\n  // 通过 fs.readFile\n  const fs = require('fs');\n  fs.readFile('./a.png', 'base64', (err, data) => {\n      // 图片需要在 data 前添加 'data:image/png;base64,'\n      console.log(data)\n  })\n\n\n  // 通过 fs.createReadStream\n  var fs = require('fs');\n  var readStream = fs.createReadStream('./pic.png');\n\n  readStream.on('data', function (chunk) {\n      console.log(chunk.toString('base64')) \n  })\n  ```\n\n\n### Buffer\n  ```js\n  let base64 = Buffer.from('把我转化为base64').toString('base64')\n  console.log(base64)\n  ```\n\n\n\n# 五、二进制对象\n<div style=\"text-indent: 2em\">js 最初无法处理文件、网络流等二进制 (编码格式的) 数据，只能先使用 charCodeAt() 逐字节读取 或者 转换为 Base64 格式，但是处理速度慢而且容易出错。js 后来通过引入 API 逐渐可以处理二进制数据，但是标准库里没有相关内容，所以 NodeJs 就自己搞了一套，现在 Web 自己也搞起来了，这就导致了 Web 环境和 Node 环境里的二进制内容处理方式有些不同。</div> \n\n## 通用\n<div style=\"text-indent: 2em\">`ArrayBuffer 对象` 表示内存中存储了一段二进制数据的原始缓冲区，它不能直接读写，只能通过 `TypedArray/DataView 视图` 转换为类型化数组之后来读写。同一段内存的不同数据有不同的读取方式，对应不同的视图。视图的作用是以指定格式读写二进制数据但本身并不存储，本质是二进制数据的抽象数据结构，两种视图的区别在于字节序，TypedArray 视图的数组成员都是同一个数据类型，DataView 视图的数组成员可以是不同的数据类型。。</div> \n\n### ArrayBuffer\n> 用于存储二进制数据，本质是一串数字组成的乱码但没有格式，不能直接被访问\n\n  ```js\n  // 创建一个 8 字节的缓冲区对象\n  let buffer = new ArrayBuffer(8);\n\n  // 字节长度 8\n  console.log(buffer.byteLength);   \n\n  // 参数是否为视图实例\n  ArrayBuffer.isView(buffer) \n\n  // 裁剪缓冲区\n  let buffer1 = buffer.slice(0, 1)  \n  ```\n\n\n### TypedArray\n> 成员为相同的数据类型\n\n  * 本质：一组类的统称，它们的实例都是类数组对象\n  * 语法：和普通数组语法相同，但是其元素的数据类型相同而且没有空位\n  * API：\n    * 有符号整数：Int8Array、Int16Array、Int32Array\n    * 无符号整数：Uint8Array、Uint16Array、Uint32Array\n    * 浮点数：Float32Array、Float64Array\n \n  ```js\n  // 直接生成视图，默认生成底层 ArrayBuffer 实例并赋值\n  var f = new Float64Array(8)\n\n  // 通过 buffer 生成视图，默认全部内容，参数为 buffer、开始索引、长度\n  let buffer = new ArrayBuffer(4);\n  let a = new Int8Array(buffer)   \n  var b = new Uint32Array(buffer, 0, 1)\n  var c = new Uint8Array(buffer, 1, 1)\n\n  // 操作视图元素\n  for (var i=0; i &lt; f.byteLength; i++){ }\n  f[1] = 10        // [0, 10]\n\n  // 与普通数组互转\n  var arr = Array.from(f) \n  arr_2 = Array.apply([], t)\n  var u = new Uint8Array([ 1, 2, 3 ])\n\n  // 与字符串互转\n  var str = String.fromCharCode.apply(null, buffer)\n  function strToBuf (str) {\n    // 每个字符占用2个字节\n    var buf = new ArrayBuffer(str.length*2)\n    var bufView = new Uint16Array(buf)\n    for(var i=0; i &lt; str.length; i++){\n        bufView[i] = str.charCodeAt(i)\n    }\n      return bufView;\n  }\n  ```\n\n### DataView \n> TypedArray 的强化版，成员可以是不同的数据类型，而且读写时可以自行设定 大/小 端字节序\n \n  ```js\n  let buffer = new ArrayBuffer(4)\n  let dataView = new DataView(buffer)\n\n  // 独有方法，写入参数是 开始位置、写入数据、大/小端读取\n  dataView.getInt8(0)\n  dataView.setInt8(0, 10)\n  dataView.setInt32(0, 25, false) \n  ```\n\n## web 环境特有\n\n### Blob \n> 表示一个不可变的文件对象，它提供了一系列操作文件的接口\n\n  1. 创建方式\n    * 构造函数：`new Blob(dataArr, options)`\n      * dataArr：必选数组，数组成员可以是二进制对象或字符串\n      * options：可选对象，用于设置数组中数据的 MIME 类型\n    * slice 方法：`blob.slice(start, end, contentType)` \n      * 从已有的 Blob 对象调用 slice 接口切出一个新的 Blob 对象\n      * contentType：可选，规定新 Blob 对象的类型\n    * canvas 对象：`canvas.toBlob(callback, type, options)`\n      * 把当前绘制信息转为一个 Blob 对象\n  2. 属性与方法\n    * 属性\n      * size：对象的字节长度\n      * type：对象的数据类型 \n      * isClosed: 该对象是否调用过 close()\n    * 方法\n      * close：释放对象\n      * slice：裁剪并返回新对象\n  \n  ```js\n  // String 转为 Blob\n  var blob = new Blob([\"Hello World\"], {type:\"text/plain\"});\n\n  // ArrayBuffer 转为 Blob\n  var buffer = new ArrayBuffer(8)\n  var blob = new Blob([buffer], {type:\"text/plain\"});\n\n  // TypeArray 转为 Blob\n  var uArr = new Uint16Array([97, 32, 72, 100]);\n  var blob = new Blob([uArr]);\n\n  let blob = blob_2.slice(1, 5);\n\n  var canvas = document.getElementById(\"canvas\");\n  canvas.toBlob(function(blob){\n     console.log(blob);\n  })\n  ```\n\n\n### Blob 派生对象\n> blob 对象是它们的底层对象，它们都是继承 blob 对象并进行了扩展，但其内容一样无法修改\n\n#### File 对象\n  * 功能：保存文件的相关信息并允许 Js 访问\n  * 分类\n    * input 元素上选择文件后返回的 FileList 对象 \n    * 普通元素被自由拖拽时返回的 DataTransfer 对象\n    * HTMLCanvasElement 上执行 mozGetAsFile() 方法后返回的结果\n\n#### FileReader 对象 \n  * 功能：提供异步读取文件内容或二进制数据的接口\n  * 保存：读取的文件内容会被保存到 result 属性中\n  * 异步读取\n    * readAsText(file, encoding)：返回 纯文本。encoding 指定编码格式（默认 'UTF-8'）\n    * readAsDataURL(file)：返回 基于 Base64 编码的 dataURL 字符串（读取图像时常用）\n    * readAsBinaryString(file)：返回 文件的原始二进制字符串（每个字符表示一字节）\n    * readAsArrayBuffer(file)：返回 包含文件内容的 ArrayBuffer 对象\n  * 中止读取：abort() \n  * 回调函数\n    * onload：成功时\n    * onerror：出错时\n    * onprogress：更新时\n    * onloadstart：开始时\n    * onloadend：完成时\n    * onabort：中止时\n\n#### URL 对象\n  * 功能：通过内存文件创建出一个临时指向 File/Blob 对象的 url\n  * 静态方法\n    * createObjectURL：生成\n    * revokeObjectURL：释放\n  * 注意事项\n    * 网页一旦刷新或关闭，已生成的 url 就会失效\n    * 同样的 blob 在不同的事件调用中会得到不同 url\n\n\n  ```js\n  // 选择文件后获取文件信息\n  var fileInput = document.querySelector(\"#fileInput\");\n\n  fileInput.addEventListener(\"change\", function (event) {\n      var fileList = fileInput.files\n      var file = fileList[0];\n      console.log(file.name, file.size)\n  }, false)\n\n  // 拖动结束时获取被拖动的数据\n  var box = document.getElementById(\"#box\");\n  box.ondrop = function(event){\n      // 拖动的默认处理方式是在新窗口打开\n      event.preventDefault()    \n\n      console.log(event.dataTransfer.files)\n  }\n\n  // 获取文件二进制数据\n  var reader = new FileReader();\n  reader.readAsArrayBuffer(file);\n\n  reder.onprogress = function(e){ \n    console.log(reader.result)  \n    console.log(e.target.result)\n  }\n  reader.onload = function (e) { \n    console.log(reader.result)  \n    console.log(e.target.result)\n  }\n\n  // 在网页插入图片\n  var img = document.createElement(\"img\");\n  img.src = window.URL.createObjectURL(file);\n  img.width = 60;\n  img.onload = function(e) {\n      window.URL.revokeObjectURL(this.src);\n  }\n  document.body.appendChild(img);\n  ```\n\n \n## Node 环境特有\n\n### Buffer   \n  <div style=\"text-indent: 2em;\">Buffer 表示 V8 堆内存之外的一块原始内存，并不会占用 NodeJS 进程内存，常用来存储需要占用大量内存的数据。它继承于 Uint8Array 并实现了更多的接口，对象中的每个元素储存着 2 位 16 进制的数据，代表内存的一个字节。注意一个 Buffer 对象的大小在创建时就会固定下来，即创建之后不可改变。</div>\n\n  * 创建\n    * new Buffer：已经弃用\n    * __Buffer.from__：参数可为 string、buffer、array、object\n    * __Buffer.alloc__：指定大小并已经初始化数据\n    * __Buffer.allocUnsafe__：指定大小但并不初始化数据\n  * 读写\n    * __buf.writexxx__：写入缓冲区\n    * __buf.readxxx__：读取数据\n  * 转换\n    * __buf.toString__：转为字符串\n    * __buf.toJSON__：转为 json\n  * 判断\n    * __Buffer.isEncoding__：编码格式\n    * __Buffer.isBuffer__：对象是否为 Buffer\n  * 其它 \n    * __buf.length__：返回字节数\n    * __buf.indexOf__：返回位置\n    * __buf.compare__：对象比较\n    * __buf.fill__：填充数据\n    * __buf.slice__：裁剪\n    * __buf.copy__：拷贝\n    \n\n  ```js\n  // 创建 \n  const buf_1 = Buffer.from([0x62, 0x75, 0x66, 0x66]);\n  const buf = Buffer.from(\"hello\")   // 编码格式默认 utf8 \n  console.log(buf.length)\n\n  const buf_2 = Buffer.alloc(5);       // 不做任何处理就是 0 填充\n  const buf = Buffer.alloc(5, 'a');  // 以 a 填充\n  const buf = Buffer.alloc(10, 'aGVsbG8gd29ybGQ=', 'base64');  // 以 base64 格式填充\n\n  const buf = Buffer.allocUnsafe(10);  // 只有一个参数\n\n  // 拼接\n  let buf_3 = Buffer.concat([buf_1, buf_2])\n\n  // 裁剪\n  var buf_2 = buf_1.slice(0, 5);\n\n  // 拷贝\n  buf_2.copy(buf_1, 2);\n\n  // 比较\n  var result = buf_1.compare(buf_2);\n\n  // 读写\n  var value = buf.readInt32LE(0)\n  buf.writeFloatLE(3. 16, 0)\n\n  // buffer 转字符串\n  const buf = Buffer.from('test')\n  buf.toString('utf8')             // test\n  buf.toString('utf8', 0, 2)       // te\n\n  // buffer 转 json\n  buf.toJSON()\n\n  // stream 转 buffer\n  function streamToBuffer(stream) {  \n      return new Promise((resolve, reject) => {\n          let buffers = [];\n          stream.on('error', reject);\n          stream.on('data', (data) => buffers.push(data))\n          stream.on('end', () => resolve(Buffer.concat(buffers))\n      })\n  }\n\n  // buffer 转 stream\n  let Duplex = require('stream').Duplex;\n\n  function bufferToStream(buffer) {  \n      let stream = new Duplex();\n      stream.push(buffer);\n      stream.push(null);\n      return stream;\n  }\n  ```\n \n        \n        \n","slug":"8-js数据","published":1,"updated":"2019-04-18T15:20:11.051Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvid4pn0002b0nbxabsfspwh","content":"<!-- build time:Sat May 11 2019 01:36:59 GMT+0800 (中国标准时间) --><html><head></head><body><h1 id=\"一、字符串\"><a href=\"#一、字符串\" class=\"headerlink\" title=\"一、字符串\"></a>一、字符串</h1><blockquote><p>用于存储和处理文本，可看作类数组</p></blockquote><h2 id=\"创建\"><a href=\"#创建\" class=\"headerlink\" title=\"创建\"></a>创建</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> str_1 = <span class=\"string\">'hello'</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> str_2 = <span class=\"built_in\">String</span>(<span class=\"string\">'123'</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> str_3 = <span class=\"keyword\">new</span> <span class=\"built_in\">String</span>(<span class=\"string\">'hello str'</span>)</span><br></pre></td></tr></tbody></table></figure><h2 id=\"属性\"><a href=\"#属性\" class=\"headerlink\" title=\"属性\"></a>属性</h2><ul><li>length：长度</li><li>prototype：原型属性，保存当前对象的原型对象</li><li>constructor：引用属性，保存当前对象的构造函数</li></ul><h2 id=\"常用方法\"><a href=\"#常用方法\" class=\"headerlink\" title=\"常用方法\"></a>常用方法</h2><ul><li>字符索引：<code>charAt、indexOf</code></li><li>正则匹配：<code>match、search、replace</code></li><li>分割为数组：<code>split</code></li><li>字符串连接：<code>concat</code></li><li>裁剪字符串：<code>slice、substr、substring</code></li></ul><h2 id=\"扩展方法\"><a href=\"#扩展方法\" class=\"headerlink\" title=\"扩展方法\"></a>扩展方法</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 调用方式</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> eg1 = <span class=\"string\">\" ab \"</span>.trim();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 去除左边的空格</span></span><br><span class=\"line\"><span class=\"built_in\">String</span>.prototype.LTrim = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.replace(<span class=\"regexp\">/(^\\s*)/g</span>, <span class=\"string\">\"\"</span>);</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 去除右边的空格</span></span><br><span class=\"line\"><span class=\"built_in\">String</span>.prototype.Rtrim = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.replace(<span class=\"regexp\">/(\\s*$)/g</span>, <span class=\"string\">\"\"</span>);</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//去除前后空格</span></span><br><span class=\"line\"><span class=\"built_in\">String</span>.prototype.Trim = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.replace(<span class=\"regexp\">/(^\\s*)|(\\s*$)/g</span>, <span class=\"string\">\"\"</span>);</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><p></p><h1 id=\"二、对象\"><a href=\"#二、对象\" class=\"headerlink\" title=\"二、对象\"></a>二、对象</h1><blockquote><p>由方法和属性作为键值对组成的一个无序集合。可看作是一个黑盒子，使用时只关注它的对外接口而不需要了解内部结构</p></blockquote><h2 id=\"分类\"><a href=\"#分类\" class=\"headerlink\" title=\"分类\"></a>分类</h2><ol><li>内部对象<div style=\"text-indent:2em\">包括<code>Array、Boolean、Date、Function、Global、Math、Number、Object、RegExp、String以及 Error、ReferenceError等各种错误类对象</code>。其中 <code>Global 和 Math</code> 这两个对象又被称为“内置对象”，这两个对象在脚本程序初始化时被创建，不必实例化这两个对象。</div></li><li>宿主对象<div style=\"text-indent:2em\">执行JS脚本的环境提供的对象。对于嵌入到网页中的JS来说，其宿主对象就是浏览器提供的对象，所以又称为浏览器对象，如<code>Window、Documen、Element、form、image</code>等。不同的浏览器提供的宿主对象可能不同，即使提供的对象相同，其实现方式也大相径庭，这也带来了浏览器兼容问题，增加开发难度。</div></li><li>自定义对象<div style=\"text-indent:2em\">开发人员自己定义的对象，用于扩展 JS 应用和功能。</div></li></ol><h2 id=\"创建-1\"><a href=\"#创建-1\" class=\"headerlink\" title=\"创建\"></a>创建</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1、字面量创建</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> p1 = {</span><br><span class=\"line\">        name: <span class=\"string\">\"lisa\"</span>,</span><br><span class=\"line\">        say: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"><span class=\"comment\">// 报错, null / \"\" 都可以</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = { <span class=\"string\">\"name\"</span>: None }  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2、Object.create 将对象继承到 __proto__ 属性上</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> p2 = <span class=\"built_in\">Object</span>.create({ <span class=\"attr\">x</span>: <span class=\"number\">1</span> })</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(p2.__proto__)   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3、new 继承构造函数的属性</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 创建系统内置对象</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> p3 = <span class=\"keyword\">new</span> <span class=\"built_in\">Object</span>({ <span class=\"attr\">x</span>: <span class=\"number\">1</span> })  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(p3) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>();</span><br><span class=\"line\"><span class=\"keyword\">var</span> date = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\"><span class=\"keyword\">var</span> exp = <span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(<span class=\"string\">\"ys\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 创建自定义对象 </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name, age</span>)</span>{</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">var</span> p4 = <span class=\"keyword\">new</span> Person(<span class=\"string\">\"tom\"</span>);</span><br></pre></td></tr></tbody></table></figure><h2 id=\"拷贝\"><a href=\"#拷贝\" class=\"headerlink\" title=\"拷贝\"></a>拷贝</h2><ul><li><strong>赋值</strong><ul><li><code>=、new Object</code></li><li>原始对象和目标对象指向同一内存地址，任何修改都会相互影响</li></ul></li><li><strong>浅拷贝</strong><ul><li><code>Object.assign / $.extend (target, [objN])</code></li><li>只有目标对象的内层对象修改时才会影响原始对象</li></ul></li><li><p><strong>深拷贝</strong></p><ul><li><code>for in / JSON.parse(JSON.stringify(obj)) / $.extend(true, target, [objN])</code></li><li>目标对象的任何修改都不会影响到原始对象</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 赋值</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = { <span class=\"attr\">age</span>: <span class=\"number\">18</span> };</span><br><span class=\"line\"><span class=\"keyword\">var</span> _obj = obj;</span><br><span class=\"line\">_obj.age = <span class=\"number\">20</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(obj.age, _obj.age); <span class=\"comment\">// 20 20</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 浅拷贝</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> boy = {</span><br><span class=\"line\">  age: <span class=\"number\">18</span>,</span><br><span class=\"line\">  address: { <span class=\"attr\">home</span>: <span class=\"string\">'北京'</span> }</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">var</span> _boy = <span class=\"built_in\">Object</span>.assign({}, boy);</span><br><span class=\"line\">_boy.age = <span class=\"number\">20</span>;</span><br><span class=\"line\">_boy.address.home = <span class=\"string\">\"上海\"</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(boy.age, _boy.age);   <span class=\"comment\">// 18 20</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(boy.address.home, _boy.address.home); <span class=\"comment\">// 上海 上海</span></span><br></pre></td></tr></tbody></table></figure></li></ul><h2 id=\"属性-1\"><a href=\"#属性-1\" class=\"headerlink\" title=\"属性\"></a>属性</h2><ul><li><strong>数据属性</strong>：包含一个数据值的位置，用于读取和写入值<ul><li>Configurable：配置，表示能否删除</li><li>Enumerable：枚举，表示能否通过 for-in 循环</li><li>Writable：可写，表示能否修改属性值</li><li>Value：属性的数据值，表示读写属性值的位置</li></ul></li><li><p><strong>访问器属性</strong></p><ul><li>即存取器属性，是一组获取和设置值的函数</li><li>设置 get/set 特性之后，属性就会变成访问器属性</li><li>不能直接定义，必须使用 Object.defineProperty() 来定义</li><li>分类：Configurable、Enumerable、Get、Set</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> cat = { </span><br><span class=\"line\">  name: <span class=\"string\">\"Jine\"</span>, </span><br><span class=\"line\">  _year: <span class=\"number\">2020</span>    <span class=\"comment\">// 私有属性</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 查看属性</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> prop = <span class=\"built_in\">Object</span>.getOwnPropertyDescriptor(cat, <span class=\"string\">\"name\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 设置数据属性</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(cat, <span class=\"string\">'name'</span>, {</span><br><span class=\"line\">  writable: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  value: <span class=\"string\">'Trump'</span></span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 设置访问器属性</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(dog, <span class=\"string\">'year'</span>, {</span><br><span class=\"line\">  <span class=\"keyword\">get</span>: function () {</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>._year</span><br><span class=\"line\">  },</span><br><span class=\"line\">  <span class=\"keyword\">set</span>: function (newVal) {</span><br><span class=\"line\">      <span class=\"keyword\">this</span>._year = newVal</span><br><span class=\"line\">  }</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 初始化对象属性值</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> person = {</span><br><span class=\"line\">  _name: <span class=\"string\">'Jack'</span>,</span><br><span class=\"line\">  <span class=\"keyword\">get</span> name() { </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>._name + <span class=\"string\">\"_s\"</span></span><br><span class=\"line\">  },</span><br><span class=\"line\">  <span class=\"keyword\">set</span> name(n) { </span><br><span class=\"line\">    <span class=\"keyword\">this</span>._name = n </span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br><span class=\"line\">person.name = <span class=\"string\">'Lisa'</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(person.name);  <span class=\"comment\">// Lisa_s</span></span><br></pre></td></tr></tbody></table></figure></li></ul><h2 id=\"操作\"><a href=\"#操作\" class=\"headerlink\" title=\"操作\"></a>操作</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = { <span class=\"attr\">name</span>: <span class=\"string\">\"tom\"</span>, <span class=\"attr\">age</span>: <span class=\"number\">20</span> }</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 获取</span></span><br><span class=\"line\"><span class=\"comment\">// 点操作后只能是属性名，有横杠时须去掉并把后面的首字母大写</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> name = obj.name   </span><br><span class=\"line\"> <span class=\"comment\">// 中括号中可放属性名或变量名  </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> age = obj[<span class=\"string\">'age'</span>]  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 修改</span></span><br><span class=\"line\">obj.name = <span class=\"string\">\"新属性值\"</span>  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 方法</span></span><br><span class=\"line\">obj.say = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{ <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>) }    </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 删除</span></span><br><span class=\"line\"><span class=\"keyword\">delete</span> obj.age          </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 判断类型</span></span><br><span class=\"line\">obj <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Object</span>  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 判断对象实例是否包含某个属性</span></span><br><span class=\"line\">obj.hasOwnProperty(<span class=\"string\">\"name\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 判断对象实例及其原型中是否包含某个属性</span></span><br><span class=\"line\"><span class=\"string\">\"name\"</span> <span class=\"keyword\">in</span> obj</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//判断`obj`是否为空</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isEmptyObject</span>(<span class=\"params\">obj</span>)</span>{  </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(!obj || <span class=\"keyword\">typeof</span> obj !== <span class=\"string\">'object'</span> || <span class=\"built_in\">Array</span>.isArray(obj)){</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  }</span><br><span class=\"line\">  <span class=\"keyword\">return</span> ! <span class=\"built_in\">Object</span>.keys(obj).length</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"原型链\"><a href=\"#原型链\" class=\"headerlink\" title=\"原型链\"></a>原型链</h2><div style=\"text-indent:2em\">每个对象都会在其内部初始化一个属性，就是 prototype (原型)，当我们访问一个对象的属性时，如果这个对象内部没有这个属性则去 prototype 里找这个属性，这个 prototype 又会有自己的 prototype，直到 null 结束，如果没有则返回undefined，这就是原型链的运行原理，即查找顺序：<code>实例对象 obj --> 原型对象 fn.prototype --> Object.prototype --> null</code></div><ol><li>相互关系：<code>obj.constructor.prototype = obj.__proto__</code></li><li>函数对象：通过 new Function() 创建都是函数对象，其他的都是普通对象。每个对象都有 <code>__proto__</code> 属性指向原型对象，但只有函数对象才有 <code>prototype</code> 属性</li><li>原型对象：一个普通对象。所有的原型对象都会自动获得一个指向其构造函数的指针 <code>constructor</code>，构造函数通过 <code>prototype</code> 属性指向它的原型对象，可以说 原型对象 <code>Person.prototype</code> 就是构造函数 <code>Person</code> 的一个实例</li><li>原型链继承：利用原型让一个引用类型继承另一个引用类型的属性和方法，即让原型对象等于另一个类型的实例，这样就可以通过 <code>__proto__</code> 属性构成实例与原型的链条, 从而实现继承。</li></ol><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name</span>)</span>{</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;   </span><br><span class=\"line\">}</span><br><span class=\"line\">Person.prototype.say = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>);</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Son</span>(<span class=\"params\">name</span>)</span>{</span><br><span class=\"line\">    Person.call(<span class=\"keyword\">this</span>, name);</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"keyword\">var</span> s1 = <span class=\"keyword\">new</span> Son(<span class=\"string\">\"son1\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> s2 = <span class=\"keyword\">new</span> Son(<span class=\"string\">\"son2\"</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(s1.__proto__ == s2.__proto__)</span><br></pre></td></tr></tbody></table></figure><h2 id=\"序列化\"><a href=\"#序列化\" class=\"headerlink\" title=\"序列化\"></a>序列化</h2><div style=\"text-indent:2em\">JSON 是一种轻量级的数据交互方式，可以存储和传输数据而显示更丰富的信息，一般作为前后端交互的数据格式。</div><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// json 对象转为字符串</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> json_1 = { <span class=\"attr\">name</span>: <span class=\"string\">\"tom\"</span>, <span class=\"attr\">age</span>: <span class=\"number\">18</span> }</span><br><span class=\"line\"><span class=\"keyword\">var</span> strJson = <span class=\"built_in\">JSON</span>.stringify(json)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// json 字符串转为对象</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> strJson = <span class=\"string\">'{ name: \"tom\", age: 18 }'</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> json_2 = <span class=\"built_in\">eval</span>(<span class=\"string\">'('</span> +strJson+ <span class=\"string\">')'</span>);   <span class=\"comment\">// 不建议使用</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> json_3 = <span class=\"built_in\">JSON</span>.parse(strJson)        <span class=\"comment\">// 接近 W3C 标准</span></span><br></pre></td></tr></tbody></table></figure><h2 id=\"类数组对象\"><a href=\"#类数组对象\" class=\"headerlink\" title=\"类数组对象\"></a>类数组对象</h2><div style=\"text-indent:2em\">拥有一个length属性和若干索引属性的对象，常见的有 <code>arguments、document.forms、document.getElementsByClassName</code>。arguments 是函数中自动创建的一种类数组对象，用来模拟函数重载效果（根据传入参数个数执行不同函数）。</div><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 转换为数组</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arrayLike = { <span class=\"string\">'0'</span> : <span class=\"string\">'a'</span>,<span class=\"string\">'1'</span> : <span class=\"string\">'b'</span>, <span class=\"attr\">length</span> : <span class=\"number\">3</span> };</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr1 = <span class=\"built_in\">Array</span>.prototype.slice.call(arrayLike);</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr2 = [].slice.call(arrayLike);</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr3 = <span class=\"built_in\">Array</span>.from(arrayLike);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// arguments 重载</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> checkout = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">  　　<span class=\"keyword\">if</span>(<span class=\"built_in\">arguments</span>.length==<span class=\"number\">0</span>){</span><br><span class=\"line\">  　　　　<span class=\"built_in\">console</span>.log(<span class=\"string\">\"微信\"</span>);</span><br><span class=\"line\">  　　}<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"built_in\">arguments</span>.length==<span class=\"number\">1</span>){</span><br><span class=\"line\">  　　　　<span class=\"built_in\">console</span>.log(<span class=\"string\">\"现金\"</span>);</span><br><span class=\"line\">  　　}<span class=\"keyword\">else</span>{</span><br><span class=\"line\">  　　　　<span class=\"built_in\">console</span>.log(<span class=\"string\">\"刷卡\"</span>);</span><br><span class=\"line\">  　　}</span><br><span class=\"line\">}</span><br><span class=\"line\">checkout();      <span class=\"comment\">// 微信</span></span><br><span class=\"line\">checkout(<span class=\"number\">100</span>);   <span class=\"comment\">// 现金</span></span><br><span class=\"line\">checkout(<span class=\"number\">1</span>, <span class=\"number\">2</span>);  <span class=\"comment\">// 刷卡</span></span><br></pre></td></tr></tbody></table></figure><h1 id=\"三、数组\"><a href=\"#三、数组\" class=\"headerlink\" title=\"三、数组\"></a>三、数组</h1><blockquote><p>一组数据的有序集合，表现形式是内存中的一段连续的内存地址</p></blockquote><h2 id=\"创建-2\"><a href=\"#创建-2\" class=\"headerlink\" title=\"创建\"></a>创建</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 直接创建 </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = []            <span class=\"comment\">// 空数组</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr2 = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]    <span class=\"comment\">// 三个元素</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 通过构造函数</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr1 = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>()    <span class=\"comment\">// 空数组</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr2 = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>(<span class=\"number\">10</span>)    <span class=\"comment\">// 长度为10 </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr3 =  <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>(<span class=\"number\">1</span>, <span class=\"number\">2</span>)   <span class=\"comment\">// 两个元素</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 数组中是否存在下标为 1 的元素</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"keyword\">in</span> arr</span><br></pre></td></tr></tbody></table></figure><h2 id=\"拷贝-1\"><a href=\"#拷贝-1\" class=\"headerlink\" title=\"拷贝\"></a>拷贝</h2><ul><li>浅拷贝<ul><li><code>arr.slice(0)、arr.concat()</code></li><li>如果数组元素都是基本类型，原始数组和目标数组的修改互不影响</li><li>如果数组元素是对象或数组，这样会只拷贝引用而导致修改时相互影响</li></ul></li><li>深拷贝<ul><li><code>JSON.parse(JSON.stringify(arr))</code></li><li>不论数组元素是什么类型，原始数组和目标数组的修改都会互不影响</li></ul></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 浅拷贝</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> shallowCopy = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">obj</span>) </span>{ </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> obj !== <span class=\"string\">'object'</span>) <span class=\"keyword\">return</span>; </span><br><span class=\"line\">  <span class=\"keyword\">var</span> newObj = obj <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Array</span> ? [] : {}; </span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> key <span class=\"keyword\">in</span> obj) {</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (obj.hasOwnProperty(key)) {</span><br><span class=\"line\">      newObj[key] = obj[key];</span><br><span class=\"line\">    }</span><br><span class=\"line\">  }</span><br><span class=\"line\">  <span class=\"keyword\">return</span> newObj;</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 深拷贝</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> deepCopy = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">obj</span>) </span>{</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> obj !== <span class=\"string\">'object'</span>) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> newObj = obj <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Array</span> ? [] : {};</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> key <span class=\"keyword\">in</span> obj) {</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (obj.hasOwnProperty(key)) {</span><br><span class=\"line\">      newObj[key] = <span class=\"keyword\">typeof</span> obj[key] === <span class=\"string\">'object'</span> ? deepCopy(obj[key]) : obj[key];</span><br><span class=\"line\">    }</span><br><span class=\"line\">  }</span><br><span class=\"line\">  <span class=\"keyword\">return</span> newObj;</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"特殊数组\"><a href=\"#特殊数组\" class=\"headerlink\" title=\"特殊数组\"></a>特殊数组</h2><ul><li>多维数组：元素是数组</li><li>稀疏数组：索引不连续，length值大于实际元素个数</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 二维数组</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [ [<span class=\"number\">1</span>, <span class=\"number\">2</span>], [<span class=\"number\">1</span>, ‘good’] ]</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr[<span class=\"number\">0</span>][<span class=\"number\">0</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 稀疏数组</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [];</span><br><span class=\"line\">arr[<span class=\"number\">20</span>] = <span class=\"string\">\"hello\"</span>;</span><br></pre></td></tr></tbody></table></figure><h2 id=\"操作方法\"><a href=\"#操作方法\" class=\"headerlink\" title=\"操作方法\"></a>操作方法</h2><ol><li>基础<ul><li>读写：<code>索引/属性</code></li><li>添加：<code>arr[index] = new</code></li><li>删除：<code>delete arr[index]</code></li><li>遍历：<code>for</code></li></ul></li><li>ES3<ul><li>添加：<code>push、unshift、concat</code></li><li>删除：<code>pop、shift</code></li><li>裁剪：<code>slice、splice</code></li><li>排序：<code>sort、reverse</code></li><li>转换：<code>join、toString</code></li></ul></li><li>ES5<ul><li>位置：<code>indexOf、lastIndexOf</code></li><li>迭代：<code>every、some、filter、forEach、map</code></li><li>累计：<code>reduce</code></li></ul></li></ol><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">// 元素读写</span></span><br><span class=\"line\"> <span class=\"keyword\">var</span> arr = [<span class=\"number\">2</span>, <span class=\"number\">1</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\"> consloe.log(arr.length)</span><br><span class=\"line\"> consloe.log(arr[<span class=\"number\">0</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"> arr[<span class=\"number\">1</span>] = <span class=\"number\">1</span></span><br><span class=\"line\"> arr[<span class=\"number\">-1.23</span>] = <span class=\"literal\">true</span>  <span class=\"comment\">// 超出范围时就不是索引，而是属性</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">// 判断是否数组</span></span><br><span class=\"line\"> <span class=\"built_in\">Array</span>.isArray(arr)   </span><br><span class=\"line\"> arr <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Array</span></span><br><span class=\"line\"> arr.constructor === <span class=\"built_in\">Array</span></span><br><span class=\"line\"> arr.prototype.toString.apply([<span class=\"built_in\">Array</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">// 判断元素         </span></span><br><span class=\"line\"> arr.every(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">item</span>)</span>{</span><br><span class=\"line\">     <span class=\"keyword\">return</span> item &gt; <span class=\"number\">5</span></span><br><span class=\"line\"> }) </span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">// 排序</span></span><br><span class=\"line\">arr.sort(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a, b</span>)</span>{ </span><br><span class=\"line\">     <span class=\"keyword\">return</span> a-b</span><br><span class=\"line\"> })</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">// 遍历</span></span><br><span class=\"line\"> arr.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value, index, arr</span>)</span>{ })</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">// 映射返回新数组，原数组不改变</span></span><br><span class=\"line\"> arr.map(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value, index, arr</span>)</span>{ </span><br><span class=\"line\">     <span class=\"keyword\">return</span> value * <span class=\"number\">2</span>    </span><br><span class=\"line\"> })</span><br><span class=\"line\"> arr.map(<span class=\"function\"><span class=\"params\">item</span> =></span> item + <span class=\"number\">10</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">// 过滤不符合条件的元素</span></span><br><span class=\"line\"> arr.filter(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value, index</span>)</span>{ </span><br><span class=\"line\">     <span class=\"keyword\">return</span> value % <span class=\"number\">2</span> !== <span class=\"number\">0</span></span><br><span class=\"line\"> })          </span><br><span class=\"line\"> </span><br><span class=\"line\"> <span class=\"comment\">// 累计</span></span><br><span class=\"line\"> arr.reduce(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">x, y</span>)</span>{ </span><br><span class=\"line\">     <span class=\"keyword\">return</span> x + y</span><br><span class=\"line\"> })</span><br></pre></td></tr></tbody></table></figure><h2 id=\"扩展方法-1\"><a href=\"#扩展方法-1\" class=\"headerlink\" title=\"扩展方法\"></a>扩展方法</h2><h3 id=\"求最值\"><a href=\"#求最值\" class=\"headerlink\" title=\"求最值\"></a>求最值</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 最大值</span></span><br><span class=\"line\"><span class=\"built_in\">Math</span>.max(...arr)</span><br><span class=\"line\"><span class=\"built_in\">Math</span>.max.apply(<span class=\"literal\">null</span>, arr)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 最小值</span></span><br><span class=\"line\"><span class=\"built_in\">Math</span>.min(...arr)</span><br><span class=\"line\"><span class=\"built_in\">Math</span>.min.apply(<span class=\"literal\">null</span>, arr)</span><br></pre></td></tr></tbody></table></figure><h3 id=\"数组去重\"><a href=\"#数组去重\" class=\"headerlink\" title=\"数组去重\"></a>数组去重</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ES6 Set 有元素唯一的特性</span></span><br><span class=\"line\">[...new <span class=\"built_in\">Set</span>(arr)]  </span><br><span class=\"line\"><span class=\"built_in\">Array</span>.from(<span class=\"keyword\">new</span> <span class=\"built_in\">Set</span>(arr))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 添加原型方法</span></span><br><span class=\"line\"><span class=\"built_in\">Array</span>.prototype.distinct = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> arr = <span class=\"keyword\">this</span>,</span><br><span class=\"line\">        result = [],</span><br><span class=\"line\">        len = arr.length;</span><br><span class=\"line\"></span><br><span class=\"line\">    arr.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">v, i ,arr</span>)</span>{   </span><br><span class=\"line\">        <span class=\"keyword\">var</span> bool = arr.indexOf(v, i+<span class=\"number\">1</span>);   </span><br><span class=\"line\">        <span class=\"keyword\">if</span>(bool === <span class=\"number\">-1</span>){</span><br><span class=\"line\">            result.push(v);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    })</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">};</span><br><span class=\"line\">arr.distinct()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 普通封装</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">arry_unique</span>(<span class=\"params\">array</span>)</span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> res = [];</span><br><span class=\"line\">    <span class=\"keyword\">var</span> json = {};</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; array.length; i++){</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!json[array[i]]){</span><br><span class=\"line\">            res.push(array[i]);</span><br><span class=\"line\">            json[array[i]] = <span class=\"number\">1</span>;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h3 id=\"数据过滤\"><a href=\"#数据过滤\" class=\"headerlink\" title=\"数据过滤\"></a>数据过滤</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> filterArr = <span class=\"function\"><span class=\"params\">items</span> =></span> {</span><br><span class=\"line\">    <span class=\"keyword\">return</span> items.filter(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">item</span>) </span>{</span><br><span class=\"line\">        <span class=\"comment\">// 遍历 item 对象里面的键值是否符合回调函数的测试</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.keys(item).some(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">key</span>) </span>{</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">String</span>(item[key]).toLowerCase().match(searchVal)</span><br><span class=\"line\">        })</span><br><span class=\"line\">    })</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h1 id=\"四、Base64\"><a href=\"#四、Base64\" class=\"headerlink\" title=\"四、Base64\"></a>四、Base64</h1><blockquote><p>基于 64 个可打印字符 <code>A-Z、a-z、0-9、+、/</code> 来表示二进制数据的一种方法</p></blockquote><h2 id=\"产生\"><a href=\"#产生\" class=\"headerlink\" title=\"产生\"></a>产生</h2><ul><li>需求<ul><li>网络传输中文时容易出现乱码情况</li><li>网络传输图片等文件的字符并不全是可打印的字符</li><li>电子邮件早期只能传输英文，中文字符不能被服务器处理</li></ul></li><li>适用场景<ul><li>当访问外部资源很麻烦或受限时</li><li>当图片的体积太小，占用一个 HTTP 会话不是很值得时</li><li>当图片是在服务器端用程序动态生成，各个访问用户显示不同时</li></ul></li><li>图片应用<ul><li>主流浏览器都支持基于 Base64 编码的 dataURL 字符串 作为图片地址，<a href=\"http://imgbase64.duoshitong.com/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">图片在线转码</a></li><li>图片上传服务器时需要纯字符串形式，截取 data:image/png;base64, 后面的字符串即可上传</li></ul></li></ul><h2 id=\"编码\"><a href=\"#编码\" class=\"headerlink\" title=\"编码\"></a>编码</h2><blockquote><p>一种将二进制序列的数据转换为字符串的编码算法，只是无法直接看到明文但并非加密</p></blockquote><ul><li>理解<ul><li>字节 byte 是存储二进制数据的基本单位</li><li>中文有 utf-8、gbk 等多种编码，不同编码对应的结果都不一样</li><li>对于图片、文本和音视频等数据，只有转换为 二进制序列 之后才能进行 Base64 编码</li><li>编码后的数据体积一般会变大，而且 base64Url 形式的图片不会被浏览器缓存，每次访问这样页面时都被下载一次，所以不适合被大量使用</li></ul></li><li>规则<ol><li>将每三个字节作为一组，一共是 24 个二进制位</li><li>将 24 个二进制位分为四组，每个组有 6 个二进制位</li><li>在每组前面加两个00，扩展为 32 个二进制位，即 4 个字节</li><li>根据 base64 编码对照表转换为扩展后的每个字节的对应字符</li></ol></li></ul><h2 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h2><h3 id=\"浏览器原生实现\"><a href=\"#浏览器原生实现\" class=\"headerlink\" title=\"浏览器原生实现\"></a>浏览器原生实现</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编码</span></span><br><span class=\"line\"><span class=\"built_in\">window</span>.btoa(<span class=\"string\">'xiaomabuhei'</span>)  </span><br><span class=\"line\"><span class=\"comment\">// 解码</span></span><br><span class=\"line\"><span class=\"built_in\">window</span>.atob(<span class=\"string\">'eGlhb21hYnVoZWk='</span>)          </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 中文编码时需要先进行 URI 组件编码</span></span><br><span class=\"line\"><span class=\"built_in\">window</span>.btoa(<span class=\"built_in\">window</span>.encodeURIComponent(<span class=\"string\">'小马不黑'</span>))</span><br><span class=\"line\"><span class=\"built_in\">window</span>.decodeURIComponent(<span class=\"built_in\">window</span>.atob(baseStr))</span><br></pre></td></tr></tbody></table></figure><h3 id=\"js-实现\"><a href=\"#js-实现\" class=\"headerlink\" title=\"js 实现\"></a>js 实现</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Base64 = {</span><br><span class=\"line\">  _keyStr: <span class=\"string\">\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\"</span>,</span><br><span class=\"line\"></span><br><span class=\"line\">  encode: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">input</span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> output = <span class=\"string\">\"\"</span>;  </span><br><span class=\"line\">    <span class=\"keyword\">var</span> chr1, chr2, chr3, enc1, enc2, enc3, enc4;  </span><br><span class=\"line\">    <span class=\"keyword\">var</span> i = <span class=\"number\">0</span>;  </span><br><span class=\"line\">    input = Base64._utf8_encode(input);  </span><br><span class=\"line\">    <span class=\"keyword\">while</span> (i &lt; input.length) {  </span><br><span class=\"line\">        chr1 = input.charCodeAt(i++);  </span><br><span class=\"line\">        chr2 = input.charCodeAt(i++);  </span><br><span class=\"line\">        chr3 = input.charCodeAt(i++);  </span><br><span class=\"line\">        enc1 = chr1 &gt;&gt; <span class=\"number\">2</span>;  </span><br><span class=\"line\">        enc2 = ((chr1 & <span class=\"number\">3</span>) &lt;&lt; <span class=\"number\">4</span>) | (chr2 &gt;&gt; <span class=\"number\">4</span>);  </span><br><span class=\"line\">        enc3 = ((chr2 & <span class=\"number\">15</span>) &lt;&lt; <span class=\"number\">2</span>) | (chr3 &gt;&gt; <span class=\"number\">6</span>);  </span><br><span class=\"line\">        enc4 = chr3 & <span class=\"number\">63</span>;  </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"built_in\">isNaN</span>(chr2)) {  </span><br><span class=\"line\">            enc3 = enc4 = <span class=\"number\">64</span>;  </span><br><span class=\"line\">        } <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"built_in\">isNaN</span>(chr3)) {  </span><br><span class=\"line\">            enc4 = <span class=\"number\">64</span>;  </span><br><span class=\"line\">        }  </span><br><span class=\"line\">        output = output +  </span><br><span class=\"line\">        _keyStr.charAt(enc1) + _keyStr.charAt(enc2) +  </span><br><span class=\"line\">        _keyStr.charAt(enc3) + _keyStr.charAt(enc4);  </span><br><span class=\"line\">    }  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> output; </span><br><span class=\"line\">  },</span><br><span class=\"line\"></span><br><span class=\"line\">  decode: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">input</span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> output = <span class=\"string\">\"\"</span>;  </span><br><span class=\"line\">    <span class=\"keyword\">var</span> chr1, chr2, chr3;  </span><br><span class=\"line\">    <span class=\"keyword\">var</span> enc1, enc2, enc3, enc4;  </span><br><span class=\"line\">    <span class=\"keyword\">var</span> i = <span class=\"number\">0</span>;  </span><br><span class=\"line\">    input = input.replace(<span class=\"regexp\">/[^A-Za-z0-9\\+\\/\\=]/g</span>, <span class=\"string\">\"\"</span>);  </span><br><span class=\"line\">    <span class=\"keyword\">while</span> (i &lt; input.length) {  </span><br><span class=\"line\">        enc1 = _keyStr.indexOf(input.charAt(i++));  </span><br><span class=\"line\">        enc2 = _keyStr.indexOf(input.charAt(i++));  </span><br><span class=\"line\">        enc3 = _keyStr.indexOf(input.charAt(i++));  </span><br><span class=\"line\">        enc4 = _keyStr.indexOf(input.charAt(i++));  </span><br><span class=\"line\">        chr1 = (enc1 &lt;&lt; <span class=\"number\">2</span>) | (enc2 &gt;&gt; <span class=\"number\">4</span>);  </span><br><span class=\"line\">        chr2 = ((enc2 & <span class=\"number\">15</span>) &lt;&lt; <span class=\"number\">4</span>) | (enc3 &gt;&gt; <span class=\"number\">2</span>);  </span><br><span class=\"line\">        chr3 = ((enc3 & <span class=\"number\">3</span>) &lt;&lt; <span class=\"number\">6</span>) | enc4;  </span><br><span class=\"line\">        output = output + <span class=\"built_in\">String</span>.fromCharCode(chr1);  </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (enc3 != <span class=\"number\">64</span>) {  </span><br><span class=\"line\">            output = output + <span class=\"built_in\">String</span>.fromCharCode(chr2);  </span><br><span class=\"line\">        }  </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (enc4 != <span class=\"number\">64</span>) {  </span><br><span class=\"line\">            output = output + <span class=\"built_in\">String</span>.fromCharCode(chr3);  </span><br><span class=\"line\">        }  </span><br><span class=\"line\">    }  </span><br><span class=\"line\">    output = Base64._utf8_decode(output);  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> output;  </span><br><span class=\"line\">  },</span><br><span class=\"line\"></span><br><span class=\"line\">  _utf8_encode: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">string</span>) </span>{</span><br><span class=\"line\">    string = string.replace(<span class=\"regexp\">/\\r\\n/g</span>, <span class=\"string\">\"\\n\"</span>);  </span><br><span class=\"line\">    <span class=\"keyword\">var</span> utftext = <span class=\"string\">\"\"</span>;  </span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> n = <span class=\"number\">0</span>; n &lt; string.length; n++) {  </span><br><span class=\"line\">        <span class=\"keyword\">var</span> c = string.charCodeAt(n);  </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (c &lt; <span class=\"number\">128</span>) {  </span><br><span class=\"line\">            utftext += <span class=\"built_in\">String</span>.fromCharCode(c);  </span><br><span class=\"line\">        } <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>((c &gt; <span class=\"number\">127</span>) && (c &lt; <span class=\"number\">2048</span>)) {  </span><br><span class=\"line\">            utftext += <span class=\"built_in\">String</span>.fromCharCode((c &gt;&gt; <span class=\"number\">6</span>) | <span class=\"number\">192</span>);  </span><br><span class=\"line\">            utftext += <span class=\"built_in\">String</span>.fromCharCode((c & <span class=\"number\">63</span>) | <span class=\"number\">128</span>);  </span><br><span class=\"line\">        } <span class=\"keyword\">else</span> {  </span><br><span class=\"line\">            utftext += <span class=\"built_in\">String</span>.fromCharCode((c &gt;&gt; <span class=\"number\">12</span>) | <span class=\"number\">224</span>);  </span><br><span class=\"line\">            utftext += <span class=\"built_in\">String</span>.fromCharCode(((c &gt;&gt; <span class=\"number\">6</span>) & <span class=\"number\">63</span>) | <span class=\"number\">128</span>);  </span><br><span class=\"line\">            utftext += <span class=\"built_in\">String</span>.fromCharCode((c & <span class=\"number\">63</span>) | <span class=\"number\">128</span>);  </span><br><span class=\"line\">        }  </span><br><span class=\"line\"></span><br><span class=\"line\">    }  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> utftext; </span><br><span class=\"line\">  },</span><br><span class=\"line\"></span><br><span class=\"line\">  _utf8_decode: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> string = <span class=\"string\">\"\"</span>;  </span><br><span class=\"line\">    <span class=\"keyword\">var</span> i = <span class=\"number\">0</span>;  </span><br><span class=\"line\">    <span class=\"keyword\">var</span> c = c1 = c2 = <span class=\"number\">0</span>;  </span><br><span class=\"line\">    <span class=\"keyword\">while</span> ( i &lt; utftext.length ) {  </span><br><span class=\"line\">        c = utftext.charCodeAt(i);  </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (c &lt; <span class=\"number\">128</span>) {  </span><br><span class=\"line\">            string += <span class=\"built_in\">String</span>.fromCharCode(c);  </span><br><span class=\"line\">            i++;  </span><br><span class=\"line\">        } <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>((c &gt; <span class=\"number\">191</span>) && (c &lt; <span class=\"number\">224</span>)) {  </span><br><span class=\"line\">            c2 = utftext.charCodeAt(i+<span class=\"number\">1</span>);  </span><br><span class=\"line\">            string += <span class=\"built_in\">String</span>.fromCharCode(((c & <span class=\"number\">31</span>) &lt;&lt; <span class=\"number\">6</span>) | (c2 & <span class=\"number\">63</span>));  </span><br><span class=\"line\">            i += <span class=\"number\">2</span>;  </span><br><span class=\"line\">        } <span class=\"keyword\">else</span> {  </span><br><span class=\"line\">            c2 = utftext.charCodeAt(i+<span class=\"number\">1</span>);  </span><br><span class=\"line\">            c3 = utftext.charCodeAt(i+<span class=\"number\">2</span>);  </span><br><span class=\"line\">            string += <span class=\"built_in\">String</span>.fromCharCode(((c & <span class=\"number\">15</span>) &lt;&lt; <span class=\"number\">12</span>) | ((c2 & <span class=\"number\">63</span>) &lt;&lt; <span class=\"number\">6</span>) | (c3 & <span class=\"number\">63</span>));  </span><br><span class=\"line\">            i += <span class=\"number\">3</span>;  </span><br><span class=\"line\">        }  </span><br><span class=\"line\">    }  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> string;</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"图片转换\"><a href=\"#图片转换\" class=\"headerlink\" title=\"图片转换\"></a>图片转换</h2><blockquote><p>将网络或本地图片的地址转为 base64 格式</p></blockquote><h3 id=\"canvas\"><a href=\"#canvas\" class=\"headerlink\" title=\"canvas\"></a>canvas</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getBase64Img</span>(<span class=\"params\">img</span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"canvas\"</span>);</span><br><span class=\"line\">    canvas.width = img.width;</span><br><span class=\"line\">    canvas.height = img.height;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ctx = canvas.getContext(<span class=\"string\">\"2d\"</span>);</span><br><span class=\"line\">    ctx.drawImage(img, <span class=\"number\">0</span>, <span class=\"number\">0</span>, img.width, img.height);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ext = img.src.substring(img.src.lastIndexOf(<span class=\"string\">\".\"</span>) + <span class=\"number\">1</span>).toLowerCase();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> dataURL = canvas.toDataURL(<span class=\"string\">\"image/\"</span> + ext);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> dataURL;</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"comment\">// Base64 字符串转二进制</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">base64ToBlob</span>(<span class=\"params\">dataurl</span>) </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 去头并转为 byte</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> arr = dataurl.split(<span class=\"string\">','</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 处理异常：将 ASCII 码小于0的转换为大于0</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> mime = arr[<span class=\"number\">0</span>].match(<span class=\"regexp\">/:(.*?);/</span>)[<span class=\"number\">1</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 解码</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> bytes = <span class=\"built_in\">window</span>.atob(arr[<span class=\"number\">1</span>]);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> n = bytes.length;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 生成视图（直接针对内存）：8位无符号整数，长度1个字节</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> u8arr = <span class=\"keyword\">new</span> <span class=\"built_in\">Uint8Array</span>(n);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (n--) {</span><br><span class=\"line\">        u8arr[n] = bytes.charCodeAt(n);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Blob([u8arr], { <span class=\"attr\">type</span>: mime });</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> image = <span class=\"keyword\">new</span> Image();</span><br><span class=\"line\">image.src = <span class=\"string\">\"img_url\"</span>;</span><br><span class=\"line\">image.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> base64 = getBase64Img(image);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> file = base64ToBlob(base64);</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getBase64Image</span>(<span class=\"params\">url, quality = <span class=\"number\">0.5</span></span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">const</span> img = <span class=\"keyword\">new</span> Image();</span><br><span class=\"line\">    img.src = url</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =></span> {</span><br><span class=\"line\">        img.onload = <span class=\"function\"><span class=\"params\">()</span> =></span> {</span><br><span class=\"line\">            <span class=\"keyword\">const</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"canvas\"</span>);</span><br><span class=\"line\">            canvas.width = img.width;</span><br><span class=\"line\">            canvas.height = img.height;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> ctx = canvas.getContext(<span class=\"string\">\"2d\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            ctx.drawImage(img, <span class=\"number\">0</span>, <span class=\"number\">0</span>, img.width, img.height);</span><br><span class=\"line\">            dataURL = canvas.toDataURL(<span class=\"string\">'image/jpeg'</span>, quality);</span><br><span class=\"line\">            resolve(dataURL)</span><br><span class=\"line\">        }</span><br><span class=\"line\">    })</span><br><span class=\"line\">}</span><br><span class=\"line\">getBase64Image(<span class=\"string\">\"./pic.png\"</span>, <span class=\"number\">0.8</span>).then(<span class=\"function\"><span class=\"params\">dataURL</span> =></span> {</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(dataURL)</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'img'</span>).src = dataURL</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h3 id=\"html2canvas\"><a href=\"#html2canvas\" class=\"headerlink\" title=\"html2canvas\"></a>html2canvas</h3><blockquote><p>截图功能：将 html 页面转化为图片</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html2canvas(<span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'img'</span>), {<span class=\"attr\">useCORS</span>: <span class=\"literal\">true</span>}).then(<span class=\"function\"><span class=\"params\">canvas</span> =></span> {</span><br><span class=\"line\">    <span class=\"keyword\">var</span> base64 = canvas.toDataURL(<span class=\"string\">\"image/jpeg\"</span>, <span class=\"number\">0.1</span>);</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.appendChild(canvas);</span><br><span class=\"line\">    <span class=\"comment\">// downloadImg(base64, \"meme.png\")  // 下载图片</span></span><br><span class=\"line\">})</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">downloadImg</span>(<span class=\"params\">base64, imgName</span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> a = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"a\"</span>);</span><br><span class=\"line\">    a.href = base64;</span><br><span class=\"line\">    a.download = imgName;</span><br><span class=\"line\">    a.click();</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h3 id=\"Node-js\"><a href=\"#Node-js\" class=\"headerlink\" title=\"Node.js\"></a>Node.js</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 通过 fs.readFile</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>);</span><br><span class=\"line\">fs.readFile(<span class=\"string\">'./a.png'</span>, <span class=\"string\">'base64'</span>, (err, data) => {</span><br><span class=\"line\">    <span class=\"comment\">// 图片需要在 data 前添加 'data:image/png;base64,'</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(data)</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 通过 fs.createReadStream</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> readStream = fs.createReadStream(<span class=\"string\">'./pic.png'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">readStream.on(<span class=\"string\">'data'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">chunk</span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(chunk.toString(<span class=\"string\">'base64'</span>)) </span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h3 id=\"Buffer\"><a href=\"#Buffer\" class=\"headerlink\" title=\"Buffer\"></a>Buffer</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> base64 = Buffer.from(<span class=\"string\">'把我转化为base64'</span>).toString(<span class=\"string\">'base64'</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(base64)</span><br></pre></td></tr></tbody></table></figure><h1 id=\"五、二进制对象\"><a href=\"#五、二进制对象\" class=\"headerlink\" title=\"五、二进制对象\"></a>五、二进制对象</h1><div style=\"text-indent:2em\">js 最初无法处理文件、网络流等二进制 (编码格式的) 数据，只能先使用 charCodeAt() 逐字节读取 或者 转换为 Base64 格式，但是处理速度慢而且容易出错。js 后来通过引入 API 逐渐可以处理二进制数据，但是标准库里没有相关内容，所以 NodeJs 就自己搞了一套，现在 Web 自己也搞起来了，这就导致了 Web 环境和 Node 环境里的二进制内容处理方式有些不同。</div><h2 id=\"通用\"><a href=\"#通用\" class=\"headerlink\" title=\"通用\"></a>通用</h2><div style=\"text-indent:2em\"><code>ArrayBuffer 对象</code> 表示内存中存储了一段二进制数据的原始缓冲区，它不能直接读写，只能通过 <code>TypedArray/DataView 视图</code> 转换为类型化数组之后来读写。同一段内存的不同数据有不同的读取方式，对应不同的视图。视图的作用是以指定格式读写二进制数据但本身并不存储，本质是二进制数据的抽象数据结构，两种视图的区别在于字节序，TypedArray 视图的数组成员都是同一个数据类型，DataView 视图的数组成员可以是不同的数据类型。。</div><h3 id=\"ArrayBuffer\"><a href=\"#ArrayBuffer\" class=\"headerlink\" title=\"ArrayBuffer\"></a>ArrayBuffer</h3><blockquote><p>用于存储二进制数据，本质是一串数字组成的乱码但没有格式，不能直接被访问</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 创建一个 8 字节的缓冲区对象</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> buffer = <span class=\"keyword\">new</span> <span class=\"built_in\">ArrayBuffer</span>(<span class=\"number\">8</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 字节长度 8</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(buffer.byteLength);   </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 参数是否为视图实例</span></span><br><span class=\"line\"><span class=\"built_in\">ArrayBuffer</span>.isView(buffer) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 裁剪缓冲区</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> buffer1 = buffer.slice(<span class=\"number\">0</span>, <span class=\"number\">1</span>)</span><br></pre></td></tr></tbody></table></figure><h3 id=\"TypedArray\"><a href=\"#TypedArray\" class=\"headerlink\" title=\"TypedArray\"></a>TypedArray</h3><blockquote><p>成员为相同的数据类型</p></blockquote><ul><li>本质：一组类的统称，它们的实例都是类数组对象</li><li>语法：和普通数组语法相同，但是其元素的数据类型相同而且没有空位</li><li><p>API：</p><ul><li>有符号整数：Int8Array、Int16Array、Int32Array</li><li>无符号整数：Uint8Array、Uint16Array、Uint32Array</li><li>浮点数：Float32Array、Float64Array</li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 直接生成视图，默认生成底层 ArrayBuffer 实例并赋值</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> f = <span class=\"keyword\">new</span> <span class=\"built_in\">Float64Array</span>(<span class=\"number\">8</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 通过 buffer 生成视图，默认全部内容，参数为 buffer、开始索引、长度</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> buffer = <span class=\"keyword\">new</span> <span class=\"built_in\">ArrayBuffer</span>(<span class=\"number\">4</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> a = <span class=\"keyword\">new</span> <span class=\"built_in\">Int8Array</span>(buffer)   </span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"keyword\">new</span> <span class=\"built_in\">Uint32Array</span>(buffer, <span class=\"number\">0</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"keyword\">new</span> <span class=\"built_in\">Uint8Array</span>(buffer, <span class=\"number\">1</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 操作视图元素</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>; i &lt; f.byteLength; i++){ }</span><br><span class=\"line\">f[<span class=\"number\">1</span>] = <span class=\"number\">10</span>        <span class=\"comment\">// [0, 10]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 与普通数组互转</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = <span class=\"built_in\">Array</span>.from(f) </span><br><span class=\"line\">arr_2 = <span class=\"built_in\">Array</span>.apply([], t)</span><br><span class=\"line\"><span class=\"keyword\">var</span> u = <span class=\"keyword\">new</span> <span class=\"built_in\">Uint8Array</span>([ <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span> ])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 与字符串互转</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> str = <span class=\"built_in\">String</span>.fromCharCode.apply(<span class=\"literal\">null</span>, buffer)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">strToBuf</span> (<span class=\"params\">str</span>) </span>{</span><br><span class=\"line\">  <span class=\"comment\">// 每个字符占用2个字节</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> buf = <span class=\"keyword\">new</span> <span class=\"built_in\">ArrayBuffer</span>(str.length*<span class=\"number\">2</span>)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> bufView = <span class=\"keyword\">new</span> <span class=\"built_in\">Uint16Array</span>(buf)</span><br><span class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>; i &lt; str.length; i++){</span><br><span class=\"line\">      bufView[i] = str.charCodeAt(i)</span><br><span class=\"line\">  }</span><br><span class=\"line\">    <span class=\"keyword\">return</span> bufView;</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure></li></ul><h3 id=\"DataView\"><a href=\"#DataView\" class=\"headerlink\" title=\"DataView\"></a>DataView</h3><blockquote><p>TypedArray 的强化版，成员可以是不同的数据类型，而且读写时可以自行设定 大/小 端字节序</p></blockquote><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> buffer = <span class=\"keyword\">new</span> <span class=\"built_in\">ArrayBuffer</span>(<span class=\"number\">4</span>)</span><br><span class=\"line\"><span class=\"keyword\">let</span> dataView = <span class=\"keyword\">new</span> <span class=\"built_in\">DataView</span>(buffer)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 独有方法，写入参数是 开始位置、写入数据、大/小端读取</span></span><br><span class=\"line\">dataView.getInt8(<span class=\"number\">0</span>)</span><br><span class=\"line\">dataView.setInt8(<span class=\"number\">0</span>, <span class=\"number\">10</span>)</span><br><span class=\"line\">dataView.setInt32(<span class=\"number\">0</span>, <span class=\"number\">25</span>, <span class=\"literal\">false</span>)</span><br></pre></td></tr></tbody></table></figure><h2 id=\"web-环境特有\"><a href=\"#web-环境特有\" class=\"headerlink\" title=\"web 环境特有\"></a>web 环境特有</h2><h3 id=\"Blob\"><a href=\"#Blob\" class=\"headerlink\" title=\"Blob\"></a>Blob</h3><blockquote><p>表示一个不可变的文件对象，它提供了一系列操作文件的接口</p></blockquote><ol><li>创建方式<ul><li>构造函数：<code>new Blob(dataArr, options)</code><ul><li>dataArr：必选数组，数组成员可以是二进制对象或字符串</li><li>options：可选对象，用于设置数组中数据的 MIME 类型</li></ul></li><li>slice 方法：<code>blob.slice(start, end, contentType)</code><ul><li>从已有的 Blob 对象调用 slice 接口切出一个新的 Blob 对象</li><li>contentType：可选，规定新 Blob 对象的类型</li></ul></li><li>canvas 对象：<code>canvas.toBlob(callback, type, options)</code><ul><li>把当前绘制信息转为一个 Blob 对象</li></ul></li></ul></li><li><p>属性与方法</p><ul><li>属性<ul><li>size：对象的字节长度</li><li>type：对象的数据类型</li><li>isClosed: 该对象是否调用过 close()</li></ul></li><li>方法<ul><li>close：释放对象</li><li>slice：裁剪并返回新对象</li></ul></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// String 转为 Blob</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> blob = <span class=\"keyword\">new</span> Blob([<span class=\"string\">\"Hello World\"</span>], {<span class=\"attr\">type</span>:<span class=\"string\">\"text/plain\"</span>});</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ArrayBuffer 转为 Blob</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> buffer = <span class=\"keyword\">new</span> <span class=\"built_in\">ArrayBuffer</span>(<span class=\"number\">8</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> blob = <span class=\"keyword\">new</span> Blob([buffer], {<span class=\"attr\">type</span>:<span class=\"string\">\"text/plain\"</span>});</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// TypeArray 转为 Blob</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> uArr = <span class=\"keyword\">new</span> <span class=\"built_in\">Uint16Array</span>([<span class=\"number\">97</span>, <span class=\"number\">32</span>, <span class=\"number\">72</span>, <span class=\"number\">100</span>]);</span><br><span class=\"line\"><span class=\"keyword\">var</span> blob = <span class=\"keyword\">new</span> Blob([uArr]);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> blob = blob_2.slice(<span class=\"number\">1</span>, <span class=\"number\">5</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"canvas\"</span>);</span><br><span class=\"line\">canvas.toBlob(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">blob</span>)</span>{</span><br><span class=\"line\">   <span class=\"built_in\">console</span>.log(blob);</span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure></li></ol><h3 id=\"Blob-派生对象\"><a href=\"#Blob-派生对象\" class=\"headerlink\" title=\"Blob 派生对象\"></a>Blob 派生对象</h3><blockquote><p>blob 对象是它们的底层对象，它们都是继承 blob 对象并进行了扩展，但其内容一样无法修改</p></blockquote><h4 id=\"File-对象\"><a href=\"#File-对象\" class=\"headerlink\" title=\"File 对象\"></a>File 对象</h4><ul><li>功能：保存文件的相关信息并允许 Js 访问</li><li>分类<ul><li>input 元素上选择文件后返回的 FileList 对象</li><li>普通元素被自由拖拽时返回的 DataTransfer 对象</li><li>HTMLCanvasElement 上执行 mozGetAsFile() 方法后返回的结果</li></ul></li></ul><h4 id=\"FileReader-对象\"><a href=\"#FileReader-对象\" class=\"headerlink\" title=\"FileReader 对象\"></a>FileReader 对象</h4><ul><li>功能：提供异步读取文件内容或二进制数据的接口</li><li>保存：读取的文件内容会被保存到 result 属性中</li><li>异步读取<ul><li>readAsText(file, encoding)：返回 纯文本。encoding 指定编码格式（默认 ‘UTF-8’）</li><li>readAsDataURL(file)：返回 基于 Base64 编码的 dataURL 字符串（读取图像时常用）</li><li>readAsBinaryString(file)：返回 文件的原始二进制字符串（每个字符表示一字节）</li><li>readAsArrayBuffer(file)：返回 包含文件内容的 ArrayBuffer 对象</li></ul></li><li>中止读取：abort()</li><li>回调函数<ul><li>onload：成功时</li><li>onerror：出错时</li><li>onprogress：更新时</li><li>onloadstart：开始时</li><li>onloadend：完成时</li><li>onabort：中止时</li></ul></li></ul><h4 id=\"URL-对象\"><a href=\"#URL-对象\" class=\"headerlink\" title=\"URL 对象\"></a>URL 对象</h4><ul><li>功能：通过内存文件创建出一个临时指向 File/Blob 对象的 url</li><li>静态方法<ul><li>createObjectURL：生成</li><li>revokeObjectURL：释放</li></ul></li><li>注意事项<ul><li>网页一旦刷新或关闭，已生成的 url 就会失效</li><li>同样的 blob 在不同的事件调用中会得到不同 url</li></ul></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 选择文件后获取文件信息</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fileInput = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">\"#fileInput\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">fileInput.addEventListener(<span class=\"string\">\"change\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>) </span>{</span><br><span class=\"line\">    <span class=\"keyword\">var</span> fileList = fileInput.files</span><br><span class=\"line\">    <span class=\"keyword\">var</span> file = fileList[<span class=\"number\">0</span>];</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(file.name, file.size)</span><br><span class=\"line\">}, <span class=\"literal\">false</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 拖动结束时获取被拖动的数据</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> box = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"#box\"</span>);</span><br><span class=\"line\">box.ondrop = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>)</span>{</span><br><span class=\"line\">    <span class=\"comment\">// 拖动的默认处理方式是在新窗口打开</span></span><br><span class=\"line\">    event.preventDefault()    </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(event.dataTransfer.files)</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 获取文件二进制数据</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> reader = <span class=\"keyword\">new</span> FileReader();</span><br><span class=\"line\">reader.readAsArrayBuffer(file);</span><br><span class=\"line\"></span><br><span class=\"line\">reder.onprogress = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>)</span>{ </span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(reader.result)  </span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(e.target.result)</span><br><span class=\"line\">}</span><br><span class=\"line\">reader.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>{ </span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(reader.result)  </span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(e.target.result)</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 在网页插入图片</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> img = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"img\"</span>);</span><br><span class=\"line\">img.src = <span class=\"built_in\">window</span>.URL.createObjectURL(file);</span><br><span class=\"line\">img.width = <span class=\"number\">60</span>;</span><br><span class=\"line\">img.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>{</span><br><span class=\"line\">    <span class=\"built_in\">window</span>.URL.revokeObjectURL(<span class=\"keyword\">this</span>.src);</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"built_in\">document</span>.body.appendChild(img);</span><br></pre></td></tr></tbody></table></figure><h2 id=\"Node-环境特有\"><a href=\"#Node-环境特有\" class=\"headerlink\" title=\"Node 环境特有\"></a>Node 环境特有</h2><h3 id=\"Buffer-1\"><a href=\"#Buffer-1\" class=\"headerlink\" title=\"Buffer\"></a>Buffer</h3><div style=\"text-indent:2em\">Buffer 表示 V8 堆内存之外的一块原始内存，并不会占用 NodeJS 进程内存，常用来存储需要占用大量内存的数据。它继承于 Uint8Array 并实现了更多的接口，对象中的每个元素储存着 2 位 16 进制的数据，代表内存的一个字节。注意一个 Buffer 对象的大小在创建时就会固定下来，即创建之后不可改变。</div><ul><li>创建<ul><li>new Buffer：已经弃用</li><li><strong>Buffer.from</strong>：参数可为 string、buffer、array、object</li><li><strong>Buffer.alloc</strong>：指定大小并已经初始化数据</li><li><strong>Buffer.allocUnsafe</strong>：指定大小但并不初始化数据</li></ul></li><li>读写<ul><li><strong>buf.writexxx</strong>：写入缓冲区</li><li><strong>buf.readxxx</strong>：读取数据</li></ul></li><li>转换<ul><li><strong>buf.toString</strong>：转为字符串</li><li><strong>buf.toJSON</strong>：转为 json</li></ul></li><li>判断<ul><li><strong>Buffer.isEncoding</strong>：编码格式</li><li><strong>Buffer.isBuffer</strong>：对象是否为 Buffer</li></ul></li><li>其它<ul><li><strong>buf.length</strong>：返回字节数</li><li><strong>buf.indexOf</strong>：返回位置</li><li><strong>buf.compare</strong>：对象比较</li><li><strong>buf.fill</strong>：填充数据</li><li><strong>buf.slice</strong>：裁剪</li><li><strong>buf.copy</strong>：拷贝</li></ul></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 创建 </span></span><br><span class=\"line\"><span class=\"keyword\">const</span> buf_1 = Buffer.from([<span class=\"number\">0x62</span>, <span class=\"number\">0x75</span>, <span class=\"number\">0x66</span>, <span class=\"number\">0x66</span>]);</span><br><span class=\"line\"><span class=\"keyword\">const</span> buf = Buffer.from(<span class=\"string\">\"hello\"</span>)   <span class=\"comment\">// 编码格式默认 utf8 </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(buf.length)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> buf_2 = Buffer.alloc(<span class=\"number\">5</span>);       <span class=\"comment\">// 不做任何处理就是 0 填充</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> buf = Buffer.alloc(<span class=\"number\">5</span>, <span class=\"string\">'a'</span>);  <span class=\"comment\">// 以 a 填充</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> buf = Buffer.alloc(<span class=\"number\">10</span>, <span class=\"string\">'aGVsbG8gd29ybGQ='</span>, <span class=\"string\">'base64'</span>);  <span class=\"comment\">// 以 base64 格式填充</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> buf = Buffer.allocUnsafe(<span class=\"number\">10</span>);  <span class=\"comment\">// 只有一个参数</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 拼接</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> buf_3 = Buffer.concat([buf_1, buf_2])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 裁剪</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> buf_2 = buf_1.slice(<span class=\"number\">0</span>, <span class=\"number\">5</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 拷贝</span></span><br><span class=\"line\">buf_2.copy(buf_1, <span class=\"number\">2</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 比较</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> result = buf_1.compare(buf_2);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 读写</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> value = buf.readInt32LE(<span class=\"number\">0</span>)</span><br><span class=\"line\">buf.writeFloatLE(<span class=\"number\">3.</span> <span class=\"number\">16</span>, <span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// buffer 转字符串</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> buf = Buffer.from(<span class=\"string\">'test'</span>)</span><br><span class=\"line\">buf.toString(<span class=\"string\">'utf8'</span>)             <span class=\"comment\">// test</span></span><br><span class=\"line\">buf.toString(<span class=\"string\">'utf8'</span>, <span class=\"number\">0</span>, <span class=\"number\">2</span>)       <span class=\"comment\">// te</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// buffer 转 json</span></span><br><span class=\"line\">buf.toJSON()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// stream 转 buffer</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">streamToBuffer</span>(<span class=\"params\">stream</span>) </span>{  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =></span> {</span><br><span class=\"line\">        <span class=\"keyword\">let</span> buffers = [];</span><br><span class=\"line\">        stream.on(<span class=\"string\">'error'</span>, reject);</span><br><span class=\"line\">        stream.on(<span class=\"string\">'data'</span>, (data) => buffers.push(data))</span><br><span class=\"line\">        stream.on(<span class=\"string\">'end'</span>, () => resolve(Buffer.concat(buffers))</span><br><span class=\"line\">    })</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// buffer 转 stream</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> Duplex = <span class=\"built_in\">require</span>(<span class=\"string\">'stream'</span>).Duplex;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bufferToStream</span>(<span class=\"params\">buffer</span>) </span>{  </span><br><span class=\"line\">    <span class=\"keyword\">let</span> stream = <span class=\"keyword\">new</span> Duplex();</span><br><span class=\"line\">    stream.push(buffer);</span><br><span class=\"line\">    stream.push(<span class=\"literal\">null</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> stream;</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><!-- rebuild by neat --></body></html>","site":{"data":{"next":{"override":false,"cache":{"enable":true},"favicon":{"small":"/images/favicon-16.ico","medium":"/images/favicon-32.ico","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"rss":"/atom.xml","footer":{"since":2019,"icon":{"name":"snowflake-o","animated":false,"color":"#808080"},"copyright":"chuangge","powered":{"enable":false,"version":true},"theme":{"enable":false,"version":true},"beian":{"enable":false,"icp":null}},"creative_commons":{"license":"by-nc-sa","sidebar":false,"post":false},"canonical":true,"seo":false,"index_with_subtitle":false,"exturl":false,"menu":{"home":"/ || home  //首页","tags":"/tags/ || tags  //标签","categories":"/categories/ || th   //分类","archives":"/archives/ || archive //归档"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":{"GitHub":"https://github.com/ || github","StackOverflow":"https://stackoverflow.com/ || stack-overflow"},"social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"友情链接","links_layout":"inline","links":{"个人简历":"https://chuanggefighting.github.io/project/","印记中文":"https://www.docschina.org/","在线工具":"http://tool.lu/","Learn Anything":"https://learn-anything.xyz/"},"avatar":{"url":"/images/chuang.png","rounded":true,"opacity":1,"rotated":true},"toc":{"enable":true,"number":true,"wrap":false,"max_depth":6},"sidebar":{"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"read_more_btn":true,"post_meta":{"item_text":true,"created_at":true,"updated_at":{"enabled":true,"another_day":true},"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":true,"awl":4,"wpm":275},"codeblock":{"border_radius":null,"copy_button":{"enable":false,"show_result":false}},"reward":{"enable":false},"related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_edit":{"enable":false,"url":"https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name"},"disable_baidu_tranformation":false,"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"font":{"enable":true,"host":"//fonts.proxy.ustclug.org","global":{"external":true,"family":"Lato","size":16},"headings":{"external":true,"family":"Roboto Slab","size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":"Lobster Two","size":24},"codes":{"external":true,"family":"Roboto Mono","size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css","copy_tex":{"enable":false,"copy_tex_js":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js","copy_tex_css":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css"}}},"pdf":{"enable":false,"per_page":true,"height":"500px","pdfobject":{"cdn":"//cdn.jsdelivr.net/npm/pdfobject@2.1.1/pdfobject.min.js"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":true,"appid":"snOvapuSplYTVflf5p9Ml9JX-gzGzoHsz","appkey":"5ABGdfyEdAtu6lTXdGdo7hf9","notify":false,"verify":false,"placeholder":"ヾﾉ≧∀≦)o 来呀！吐槽一番吧！","avatar":"mm","guest_info":"nick,mail,link","pageSize":10,"visitor":false,"comment_count":true},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"gitalk":{"enable":false,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true},"needmoreshare2":{"enable":true,"postbottom":{"enable":true,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null,"security":false,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":true,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":true,"pace_theme":"pace-theme-center-simple","canvas_nest":{"enable":true,"onmobile":true,"color":"0,0,255","opacity":0.5,"zIndex":-1,"count":99},"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"canvas_nest_nomobile":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"leancloud":null,"valine":null,"gitalk_js":null,"gitalk_css":null,"md5":null},"css":"css","js":"js","images":"images","passage_end_tag":{"enabled":true},"daovoice":true,"daovoice_app_id":"2ed51855"}}},"excerpt":"","more":"<!-- build time:Sat May 11 2019 01:36:59 GMT+0800 (中国标准时间) --><h1 id=\"一、字符串\"><a href=\"#一、字符串\" class=\"headerlink\" title=\"一、字符串\"></a>一、字符串</h1><blockquote><p>用于存储和处理文本，可看作类数组</p></blockquote><h2 id=\"创建\"><a href=\"#创建\" class=\"headerlink\" title=\"创建\"></a>创建</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> str_1 = <span class=\"string\">'hello'</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> str_2 = <span class=\"built_in\">String</span>(<span class=\"string\">'123'</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> str_3 = <span class=\"keyword\">new</span> <span class=\"built_in\">String</span>(<span class=\"string\">'hello str'</span>)</span><br></pre></td></tr></table></figure><h2 id=\"属性\"><a href=\"#属性\" class=\"headerlink\" title=\"属性\"></a>属性</h2><ul><li>length：长度</li><li>prototype：原型属性，保存当前对象的原型对象</li><li>constructor：引用属性，保存当前对象的构造函数</li></ul><h2 id=\"常用方法\"><a href=\"#常用方法\" class=\"headerlink\" title=\"常用方法\"></a>常用方法</h2><ul><li>字符索引：<code>charAt、indexOf</code></li><li>正则匹配：<code>match、search、replace</code></li><li>分割为数组：<code>split</code></li><li>字符串连接：<code>concat</code></li><li>裁剪字符串：<code>slice、substr、substring</code></li></ul><h2 id=\"扩展方法\"><a href=\"#扩展方法\" class=\"headerlink\" title=\"扩展方法\"></a>扩展方法</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 调用方式</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> eg1 = <span class=\"string\">\" ab \"</span>.trim();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 去除左边的空格</span></span><br><span class=\"line\"><span class=\"built_in\">String</span>.prototype.LTrim = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.replace(<span class=\"regexp\">/(^\\s*)/g</span>, <span class=\"string\">\"\"</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 去除右边的空格</span></span><br><span class=\"line\"><span class=\"built_in\">String</span>.prototype.Rtrim = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.replace(<span class=\"regexp\">/(\\s*$)/g</span>, <span class=\"string\">\"\"</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//去除前后空格</span></span><br><span class=\"line\"><span class=\"built_in\">String</span>.prototype.Trim = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.replace(<span class=\"regexp\">/(^\\s*)|(\\s*$)/g</span>, <span class=\"string\">\"\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p></p><h1 id=\"二、对象\"><a href=\"#二、对象\" class=\"headerlink\" title=\"二、对象\"></a>二、对象</h1><blockquote><p>由方法和属性作为键值对组成的一个无序集合。可看作是一个黑盒子，使用时只关注它的对外接口而不需要了解内部结构</p></blockquote><h2 id=\"分类\"><a href=\"#分类\" class=\"headerlink\" title=\"分类\"></a>分类</h2><ol><li>内部对象<div style=\"text-indent:2em\">包括<code>Array、Boolean、Date、Function、Global、Math、Number、Object、RegExp、String以及 Error、ReferenceError等各种错误类对象</code>。其中 <code>Global 和 Math</code> 这两个对象又被称为“内置对象”，这两个对象在脚本程序初始化时被创建，不必实例化这两个对象。</div></li><li>宿主对象<div style=\"text-indent:2em\">执行JS脚本的环境提供的对象。对于嵌入到网页中的JS来说，其宿主对象就是浏览器提供的对象，所以又称为浏览器对象，如<code>Window、Documen、Element、form、image</code>等。不同的浏览器提供的宿主对象可能不同，即使提供的对象相同，其实现方式也大相径庭，这也带来了浏览器兼容问题，增加开发难度。</div></li><li>自定义对象<div style=\"text-indent:2em\">开发人员自己定义的对象，用于扩展 JS 应用和功能。</div></li></ol><h2 id=\"创建-1\"><a href=\"#创建-1\" class=\"headerlink\" title=\"创建\"></a>创建</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1、字面量创建</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> p1 = &#123;</span><br><span class=\"line\">        name: <span class=\"string\">\"lisa\"</span>,</span><br><span class=\"line\">        say: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"comment\">// 报错, null / \"\" 都可以</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123; <span class=\"string\">\"name\"</span>: None &#125;  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2、Object.create 将对象继承到 __proto__ 属性上</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> p2 = <span class=\"built_in\">Object</span>.create(&#123; <span class=\"attr\">x</span>: <span class=\"number\">1</span> &#125;)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(p2.__proto__)   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3、new 继承构造函数的属性</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 创建系统内置对象</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> p3 = <span class=\"keyword\">new</span> <span class=\"built_in\">Object</span>(&#123; <span class=\"attr\">x</span>: <span class=\"number\">1</span> &#125;)  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(p3) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>();</span><br><span class=\"line\"><span class=\"keyword\">var</span> date = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\"><span class=\"keyword\">var</span> exp = <span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(<span class=\"string\">\"ys\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 创建自定义对象 </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name, age</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> p4 = <span class=\"keyword\">new</span> Person(<span class=\"string\">\"tom\"</span>);</span><br></pre></td></tr></table></figure><h2 id=\"拷贝\"><a href=\"#拷贝\" class=\"headerlink\" title=\"拷贝\"></a>拷贝</h2><ul><li><strong>赋值</strong><ul><li><code>=、new Object</code></li><li>原始对象和目标对象指向同一内存地址，任何修改都会相互影响</li></ul></li><li><strong>浅拷贝</strong><ul><li><code>Object.assign / $.extend (target, [objN])</code></li><li>只有目标对象的内层对象修改时才会影响原始对象</li></ul></li><li><p><strong>深拷贝</strong></p><ul><li><code>for in / JSON.parse(JSON.stringify(obj)) / $.extend(true, target, [objN])</code></li><li>目标对象的任何修改都不会影响到原始对象</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 赋值</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123; <span class=\"attr\">age</span>: <span class=\"number\">18</span> &#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> _obj = obj;</span><br><span class=\"line\">_obj.age = <span class=\"number\">20</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(obj.age, _obj.age); <span class=\"comment\">// 20 20</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 浅拷贝</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> boy = &#123;</span><br><span class=\"line\">  age: <span class=\"number\">18</span>,</span><br><span class=\"line\">  address: &#123; <span class=\"attr\">home</span>: <span class=\"string\">'北京'</span> &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> _boy = <span class=\"built_in\">Object</span>.assign(&#123;&#125;, boy);</span><br><span class=\"line\">_boy.age = <span class=\"number\">20</span>;</span><br><span class=\"line\">_boy.address.home = <span class=\"string\">\"上海\"</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(boy.age, _boy.age);   <span class=\"comment\">// 18 20</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(boy.address.home, _boy.address.home); <span class=\"comment\">// 上海 上海</span></span><br></pre></td></tr></table></figure></li></ul><h2 id=\"属性-1\"><a href=\"#属性-1\" class=\"headerlink\" title=\"属性\"></a>属性</h2><ul><li><strong>数据属性</strong>：包含一个数据值的位置，用于读取和写入值<ul><li>Configurable：配置，表示能否删除</li><li>Enumerable：枚举，表示能否通过 for-in 循环</li><li>Writable：可写，表示能否修改属性值</li><li>Value：属性的数据值，表示读写属性值的位置</li></ul></li><li><p><strong>访问器属性</strong></p><ul><li>即存取器属性，是一组获取和设置值的函数</li><li>设置 get/set 特性之后，属性就会变成访问器属性</li><li>不能直接定义，必须使用 Object.defineProperty() 来定义</li><li>分类：Configurable、Enumerable、Get、Set</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> cat = &#123; </span><br><span class=\"line\">  name: <span class=\"string\">\"Jine\"</span>, </span><br><span class=\"line\">  _year: <span class=\"number\">2020</span>    <span class=\"comment\">// 私有属性</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 查看属性</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> prop = <span class=\"built_in\">Object</span>.getOwnPropertyDescriptor(cat, <span class=\"string\">\"name\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 设置数据属性</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(cat, <span class=\"string\">'name'</span>, &#123;</span><br><span class=\"line\">  writable: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  value: <span class=\"string\">'Trump'</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 设置访问器属性</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(dog, <span class=\"string\">'year'</span>, &#123;</span><br><span class=\"line\">  <span class=\"keyword\">get</span>: function () &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>._year</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"keyword\">set</span>: function (newVal) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>._year = newVal</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 初始化对象属性值</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> person = &#123;</span><br><span class=\"line\">  _name: <span class=\"string\">'Jack'</span>,</span><br><span class=\"line\">  <span class=\"keyword\">get</span> name() &#123; </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>._name + <span class=\"string\">\"_s\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"keyword\">set</span> name(n) &#123; </span><br><span class=\"line\">    <span class=\"keyword\">this</span>._name = n </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">person.name = <span class=\"string\">'Lisa'</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(person.name);  <span class=\"comment\">// Lisa_s</span></span><br></pre></td></tr></table></figure></li></ul><h2 id=\"操作\"><a href=\"#操作\" class=\"headerlink\" title=\"操作\"></a>操作</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123; <span class=\"attr\">name</span>: <span class=\"string\">\"tom\"</span>, <span class=\"attr\">age</span>: <span class=\"number\">20</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 获取</span></span><br><span class=\"line\"><span class=\"comment\">// 点操作后只能是属性名，有横杠时须去掉并把后面的首字母大写</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> name = obj.name   </span><br><span class=\"line\"> <span class=\"comment\">// 中括号中可放属性名或变量名  </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> age = obj[<span class=\"string\">'age'</span>]  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 修改</span></span><br><span class=\"line\">obj.name = <span class=\"string\">\"新属性值\"</span>  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 方法</span></span><br><span class=\"line\">obj.say = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>) &#125;    </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 删除</span></span><br><span class=\"line\"><span class=\"keyword\">delete</span> obj.age          </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 判断类型</span></span><br><span class=\"line\">obj <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Object</span>  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 判断对象实例是否包含某个属性</span></span><br><span class=\"line\">obj.hasOwnProperty(<span class=\"string\">\"name\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 判断对象实例及其原型中是否包含某个属性</span></span><br><span class=\"line\"><span class=\"string\">\"name\"</span> <span class=\"keyword\">in</span> obj</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//判断`obj`是否为空</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isEmptyObject</span>(<span class=\"params\">obj</span>)</span>&#123;  </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(!obj || <span class=\"keyword\">typeof</span> obj !== <span class=\"string\">'object'</span> || <span class=\"built_in\">Array</span>.isArray(obj))&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> ! <span class=\"built_in\">Object</span>.keys(obj).length</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"原型链\"><a href=\"#原型链\" class=\"headerlink\" title=\"原型链\"></a>原型链</h2><div style=\"text-indent:2em\">每个对象都会在其内部初始化一个属性，就是 prototype (原型)，当我们访问一个对象的属性时，如果这个对象内部没有这个属性则去 prototype 里找这个属性，这个 prototype 又会有自己的 prototype，直到 null 结束，如果没有则返回undefined，这就是原型链的运行原理，即查找顺序：<code>实例对象 obj --&gt; 原型对象 fn.prototype --&gt; Object.prototype --&gt; null</code></div><ol><li>相互关系：<code>obj.constructor.prototype = obj.__proto__</code></li><li>函数对象：通过 new Function() 创建都是函数对象，其他的都是普通对象。每个对象都有 <code>__proto__</code> 属性指向原型对象，但只有函数对象才有 <code>prototype</code> 属性</li><li>原型对象：一个普通对象。所有的原型对象都会自动获得一个指向其构造函数的指针 <code>constructor</code>，构造函数通过 <code>prototype</code> 属性指向它的原型对象，可以说 原型对象 <code>Person.prototype</code> 就是构造函数 <code>Person</code> 的一个实例</li><li>原型链继承：利用原型让一个引用类型继承另一个引用类型的属性和方法，即让原型对象等于另一个类型的实例，这样就可以通过 <code>__proto__</code> 属性构成实例与原型的链条, 从而实现继承。</li></ol><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;   </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Person.prototype.say = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Son</span>(<span class=\"params\">name</span>)</span>&#123;</span><br><span class=\"line\">    Person.call(<span class=\"keyword\">this</span>, name);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> s1 = <span class=\"keyword\">new</span> Son(<span class=\"string\">\"son1\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> s2 = <span class=\"keyword\">new</span> Son(<span class=\"string\">\"son2\"</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(s1.__proto__ == s2.__proto__)</span><br></pre></td></tr></table></figure><h2 id=\"序列化\"><a href=\"#序列化\" class=\"headerlink\" title=\"序列化\"></a>序列化</h2><div style=\"text-indent:2em\">JSON 是一种轻量级的数据交互方式，可以存储和传输数据而显示更丰富的信息，一般作为前后端交互的数据格式。</div><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// json 对象转为字符串</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> json_1 = &#123; <span class=\"attr\">name</span>: <span class=\"string\">\"tom\"</span>, <span class=\"attr\">age</span>: <span class=\"number\">18</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> strJson = <span class=\"built_in\">JSON</span>.stringify(json)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// json 字符串转为对象</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> strJson = <span class=\"string\">'&#123; name: \"tom\", age: 18 &#125;'</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> json_2 = <span class=\"built_in\">eval</span>(<span class=\"string\">'('</span> +strJson+ <span class=\"string\">')'</span>);   <span class=\"comment\">// 不建议使用</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> json_3 = <span class=\"built_in\">JSON</span>.parse(strJson)        <span class=\"comment\">// 接近 W3C 标准</span></span><br></pre></td></tr></table></figure><h2 id=\"类数组对象\"><a href=\"#类数组对象\" class=\"headerlink\" title=\"类数组对象\"></a>类数组对象</h2><div style=\"text-indent:2em\">拥有一个length属性和若干索引属性的对象，常见的有 <code>arguments、document.forms、document.getElementsByClassName</code>。arguments 是函数中自动创建的一种类数组对象，用来模拟函数重载效果（根据传入参数个数执行不同函数）。</div><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 转换为数组</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arrayLike = &#123; <span class=\"string\">'0'</span> : <span class=\"string\">'a'</span>,<span class=\"string\">'1'</span> : <span class=\"string\">'b'</span>, <span class=\"attr\">length</span> : <span class=\"number\">3</span> &#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr1 = <span class=\"built_in\">Array</span>.prototype.slice.call(arrayLike);</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr2 = [].slice.call(arrayLike);</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr3 = <span class=\"built_in\">Array</span>.from(arrayLike);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// arguments 重载</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> checkout = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  　　<span class=\"keyword\">if</span>(<span class=\"built_in\">arguments</span>.length==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">  　　　　<span class=\"built_in\">console</span>.log(<span class=\"string\">\"微信\"</span>);</span><br><span class=\"line\">  　　&#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"built_in\">arguments</span>.length==<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">  　　　　<span class=\"built_in\">console</span>.log(<span class=\"string\">\"现金\"</span>);</span><br><span class=\"line\">  　　&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">  　　　　<span class=\"built_in\">console</span>.log(<span class=\"string\">\"刷卡\"</span>);</span><br><span class=\"line\">  　　&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">checkout();      <span class=\"comment\">// 微信</span></span><br><span class=\"line\">checkout(<span class=\"number\">100</span>);   <span class=\"comment\">// 现金</span></span><br><span class=\"line\">checkout(<span class=\"number\">1</span>, <span class=\"number\">2</span>);  <span class=\"comment\">// 刷卡</span></span><br></pre></td></tr></table></figure><h1 id=\"三、数组\"><a href=\"#三、数组\" class=\"headerlink\" title=\"三、数组\"></a>三、数组</h1><blockquote><p>一组数据的有序集合，表现形式是内存中的一段连续的内存地址</p></blockquote><h2 id=\"创建-2\"><a href=\"#创建-2\" class=\"headerlink\" title=\"创建\"></a>创建</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 直接创建 </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = []            <span class=\"comment\">// 空数组</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr2 = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]    <span class=\"comment\">// 三个元素</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 通过构造函数</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr1 = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>()    <span class=\"comment\">// 空数组</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr2 = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>(<span class=\"number\">10</span>)    <span class=\"comment\">// 长度为10 </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr3 =  <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>(<span class=\"number\">1</span>, <span class=\"number\">2</span>)   <span class=\"comment\">// 两个元素</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 数组中是否存在下标为 1 的元素</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"keyword\">in</span> arr</span><br></pre></td></tr></table></figure><h2 id=\"拷贝-1\"><a href=\"#拷贝-1\" class=\"headerlink\" title=\"拷贝\"></a>拷贝</h2><ul><li>浅拷贝<ul><li><code>arr.slice(0)、arr.concat()</code></li><li>如果数组元素都是基本类型，原始数组和目标数组的修改互不影响</li><li>如果数组元素是对象或数组，这样会只拷贝引用而导致修改时相互影响</li></ul></li><li>深拷贝<ul><li><code>JSON.parse(JSON.stringify(arr))</code></li><li>不论数组元素是什么类型，原始数组和目标数组的修改都会互不影响</li></ul></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 浅拷贝</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> shallowCopy = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">obj</span>) </span>&#123; </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> obj !== <span class=\"string\">'object'</span>) <span class=\"keyword\">return</span>; </span><br><span class=\"line\">  <span class=\"keyword\">var</span> newObj = obj <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Array</span> ? [] : &#123;&#125;; </span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> key <span class=\"keyword\">in</span> obj) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (obj.hasOwnProperty(key)) &#123;</span><br><span class=\"line\">      newObj[key] = obj[key];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> newObj;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 深拷贝</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> deepCopy = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> obj !== <span class=\"string\">'object'</span>) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> newObj = obj <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Array</span> ? [] : &#123;&#125;;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> key <span class=\"keyword\">in</span> obj) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (obj.hasOwnProperty(key)) &#123;</span><br><span class=\"line\">      newObj[key] = <span class=\"keyword\">typeof</span> obj[key] === <span class=\"string\">'object'</span> ? deepCopy(obj[key]) : obj[key];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> newObj;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"特殊数组\"><a href=\"#特殊数组\" class=\"headerlink\" title=\"特殊数组\"></a>特殊数组</h2><ul><li>多维数组：元素是数组</li><li>稀疏数组：索引不连续，length值大于实际元素个数</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 二维数组</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [ [<span class=\"number\">1</span>, <span class=\"number\">2</span>], [<span class=\"number\">1</span>, ‘good’] ]</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr[<span class=\"number\">0</span>][<span class=\"number\">0</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 稀疏数组</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [];</span><br><span class=\"line\">arr[<span class=\"number\">20</span>] = <span class=\"string\">\"hello\"</span>;</span><br></pre></td></tr></table></figure><h2 id=\"操作方法\"><a href=\"#操作方法\" class=\"headerlink\" title=\"操作方法\"></a>操作方法</h2><ol><li>基础<ul><li>读写：<code>索引/属性</code></li><li>添加：<code>arr[index] = new</code></li><li>删除：<code>delete arr[index]</code></li><li>遍历：<code>for</code></li></ul></li><li>ES3<ul><li>添加：<code>push、unshift、concat</code></li><li>删除：<code>pop、shift</code></li><li>裁剪：<code>slice、splice</code></li><li>排序：<code>sort、reverse</code></li><li>转换：<code>join、toString</code></li></ul></li><li>ES5<ul><li>位置：<code>indexOf、lastIndexOf</code></li><li>迭代：<code>every、some、filter、forEach、map</code></li><li>累计：<code>reduce</code></li></ul></li></ol><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">// 元素读写</span></span><br><span class=\"line\"> <span class=\"keyword\">var</span> arr = [<span class=\"number\">2</span>, <span class=\"number\">1</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\"> consloe.log(arr.length)</span><br><span class=\"line\"> consloe.log(arr[<span class=\"number\">0</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"> arr[<span class=\"number\">1</span>] = <span class=\"number\">1</span></span><br><span class=\"line\"> arr[<span class=\"number\">-1.23</span>] = <span class=\"literal\">true</span>  <span class=\"comment\">// 超出范围时就不是索引，而是属性</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">// 判断是否数组</span></span><br><span class=\"line\"> <span class=\"built_in\">Array</span>.isArray(arr)   </span><br><span class=\"line\"> arr <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Array</span></span><br><span class=\"line\"> arr.constructor === <span class=\"built_in\">Array</span></span><br><span class=\"line\"> arr.prototype.toString.apply([<span class=\"built_in\">Array</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">// 判断元素         </span></span><br><span class=\"line\"> arr.every(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">item</span>)</span>&#123;</span><br><span class=\"line\">     <span class=\"keyword\">return</span> item &amp;gt; <span class=\"number\">5</span></span><br><span class=\"line\"> &#125;) </span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">// 排序</span></span><br><span class=\"line\">arr.sort(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a, b</span>)</span>&#123; </span><br><span class=\"line\">     <span class=\"keyword\">return</span> a-b</span><br><span class=\"line\"> &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">// 遍历</span></span><br><span class=\"line\"> arr.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value, index, arr</span>)</span>&#123; &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">// 映射返回新数组，原数组不改变</span></span><br><span class=\"line\"> arr.map(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value, index, arr</span>)</span>&#123; </span><br><span class=\"line\">     <span class=\"keyword\">return</span> value * <span class=\"number\">2</span>    </span><br><span class=\"line\"> &#125;)</span><br><span class=\"line\"> arr.map(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item + <span class=\"number\">10</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">// 过滤不符合条件的元素</span></span><br><span class=\"line\"> arr.filter(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value, index</span>)</span>&#123; </span><br><span class=\"line\">     <span class=\"keyword\">return</span> value % <span class=\"number\">2</span> !== <span class=\"number\">0</span></span><br><span class=\"line\"> &#125;)          </span><br><span class=\"line\"> </span><br><span class=\"line\"> <span class=\"comment\">// 累计</span></span><br><span class=\"line\"> arr.reduce(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">x, y</span>)</span>&#123; </span><br><span class=\"line\">     <span class=\"keyword\">return</span> x + y</span><br><span class=\"line\"> &#125;)</span><br></pre></td></tr></table></figure><h2 id=\"扩展方法-1\"><a href=\"#扩展方法-1\" class=\"headerlink\" title=\"扩展方法\"></a>扩展方法</h2><h3 id=\"求最值\"><a href=\"#求最值\" class=\"headerlink\" title=\"求最值\"></a>求最值</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 最大值</span></span><br><span class=\"line\"><span class=\"built_in\">Math</span>.max(...arr)</span><br><span class=\"line\"><span class=\"built_in\">Math</span>.max.apply(<span class=\"literal\">null</span>, arr)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 最小值</span></span><br><span class=\"line\"><span class=\"built_in\">Math</span>.min(...arr)</span><br><span class=\"line\"><span class=\"built_in\">Math</span>.min.apply(<span class=\"literal\">null</span>, arr)</span><br></pre></td></tr></table></figure><h3 id=\"数组去重\"><a href=\"#数组去重\" class=\"headerlink\" title=\"数组去重\"></a>数组去重</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ES6 Set 有元素唯一的特性</span></span><br><span class=\"line\">[...new <span class=\"built_in\">Set</span>(arr)]  </span><br><span class=\"line\"><span class=\"built_in\">Array</span>.from(<span class=\"keyword\">new</span> <span class=\"built_in\">Set</span>(arr))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 添加原型方法</span></span><br><span class=\"line\"><span class=\"built_in\">Array</span>.prototype.distinct = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> arr = <span class=\"keyword\">this</span>,</span><br><span class=\"line\">        result = [],</span><br><span class=\"line\">        len = arr.length;</span><br><span class=\"line\"></span><br><span class=\"line\">    arr.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">v, i ,arr</span>)</span>&#123;   </span><br><span class=\"line\">        <span class=\"keyword\">var</span> bool = arr.indexOf(v, i+<span class=\"number\">1</span>);   </span><br><span class=\"line\">        <span class=\"keyword\">if</span>(bool === <span class=\"number\">-1</span>)&#123;</span><br><span class=\"line\">            result.push(v);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">arr.distinct()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 普通封装</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">arry_unique</span>(<span class=\"params\">array</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> res = [];</span><br><span class=\"line\">    <span class=\"keyword\">var</span> json = &#123;&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &amp;lt; array.length; i++)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!json[array[i]])&#123;</span><br><span class=\"line\">            res.push(array[i]);</span><br><span class=\"line\">            json[array[i]] = <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h3 id=\"数据过滤\"><a href=\"#数据过滤\" class=\"headerlink\" title=\"数据过滤\"></a>数据过滤</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> filterArr = <span class=\"function\"><span class=\"params\">items</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> items.filter(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">item</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 遍历 item 对象里面的键值是否符合回调函数的测试</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.keys(item).some(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">key</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">String</span>(item[key]).toLowerCase().match(searchVal)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h1 id=\"四、Base64\"><a href=\"#四、Base64\" class=\"headerlink\" title=\"四、Base64\"></a>四、Base64</h1><blockquote><p>基于 64 个可打印字符 <code>A-Z、a-z、0-9、+、/</code> 来表示二进制数据的一种方法</p></blockquote><h2 id=\"产生\"><a href=\"#产生\" class=\"headerlink\" title=\"产生\"></a>产生</h2><ul><li>需求<ul><li>网络传输中文时容易出现乱码情况</li><li>网络传输图片等文件的字符并不全是可打印的字符</li><li>电子邮件早期只能传输英文，中文字符不能被服务器处理</li></ul></li><li>适用场景<ul><li>当访问外部资源很麻烦或受限时</li><li>当图片的体积太小，占用一个 HTTP 会话不是很值得时</li><li>当图片是在服务器端用程序动态生成，各个访问用户显示不同时</li></ul></li><li>图片应用<ul><li>主流浏览器都支持基于 Base64 编码的 dataURL 字符串 作为图片地址，<a href=\"http://imgbase64.duoshitong.com/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">图片在线转码</a></li><li>图片上传服务器时需要纯字符串形式，截取 data:image/png;base64, 后面的字符串即可上传</li></ul></li></ul><h2 id=\"编码\"><a href=\"#编码\" class=\"headerlink\" title=\"编码\"></a>编码</h2><blockquote><p>一种将二进制序列的数据转换为字符串的编码算法，只是无法直接看到明文但并非加密</p></blockquote><ul><li>理解<ul><li>字节 byte 是存储二进制数据的基本单位</li><li>中文有 utf-8、gbk 等多种编码，不同编码对应的结果都不一样</li><li>对于图片、文本和音视频等数据，只有转换为 二进制序列 之后才能进行 Base64 编码</li><li>编码后的数据体积一般会变大，而且 base64Url 形式的图片不会被浏览器缓存，每次访问这样页面时都被下载一次，所以不适合被大量使用</li></ul></li><li>规则<ol><li>将每三个字节作为一组，一共是 24 个二进制位</li><li>将 24 个二进制位分为四组，每个组有 6 个二进制位</li><li>在每组前面加两个00，扩展为 32 个二进制位，即 4 个字节</li><li>根据 base64 编码对照表转换为扩展后的每个字节的对应字符</li></ol></li></ul><h2 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h2><h3 id=\"浏览器原生实现\"><a href=\"#浏览器原生实现\" class=\"headerlink\" title=\"浏览器原生实现\"></a>浏览器原生实现</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编码</span></span><br><span class=\"line\"><span class=\"built_in\">window</span>.btoa(<span class=\"string\">'xiaomabuhei'</span>)  </span><br><span class=\"line\"><span class=\"comment\">// 解码</span></span><br><span class=\"line\"><span class=\"built_in\">window</span>.atob(<span class=\"string\">'eGlhb21hYnVoZWk='</span>)          </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 中文编码时需要先进行 URI 组件编码</span></span><br><span class=\"line\"><span class=\"built_in\">window</span>.btoa(<span class=\"built_in\">window</span>.encodeURIComponent(<span class=\"string\">'小马不黑'</span>))</span><br><span class=\"line\"><span class=\"built_in\">window</span>.decodeURIComponent(<span class=\"built_in\">window</span>.atob(baseStr))</span><br></pre></td></tr></table></figure><h3 id=\"js-实现\"><a href=\"#js-实现\" class=\"headerlink\" title=\"js 实现\"></a>js 实现</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Base64 = &#123;</span><br><span class=\"line\">  _keyStr: <span class=\"string\">\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\"</span>,</span><br><span class=\"line\"></span><br><span class=\"line\">  encode: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">input</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> output = <span class=\"string\">\"\"</span>;  </span><br><span class=\"line\">    <span class=\"keyword\">var</span> chr1, chr2, chr3, enc1, enc2, enc3, enc4;  </span><br><span class=\"line\">    <span class=\"keyword\">var</span> i = <span class=\"number\">0</span>;  </span><br><span class=\"line\">    input = Base64._utf8_encode(input);  </span><br><span class=\"line\">    <span class=\"keyword\">while</span> (i &amp;lt; input.length) &#123;  </span><br><span class=\"line\">        chr1 = input.charCodeAt(i++);  </span><br><span class=\"line\">        chr2 = input.charCodeAt(i++);  </span><br><span class=\"line\">        chr3 = input.charCodeAt(i++);  </span><br><span class=\"line\">        enc1 = chr1 &amp;gt;&amp;gt; <span class=\"number\">2</span>;  </span><br><span class=\"line\">        enc2 = ((chr1 &amp; <span class=\"number\">3</span>) &amp;lt;&amp;lt; <span class=\"number\">4</span>) | (chr2 &amp;gt;&amp;gt; <span class=\"number\">4</span>);  </span><br><span class=\"line\">        enc3 = ((chr2 &amp; <span class=\"number\">15</span>) &amp;lt;&amp;lt; <span class=\"number\">2</span>) | (chr3 &amp;gt;&amp;gt; <span class=\"number\">6</span>);  </span><br><span class=\"line\">        enc4 = chr3 &amp; <span class=\"number\">63</span>;  </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"built_in\">isNaN</span>(chr2)) &#123;  </span><br><span class=\"line\">            enc3 = enc4 = <span class=\"number\">64</span>;  </span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"built_in\">isNaN</span>(chr3)) &#123;  </span><br><span class=\"line\">            enc4 = <span class=\"number\">64</span>;  </span><br><span class=\"line\">        &#125;  </span><br><span class=\"line\">        output = output +  </span><br><span class=\"line\">        _keyStr.charAt(enc1) + _keyStr.charAt(enc2) +  </span><br><span class=\"line\">        _keyStr.charAt(enc3) + _keyStr.charAt(enc4);  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> output; </span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  decode: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">input</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> output = <span class=\"string\">\"\"</span>;  </span><br><span class=\"line\">    <span class=\"keyword\">var</span> chr1, chr2, chr3;  </span><br><span class=\"line\">    <span class=\"keyword\">var</span> enc1, enc2, enc3, enc4;  </span><br><span class=\"line\">    <span class=\"keyword\">var</span> i = <span class=\"number\">0</span>;  </span><br><span class=\"line\">    input = input.replace(<span class=\"regexp\">/[^A-Za-z0-9\\+\\/\\=]/g</span>, <span class=\"string\">\"\"</span>);  </span><br><span class=\"line\">    <span class=\"keyword\">while</span> (i &amp;lt; input.length) &#123;  </span><br><span class=\"line\">        enc1 = _keyStr.indexOf(input.charAt(i++));  </span><br><span class=\"line\">        enc2 = _keyStr.indexOf(input.charAt(i++));  </span><br><span class=\"line\">        enc3 = _keyStr.indexOf(input.charAt(i++));  </span><br><span class=\"line\">        enc4 = _keyStr.indexOf(input.charAt(i++));  </span><br><span class=\"line\">        chr1 = (enc1 &amp;lt;&amp;lt; <span class=\"number\">2</span>) | (enc2 &amp;gt;&amp;gt; <span class=\"number\">4</span>);  </span><br><span class=\"line\">        chr2 = ((enc2 &amp; <span class=\"number\">15</span>) &amp;lt;&amp;lt; <span class=\"number\">4</span>) | (enc3 &amp;gt;&amp;gt; <span class=\"number\">2</span>);  </span><br><span class=\"line\">        chr3 = ((enc3 &amp; <span class=\"number\">3</span>) &amp;lt;&amp;lt; <span class=\"number\">6</span>) | enc4;  </span><br><span class=\"line\">        output = output + <span class=\"built_in\">String</span>.fromCharCode(chr1);  </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (enc3 != <span class=\"number\">64</span>) &#123;  </span><br><span class=\"line\">            output = output + <span class=\"built_in\">String</span>.fromCharCode(chr2);  </span><br><span class=\"line\">        &#125;  </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (enc4 != <span class=\"number\">64</span>) &#123;  </span><br><span class=\"line\">            output = output + <span class=\"built_in\">String</span>.fromCharCode(chr3);  </span><br><span class=\"line\">        &#125;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">    output = Base64._utf8_decode(output);  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> output;  </span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  _utf8_encode: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">string</span>) </span>&#123;</span><br><span class=\"line\">    string = string.replace(<span class=\"regexp\">/\\r\\n/g</span>, <span class=\"string\">\"\\n\"</span>);  </span><br><span class=\"line\">    <span class=\"keyword\">var</span> utftext = <span class=\"string\">\"\"</span>;  </span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> n = <span class=\"number\">0</span>; n &amp;lt; string.length; n++) &#123;  </span><br><span class=\"line\">        <span class=\"keyword\">var</span> c = string.charCodeAt(n);  </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (c &amp;lt; <span class=\"number\">128</span>) &#123;  </span><br><span class=\"line\">            utftext += <span class=\"built_in\">String</span>.fromCharCode(c);  </span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>((c &amp;gt; <span class=\"number\">127</span>) &amp;&amp; (c &amp;lt; <span class=\"number\">2048</span>)) &#123;  </span><br><span class=\"line\">            utftext += <span class=\"built_in\">String</span>.fromCharCode((c &amp;gt;&amp;gt; <span class=\"number\">6</span>) | <span class=\"number\">192</span>);  </span><br><span class=\"line\">            utftext += <span class=\"built_in\">String</span>.fromCharCode((c &amp; <span class=\"number\">63</span>) | <span class=\"number\">128</span>);  </span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;  </span><br><span class=\"line\">            utftext += <span class=\"built_in\">String</span>.fromCharCode((c &amp;gt;&amp;gt; <span class=\"number\">12</span>) | <span class=\"number\">224</span>);  </span><br><span class=\"line\">            utftext += <span class=\"built_in\">String</span>.fromCharCode(((c &amp;gt;&amp;gt; <span class=\"number\">6</span>) &amp; <span class=\"number\">63</span>) | <span class=\"number\">128</span>);  </span><br><span class=\"line\">            utftext += <span class=\"built_in\">String</span>.fromCharCode((c &amp; <span class=\"number\">63</span>) | <span class=\"number\">128</span>);  </span><br><span class=\"line\">        &#125;  </span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> utftext; </span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  _utf8_decode: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> string = <span class=\"string\">\"\"</span>;  </span><br><span class=\"line\">    <span class=\"keyword\">var</span> i = <span class=\"number\">0</span>;  </span><br><span class=\"line\">    <span class=\"keyword\">var</span> c = c1 = c2 = <span class=\"number\">0</span>;  </span><br><span class=\"line\">    <span class=\"keyword\">while</span> ( i &amp;lt; utftext.length ) &#123;  </span><br><span class=\"line\">        c = utftext.charCodeAt(i);  </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (c &amp;lt; <span class=\"number\">128</span>) &#123;  </span><br><span class=\"line\">            string += <span class=\"built_in\">String</span>.fromCharCode(c);  </span><br><span class=\"line\">            i++;  </span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>((c &amp;gt; <span class=\"number\">191</span>) &amp;&amp; (c &amp;lt; <span class=\"number\">224</span>)) &#123;  </span><br><span class=\"line\">            c2 = utftext.charCodeAt(i+<span class=\"number\">1</span>);  </span><br><span class=\"line\">            string += <span class=\"built_in\">String</span>.fromCharCode(((c &amp; <span class=\"number\">31</span>) &amp;lt;&amp;lt; <span class=\"number\">6</span>) | (c2 &amp; <span class=\"number\">63</span>));  </span><br><span class=\"line\">            i += <span class=\"number\">2</span>;  </span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;  </span><br><span class=\"line\">            c2 = utftext.charCodeAt(i+<span class=\"number\">1</span>);  </span><br><span class=\"line\">            c3 = utftext.charCodeAt(i+<span class=\"number\">2</span>);  </span><br><span class=\"line\">            string += <span class=\"built_in\">String</span>.fromCharCode(((c &amp; <span class=\"number\">15</span>) &amp;lt;&amp;lt; <span class=\"number\">12</span>) | ((c2 &amp; <span class=\"number\">63</span>) &amp;lt;&amp;lt; <span class=\"number\">6</span>) | (c3 &amp; <span class=\"number\">63</span>));  </span><br><span class=\"line\">            i += <span class=\"number\">3</span>;  </span><br><span class=\"line\">        &#125;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> string;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"图片转换\"><a href=\"#图片转换\" class=\"headerlink\" title=\"图片转换\"></a>图片转换</h2><blockquote><p>将网络或本地图片的地址转为 base64 格式</p></blockquote><h3 id=\"canvas\"><a href=\"#canvas\" class=\"headerlink\" title=\"canvas\"></a>canvas</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getBase64Img</span>(<span class=\"params\">img</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"canvas\"</span>);</span><br><span class=\"line\">    canvas.width = img.width;</span><br><span class=\"line\">    canvas.height = img.height;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ctx = canvas.getContext(<span class=\"string\">\"2d\"</span>);</span><br><span class=\"line\">    ctx.drawImage(img, <span class=\"number\">0</span>, <span class=\"number\">0</span>, img.width, img.height);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ext = img.src.substring(img.src.lastIndexOf(<span class=\"string\">\".\"</span>) + <span class=\"number\">1</span>).toLowerCase();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> dataURL = canvas.toDataURL(<span class=\"string\">\"image/\"</span> + ext);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> dataURL;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// Base64 字符串转二进制</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">base64ToBlob</span>(<span class=\"params\">dataurl</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 去头并转为 byte</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> arr = dataurl.split(<span class=\"string\">','</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 处理异常：将 ASCII 码小于0的转换为大于0</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> mime = arr[<span class=\"number\">0</span>].match(<span class=\"regexp\">/:(.*?);/</span>)[<span class=\"number\">1</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 解码</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> bytes = <span class=\"built_in\">window</span>.atob(arr[<span class=\"number\">1</span>]);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> n = bytes.length;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 生成视图（直接针对内存）：8位无符号整数，长度1个字节</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> u8arr = <span class=\"keyword\">new</span> <span class=\"built_in\">Uint8Array</span>(n);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (n--) &#123;</span><br><span class=\"line\">        u8arr[n] = bytes.charCodeAt(n);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Blob([u8arr], &#123; <span class=\"attr\">type</span>: mime &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> image = <span class=\"keyword\">new</span> Image();</span><br><span class=\"line\">image.src = <span class=\"string\">\"img_url\"</span>;</span><br><span class=\"line\">image.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> base64 = getBase64Img(image);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> file = base64ToBlob(base64);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getBase64Image</span>(<span class=\"params\">url, quality = <span class=\"number\">0.5</span></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> img = <span class=\"keyword\">new</span> Image();</span><br><span class=\"line\">    img.src = url</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> &#123;</span><br><span class=\"line\">        img.onload = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"canvas\"</span>);</span><br><span class=\"line\">            canvas.width = img.width;</span><br><span class=\"line\">            canvas.height = img.height;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> ctx = canvas.getContext(<span class=\"string\">\"2d\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            ctx.drawImage(img, <span class=\"number\">0</span>, <span class=\"number\">0</span>, img.width, img.height);</span><br><span class=\"line\">            dataURL = canvas.toDataURL(<span class=\"string\">'image/jpeg'</span>, quality);</span><br><span class=\"line\">            resolve(dataURL)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">getBase64Image(<span class=\"string\">\"./pic.png\"</span>, <span class=\"number\">0.8</span>).then(<span class=\"function\"><span class=\"params\">dataURL</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(dataURL)</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'img'</span>).src = dataURL</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h3 id=\"html2canvas\"><a href=\"#html2canvas\" class=\"headerlink\" title=\"html2canvas\"></a>html2canvas</h3><blockquote><p>截图功能：将 html 页面转化为图片</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html2canvas(<span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'img'</span>), &#123;<span class=\"attr\">useCORS</span>: <span class=\"literal\">true</span>&#125;).then(<span class=\"function\"><span class=\"params\">canvas</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> base64 = canvas.toDataURL(<span class=\"string\">\"image/jpeg\"</span>, <span class=\"number\">0.1</span>);</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.appendChild(canvas);</span><br><span class=\"line\">    <span class=\"comment\">// downloadImg(base64, \"meme.png\")  // 下载图片</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">downloadImg</span>(<span class=\"params\">base64, imgName</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> a = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"a\"</span>);</span><br><span class=\"line\">    a.href = base64;</span><br><span class=\"line\">    a.download = imgName;</span><br><span class=\"line\">    a.click();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h3 id=\"Node-js\"><a href=\"#Node-js\" class=\"headerlink\" title=\"Node.js\"></a>Node.js</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 通过 fs.readFile</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>);</span><br><span class=\"line\">fs.readFile(<span class=\"string\">'./a.png'</span>, <span class=\"string\">'base64'</span>, (err, data) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 图片需要在 data 前添加 'data:image/png;base64,'</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(data)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 通过 fs.createReadStream</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> readStream = fs.createReadStream(<span class=\"string\">'./pic.png'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">readStream.on(<span class=\"string\">'data'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">chunk</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(chunk.toString(<span class=\"string\">'base64'</span>)) </span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h3 id=\"Buffer\"><a href=\"#Buffer\" class=\"headerlink\" title=\"Buffer\"></a>Buffer</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> base64 = Buffer.from(<span class=\"string\">'把我转化为base64'</span>).toString(<span class=\"string\">'base64'</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(base64)</span><br></pre></td></tr></table></figure><h1 id=\"五、二进制对象\"><a href=\"#五、二进制对象\" class=\"headerlink\" title=\"五、二进制对象\"></a>五、二进制对象</h1><div style=\"text-indent:2em\">js 最初无法处理文件、网络流等二进制 (编码格式的) 数据，只能先使用 charCodeAt() 逐字节读取 或者 转换为 Base64 格式，但是处理速度慢而且容易出错。js 后来通过引入 API 逐渐可以处理二进制数据，但是标准库里没有相关内容，所以 NodeJs 就自己搞了一套，现在 Web 自己也搞起来了，这就导致了 Web 环境和 Node 环境里的二进制内容处理方式有些不同。</div><h2 id=\"通用\"><a href=\"#通用\" class=\"headerlink\" title=\"通用\"></a>通用</h2><div style=\"text-indent:2em\"><code>ArrayBuffer 对象</code> 表示内存中存储了一段二进制数据的原始缓冲区，它不能直接读写，只能通过 <code>TypedArray/DataView 视图</code> 转换为类型化数组之后来读写。同一段内存的不同数据有不同的读取方式，对应不同的视图。视图的作用是以指定格式读写二进制数据但本身并不存储，本质是二进制数据的抽象数据结构，两种视图的区别在于字节序，TypedArray 视图的数组成员都是同一个数据类型，DataView 视图的数组成员可以是不同的数据类型。。</div><h3 id=\"ArrayBuffer\"><a href=\"#ArrayBuffer\" class=\"headerlink\" title=\"ArrayBuffer\"></a>ArrayBuffer</h3><blockquote><p>用于存储二进制数据，本质是一串数字组成的乱码但没有格式，不能直接被访问</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 创建一个 8 字节的缓冲区对象</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> buffer = <span class=\"keyword\">new</span> <span class=\"built_in\">ArrayBuffer</span>(<span class=\"number\">8</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 字节长度 8</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(buffer.byteLength);   </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 参数是否为视图实例</span></span><br><span class=\"line\"><span class=\"built_in\">ArrayBuffer</span>.isView(buffer) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 裁剪缓冲区</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> buffer1 = buffer.slice(<span class=\"number\">0</span>, <span class=\"number\">1</span>)</span><br></pre></td></tr></table></figure><h3 id=\"TypedArray\"><a href=\"#TypedArray\" class=\"headerlink\" title=\"TypedArray\"></a>TypedArray</h3><blockquote><p>成员为相同的数据类型</p></blockquote><ul><li>本质：一组类的统称，它们的实例都是类数组对象</li><li>语法：和普通数组语法相同，但是其元素的数据类型相同而且没有空位</li><li><p>API：</p><ul><li>有符号整数：Int8Array、Int16Array、Int32Array</li><li>无符号整数：Uint8Array、Uint16Array、Uint32Array</li><li>浮点数：Float32Array、Float64Array</li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 直接生成视图，默认生成底层 ArrayBuffer 实例并赋值</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> f = <span class=\"keyword\">new</span> <span class=\"built_in\">Float64Array</span>(<span class=\"number\">8</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 通过 buffer 生成视图，默认全部内容，参数为 buffer、开始索引、长度</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> buffer = <span class=\"keyword\">new</span> <span class=\"built_in\">ArrayBuffer</span>(<span class=\"number\">4</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> a = <span class=\"keyword\">new</span> <span class=\"built_in\">Int8Array</span>(buffer)   </span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"keyword\">new</span> <span class=\"built_in\">Uint32Array</span>(buffer, <span class=\"number\">0</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"keyword\">new</span> <span class=\"built_in\">Uint8Array</span>(buffer, <span class=\"number\">1</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 操作视图元素</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>; i &amp;lt; f.byteLength; i++)&#123; &#125;</span><br><span class=\"line\">f[<span class=\"number\">1</span>] = <span class=\"number\">10</span>        <span class=\"comment\">// [0, 10]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 与普通数组互转</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = <span class=\"built_in\">Array</span>.from(f) </span><br><span class=\"line\">arr_2 = <span class=\"built_in\">Array</span>.apply([], t)</span><br><span class=\"line\"><span class=\"keyword\">var</span> u = <span class=\"keyword\">new</span> <span class=\"built_in\">Uint8Array</span>([ <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span> ])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 与字符串互转</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> str = <span class=\"built_in\">String</span>.fromCharCode.apply(<span class=\"literal\">null</span>, buffer)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">strToBuf</span> (<span class=\"params\">str</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每个字符占用2个字节</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> buf = <span class=\"keyword\">new</span> <span class=\"built_in\">ArrayBuffer</span>(str.length*<span class=\"number\">2</span>)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> bufView = <span class=\"keyword\">new</span> <span class=\"built_in\">Uint16Array</span>(buf)</span><br><span class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>; i &amp;lt; str.length; i++)&#123;</span><br><span class=\"line\">      bufView[i] = str.charCodeAt(i)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> bufView;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id=\"DataView\"><a href=\"#DataView\" class=\"headerlink\" title=\"DataView\"></a>DataView</h3><blockquote><p>TypedArray 的强化版，成员可以是不同的数据类型，而且读写时可以自行设定 大/小 端字节序</p></blockquote><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> buffer = <span class=\"keyword\">new</span> <span class=\"built_in\">ArrayBuffer</span>(<span class=\"number\">4</span>)</span><br><span class=\"line\"><span class=\"keyword\">let</span> dataView = <span class=\"keyword\">new</span> <span class=\"built_in\">DataView</span>(buffer)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 独有方法，写入参数是 开始位置、写入数据、大/小端读取</span></span><br><span class=\"line\">dataView.getInt8(<span class=\"number\">0</span>)</span><br><span class=\"line\">dataView.setInt8(<span class=\"number\">0</span>, <span class=\"number\">10</span>)</span><br><span class=\"line\">dataView.setInt32(<span class=\"number\">0</span>, <span class=\"number\">25</span>, <span class=\"literal\">false</span>)</span><br></pre></td></tr></table></figure><h2 id=\"web-环境特有\"><a href=\"#web-环境特有\" class=\"headerlink\" title=\"web 环境特有\"></a>web 环境特有</h2><h3 id=\"Blob\"><a href=\"#Blob\" class=\"headerlink\" title=\"Blob\"></a>Blob</h3><blockquote><p>表示一个不可变的文件对象，它提供了一系列操作文件的接口</p></blockquote><ol><li>创建方式<ul><li>构造函数：<code>new Blob(dataArr, options)</code><ul><li>dataArr：必选数组，数组成员可以是二进制对象或字符串</li><li>options：可选对象，用于设置数组中数据的 MIME 类型</li></ul></li><li>slice 方法：<code>blob.slice(start, end, contentType)</code><ul><li>从已有的 Blob 对象调用 slice 接口切出一个新的 Blob 对象</li><li>contentType：可选，规定新 Blob 对象的类型</li></ul></li><li>canvas 对象：<code>canvas.toBlob(callback, type, options)</code><ul><li>把当前绘制信息转为一个 Blob 对象</li></ul></li></ul></li><li><p>属性与方法</p><ul><li>属性<ul><li>size：对象的字节长度</li><li>type：对象的数据类型</li><li>isClosed: 该对象是否调用过 close()</li></ul></li><li>方法<ul><li>close：释放对象</li><li>slice：裁剪并返回新对象</li></ul></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// String 转为 Blob</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> blob = <span class=\"keyword\">new</span> Blob([<span class=\"string\">\"Hello World\"</span>], &#123;<span class=\"attr\">type</span>:<span class=\"string\">\"text/plain\"</span>&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ArrayBuffer 转为 Blob</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> buffer = <span class=\"keyword\">new</span> <span class=\"built_in\">ArrayBuffer</span>(<span class=\"number\">8</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> blob = <span class=\"keyword\">new</span> Blob([buffer], &#123;<span class=\"attr\">type</span>:<span class=\"string\">\"text/plain\"</span>&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// TypeArray 转为 Blob</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> uArr = <span class=\"keyword\">new</span> <span class=\"built_in\">Uint16Array</span>([<span class=\"number\">97</span>, <span class=\"number\">32</span>, <span class=\"number\">72</span>, <span class=\"number\">100</span>]);</span><br><span class=\"line\"><span class=\"keyword\">var</span> blob = <span class=\"keyword\">new</span> Blob([uArr]);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> blob = blob_2.slice(<span class=\"number\">1</span>, <span class=\"number\">5</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"canvas\"</span>);</span><br><span class=\"line\">canvas.toBlob(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">blob</span>)</span>&#123;</span><br><span class=\"line\">   <span class=\"built_in\">console</span>.log(blob);</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></li></ol><h3 id=\"Blob-派生对象\"><a href=\"#Blob-派生对象\" class=\"headerlink\" title=\"Blob 派生对象\"></a>Blob 派生对象</h3><blockquote><p>blob 对象是它们的底层对象，它们都是继承 blob 对象并进行了扩展，但其内容一样无法修改</p></blockquote><h4 id=\"File-对象\"><a href=\"#File-对象\" class=\"headerlink\" title=\"File 对象\"></a>File 对象</h4><ul><li>功能：保存文件的相关信息并允许 Js 访问</li><li>分类<ul><li>input 元素上选择文件后返回的 FileList 对象</li><li>普通元素被自由拖拽时返回的 DataTransfer 对象</li><li>HTMLCanvasElement 上执行 mozGetAsFile() 方法后返回的结果</li></ul></li></ul><h4 id=\"FileReader-对象\"><a href=\"#FileReader-对象\" class=\"headerlink\" title=\"FileReader 对象\"></a>FileReader 对象</h4><ul><li>功能：提供异步读取文件内容或二进制数据的接口</li><li>保存：读取的文件内容会被保存到 result 属性中</li><li>异步读取<ul><li>readAsText(file, encoding)：返回 纯文本。encoding 指定编码格式（默认 ‘UTF-8’）</li><li>readAsDataURL(file)：返回 基于 Base64 编码的 dataURL 字符串（读取图像时常用）</li><li>readAsBinaryString(file)：返回 文件的原始二进制字符串（每个字符表示一字节）</li><li>readAsArrayBuffer(file)：返回 包含文件内容的 ArrayBuffer 对象</li></ul></li><li>中止读取：abort()</li><li>回调函数<ul><li>onload：成功时</li><li>onerror：出错时</li><li>onprogress：更新时</li><li>onloadstart：开始时</li><li>onloadend：完成时</li><li>onabort：中止时</li></ul></li></ul><h4 id=\"URL-对象\"><a href=\"#URL-对象\" class=\"headerlink\" title=\"URL 对象\"></a>URL 对象</h4><ul><li>功能：通过内存文件创建出一个临时指向 File/Blob 对象的 url</li><li>静态方法<ul><li>createObjectURL：生成</li><li>revokeObjectURL：释放</li></ul></li><li>注意事项<ul><li>网页一旦刷新或关闭，已生成的 url 就会失效</li><li>同样的 blob 在不同的事件调用中会得到不同 url</li></ul></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 选择文件后获取文件信息</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fileInput = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">\"#fileInput\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">fileInput.addEventListener(<span class=\"string\">\"change\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> fileList = fileInput.files</span><br><span class=\"line\">    <span class=\"keyword\">var</span> file = fileList[<span class=\"number\">0</span>];</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(file.name, file.size)</span><br><span class=\"line\">&#125;, <span class=\"literal\">false</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 拖动结束时获取被拖动的数据</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> box = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"#box\"</span>);</span><br><span class=\"line\">box.ondrop = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 拖动的默认处理方式是在新窗口打开</span></span><br><span class=\"line\">    event.preventDefault()    </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(event.dataTransfer.files)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 获取文件二进制数据</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> reader = <span class=\"keyword\">new</span> FileReader();</span><br><span class=\"line\">reader.readAsArrayBuffer(file);</span><br><span class=\"line\"></span><br><span class=\"line\">reder.onprogress = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>)</span>&#123; </span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(reader.result)  </span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(e.target.result)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">reader.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123; </span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(reader.result)  </span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(e.target.result)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 在网页插入图片</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> img = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"img\"</span>);</span><br><span class=\"line\">img.src = <span class=\"built_in\">window</span>.URL.createObjectURL(file);</span><br><span class=\"line\">img.width = <span class=\"number\">60</span>;</span><br><span class=\"line\">img.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">window</span>.URL.revokeObjectURL(<span class=\"keyword\">this</span>.src);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">document</span>.body.appendChild(img);</span><br></pre></td></tr></table></figure><h2 id=\"Node-环境特有\"><a href=\"#Node-环境特有\" class=\"headerlink\" title=\"Node 环境特有\"></a>Node 环境特有</h2><h3 id=\"Buffer-1\"><a href=\"#Buffer-1\" class=\"headerlink\" title=\"Buffer\"></a>Buffer</h3><div style=\"text-indent:2em\">Buffer 表示 V8 堆内存之外的一块原始内存，并不会占用 NodeJS 进程内存，常用来存储需要占用大量内存的数据。它继承于 Uint8Array 并实现了更多的接口，对象中的每个元素储存着 2 位 16 进制的数据，代表内存的一个字节。注意一个 Buffer 对象的大小在创建时就会固定下来，即创建之后不可改变。</div><ul><li>创建<ul><li>new Buffer：已经弃用</li><li><strong>Buffer.from</strong>：参数可为 string、buffer、array、object</li><li><strong>Buffer.alloc</strong>：指定大小并已经初始化数据</li><li><strong>Buffer.allocUnsafe</strong>：指定大小但并不初始化数据</li></ul></li><li>读写<ul><li><strong>buf.writexxx</strong>：写入缓冲区</li><li><strong>buf.readxxx</strong>：读取数据</li></ul></li><li>转换<ul><li><strong>buf.toString</strong>：转为字符串</li><li><strong>buf.toJSON</strong>：转为 json</li></ul></li><li>判断<ul><li><strong>Buffer.isEncoding</strong>：编码格式</li><li><strong>Buffer.isBuffer</strong>：对象是否为 Buffer</li></ul></li><li>其它<ul><li><strong>buf.length</strong>：返回字节数</li><li><strong>buf.indexOf</strong>：返回位置</li><li><strong>buf.compare</strong>：对象比较</li><li><strong>buf.fill</strong>：填充数据</li><li><strong>buf.slice</strong>：裁剪</li><li><strong>buf.copy</strong>：拷贝</li></ul></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 创建 </span></span><br><span class=\"line\"><span class=\"keyword\">const</span> buf_1 = Buffer.from([<span class=\"number\">0x62</span>, <span class=\"number\">0x75</span>, <span class=\"number\">0x66</span>, <span class=\"number\">0x66</span>]);</span><br><span class=\"line\"><span class=\"keyword\">const</span> buf = Buffer.from(<span class=\"string\">\"hello\"</span>)   <span class=\"comment\">// 编码格式默认 utf8 </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(buf.length)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> buf_2 = Buffer.alloc(<span class=\"number\">5</span>);       <span class=\"comment\">// 不做任何处理就是 0 填充</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> buf = Buffer.alloc(<span class=\"number\">5</span>, <span class=\"string\">'a'</span>);  <span class=\"comment\">// 以 a 填充</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> buf = Buffer.alloc(<span class=\"number\">10</span>, <span class=\"string\">'aGVsbG8gd29ybGQ='</span>, <span class=\"string\">'base64'</span>);  <span class=\"comment\">// 以 base64 格式填充</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> buf = Buffer.allocUnsafe(<span class=\"number\">10</span>);  <span class=\"comment\">// 只有一个参数</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 拼接</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> buf_3 = Buffer.concat([buf_1, buf_2])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 裁剪</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> buf_2 = buf_1.slice(<span class=\"number\">0</span>, <span class=\"number\">5</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 拷贝</span></span><br><span class=\"line\">buf_2.copy(buf_1, <span class=\"number\">2</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 比较</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> result = buf_1.compare(buf_2);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 读写</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> value = buf.readInt32LE(<span class=\"number\">0</span>)</span><br><span class=\"line\">buf.writeFloatLE(<span class=\"number\">3.</span> <span class=\"number\">16</span>, <span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// buffer 转字符串</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> buf = Buffer.from(<span class=\"string\">'test'</span>)</span><br><span class=\"line\">buf.toString(<span class=\"string\">'utf8'</span>)             <span class=\"comment\">// test</span></span><br><span class=\"line\">buf.toString(<span class=\"string\">'utf8'</span>, <span class=\"number\">0</span>, <span class=\"number\">2</span>)       <span class=\"comment\">// te</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// buffer 转 json</span></span><br><span class=\"line\">buf.toJSON()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// stream 转 buffer</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">streamToBuffer</span>(<span class=\"params\">stream</span>) </span>&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> buffers = [];</span><br><span class=\"line\">        stream.on(<span class=\"string\">'error'</span>, reject);</span><br><span class=\"line\">        stream.on(<span class=\"string\">'data'</span>, (data) =&gt; buffers.push(data))</span><br><span class=\"line\">        stream.on(<span class=\"string\">'end'</span>, () =&gt; resolve(Buffer.concat(buffers))</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// buffer 转 stream</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> Duplex = <span class=\"built_in\">require</span>(<span class=\"string\">'stream'</span>).Duplex;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bufferToStream</span>(<span class=\"params\">buffer</span>) </span>&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">let</span> stream = <span class=\"keyword\">new</span> Duplex();</span><br><span class=\"line\">    stream.push(buffer);</span><br><span class=\"line\">    stream.push(<span class=\"literal\">null</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> stream;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->"},{"title":"WebGL 和 Three.js","top":false,"keywords":["three"],"date":"2019-04-14T15:06:46.000Z","description":"WebGL 概念和绘图流程、Three.js 绘图和构成要素","_content":"\n# 一、WebGL 基础\n\n## OpenGL、WebGL\n  * __OpenGL__：最常用的跨平台图形库，用于渲染 2D、3D 矢量图形的跨语言、跨平台的应用程序编程接口\n  * __OpenGL ES__：OpenGL API 的子集 GPU，是针对手机、PDA 和游戏主机等嵌入式设备而专门设计的接口\n  * __GLSL__：OpenGL ES 着色语言，用于OpenGL中着色编程的语言。在图形卡的GPU上执行，代替了固定的渲染管线的一部分，使渲染管线中不同层次具有可编程性，如视图转换、投影转换等。  \n  * __WebGL__：基于 OpenGL 设计的面向 web 的图形标准，它提供的一系列 Js API 对显卡的硬件细节进行了封装抽象，可用于控制 GPU渲染管线(显卡硬件) 进行图形渲染，从而获得了较高性能。\n  * __WebGL程序__：主要组成是 js控制代码 和 计算机的图形处理单元GPU。而 GPU 核心即着色程序 program 由顶点和片元两个着色器组成，使用 GLSL 编写并通过常以字符串的形式存放在Js中等待调用 (浏览器不识别 GLSL)。\n\n\n## CPU、GPU\n> 图像处理主要偏简单的矩阵运算，逻辑判断等很少。两者的设计架构不同。GPU很适合做简单的并发计算，应用于图像处理、深度学习等领域加快速度，引爆了人工智能\n\n  * __CPU__\n    * 可看作\"万能教授\"，但运算效率较低\n    * 中央处理器，计算机的运算和控制核心\n    * 需要很强的通用性来处理各种不同的数据类型和逻辑判断\n  * __GPU__\n    * 可看作\"专业学生\"，用来实现硬件加速计算，执行重复运算效率高\n    * 图像处理器，是显卡的处理器和核心，也是图像运算工作的微处理器\n    * 专为执行复杂的数学和几何计算而设计，用于将 CPU 从图形处理的任务中解放出来而去执行其他更多的系统任务，提高计算机的整体性能\n\n\n## 图形渲染\n  <div style=\"text-indent: 2em\">渲染是从使用计算机程序模型生成图像的过程。在图形中一个虚拟场景的呈现需要使用 几何、视点、纹理、光照和阴影等通过一个渲染程序传递信息描述，输出一个数字图像。渲染可以在本地或远程上进行。复杂图像所需的硬件资源可以在专用服务器上完成，即基于服务器的绘制。渲染也可以通过在本地CPU完成, 即基于客户端的渲染。所以渲染类型如下：</div>\n\n  * 软件渲染：所有的渲染是在 CPU 的帮助下计算完成。 \n  * 硬件渲染：所有的图形计算都由 GPU (图形处理单元)完成的。\n\n              \n## 图形术语\n  * __坐标系__：x、y、z 轴\n    * 无论画布多大，WebGL 上的坐标被限制为 (1, 1, 1)、(-1, -1, -1)\n    * WebGL 在 GPU 上的主要工作就是将顶点数据通过矩阵变换转换到裁剪空间坐标，然后基于空间坐标绘制像素点\n  * __缓冲__：即将发送到GPU 的一些二进制数据序列\n    * 缓冲区对象用于存储要绘制模型的各种数据，比如顶点、颜色等\n    * 缓冲区对象驻留在 GPU 存储器却可以被直接呈现，提高了性能\n  * __图元__：几何顶点的组合，比如点、线段和三角面\n  * __片元和像素__\n    * 在光栅化中纹理映射之后图元信息转化为了像素\n    * 片元包括 像素点 和 颜色、深度和纹理数据等信息\n  * __网格__：使用顶点所绘的 2D、3D 模型，它的每个面被称为 一个片元 (一般是三角形)\n  * __着色器__\n    * 现代 GPU 中的顶点处理和片段处理等可编程部分被称为着色器\n    * 主要包括顶点着色器和片元着色器，可理解为运行在显卡中的指令和数据\n    * 着色器程序使用的是 GLSL ES 语言，所以在 Js 中需要存放在字符串中等待调用编译，通过编译处理后传递给 顶点/片元 着色器执行\n  * __纹理图像__\n    * 将一张真实图片贴到一个几何图像表面称为 纹理映射，映射的图像为纹理图像\n    * 组成纹理图像的像素称为纹素，而纹理坐标 是纹理图像上的坐标，通过纹理坐标可以在纹理图像上获取纹素颜色\n  * __绘图__\n    * WebGL 中的顶点、颜色、纹理等几何详细信息存储在缓冲区对象，然后被传递到GPU上的着色器程序来创建图形对象\n    * WebGL 只能绘制 点、线和三角形，其他都是由它们合成后绘制到三维空间\n\n\n\n# 二、WebGL 程序\n> 程序代码是 Js、OpenGL 的组合，两者分别负责与 CPU、GPU 通信\n\n## 显卡内部结构 \n> 电脑一般都具有独立显卡\n       \n  * GPU：渲染管线\n    * 功能：和 GPU 传递数据\n    * 内容：可编程的着色器、不可编程的光栅器等     \n  * 显存：GPU 读写数据的存储区  \n    * 顶点缓存：存储顶点的位置、颜色等数据  \n    * 渲染缓存：接收渲染管线生成数据\n    * 纹理缓存：用于实现纹理贴图\n    * 帧缓存 \n      * 分类: 屏幕缓存、离屏缓存\n      * 组成: 颜色缓存、深度缓存、模板缓存\n\n\n## 图像绘制流程\n> 上线网站的 WebGL 相关文件会放在远程的服务器硬盘存储器。网页 http 请求后，CPU 将顶点坐标等数据 和 WebGL 程序代码 传递给 GPU 存储\n\n  1. 浏览器解析硬盘的 WebGL 文件，CPU 分配内存并将数据传递给 GPU 存储数据和程序代码\n  2. CPU 执行程序初始化并调用 GPU 存储的程序代码，初始化着色器时把处理好的 着色器程序 和 矩阵等数据 发送给 GPU 处理器\n  3. GPU 通过矩阵变换和光栅化等操作将图像信息转化为像素并写入显卡的帧缓存 (包括颜色、透明度等)\n  4. 显示器扫描读取显存中的像素数据，然后显示到浏览器 canvas\n\n\n## GPU 处理流程\n> 获取顶点坐标、图元装配(即画出一个个三角形)、光栅化(生成片元, 即一个个像素点)、存储在缓存区\n\n  1. 数据准备\n    * uv：贴图坐标\n    * 索引：三角形绘制顺序\n    * 矩阵数据：uniform 变量传递给顶点着色器\n    * 顶点坐标：attribute 变量传递给顶点着色器，一般由三维软件导出几何体的各个顶点\n  2. 生成顶点着色器\n    * 顶点着色器：Js 定义的程序代码，初始化后会传递给 GPU\n  3. 图元装配\n    * 实现：顶点坐标 转换为图元 (一般是三角形)\n    * 本质：GPU 逐顶点数量执行顶点着色器程序，通过矩阵变换将孤立的顶点坐标处理为 2D 图形并输出\n  4. 生成片元着色器    \n    * 实现：处理模型的颜色、质地、光照效果、阴影\n  5. 光栅化       \n    * 实现：将图元转换为像素点\n    * 片元：一个像素点及其包含的颜色、深度和纹理数据\n    * 本质：GPU 逐片元数量执行片元着色器程序，为每个片元进行着色\n  6. 存储到缓存区    \n    * 片元只要通过了检测和融合 (融合单元主要实现透明度效果)，就可以存储到颜色缓存区，最终完成整个渲染   \n\n\n\n# 三、WebGL 绘图\n\n## 初始化绘图上下文\n  ```js\n  var canvas = document.getElementById(\"canvas\")\n  var gl = canvas.getContext(\"webgl\", {\n      //可选选项\n      antialias: false, \n      stencil: true\n  })\n  ```\n\n## 初始化着色器程序 \n  * 创建：顶点着色器程序、片段着色器程序\n  * 编译：通过 js 将这两个着色器 link 到一个 program (着色程序) 并提交到 GPU\n\n\n## 建立模型和数据缓存  \n  * 创建缓冲区对象并绑定到目标，然后写入数据并连接所分配的变量，运行程序时使用缓冲区对象向顶点传入多个顶点数据\n  * 创建纹理并加载纹理图像，配置属性并在 webgl 中使用\n\n \n## 图像绘制和动画\n\n### 简单图形 \n  * API：`gl.drawArrays(mode, first, count)`\n    * mode：画图函数(点、线、三角形)\n    * first：指定顶点开始绘制的位置 \n    * count：所绘制图形的顶点个数\n  * 实例\n    * 三个点：`gl.drawArrays(gl.POINTS, 0, 3)`\n    * 三角形：`gl.drawsArrays(gl.TRIANGLES, 0, 3)`\n                         \n### 复杂的三维图形 \n  * API：`gl.drawElements(mode, count, type, offset)`\n    * type：指定缓冲区中值的类型，常用 gl.UNSIGNED_BYTE/UNSIGNED_SHORT 表示无符号8/16位整数值\n    * offset：指定索引数组中开始绘制的位置，以字节为单位\n  * 实例\n    * 三角形：`gl.drawElement(gl.TRIANGLES, n, gl.UNSIGNED_SHORT, 0)`\n\n\n## 方法封装\n  ```js\n  function webGLStart() {\n      // 初始化WEBGL上下文信息\n      var canvas = document.getElementById(\"myCanvas\");\n      initGL(canvas);\n\n      // 初始化着色器\n      initShader();\n\n      // 初始化缓冲区\n      initBuffers();\n\n      // 初始化纹理图片\n      initTexture();\n\n      // 指定清空画布的颜色，\n      gl.clearColor(0, 0, 0, 1);\n\n      // 清除颜色缓冲区 (使用定义的颜色来填充相应区域)\n      gl.clear(gl.COLOR_BUFFER_BIT);\n\n      // 开启隐藏面消除的功能  启用深度测试\n      gl.enable(gl.DEPTH_TEST);\n\n      // 开始绘制场景\n      drawScene();\n  }\n  ```\n\n \n# 四、Three.js 基础\n> 使用 js 代码写 3D 程序\n\n## 对比 WebGL\n\n  * WebGL \n    * 原生 API 是一种非常低级的接口，需要一些数学和图形学的相关技术，学习和开发项目的成本较高\n    * 可看作是浏览器提供的接口，js 中可以直接用 WebGL API 绘制3D图形\n  * Three.js\n    * 通过对 WebGL API 的封装与简化而形成的一个易用的图形库，上手容易\n    * 可看作是一款 webGL框架。它将复杂接口简单化，将 webGL 基于光栅化的 2D API 封装成了简单的 3D API，同时基于面向对象思维而将数据结构对象化\n    \n\n## 简化工作\n  * 辅助导出模型数据\n  * 自动生成各种矩阵\n  * 生成了顶点着色器\n  * 辅助生成材质、配置灯光\n  * 根据设置的材质生成片元着色器\n\n      \n## 执行流程\n  1. 创建场景、灯光、相机等\n  2. 创建模型、材质(内置/自定义)\n  3. 生成顶点着色器、片元着色器\n  4. 渲染页面\n\n\n# 五、Three.js 绘图\n\n## 模型渲染\n  * 原理：将创建好的物体添加到场景中，然后通过相机渲染到渲染器，从而呈现到网页\n  * 方式\n    * 实时渲染：不停地渲染画面\n    * 离线渲染：事先渲染出一帧帧图片，使用时拼接\n          \n               \n## 实现步骤\n  1. 构建一个三维空间 (创建场景)\n  2. 选择一个观察点，并确定观察方向/角度等 (创建相机)\n  3. 在场景中添加供观察的物体 (创建物体并添加至场景中)\n  4. 将观察到的场景渲染到屏幕上 (创建渲染器并渲染场景)\n\n  ```js\n  // 绘制网格线\n  function initGrid() {\n\n      // 场景\n      var scene = new THREE.Scene();\n\n      // 相机\n      var camera = new THREE.OrthographicCamera(-5, 5, 3.75, -3.75, 0.1, 100);\n      // 设定相机位置\n      camera.position.set(0, -25, 0);\n      // 相机看向\n      camera.lookAt(new THREE.Vector3(0, 0, 0));\n      scene.add(camera);\n\n      // 渲染器\n      var renderer = new THREE.WebGLRenderer({ antialias: true });\n      // 设定渲染器尺寸\n      renderer.setSize(800, 600);\n      // 添加到dom\n      renderer.autoClear = false;\n      // 重绘时颜色\n      renderer.setClearColor(0x000000);\n      document.body.appendChild(renderer.domElement);\n\n      // 定义一个几何体\n      var geometry = new THREE.Geometry();\n      geometry.vertices.push(new THREE.Vector3(-2, 0, 0));\n      geometry.vertices.push(new THREE.Vector3(2, 0, 0));\n      // for循环出来六条线段\n      for (var i = 0; i &lt;= 5; i++) {\n          // 定义竖着的线段\n          var line = new THREE.Line(geometry, new THREE.LineBasicMaterial({\n              color: 0xffffff,\n          }));\n          // 每条线段之间的间隔为0.8，-2是为了达到田字格的效果\n          line.position.z = (i * 0.8) - 2;\n          scene.add(line);\n\n          // 定义横着的线段\n          var line = new THREE.Line(geometry, new THREE.LineBasicMaterial({\n              color: 0xffffff,\n              opacity: 0.2\n          }));\n          line.position.x = (i * 0.8) - 2;\n          line.rotation.y = 90 * Math.PI / 180;\n          scene.add(line);\n\n          // 渲染\n          renderer.render(scene, camera);\n      }\n  }\n  ```\n\n\n## 场景动画\n> 在循环渲染(即重绘，循环绘制新场景) 的过程中不断改变 物体或相机的属性，让场景动起来  的颜色、位置等\n\n  * 属性\n    * 物体：`scale、rotation、position、material`\n    * 相机：`位置、方向、面向坐标`\n  * 实现方式\n    * __直接实现__\n      * 物体移动而摄像机不动：`mesh.position.x -= 1`\n      * 摄像机移动而物体不动：`camera.position.x = camera.position.x + 1`\n    * __Tween.js__\n      * 引入后可以定义某个属性值的过渡而实现复杂动画\n      * 它会自动计算出起止的所有中间值，这个过程叫做 tweening 补间\n\n  ```js\n  // 旋转的正方体\n  var scene, camera, renderer, mesh, stats;\n  initThree();\n  animation();\n\n  function initThree() {\n      // 创建场景对象 (插入光照/物体)\n      scene = new THREE.Scene();  \n\n      // 创建相机对象\n      camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 1, 1000);\n\n      // 光照设置\n      var light = new THREE.DirectionalLight( 0xffffff );\n      light.position.set( 0, 1, 1 ).normalize();  // 光源位置\n      scene.add(light);    // 将光照插入场景\n\n\n      // 创建网络模型\n      var geometry = new THREE.BoxGeometry( 10, 10, 10);  // 创建一个立方体几何对象\n      var material = new THREE.MeshPhongMaterial({        // 材质对象\n              color: 0x0033ff, \n              specular: 0x555555, \n              shininess: 30 \n      });\n\n      mesh = new THREE.Mesh(geometry, material );   // 网格模型对象\n      mesh.position.z = -50;\n      scene.add(mesh);\n\n      // 创建渲染器对象\n      renderer = new THREE.WebGLRenderer({ antialias: true })   // 参数是可选配置\n      renderer.setSize(window.innerWidth, window.innerHeight)   // canvas元素设置宽高 (默认300/150)\n      renderer.clear()                                // 清除面板\n      renderer.setClearColor(0xb9d3ff, 1)             // 设置画布颜色\n      document.body.appendChild(renderer.domElement)  // 将Canvas元素添加到<body>中。\n\n      window.addEventListener( 'resize', onWindowResize, false );\n      function onWindowResize() {\n          camera.aspect = window.innerWidth / window.innerHeight;\n          camera.updateProjectionMatrix();\n          renderer.setSize( window.innerWidth, window.innerHeight );\n          render();\n      }\n    \n      // 执行渲染\n      render();         \n  }\n\n  function render() {\n      renderer.render(scene, camera)    \n  }\n\n  // 简单动画：在循环渲染过程中不断改变 物体/相机的属性，从而让场景动起来\n  function animation() {\n      mesh.rotation.x += .04;\n      mesh.rotation.y += .02;\n\n      render();\n      requestAnimationFrame(animation);\n\n      // mesh.material = new THREE.MeshLambertMaterial({\n      //     color: 0xff0000\n      // });\n      // mesh.position.z = 1;\n      // mesh.position.set(1.5, -0.5, 0);\n      // mesh.position = new THREE.Vector3(1.5, -0.5, 0);\n\n      // 更新性能插件     \n      // stats.update();  \n\n      // 让物体运动\n      // TWEEN.update();   \n  }\n\n  // 复杂动画：Tween 的任何一个函数返回的都是自身，支持链式编程\n  function initTween(){\n      new TWEEN.Tween(mesh.position)    // 要改变属性的对象\n              .to( { x: -400 }, 3000 )  // 目标值和需要时间\n              .repeat( Infinity )       // 重复无穷次\n              .start();                 // 开始动画\n  }\n  ```\n\n\n## 性能检测\n> 引用插件 stats.js 之后可以在场景中的左上角看到视图小框，点击切换可看到以下信息\n\n  * __38 MS (19-74)__：MS 表示渲染一帧需要的毫秒数，其值越小越好\n  * __34 FPS (30-34)__：FPS 表示每秒渲染的帧数，其值越大越好，括号内表示帧率范围\n\n  ```js\n  // 动画性能检测： http://www.wjceo.com/lib/js/libs/stats.min.js\n  stats = new Stats();\n\n  // 参数为 0 时显示 FPS 界面，参数为 1 时显示 MS 界面\n  stats.setMode(1);  \n\n  // stats 的界面对应左上角\n  stats.domElement.style.position = 'absolute';\n  stats.domElement.left = '0px';\n  stats.domElement.top = '0px';\n  document.body.appendChild(stats.dom);\n  ```\n\n\n# 六、Three.js 要素\n> 绘图页面中必备且唯一的要素：camera、scene、renderer\n\n  * __Scene__：场景（三维空间），是物体、光源等元素的容器 \n  * __Camera__：相机（观察者），控制视角位置、范围和焦点位置 \n  * __Object3D__：物体（三维模型），包括二维的点线面、三维的粒子等\n  * __Light__：光源，包括全局光、平行光、点光源等\n  * __Renderer__：渲染器（画布），用于渲染场景及其物体\n  * __Control__：控制器（相机控件），可通过键盘、鼠标控制相机\n\n\n## 相机\n### 分类\n  * __正投影相机__\n    * 特点：表现物体的实际尺寸而远近相同\n    * 参数：视角、窗口的长宽比、近远裁面的距离\n    * OrthographicCamera(left, right, top, bottom, near, far)\n  * __透视投影相机__\n    * 特点：类似人眼而近大远小\n    * 参数：各平面距离相机中心的垂直距离\n    * PerspectiveCamera(fov, aspect, near, far)\n  * __3D 相机__\n    * 特点：合成两个相机的拍摄结果，用于 3D 立体影像或视差屏障等效果\n    * StereoCamera()\n  * __全景相机__\n    * 特点：可以 360 度拍摄\n    * 参数：最后一个设置立方体边缘的长度\n    * CubeCamera(near, far, cubeResolution)\n\n### 属性\n  ```js\n  // 相机设置\n  camera.position.set(0, -1, 5);    // 设定相机位置 \n  camera.up.x = 0;                 // 相机以哪个方向为上方\n  camera.lookAt(scene.position);   // 相机面向哪个坐标(默认面向z轴负方向)\n  camera.lookAt(new THREE.Vector3(10,0,0));  // 相机往x轴移动10单位 \n  ```\n\n\n## 物体\n> Object3D 是它们的基类。创建时需要 几何体和材质，几何体定义模型的形状 (骨架)，材质定义几何图形的表面效果 (皮肤，包括颜色、纹理、透明度、质感等)\n\n  * __Line__：线段模型，由线条组成\n  * __Mesh__：网格模型，由三角面和四边形面组成\n  * __Points__：粒子系统，使用一堆点的集合来描述\n  * __Sprite__：精灵图，指包含于场景中的二维图像或动画\n    * 特点：一个永远面向相机的平面\n    * 功能：加载 纹理但是不接受阴影\n\n\n### 几何体\n  * __构造函数创建__：Geometry 是它们的基类\n    * __二维平面__\n      * 圆平面：CircleGeometry \n      * 矩形平面：PlaneGeometry\n    * __三维几何体__\n      * 立方体：BoxGeometry、CubeGeometry(旧版本)\n      * 球体：SphereGeometry    \n      * 圆柱：CylinderGeometry\n      * 圆环：TorusGeometry\n      * 环面：TorusKnotGeometry\n      * 多面体：PolyhedronGeometry\n      * 正四面体：TetrahedronGeometry\n      * 正八面体：OctahedronGeometry\n      * 正二十面体：IcosahedronGeometry\n      * 复杂几何体\n        * 凸面体：ConvexGeometry\n        * 扫描体：LatheGeometry\n        * 管状体：TubeGeometry\n        * 拉伸几何体：ExtrudeGeometry\n        * 参数几何体：ParameterGeometry\n        * 文本几何体：TextGeometry\n  * __自定义创建__\n    * __三维__\n      * 几何体：Geometry\n      * 顶点：Vector3\n      * 顶面：Face3  \n    * __二维__\n      * 平面：Shape\n      * 线条\n        * 直线：moveTo、lineTo \n        * 圆弧：arc、absarc \n        * 椭圆：ellipse、absellipse \n        * 贝塞尔曲线：quadraticCurveTo\n      * 几何体          \n        * makeGeometry\n        * createPointsGeometry\n        * createSpacedPointsGeometry   \n\n  ```js\n  function initShape(){\n\n      // 模型对象和材质对象 \n      var geometry, material;   \n\n\n      // -------------- 构造函数创建 ---------------\n\n      // 矩形平面：PlanGeometry(长,宽, 长的分割, 宽的分割) \n      let planeGeometry = new THREE.PlaneGeometry(100, 50)\n      let planeMaterial = new THREE.MeshLambertMaterial({ color: 0xffffff })\n      let plane = new THREE.Mesh(planeGeometry,planeMaterial)\n      plane.receiveShadow = true        // 接收阴影\n      plane.rotation.x = -0.5*Math.PI   // x 轴旋转 -90 度\n      plane.position.set(15, 0, 0)\n      scene.add( plane )\n      \n      \n      // 圆平面：CircleGeometry(半径, 切片数, 开始, 跨过角度)  \n      // 切片数越大则越接近圆, 参数为3(最小值)是三角形, 参数为4则是矩形\n      geometry = new THREE.CircleGeometry(3, 100)\n      material = new THREE.MeshLambertMaterial({ color: 0xffffff })\n      let circle = new THREE.Mesh(geometry, material)\n\n\n      // 圆环：TorusGeometry(半径, 管道半径, 纬度分割, 经度分割, 圆环面的弧度)\n      // 最后一个参数 控制是否绘制完整一个圆环\n      geometry = new THREE.TorusGeometry(5, 1, 50, 50)  \n      material = new THREE.MeshLambertMaterial({ color: 0x7777ff })\n      let torus = new THREE.Mesh(geometry, material)\n\n      \n      // 立方体：BoxGeometry(长, 宽, 高, 长的分割, 宽的分割, 高的分割)\n      // 旧版本用CubeGeometry\n      geometry = new THREE.BoxGeometry(4, 4, 4)\n      material = new THREE.MeshLambertMaterial({ color: 0xff0000 })\n      let box = new THREE.Mesh(geometry, material)\n\n      \n      // 球体：SphereGeometry(半径, 经度切片, 纬度切片, 经度开始, 经度跨过, 纬度开始, 纬度跨过)\n      geometry = new THREE.SphereGeometry(4, 20, 20)\n      material = new THREE.MeshLambertMaterial({ color: 0x7777ff } )\n      let sphere = new THREE.Mesh(geometry, material)\n      sphere.scale.set(1.5,1.5,1.5);  //缩放\n      \n          \n      // 圆柱：CylinderGeometry(顶部面积, 底部面积, 高, 圆分割, 高分割, 是否没有顶面和底面) \n      // 顶部或底部为0，则变成圆锥\n      geometry = new THREE.CylinderGeometry(2, 2, 5)\n      material = new THREE.MeshLambertMaterial({ color: 0x7777ff })\n      let cylinder = new THREE.Mesh(geometry, material)\n      \n\n      // 正 20 面体 \n      meometry = new THREE.IcosahedronGeometry(4, 0);   \n      material = new THREE.MeshLambertMaterial( {color: 0x7777ff} )\n      let icosahedron = new THREE.Mesh(geometry, material)\n\n\n      // -------------- 自定义创建 ---------------\n\n      // 点模型\n      geometry = new THREE.Geometry();    // 声明一个空几何体对象\n      var p1 = new THREE.Vector3(10, 0, 0);   // 顶点1坐标\n      var p2 = new THREE.Vector3(0, 20, 0);   // 顶点2坐标\n      var p3 = new THREE.Vector3(15, 15, 0);  // 顶点3坐标\n      geometry.vertices.push(p1,p2,p3);       // 顶点坐标添加到geometry对象\n\n      material = new THREE.PointsMaterial({  // 点对象像素的颜色尺寸\n          color: 0x0000ff,\n          size: 10.0       \n      }); \n      var points = new THREE.Points(geometry, material);\n      scene.add(points);        // 点模型添加到场景中\n\n\n      // 线条\n      geometry = new THREE.Geometry();\n      var p1 = new THREE.Vector3(10, 0, 0);\n      var p2 = new THREE.Vector3(0, 20, 0);\n      geometry.vertices.push(p1, p2);           // vertices 存放坐标\n      \n      var color1 = new THREE.Color(0xFF0000);  \n      var color2 = new THREE.Color(0x0000FF);   \n      geometry.colors.push(color1, color2);      // colors 存放顶点颜色\n      \n      material = new THREE.LineBasicMaterial({\n          // color: 0x0000ff,        // 线条颜色，用16进制表示，默认白色\n          vertexColors: THREE.VertexColors,  // 线条材质是否使用顶点颜色\n      });\n      var line = new THREE.Line(geometry, material);\n      scene.add(line);  \n\n\n      // 三角面和矩形 \n      geometry = new THREE.Geometry(); \n      var p1 = new THREE.Vector3(0, 0, 0); \n      var p2 = new THREE.Vector3(80, 0, 0); \n      var p3 = new THREE.Vector3(0, 80, 0); \n\n      // 创建三角面及其法向量 (平面的法向量垂直于平面本身)\n      geometry.vertices.push(p1, p2, p3); \n      var normal = new THREE.Vector3( 0, 0, 1 ); \n      var face = new THREE.Face3( 0, 1, 2, normal); \n      var color1 = new THREE.Color(0xFF0000);  // 红色\n      var color2 = new THREE.Color(0x00FF00);  // 绿色\n      var color3 = new THREE.Color(0x0000FF);  // 蓝色\n      face.vertexColors.push(color1, color2, color3);  // 定义顶点颜色\n      geometry.faces.push(face); \n\n      // 创建矩形平面\n      var p4 = new THREE.Vector3(0, 80, 0); \n      geometry.vertices.push(p1, p2, p3, p4); \n      var normal = new THREE.Vector3(0, 0, 1); \n      var face0 = new THREE.Face3(0, 1, 2, normal); \n      var face1 = new THREE.Face3(0, 2, 3, normal); \n      geometry.faces.push(face0, face1); \n\n      material = new THREE.MeshLambertMaterial({\n          color: 0x0000ff,         \n          side: THREE.DoubleSide   // 两面可见\n      });\n      var mesh = new THREE.Mesh(geometry,material);\n      scene.add(mesh);\n\n\n      // 二维图形：ShapeGeometry(shapes, options)  \n      // shapes 参数: THREE.Shape对象可单个传入, 多个时传数组\n      var x = 0, y = 0\n      var heartShape = new THREE.Shape()  // 心形\n\n      heartShape.moveTo( x + 5, y + 5 )\n      heartShape.bezierCurveTo( x + 5, y + 5, x + 4, y, x, y )\n      heartShape.bezierCurveTo( x - 6, y, x - 6, y + 7,x - 6, y + 7 )\n      heartShape.bezierCurveTo( x - 6, y + 11, x - 3, y + 15.4, x + 5, y + 19 )\n      heartShape.bezierCurveTo( x + 12, y + 15.4, x + 16, y + 11, x + 16, y + 7 )\n      heartShape.bezierCurveTo( x + 16, y + 7, x + 16, y, x + 10, y )\n      heartShape.bezierCurveTo( x + 7, y, x + 5, y + 5, x + 5, y + 5 )\n\n      geometry = new THREE.ShapeGeometry( heartShape )\n      material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } )\n      var mesh = new THREE.Mesh( geometry, material ) \n      scene.add( mesh )\n\n      \n      // 几何体 \n      // 1.创建顶点\n      var vertices = [\n          new THREE.Vector3(0,2,0),\n          new THREE.Vector3(-1,0,0),\n          new THREE.Vector3(0,0,1),\n          new THREE.Vector3(1,0,0),\n          new THREE.Vector3(0,0,-1),\n          new THREE.Vector3(0,-2,0)\n      ]\n\n      // 2.创建面\n      var faces = [\n          new THREE.Face3(0,1,2),\n          new THREE.Face3(0,2,3),\n          new THREE.Face3(0,3,4),\n          new THREE.Face3(0,4,1),\n          new THREE.Face3(5,2,1),\n          new THREE.Face3(5,3,2),\n          new THREE.Face3(5,4,3),\n          new THREE.Face3(5,1,4),\n      ]\n\n      // 3.创建几何体架构\n      var geom = new THREE.Geometry()\n      geom.vertices = vertices\n      geom.faces = faces\n      geom.computeFaceNormals()  //计算法向量, 这决定了对光做出的反应\n\n      // 4.添加材质\n      var materials = [\n          // 几何体面的材质 (Lambert材质适合光照)\n          new THREE.MeshLambertMaterial({ \n              opacity: 0.8, \n              color:0x44e144, \n              transparent: true \n          }),\n          // 一个几何体框架的材质\n          new THREE.MeshBasicMaterial({\n              color:0x008800,\n              wireframe:true\n          }),\n      ]\n\n      // 5.创建几何体(传入结构, 材质)\n      mesh = THREE.SceneUtils.createMultiMaterialObject(geom, materials) \n      mesh.name = '源'\n      mesh.children.forEach(function (e) {\n          e.castShadow = true  //可以生成影子\n      })\n\n      // 6.添加进场景中\n      scene.add(mesh);\n  }\n  ```\n\n\n\n### 材质\n> 三维物体表面各个可视属性（颜色、纹理、光滑度、透明度、反射率、反光度等）的结合，决定了物体的外观效果。THREE.Material 是材质的基类，拥有所有材质的公有属性，它派生出的各种材质如下：\n\n  * __MeshBasicMaterial__\n    * 名称：基础材质 \n    * 功能\n      * 显示几何体的线框\n      * 给几何体赋予一种简单的颜色 \n    * 特点\n      * 材质颜色如果没有指定则随机\n      * 物体颜色始终是材质颜色，不会因光照产生明暗、阴影效果\n  * __MeshLambertMaterial__\n    * 名称：朗伯材质\n    * 功能：创建 暗淡的、不光亮的 表面\n    * 特点\n      * 可以通过 emissive 属性给材质添加亮色\n      * 在物体表面均匀地散射灯光，比如纸的表面粗糙但亮度均匀\n  * __MeshPhongMaterial__  \n    * 名称：Phong 式材质\n    * 功能：创建金属类光亮的表面\n    * 特点\n      * 反光强度更大\n      * 会给表面添加金属光泽\n      * 可通过 shininess 属性改变反光强度\n  * __MeshStandardMaterial__\n    * 名称：网格标准材质\n    * 功能：创建 暗淡的、有金属性光泽的 表面\n    * 特点\n      * MeshLambertMaterial、MeshPhoneMaterial 的结合\n      * 同时具有 粗糙度和金属性 的材质，并且可以改变这些属性\n  * __MeshDepthMaterial__\n    * 名称：深度材质\n    * 功能：根据内容所在的深度对网格对象的灰度级别从黑到白绘制\n  * __MeshNormalMaterial__\n    * 名称：法向材质\n    * 功能：根据面的 法线或朝向 使用不同的颜色来渲染网格的面\n  * __MeshFaceMaterial__\n    * 名称：面材质\n    * 功能：一个可以为几何体的各个表面指定不同颜色的容器 \n  * __ShaderMaterial__\n    * 名称：着色器材质\n    * 功能：允许使用自定义的着色器程序，比如顶点的放置方式、像素的着色方式\n  * __LineBasicMaterial__\n    * 名称：直线基础材质\n    * 功能：用于在 THREE.Line 中创建着色的直线  \n  * __LineDashMaterial__\n    * 名称：虚线材质\n    * 功能：允许创建出一种虚线的效果\n  * __PointsMaterial__\n    * 名称：粒子材质\n    * 功能：适用于粒子系统、模拟雪花小雨等\n  * __SpriteMaterial__\n    * 名称：雪碧材质\n    * 功能：加载 图像纹理、canvas 创建的纹理等\n    * 特点：能够使用纹理贴图，并且应用于雪碧材质上\n\n          \n\n## 光源\n> THREE.Light 是所有光源的基类，其构造函数接受 hex(一个16进制的颜色值)作为参数。但要让光源具有颜色之外的特性。我们需要使用由基类派生出来的其他种类光源，注意环境光、方向光的光强不受距离远近影响 \n\n### 类型\n  * __AmbientLight__\n    * 名称：环境光\n    * 功能：弱化阴影、添加颜色\n    * 光线：来自各个方向并均匀反射到物体表面\n    * 特点\n      * 影响整个场景\n      * 没有特定来源\n      * 不会影响阴影的生成\n      * 不能作为场景中唯一的光源\n  * __DirectionLight__\n    * 名称：平行光、方向光\n    * 功能：常用于实现阴影效果\n    * 光线：一组没有衰减的平行光线，类似太阳光\n    * 特点：产生阴影、光强相同、效果只与方向有关\n  * __PointLight__\n    * 名称：点光源\n    * 光线：单点发光但辐射四面八方\n    * 特点：类似蜡烛和灯泡、单点发光、不产生阴影\n  * __SpotLight__\n    * 名称：聚光灯      \n    * 功能：实现阴影效果，类似台灯、手电筒\n    * 光线：从一个锥体中射出并在物体上产生聚光的效果\n    * 特点\n      * 距离越远则光强越弱\n      * 光强衰减指数越大则光强衰减越快\n\n\n### 影响材质\n> 只有在正常的光照条件下，我们才能容易分辨物体的材质\n\n  * 没有任何光源时，材质颜色最终是黑色 (离开光时材质无法体现)\n  * Lambert 材质会受环境光的影响而呈现环境光的颜色，与材质本身颜色关系不大\n  * 只有环境光时，灯光位置不影响材质效果(阴影等)。只有其他光源时，能照射到的地方为 光源颜色，不能照射的地方则呈现暗色(黑色)\n  * 当混合光源存在时，单一光源能照射的地方呈现为 对应的光源颜色，多种光源都能照射到的地方是 颜色相加结果，都不能照射到的则呈现 暗色/环境光颜色\n    * 光源：环境光为 绿色(0x00FF00)，平行光为 红色(0xFF0000)\n    * 效果：平行光照射到的地方呈现黄色(颜色值相加：0xFFFF00)，其它呈现绿色\n\n\n### 阴影效果\n  ```js\n  function initShadow() { \n      // 告诉render我要渲染阴影\n      renderer.shadowMap.enabled = true\n\n      // 让物体(立方体)投射阴影\n      var geo = new THREE.BoxGeometry(10,10,10)\n      var mat = new THREE.MeshPhoneMaterial({color:0xffffff})\n      var box = new THREE.Mesh(geo,mat)\n      box.castShadow = true\n\n      // 让其他物体(平面)接受阴影\n      var geo_2 = new THREE.PlaneGeometry(100,50,32,32)\n      var mat_2 = new THREE.MeshPhoneMaterial({color:0xeeeeee, side:THREE.DoubleSize})\n      var plane = new THREE.Mesh(geo_2, mat_2)\n      plane.receiveShadow = true\n\n      // 告诉光源需要投射阴影\n      var light = new THREE.DirectionalLight(0xffffff)\n      light.castShadow = true \n      scene.add(light)    \n  }\n  ```\n\n\n## 渲染器\n  * __WebGLRender__：使用 WebGL 渲染图形\n  * __WebGLRenderTarget__：渲染一个缓冲区\n  * __WebGLRenderTargetCube__：用于 CubeCamera\n  * __CSS3DRenderer__：基于 CSS3，简化版为 2D\n  * __SVGRenderer__：使用 SVG 渲染几何数据\n\n\n## 控制器\n  * __FlyControls__：飞行控制，用键盘和鼠标控制相机的移动和转动\n  * __OrbitControls__：轨道控制器，模拟轨道卫星旋转平移并用键盘、鼠标控制相机位置\n  * __PointerLockControls__：指针锁定，鼠标离开画布依然能被捕捉到鼠标交互而常用于游戏\n  * __TrackballControls__：轨迹球控制器，通过键盘和鼠标控制前后左右平移和缩放场景\n  * __TransformControls__：变换物体控制器，可以通过鼠标对物体的进行拖放等操作\n\n\n\n","source":"_posts/17-threejs.md","raw":"---\ntitle: WebGL 和 Three.js\ntags:\n  - Three.js\ncategories: Three.js\ntop: false\nkeywords:\n  - three\ndate: 2019-04-14 23:06:46\ndescription: WebGL 概念和绘图流程、Three.js 绘图和构成要素\n---\n\n# 一、WebGL 基础\n\n## OpenGL、WebGL\n  * __OpenGL__：最常用的跨平台图形库，用于渲染 2D、3D 矢量图形的跨语言、跨平台的应用程序编程接口\n  * __OpenGL ES__：OpenGL API 的子集 GPU，是针对手机、PDA 和游戏主机等嵌入式设备而专门设计的接口\n  * __GLSL__：OpenGL ES 着色语言，用于OpenGL中着色编程的语言。在图形卡的GPU上执行，代替了固定的渲染管线的一部分，使渲染管线中不同层次具有可编程性，如视图转换、投影转换等。  \n  * __WebGL__：基于 OpenGL 设计的面向 web 的图形标准，它提供的一系列 Js API 对显卡的硬件细节进行了封装抽象，可用于控制 GPU渲染管线(显卡硬件) 进行图形渲染，从而获得了较高性能。\n  * __WebGL程序__：主要组成是 js控制代码 和 计算机的图形处理单元GPU。而 GPU 核心即着色程序 program 由顶点和片元两个着色器组成，使用 GLSL 编写并通过常以字符串的形式存放在Js中等待调用 (浏览器不识别 GLSL)。\n\n\n## CPU、GPU\n> 图像处理主要偏简单的矩阵运算，逻辑判断等很少。两者的设计架构不同。GPU很适合做简单的并发计算，应用于图像处理、深度学习等领域加快速度，引爆了人工智能\n\n  * __CPU__\n    * 可看作\"万能教授\"，但运算效率较低\n    * 中央处理器，计算机的运算和控制核心\n    * 需要很强的通用性来处理各种不同的数据类型和逻辑判断\n  * __GPU__\n    * 可看作\"专业学生\"，用来实现硬件加速计算，执行重复运算效率高\n    * 图像处理器，是显卡的处理器和核心，也是图像运算工作的微处理器\n    * 专为执行复杂的数学和几何计算而设计，用于将 CPU 从图形处理的任务中解放出来而去执行其他更多的系统任务，提高计算机的整体性能\n\n\n## 图形渲染\n  <div style=\"text-indent: 2em\">渲染是从使用计算机程序模型生成图像的过程。在图形中一个虚拟场景的呈现需要使用 几何、视点、纹理、光照和阴影等通过一个渲染程序传递信息描述，输出一个数字图像。渲染可以在本地或远程上进行。复杂图像所需的硬件资源可以在专用服务器上完成，即基于服务器的绘制。渲染也可以通过在本地CPU完成, 即基于客户端的渲染。所以渲染类型如下：</div>\n\n  * 软件渲染：所有的渲染是在 CPU 的帮助下计算完成。 \n  * 硬件渲染：所有的图形计算都由 GPU (图形处理单元)完成的。\n\n              \n## 图形术语\n  * __坐标系__：x、y、z 轴\n    * 无论画布多大，WebGL 上的坐标被限制为 (1, 1, 1)、(-1, -1, -1)\n    * WebGL 在 GPU 上的主要工作就是将顶点数据通过矩阵变换转换到裁剪空间坐标，然后基于空间坐标绘制像素点\n  * __缓冲__：即将发送到GPU 的一些二进制数据序列\n    * 缓冲区对象用于存储要绘制模型的各种数据，比如顶点、颜色等\n    * 缓冲区对象驻留在 GPU 存储器却可以被直接呈现，提高了性能\n  * __图元__：几何顶点的组合，比如点、线段和三角面\n  * __片元和像素__\n    * 在光栅化中纹理映射之后图元信息转化为了像素\n    * 片元包括 像素点 和 颜色、深度和纹理数据等信息\n  * __网格__：使用顶点所绘的 2D、3D 模型，它的每个面被称为 一个片元 (一般是三角形)\n  * __着色器__\n    * 现代 GPU 中的顶点处理和片段处理等可编程部分被称为着色器\n    * 主要包括顶点着色器和片元着色器，可理解为运行在显卡中的指令和数据\n    * 着色器程序使用的是 GLSL ES 语言，所以在 Js 中需要存放在字符串中等待调用编译，通过编译处理后传递给 顶点/片元 着色器执行\n  * __纹理图像__\n    * 将一张真实图片贴到一个几何图像表面称为 纹理映射，映射的图像为纹理图像\n    * 组成纹理图像的像素称为纹素，而纹理坐标 是纹理图像上的坐标，通过纹理坐标可以在纹理图像上获取纹素颜色\n  * __绘图__\n    * WebGL 中的顶点、颜色、纹理等几何详细信息存储在缓冲区对象，然后被传递到GPU上的着色器程序来创建图形对象\n    * WebGL 只能绘制 点、线和三角形，其他都是由它们合成后绘制到三维空间\n\n\n\n# 二、WebGL 程序\n> 程序代码是 Js、OpenGL 的组合，两者分别负责与 CPU、GPU 通信\n\n## 显卡内部结构 \n> 电脑一般都具有独立显卡\n       \n  * GPU：渲染管线\n    * 功能：和 GPU 传递数据\n    * 内容：可编程的着色器、不可编程的光栅器等     \n  * 显存：GPU 读写数据的存储区  \n    * 顶点缓存：存储顶点的位置、颜色等数据  \n    * 渲染缓存：接收渲染管线生成数据\n    * 纹理缓存：用于实现纹理贴图\n    * 帧缓存 \n      * 分类: 屏幕缓存、离屏缓存\n      * 组成: 颜色缓存、深度缓存、模板缓存\n\n\n## 图像绘制流程\n> 上线网站的 WebGL 相关文件会放在远程的服务器硬盘存储器。网页 http 请求后，CPU 将顶点坐标等数据 和 WebGL 程序代码 传递给 GPU 存储\n\n  1. 浏览器解析硬盘的 WebGL 文件，CPU 分配内存并将数据传递给 GPU 存储数据和程序代码\n  2. CPU 执行程序初始化并调用 GPU 存储的程序代码，初始化着色器时把处理好的 着色器程序 和 矩阵等数据 发送给 GPU 处理器\n  3. GPU 通过矩阵变换和光栅化等操作将图像信息转化为像素并写入显卡的帧缓存 (包括颜色、透明度等)\n  4. 显示器扫描读取显存中的像素数据，然后显示到浏览器 canvas\n\n\n## GPU 处理流程\n> 获取顶点坐标、图元装配(即画出一个个三角形)、光栅化(生成片元, 即一个个像素点)、存储在缓存区\n\n  1. 数据准备\n    * uv：贴图坐标\n    * 索引：三角形绘制顺序\n    * 矩阵数据：uniform 变量传递给顶点着色器\n    * 顶点坐标：attribute 变量传递给顶点着色器，一般由三维软件导出几何体的各个顶点\n  2. 生成顶点着色器\n    * 顶点着色器：Js 定义的程序代码，初始化后会传递给 GPU\n  3. 图元装配\n    * 实现：顶点坐标 转换为图元 (一般是三角形)\n    * 本质：GPU 逐顶点数量执行顶点着色器程序，通过矩阵变换将孤立的顶点坐标处理为 2D 图形并输出\n  4. 生成片元着色器    \n    * 实现：处理模型的颜色、质地、光照效果、阴影\n  5. 光栅化       \n    * 实现：将图元转换为像素点\n    * 片元：一个像素点及其包含的颜色、深度和纹理数据\n    * 本质：GPU 逐片元数量执行片元着色器程序，为每个片元进行着色\n  6. 存储到缓存区    \n    * 片元只要通过了检测和融合 (融合单元主要实现透明度效果)，就可以存储到颜色缓存区，最终完成整个渲染   \n\n\n\n# 三、WebGL 绘图\n\n## 初始化绘图上下文\n  ```js\n  var canvas = document.getElementById(\"canvas\")\n  var gl = canvas.getContext(\"webgl\", {\n      //可选选项\n      antialias: false, \n      stencil: true\n  })\n  ```\n\n## 初始化着色器程序 \n  * 创建：顶点着色器程序、片段着色器程序\n  * 编译：通过 js 将这两个着色器 link 到一个 program (着色程序) 并提交到 GPU\n\n\n## 建立模型和数据缓存  \n  * 创建缓冲区对象并绑定到目标，然后写入数据并连接所分配的变量，运行程序时使用缓冲区对象向顶点传入多个顶点数据\n  * 创建纹理并加载纹理图像，配置属性并在 webgl 中使用\n\n \n## 图像绘制和动画\n\n### 简单图形 \n  * API：`gl.drawArrays(mode, first, count)`\n    * mode：画图函数(点、线、三角形)\n    * first：指定顶点开始绘制的位置 \n    * count：所绘制图形的顶点个数\n  * 实例\n    * 三个点：`gl.drawArrays(gl.POINTS, 0, 3)`\n    * 三角形：`gl.drawsArrays(gl.TRIANGLES, 0, 3)`\n                         \n### 复杂的三维图形 \n  * API：`gl.drawElements(mode, count, type, offset)`\n    * type：指定缓冲区中值的类型，常用 gl.UNSIGNED_BYTE/UNSIGNED_SHORT 表示无符号8/16位整数值\n    * offset：指定索引数组中开始绘制的位置，以字节为单位\n  * 实例\n    * 三角形：`gl.drawElement(gl.TRIANGLES, n, gl.UNSIGNED_SHORT, 0)`\n\n\n## 方法封装\n  ```js\n  function webGLStart() {\n      // 初始化WEBGL上下文信息\n      var canvas = document.getElementById(\"myCanvas\");\n      initGL(canvas);\n\n      // 初始化着色器\n      initShader();\n\n      // 初始化缓冲区\n      initBuffers();\n\n      // 初始化纹理图片\n      initTexture();\n\n      // 指定清空画布的颜色，\n      gl.clearColor(0, 0, 0, 1);\n\n      // 清除颜色缓冲区 (使用定义的颜色来填充相应区域)\n      gl.clear(gl.COLOR_BUFFER_BIT);\n\n      // 开启隐藏面消除的功能  启用深度测试\n      gl.enable(gl.DEPTH_TEST);\n\n      // 开始绘制场景\n      drawScene();\n  }\n  ```\n\n \n# 四、Three.js 基础\n> 使用 js 代码写 3D 程序\n\n## 对比 WebGL\n\n  * WebGL \n    * 原生 API 是一种非常低级的接口，需要一些数学和图形学的相关技术，学习和开发项目的成本较高\n    * 可看作是浏览器提供的接口，js 中可以直接用 WebGL API 绘制3D图形\n  * Three.js\n    * 通过对 WebGL API 的封装与简化而形成的一个易用的图形库，上手容易\n    * 可看作是一款 webGL框架。它将复杂接口简单化，将 webGL 基于光栅化的 2D API 封装成了简单的 3D API，同时基于面向对象思维而将数据结构对象化\n    \n\n## 简化工作\n  * 辅助导出模型数据\n  * 自动生成各种矩阵\n  * 生成了顶点着色器\n  * 辅助生成材质、配置灯光\n  * 根据设置的材质生成片元着色器\n\n      \n## 执行流程\n  1. 创建场景、灯光、相机等\n  2. 创建模型、材质(内置/自定义)\n  3. 生成顶点着色器、片元着色器\n  4. 渲染页面\n\n\n# 五、Three.js 绘图\n\n## 模型渲染\n  * 原理：将创建好的物体添加到场景中，然后通过相机渲染到渲染器，从而呈现到网页\n  * 方式\n    * 实时渲染：不停地渲染画面\n    * 离线渲染：事先渲染出一帧帧图片，使用时拼接\n          \n               \n## 实现步骤\n  1. 构建一个三维空间 (创建场景)\n  2. 选择一个观察点，并确定观察方向/角度等 (创建相机)\n  3. 在场景中添加供观察的物体 (创建物体并添加至场景中)\n  4. 将观察到的场景渲染到屏幕上 (创建渲染器并渲染场景)\n\n  ```js\n  // 绘制网格线\n  function initGrid() {\n\n      // 场景\n      var scene = new THREE.Scene();\n\n      // 相机\n      var camera = new THREE.OrthographicCamera(-5, 5, 3.75, -3.75, 0.1, 100);\n      // 设定相机位置\n      camera.position.set(0, -25, 0);\n      // 相机看向\n      camera.lookAt(new THREE.Vector3(0, 0, 0));\n      scene.add(camera);\n\n      // 渲染器\n      var renderer = new THREE.WebGLRenderer({ antialias: true });\n      // 设定渲染器尺寸\n      renderer.setSize(800, 600);\n      // 添加到dom\n      renderer.autoClear = false;\n      // 重绘时颜色\n      renderer.setClearColor(0x000000);\n      document.body.appendChild(renderer.domElement);\n\n      // 定义一个几何体\n      var geometry = new THREE.Geometry();\n      geometry.vertices.push(new THREE.Vector3(-2, 0, 0));\n      geometry.vertices.push(new THREE.Vector3(2, 0, 0));\n      // for循环出来六条线段\n      for (var i = 0; i &lt;= 5; i++) {\n          // 定义竖着的线段\n          var line = new THREE.Line(geometry, new THREE.LineBasicMaterial({\n              color: 0xffffff,\n          }));\n          // 每条线段之间的间隔为0.8，-2是为了达到田字格的效果\n          line.position.z = (i * 0.8) - 2;\n          scene.add(line);\n\n          // 定义横着的线段\n          var line = new THREE.Line(geometry, new THREE.LineBasicMaterial({\n              color: 0xffffff,\n              opacity: 0.2\n          }));\n          line.position.x = (i * 0.8) - 2;\n          line.rotation.y = 90 * Math.PI / 180;\n          scene.add(line);\n\n          // 渲染\n          renderer.render(scene, camera);\n      }\n  }\n  ```\n\n\n## 场景动画\n> 在循环渲染(即重绘，循环绘制新场景) 的过程中不断改变 物体或相机的属性，让场景动起来  的颜色、位置等\n\n  * 属性\n    * 物体：`scale、rotation、position、material`\n    * 相机：`位置、方向、面向坐标`\n  * 实现方式\n    * __直接实现__\n      * 物体移动而摄像机不动：`mesh.position.x -= 1`\n      * 摄像机移动而物体不动：`camera.position.x = camera.position.x + 1`\n    * __Tween.js__\n      * 引入后可以定义某个属性值的过渡而实现复杂动画\n      * 它会自动计算出起止的所有中间值，这个过程叫做 tweening 补间\n\n  ```js\n  // 旋转的正方体\n  var scene, camera, renderer, mesh, stats;\n  initThree();\n  animation();\n\n  function initThree() {\n      // 创建场景对象 (插入光照/物体)\n      scene = new THREE.Scene();  \n\n      // 创建相机对象\n      camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 1, 1000);\n\n      // 光照设置\n      var light = new THREE.DirectionalLight( 0xffffff );\n      light.position.set( 0, 1, 1 ).normalize();  // 光源位置\n      scene.add(light);    // 将光照插入场景\n\n\n      // 创建网络模型\n      var geometry = new THREE.BoxGeometry( 10, 10, 10);  // 创建一个立方体几何对象\n      var material = new THREE.MeshPhongMaterial({        // 材质对象\n              color: 0x0033ff, \n              specular: 0x555555, \n              shininess: 30 \n      });\n\n      mesh = new THREE.Mesh(geometry, material );   // 网格模型对象\n      mesh.position.z = -50;\n      scene.add(mesh);\n\n      // 创建渲染器对象\n      renderer = new THREE.WebGLRenderer({ antialias: true })   // 参数是可选配置\n      renderer.setSize(window.innerWidth, window.innerHeight)   // canvas元素设置宽高 (默认300/150)\n      renderer.clear()                                // 清除面板\n      renderer.setClearColor(0xb9d3ff, 1)             // 设置画布颜色\n      document.body.appendChild(renderer.domElement)  // 将Canvas元素添加到<body>中。\n\n      window.addEventListener( 'resize', onWindowResize, false );\n      function onWindowResize() {\n          camera.aspect = window.innerWidth / window.innerHeight;\n          camera.updateProjectionMatrix();\n          renderer.setSize( window.innerWidth, window.innerHeight );\n          render();\n      }\n    \n      // 执行渲染\n      render();         \n  }\n\n  function render() {\n      renderer.render(scene, camera)    \n  }\n\n  // 简单动画：在循环渲染过程中不断改变 物体/相机的属性，从而让场景动起来\n  function animation() {\n      mesh.rotation.x += .04;\n      mesh.rotation.y += .02;\n\n      render();\n      requestAnimationFrame(animation);\n\n      // mesh.material = new THREE.MeshLambertMaterial({\n      //     color: 0xff0000\n      // });\n      // mesh.position.z = 1;\n      // mesh.position.set(1.5, -0.5, 0);\n      // mesh.position = new THREE.Vector3(1.5, -0.5, 0);\n\n      // 更新性能插件     \n      // stats.update();  \n\n      // 让物体运动\n      // TWEEN.update();   \n  }\n\n  // 复杂动画：Tween 的任何一个函数返回的都是自身，支持链式编程\n  function initTween(){\n      new TWEEN.Tween(mesh.position)    // 要改变属性的对象\n              .to( { x: -400 }, 3000 )  // 目标值和需要时间\n              .repeat( Infinity )       // 重复无穷次\n              .start();                 // 开始动画\n  }\n  ```\n\n\n## 性能检测\n> 引用插件 stats.js 之后可以在场景中的左上角看到视图小框，点击切换可看到以下信息\n\n  * __38 MS (19-74)__：MS 表示渲染一帧需要的毫秒数，其值越小越好\n  * __34 FPS (30-34)__：FPS 表示每秒渲染的帧数，其值越大越好，括号内表示帧率范围\n\n  ```js\n  // 动画性能检测： http://www.wjceo.com/lib/js/libs/stats.min.js\n  stats = new Stats();\n\n  // 参数为 0 时显示 FPS 界面，参数为 1 时显示 MS 界面\n  stats.setMode(1);  \n\n  // stats 的界面对应左上角\n  stats.domElement.style.position = 'absolute';\n  stats.domElement.left = '0px';\n  stats.domElement.top = '0px';\n  document.body.appendChild(stats.dom);\n  ```\n\n\n# 六、Three.js 要素\n> 绘图页面中必备且唯一的要素：camera、scene、renderer\n\n  * __Scene__：场景（三维空间），是物体、光源等元素的容器 \n  * __Camera__：相机（观察者），控制视角位置、范围和焦点位置 \n  * __Object3D__：物体（三维模型），包括二维的点线面、三维的粒子等\n  * __Light__：光源，包括全局光、平行光、点光源等\n  * __Renderer__：渲染器（画布），用于渲染场景及其物体\n  * __Control__：控制器（相机控件），可通过键盘、鼠标控制相机\n\n\n## 相机\n### 分类\n  * __正投影相机__\n    * 特点：表现物体的实际尺寸而远近相同\n    * 参数：视角、窗口的长宽比、近远裁面的距离\n    * OrthographicCamera(left, right, top, bottom, near, far)\n  * __透视投影相机__\n    * 特点：类似人眼而近大远小\n    * 参数：各平面距离相机中心的垂直距离\n    * PerspectiveCamera(fov, aspect, near, far)\n  * __3D 相机__\n    * 特点：合成两个相机的拍摄结果，用于 3D 立体影像或视差屏障等效果\n    * StereoCamera()\n  * __全景相机__\n    * 特点：可以 360 度拍摄\n    * 参数：最后一个设置立方体边缘的长度\n    * CubeCamera(near, far, cubeResolution)\n\n### 属性\n  ```js\n  // 相机设置\n  camera.position.set(0, -1, 5);    // 设定相机位置 \n  camera.up.x = 0;                 // 相机以哪个方向为上方\n  camera.lookAt(scene.position);   // 相机面向哪个坐标(默认面向z轴负方向)\n  camera.lookAt(new THREE.Vector3(10,0,0));  // 相机往x轴移动10单位 \n  ```\n\n\n## 物体\n> Object3D 是它们的基类。创建时需要 几何体和材质，几何体定义模型的形状 (骨架)，材质定义几何图形的表面效果 (皮肤，包括颜色、纹理、透明度、质感等)\n\n  * __Line__：线段模型，由线条组成\n  * __Mesh__：网格模型，由三角面和四边形面组成\n  * __Points__：粒子系统，使用一堆点的集合来描述\n  * __Sprite__：精灵图，指包含于场景中的二维图像或动画\n    * 特点：一个永远面向相机的平面\n    * 功能：加载 纹理但是不接受阴影\n\n\n### 几何体\n  * __构造函数创建__：Geometry 是它们的基类\n    * __二维平面__\n      * 圆平面：CircleGeometry \n      * 矩形平面：PlaneGeometry\n    * __三维几何体__\n      * 立方体：BoxGeometry、CubeGeometry(旧版本)\n      * 球体：SphereGeometry    \n      * 圆柱：CylinderGeometry\n      * 圆环：TorusGeometry\n      * 环面：TorusKnotGeometry\n      * 多面体：PolyhedronGeometry\n      * 正四面体：TetrahedronGeometry\n      * 正八面体：OctahedronGeometry\n      * 正二十面体：IcosahedronGeometry\n      * 复杂几何体\n        * 凸面体：ConvexGeometry\n        * 扫描体：LatheGeometry\n        * 管状体：TubeGeometry\n        * 拉伸几何体：ExtrudeGeometry\n        * 参数几何体：ParameterGeometry\n        * 文本几何体：TextGeometry\n  * __自定义创建__\n    * __三维__\n      * 几何体：Geometry\n      * 顶点：Vector3\n      * 顶面：Face3  \n    * __二维__\n      * 平面：Shape\n      * 线条\n        * 直线：moveTo、lineTo \n        * 圆弧：arc、absarc \n        * 椭圆：ellipse、absellipse \n        * 贝塞尔曲线：quadraticCurveTo\n      * 几何体          \n        * makeGeometry\n        * createPointsGeometry\n        * createSpacedPointsGeometry   \n\n  ```js\n  function initShape(){\n\n      // 模型对象和材质对象 \n      var geometry, material;   \n\n\n      // -------------- 构造函数创建 ---------------\n\n      // 矩形平面：PlanGeometry(长,宽, 长的分割, 宽的分割) \n      let planeGeometry = new THREE.PlaneGeometry(100, 50)\n      let planeMaterial = new THREE.MeshLambertMaterial({ color: 0xffffff })\n      let plane = new THREE.Mesh(planeGeometry,planeMaterial)\n      plane.receiveShadow = true        // 接收阴影\n      plane.rotation.x = -0.5*Math.PI   // x 轴旋转 -90 度\n      plane.position.set(15, 0, 0)\n      scene.add( plane )\n      \n      \n      // 圆平面：CircleGeometry(半径, 切片数, 开始, 跨过角度)  \n      // 切片数越大则越接近圆, 参数为3(最小值)是三角形, 参数为4则是矩形\n      geometry = new THREE.CircleGeometry(3, 100)\n      material = new THREE.MeshLambertMaterial({ color: 0xffffff })\n      let circle = new THREE.Mesh(geometry, material)\n\n\n      // 圆环：TorusGeometry(半径, 管道半径, 纬度分割, 经度分割, 圆环面的弧度)\n      // 最后一个参数 控制是否绘制完整一个圆环\n      geometry = new THREE.TorusGeometry(5, 1, 50, 50)  \n      material = new THREE.MeshLambertMaterial({ color: 0x7777ff })\n      let torus = new THREE.Mesh(geometry, material)\n\n      \n      // 立方体：BoxGeometry(长, 宽, 高, 长的分割, 宽的分割, 高的分割)\n      // 旧版本用CubeGeometry\n      geometry = new THREE.BoxGeometry(4, 4, 4)\n      material = new THREE.MeshLambertMaterial({ color: 0xff0000 })\n      let box = new THREE.Mesh(geometry, material)\n\n      \n      // 球体：SphereGeometry(半径, 经度切片, 纬度切片, 经度开始, 经度跨过, 纬度开始, 纬度跨过)\n      geometry = new THREE.SphereGeometry(4, 20, 20)\n      material = new THREE.MeshLambertMaterial({ color: 0x7777ff } )\n      let sphere = new THREE.Mesh(geometry, material)\n      sphere.scale.set(1.5,1.5,1.5);  //缩放\n      \n          \n      // 圆柱：CylinderGeometry(顶部面积, 底部面积, 高, 圆分割, 高分割, 是否没有顶面和底面) \n      // 顶部或底部为0，则变成圆锥\n      geometry = new THREE.CylinderGeometry(2, 2, 5)\n      material = new THREE.MeshLambertMaterial({ color: 0x7777ff })\n      let cylinder = new THREE.Mesh(geometry, material)\n      \n\n      // 正 20 面体 \n      meometry = new THREE.IcosahedronGeometry(4, 0);   \n      material = new THREE.MeshLambertMaterial( {color: 0x7777ff} )\n      let icosahedron = new THREE.Mesh(geometry, material)\n\n\n      // -------------- 自定义创建 ---------------\n\n      // 点模型\n      geometry = new THREE.Geometry();    // 声明一个空几何体对象\n      var p1 = new THREE.Vector3(10, 0, 0);   // 顶点1坐标\n      var p2 = new THREE.Vector3(0, 20, 0);   // 顶点2坐标\n      var p3 = new THREE.Vector3(15, 15, 0);  // 顶点3坐标\n      geometry.vertices.push(p1,p2,p3);       // 顶点坐标添加到geometry对象\n\n      material = new THREE.PointsMaterial({  // 点对象像素的颜色尺寸\n          color: 0x0000ff,\n          size: 10.0       \n      }); \n      var points = new THREE.Points(geometry, material);\n      scene.add(points);        // 点模型添加到场景中\n\n\n      // 线条\n      geometry = new THREE.Geometry();\n      var p1 = new THREE.Vector3(10, 0, 0);\n      var p2 = new THREE.Vector3(0, 20, 0);\n      geometry.vertices.push(p1, p2);           // vertices 存放坐标\n      \n      var color1 = new THREE.Color(0xFF0000);  \n      var color2 = new THREE.Color(0x0000FF);   \n      geometry.colors.push(color1, color2);      // colors 存放顶点颜色\n      \n      material = new THREE.LineBasicMaterial({\n          // color: 0x0000ff,        // 线条颜色，用16进制表示，默认白色\n          vertexColors: THREE.VertexColors,  // 线条材质是否使用顶点颜色\n      });\n      var line = new THREE.Line(geometry, material);\n      scene.add(line);  \n\n\n      // 三角面和矩形 \n      geometry = new THREE.Geometry(); \n      var p1 = new THREE.Vector3(0, 0, 0); \n      var p2 = new THREE.Vector3(80, 0, 0); \n      var p3 = new THREE.Vector3(0, 80, 0); \n\n      // 创建三角面及其法向量 (平面的法向量垂直于平面本身)\n      geometry.vertices.push(p1, p2, p3); \n      var normal = new THREE.Vector3( 0, 0, 1 ); \n      var face = new THREE.Face3( 0, 1, 2, normal); \n      var color1 = new THREE.Color(0xFF0000);  // 红色\n      var color2 = new THREE.Color(0x00FF00);  // 绿色\n      var color3 = new THREE.Color(0x0000FF);  // 蓝色\n      face.vertexColors.push(color1, color2, color3);  // 定义顶点颜色\n      geometry.faces.push(face); \n\n      // 创建矩形平面\n      var p4 = new THREE.Vector3(0, 80, 0); \n      geometry.vertices.push(p1, p2, p3, p4); \n      var normal = new THREE.Vector3(0, 0, 1); \n      var face0 = new THREE.Face3(0, 1, 2, normal); \n      var face1 = new THREE.Face3(0, 2, 3, normal); \n      geometry.faces.push(face0, face1); \n\n      material = new THREE.MeshLambertMaterial({\n          color: 0x0000ff,         \n          side: THREE.DoubleSide   // 两面可见\n      });\n      var mesh = new THREE.Mesh(geometry,material);\n      scene.add(mesh);\n\n\n      // 二维图形：ShapeGeometry(shapes, options)  \n      // shapes 参数: THREE.Shape对象可单个传入, 多个时传数组\n      var x = 0, y = 0\n      var heartShape = new THREE.Shape()  // 心形\n\n      heartShape.moveTo( x + 5, y + 5 )\n      heartShape.bezierCurveTo( x + 5, y + 5, x + 4, y, x, y )\n      heartShape.bezierCurveTo( x - 6, y, x - 6, y + 7,x - 6, y + 7 )\n      heartShape.bezierCurveTo( x - 6, y + 11, x - 3, y + 15.4, x + 5, y + 19 )\n      heartShape.bezierCurveTo( x + 12, y + 15.4, x + 16, y + 11, x + 16, y + 7 )\n      heartShape.bezierCurveTo( x + 16, y + 7, x + 16, y, x + 10, y )\n      heartShape.bezierCurveTo( x + 7, y, x + 5, y + 5, x + 5, y + 5 )\n\n      geometry = new THREE.ShapeGeometry( heartShape )\n      material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } )\n      var mesh = new THREE.Mesh( geometry, material ) \n      scene.add( mesh )\n\n      \n      // 几何体 \n      // 1.创建顶点\n      var vertices = [\n          new THREE.Vector3(0,2,0),\n          new THREE.Vector3(-1,0,0),\n          new THREE.Vector3(0,0,1),\n          new THREE.Vector3(1,0,0),\n          new THREE.Vector3(0,0,-1),\n          new THREE.Vector3(0,-2,0)\n      ]\n\n      // 2.创建面\n      var faces = [\n          new THREE.Face3(0,1,2),\n          new THREE.Face3(0,2,3),\n          new THREE.Face3(0,3,4),\n          new THREE.Face3(0,4,1),\n          new THREE.Face3(5,2,1),\n          new THREE.Face3(5,3,2),\n          new THREE.Face3(5,4,3),\n          new THREE.Face3(5,1,4),\n      ]\n\n      // 3.创建几何体架构\n      var geom = new THREE.Geometry()\n      geom.vertices = vertices\n      geom.faces = faces\n      geom.computeFaceNormals()  //计算法向量, 这决定了对光做出的反应\n\n      // 4.添加材质\n      var materials = [\n          // 几何体面的材质 (Lambert材质适合光照)\n          new THREE.MeshLambertMaterial({ \n              opacity: 0.8, \n              color:0x44e144, \n              transparent: true \n          }),\n          // 一个几何体框架的材质\n          new THREE.MeshBasicMaterial({\n              color:0x008800,\n              wireframe:true\n          }),\n      ]\n\n      // 5.创建几何体(传入结构, 材质)\n      mesh = THREE.SceneUtils.createMultiMaterialObject(geom, materials) \n      mesh.name = '源'\n      mesh.children.forEach(function (e) {\n          e.castShadow = true  //可以生成影子\n      })\n\n      // 6.添加进场景中\n      scene.add(mesh);\n  }\n  ```\n\n\n\n### 材质\n> 三维物体表面各个可视属性（颜色、纹理、光滑度、透明度、反射率、反光度等）的结合，决定了物体的外观效果。THREE.Material 是材质的基类，拥有所有材质的公有属性，它派生出的各种材质如下：\n\n  * __MeshBasicMaterial__\n    * 名称：基础材质 \n    * 功能\n      * 显示几何体的线框\n      * 给几何体赋予一种简单的颜色 \n    * 特点\n      * 材质颜色如果没有指定则随机\n      * 物体颜色始终是材质颜色，不会因光照产生明暗、阴影效果\n  * __MeshLambertMaterial__\n    * 名称：朗伯材质\n    * 功能：创建 暗淡的、不光亮的 表面\n    * 特点\n      * 可以通过 emissive 属性给材质添加亮色\n      * 在物体表面均匀地散射灯光，比如纸的表面粗糙但亮度均匀\n  * __MeshPhongMaterial__  \n    * 名称：Phong 式材质\n    * 功能：创建金属类光亮的表面\n    * 特点\n      * 反光强度更大\n      * 会给表面添加金属光泽\n      * 可通过 shininess 属性改变反光强度\n  * __MeshStandardMaterial__\n    * 名称：网格标准材质\n    * 功能：创建 暗淡的、有金属性光泽的 表面\n    * 特点\n      * MeshLambertMaterial、MeshPhoneMaterial 的结合\n      * 同时具有 粗糙度和金属性 的材质，并且可以改变这些属性\n  * __MeshDepthMaterial__\n    * 名称：深度材质\n    * 功能：根据内容所在的深度对网格对象的灰度级别从黑到白绘制\n  * __MeshNormalMaterial__\n    * 名称：法向材质\n    * 功能：根据面的 法线或朝向 使用不同的颜色来渲染网格的面\n  * __MeshFaceMaterial__\n    * 名称：面材质\n    * 功能：一个可以为几何体的各个表面指定不同颜色的容器 \n  * __ShaderMaterial__\n    * 名称：着色器材质\n    * 功能：允许使用自定义的着色器程序，比如顶点的放置方式、像素的着色方式\n  * __LineBasicMaterial__\n    * 名称：直线基础材质\n    * 功能：用于在 THREE.Line 中创建着色的直线  \n  * __LineDashMaterial__\n    * 名称：虚线材质\n    * 功能：允许创建出一种虚线的效果\n  * __PointsMaterial__\n    * 名称：粒子材质\n    * 功能：适用于粒子系统、模拟雪花小雨等\n  * __SpriteMaterial__\n    * 名称：雪碧材质\n    * 功能：加载 图像纹理、canvas 创建的纹理等\n    * 特点：能够使用纹理贴图，并且应用于雪碧材质上\n\n          \n\n## 光源\n> THREE.Light 是所有光源的基类，其构造函数接受 hex(一个16进制的颜色值)作为参数。但要让光源具有颜色之外的特性。我们需要使用由基类派生出来的其他种类光源，注意环境光、方向光的光强不受距离远近影响 \n\n### 类型\n  * __AmbientLight__\n    * 名称：环境光\n    * 功能：弱化阴影、添加颜色\n    * 光线：来自各个方向并均匀反射到物体表面\n    * 特点\n      * 影响整个场景\n      * 没有特定来源\n      * 不会影响阴影的生成\n      * 不能作为场景中唯一的光源\n  * __DirectionLight__\n    * 名称：平行光、方向光\n    * 功能：常用于实现阴影效果\n    * 光线：一组没有衰减的平行光线，类似太阳光\n    * 特点：产生阴影、光强相同、效果只与方向有关\n  * __PointLight__\n    * 名称：点光源\n    * 光线：单点发光但辐射四面八方\n    * 特点：类似蜡烛和灯泡、单点发光、不产生阴影\n  * __SpotLight__\n    * 名称：聚光灯      \n    * 功能：实现阴影效果，类似台灯、手电筒\n    * 光线：从一个锥体中射出并在物体上产生聚光的效果\n    * 特点\n      * 距离越远则光强越弱\n      * 光强衰减指数越大则光强衰减越快\n\n\n### 影响材质\n> 只有在正常的光照条件下，我们才能容易分辨物体的材质\n\n  * 没有任何光源时，材质颜色最终是黑色 (离开光时材质无法体现)\n  * Lambert 材质会受环境光的影响而呈现环境光的颜色，与材质本身颜色关系不大\n  * 只有环境光时，灯光位置不影响材质效果(阴影等)。只有其他光源时，能照射到的地方为 光源颜色，不能照射的地方则呈现暗色(黑色)\n  * 当混合光源存在时，单一光源能照射的地方呈现为 对应的光源颜色，多种光源都能照射到的地方是 颜色相加结果，都不能照射到的则呈现 暗色/环境光颜色\n    * 光源：环境光为 绿色(0x00FF00)，平行光为 红色(0xFF0000)\n    * 效果：平行光照射到的地方呈现黄色(颜色值相加：0xFFFF00)，其它呈现绿色\n\n\n### 阴影效果\n  ```js\n  function initShadow() { \n      // 告诉render我要渲染阴影\n      renderer.shadowMap.enabled = true\n\n      // 让物体(立方体)投射阴影\n      var geo = new THREE.BoxGeometry(10,10,10)\n      var mat = new THREE.MeshPhoneMaterial({color:0xffffff})\n      var box = new THREE.Mesh(geo,mat)\n      box.castShadow = true\n\n      // 让其他物体(平面)接受阴影\n      var geo_2 = new THREE.PlaneGeometry(100,50,32,32)\n      var mat_2 = new THREE.MeshPhoneMaterial({color:0xeeeeee, side:THREE.DoubleSize})\n      var plane = new THREE.Mesh(geo_2, mat_2)\n      plane.receiveShadow = true\n\n      // 告诉光源需要投射阴影\n      var light = new THREE.DirectionalLight(0xffffff)\n      light.castShadow = true \n      scene.add(light)    \n  }\n  ```\n\n\n## 渲染器\n  * __WebGLRender__：使用 WebGL 渲染图形\n  * __WebGLRenderTarget__：渲染一个缓冲区\n  * __WebGLRenderTargetCube__：用于 CubeCamera\n  * __CSS3DRenderer__：基于 CSS3，简化版为 2D\n  * __SVGRenderer__：使用 SVG 渲染几何数据\n\n\n## 控制器\n  * __FlyControls__：飞行控制，用键盘和鼠标控制相机的移动和转动\n  * __OrbitControls__：轨道控制器，模拟轨道卫星旋转平移并用键盘、鼠标控制相机位置\n  * __PointerLockControls__：指针锁定，鼠标离开画布依然能被捕捉到鼠标交互而常用于游戏\n  * __TrackballControls__：轨迹球控制器，通过键盘和鼠标控制前后左右平移和缩放场景\n  * __TransformControls__：变换物体控制器，可以通过鼠标对物体的进行拖放等操作\n\n\n\n","slug":"17-threejs","published":1,"updated":"2019-04-15T17:05:17.192Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvid4pq3002o0nbxgln5ah0c","content":"<!-- build time:Sat May 11 2019 01:36:59 GMT+0800 (中国标准时间) --><html><head></head><body><h1 id=\"一、WebGL-基础\"><a href=\"#一、WebGL-基础\" class=\"headerlink\" title=\"一、WebGL 基础\"></a>一、WebGL 基础</h1><h2 id=\"OpenGL、WebGL\"><a href=\"#OpenGL、WebGL\" class=\"headerlink\" title=\"OpenGL、WebGL\"></a>OpenGL、WebGL</h2><ul><li><strong>OpenGL</strong>：最常用的跨平台图形库，用于渲染 2D、3D 矢量图形的跨语言、跨平台的应用程序编程接口</li><li><strong>OpenGL ES</strong>：OpenGL API 的子集 GPU，是针对手机、PDA 和游戏主机等嵌入式设备而专门设计的接口</li><li><strong>GLSL</strong>：OpenGL ES 着色语言，用于OpenGL中着色编程的语言。在图形卡的GPU上执行，代替了固定的渲染管线的一部分，使渲染管线中不同层次具有可编程性，如视图转换、投影转换等。</li><li><strong>WebGL</strong>：基于 OpenGL 设计的面向 web 的图形标准，它提供的一系列 Js API 对显卡的硬件细节进行了封装抽象，可用于控制 GPU渲染管线(显卡硬件) 进行图形渲染，从而获得了较高性能。</li><li><strong>WebGL程序</strong>：主要组成是 js控制代码 和 计算机的图形处理单元GPU。而 GPU 核心即着色程序 program 由顶点和片元两个着色器组成，使用 GLSL 编写并通过常以字符串的形式存放在Js中等待调用 (浏览器不识别 GLSL)。</li></ul><h2 id=\"CPU、GPU\"><a href=\"#CPU、GPU\" class=\"headerlink\" title=\"CPU、GPU\"></a>CPU、GPU</h2><blockquote><p>图像处理主要偏简单的矩阵运算，逻辑判断等很少。两者的设计架构不同。GPU很适合做简单的并发计算，应用于图像处理、深度学习等领域加快速度，引爆了人工智能</p></blockquote><ul><li><strong>CPU</strong><ul><li>可看作”万能教授”，但运算效率较低</li><li>中央处理器，计算机的运算和控制核心</li><li>需要很强的通用性来处理各种不同的数据类型和逻辑判断</li></ul></li><li><strong>GPU</strong><ul><li>可看作”专业学生”，用来实现硬件加速计算，执行重复运算效率高</li><li>图像处理器，是显卡的处理器和核心，也是图像运算工作的微处理器</li><li>专为执行复杂的数学和几何计算而设计，用于将 CPU 从图形处理的任务中解放出来而去执行其他更多的系统任务，提高计算机的整体性能</li></ul></li></ul><h2 id=\"图形渲染\"><a href=\"#图形渲染\" class=\"headerlink\" title=\"图形渲染\"></a>图形渲染</h2><div style=\"text-indent:2em\">渲染是从使用计算机程序模型生成图像的过程。在图形中一个虚拟场景的呈现需要使用 几何、视点、纹理、光照和阴影等通过一个渲染程序传递信息描述，输出一个数字图像。渲染可以在本地或远程上进行。复杂图像所需的硬件资源可以在专用服务器上完成，即基于服务器的绘制。渲染也可以通过在本地CPU完成, 即基于客户端的渲染。所以渲染类型如下：</div><ul><li>软件渲染：所有的渲染是在 CPU 的帮助下计算完成。</li><li>硬件渲染：所有的图形计算都由 GPU (图形处理单元)完成的。</li></ul><h2 id=\"图形术语\"><a href=\"#图形术语\" class=\"headerlink\" title=\"图形术语\"></a>图形术语</h2><ul><li><strong>坐标系</strong>：x、y、z 轴<ul><li>无论画布多大，WebGL 上的坐标被限制为 (1, 1, 1)、(-1, -1, -1)</li><li>WebGL 在 GPU 上的主要工作就是将顶点数据通过矩阵变换转换到裁剪空间坐标，然后基于空间坐标绘制像素点</li></ul></li><li><strong>缓冲</strong>：即将发送到GPU 的一些二进制数据序列<ul><li>缓冲区对象用于存储要绘制模型的各种数据，比如顶点、颜色等</li><li>缓冲区对象驻留在 GPU 存储器却可以被直接呈现，提高了性能</li></ul></li><li><strong>图元</strong>：几何顶点的组合，比如点、线段和三角面</li><li><strong>片元和像素</strong><ul><li>在光栅化中纹理映射之后图元信息转化为了像素</li><li>片元包括 像素点 和 颜色、深度和纹理数据等信息</li></ul></li><li><strong>网格</strong>：使用顶点所绘的 2D、3D 模型，它的每个面被称为 一个片元 (一般是三角形)</li><li><strong>着色器</strong><ul><li>现代 GPU 中的顶点处理和片段处理等可编程部分被称为着色器</li><li>主要包括顶点着色器和片元着色器，可理解为运行在显卡中的指令和数据</li><li>着色器程序使用的是 GLSL ES 语言，所以在 Js 中需要存放在字符串中等待调用编译，通过编译处理后传递给 顶点/片元 着色器执行</li></ul></li><li><strong>纹理图像</strong><ul><li>将一张真实图片贴到一个几何图像表面称为 纹理映射，映射的图像为纹理图像</li><li>组成纹理图像的像素称为纹素，而纹理坐标 是纹理图像上的坐标，通过纹理坐标可以在纹理图像上获取纹素颜色</li></ul></li><li><strong>绘图</strong><ul><li>WebGL 中的顶点、颜色、纹理等几何详细信息存储在缓冲区对象，然后被传递到GPU上的着色器程序来创建图形对象</li><li>WebGL 只能绘制 点、线和三角形，其他都是由它们合成后绘制到三维空间</li></ul></li></ul><h1 id=\"二、WebGL-程序\"><a href=\"#二、WebGL-程序\" class=\"headerlink\" title=\"二、WebGL 程序\"></a>二、WebGL 程序</h1><blockquote><p>程序代码是 Js、OpenGL 的组合，两者分别负责与 CPU、GPU 通信</p></blockquote><h2 id=\"显卡内部结构\"><a href=\"#显卡内部结构\" class=\"headerlink\" title=\"显卡内部结构\"></a>显卡内部结构</h2><blockquote><p>电脑一般都具有独立显卡</p></blockquote><ul><li>GPU：渲染管线<ul><li>功能：和 GPU 传递数据</li><li>内容：可编程的着色器、不可编程的光栅器等</li></ul></li><li>显存：GPU 读写数据的存储区<ul><li>顶点缓存：存储顶点的位置、颜色等数据</li><li>渲染缓存：接收渲染管线生成数据</li><li>纹理缓存：用于实现纹理贴图</li><li>帧缓存<ul><li>分类: 屏幕缓存、离屏缓存</li><li>组成: 颜色缓存、深度缓存、模板缓存</li></ul></li></ul></li></ul><h2 id=\"图像绘制流程\"><a href=\"#图像绘制流程\" class=\"headerlink\" title=\"图像绘制流程\"></a>图像绘制流程</h2><blockquote><p>上线网站的 WebGL 相关文件会放在远程的服务器硬盘存储器。网页 http 请求后，CPU 将顶点坐标等数据 和 WebGL 程序代码 传递给 GPU 存储</p></blockquote><ol><li>浏览器解析硬盘的 WebGL 文件，CPU 分配内存并将数据传递给 GPU 存储数据和程序代码</li><li>CPU 执行程序初始化并调用 GPU 存储的程序代码，初始化着色器时把处理好的 着色器程序 和 矩阵等数据 发送给 GPU 处理器</li><li>GPU 通过矩阵变换和光栅化等操作将图像信息转化为像素并写入显卡的帧缓存 (包括颜色、透明度等)</li><li>显示器扫描读取显存中的像素数据，然后显示到浏览器 canvas</li></ol><h2 id=\"GPU-处理流程\"><a href=\"#GPU-处理流程\" class=\"headerlink\" title=\"GPU 处理流程\"></a>GPU 处理流程</h2><blockquote><p>获取顶点坐标、图元装配(即画出一个个三角形)、光栅化(生成片元, 即一个个像素点)、存储在缓存区</p></blockquote><ol><li>数据准备<ul><li>uv：贴图坐标</li><li>索引：三角形绘制顺序</li><li>矩阵数据：uniform 变量传递给顶点着色器</li><li>顶点坐标：attribute 变量传递给顶点着色器，一般由三维软件导出几何体的各个顶点</li></ul></li><li>生成顶点着色器<ul><li>顶点着色器：Js 定义的程序代码，初始化后会传递给 GPU</li></ul></li><li>图元装配<ul><li>实现：顶点坐标 转换为图元 (一般是三角形)</li><li>本质：GPU 逐顶点数量执行顶点着色器程序，通过矩阵变换将孤立的顶点坐标处理为 2D 图形并输出</li></ul></li><li>生成片元着色器<ul><li>实现：处理模型的颜色、质地、光照效果、阴影</li></ul></li><li>光栅化<ul><li>实现：将图元转换为像素点</li><li>片元：一个像素点及其包含的颜色、深度和纹理数据</li><li>本质：GPU 逐片元数量执行片元着色器程序，为每个片元进行着色</li></ul></li><li>存储到缓存区<ul><li>片元只要通过了检测和融合 (融合单元主要实现透明度效果)，就可以存储到颜色缓存区，最终完成整个渲染</li></ul></li></ol><h1 id=\"三、WebGL-绘图\"><a href=\"#三、WebGL-绘图\" class=\"headerlink\" title=\"三、WebGL 绘图\"></a>三、WebGL 绘图</h1><h2 id=\"初始化绘图上下文\"><a href=\"#初始化绘图上下文\" class=\"headerlink\" title=\"初始化绘图上下文\"></a>初始化绘图上下文</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"canvas\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> gl = canvas.getContext(<span class=\"string\">\"webgl\"</span>, {</span><br><span class=\"line\">    <span class=\"comment\">//可选选项</span></span><br><span class=\"line\">    antialias: <span class=\"literal\">false</span>, </span><br><span class=\"line\">    stencil: <span class=\"literal\">true</span></span><br><span class=\"line\">})</span><br></pre></td></tr></tbody></table></figure><h2 id=\"初始化着色器程序\"><a href=\"#初始化着色器程序\" class=\"headerlink\" title=\"初始化着色器程序\"></a>初始化着色器程序</h2><ul><li>创建：顶点着色器程序、片段着色器程序</li><li>编译：通过 js 将这两个着色器 link 到一个 program (着色程序) 并提交到 GPU</li></ul><h2 id=\"建立模型和数据缓存\"><a href=\"#建立模型和数据缓存\" class=\"headerlink\" title=\"建立模型和数据缓存\"></a>建立模型和数据缓存</h2><ul><li>创建缓冲区对象并绑定到目标，然后写入数据并连接所分配的变量，运行程序时使用缓冲区对象向顶点传入多个顶点数据</li><li>创建纹理并加载纹理图像，配置属性并在 webgl 中使用</li></ul><h2 id=\"图像绘制和动画\"><a href=\"#图像绘制和动画\" class=\"headerlink\" title=\"图像绘制和动画\"></a>图像绘制和动画</h2><h3 id=\"简单图形\"><a href=\"#简单图形\" class=\"headerlink\" title=\"简单图形\"></a>简单图形</h3><ul><li>API：<code>gl.drawArrays(mode, first, count)</code><ul><li>mode：画图函数(点、线、三角形)</li><li>first：指定顶点开始绘制的位置</li><li>count：所绘制图形的顶点个数</li></ul></li><li>实例<ul><li>三个点：<code>gl.drawArrays(gl.POINTS, 0, 3)</code></li><li>三角形：<code>gl.drawsArrays(gl.TRIANGLES, 0, 3)</code></li></ul></li></ul><h3 id=\"复杂的三维图形\"><a href=\"#复杂的三维图形\" class=\"headerlink\" title=\"复杂的三维图形\"></a>复杂的三维图形</h3><ul><li>API：<code>gl.drawElements(mode, count, type, offset)</code><ul><li>type：指定缓冲区中值的类型，常用 gl.UNSIGNED_BYTE/UNSIGNED_SHORT 表示无符号8/16位整数值</li><li>offset：指定索引数组中开始绘制的位置，以字节为单位</li></ul></li><li>实例<ul><li>三角形：<code>gl.drawElement(gl.TRIANGLES, n, gl.UNSIGNED_SHORT, 0)</code></li></ul></li></ul><h2 id=\"方法封装\"><a href=\"#方法封装\" class=\"headerlink\" title=\"方法封装\"></a>方法封装</h2><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">webGLStart</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"comment\">// 初始化WEBGL上下文信息</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"myCanvas\"</span>);</span><br><span class=\"line\">    initGL(canvas);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 初始化着色器</span></span><br><span class=\"line\">    initShader();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 初始化缓冲区</span></span><br><span class=\"line\">    initBuffers();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 初始化纹理图片</span></span><br><span class=\"line\">    initTexture();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 指定清空画布的颜色，</span></span><br><span class=\"line\">    gl.clearColor(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 清除颜色缓冲区 (使用定义的颜色来填充相应区域)</span></span><br><span class=\"line\">    gl.clear(gl.COLOR_BUFFER_BIT);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 开启隐藏面消除的功能  启用深度测试</span></span><br><span class=\"line\">    gl.enable(gl.DEPTH_TEST);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 开始绘制场景</span></span><br><span class=\"line\">    drawScene();</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h1 id=\"四、Three-js-基础\"><a href=\"#四、Three-js-基础\" class=\"headerlink\" title=\"四、Three.js 基础\"></a>四、Three.js 基础</h1><blockquote><p>使用 js 代码写 3D 程序</p></blockquote><h2 id=\"对比-WebGL\"><a href=\"#对比-WebGL\" class=\"headerlink\" title=\"对比 WebGL\"></a>对比 WebGL</h2><ul><li>WebGL<ul><li>原生 API 是一种非常低级的接口，需要一些数学和图形学的相关技术，学习和开发项目的成本较高</li><li>可看作是浏览器提供的接口，js 中可以直接用 WebGL API 绘制3D图形</li></ul></li><li>Three.js<ul><li>通过对 WebGL API 的封装与简化而形成的一个易用的图形库，上手容易</li><li>可看作是一款 webGL框架。它将复杂接口简单化，将 webGL 基于光栅化的 2D API 封装成了简单的 3D API，同时基于面向对象思维而将数据结构对象化</li></ul></li></ul><h2 id=\"简化工作\"><a href=\"#简化工作\" class=\"headerlink\" title=\"简化工作\"></a>简化工作</h2><ul><li>辅助导出模型数据</li><li>自动生成各种矩阵</li><li>生成了顶点着色器</li><li>辅助生成材质、配置灯光</li><li>根据设置的材质生成片元着色器</li></ul><h2 id=\"执行流程\"><a href=\"#执行流程\" class=\"headerlink\" title=\"执行流程\"></a>执行流程</h2><ol><li>创建场景、灯光、相机等</li><li>创建模型、材质(内置/自定义)</li><li>生成顶点着色器、片元着色器</li><li>渲染页面</li></ol><h1 id=\"五、Three-js-绘图\"><a href=\"#五、Three-js-绘图\" class=\"headerlink\" title=\"五、Three.js 绘图\"></a>五、Three.js 绘图</h1><h2 id=\"模型渲染\"><a href=\"#模型渲染\" class=\"headerlink\" title=\"模型渲染\"></a>模型渲染</h2><ul><li>原理：将创建好的物体添加到场景中，然后通过相机渲染到渲染器，从而呈现到网页</li><li>方式<ul><li>实时渲染：不停地渲染画面</li><li>离线渲染：事先渲染出一帧帧图片，使用时拼接</li></ul></li></ul><h2 id=\"实现步骤\"><a href=\"#实现步骤\" class=\"headerlink\" title=\"实现步骤\"></a>实现步骤</h2><ol><li>构建一个三维空间 (创建场景)</li><li>选择一个观察点，并确定观察方向/角度等 (创建相机)</li><li>在场景中添加供观察的物体 (创建物体并添加至场景中)</li><li><p>将观察到的场景渲染到屏幕上 (创建渲染器并渲染场景)</p><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 绘制网格线</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initGrid</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 场景</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> scene = <span class=\"keyword\">new</span> THREE.Scene();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 相机</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> camera = <span class=\"keyword\">new</span> THREE.OrthographicCamera(<span class=\"number\">-5</span>, <span class=\"number\">5</span>, <span class=\"number\">3.75</span>, <span class=\"number\">-3.75</span>, <span class=\"number\">0.1</span>, <span class=\"number\">100</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 设定相机位置</span></span><br><span class=\"line\">    camera.position.set(<span class=\"number\">0</span>, <span class=\"number\">-25</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 相机看向</span></span><br><span class=\"line\">    camera.lookAt(<span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>));</span><br><span class=\"line\">    scene.add(camera);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 渲染器</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> renderer = <span class=\"keyword\">new</span> THREE.WebGLRenderer({ <span class=\"attr\">antialias</span>: <span class=\"literal\">true</span> });</span><br><span class=\"line\">    <span class=\"comment\">// 设定渲染器尺寸</span></span><br><span class=\"line\">    renderer.setSize(<span class=\"number\">800</span>, <span class=\"number\">600</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 添加到dom</span></span><br><span class=\"line\">    renderer.autoClear = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 重绘时颜色</span></span><br><span class=\"line\">    renderer.setClearColor(<span class=\"number\">0x000000</span>);</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.appendChild(renderer.domElement);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 定义一个几何体</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> geometry = <span class=\"keyword\">new</span> THREE.Geometry();</span><br><span class=\"line\">    geometry.vertices.push(<span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">-2</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>));</span><br><span class=\"line\">    geometry.vertices.push(<span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">2</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>));</span><br><span class=\"line\">    <span class=\"comment\">// for循环出来六条线段</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt;= <span class=\"number\">5</span>; i++) {</span><br><span class=\"line\">        <span class=\"comment\">// 定义竖着的线段</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> line = <span class=\"keyword\">new</span> THREE.Line(geometry, <span class=\"keyword\">new</span> THREE.LineBasicMaterial({</span><br><span class=\"line\">            color: <span class=\"number\">0xffffff</span>,</span><br><span class=\"line\">        }));</span><br><span class=\"line\">        <span class=\"comment\">// 每条线段之间的间隔为0.8，-2是为了达到田字格的效果</span></span><br><span class=\"line\">        line.position.z = (i * <span class=\"number\">0.8</span>) - <span class=\"number\">2</span>;</span><br><span class=\"line\">        scene.add(line);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 定义横着的线段</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> line = <span class=\"keyword\">new</span> THREE.Line(geometry, <span class=\"keyword\">new</span> THREE.LineBasicMaterial({</span><br><span class=\"line\">            color: <span class=\"number\">0xffffff</span>,</span><br><span class=\"line\">            opacity: <span class=\"number\">0.2</span></span><br><span class=\"line\">        }));</span><br><span class=\"line\">        line.position.x = (i * <span class=\"number\">0.8</span>) - <span class=\"number\">2</span>;</span><br><span class=\"line\">        line.rotation.y = <span class=\"number\">90</span> * <span class=\"built_in\">Math</span>.PI / <span class=\"number\">180</span>;</span><br><span class=\"line\">        scene.add(line);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 渲染</span></span><br><span class=\"line\">        renderer.render(scene, camera);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure></li></ol><h2 id=\"场景动画\"><a href=\"#场景动画\" class=\"headerlink\" title=\"场景动画\"></a>场景动画</h2><blockquote><p>在循环渲染(即重绘，循环绘制新场景) 的过程中不断改变 物体或相机的属性，让场景动起来 的颜色、位置等</p></blockquote><ul><li>属性<ul><li>物体：<code>scale、rotation、position、material</code></li><li>相机：<code>位置、方向、面向坐标</code></li></ul></li><li><p>实现方式</p><ul><li><strong>直接实现</strong><ul><li>物体移动而摄像机不动：<code>mesh.position.x -= 1</code></li><li>摄像机移动而物体不动：<code>camera.position.x = camera.position.x + 1</code></li></ul></li><li><strong>Tween.js</strong><ul><li>引入后可以定义某个属性值的过渡而实现复杂动画</li><li>它会自动计算出起止的所有中间值，这个过程叫做 tweening 补间</li></ul></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 旋转的正方体</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> scene, camera, renderer, mesh, stats;</span><br><span class=\"line\">initThree();</span><br><span class=\"line\">animation();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initThree</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"comment\">// 创建场景对象 (插入光照/物体)</span></span><br><span class=\"line\">    scene = <span class=\"keyword\">new</span> THREE.Scene();  </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建相机对象</span></span><br><span class=\"line\">    camera = <span class=\"keyword\">new</span> THREE.PerspectiveCamera( <span class=\"number\">70</span>, <span class=\"built_in\">window</span>.innerWidth / <span class=\"built_in\">window</span>.innerHeight, <span class=\"number\">1</span>, <span class=\"number\">1000</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 光照设置</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> light = <span class=\"keyword\">new</span> THREE.DirectionalLight( <span class=\"number\">0xffffff</span> );</span><br><span class=\"line\">    light.position.set( <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span> ).normalize();  <span class=\"comment\">// 光源位置</span></span><br><span class=\"line\">    scene.add(light);    <span class=\"comment\">// 将光照插入场景</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建网络模型</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> geometry = <span class=\"keyword\">new</span> THREE.BoxGeometry( <span class=\"number\">10</span>, <span class=\"number\">10</span>, <span class=\"number\">10</span>);  <span class=\"comment\">// 创建一个立方体几何对象</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> material = <span class=\"keyword\">new</span> THREE.MeshPhongMaterial({        <span class=\"comment\">// 材质对象</span></span><br><span class=\"line\">            color: <span class=\"number\">0x0033ff</span>, </span><br><span class=\"line\">            specular: <span class=\"number\">0x555555</span>, </span><br><span class=\"line\">            shininess: <span class=\"number\">30</span> </span><br><span class=\"line\">    });</span><br><span class=\"line\"></span><br><span class=\"line\">    mesh = <span class=\"keyword\">new</span> THREE.Mesh(geometry, material );   <span class=\"comment\">// 网格模型对象</span></span><br><span class=\"line\">    mesh.position.z = <span class=\"number\">-50</span>;</span><br><span class=\"line\">    scene.add(mesh);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建渲染器对象</span></span><br><span class=\"line\">    renderer = <span class=\"keyword\">new</span> THREE.WebGLRenderer({ <span class=\"attr\">antialias</span>: <span class=\"literal\">true</span> })   <span class=\"comment\">// 参数是可选配置</span></span><br><span class=\"line\">    renderer.setSize(<span class=\"built_in\">window</span>.innerWidth, <span class=\"built_in\">window</span>.innerHeight)   <span class=\"comment\">// canvas元素设置宽高 (默认300/150)</span></span><br><span class=\"line\">    renderer.clear()                                <span class=\"comment\">// 清除面板</span></span><br><span class=\"line\">    renderer.setClearColor(<span class=\"number\">0xb9d3ff</span>, <span class=\"number\">1</span>)             <span class=\"comment\">// 设置画布颜色</span></span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.appendChild(renderer.domElement)  <span class=\"comment\">// 将Canvas元素添加到<body>中。</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">window</span>.addEventListener( <span class=\"string\">'resize'</span>, onWindowResize, <span class=\"literal\">false</span> );</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">onWindowResize</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">        camera.aspect = <span class=\"built_in\">window</span>.innerWidth / <span class=\"built_in\">window</span>.innerHeight;</span><br><span class=\"line\">        camera.updateProjectionMatrix();</span><br><span class=\"line\">        renderer.setSize( <span class=\"built_in\">window</span>.innerWidth, <span class=\"built_in\">window</span>.innerHeight );</span><br><span class=\"line\">        render();</span><br><span class=\"line\">    }</span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"comment\">// 执行渲染</span></span><br><span class=\"line\">    render();         </span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">render</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    renderer.render(scene, camera)    </span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 简单动画：在循环渲染过程中不断改变 物体/相机的属性，从而让场景动起来</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">animation</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    mesh.rotation.x += <span class=\"number\">.04</span>;</span><br><span class=\"line\">    mesh.rotation.y += <span class=\"number\">.02</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    render();</span><br><span class=\"line\">    requestAnimationFrame(animation);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// mesh.material = new THREE.MeshLambertMaterial({</span></span><br><span class=\"line\">    <span class=\"comment\">//     color: 0xff0000</span></span><br><span class=\"line\">    <span class=\"comment\">// });</span></span><br><span class=\"line\">    <span class=\"comment\">// mesh.position.z = 1;</span></span><br><span class=\"line\">    <span class=\"comment\">// mesh.position.set(1.5, -0.5, 0);</span></span><br><span class=\"line\">    <span class=\"comment\">// mesh.position = new THREE.Vector3(1.5, -0.5, 0);</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 更新性能插件     </span></span><br><span class=\"line\">    <span class=\"comment\">// stats.update();  </span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 让物体运动</span></span><br><span class=\"line\">    <span class=\"comment\">// TWEEN.update();   </span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 复杂动画：Tween 的任何一个函数返回的都是自身，支持链式编程</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initTween</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\">    <span class=\"keyword\">new</span> TWEEN.Tween(mesh.position)    <span class=\"comment\">// 要改变属性的对象</span></span><br><span class=\"line\">            .to( { <span class=\"attr\">x</span>: <span class=\"number\">-400</span> }, <span class=\"number\">3000</span> )  <span class=\"comment\">// 目标值和需要时间</span></span><br><span class=\"line\">            .repeat( <span class=\"literal\">Infinity</span> )       <span class=\"comment\">// 重复无穷次</span></span><br><span class=\"line\">            .start();                 <span class=\"comment\">// 开始动画</span></span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure></li></ul><h2 id=\"性能检测\"><a href=\"#性能检测\" class=\"headerlink\" title=\"性能检测\"></a>性能检测</h2><blockquote><p>引用插件 stats.js 之后可以在场景中的左上角看到视图小框，点击切换可看到以下信息</p></blockquote><ul><li><strong>38 MS (19-74)</strong>：MS 表示渲染一帧需要的毫秒数，其值越小越好</li><li><p><strong>34 FPS (30-34)</strong>：FPS 表示每秒渲染的帧数，其值越大越好，括号内表示帧率范围</p><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动画性能检测： http://www.wjceo.com/lib/js/libs/stats.min.js</span></span><br><span class=\"line\">stats = <span class=\"keyword\">new</span> Stats();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 参数为 0 时显示 FPS 界面，参数为 1 时显示 MS 界面</span></span><br><span class=\"line\">stats.setMode(<span class=\"number\">1</span>);  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// stats 的界面对应左上角</span></span><br><span class=\"line\">stats.domElement.style.position = <span class=\"string\">'absolute'</span>;</span><br><span class=\"line\">stats.domElement.left = <span class=\"string\">'0px'</span>;</span><br><span class=\"line\">stats.domElement.top = <span class=\"string\">'0px'</span>;</span><br><span class=\"line\"><span class=\"built_in\">document</span>.body.appendChild(stats.dom);</span><br></pre></td></tr></tbody></table></figure></li></ul><h1 id=\"六、Three-js-要素\"><a href=\"#六、Three-js-要素\" class=\"headerlink\" title=\"六、Three.js 要素\"></a>六、Three.js 要素</h1><blockquote><p>绘图页面中必备且唯一的要素：camera、scene、renderer</p></blockquote><ul><li><strong>Scene</strong>：场景（三维空间），是物体、光源等元素的容器</li><li><strong>Camera</strong>：相机（观察者），控制视角位置、范围和焦点位置</li><li><strong>Object3D</strong>：物体（三维模型），包括二维的点线面、三维的粒子等</li><li><strong>Light</strong>：光源，包括全局光、平行光、点光源等</li><li><strong>Renderer</strong>：渲染器（画布），用于渲染场景及其物体</li><li><strong>Control</strong>：控制器（相机控件），可通过键盘、鼠标控制相机</li></ul><h2 id=\"相机\"><a href=\"#相机\" class=\"headerlink\" title=\"相机\"></a>相机</h2><h3 id=\"分类\"><a href=\"#分类\" class=\"headerlink\" title=\"分类\"></a>分类</h3><ul><li><strong>正投影相机</strong><ul><li>特点：表现物体的实际尺寸而远近相同</li><li>参数：视角、窗口的长宽比、近远裁面的距离</li><li>OrthographicCamera(left, right, top, bottom, near, far)</li></ul></li><li><strong>透视投影相机</strong><ul><li>特点：类似人眼而近大远小</li><li>参数：各平面距离相机中心的垂直距离</li><li>PerspectiveCamera(fov, aspect, near, far)</li></ul></li><li><strong>3D 相机</strong><ul><li>特点：合成两个相机的拍摄结果，用于 3D 立体影像或视差屏障等效果</li><li>StereoCamera()</li></ul></li><li><strong>全景相机</strong><ul><li>特点：可以 360 度拍摄</li><li>参数：最后一个设置立方体边缘的长度</li><li>CubeCamera(near, far, cubeResolution)</li></ul></li></ul><h3 id=\"属性\"><a href=\"#属性\" class=\"headerlink\" title=\"属性\"></a>属性</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 相机设置</span></span><br><span class=\"line\">camera.position.set(<span class=\"number\">0</span>, <span class=\"number\">-1</span>, <span class=\"number\">5</span>);    <span class=\"comment\">// 设定相机位置 </span></span><br><span class=\"line\">camera.up.x = <span class=\"number\">0</span>;                 <span class=\"comment\">// 相机以哪个方向为上方</span></span><br><span class=\"line\">camera.lookAt(scene.position);   <span class=\"comment\">// 相机面向哪个坐标(默认面向z轴负方向)</span></span><br><span class=\"line\">camera.lookAt(<span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">10</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>));  <span class=\"comment\">// 相机往x轴移动10单位</span></span><br></pre></td></tr></tbody></table></figure><h2 id=\"物体\"><a href=\"#物体\" class=\"headerlink\" title=\"物体\"></a>物体</h2><blockquote><p>Object3D 是它们的基类。创建时需要 几何体和材质，几何体定义模型的形状 (骨架)，材质定义几何图形的表面效果 (皮肤，包括颜色、纹理、透明度、质感等)</p></blockquote><ul><li><strong>Line</strong>：线段模型，由线条组成</li><li><strong>Mesh</strong>：网格模型，由三角面和四边形面组成</li><li><strong>Points</strong>：粒子系统，使用一堆点的集合来描述</li><li><strong>Sprite</strong>：精灵图，指包含于场景中的二维图像或动画<ul><li>特点：一个永远面向相机的平面</li><li>功能：加载 纹理但是不接受阴影</li></ul></li></ul><h3 id=\"几何体\"><a href=\"#几何体\" class=\"headerlink\" title=\"几何体\"></a>几何体</h3><ul><li><strong>构造函数创建</strong>：Geometry 是它们的基类<ul><li><strong>二维平面</strong><ul><li>圆平面：CircleGeometry</li><li>矩形平面：PlaneGeometry</li></ul></li><li><strong>三维几何体</strong><ul><li>立方体：BoxGeometry、CubeGeometry(旧版本)</li><li>球体：SphereGeometry</li><li>圆柱：CylinderGeometry</li><li>圆环：TorusGeometry</li><li>环面：TorusKnotGeometry</li><li>多面体：PolyhedronGeometry</li><li>正四面体：TetrahedronGeometry</li><li>正八面体：OctahedronGeometry</li><li>正二十面体：IcosahedronGeometry</li><li>复杂几何体<ul><li>凸面体：ConvexGeometry</li><li>扫描体：LatheGeometry</li><li>管状体：TubeGeometry</li><li>拉伸几何体：ExtrudeGeometry</li><li>参数几何体：ParameterGeometry</li><li>文本几何体：TextGeometry</li></ul></li></ul></li></ul></li><li><p><strong>自定义创建</strong></p><ul><li><strong>三维</strong><ul><li>几何体：Geometry</li><li>顶点：Vector3</li><li>顶面：Face3</li></ul></li><li><strong>二维</strong><ul><li>平面：Shape</li><li>线条<ul><li>直线：moveTo、lineTo</li><li>圆弧：arc、absarc</li><li>椭圆：ellipse、absellipse</li><li>贝塞尔曲线：quadraticCurveTo</li></ul></li><li>几何体<ul><li>makeGeometry</li><li>createPointsGeometry</li><li>createSpacedPointsGeometry</li></ul></li></ul></li></ul><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initShape</span>(<span class=\"params\"></span>)</span>{</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 模型对象和材质对象 </span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> geometry, material;   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// -------------- 构造函数创建 ---------------</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 矩形平面：PlanGeometry(长,宽, 长的分割, 宽的分割) </span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> planeGeometry = <span class=\"keyword\">new</span> THREE.PlaneGeometry(<span class=\"number\">100</span>, <span class=\"number\">50</span>)</span><br><span class=\"line\">    <span class=\"keyword\">let</span> planeMaterial = <span class=\"keyword\">new</span> THREE.MeshLambertMaterial({ <span class=\"attr\">color</span>: <span class=\"number\">0xffffff</span> })</span><br><span class=\"line\">    <span class=\"keyword\">let</span> plane = <span class=\"keyword\">new</span> THREE.Mesh(planeGeometry,planeMaterial)</span><br><span class=\"line\">    plane.receiveShadow = <span class=\"literal\">true</span>        <span class=\"comment\">// 接收阴影</span></span><br><span class=\"line\">    plane.rotation.x = <span class=\"number\">-0.5</span>*<span class=\"built_in\">Math</span>.PI   <span class=\"comment\">// x 轴旋转 -90 度</span></span><br><span class=\"line\">    plane.position.set(<span class=\"number\">15</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>)</span><br><span class=\"line\">    scene.add( plane )</span><br><span class=\"line\">    </span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 圆平面：CircleGeometry(半径, 切片数, 开始, 跨过角度)  </span></span><br><span class=\"line\">    <span class=\"comment\">// 切片数越大则越接近圆, 参数为3(最小值)是三角形, 参数为4则是矩形</span></span><br><span class=\"line\">    geometry = <span class=\"keyword\">new</span> THREE.CircleGeometry(<span class=\"number\">3</span>, <span class=\"number\">100</span>)</span><br><span class=\"line\">    material = <span class=\"keyword\">new</span> THREE.MeshLambertMaterial({ <span class=\"attr\">color</span>: <span class=\"number\">0xffffff</span> })</span><br><span class=\"line\">    <span class=\"keyword\">let</span> circle = <span class=\"keyword\">new</span> THREE.Mesh(geometry, material)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 圆环：TorusGeometry(半径, 管道半径, 纬度分割, 经度分割, 圆环面的弧度)</span></span><br><span class=\"line\">    <span class=\"comment\">// 最后一个参数 控制是否绘制完整一个圆环</span></span><br><span class=\"line\">    geometry = <span class=\"keyword\">new</span> THREE.TorusGeometry(<span class=\"number\">5</span>, <span class=\"number\">1</span>, <span class=\"number\">50</span>, <span class=\"number\">50</span>)  </span><br><span class=\"line\">    material = <span class=\"keyword\">new</span> THREE.MeshLambertMaterial({ <span class=\"attr\">color</span>: <span class=\"number\">0x7777ff</span> })</span><br><span class=\"line\">    <span class=\"keyword\">let</span> torus = <span class=\"keyword\">new</span> THREE.Mesh(geometry, material)</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 立方体：BoxGeometry(长, 宽, 高, 长的分割, 宽的分割, 高的分割)</span></span><br><span class=\"line\">    <span class=\"comment\">// 旧版本用CubeGeometry</span></span><br><span class=\"line\">    geometry = <span class=\"keyword\">new</span> THREE.BoxGeometry(<span class=\"number\">4</span>, <span class=\"number\">4</span>, <span class=\"number\">4</span>)</span><br><span class=\"line\">    material = <span class=\"keyword\">new</span> THREE.MeshLambertMaterial({ <span class=\"attr\">color</span>: <span class=\"number\">0xff0000</span> })</span><br><span class=\"line\">    <span class=\"keyword\">let</span> box = <span class=\"keyword\">new</span> THREE.Mesh(geometry, material)</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 球体：SphereGeometry(半径, 经度切片, 纬度切片, 经度开始, 经度跨过, 纬度开始, 纬度跨过)</span></span><br><span class=\"line\">    geometry = <span class=\"keyword\">new</span> THREE.SphereGeometry(<span class=\"number\">4</span>, <span class=\"number\">20</span>, <span class=\"number\">20</span>)</span><br><span class=\"line\">    material = <span class=\"keyword\">new</span> THREE.MeshLambertMaterial({ <span class=\"attr\">color</span>: <span class=\"number\">0x7777ff</span> } )</span><br><span class=\"line\">    <span class=\"keyword\">let</span> sphere = <span class=\"keyword\">new</span> THREE.Mesh(geometry, material)</span><br><span class=\"line\">    sphere.scale.set(<span class=\"number\">1.5</span>,<span class=\"number\">1.5</span>,<span class=\"number\">1.5</span>);  <span class=\"comment\">//缩放</span></span><br><span class=\"line\">    </span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"comment\">// 圆柱：CylinderGeometry(顶部面积, 底部面积, 高, 圆分割, 高分割, 是否没有顶面和底面) </span></span><br><span class=\"line\">    <span class=\"comment\">// 顶部或底部为0，则变成圆锥</span></span><br><span class=\"line\">    geometry = <span class=\"keyword\">new</span> THREE.CylinderGeometry(<span class=\"number\">2</span>, <span class=\"number\">2</span>, <span class=\"number\">5</span>)</span><br><span class=\"line\">    material = <span class=\"keyword\">new</span> THREE.MeshLambertMaterial({ <span class=\"attr\">color</span>: <span class=\"number\">0x7777ff</span> })</span><br><span class=\"line\">    <span class=\"keyword\">let</span> cylinder = <span class=\"keyword\">new</span> THREE.Mesh(geometry, material)</span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 正 20 面体 </span></span><br><span class=\"line\">    meometry = <span class=\"keyword\">new</span> THREE.IcosahedronGeometry(<span class=\"number\">4</span>, <span class=\"number\">0</span>);   </span><br><span class=\"line\">    material = <span class=\"keyword\">new</span> THREE.MeshLambertMaterial( {<span class=\"attr\">color</span>: <span class=\"number\">0x7777ff</span>} )</span><br><span class=\"line\">    <span class=\"keyword\">let</span> icosahedron = <span class=\"keyword\">new</span> THREE.Mesh(geometry, material)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// -------------- 自定义创建 ---------------</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 点模型</span></span><br><span class=\"line\">    geometry = <span class=\"keyword\">new</span> THREE.Geometry();    <span class=\"comment\">// 声明一个空几何体对象</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> p1 = <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">10</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);   <span class=\"comment\">// 顶点1坐标</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> p2 = <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">0</span>, <span class=\"number\">20</span>, <span class=\"number\">0</span>);   <span class=\"comment\">// 顶点2坐标</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> p3 = <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">15</span>, <span class=\"number\">15</span>, <span class=\"number\">0</span>);  <span class=\"comment\">// 顶点3坐标</span></span><br><span class=\"line\">    geometry.vertices.push(p1,p2,p3);       <span class=\"comment\">// 顶点坐标添加到geometry对象</span></span><br><span class=\"line\"></span><br><span class=\"line\">    material = <span class=\"keyword\">new</span> THREE.PointsMaterial({  <span class=\"comment\">// 点对象像素的颜色尺寸</span></span><br><span class=\"line\">        color: <span class=\"number\">0x0000ff</span>,</span><br><span class=\"line\">        size: <span class=\"number\">10.0</span>       </span><br><span class=\"line\">    }); </span><br><span class=\"line\">    <span class=\"keyword\">var</span> points = <span class=\"keyword\">new</span> THREE.Points(geometry, material);</span><br><span class=\"line\">    scene.add(points);        <span class=\"comment\">// 点模型添加到场景中</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 线条</span></span><br><span class=\"line\">    geometry = <span class=\"keyword\">new</span> THREE.Geometry();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> p1 = <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">10</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> p2 = <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">0</span>, <span class=\"number\">20</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    geometry.vertices.push(p1, p2);           <span class=\"comment\">// vertices 存放坐标</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">var</span> color1 = <span class=\"keyword\">new</span> THREE.Color(<span class=\"number\">0xFF0000</span>);  </span><br><span class=\"line\">    <span class=\"keyword\">var</span> color2 = <span class=\"keyword\">new</span> THREE.Color(<span class=\"number\">0x0000FF</span>);   </span><br><span class=\"line\">    geometry.colors.push(color1, color2);      <span class=\"comment\">// colors 存放顶点颜色</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    material = <span class=\"keyword\">new</span> THREE.LineBasicMaterial({</span><br><span class=\"line\">        <span class=\"comment\">// color: 0x0000ff,        // 线条颜色，用16进制表示，默认白色</span></span><br><span class=\"line\">        vertexColors: THREE.VertexColors,  <span class=\"comment\">// 线条材质是否使用顶点颜色</span></span><br><span class=\"line\">    });</span><br><span class=\"line\">    <span class=\"keyword\">var</span> line = <span class=\"keyword\">new</span> THREE.Line(geometry, material);</span><br><span class=\"line\">    scene.add(line);  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 三角面和矩形 </span></span><br><span class=\"line\">    geometry = <span class=\"keyword\">new</span> THREE.Geometry(); </span><br><span class=\"line\">    <span class=\"keyword\">var</span> p1 = <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>); </span><br><span class=\"line\">    <span class=\"keyword\">var</span> p2 = <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">80</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>); </span><br><span class=\"line\">    <span class=\"keyword\">var</span> p3 = <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">0</span>, <span class=\"number\">80</span>, <span class=\"number\">0</span>); </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建三角面及其法向量 (平面的法向量垂直于平面本身)</span></span><br><span class=\"line\">    geometry.vertices.push(p1, p2, p3); </span><br><span class=\"line\">    <span class=\"keyword\">var</span> normal = <span class=\"keyword\">new</span> THREE.Vector3( <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span> ); </span><br><span class=\"line\">    <span class=\"keyword\">var</span> face = <span class=\"keyword\">new</span> THREE.Face3( <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, normal); </span><br><span class=\"line\">    <span class=\"keyword\">var</span> color1 = <span class=\"keyword\">new</span> THREE.Color(<span class=\"number\">0xFF0000</span>);  <span class=\"comment\">// 红色</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> color2 = <span class=\"keyword\">new</span> THREE.Color(<span class=\"number\">0x00FF00</span>);  <span class=\"comment\">// 绿色</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> color3 = <span class=\"keyword\">new</span> THREE.Color(<span class=\"number\">0x0000FF</span>);  <span class=\"comment\">// 蓝色</span></span><br><span class=\"line\">    face.vertexColors.push(color1, color2, color3);  <span class=\"comment\">// 定义顶点颜色</span></span><br><span class=\"line\">    geometry.faces.push(face); </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建矩形平面</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> p4 = <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">0</span>, <span class=\"number\">80</span>, <span class=\"number\">0</span>); </span><br><span class=\"line\">    geometry.vertices.push(p1, p2, p3, p4); </span><br><span class=\"line\">    <span class=\"keyword\">var</span> normal = <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>); </span><br><span class=\"line\">    <span class=\"keyword\">var</span> face0 = <span class=\"keyword\">new</span> THREE.Face3(<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, normal); </span><br><span class=\"line\">    <span class=\"keyword\">var</span> face1 = <span class=\"keyword\">new</span> THREE.Face3(<span class=\"number\">0</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, normal); </span><br><span class=\"line\">    geometry.faces.push(face0, face1); </span><br><span class=\"line\"></span><br><span class=\"line\">    material = <span class=\"keyword\">new</span> THREE.MeshLambertMaterial({</span><br><span class=\"line\">        color: <span class=\"number\">0x0000ff</span>,         </span><br><span class=\"line\">        side: THREE.DoubleSide   <span class=\"comment\">// 两面可见</span></span><br><span class=\"line\">    });</span><br><span class=\"line\">    <span class=\"keyword\">var</span> mesh = <span class=\"keyword\">new</span> THREE.Mesh(geometry,material);</span><br><span class=\"line\">    scene.add(mesh);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 二维图形：ShapeGeometry(shapes, options)  </span></span><br><span class=\"line\">    <span class=\"comment\">// shapes 参数: THREE.Shape对象可单个传入, 多个时传数组</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> x = <span class=\"number\">0</span>, y = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> heartShape = <span class=\"keyword\">new</span> THREE.Shape()  <span class=\"comment\">// 心形</span></span><br><span class=\"line\"></span><br><span class=\"line\">    heartShape.moveTo( x + <span class=\"number\">5</span>, y + <span class=\"number\">5</span> )</span><br><span class=\"line\">    heartShape.bezierCurveTo( x + <span class=\"number\">5</span>, y + <span class=\"number\">5</span>, x + <span class=\"number\">4</span>, y, x, y )</span><br><span class=\"line\">    heartShape.bezierCurveTo( x - <span class=\"number\">6</span>, y, x - <span class=\"number\">6</span>, y + <span class=\"number\">7</span>,x - <span class=\"number\">6</span>, y + <span class=\"number\">7</span> )</span><br><span class=\"line\">    heartShape.bezierCurveTo( x - <span class=\"number\">6</span>, y + <span class=\"number\">11</span>, x - <span class=\"number\">3</span>, y + <span class=\"number\">15.4</span>, x + <span class=\"number\">5</span>, y + <span class=\"number\">19</span> )</span><br><span class=\"line\">    heartShape.bezierCurveTo( x + <span class=\"number\">12</span>, y + <span class=\"number\">15.4</span>, x + <span class=\"number\">16</span>, y + <span class=\"number\">11</span>, x + <span class=\"number\">16</span>, y + <span class=\"number\">7</span> )</span><br><span class=\"line\">    heartShape.bezierCurveTo( x + <span class=\"number\">16</span>, y + <span class=\"number\">7</span>, x + <span class=\"number\">16</span>, y, x + <span class=\"number\">10</span>, y )</span><br><span class=\"line\">    heartShape.bezierCurveTo( x + <span class=\"number\">7</span>, y, x + <span class=\"number\">5</span>, y + <span class=\"number\">5</span>, x + <span class=\"number\">5</span>, y + <span class=\"number\">5</span> )</span><br><span class=\"line\"></span><br><span class=\"line\">    geometry = <span class=\"keyword\">new</span> THREE.ShapeGeometry( heartShape )</span><br><span class=\"line\">    material = <span class=\"keyword\">new</span> THREE.MeshBasicMaterial( { <span class=\"attr\">color</span>: <span class=\"number\">0x00ff00</span> } )</span><br><span class=\"line\">    <span class=\"keyword\">var</span> mesh = <span class=\"keyword\">new</span> THREE.Mesh( geometry, material ) </span><br><span class=\"line\">    scene.add( mesh )</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 几何体 </span></span><br><span class=\"line\">    <span class=\"comment\">// 1.创建顶点</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> vertices = [</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">0</span>,<span class=\"number\">2</span>,<span class=\"number\">0</span>),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">-1</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">1</span>),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">1</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">-1</span>),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">0</span>,<span class=\"number\">-2</span>,<span class=\"number\">0</span>)</span><br><span class=\"line\">    ]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 2.创建面</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> faces = [</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Face3(<span class=\"number\">0</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Face3(<span class=\"number\">0</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Face3(<span class=\"number\">0</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Face3(<span class=\"number\">0</span>,<span class=\"number\">4</span>,<span class=\"number\">1</span>),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Face3(<span class=\"number\">5</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Face3(<span class=\"number\">5</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Face3(<span class=\"number\">5</span>,<span class=\"number\">4</span>,<span class=\"number\">3</span>),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Face3(<span class=\"number\">5</span>,<span class=\"number\">1</span>,<span class=\"number\">4</span>),</span><br><span class=\"line\">    ]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 3.创建几何体架构</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> geom = <span class=\"keyword\">new</span> THREE.Geometry()</span><br><span class=\"line\">    geom.vertices = vertices</span><br><span class=\"line\">    geom.faces = faces</span><br><span class=\"line\">    geom.computeFaceNormals()  <span class=\"comment\">//计算法向量, 这决定了对光做出的反应</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 4.添加材质</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> materials = [</span><br><span class=\"line\">        <span class=\"comment\">// 几何体面的材质 (Lambert材质适合光照)</span></span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.MeshLambertMaterial({ </span><br><span class=\"line\">            opacity: <span class=\"number\">0.8</span>, </span><br><span class=\"line\">            color:<span class=\"number\">0x44e144</span>, </span><br><span class=\"line\">            transparent: <span class=\"literal\">true</span> </span><br><span class=\"line\">        }),</span><br><span class=\"line\">        <span class=\"comment\">// 一个几何体框架的材质</span></span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.MeshBasicMaterial({</span><br><span class=\"line\">            color:<span class=\"number\">0x008800</span>,</span><br><span class=\"line\">            wireframe:<span class=\"literal\">true</span></span><br><span class=\"line\">        }),</span><br><span class=\"line\">    ]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 5.创建几何体(传入结构, 材质)</span></span><br><span class=\"line\">    mesh = THREE.SceneUtils.createMultiMaterialObject(geom, materials) </span><br><span class=\"line\">    mesh.name = <span class=\"string\">'源'</span></span><br><span class=\"line\">    mesh.children.forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>{</span><br><span class=\"line\">        e.castShadow = <span class=\"literal\">true</span>  <span class=\"comment\">//可以生成影子</span></span><br><span class=\"line\">    })</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 6.添加进场景中</span></span><br><span class=\"line\">    scene.add(mesh);</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure></li></ul><h3 id=\"材质\"><a href=\"#材质\" class=\"headerlink\" title=\"材质\"></a>材质</h3><blockquote><p>三维物体表面各个可视属性（颜色、纹理、光滑度、透明度、反射率、反光度等）的结合，决定了物体的外观效果。THREE.Material 是材质的基类，拥有所有材质的公有属性，它派生出的各种材质如下：</p></blockquote><ul><li><strong>MeshBasicMaterial</strong><ul><li>名称：基础材质</li><li>功能<ul><li>显示几何体的线框</li><li>给几何体赋予一种简单的颜色</li></ul></li><li>特点<ul><li>材质颜色如果没有指定则随机</li><li>物体颜色始终是材质颜色，不会因光照产生明暗、阴影效果</li></ul></li></ul></li><li><strong>MeshLambertMaterial</strong><ul><li>名称：朗伯材质</li><li>功能：创建 暗淡的、不光亮的 表面</li><li>特点<ul><li>可以通过 emissive 属性给材质添加亮色</li><li>在物体表面均匀地散射灯光，比如纸的表面粗糙但亮度均匀</li></ul></li></ul></li><li><strong>MeshPhongMaterial</strong><ul><li>名称：Phong 式材质</li><li>功能：创建金属类光亮的表面</li><li>特点<ul><li>反光强度更大</li><li>会给表面添加金属光泽</li><li>可通过 shininess 属性改变反光强度</li></ul></li></ul></li><li><strong>MeshStandardMaterial</strong><ul><li>名称：网格标准材质</li><li>功能：创建 暗淡的、有金属性光泽的 表面</li><li>特点<ul><li>MeshLambertMaterial、MeshPhoneMaterial 的结合</li><li>同时具有 粗糙度和金属性 的材质，并且可以改变这些属性</li></ul></li></ul></li><li><strong>MeshDepthMaterial</strong><ul><li>名称：深度材质</li><li>功能：根据内容所在的深度对网格对象的灰度级别从黑到白绘制</li></ul></li><li><strong>MeshNormalMaterial</strong><ul><li>名称：法向材质</li><li>功能：根据面的 法线或朝向 使用不同的颜色来渲染网格的面</li></ul></li><li><strong>MeshFaceMaterial</strong><ul><li>名称：面材质</li><li>功能：一个可以为几何体的各个表面指定不同颜色的容器</li></ul></li><li><strong>ShaderMaterial</strong><ul><li>名称：着色器材质</li><li>功能：允许使用自定义的着色器程序，比如顶点的放置方式、像素的着色方式</li></ul></li><li><strong>LineBasicMaterial</strong><ul><li>名称：直线基础材质</li><li>功能：用于在 THREE.Line 中创建着色的直线</li></ul></li><li><strong>LineDashMaterial</strong><ul><li>名称：虚线材质</li><li>功能：允许创建出一种虚线的效果</li></ul></li><li><strong>PointsMaterial</strong><ul><li>名称：粒子材质</li><li>功能：适用于粒子系统、模拟雪花小雨等</li></ul></li><li><strong>SpriteMaterial</strong><ul><li>名称：雪碧材质</li><li>功能：加载 图像纹理、canvas 创建的纹理等</li><li>特点：能够使用纹理贴图，并且应用于雪碧材质上</li></ul></li></ul><h2 id=\"光源\"><a href=\"#光源\" class=\"headerlink\" title=\"光源\"></a>光源</h2><blockquote><p>THREE.Light 是所有光源的基类，其构造函数接受 hex(一个16进制的颜色值)作为参数。但要让光源具有颜色之外的特性。我们需要使用由基类派生出来的其他种类光源，注意环境光、方向光的光强不受距离远近影响</p></blockquote><h3 id=\"类型\"><a href=\"#类型\" class=\"headerlink\" title=\"类型\"></a>类型</h3><ul><li><strong>AmbientLight</strong><ul><li>名称：环境光</li><li>功能：弱化阴影、添加颜色</li><li>光线：来自各个方向并均匀反射到物体表面</li><li>特点<ul><li>影响整个场景</li><li>没有特定来源</li><li>不会影响阴影的生成</li><li>不能作为场景中唯一的光源</li></ul></li></ul></li><li><strong>DirectionLight</strong><ul><li>名称：平行光、方向光</li><li>功能：常用于实现阴影效果</li><li>光线：一组没有衰减的平行光线，类似太阳光</li><li>特点：产生阴影、光强相同、效果只与方向有关</li></ul></li><li><strong>PointLight</strong><ul><li>名称：点光源</li><li>光线：单点发光但辐射四面八方</li><li>特点：类似蜡烛和灯泡、单点发光、不产生阴影</li></ul></li><li><strong>SpotLight</strong><ul><li>名称：聚光灯</li><li>功能：实现阴影效果，类似台灯、手电筒</li><li>光线：从一个锥体中射出并在物体上产生聚光的效果</li><li>特点<ul><li>距离越远则光强越弱</li><li>光强衰减指数越大则光强衰减越快</li></ul></li></ul></li></ul><h3 id=\"影响材质\"><a href=\"#影响材质\" class=\"headerlink\" title=\"影响材质\"></a>影响材质</h3><blockquote><p>只有在正常的光照条件下，我们才能容易分辨物体的材质</p></blockquote><ul><li>没有任何光源时，材质颜色最终是黑色 (离开光时材质无法体现)</li><li>Lambert 材质会受环境光的影响而呈现环境光的颜色，与材质本身颜色关系不大</li><li>只有环境光时，灯光位置不影响材质效果(阴影等)。只有其他光源时，能照射到的地方为 光源颜色，不能照射的地方则呈现暗色(黑色)</li><li>当混合光源存在时，单一光源能照射的地方呈现为 对应的光源颜色，多种光源都能照射到的地方是 颜色相加结果，都不能照射到的则呈现 暗色/环境光颜色<ul><li>光源：环境光为 绿色(0x00FF00)，平行光为 红色(0xFF0000)</li><li>效果：平行光照射到的地方呈现黄色(颜色值相加：0xFFFF00)，其它呈现绿色</li></ul></li></ul><h3 id=\"阴影效果\"><a href=\"#阴影效果\" class=\"headerlink\" title=\"阴影效果\"></a>阴影效果</h3><figure class=\"highlight js\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initShadow</span>(<span class=\"params\"></span>) </span>{ </span><br><span class=\"line\">    <span class=\"comment\">// 告诉render我要渲染阴影</span></span><br><span class=\"line\">    renderer.shadowMap.enabled = <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 让物体(立方体)投射阴影</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> geo = <span class=\"keyword\">new</span> THREE.BoxGeometry(<span class=\"number\">10</span>,<span class=\"number\">10</span>,<span class=\"number\">10</span>)</span><br><span class=\"line\">    <span class=\"keyword\">var</span> mat = <span class=\"keyword\">new</span> THREE.MeshPhoneMaterial({<span class=\"attr\">color</span>:<span class=\"number\">0xffffff</span>})</span><br><span class=\"line\">    <span class=\"keyword\">var</span> box = <span class=\"keyword\">new</span> THREE.Mesh(geo,mat)</span><br><span class=\"line\">    box.castShadow = <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 让其他物体(平面)接受阴影</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> geo_2 = <span class=\"keyword\">new</span> THREE.PlaneGeometry(<span class=\"number\">100</span>,<span class=\"number\">50</span>,<span class=\"number\">32</span>,<span class=\"number\">32</span>)</span><br><span class=\"line\">    <span class=\"keyword\">var</span> mat_2 = <span class=\"keyword\">new</span> THREE.MeshPhoneMaterial({<span class=\"attr\">color</span>:<span class=\"number\">0xeeeeee</span>, <span class=\"attr\">side</span>:THREE.DoubleSize})</span><br><span class=\"line\">    <span class=\"keyword\">var</span> plane = <span class=\"keyword\">new</span> THREE.Mesh(geo_2, mat_2)</span><br><span class=\"line\">    plane.receiveShadow = <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 告诉光源需要投射阴影</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> light = <span class=\"keyword\">new</span> THREE.DirectionalLight(<span class=\"number\">0xffffff</span>)</span><br><span class=\"line\">    light.castShadow = <span class=\"literal\">true</span> </span><br><span class=\"line\">    scene.add(light)    </span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure><h2 id=\"渲染器\"><a href=\"#渲染器\" class=\"headerlink\" title=\"渲染器\"></a>渲染器</h2><ul><li><strong>WebGLRender</strong>：使用 WebGL 渲染图形</li><li><strong>WebGLRenderTarget</strong>：渲染一个缓冲区</li><li><strong>WebGLRenderTargetCube</strong>：用于 CubeCamera</li><li><strong>CSS3DRenderer</strong>：基于 CSS3，简化版为 2D</li><li><strong>SVGRenderer</strong>：使用 SVG 渲染几何数据</li></ul><h2 id=\"控制器\"><a href=\"#控制器\" class=\"headerlink\" title=\"控制器\"></a>控制器</h2><ul><li><strong>FlyControls</strong>：飞行控制，用键盘和鼠标控制相机的移动和转动</li><li><strong>OrbitControls</strong>：轨道控制器，模拟轨道卫星旋转平移并用键盘、鼠标控制相机位置</li><li><strong>PointerLockControls</strong>：指针锁定，鼠标离开画布依然能被捕捉到鼠标交互而常用于游戏</li><li><strong>TrackballControls</strong>：轨迹球控制器，通过键盘和鼠标控制前后左右平移和缩放场景</li><li><strong>TransformControls</strong>：变换物体控制器，可以通过鼠标对物体的进行拖放等操作</li></ul><!-- rebuild by neat --></body></html>","site":{"data":{"next":{"override":false,"cache":{"enable":true},"favicon":{"small":"/images/favicon-16.ico","medium":"/images/favicon-32.ico","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"rss":"/atom.xml","footer":{"since":2019,"icon":{"name":"snowflake-o","animated":false,"color":"#808080"},"copyright":"chuangge","powered":{"enable":false,"version":true},"theme":{"enable":false,"version":true},"beian":{"enable":false,"icp":null}},"creative_commons":{"license":"by-nc-sa","sidebar":false,"post":false},"canonical":true,"seo":false,"index_with_subtitle":false,"exturl":false,"menu":{"home":"/ || home  //首页","tags":"/tags/ || tags  //标签","categories":"/categories/ || th   //分类","archives":"/archives/ || archive //归档"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":{"GitHub":"https://github.com/ || github","StackOverflow":"https://stackoverflow.com/ || stack-overflow"},"social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"友情链接","links_layout":"inline","links":{"个人简历":"https://chuanggefighting.github.io/project/","印记中文":"https://www.docschina.org/","在线工具":"http://tool.lu/","Learn Anything":"https://learn-anything.xyz/"},"avatar":{"url":"/images/chuang.png","rounded":true,"opacity":1,"rotated":true},"toc":{"enable":true,"number":true,"wrap":false,"max_depth":6},"sidebar":{"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"read_more_btn":true,"post_meta":{"item_text":true,"created_at":true,"updated_at":{"enabled":true,"another_day":true},"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":true,"awl":4,"wpm":275},"codeblock":{"border_radius":null,"copy_button":{"enable":false,"show_result":false}},"reward":{"enable":false},"related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_edit":{"enable":false,"url":"https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name"},"disable_baidu_tranformation":false,"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"font":{"enable":true,"host":"//fonts.proxy.ustclug.org","global":{"external":true,"family":"Lato","size":16},"headings":{"external":true,"family":"Roboto Slab","size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":"Lobster Two","size":24},"codes":{"external":true,"family":"Roboto Mono","size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css","copy_tex":{"enable":false,"copy_tex_js":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js","copy_tex_css":"//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css"}}},"pdf":{"enable":false,"per_page":true,"height":"500px","pdfobject":{"cdn":"//cdn.jsdelivr.net/npm/pdfobject@2.1.1/pdfobject.min.js"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":true,"appid":"snOvapuSplYTVflf5p9Ml9JX-gzGzoHsz","appkey":"5ABGdfyEdAtu6lTXdGdo7hf9","notify":false,"verify":false,"placeholder":"ヾﾉ≧∀≦)o 来呀！吐槽一番吧！","avatar":"mm","guest_info":"nick,mail,link","pageSize":10,"visitor":false,"comment_count":true},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"gitalk":{"enable":false,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true},"needmoreshare2":{"enable":true,"postbottom":{"enable":true,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null,"security":false,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":true,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":true,"pace_theme":"pace-theme-center-simple","canvas_nest":{"enable":true,"onmobile":true,"color":"0,0,255","opacity":0.5,"zIndex":-1,"count":99},"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"canvas_nest_nomobile":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"leancloud":null,"valine":null,"gitalk_js":null,"gitalk_css":null,"md5":null},"css":"css","js":"js","images":"images","passage_end_tag":{"enabled":true},"daovoice":true,"daovoice_app_id":"2ed51855"}}},"excerpt":"","more":"<!-- build time:Sat May 11 2019 01:36:59 GMT+0800 (中国标准时间) --><h1 id=\"一、WebGL-基础\"><a href=\"#一、WebGL-基础\" class=\"headerlink\" title=\"一、WebGL 基础\"></a>一、WebGL 基础</h1><h2 id=\"OpenGL、WebGL\"><a href=\"#OpenGL、WebGL\" class=\"headerlink\" title=\"OpenGL、WebGL\"></a>OpenGL、WebGL</h2><ul><li><strong>OpenGL</strong>：最常用的跨平台图形库，用于渲染 2D、3D 矢量图形的跨语言、跨平台的应用程序编程接口</li><li><strong>OpenGL ES</strong>：OpenGL API 的子集 GPU，是针对手机、PDA 和游戏主机等嵌入式设备而专门设计的接口</li><li><strong>GLSL</strong>：OpenGL ES 着色语言，用于OpenGL中着色编程的语言。在图形卡的GPU上执行，代替了固定的渲染管线的一部分，使渲染管线中不同层次具有可编程性，如视图转换、投影转换等。</li><li><strong>WebGL</strong>：基于 OpenGL 设计的面向 web 的图形标准，它提供的一系列 Js API 对显卡的硬件细节进行了封装抽象，可用于控制 GPU渲染管线(显卡硬件) 进行图形渲染，从而获得了较高性能。</li><li><strong>WebGL程序</strong>：主要组成是 js控制代码 和 计算机的图形处理单元GPU。而 GPU 核心即着色程序 program 由顶点和片元两个着色器组成，使用 GLSL 编写并通过常以字符串的形式存放在Js中等待调用 (浏览器不识别 GLSL)。</li></ul><h2 id=\"CPU、GPU\"><a href=\"#CPU、GPU\" class=\"headerlink\" title=\"CPU、GPU\"></a>CPU、GPU</h2><blockquote><p>图像处理主要偏简单的矩阵运算，逻辑判断等很少。两者的设计架构不同。GPU很适合做简单的并发计算，应用于图像处理、深度学习等领域加快速度，引爆了人工智能</p></blockquote><ul><li><strong>CPU</strong><ul><li>可看作”万能教授”，但运算效率较低</li><li>中央处理器，计算机的运算和控制核心</li><li>需要很强的通用性来处理各种不同的数据类型和逻辑判断</li></ul></li><li><strong>GPU</strong><ul><li>可看作”专业学生”，用来实现硬件加速计算，执行重复运算效率高</li><li>图像处理器，是显卡的处理器和核心，也是图像运算工作的微处理器</li><li>专为执行复杂的数学和几何计算而设计，用于将 CPU 从图形处理的任务中解放出来而去执行其他更多的系统任务，提高计算机的整体性能</li></ul></li></ul><h2 id=\"图形渲染\"><a href=\"#图形渲染\" class=\"headerlink\" title=\"图形渲染\"></a>图形渲染</h2><div style=\"text-indent:2em\">渲染是从使用计算机程序模型生成图像的过程。在图形中一个虚拟场景的呈现需要使用 几何、视点、纹理、光照和阴影等通过一个渲染程序传递信息描述，输出一个数字图像。渲染可以在本地或远程上进行。复杂图像所需的硬件资源可以在专用服务器上完成，即基于服务器的绘制。渲染也可以通过在本地CPU完成, 即基于客户端的渲染。所以渲染类型如下：</div><ul><li>软件渲染：所有的渲染是在 CPU 的帮助下计算完成。</li><li>硬件渲染：所有的图形计算都由 GPU (图形处理单元)完成的。</li></ul><h2 id=\"图形术语\"><a href=\"#图形术语\" class=\"headerlink\" title=\"图形术语\"></a>图形术语</h2><ul><li><strong>坐标系</strong>：x、y、z 轴<ul><li>无论画布多大，WebGL 上的坐标被限制为 (1, 1, 1)、(-1, -1, -1)</li><li>WebGL 在 GPU 上的主要工作就是将顶点数据通过矩阵变换转换到裁剪空间坐标，然后基于空间坐标绘制像素点</li></ul></li><li><strong>缓冲</strong>：即将发送到GPU 的一些二进制数据序列<ul><li>缓冲区对象用于存储要绘制模型的各种数据，比如顶点、颜色等</li><li>缓冲区对象驻留在 GPU 存储器却可以被直接呈现，提高了性能</li></ul></li><li><strong>图元</strong>：几何顶点的组合，比如点、线段和三角面</li><li><strong>片元和像素</strong><ul><li>在光栅化中纹理映射之后图元信息转化为了像素</li><li>片元包括 像素点 和 颜色、深度和纹理数据等信息</li></ul></li><li><strong>网格</strong>：使用顶点所绘的 2D、3D 模型，它的每个面被称为 一个片元 (一般是三角形)</li><li><strong>着色器</strong><ul><li>现代 GPU 中的顶点处理和片段处理等可编程部分被称为着色器</li><li>主要包括顶点着色器和片元着色器，可理解为运行在显卡中的指令和数据</li><li>着色器程序使用的是 GLSL ES 语言，所以在 Js 中需要存放在字符串中等待调用编译，通过编译处理后传递给 顶点/片元 着色器执行</li></ul></li><li><strong>纹理图像</strong><ul><li>将一张真实图片贴到一个几何图像表面称为 纹理映射，映射的图像为纹理图像</li><li>组成纹理图像的像素称为纹素，而纹理坐标 是纹理图像上的坐标，通过纹理坐标可以在纹理图像上获取纹素颜色</li></ul></li><li><strong>绘图</strong><ul><li>WebGL 中的顶点、颜色、纹理等几何详细信息存储在缓冲区对象，然后被传递到GPU上的着色器程序来创建图形对象</li><li>WebGL 只能绘制 点、线和三角形，其他都是由它们合成后绘制到三维空间</li></ul></li></ul><h1 id=\"二、WebGL-程序\"><a href=\"#二、WebGL-程序\" class=\"headerlink\" title=\"二、WebGL 程序\"></a>二、WebGL 程序</h1><blockquote><p>程序代码是 Js、OpenGL 的组合，两者分别负责与 CPU、GPU 通信</p></blockquote><h2 id=\"显卡内部结构\"><a href=\"#显卡内部结构\" class=\"headerlink\" title=\"显卡内部结构\"></a>显卡内部结构</h2><blockquote><p>电脑一般都具有独立显卡</p></blockquote><ul><li>GPU：渲染管线<ul><li>功能：和 GPU 传递数据</li><li>内容：可编程的着色器、不可编程的光栅器等</li></ul></li><li>显存：GPU 读写数据的存储区<ul><li>顶点缓存：存储顶点的位置、颜色等数据</li><li>渲染缓存：接收渲染管线生成数据</li><li>纹理缓存：用于实现纹理贴图</li><li>帧缓存<ul><li>分类: 屏幕缓存、离屏缓存</li><li>组成: 颜色缓存、深度缓存、模板缓存</li></ul></li></ul></li></ul><h2 id=\"图像绘制流程\"><a href=\"#图像绘制流程\" class=\"headerlink\" title=\"图像绘制流程\"></a>图像绘制流程</h2><blockquote><p>上线网站的 WebGL 相关文件会放在远程的服务器硬盘存储器。网页 http 请求后，CPU 将顶点坐标等数据 和 WebGL 程序代码 传递给 GPU 存储</p></blockquote><ol><li>浏览器解析硬盘的 WebGL 文件，CPU 分配内存并将数据传递给 GPU 存储数据和程序代码</li><li>CPU 执行程序初始化并调用 GPU 存储的程序代码，初始化着色器时把处理好的 着色器程序 和 矩阵等数据 发送给 GPU 处理器</li><li>GPU 通过矩阵变换和光栅化等操作将图像信息转化为像素并写入显卡的帧缓存 (包括颜色、透明度等)</li><li>显示器扫描读取显存中的像素数据，然后显示到浏览器 canvas</li></ol><h2 id=\"GPU-处理流程\"><a href=\"#GPU-处理流程\" class=\"headerlink\" title=\"GPU 处理流程\"></a>GPU 处理流程</h2><blockquote><p>获取顶点坐标、图元装配(即画出一个个三角形)、光栅化(生成片元, 即一个个像素点)、存储在缓存区</p></blockquote><ol><li>数据准备<ul><li>uv：贴图坐标</li><li>索引：三角形绘制顺序</li><li>矩阵数据：uniform 变量传递给顶点着色器</li><li>顶点坐标：attribute 变量传递给顶点着色器，一般由三维软件导出几何体的各个顶点</li></ul></li><li>生成顶点着色器<ul><li>顶点着色器：Js 定义的程序代码，初始化后会传递给 GPU</li></ul></li><li>图元装配<ul><li>实现：顶点坐标 转换为图元 (一般是三角形)</li><li>本质：GPU 逐顶点数量执行顶点着色器程序，通过矩阵变换将孤立的顶点坐标处理为 2D 图形并输出</li></ul></li><li>生成片元着色器<ul><li>实现：处理模型的颜色、质地、光照效果、阴影</li></ul></li><li>光栅化<ul><li>实现：将图元转换为像素点</li><li>片元：一个像素点及其包含的颜色、深度和纹理数据</li><li>本质：GPU 逐片元数量执行片元着色器程序，为每个片元进行着色</li></ul></li><li>存储到缓存区<ul><li>片元只要通过了检测和融合 (融合单元主要实现透明度效果)，就可以存储到颜色缓存区，最终完成整个渲染</li></ul></li></ol><h1 id=\"三、WebGL-绘图\"><a href=\"#三、WebGL-绘图\" class=\"headerlink\" title=\"三、WebGL 绘图\"></a>三、WebGL 绘图</h1><h2 id=\"初始化绘图上下文\"><a href=\"#初始化绘图上下文\" class=\"headerlink\" title=\"初始化绘图上下文\"></a>初始化绘图上下文</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"canvas\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> gl = canvas.getContext(<span class=\"string\">\"webgl\"</span>, &#123;</span><br><span class=\"line\">    <span class=\"comment\">//可选选项</span></span><br><span class=\"line\">    antialias: <span class=\"literal\">false</span>, </span><br><span class=\"line\">    stencil: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h2 id=\"初始化着色器程序\"><a href=\"#初始化着色器程序\" class=\"headerlink\" title=\"初始化着色器程序\"></a>初始化着色器程序</h2><ul><li>创建：顶点着色器程序、片段着色器程序</li><li>编译：通过 js 将这两个着色器 link 到一个 program (着色程序) 并提交到 GPU</li></ul><h2 id=\"建立模型和数据缓存\"><a href=\"#建立模型和数据缓存\" class=\"headerlink\" title=\"建立模型和数据缓存\"></a>建立模型和数据缓存</h2><ul><li>创建缓冲区对象并绑定到目标，然后写入数据并连接所分配的变量，运行程序时使用缓冲区对象向顶点传入多个顶点数据</li><li>创建纹理并加载纹理图像，配置属性并在 webgl 中使用</li></ul><h2 id=\"图像绘制和动画\"><a href=\"#图像绘制和动画\" class=\"headerlink\" title=\"图像绘制和动画\"></a>图像绘制和动画</h2><h3 id=\"简单图形\"><a href=\"#简单图形\" class=\"headerlink\" title=\"简单图形\"></a>简单图形</h3><ul><li>API：<code>gl.drawArrays(mode, first, count)</code><ul><li>mode：画图函数(点、线、三角形)</li><li>first：指定顶点开始绘制的位置</li><li>count：所绘制图形的顶点个数</li></ul></li><li>实例<ul><li>三个点：<code>gl.drawArrays(gl.POINTS, 0, 3)</code></li><li>三角形：<code>gl.drawsArrays(gl.TRIANGLES, 0, 3)</code></li></ul></li></ul><h3 id=\"复杂的三维图形\"><a href=\"#复杂的三维图形\" class=\"headerlink\" title=\"复杂的三维图形\"></a>复杂的三维图形</h3><ul><li>API：<code>gl.drawElements(mode, count, type, offset)</code><ul><li>type：指定缓冲区中值的类型，常用 gl.UNSIGNED_BYTE/UNSIGNED_SHORT 表示无符号8/16位整数值</li><li>offset：指定索引数组中开始绘制的位置，以字节为单位</li></ul></li><li>实例<ul><li>三角形：<code>gl.drawElement(gl.TRIANGLES, n, gl.UNSIGNED_SHORT, 0)</code></li></ul></li></ul><h2 id=\"方法封装\"><a href=\"#方法封装\" class=\"headerlink\" title=\"方法封装\"></a>方法封装</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">webGLStart</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 初始化WEBGL上下文信息</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"myCanvas\"</span>);</span><br><span class=\"line\">    initGL(canvas);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 初始化着色器</span></span><br><span class=\"line\">    initShader();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 初始化缓冲区</span></span><br><span class=\"line\">    initBuffers();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 初始化纹理图片</span></span><br><span class=\"line\">    initTexture();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 指定清空画布的颜色，</span></span><br><span class=\"line\">    gl.clearColor(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 清除颜色缓冲区 (使用定义的颜色来填充相应区域)</span></span><br><span class=\"line\">    gl.clear(gl.COLOR_BUFFER_BIT);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 开启隐藏面消除的功能  启用深度测试</span></span><br><span class=\"line\">    gl.enable(gl.DEPTH_TEST);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 开始绘制场景</span></span><br><span class=\"line\">    drawScene();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h1 id=\"四、Three-js-基础\"><a href=\"#四、Three-js-基础\" class=\"headerlink\" title=\"四、Three.js 基础\"></a>四、Three.js 基础</h1><blockquote><p>使用 js 代码写 3D 程序</p></blockquote><h2 id=\"对比-WebGL\"><a href=\"#对比-WebGL\" class=\"headerlink\" title=\"对比 WebGL\"></a>对比 WebGL</h2><ul><li>WebGL<ul><li>原生 API 是一种非常低级的接口，需要一些数学和图形学的相关技术，学习和开发项目的成本较高</li><li>可看作是浏览器提供的接口，js 中可以直接用 WebGL API 绘制3D图形</li></ul></li><li>Three.js<ul><li>通过对 WebGL API 的封装与简化而形成的一个易用的图形库，上手容易</li><li>可看作是一款 webGL框架。它将复杂接口简单化，将 webGL 基于光栅化的 2D API 封装成了简单的 3D API，同时基于面向对象思维而将数据结构对象化</li></ul></li></ul><h2 id=\"简化工作\"><a href=\"#简化工作\" class=\"headerlink\" title=\"简化工作\"></a>简化工作</h2><ul><li>辅助导出模型数据</li><li>自动生成各种矩阵</li><li>生成了顶点着色器</li><li>辅助生成材质、配置灯光</li><li>根据设置的材质生成片元着色器</li></ul><h2 id=\"执行流程\"><a href=\"#执行流程\" class=\"headerlink\" title=\"执行流程\"></a>执行流程</h2><ol><li>创建场景、灯光、相机等</li><li>创建模型、材质(内置/自定义)</li><li>生成顶点着色器、片元着色器</li><li>渲染页面</li></ol><h1 id=\"五、Three-js-绘图\"><a href=\"#五、Three-js-绘图\" class=\"headerlink\" title=\"五、Three.js 绘图\"></a>五、Three.js 绘图</h1><h2 id=\"模型渲染\"><a href=\"#模型渲染\" class=\"headerlink\" title=\"模型渲染\"></a>模型渲染</h2><ul><li>原理：将创建好的物体添加到场景中，然后通过相机渲染到渲染器，从而呈现到网页</li><li>方式<ul><li>实时渲染：不停地渲染画面</li><li>离线渲染：事先渲染出一帧帧图片，使用时拼接</li></ul></li></ul><h2 id=\"实现步骤\"><a href=\"#实现步骤\" class=\"headerlink\" title=\"实现步骤\"></a>实现步骤</h2><ol><li>构建一个三维空间 (创建场景)</li><li>选择一个观察点，并确定观察方向/角度等 (创建相机)</li><li>在场景中添加供观察的物体 (创建物体并添加至场景中)</li><li><p>将观察到的场景渲染到屏幕上 (创建渲染器并渲染场景)</p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 绘制网格线</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initGrid</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 场景</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> scene = <span class=\"keyword\">new</span> THREE.Scene();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 相机</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> camera = <span class=\"keyword\">new</span> THREE.OrthographicCamera(<span class=\"number\">-5</span>, <span class=\"number\">5</span>, <span class=\"number\">3.75</span>, <span class=\"number\">-3.75</span>, <span class=\"number\">0.1</span>, <span class=\"number\">100</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 设定相机位置</span></span><br><span class=\"line\">    camera.position.set(<span class=\"number\">0</span>, <span class=\"number\">-25</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 相机看向</span></span><br><span class=\"line\">    camera.lookAt(<span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>));</span><br><span class=\"line\">    scene.add(camera);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 渲染器</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> renderer = <span class=\"keyword\">new</span> THREE.WebGLRenderer(&#123; <span class=\"attr\">antialias</span>: <span class=\"literal\">true</span> &#125;);</span><br><span class=\"line\">    <span class=\"comment\">// 设定渲染器尺寸</span></span><br><span class=\"line\">    renderer.setSize(<span class=\"number\">800</span>, <span class=\"number\">600</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 添加到dom</span></span><br><span class=\"line\">    renderer.autoClear = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 重绘时颜色</span></span><br><span class=\"line\">    renderer.setClearColor(<span class=\"number\">0x000000</span>);</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.appendChild(renderer.domElement);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 定义一个几何体</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> geometry = <span class=\"keyword\">new</span> THREE.Geometry();</span><br><span class=\"line\">    geometry.vertices.push(<span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">-2</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>));</span><br><span class=\"line\">    geometry.vertices.push(<span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">2</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>));</span><br><span class=\"line\">    <span class=\"comment\">// for循环出来六条线段</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &amp;lt;= <span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 定义竖着的线段</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> line = <span class=\"keyword\">new</span> THREE.Line(geometry, <span class=\"keyword\">new</span> THREE.LineBasicMaterial(&#123;</span><br><span class=\"line\">            color: <span class=\"number\">0xffffff</span>,</span><br><span class=\"line\">        &#125;));</span><br><span class=\"line\">        <span class=\"comment\">// 每条线段之间的间隔为0.8，-2是为了达到田字格的效果</span></span><br><span class=\"line\">        line.position.z = (i * <span class=\"number\">0.8</span>) - <span class=\"number\">2</span>;</span><br><span class=\"line\">        scene.add(line);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 定义横着的线段</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> line = <span class=\"keyword\">new</span> THREE.Line(geometry, <span class=\"keyword\">new</span> THREE.LineBasicMaterial(&#123;</span><br><span class=\"line\">            color: <span class=\"number\">0xffffff</span>,</span><br><span class=\"line\">            opacity: <span class=\"number\">0.2</span></span><br><span class=\"line\">        &#125;));</span><br><span class=\"line\">        line.position.x = (i * <span class=\"number\">0.8</span>) - <span class=\"number\">2</span>;</span><br><span class=\"line\">        line.rotation.y = <span class=\"number\">90</span> * <span class=\"built_in\">Math</span>.PI / <span class=\"number\">180</span>;</span><br><span class=\"line\">        scene.add(line);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 渲染</span></span><br><span class=\"line\">        renderer.render(scene, camera);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id=\"场景动画\"><a href=\"#场景动画\" class=\"headerlink\" title=\"场景动画\"></a>场景动画</h2><blockquote><p>在循环渲染(即重绘，循环绘制新场景) 的过程中不断改变 物体或相机的属性，让场景动起来 的颜色、位置等</p></blockquote><ul><li>属性<ul><li>物体：<code>scale、rotation、position、material</code></li><li>相机：<code>位置、方向、面向坐标</code></li></ul></li><li><p>实现方式</p><ul><li><strong>直接实现</strong><ul><li>物体移动而摄像机不动：<code>mesh.position.x -= 1</code></li><li>摄像机移动而物体不动：<code>camera.position.x = camera.position.x + 1</code></li></ul></li><li><strong>Tween.js</strong><ul><li>引入后可以定义某个属性值的过渡而实现复杂动画</li><li>它会自动计算出起止的所有中间值，这个过程叫做 tweening 补间</li></ul></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 旋转的正方体</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> scene, camera, renderer, mesh, stats;</span><br><span class=\"line\">initThree();</span><br><span class=\"line\">animation();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initThree</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 创建场景对象 (插入光照/物体)</span></span><br><span class=\"line\">    scene = <span class=\"keyword\">new</span> THREE.Scene();  </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建相机对象</span></span><br><span class=\"line\">    camera = <span class=\"keyword\">new</span> THREE.PerspectiveCamera( <span class=\"number\">70</span>, <span class=\"built_in\">window</span>.innerWidth / <span class=\"built_in\">window</span>.innerHeight, <span class=\"number\">1</span>, <span class=\"number\">1000</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 光照设置</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> light = <span class=\"keyword\">new</span> THREE.DirectionalLight( <span class=\"number\">0xffffff</span> );</span><br><span class=\"line\">    light.position.set( <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span> ).normalize();  <span class=\"comment\">// 光源位置</span></span><br><span class=\"line\">    scene.add(light);    <span class=\"comment\">// 将光照插入场景</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建网络模型</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> geometry = <span class=\"keyword\">new</span> THREE.BoxGeometry( <span class=\"number\">10</span>, <span class=\"number\">10</span>, <span class=\"number\">10</span>);  <span class=\"comment\">// 创建一个立方体几何对象</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> material = <span class=\"keyword\">new</span> THREE.MeshPhongMaterial(&#123;        <span class=\"comment\">// 材质对象</span></span><br><span class=\"line\">            color: <span class=\"number\">0x0033ff</span>, </span><br><span class=\"line\">            specular: <span class=\"number\">0x555555</span>, </span><br><span class=\"line\">            shininess: <span class=\"number\">30</span> </span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    mesh = <span class=\"keyword\">new</span> THREE.Mesh(geometry, material );   <span class=\"comment\">// 网格模型对象</span></span><br><span class=\"line\">    mesh.position.z = <span class=\"number\">-50</span>;</span><br><span class=\"line\">    scene.add(mesh);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建渲染器对象</span></span><br><span class=\"line\">    renderer = <span class=\"keyword\">new</span> THREE.WebGLRenderer(&#123; <span class=\"attr\">antialias</span>: <span class=\"literal\">true</span> &#125;)   <span class=\"comment\">// 参数是可选配置</span></span><br><span class=\"line\">    renderer.setSize(<span class=\"built_in\">window</span>.innerWidth, <span class=\"built_in\">window</span>.innerHeight)   <span class=\"comment\">// canvas元素设置宽高 (默认300/150)</span></span><br><span class=\"line\">    renderer.clear()                                <span class=\"comment\">// 清除面板</span></span><br><span class=\"line\">    renderer.setClearColor(<span class=\"number\">0xb9d3ff</span>, <span class=\"number\">1</span>)             <span class=\"comment\">// 设置画布颜色</span></span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.appendChild(renderer.domElement)  <span class=\"comment\">// 将Canvas元素添加到&lt;body&gt;中。</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">window</span>.addEventListener( <span class=\"string\">'resize'</span>, onWindowResize, <span class=\"literal\">false</span> );</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">onWindowResize</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        camera.aspect = <span class=\"built_in\">window</span>.innerWidth / <span class=\"built_in\">window</span>.innerHeight;</span><br><span class=\"line\">        camera.updateProjectionMatrix();</span><br><span class=\"line\">        renderer.setSize( <span class=\"built_in\">window</span>.innerWidth, <span class=\"built_in\">window</span>.innerHeight );</span><br><span class=\"line\">        render();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"comment\">// 执行渲染</span></span><br><span class=\"line\">    render();         </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">render</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    renderer.render(scene, camera)    </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 简单动画：在循环渲染过程中不断改变 物体/相机的属性，从而让场景动起来</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">animation</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    mesh.rotation.x += <span class=\"number\">.04</span>;</span><br><span class=\"line\">    mesh.rotation.y += <span class=\"number\">.02</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    render();</span><br><span class=\"line\">    requestAnimationFrame(animation);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// mesh.material = new THREE.MeshLambertMaterial(&#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     color: 0xff0000</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;);</span></span><br><span class=\"line\">    <span class=\"comment\">// mesh.position.z = 1;</span></span><br><span class=\"line\">    <span class=\"comment\">// mesh.position.set(1.5, -0.5, 0);</span></span><br><span class=\"line\">    <span class=\"comment\">// mesh.position = new THREE.Vector3(1.5, -0.5, 0);</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 更新性能插件     </span></span><br><span class=\"line\">    <span class=\"comment\">// stats.update();  </span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 让物体运动</span></span><br><span class=\"line\">    <span class=\"comment\">// TWEEN.update();   </span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 复杂动画：Tween 的任何一个函数返回的都是自身，支持链式编程</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initTween</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">new</span> TWEEN.Tween(mesh.position)    <span class=\"comment\">// 要改变属性的对象</span></span><br><span class=\"line\">            .to( &#123; <span class=\"attr\">x</span>: <span class=\"number\">-400</span> &#125;, <span class=\"number\">3000</span> )  <span class=\"comment\">// 目标值和需要时间</span></span><br><span class=\"line\">            .repeat( <span class=\"literal\">Infinity</span> )       <span class=\"comment\">// 重复无穷次</span></span><br><span class=\"line\">            .start();                 <span class=\"comment\">// 开始动画</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id=\"性能检测\"><a href=\"#性能检测\" class=\"headerlink\" title=\"性能检测\"></a>性能检测</h2><blockquote><p>引用插件 stats.js 之后可以在场景中的左上角看到视图小框，点击切换可看到以下信息</p></blockquote><ul><li><strong>38 MS (19-74)</strong>：MS 表示渲染一帧需要的毫秒数，其值越小越好</li><li><p><strong>34 FPS (30-34)</strong>：FPS 表示每秒渲染的帧数，其值越大越好，括号内表示帧率范围</p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动画性能检测： http://www.wjceo.com/lib/js/libs/stats.min.js</span></span><br><span class=\"line\">stats = <span class=\"keyword\">new</span> Stats();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 参数为 0 时显示 FPS 界面，参数为 1 时显示 MS 界面</span></span><br><span class=\"line\">stats.setMode(<span class=\"number\">1</span>);  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// stats 的界面对应左上角</span></span><br><span class=\"line\">stats.domElement.style.position = <span class=\"string\">'absolute'</span>;</span><br><span class=\"line\">stats.domElement.left = <span class=\"string\">'0px'</span>;</span><br><span class=\"line\">stats.domElement.top = <span class=\"string\">'0px'</span>;</span><br><span class=\"line\"><span class=\"built_in\">document</span>.body.appendChild(stats.dom);</span><br></pre></td></tr></table></figure></li></ul><h1 id=\"六、Three-js-要素\"><a href=\"#六、Three-js-要素\" class=\"headerlink\" title=\"六、Three.js 要素\"></a>六、Three.js 要素</h1><blockquote><p>绘图页面中必备且唯一的要素：camera、scene、renderer</p></blockquote><ul><li><strong>Scene</strong>：场景（三维空间），是物体、光源等元素的容器</li><li><strong>Camera</strong>：相机（观察者），控制视角位置、范围和焦点位置</li><li><strong>Object3D</strong>：物体（三维模型），包括二维的点线面、三维的粒子等</li><li><strong>Light</strong>：光源，包括全局光、平行光、点光源等</li><li><strong>Renderer</strong>：渲染器（画布），用于渲染场景及其物体</li><li><strong>Control</strong>：控制器（相机控件），可通过键盘、鼠标控制相机</li></ul><h2 id=\"相机\"><a href=\"#相机\" class=\"headerlink\" title=\"相机\"></a>相机</h2><h3 id=\"分类\"><a href=\"#分类\" class=\"headerlink\" title=\"分类\"></a>分类</h3><ul><li><strong>正投影相机</strong><ul><li>特点：表现物体的实际尺寸而远近相同</li><li>参数：视角、窗口的长宽比、近远裁面的距离</li><li>OrthographicCamera(left, right, top, bottom, near, far)</li></ul></li><li><strong>透视投影相机</strong><ul><li>特点：类似人眼而近大远小</li><li>参数：各平面距离相机中心的垂直距离</li><li>PerspectiveCamera(fov, aspect, near, far)</li></ul></li><li><strong>3D 相机</strong><ul><li>特点：合成两个相机的拍摄结果，用于 3D 立体影像或视差屏障等效果</li><li>StereoCamera()</li></ul></li><li><strong>全景相机</strong><ul><li>特点：可以 360 度拍摄</li><li>参数：最后一个设置立方体边缘的长度</li><li>CubeCamera(near, far, cubeResolution)</li></ul></li></ul><h3 id=\"属性\"><a href=\"#属性\" class=\"headerlink\" title=\"属性\"></a>属性</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 相机设置</span></span><br><span class=\"line\">camera.position.set(<span class=\"number\">0</span>, <span class=\"number\">-1</span>, <span class=\"number\">5</span>);    <span class=\"comment\">// 设定相机位置 </span></span><br><span class=\"line\">camera.up.x = <span class=\"number\">0</span>;                 <span class=\"comment\">// 相机以哪个方向为上方</span></span><br><span class=\"line\">camera.lookAt(scene.position);   <span class=\"comment\">// 相机面向哪个坐标(默认面向z轴负方向)</span></span><br><span class=\"line\">camera.lookAt(<span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">10</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>));  <span class=\"comment\">// 相机往x轴移动10单位</span></span><br></pre></td></tr></table></figure><h2 id=\"物体\"><a href=\"#物体\" class=\"headerlink\" title=\"物体\"></a>物体</h2><blockquote><p>Object3D 是它们的基类。创建时需要 几何体和材质，几何体定义模型的形状 (骨架)，材质定义几何图形的表面效果 (皮肤，包括颜色、纹理、透明度、质感等)</p></blockquote><ul><li><strong>Line</strong>：线段模型，由线条组成</li><li><strong>Mesh</strong>：网格模型，由三角面和四边形面组成</li><li><strong>Points</strong>：粒子系统，使用一堆点的集合来描述</li><li><strong>Sprite</strong>：精灵图，指包含于场景中的二维图像或动画<ul><li>特点：一个永远面向相机的平面</li><li>功能：加载 纹理但是不接受阴影</li></ul></li></ul><h3 id=\"几何体\"><a href=\"#几何体\" class=\"headerlink\" title=\"几何体\"></a>几何体</h3><ul><li><strong>构造函数创建</strong>：Geometry 是它们的基类<ul><li><strong>二维平面</strong><ul><li>圆平面：CircleGeometry</li><li>矩形平面：PlaneGeometry</li></ul></li><li><strong>三维几何体</strong><ul><li>立方体：BoxGeometry、CubeGeometry(旧版本)</li><li>球体：SphereGeometry</li><li>圆柱：CylinderGeometry</li><li>圆环：TorusGeometry</li><li>环面：TorusKnotGeometry</li><li>多面体：PolyhedronGeometry</li><li>正四面体：TetrahedronGeometry</li><li>正八面体：OctahedronGeometry</li><li>正二十面体：IcosahedronGeometry</li><li>复杂几何体<ul><li>凸面体：ConvexGeometry</li><li>扫描体：LatheGeometry</li><li>管状体：TubeGeometry</li><li>拉伸几何体：ExtrudeGeometry</li><li>参数几何体：ParameterGeometry</li><li>文本几何体：TextGeometry</li></ul></li></ul></li></ul></li><li><p><strong>自定义创建</strong></p><ul><li><strong>三维</strong><ul><li>几何体：Geometry</li><li>顶点：Vector3</li><li>顶面：Face3</li></ul></li><li><strong>二维</strong><ul><li>平面：Shape</li><li>线条<ul><li>直线：moveTo、lineTo</li><li>圆弧：arc、absarc</li><li>椭圆：ellipse、absellipse</li><li>贝塞尔曲线：quadraticCurveTo</li></ul></li><li>几何体<ul><li>makeGeometry</li><li>createPointsGeometry</li><li>createSpacedPointsGeometry</li></ul></li></ul></li></ul><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initShape</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 模型对象和材质对象 </span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> geometry, material;   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// -------------- 构造函数创建 ---------------</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 矩形平面：PlanGeometry(长,宽, 长的分割, 宽的分割) </span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> planeGeometry = <span class=\"keyword\">new</span> THREE.PlaneGeometry(<span class=\"number\">100</span>, <span class=\"number\">50</span>)</span><br><span class=\"line\">    <span class=\"keyword\">let</span> planeMaterial = <span class=\"keyword\">new</span> THREE.MeshLambertMaterial(&#123; <span class=\"attr\">color</span>: <span class=\"number\">0xffffff</span> &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">let</span> plane = <span class=\"keyword\">new</span> THREE.Mesh(planeGeometry,planeMaterial)</span><br><span class=\"line\">    plane.receiveShadow = <span class=\"literal\">true</span>        <span class=\"comment\">// 接收阴影</span></span><br><span class=\"line\">    plane.rotation.x = <span class=\"number\">-0.5</span>*<span class=\"built_in\">Math</span>.PI   <span class=\"comment\">// x 轴旋转 -90 度</span></span><br><span class=\"line\">    plane.position.set(<span class=\"number\">15</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>)</span><br><span class=\"line\">    scene.add( plane )</span><br><span class=\"line\">    </span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 圆平面：CircleGeometry(半径, 切片数, 开始, 跨过角度)  </span></span><br><span class=\"line\">    <span class=\"comment\">// 切片数越大则越接近圆, 参数为3(最小值)是三角形, 参数为4则是矩形</span></span><br><span class=\"line\">    geometry = <span class=\"keyword\">new</span> THREE.CircleGeometry(<span class=\"number\">3</span>, <span class=\"number\">100</span>)</span><br><span class=\"line\">    material = <span class=\"keyword\">new</span> THREE.MeshLambertMaterial(&#123; <span class=\"attr\">color</span>: <span class=\"number\">0xffffff</span> &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">let</span> circle = <span class=\"keyword\">new</span> THREE.Mesh(geometry, material)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 圆环：TorusGeometry(半径, 管道半径, 纬度分割, 经度分割, 圆环面的弧度)</span></span><br><span class=\"line\">    <span class=\"comment\">// 最后一个参数 控制是否绘制完整一个圆环</span></span><br><span class=\"line\">    geometry = <span class=\"keyword\">new</span> THREE.TorusGeometry(<span class=\"number\">5</span>, <span class=\"number\">1</span>, <span class=\"number\">50</span>, <span class=\"number\">50</span>)  </span><br><span class=\"line\">    material = <span class=\"keyword\">new</span> THREE.MeshLambertMaterial(&#123; <span class=\"attr\">color</span>: <span class=\"number\">0x7777ff</span> &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">let</span> torus = <span class=\"keyword\">new</span> THREE.Mesh(geometry, material)</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 立方体：BoxGeometry(长, 宽, 高, 长的分割, 宽的分割, 高的分割)</span></span><br><span class=\"line\">    <span class=\"comment\">// 旧版本用CubeGeometry</span></span><br><span class=\"line\">    geometry = <span class=\"keyword\">new</span> THREE.BoxGeometry(<span class=\"number\">4</span>, <span class=\"number\">4</span>, <span class=\"number\">4</span>)</span><br><span class=\"line\">    material = <span class=\"keyword\">new</span> THREE.MeshLambertMaterial(&#123; <span class=\"attr\">color</span>: <span class=\"number\">0xff0000</span> &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">let</span> box = <span class=\"keyword\">new</span> THREE.Mesh(geometry, material)</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 球体：SphereGeometry(半径, 经度切片, 纬度切片, 经度开始, 经度跨过, 纬度开始, 纬度跨过)</span></span><br><span class=\"line\">    geometry = <span class=\"keyword\">new</span> THREE.SphereGeometry(<span class=\"number\">4</span>, <span class=\"number\">20</span>, <span class=\"number\">20</span>)</span><br><span class=\"line\">    material = <span class=\"keyword\">new</span> THREE.MeshLambertMaterial(&#123; <span class=\"attr\">color</span>: <span class=\"number\">0x7777ff</span> &#125; )</span><br><span class=\"line\">    <span class=\"keyword\">let</span> sphere = <span class=\"keyword\">new</span> THREE.Mesh(geometry, material)</span><br><span class=\"line\">    sphere.scale.set(<span class=\"number\">1.5</span>,<span class=\"number\">1.5</span>,<span class=\"number\">1.5</span>);  <span class=\"comment\">//缩放</span></span><br><span class=\"line\">    </span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"comment\">// 圆柱：CylinderGeometry(顶部面积, 底部面积, 高, 圆分割, 高分割, 是否没有顶面和底面) </span></span><br><span class=\"line\">    <span class=\"comment\">// 顶部或底部为0，则变成圆锥</span></span><br><span class=\"line\">    geometry = <span class=\"keyword\">new</span> THREE.CylinderGeometry(<span class=\"number\">2</span>, <span class=\"number\">2</span>, <span class=\"number\">5</span>)</span><br><span class=\"line\">    material = <span class=\"keyword\">new</span> THREE.MeshLambertMaterial(&#123; <span class=\"attr\">color</span>: <span class=\"number\">0x7777ff</span> &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">let</span> cylinder = <span class=\"keyword\">new</span> THREE.Mesh(geometry, material)</span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 正 20 面体 </span></span><br><span class=\"line\">    meometry = <span class=\"keyword\">new</span> THREE.IcosahedronGeometry(<span class=\"number\">4</span>, <span class=\"number\">0</span>);   </span><br><span class=\"line\">    material = <span class=\"keyword\">new</span> THREE.MeshLambertMaterial( &#123;<span class=\"attr\">color</span>: <span class=\"number\">0x7777ff</span>&#125; )</span><br><span class=\"line\">    <span class=\"keyword\">let</span> icosahedron = <span class=\"keyword\">new</span> THREE.Mesh(geometry, material)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// -------------- 自定义创建 ---------------</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 点模型</span></span><br><span class=\"line\">    geometry = <span class=\"keyword\">new</span> THREE.Geometry();    <span class=\"comment\">// 声明一个空几何体对象</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> p1 = <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">10</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);   <span class=\"comment\">// 顶点1坐标</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> p2 = <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">0</span>, <span class=\"number\">20</span>, <span class=\"number\">0</span>);   <span class=\"comment\">// 顶点2坐标</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> p3 = <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">15</span>, <span class=\"number\">15</span>, <span class=\"number\">0</span>);  <span class=\"comment\">// 顶点3坐标</span></span><br><span class=\"line\">    geometry.vertices.push(p1,p2,p3);       <span class=\"comment\">// 顶点坐标添加到geometry对象</span></span><br><span class=\"line\"></span><br><span class=\"line\">    material = <span class=\"keyword\">new</span> THREE.PointsMaterial(&#123;  <span class=\"comment\">// 点对象像素的颜色尺寸</span></span><br><span class=\"line\">        color: <span class=\"number\">0x0000ff</span>,</span><br><span class=\"line\">        size: <span class=\"number\">10.0</span>       </span><br><span class=\"line\">    &#125;); </span><br><span class=\"line\">    <span class=\"keyword\">var</span> points = <span class=\"keyword\">new</span> THREE.Points(geometry, material);</span><br><span class=\"line\">    scene.add(points);        <span class=\"comment\">// 点模型添加到场景中</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 线条</span></span><br><span class=\"line\">    geometry = <span class=\"keyword\">new</span> THREE.Geometry();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> p1 = <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">10</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> p2 = <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">0</span>, <span class=\"number\">20</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    geometry.vertices.push(p1, p2);           <span class=\"comment\">// vertices 存放坐标</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">var</span> color1 = <span class=\"keyword\">new</span> THREE.Color(<span class=\"number\">0xFF0000</span>);  </span><br><span class=\"line\">    <span class=\"keyword\">var</span> color2 = <span class=\"keyword\">new</span> THREE.Color(<span class=\"number\">0x0000FF</span>);   </span><br><span class=\"line\">    geometry.colors.push(color1, color2);      <span class=\"comment\">// colors 存放顶点颜色</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    material = <span class=\"keyword\">new</span> THREE.LineBasicMaterial(&#123;</span><br><span class=\"line\">        <span class=\"comment\">// color: 0x0000ff,        // 线条颜色，用16进制表示，默认白色</span></span><br><span class=\"line\">        vertexColors: THREE.VertexColors,  <span class=\"comment\">// 线条材质是否使用顶点颜色</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> line = <span class=\"keyword\">new</span> THREE.Line(geometry, material);</span><br><span class=\"line\">    scene.add(line);  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 三角面和矩形 </span></span><br><span class=\"line\">    geometry = <span class=\"keyword\">new</span> THREE.Geometry(); </span><br><span class=\"line\">    <span class=\"keyword\">var</span> p1 = <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>); </span><br><span class=\"line\">    <span class=\"keyword\">var</span> p2 = <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">80</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>); </span><br><span class=\"line\">    <span class=\"keyword\">var</span> p3 = <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">0</span>, <span class=\"number\">80</span>, <span class=\"number\">0</span>); </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建三角面及其法向量 (平面的法向量垂直于平面本身)</span></span><br><span class=\"line\">    geometry.vertices.push(p1, p2, p3); </span><br><span class=\"line\">    <span class=\"keyword\">var</span> normal = <span class=\"keyword\">new</span> THREE.Vector3( <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span> ); </span><br><span class=\"line\">    <span class=\"keyword\">var</span> face = <span class=\"keyword\">new</span> THREE.Face3( <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, normal); </span><br><span class=\"line\">    <span class=\"keyword\">var</span> color1 = <span class=\"keyword\">new</span> THREE.Color(<span class=\"number\">0xFF0000</span>);  <span class=\"comment\">// 红色</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> color2 = <span class=\"keyword\">new</span> THREE.Color(<span class=\"number\">0x00FF00</span>);  <span class=\"comment\">// 绿色</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> color3 = <span class=\"keyword\">new</span> THREE.Color(<span class=\"number\">0x0000FF</span>);  <span class=\"comment\">// 蓝色</span></span><br><span class=\"line\">    face.vertexColors.push(color1, color2, color3);  <span class=\"comment\">// 定义顶点颜色</span></span><br><span class=\"line\">    geometry.faces.push(face); </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建矩形平面</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> p4 = <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">0</span>, <span class=\"number\">80</span>, <span class=\"number\">0</span>); </span><br><span class=\"line\">    geometry.vertices.push(p1, p2, p3, p4); </span><br><span class=\"line\">    <span class=\"keyword\">var</span> normal = <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>); </span><br><span class=\"line\">    <span class=\"keyword\">var</span> face0 = <span class=\"keyword\">new</span> THREE.Face3(<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, normal); </span><br><span class=\"line\">    <span class=\"keyword\">var</span> face1 = <span class=\"keyword\">new</span> THREE.Face3(<span class=\"number\">0</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, normal); </span><br><span class=\"line\">    geometry.faces.push(face0, face1); </span><br><span class=\"line\"></span><br><span class=\"line\">    material = <span class=\"keyword\">new</span> THREE.MeshLambertMaterial(&#123;</span><br><span class=\"line\">        color: <span class=\"number\">0x0000ff</span>,         </span><br><span class=\"line\">        side: THREE.DoubleSide   <span class=\"comment\">// 两面可见</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> mesh = <span class=\"keyword\">new</span> THREE.Mesh(geometry,material);</span><br><span class=\"line\">    scene.add(mesh);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 二维图形：ShapeGeometry(shapes, options)  </span></span><br><span class=\"line\">    <span class=\"comment\">// shapes 参数: THREE.Shape对象可单个传入, 多个时传数组</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> x = <span class=\"number\">0</span>, y = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> heartShape = <span class=\"keyword\">new</span> THREE.Shape()  <span class=\"comment\">// 心形</span></span><br><span class=\"line\"></span><br><span class=\"line\">    heartShape.moveTo( x + <span class=\"number\">5</span>, y + <span class=\"number\">5</span> )</span><br><span class=\"line\">    heartShape.bezierCurveTo( x + <span class=\"number\">5</span>, y + <span class=\"number\">5</span>, x + <span class=\"number\">4</span>, y, x, y )</span><br><span class=\"line\">    heartShape.bezierCurveTo( x - <span class=\"number\">6</span>, y, x - <span class=\"number\">6</span>, y + <span class=\"number\">7</span>,x - <span class=\"number\">6</span>, y + <span class=\"number\">7</span> )</span><br><span class=\"line\">    heartShape.bezierCurveTo( x - <span class=\"number\">6</span>, y + <span class=\"number\">11</span>, x - <span class=\"number\">3</span>, y + <span class=\"number\">15.4</span>, x + <span class=\"number\">5</span>, y + <span class=\"number\">19</span> )</span><br><span class=\"line\">    heartShape.bezierCurveTo( x + <span class=\"number\">12</span>, y + <span class=\"number\">15.4</span>, x + <span class=\"number\">16</span>, y + <span class=\"number\">11</span>, x + <span class=\"number\">16</span>, y + <span class=\"number\">7</span> )</span><br><span class=\"line\">    heartShape.bezierCurveTo( x + <span class=\"number\">16</span>, y + <span class=\"number\">7</span>, x + <span class=\"number\">16</span>, y, x + <span class=\"number\">10</span>, y )</span><br><span class=\"line\">    heartShape.bezierCurveTo( x + <span class=\"number\">7</span>, y, x + <span class=\"number\">5</span>, y + <span class=\"number\">5</span>, x + <span class=\"number\">5</span>, y + <span class=\"number\">5</span> )</span><br><span class=\"line\"></span><br><span class=\"line\">    geometry = <span class=\"keyword\">new</span> THREE.ShapeGeometry( heartShape )</span><br><span class=\"line\">    material = <span class=\"keyword\">new</span> THREE.MeshBasicMaterial( &#123; <span class=\"attr\">color</span>: <span class=\"number\">0x00ff00</span> &#125; )</span><br><span class=\"line\">    <span class=\"keyword\">var</span> mesh = <span class=\"keyword\">new</span> THREE.Mesh( geometry, material ) </span><br><span class=\"line\">    scene.add( mesh )</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 几何体 </span></span><br><span class=\"line\">    <span class=\"comment\">// 1.创建顶点</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> vertices = [</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">0</span>,<span class=\"number\">2</span>,<span class=\"number\">0</span>),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">-1</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">1</span>),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">1</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">-1</span>),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Vector3(<span class=\"number\">0</span>,<span class=\"number\">-2</span>,<span class=\"number\">0</span>)</span><br><span class=\"line\">    ]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 2.创建面</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> faces = [</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Face3(<span class=\"number\">0</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Face3(<span class=\"number\">0</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Face3(<span class=\"number\">0</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Face3(<span class=\"number\">0</span>,<span class=\"number\">4</span>,<span class=\"number\">1</span>),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Face3(<span class=\"number\">5</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Face3(<span class=\"number\">5</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Face3(<span class=\"number\">5</span>,<span class=\"number\">4</span>,<span class=\"number\">3</span>),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.Face3(<span class=\"number\">5</span>,<span class=\"number\">1</span>,<span class=\"number\">4</span>),</span><br><span class=\"line\">    ]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 3.创建几何体架构</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> geom = <span class=\"keyword\">new</span> THREE.Geometry()</span><br><span class=\"line\">    geom.vertices = vertices</span><br><span class=\"line\">    geom.faces = faces</span><br><span class=\"line\">    geom.computeFaceNormals()  <span class=\"comment\">//计算法向量, 这决定了对光做出的反应</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 4.添加材质</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> materials = [</span><br><span class=\"line\">        <span class=\"comment\">// 几何体面的材质 (Lambert材质适合光照)</span></span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.MeshLambertMaterial(&#123; </span><br><span class=\"line\">            opacity: <span class=\"number\">0.8</span>, </span><br><span class=\"line\">            color:<span class=\"number\">0x44e144</span>, </span><br><span class=\"line\">            transparent: <span class=\"literal\">true</span> </span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">        <span class=\"comment\">// 一个几何体框架的材质</span></span><br><span class=\"line\">        <span class=\"keyword\">new</span> THREE.MeshBasicMaterial(&#123;</span><br><span class=\"line\">            color:<span class=\"number\">0x008800</span>,</span><br><span class=\"line\">            wireframe:<span class=\"literal\">true</span></span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">    ]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 5.创建几何体(传入结构, 材质)</span></span><br><span class=\"line\">    mesh = THREE.SceneUtils.createMultiMaterialObject(geom, materials) </span><br><span class=\"line\">    mesh.name = <span class=\"string\">'源'</span></span><br><span class=\"line\">    mesh.children.forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">        e.castShadow = <span class=\"literal\">true</span>  <span class=\"comment\">//可以生成影子</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 6.添加进场景中</span></span><br><span class=\"line\">    scene.add(mesh);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id=\"材质\"><a href=\"#材质\" class=\"headerlink\" title=\"材质\"></a>材质</h3><blockquote><p>三维物体表面各个可视属性（颜色、纹理、光滑度、透明度、反射率、反光度等）的结合，决定了物体的外观效果。THREE.Material 是材质的基类，拥有所有材质的公有属性，它派生出的各种材质如下：</p></blockquote><ul><li><strong>MeshBasicMaterial</strong><ul><li>名称：基础材质</li><li>功能<ul><li>显示几何体的线框</li><li>给几何体赋予一种简单的颜色</li></ul></li><li>特点<ul><li>材质颜色如果没有指定则随机</li><li>物体颜色始终是材质颜色，不会因光照产生明暗、阴影效果</li></ul></li></ul></li><li><strong>MeshLambertMaterial</strong><ul><li>名称：朗伯材质</li><li>功能：创建 暗淡的、不光亮的 表面</li><li>特点<ul><li>可以通过 emissive 属性给材质添加亮色</li><li>在物体表面均匀地散射灯光，比如纸的表面粗糙但亮度均匀</li></ul></li></ul></li><li><strong>MeshPhongMaterial</strong><ul><li>名称：Phong 式材质</li><li>功能：创建金属类光亮的表面</li><li>特点<ul><li>反光强度更大</li><li>会给表面添加金属光泽</li><li>可通过 shininess 属性改变反光强度</li></ul></li></ul></li><li><strong>MeshStandardMaterial</strong><ul><li>名称：网格标准材质</li><li>功能：创建 暗淡的、有金属性光泽的 表面</li><li>特点<ul><li>MeshLambertMaterial、MeshPhoneMaterial 的结合</li><li>同时具有 粗糙度和金属性 的材质，并且可以改变这些属性</li></ul></li></ul></li><li><strong>MeshDepthMaterial</strong><ul><li>名称：深度材质</li><li>功能：根据内容所在的深度对网格对象的灰度级别从黑到白绘制</li></ul></li><li><strong>MeshNormalMaterial</strong><ul><li>名称：法向材质</li><li>功能：根据面的 法线或朝向 使用不同的颜色来渲染网格的面</li></ul></li><li><strong>MeshFaceMaterial</strong><ul><li>名称：面材质</li><li>功能：一个可以为几何体的各个表面指定不同颜色的容器</li></ul></li><li><strong>ShaderMaterial</strong><ul><li>名称：着色器材质</li><li>功能：允许使用自定义的着色器程序，比如顶点的放置方式、像素的着色方式</li></ul></li><li><strong>LineBasicMaterial</strong><ul><li>名称：直线基础材质</li><li>功能：用于在 THREE.Line 中创建着色的直线</li></ul></li><li><strong>LineDashMaterial</strong><ul><li>名称：虚线材质</li><li>功能：允许创建出一种虚线的效果</li></ul></li><li><strong>PointsMaterial</strong><ul><li>名称：粒子材质</li><li>功能：适用于粒子系统、模拟雪花小雨等</li></ul></li><li><strong>SpriteMaterial</strong><ul><li>名称：雪碧材质</li><li>功能：加载 图像纹理、canvas 创建的纹理等</li><li>特点：能够使用纹理贴图，并且应用于雪碧材质上</li></ul></li></ul><h2 id=\"光源\"><a href=\"#光源\" class=\"headerlink\" title=\"光源\"></a>光源</h2><blockquote><p>THREE.Light 是所有光源的基类，其构造函数接受 hex(一个16进制的颜色值)作为参数。但要让光源具有颜色之外的特性。我们需要使用由基类派生出来的其他种类光源，注意环境光、方向光的光强不受距离远近影响</p></blockquote><h3 id=\"类型\"><a href=\"#类型\" class=\"headerlink\" title=\"类型\"></a>类型</h3><ul><li><strong>AmbientLight</strong><ul><li>名称：环境光</li><li>功能：弱化阴影、添加颜色</li><li>光线：来自各个方向并均匀反射到物体表面</li><li>特点<ul><li>影响整个场景</li><li>没有特定来源</li><li>不会影响阴影的生成</li><li>不能作为场景中唯一的光源</li></ul></li></ul></li><li><strong>DirectionLight</strong><ul><li>名称：平行光、方向光</li><li>功能：常用于实现阴影效果</li><li>光线：一组没有衰减的平行光线，类似太阳光</li><li>特点：产生阴影、光强相同、效果只与方向有关</li></ul></li><li><strong>PointLight</strong><ul><li>名称：点光源</li><li>光线：单点发光但辐射四面八方</li><li>特点：类似蜡烛和灯泡、单点发光、不产生阴影</li></ul></li><li><strong>SpotLight</strong><ul><li>名称：聚光灯</li><li>功能：实现阴影效果，类似台灯、手电筒</li><li>光线：从一个锥体中射出并在物体上产生聚光的效果</li><li>特点<ul><li>距离越远则光强越弱</li><li>光强衰减指数越大则光强衰减越快</li></ul></li></ul></li></ul><h3 id=\"影响材质\"><a href=\"#影响材质\" class=\"headerlink\" title=\"影响材质\"></a>影响材质</h3><blockquote><p>只有在正常的光照条件下，我们才能容易分辨物体的材质</p></blockquote><ul><li>没有任何光源时，材质颜色最终是黑色 (离开光时材质无法体现)</li><li>Lambert 材质会受环境光的影响而呈现环境光的颜色，与材质本身颜色关系不大</li><li>只有环境光时，灯光位置不影响材质效果(阴影等)。只有其他光源时，能照射到的地方为 光源颜色，不能照射的地方则呈现暗色(黑色)</li><li>当混合光源存在时，单一光源能照射的地方呈现为 对应的光源颜色，多种光源都能照射到的地方是 颜色相加结果，都不能照射到的则呈现 暗色/环境光颜色<ul><li>光源：环境光为 绿色(0x00FF00)，平行光为 红色(0xFF0000)</li><li>效果：平行光照射到的地方呈现黄色(颜色值相加：0xFFFF00)，其它呈现绿色</li></ul></li></ul><h3 id=\"阴影效果\"><a href=\"#阴影效果\" class=\"headerlink\" title=\"阴影效果\"></a>阴影效果</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initShadow</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"comment\">// 告诉render我要渲染阴影</span></span><br><span class=\"line\">    renderer.shadowMap.enabled = <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 让物体(立方体)投射阴影</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> geo = <span class=\"keyword\">new</span> THREE.BoxGeometry(<span class=\"number\">10</span>,<span class=\"number\">10</span>,<span class=\"number\">10</span>)</span><br><span class=\"line\">    <span class=\"keyword\">var</span> mat = <span class=\"keyword\">new</span> THREE.MeshPhoneMaterial(&#123;<span class=\"attr\">color</span>:<span class=\"number\">0xffffff</span>&#125;)</span><br><span class=\"line\">    <span class=\"keyword\">var</span> box = <span class=\"keyword\">new</span> THREE.Mesh(geo,mat)</span><br><span class=\"line\">    box.castShadow = <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 让其他物体(平面)接受阴影</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> geo_2 = <span class=\"keyword\">new</span> THREE.PlaneGeometry(<span class=\"number\">100</span>,<span class=\"number\">50</span>,<span class=\"number\">32</span>,<span class=\"number\">32</span>)</span><br><span class=\"line\">    <span class=\"keyword\">var</span> mat_2 = <span class=\"keyword\">new</span> THREE.MeshPhoneMaterial(&#123;<span class=\"attr\">color</span>:<span class=\"number\">0xeeeeee</span>, <span class=\"attr\">side</span>:THREE.DoubleSize&#125;)</span><br><span class=\"line\">    <span class=\"keyword\">var</span> plane = <span class=\"keyword\">new</span> THREE.Mesh(geo_2, mat_2)</span><br><span class=\"line\">    plane.receiveShadow = <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 告诉光源需要投射阴影</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> light = <span class=\"keyword\">new</span> THREE.DirectionalLight(<span class=\"number\">0xffffff</span>)</span><br><span class=\"line\">    light.castShadow = <span class=\"literal\">true</span> </span><br><span class=\"line\">    scene.add(light)    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"渲染器\"><a href=\"#渲染器\" class=\"headerlink\" title=\"渲染器\"></a>渲染器</h2><ul><li><strong>WebGLRender</strong>：使用 WebGL 渲染图形</li><li><strong>WebGLRenderTarget</strong>：渲染一个缓冲区</li><li><strong>WebGLRenderTargetCube</strong>：用于 CubeCamera</li><li><strong>CSS3DRenderer</strong>：基于 CSS3，简化版为 2D</li><li><strong>SVGRenderer</strong>：使用 SVG 渲染几何数据</li></ul><h2 id=\"控制器\"><a href=\"#控制器\" class=\"headerlink\" title=\"控制器\"></a>控制器</h2><ul><li><strong>FlyControls</strong>：飞行控制，用键盘和鼠标控制相机的移动和转动</li><li><strong>OrbitControls</strong>：轨道控制器，模拟轨道卫星旋转平移并用键盘、鼠标控制相机位置</li><li><strong>PointerLockControls</strong>：指针锁定，鼠标离开画布依然能被捕捉到鼠标交互而常用于游戏</li><li><strong>TrackballControls</strong>：轨迹球控制器，通过键盘和鼠标控制前后左右平移和缩放场景</li><li><strong>TransformControls</strong>：变换物体控制器，可以通过鼠标对物体的进行拖放等操作</li></ul><!-- rebuild by neat -->"}],"PostAsset":[],"PostCategory":[{"post_id":"cjvid4ph600000nbxix1ltdyj","category_id":"cjvid4phk00040nbxu1tf9o3i","_id":"cjvid4pho000a0nbxqct3ga7g"},{"post_id":"cjvid4phf00020nbxhhdu42be","category_id":"cjvid4phn00070nbx7xc5jssx","_id":"cjvid4php000c0nbx63tjsj8e"},{"post_id":"cjvid4piz000d0nbxiy2mofpc","category_id":"cjvid4pj1000f0nbxaobt3xu1","_id":"cjvid4pj7000n0nbxzog3cdjq"},{"post_id":"cjvid4pj0000e0nbxob5j8l7x","category_id":"cjvid4pj5000k0nbx6u2hc1on","_id":"cjvid4pj8000r0nbxd106nj2h"},{"post_id":"cjvid4pj1000h0nbxlyxrw6om","category_id":"cjvid4pj7000o0nbxfnd1owha","_id":"cjvid4pj9000u0nbxvok896k4"},{"post_id":"cjvid4pj2000i0nbxo49h6o9k","category_id":"cjvid4pj8000s0nbxst4hhy2y","_id":"cjvid4pj9000z0nbxf5no99o4"},{"post_id":"cjvid4pj3000j0nbxlbl4lwev","category_id":"cjvid4pj9000v0nbx6gr0ctt3","_id":"cjvid4pja00120nbxa8fme658"},{"post_id":"cjvid4plk00160nbxxqdyqm8o","category_id":"cjvid4phn00070nbx7xc5jssx","_id":"cjvid4plt001c0nbxfquh0j0i"},{"post_id":"cjvid4plm00170nbxbb0ksrn7","category_id":"cjvid4phk00040nbxu1tf9o3i","_id":"cjvid4plu001f0nbxuzqp4lf5"},{"post_id":"cjvid4plq00190nbxd2zxlbt6","category_id":"cjvid4phk00040nbxu1tf9o3i","_id":"cjvid4plv001j0nbx69z9x0y1"},{"post_id":"cjvid4plt001e0nbxrxzukbbp","category_id":"cjvid4pj8000s0nbxst4hhy2y","_id":"cjvid4ply001n0nbx43vdtw3c"},{"post_id":"cjvid4plv001i0nbxd895we27","category_id":"cjvid4phn00070nbx7xc5jssx","_id":"cjvid4ply001p0nbx814cs96u"},{"post_id":"cjvid4pls001b0nbxi29gzcq5","category_id":"cjvid4plu001h0nbxey95bn2t","_id":"cjvid4plz001r0nbxbr4digq8"},{"post_id":"cjvid4pmk001u0nbxxyoubhpz","category_id":"cjvid4phn00070nbx7xc5jssx","_id":"cjvid4pmr00200nbxe3bo4339"},{"post_id":"cjvid4pmm001v0nbxymkjrfoc","category_id":"cjvid4phn00070nbx7xc5jssx","_id":"cjvid4pmt00230nbx0afqouo8"},{"post_id":"cjvid4pmn001x0nbxedxpa8j3","category_id":"cjvid4phk00040nbxu1tf9o3i","_id":"cjvid4pmx00260nbx6b2xmzqn"},{"post_id":"cjvid4pmq001z0nbxv4yerkzj","category_id":"cjvid4pj7000o0nbxfnd1owha","_id":"cjvid4pmz00290nbxh8i5ru6z"},{"post_id":"cjvid4pms00220nbxfllmen1l","category_id":"cjvid4plu001h0nbxey95bn2t","_id":"cjvid4pn1002c0nbxe2p53nvq"},{"post_id":"cjvid4pmu00250nbx23s140bq","category_id":"cjvid4pj7000o0nbxfnd1owha","_id":"cjvid4pn2002f0nbxgvxpbe81"},{"post_id":"cjvid4pmy00280nbxc19tbwtc","category_id":"cjvid4phn00070nbx7xc5jssx","_id":"cjvid4pn2002h0nbxchkfrjv2"},{"post_id":"cjvid4pn0002b0nbxabsfspwh","category_id":"cjvid4phn00070nbx7xc5jssx","_id":"cjvid4pn3002j0nbx3o37tzny"},{"post_id":"cjvid4pq3002o0nbxgln5ah0c","category_id":"cjvid4pj5000k0nbx6u2hc1on","_id":"cjvid4pq7002q0nbxz37w9k4m"}],"PostTag":[{"post_id":"cjvid4ph600000nbxix1ltdyj","tag_id":"cjvid4phm00050nbxvbf33a1b","_id":"cjvid4pho00090nbxaaabcpb2"},{"post_id":"cjvid4phf00020nbxhhdu42be","tag_id":"cjvid4phn00080nbxbd6mr1fb","_id":"cjvid4php000b0nbxkvesaa0o"},{"post_id":"cjvid4piz000d0nbxiy2mofpc","tag_id":"cjvid4pj1000g0nbxeex9nzbd","_id":"cjvid4pj7000m0nbxajcizy4q"},{"post_id":"cjvid4pj0000e0nbxob5j8l7x","tag_id":"cjvid4pj6000l0nbx7dolrwll","_id":"cjvid4pj8000q0nbxh9d7kpe5"},{"post_id":"cjvid4pj1000h0nbxlyxrw6om","tag_id":"cjvid4pj8000p0nbxu1wgpg91","_id":"cjvid4pj9000x0nbxek6qfh27"},{"post_id":"cjvid4pj1000h0nbxlyxrw6om","tag_id":"cjvid4pj8000t0nbxkbnevo5s","_id":"cjvid4pj9000y0nbxdcnci9mb"},{"post_id":"cjvid4pj2000i0nbxo49h6o9k","tag_id":"cjvid4pj9000w0nbxg04mqdi4","_id":"cjvid4pja00110nbxl8i29jrl"},{"post_id":"cjvid4pj3000j0nbxlbl4lwev","tag_id":"cjvid4pja00100nbxz68pf17u","_id":"cjvid4pjd00140nbx5vyc0ld6"},{"post_id":"cjvid4pj3000j0nbxlbl4lwev","tag_id":"cjvid4pj8000t0nbxkbnevo5s","_id":"cjvid4pjd00150nbxvuuj8via"},{"post_id":"cjvid4plm00170nbxbb0ksrn7","tag_id":"cjvid4phm00050nbxvbf33a1b","_id":"cjvid4pls001a0nbxx028o1o9"},{"post_id":"cjvid4plq00190nbxd2zxlbt6","tag_id":"cjvid4phm00050nbxvbf33a1b","_id":"cjvid4plt001d0nbxiq5gkuvh"},{"post_id":"cjvid4plt001e0nbxrxzukbbp","tag_id":"cjvid4pj9000w0nbxg04mqdi4","_id":"cjvid4plw001k0nbxgc23qqit"},{"post_id":"cjvid4plv001i0nbxd895we27","tag_id":"cjvid4plq00180nbxciezsp58","_id":"cjvid4ply001m0nbx9j2p7k6h"},{"post_id":"cjvid4plv001i0nbxd895we27","tag_id":"cjvid4plu001g0nbxhq2dyrpr","_id":"cjvid4ply001o0nbxweioas2v"},{"post_id":"cjvid4plk00160nbxxqdyqm8o","tag_id":"cjvid4plq00180nbxciezsp58","_id":"cjvid4ply001q0nbxhek0k7dq"},{"post_id":"cjvid4plk00160nbxxqdyqm8o","tag_id":"cjvid4plu001g0nbxhq2dyrpr","_id":"cjvid4plz001s0nbxtqrwvam9"},{"post_id":"cjvid4pls001b0nbxi29gzcq5","tag_id":"cjvid4plx001l0nbxx6j0ce6r","_id":"cjvid4plz001t0nbx4086wah0"},{"post_id":"cjvid4pmm001v0nbxymkjrfoc","tag_id":"cjvid4plq00180nbxciezsp58","_id":"cjvid4pmq001y0nbxrgfy7w4k"},{"post_id":"cjvid4pmn001x0nbxedxpa8j3","tag_id":"cjvid4phm00050nbxvbf33a1b","_id":"cjvid4pmr00210nbxikquqkv0"},{"post_id":"cjvid4pmq001z0nbxv4yerkzj","tag_id":"cjvid4pj8000p0nbxu1wgpg91","_id":"cjvid4pmu00240nbx7vmba6pj"},{"post_id":"cjvid4pmk001u0nbxxyoubhpz","tag_id":"cjvid4plq00180nbxciezsp58","_id":"cjvid4pmy00270nbxm59wjnat"},{"post_id":"cjvid4pmk001u0nbxxyoubhpz","tag_id":"cjvid4pmn001w0nbx7rve3nrf","_id":"cjvid4pn0002a0nbxids8acqi"},{"post_id":"cjvid4pms00220nbxfllmen1l","tag_id":"cjvid4plx001l0nbxx6j0ce6r","_id":"cjvid4pn1002e0nbx7sdmlysx"},{"post_id":"cjvid4pmu00250nbx23s140bq","tag_id":"cjvid4pj8000p0nbxu1wgpg91","_id":"cjvid4pn2002g0nbxti4g71zl"},{"post_id":"cjvid4pmy00280nbxc19tbwtc","tag_id":"cjvid4plq00180nbxciezsp58","_id":"cjvid4pn4002k0nbxw4teip01"},{"post_id":"cjvid4pmy00280nbxc19tbwtc","tag_id":"cjvid4pn1002d0nbxrtbg7lhj","_id":"cjvid4pn4002l0nbxc6ygy0rc"},{"post_id":"cjvid4pn0002b0nbxabsfspwh","tag_id":"cjvid4plq00180nbxciezsp58","_id":"cjvid4pn4002m0nbxghwki17g"},{"post_id":"cjvid4pn0002b0nbxabsfspwh","tag_id":"cjvid4pn1002d0nbxrtbg7lhj","_id":"cjvid4pn4002n0nbx4txvgnzq"},{"post_id":"cjvid4pq3002o0nbxgln5ah0c","tag_id":"cjvid4pj6000l0nbx7dolrwll","_id":"cjvid4pq7002p0nbxh39450qa"}],"Tag":[{"name":"Vue.js","_id":"cjvid4phm00050nbxvbf33a1b"},{"name":"jQuery","_id":"cjvid4phn00080nbxbd6mr1fb"},{"name":"Hexo","_id":"cjvid4pj1000g0nbxeex9nzbd"},{"name":"Three.js","_id":"cjvid4pj6000l0nbx7dolrwll"},{"name":"Skill","_id":"cjvid4pj8000p0nbxu1wgpg91"},{"name":"CSS","_id":"cjvid4pj8000t0nbxkbnevo5s"},{"name":"移动端","_id":"cjvid4pj9000w0nbxg04mqdi4"},{"name":"HTML","_id":"cjvid4pja00100nbxz68pf17u"},{"name":"Javascript","_id":"cjvid4plq00180nbxciezsp58"},{"name":"ES","_id":"cjvid4plu001g0nbxhq2dyrpr"},{"name":"Node.js","_id":"cjvid4plx001l0nbxx6j0ce6r"},{"name":"Ajax + Socket","_id":"cjvid4pmn001w0nbx7rve3nrf"},{"name":"js 数据","_id":"cjvid4pn1002d0nbxrtbg7lhj"}]}}