<!-- build time:Tue Jul 09 2019 00:29:22 GMT+0800 (中国标准时间) --><!DOCTYPE html><html class="theme-next mist use-motion" lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link rel="stylesheet" href="/lib/pace/pace-theme-center-simple.min.css?v=1.0.2"><link rel="stylesheet" href="//fonts.proxy.ustclug.org/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2"><link rel="stylesheet" href="/css/main.css?v=6.7.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.7.0"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32.ico?v=6.7.0"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16.ico?v=6.7.0"><link rel="mask-icon" href="/images/logo.svg?v=6.7.0" color="#222"><script id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",version:"6.7.0",sidebar:{position:"left",display:"post",offset:12,b2t:!0,scrollpercent:!0,onmobile:!1},fancybox:!1,fastclick:!1,lazyload:!1,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><script>!function(e,t,o,c,i,a,n){e.DaoVoiceObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,a=t.createElement(o),n=t.getElementsByTagName(o)[0],a.async=1,a.src=c,a.charset="utf-8",n.parentNode.insertBefore(a,n)}(window,document,"script",("https:"==document.location.protocol?"https:":"http:")+"//widget.daovoice.io/widget/2ed51855.js","daovoice"),daovoice("init",{app_id:"2ed51855"}),daovoice("update")</script><meta name="description" content="微信公众号开发、移动端支付、APP 开发"><meta name="keywords" content="移动端项目"><meta property="og:type" content="article"><meta property="og:title" content="移动端项目开发"><meta property="og:url" content="https://chuanggefighting.github.io/2019/07/04/25-移动端项目开发/index.html"><meta property="og:site_name" content="闯哥要去流浪了"><meta property="og:description" content="微信公众号开发、移动端支付、APP 开发"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2019-07-06T14:37:38.170Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="移动端项目开发"><meta name="twitter:description" content="微信公众号开发、移动端支付、APP 开发"><link rel="alternate" href="/atom.xml" title="闯哥要去流浪了" type="application/atom+xml"><link rel="canonical" href="https://chuanggefighting.github.io/2019/07/04/25-移动端项目开发/"><script id="page.configurations">CONFIG.page={sidebar:""}</script><title>移动端项目开发 | 闯哥要去流浪了</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><a href="https://your-url" class="github-corner" aria-label="View source on GitHub" rel="external nofollow noopener noreferrer" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">闯哥要去流浪了</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">我知道你一定会来，所以我一直在等</p></div><div class="site-nav-toggle"><button aria-label="切换导航栏"><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home //首页"></i><br>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags //标签"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th //分类"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive //归档"></i><br>归档</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><div class="reading-progress-bar"></div><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://chuanggefighting.github.io/2019/07/04/25-移动端项目开发/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="chuanggefighting"><meta itemprop="description" content="chuangge's blog."><meta itemprop="image" content="/images/chuang.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="闯哥要去流浪了"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">移动端项目开发</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-07-04 23:10:50" itemprop="dateCreated datePublished" datetime="2019-07-04T23:10:50+08:00">2019-07-04</time> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2019-07-06 22:37:38" itemprop="dateModified" datetime="2019-07-06T22:37:38+08:00">2019-07-06</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/移动端/" itemprop="url" rel="index"><span itemprop="name">移动端</span></a></span> </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> 阅读次数： <span class="busuanzi-value" id="busuanzi_value_page_pv"></span></span><div class="post-symbolscount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">本文字数：</span> <span title="本文字数">5.1k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 ≈</span> <span title="阅读时长">5 分钟</span></div><div class="post-description">微信公众号开发、移动端支付、APP 开发</div></div></header><div class="post-body" itemprop="articleBody"><meta name="generator" content="Hexo 3.8.0"><h1 id="一、微信公众号"><a href="#一、微信公众号" class="headerlink" title="一、微信公众号"></a>一、微信公众号</h1><h2 id="微信公众号"><a href="#微信公众号" class="headerlink" title="微信公众号"></a>微信公众号</h2><blockquote><p>订阅号存放在一个文件夹中而需要点开查看关注的订阅号，但服务号直接显示在聊天列表</p></blockquote><ul><li><strong>订阅号</strong>：主要用于推送资讯而让用户阅读，每天只能群发一条消息</li><li><strong>服务号</strong>：主要用于为企业、政府等提供对用户的服务，比如银行的服务号可以让用户查询账单等，每个月只可群发四条消息</li><li><strong>企业号</strong>：主要用于公司内部通讯使用，旨在为用户提供移动办公，需要先有成员的通讯信息验证才可以关注成功企业微信</li><li><strong>测试号</strong>：用于开发测试及功能体验，是专门为开发人员准备的一种仅用于测试的公众号，但不可使用微信支付等高级功能</li></ul><h2 id="微信公众平台"><a href="#微信公众平台" class="headerlink" title="微信公众平台"></a>微信公众平台</h2><div style="text-indent:2em">用于管理注册过的公众号，比如自定义菜单、自动回复、推送文章等，主要有两种管理模式：<strong>编辑模式</strong>就是为所有人提供的，如果你的需求仅仅只是最常见的菜单、自动回复等，使用编辑模式已经满足。但是如果你需求的功能比较复杂，就需要使用到<strong>开发模式</strong>。</div><ul><li><p><strong>编辑模式</strong></p><ul><li>主要针对非编程人员及信息发布类公众帐号使用</li><li>优点是可视化界面配置，操作简单，快捷，但是功能有限</li><li>开启后可以方便地通过界面配置 自定义菜单、自动回复的消息</li></ul></li><li><p><strong>开发模式</strong></p><ul><li>主要针对具备开发能力的人使用</li><li>通过编程可以实现更多复杂的功能，提供个性化服务</li><li>开启后能够使用微信公众平台开放的接口，但是编辑模式的自定义菜单等功能会失效</li></ul></li></ul><h2 id="开发工具"><a href="#开发工具" class="headerlink" title="开发工具"></a>开发工具</h2><ul><li><strong>技术文档</strong>：<a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1445241432/" rel="external nofollow noopener noreferrer" target="_blank">微信公众平台</a></li><li><strong>接口调试工具</strong>：<a href="http://mp.weixin.qq.com/debug/" rel="external nofollow noopener noreferrer" target="_blank">http://mp.weixin.qq.com/debug/</a></li><li><strong>接口测试账号</strong>：微信公众平台、开发模式、测试账号</li><li><strong>微信web开发者工具</strong><ul><li>功能：自带”审查元素”功能的微信浏览器，用于调试微信端页面</li><li>准备：公众平台首页、左侧开发者工具、web开发者工具、绑定开发者微信号</li></ul></li></ul><h2 id="接口参数"><a href="#接口参数" class="headerlink" title="接口参数"></a>接口参数</h2><ul><li><strong>appid</strong>：公众号唯一标识id</li><li><strong>secret</strong>：公众号开发密钥</li><li><strong>openid</strong>：用户单平台的唯一标识，每个微信用户关注此公众号后都会生成唯一的 openid</li><li><strong>unionid</strong>：微信跨平台时保证用户唯一标识，同一个用户在服务号和小程序中的 unionid 相同，openid 则不同</li><li><strong>code</strong>：作为换取 access_token 的票据，每次用户授权携带的 code 都不一样，code只能使用一次，5分钟未被使用自动过期</li><li><strong>redirect_uri</strong>：回调链接，完成用户授权后微信服务器自动回调的 uri，一般为业务首页链接（注意请转义）</li><li><strong>response_type</strong> ： 固定为 code</li><li><strong>scope</strong>： 授权方式 可选静默（snsapi_base） 或者非静默（snsapi_userinfo）</li><li><strong>state</strong>： 此参数可为业务需求使用，根据业务需要传入。</li></ul><h2 id="开发准备"><a href="#开发准备" class="headerlink" title="开发准备"></a>开发准备</h2><blockquote><p>联通小程序和公众号：公众平台首页、基本配置、绑定同一个微信开放平台帐号</p></blockquote><ol><li><strong>注册一个服务号并认证通过</strong><ul><li>个人的订阅号不能开通微信支付，只有服务号可以</li><li>服务号和商户平台必须是一个账户主体，即认证的公司需要一致</li></ul></li><li><strong>开通微信支付功能</strong><ul><li>条件：拥有公众帐号且为服务号、公众帐号须通过微信认证</li><li>路径：平台首页、点击左侧微信支付、点击支付申请</li></ul></li><li><strong>如果不是管理员，则需要添加服务号和商户平台的用户管理权限</strong><ul><li>微信公众平台的权限叫做 运营者微信号，在公众平台的左侧、人员设置中添加，需要管理员为我们绑定一个长期的运营者账号</li><li>微信商户平台的权限叫做 员工账号，在商户平台、账户中心、左侧员工账号管理、选择某个角色（通常是管理员）、新增账号、按要求填写之后即可</li></ul></li><li><strong>配置公众号：JS接口安全域名、网页授权域名</strong><ul><li>公众号支付的域名可以是 http/https，而小程序则必须是 https</li><li>配置路径：公众平台、左侧公众号设置、功能设置、JS接口安全域名/网页授权域名</li><li>设置 IP 白名单：公众平台首页、基本配置，获取 access_token 接口才可以调用成功</li><li>下载微信的安全配置文件放到服务器，根据 授权的域名+认证文件 可以访问后即可配置完成</li><li>需要注意的是，每次修改认证域名都会再次重新认证域名，所以认证以后文件请不要轻易删除。</li></ul></li><li><strong>在商户平台开通相应的支付产品功能</strong><ul><li>登陆微信商户平台、产品中心、开通需要的支付产品，如公众号支付、扫码支付、刷卡支付、H5支付</li><li>在商户平台上小程序也属于公众号支付，不需要单独开通</li></ul></li><li><strong>在商户平台设置支付的相关 ip 授权</strong>：以公众号支付为例，开通公众号支付后，这是还不能进行开发，我们需要拿到商户的几个重要信息（括号内为获取来源）<ul><li><code>APP_ID</code> (公众平台)：公众号、小程序开发者ID (AppID)、公众平台首页、基本配置</li><li><code>APP_SECRET</code> (公众平台)：开发者密码 (AppSecret)、公众平台首页、基本配置</li><li><code>MCH_ID</code> (商户平台)：商户号、商户平台首页、账户中心、账户信息</li><li><code>API_KEY</code> (商户平台)：API 密钥、商户平台首页、账户中心、API 安全</li><li><code>APICLIENT_CERT</code> (商户平台)：安全证书路径、商户平台首页、账户中心、API 安全</li></ul></li></ol><h2 id="本地测试环境"><a href="#本地测试环境" class="headerlink" title="本地测试环境"></a>本地测试环境</h2><blockquote><p>首先需要登录微信公众平台，如果没有测试账号则需要申请</p></blockquote><h3 id="搭建内网穿透环境"><a href="#搭建内网穿透环境" class="headerlink" title="搭建内网穿透环境"></a>搭建内网穿透环境</h3><div style="text-indent:2em">vue 项目一般默认 localhost:8080，而微信的JS接口安全域名必须以 <code>http://、https://</code> 开头，由于公众号开发涉及到微信的回调，所以本地搭建的服务器需要外网能够访问，即需要把运行在内网的服务器映射到外网去给微信访问和手机端测试。这种外网和内网计算机连接通信的解决方案有两种：</div><br><div style="text-indent:2em">一是购买域名、云服务器并配置代理，二是使用内网穿透技术，将部署在本地的内网计算机服务直接穿透到外网，让外网通过一个指定的 IP 或域名来访问本地项目。我们一般通过 natapp 实现内网穿透，它的优点是拥有免费的通道，缺点是免费通道不稳定，每过一段时间外网地址会变更，还要更改项目的访问地址，具体的配置步骤如下：</div><ol><li>首先注册账号：点击注册 <a href="https://natapp.cn/register" rel="external nofollow noopener noreferrer" target="_blank">https://natapp.cn/register</a></li><li>登录后购买隧道：点击购买/免费，配置本地地址 <a href="http://127.0.0.1:80" rel="external nofollow noopener noreferrer" target="_blank">http://127.0.0.1:80</a></li><li>本机运行 web 服务：配置地址 <a href="http://127.0.0.1:80" rel="external nofollow noopener noreferrer" target="_blank">http://127.0.0.1:80</a></li><li>本机运行 natapp 服务<ul><li>首次需要下载 natapp.exe <a href="https://natapp.cn/#download" rel="external nofollow noopener noreferrer" target="_blank">https://natapp.cn/#download</a></li><li>我的隧道处获取 authtoken</li><li>启动方式<ul><li>直接启动：natapp -authtoken=9ab6b9040a624f40</li><li>config.ini：<a href="https://natapp.cn/article/config_ini" rel="external nofollow noopener noreferrer" target="_blank">下载 config.ini 文件</a> 到 natapp.exe 同级目录，然后将 authtoken 填入保存，双击启动即可</li></ul></li></ul></li><li>测试 natapp 分配的网址：浏览器地址栏打开，注意需要拔掉电脑网线</li></ol><h2 id="测试账号配置"><a href="#测试账号配置" class="headerlink" title="测试账号配置"></a>测试账号配置</h2><blockquote><p>微信授权域名只支持 80 端口，务必使服务器监听80端口。注意测试号不支持微信支付</p></blockquote><ol><li><strong>js 接口安全域名</strong><ul><li>配置：<a href="http://vbys39.natappfree.cc" rel="external nofollow noopener noreferrer" target="_blank">http://vbys39.natappfree.cc</a></li><li>功能：用于实现应用中的微信分享等功能</li></ul></li><li><strong>接口配置信息</strong><ul><li>URL：<a href="http://vbys39.natappfree.cc" rel="external nofollow noopener noreferrer" target="_blank">http://vbys39.natappfree.cc</a></li><li>Token：weixin，暂时可任意填写</li></ul></li><li><strong>授权回调页面域名</strong><ul><li>步骤：网页服务、网页账号、网页授权获取用户基本信息</li><li>功能：用于应用中的微信用户登录、微信用户基本信息获取</li><li>地址不需要 http、www 开头，只需要填写域名即可</li><li>配置：vbys39.natappfree.cc</li></ul></li></ol><h2 id="接口调试"><a href="#接口调试" class="headerlink" title="接口调试"></a>接口调试</h2><blockquote><p>开发者工具、在线接口调试工具</p></blockquote><ol><li>获取 access_token：输入 appid、secret</li><li>创建自定义菜单<ul><li>接口类型处选择自定义菜单选项</li><li>输入内容创建，注意 access_token 失效和 body 数据格式</li></ul></li><li>测试微信网页<ul><li>公众平台测试账号、测试号二维码、手机扫描查看新菜单</li></ul></li></ol><h2 id="微信授权"><a href="#微信授权" class="headerlink" title="微信授权"></a>微信授权</h2><blockquote><p>步骤一是由前台完成的，前台获取 code 之后需要传给后台，由后台完成 2、3、4</p></blockquote><ol><li>前台通过 <code>location.href</code> 引导到授权页面，用户同意授权后跳转到带参数 code 的回调地址</li><li>后台通过 code 换取网页授权 <code>access_token</code></li><li>开发者可以根据需要刷新网页授权 access_token，避免过期</li><li>后台通过网页授权 <code>access_token、openid</code> 获取用户基本信息（支持 UnionID 机制）</li></ol><h1 id="二、移动端支付"><a href="#二、移动端支付" class="headerlink" title="二、移动端支付"></a>二、移动端支付</h1><h2 id="微信支付"><a href="#微信支付" class="headerlink" title="微信支付"></a>微信支付</h2><ul><li>开发文档：<a href="https://pay.weixin.qq.com/wiki/doc/api/index.html" rel="external nofollow noopener noreferrer" target="_blank">https://pay.weixin.qq.com/wiki/doc/api/index.html</a></li><li>解决方案：<a href="https://www.cnblogs.com/kenshinobiy/p/8878045.html" rel="external nofollow noopener noreferrer" target="_blank">https://www.cnblogs.com/kenshinobiy/p/8878045.html</a></li><li>支付方式<ul><li><strong>付款码支付</strong>：用户打开 微信钱包、付款码，商户扫码后提交完成支付</li><li><strong>JSAPI 支付</strong>：用户通过微信扫码、关注公众号等方式进入商家H5页面，并在微信内调用 JSSDK 完成支付</li><li><strong>Native 支付</strong>：用户打开 “微信扫一扫”，扫描商户的二维码后完成支付</li><li><strong>APP 支付</strong>：商户 APP 中集成微信 SDK，用户点击后跳转到微信内完成支付</li><li><strong>H5 支付</strong>：用户在微信以外的手机浏览器请求微信支付的场景唤起微信支付</li><li><strong>小程序支付</strong>：用户在微信小程序中使用微信支付的场景</li><li><strong>人脸支付</strong>：无需掏出手机, 刷脸完成支付, 适合线下各种场景</li></ul></li></ul><h3 id="支付方式"><a href="#支付方式" class="headerlink" title="支付方式"></a>支付方式</h3><h4 id="JSAPI-支付"><a href="#JSAPI-支付" class="headerlink" title="JSAPI 支付"></a>JSAPI 支付</h4><blockquote><p>主要用于商家在微信服务号中自建网页商城网站，用户通过链接或者二维码进入微信内部网页浏览器时，进行购买下单等支付操作时调用的流程。</p></blockquote><ol><li><strong>开发准备</strong><ul><li>设置支付目录</li><li>设置授权域名</li></ul></li><li><strong>开发流程</strong><ol><li>用户通过链接或二维码进入网页</li><li>调用微信网页授权接口 [官方接口]</li><li>用户授权后获取用户信息 [官方接口]</li><li>封装商品信息并下单</li><li>调用微信统一下单接口 [官方接口]</li><li>根据统一下单接口返回信息组装前端需要的支付参数 [官方验证]</li><li>前端使用支付参数唤起微信支付界面[官方接口]</li><li>支付成功后微信异步调用统一下单时传入的回调接口 [官方接口]</li><li>更新商户订单信息</li></ol></li></ol><h4 id="APP-支付"><a href="#APP-支付" class="headerlink" title="APP 支付"></a>APP 支付</h4><blockquote><p>适用于商户在移动端 APP 中集成微信支付功能。商户 APP 通过微信提供的 SDK 调用微信支付模块而跳转到微信中完成支付，支付完后跳回到商户 APP，最后展示支付结果。</p></blockquote><ol><li><strong>开发流程</strong><ol><li>用户进入商户 APP，选择商品下单、确认购买，进入支付环节。商户服务后台生成支付订单，签名后将数据传输到 APP 端</li><li>用户点击后发起支付操作，进入到微信界面，调起微信支付，出现确认支付界面</li><li>用户确认收款方和金额，点击立即支付后出现输入密码界面选择零钱或银行卡支付</li><li>输入正确密码后，支付完成，用户端微信出现支付详情页面</li><li>回跳到商户 APP 中，商户 APP 根据支付结果个性化展示订单处理结果</li></ol></li><li><strong>区别公众号支付</strong><ul><li>公众号支付需要进行用户授权获取用户信息，统一下单接口需要用户的 openid</li><li>APP 支付不需要用户授权，也不需要用户的 openid</li><li>APP 支付依赖于平台，如 iOS、Android，需要前端小伙伴配合 SDK开发，公众号直接调取 http/https 接口即可</li><li>统一下单时类型不同，开发时注意个别字段的值变化</li></ul></li></ol><h4 id="H5-支付"><a href="#H5-支付" class="headerlink" title="H5 支付"></a>H5 支付</h4><blockquote><p>需要在微信支付商户平台单独申请开通，否则无法使用</p></blockquote><ol><li>用户在商户侧（非微信客户端）完成下单请求支付订单</li><li>商户后台调用微信支付统一下单接口获取支付跳转 mweb_url</li><li>手机浏览器中访问 mweb_url 唤起微信进行支付</li><li>微信支付页面进行 H5 权限的校验，安全性检查</li><li>如果支付成功，商户后台会接收到微信侧的异步通知</li><li>用户在完成或取消支付后返回商户页面（默认返回支付发起页面）</li><li>商户后台处理支付结果并将结果返回给前端展示</li></ol><h4 id="小程序支付"><a href="#小程序支付" class="headerlink" title="小程序支付"></a>小程序支付</h4><blockquote><p>小程序访问商户服务都是通过 HTTPS，开发部署的时候需要安装 HTTPS 服务器。商户系统和微信支付系统主要交互流程如下：</p></blockquote><ol><li>小程序内调用登录接口，获取用户 openid（小程序登录 API）</li><li>商户 server 调用支付统一下单（统一下单 API）</li><li>商户 server 调用再次签名（再次签名）</li><li>商户 server 接收支付通知（支付结果通知 API）</li><li>商户 server 查询支付结果（查询订单 API）</li></ol><h3 id="支付工具"><a href="#支付工具" class="headerlink" title="支付工具"></a>支付工具</h3><ol><li>代金券或立减优惠：商户营销和运营的能力，给用户发放代金券或立减优惠的相关说明</li><li>现金红包：提供给商户营销的能力，商户给用户派发现金红包相关说明</li><li>企业付款：企业付款至用户微信支付零钱或银行卡</li></ol><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><div style="text-indent:2em">无论哪种支付方式，最终都会去调取 统一下单接口，这个接口主要是将商户中的订单信息拼接为支付信息传入到微信平台，微信平台会返回一个 预支付单 信息，我们对这个信息进行再次加密后拼接为实际支付所需的参数（五个字段参与签名、区分大小写）：<code>appId、nonceStr、package、signType、timeStamp</code>，然后给到微信提供的官方接口中即可调起支付页面了。</div><h2 id="支付宝支付"><a href="#支付宝支付" class="headerlink" title="支付宝支付"></a>支付宝支付</h2><p>vue 项目支付：<a href="https://juejin.im/entry/5c178db36fb9a049b347e586" rel="external nofollow noopener noreferrer" target="_blank">https://juejin.im/entry/5c178db36fb9a049b347e586</a></p><h1 id="APP-开发"><a href="#APP-开发" class="headerlink" title="APP 开发"></a>APP 开发</h1><h2 id="唤起-APP"><a href="#唤起-APP" class="headerlink" title="唤起 APP"></a>唤起 APP</h2><blockquote><p>js 在微信、微博、QQ、Safari 唤起 App 的解决方案</p></blockquote></div><div><div><div style="text-align:center;color:#ccc;font-size:14px;margin-top:20px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><footer class="post-footer"><div><ul class="post-copyright"><li class="post-copyright-link"><strong>本文作者：</strong> <a href="/" title="欢迎访问 chuanggefighting 的个人博客">chuanggefighting</a></li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://chuanggefighting.github.io/2019/07/04/25-移动端项目开发/" title="移动端项目开发">https://chuanggefighting.github.io/2019/07/04/25-移动端项目开发/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</li></ul></div><div class="post-tags"><a href="/tags/移动端项目/" rel="tag"><i class="fa fa-tag"></i> 移动端项目</a></div><div class="post-widgets"><div class="social_share"><div id="needsharebutton-postbottom"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2019/05/11/24-移动端布局和事件/" rel="next" title="移动端的 flex 布局和事件"><i class="fa fa-chevron-left"></i> 移动端的 flex 布局和事件</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2019/07/04/26-移动端新科技/" rel="prev" title="移动端新科技">移动端新科技 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><div class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/chuang.png" alt="chuanggefighting"><p class="site-author-name" itemprop="name">chuanggefighting</p><p class="site-description motion-element" itemprop="description">chuangge's blog.</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">27</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">9</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">16</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/" title="GitHub → https://github.com/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="https://stackoverflow.com/" title="StackOverflow → https://stackoverflow.com/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i>StackOverflow</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://chuanggefighting.github.io/project/" title="https://chuanggefighting.github.io/project/">个人简历</a></li><li class="links-of-blogroll-item"><a href="https://www.docschina.org/" title="https://www.docschina.org/" rel="external nofollow noopener noreferrer" target="_blank">印记中文</a></li><li class="links-of-blogroll-item"><a href="http://tool.lu/" title="http://tool.lu/" rel="external nofollow noopener noreferrer" target="_blank">在线工具</a></li><li class="links-of-blogroll-item"><a href="https://learn-anything.xyz/" title="https://learn-anything.xyz/" rel="external nofollow noopener noreferrer" target="_blank">Learn Anything</a></li></ul></div></div></div><div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#一、微信公众号"><span class="nav-number">1.</span> <span class="nav-text">一、微信公众号</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#微信公众号"><span class="nav-number">1.1.</span> <span class="nav-text">微信公众号</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#微信公众平台"><span class="nav-number">1.2.</span> <span class="nav-text">微信公众平台</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#开发工具"><span class="nav-number">1.3.</span> <span class="nav-text">开发工具</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#接口参数"><span class="nav-number">1.4.</span> <span class="nav-text">接口参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#开发准备"><span class="nav-number">1.5.</span> <span class="nav-text">开发准备</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#本地测试环境"><span class="nav-number">1.6.</span> <span class="nav-text">本地测试环境</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#搭建内网穿透环境"><span class="nav-number">1.6.1.</span> <span class="nav-text">搭建内网穿透环境</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#测试账号配置"><span class="nav-number">1.7.</span> <span class="nav-text">测试账号配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#接口调试"><span class="nav-number">1.8.</span> <span class="nav-text">接口调试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#微信授权"><span class="nav-number">1.9.</span> <span class="nav-text">微信授权</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#二、移动端支付"><span class="nav-number">2.</span> <span class="nav-text">二、移动端支付</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#微信支付"><span class="nav-number">2.1.</span> <span class="nav-text">微信支付</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#支付方式"><span class="nav-number">2.1.1.</span> <span class="nav-text">支付方式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#JSAPI-支付"><span class="nav-number">2.1.1.1.</span> <span class="nav-text">JSAPI 支付</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#APP-支付"><span class="nav-number">2.1.1.2.</span> <span class="nav-text">APP 支付</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#H5-支付"><span class="nav-number">2.1.1.3.</span> <span class="nav-text">H5 支付</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#小程序支付"><span class="nav-number">2.1.1.4.</span> <span class="nav-text">小程序支付</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#支付工具"><span class="nav-number">2.1.2.</span> <span class="nav-text">支付工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注意事项"><span class="nav-number">2.1.3.</span> <span class="nav-text">注意事项</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#支付宝支付"><span class="nav-number">2.2.</span> <span class="nav-text">支付宝支付</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#APP-开发"><span class="nav-number">3.</span> <span class="nav-text">APP 开发</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#唤起-APP"><span class="nav-number">3.1.</span> <span class="nav-text">唤起 APP</span></a></li></ol></li></ol></div></div></div><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">© <span itemprop="copyrightYear" title="current year">2019</span> <span class="with-love" id="animate"><i class="fa fa-snowflake-o"></i> </span><span class="author" itemprop="copyrightHolder" title="author">chuangge</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span class="post-meta-item-text">站点总字数：</span> <span title="站点总字数">332k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span class="post-meta-item-text">站点阅读时长 ≈</span> <span title="站点阅读时长">5:02</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item-icon" title="本站访客数"><i class="fa fa-user"></i> </span><span class="site-uv" title="总访客量">本站访客数: <span class="busuanzi-value" id="busuanzi_value_site_uv"></span> </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon" title="本站总访问量"><i class="fa fa-eye"></i> </span><span class="site-pv" title="总访问量">本站总访问量: <span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div></div></footer></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/jquery/index.js?v=2.1.3"></script><script src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/lib/reading_progress/reading_progress.js"></script><script src="/js/src/utils.js?v=6.7.0"></script><script src="/js/src/motion.js?v=6.7.0"></script><script src="/js/src/schemes/muse.js?v=6.7.0"></script><script src="/js/src/scrollspy.js?v=6.7.0"></script><script src="/js/src/post-details.js?v=6.7.0"></script><script src="/js/src/bootstrap.js?v=6.7.0"></script><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={},pbOptions.iconStyle="box",pbOptions.boxForm="horizontal",pbOptions.position="bottomCenter",pbOptions.networks="Weibo,Wechat,Douban,QQZone,Twitter,Facebook",new needShareButton("#needsharebutton-postbottom",pbOptions)</script><script type="text/javascript" src="/js/src/clipboard.min.js"></script><script type="text/javascript" src="/js/src/clipboard.js"></script><script type="text/javascript" src="/js/src/clicklove.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",model:{jsonPath:"/live2dw/assets/tororo.model.json"},display:{position:"left",width:120,height:240},mobile:{show:!1},react:{opacityDefault:1,opacityOnHover:1},log:!1,tagMode:!1})</script><script type="text/javascript" charset="utf-8" src="/js/lazyload-plugin/lazyload.intersectionObserver.min.js"></script></body></html><!-- rebuild by neat -->